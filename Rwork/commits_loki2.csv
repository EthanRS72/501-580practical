"name_with_owner","sha","author","date","verified","message","num_issues","commit_month","has_ci","is_core","first_commit","days_since_first"
"grafana/loki","efce90dac77017cbe796669a81ccb2df22c563bb","DanCech","2018-12-05 20:13:16","true","Fix another README typo",6,8,0,0,"2018-04-16 10:25:39","229.41"
"grafana/loki","8010deac5d77e770af54bca5f4aa5da9612fd62e","KMiller-Grafana","2021-09-30 21:36:06","true","Docs: prominently advertise free Graphana Cloud availability (#4399)",137,41,0,0,"2018-04-16 10:25:39","1260.22"
"grafana/loki","f3309add87df3c1f76a9943b19b973a7781496df","periklis","2023-03-22 12:32:43","true","operator: Pin go version used in netlify env (#8861)",84,59,1,1,"2018-04-16 10:25:39","1797.09"
"grafana/loki","45af549aeb815d18f58bb43608ba680f0fbb9887","cyriltovena","2020-07-23 12:11:35","true","Update fluentd docs and fixes links for the website.i (#2391)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",118,27,0,1,"2018-04-16 10:25:39","827.57"
"grafana/loki","d70332c3aa9f5e27a0c71054705984b37e9d973c","jeschkies","2020-12-03 18:21:06","true","Correct `multiline` documentation. (#3029)",124,31,0,1,"2018-04-16 10:25:39","957.83"
"grafana/loki","b92b544ca2ee7262b3a2eb1d5d24aad731b530ce","jeschkies","2022-02-01 09:28:32","true","Write Promtail position file atomically. (#5266)

Fixes #5218",275,45,0,1,"2018-04-16 10:25:39","1380.71"
"grafana/loki","75ef8c5aa31aa9b11cc46ca54d3f9c8c2b6b74dd","slim-bean","2019-07-17 19:41:07","false","Merging loki-canary project into loki",101,15,0,1,"2018-04-16 10:25:39","456.64"
"grafana/loki","59a0fb3fc940dbbd05a35b598cf4358c8d93b15b","jeschkies","2023-10-19 13:06:25","true","Install dlv 1.21.1 on Docker Compose dev env. (#10953)",20,66,1,1,"2018-04-16 10:25:39","2009.36"
"grafana/loki","71b21c924e54fe2b83d76bcdafbb454d0ddffa4c","ductnn","2022-11-28 11:00:37","true","[Docs] Typo: Fix build path of promtail binary (#7776)",97,55,1,0,"2018-04-16 10:25:39","1683.02"
"grafana/loki","69d0f18eccff9994bee7b8d36d315b75f5d86a27","davkal","2018-12-17 05:54:04","true","Formatting README",36,8,0,0,"2018-04-16 10:25:39","240.81"
"grafana/loki","7fa3e500c31ed2272ae1a450c7d7618092ce5183","osg-grafana","2022-10-19 10:31:55","false","Change `master` to `main` and include `.md` ext.",90,54,1,0,"2018-04-16 10:25:39","1644"
"grafana/loki","7cc93b2694164852317ac8816558a917ed20f48a","owen-d","2020-01-08 18:29:00","false","unifies reverse iterators (#1489)",104,21,0,1,"2018-04-16 10:25:39","627.59"
"grafana/loki","cd270dc477dccafbfa64942e5d8d29ba7839c85c","daixiang0","2019-01-17 11:23:38","false","logcli: remove default url (#194)

Signed-off-by: Xiang Dai <764524258@qq.com>",64,9,0,0,"2018-04-16 10:25:39","271.04"
"grafana/loki","3e80e7ed9d82cbb90580c0b93617b80fdc4c9fe2","shantanualsi","2023-08-31 06:22:56","true","Fix changelog entry (#10406)

Changes the changelog entry as per suggestion in #10395",45,64,1,0,"2018-04-16 10:25:39","1961.08"
"grafana/loki","ef51858c534bf6bc260586d12fb083f467510cd5","JordanRushing","2022-07-26 16:15:49","true","Backport Memberlist dependency version bump to k108 (#6773)

Signed-off-by: JordanRushing <rushing.jordan@gmail.com>",75,51,0,0,"2018-04-16 10:25:39","1561.24"
"grafana/loki","89bdc9c10a198a1c0b6388c8218a9e5d63a33387","3Xpl0it3r","2021-05-18 08:29:35","true","add debug information for extracted data (#3711)

* fix the promtail-default-config download link in doc

* add debug information for extreacted in stage

* add Debug variable

* format",197,37,0,0,"2018-04-16 10:25:39","1127.67"
"grafana/loki","65b4cbb951115b9e40ebeb0150b3855e3003681b","cyriltovena","2019-05-13 22:18:33","false","fix typo",99,13,0,1,"2018-04-16 10:25:39","392.75"
"grafana/loki","abe96fc20086063969f0954ca183d91a35090d2b","slim-bean","2019-09-10 21:15:08","false","fixing lots of broken links and a few typos",70,17,0,1,"2018-04-16 10:25:39","509.7"
"grafana/loki","272a89c13df853a69ef50a53172ce5309c8f36a1","slim-bean","2020-04-30 21:35:18","true","more linter fixes (#2024)

* more linter woes

Signed-off-by: Ed Welch <edward.welch@grafana.com>

* feedback

Signed-off-by: Ed Welch <edward.welch@grafana.com>",120,24,0,1,"2018-04-16 10:25:39","744.97"
"grafana/loki","4bfcd09d6b82cbebdb3f2e419b4e6bcbb5627320","slim-bean","2019-06-24 18:09:46","false","adding resource requests in jsonnet",91,14,0,1,"2018-04-16 10:25:39","433.57"
"grafana/loki","71979f0f428144aee877ccaebda16ddd6f53815f","MasslessParticle","2023-01-25 18:09:57","true","Fix pubsub pull target (#8281)",81,57,1,1,"2018-04-16 10:25:39","1740.32"
"grafana/loki","bb89b9b585c0c55083cd17f9723a9af3a15997e8","slim-bean","2019-05-09 17:58:21","false","Fix a bug where we should use the glob matcher on fsnotify new file create.
Changed the timing of the sync function in the unit test to fix flakiness in the test.",98,13,0,1,"2018-04-16 10:25:39","388.56"
"grafana/loki","333be559bd6770df544d08e3b28a5d3b155c06aa","base698","2019-04-27 18:01:29","false","Typo",96,12,0,0,"2018-04-16 10:25:39","376.57"
"grafana/loki","bbd737cdd43a324f329c7ea24c0c2bb462338077","jeschkies","2021-11-24 07:31:02","true","Do not run manifest and deploy jobs in cron. (#4772)

* Do not run manifest and deploy jobs in cron.

* Remove `pull_request` event.",214,43,0,1,"2018-04-16 10:25:39","1313.63"
"grafana/loki","84220c4b02013b96dc3e755496f2db52dff69633","owen-d","2021-11-01 20:07:21","true","improves scheduler & compactor ringwatcher checks (#4607)",169,42,0,1,"2018-04-16 10:25:39","1291.15"
"grafana/loki","fc0f98b802405147b392c0256a89f086d06748e8","owen-d","2021-09-22 17:58:51","true","removes deprecated duplicate per stream rate limit fields (#4367)",128,41,0,1,"2018-04-16 10:25:39","1252.06"
"grafana/loki","3021d6f29abd77619947c4128025a394ec8ac9ad","daixiang0","2019-06-07 13:44:13","false","Remove 404 link (#637)

Signed-off-by: Xiang Dai <764524258@qq.com>",110,14,0,0,"2018-04-16 10:25:39","416.39"
"grafana/loki","eeca4589fbb439c7d5c391c46886dff81fe619a2","jeschkies","2023-02-23 16:31:33","true","Define Container for Codespaces (#8561)",64,58,1,1,"2018-04-16 10:25:39","1768.25"
"grafana/loki","653b807a9205d52fa499c4ecf7b3355c8481b498","MasslessParticle","2023-01-27 21:19:43","true","update helm for GEL 1.6.1 (#8304)",82,57,1,1,"2018-04-16 10:25:39","1742.45"
"grafana/loki","2f00eacdbf3eac1aed98e0bdd1e7a5b922251451","periklis","2021-12-21 16:32:21","true","Fix logo on operator README.md (#4984)",243,44,0,1,"2018-04-16 10:25:39","1341"
"grafana/loki","35dd07c4e045c41b74356dbb092988ebd28aab79","slim-bean","2020-01-10 13:08:57","false","fixes a panic where prefetch could try to operate on a nil object (#1499)

Signed-off-by: Edward Welch <edward.welch@grafana.com>",102,21,0,1,"2018-04-16 10:25:39","629.36"
"grafana/loki","eeb8b40eaa0ada017fd6d9be929dee4c69dfb145","bboreham","2022-04-08 15:02:45","true","usagestats tests: don't check unpredictable number (#5840)

If this test is run alongside a number of other tests then the number of
goroutines can change between when the report is generated and when the
result is checked, which will cause the test to fail.",319,48,0,0,"2018-04-16 10:25:39","1447.94"
"grafana/loki","d2281a7b6e133267dcf412333384adfd127214b2","bboreham","2023-01-23 21:15:24","true","Benchmark_store_SelectSample: stop accumulating results (#8242)",83,57,1,0,"2018-04-16 10:25:39","1738.45"
"grafana/loki","c4e5d0d322fda2323ac2caeee214d18e571f74c6","MattiasSegerdahl","2023-05-01 08:42:17","true","Update write-scenario.md (#9312)

**What this PR does / why we need it**:

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",79,60,1,0,"2018-04-16 10:25:39","1841.18"
"grafana/loki","1493278ff2524c064a5407360970d5fa21fec78c","cstyan","2021-10-25 12:50:47","true","Add a a parameter to keep/drop the stream label from cloudwatch. (#4494)

* Add a a parameter to keep/drop the stream label from cloudwatch.

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* Address Cyril's review comments.

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* Ensure the keep stream value is properly passed in as an environment
variable when deploying via CloudFormatioEnsure the keep stream value is
properly passed in as an environment variable when deploying via
CloudFormationn

Signed-off-by: Callum Styan <callumstyan@gmail.com>",165,42,0,1,"2018-04-16 10:25:39","1284.85"
"grafana/loki","6da518c728c68f70b75b5aaaa3ae06d3589cb637","cstyan","2021-10-18 19:14:41","true","Update to go 1.17; go mod vendor required (#4487)

Signed-off-by: Callum Styan <callumstyan@gmail.com>",159,42,0,1,"2018-04-16 10:25:39","1278.12"
"grafana/loki","360843485d25ecdc52c0c24b3f8f727737c75104","periklis","2022-07-01 06:54:24","true","operator: Refactor feature gates to use custom resource definition (#6549)",72,50,0,1,"2018-04-16 10:25:39","1535.85"
"grafana/loki","dd8226e63b1db95656324c60539fb6ed9d61dd2e","sapslaj","2023-08-02 16:00:03","true","lambda-promtail: fix/refactor SQS integration in Terraform module (#9909)

**What this PR does / why we need it**:

Currently, the Terraform module for lambda-promtail is not working due
to a misnamed reference:

```
╷
│ Error: Reference to undeclared resource
│ 
│   on .terraform/modules/lambda_promtail/tools/lambda-promtail/sqs.tf line 66, in resource ""aws_iam_role_policy_attachment"" ""lambda_sqs_execution"":
│   66:   role       = aws_iam_role.iam_for_lambda.name
│ 
│ A managed resource ""aws_iam_role"" ""iam_for_lambda"" has not been declared in
│ module.lambda_promtail.
╵
```

It looks like this was the result of a conflict with #8231 and #8750.

While I was in there I also refactored the SQS work to be more
consistent with #8750.

I also made the queue name prefix configurable with the
`sqs_queue_name_prefix` variable, as it was hardcoded before which could
cause issues if multiple instances of this module are initialized in the
same AWS account and region.

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",52,63,1,0,"2018-04-16 10:25:39","1932.48"
"grafana/loki","cec264996b997b7a0b799362b7c9d62634f21537","chaudum","2023-02-28 12:56:40","true","LID: Improve scheduler to control QoS across users within a tenant (#8585)

Even though Loki is built as multi-tenant system by default, there are use-cases where a Loki installation only has a very large, single tenant, e.g. dedicated Loki cells for customers in Grafana Cloud.

However, there are potentially a lot of different users using the same tenant to query logs, such as users accessing Loki from Grafana or via CLI or HTTP API. This can lead to contention between queries of different users, because they all share the same tenant.

While the current implementation of the scheduler queues allows for QoS guarantees between tenants, it does not account for QoS guarantees across individual users within a single tenant.

---

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>
Co-authored-by: Karsten Jeschkies <karsten.jeschkies@grafana.com>",71,58,1,1,"2018-04-16 10:25:39","1773.1"
"grafana/loki","3039ca06f4d0fe964943bebcc29d9a4991143635","robot-o","2022-11-11 14:28:14","true","Docs: Fix typo in helm scalable installation documentation, object storage section (#7676)

**What this PR does / why we need it**:

fixes a small typo in the helm install documentation regarding object
storage. In a reference to more documentation it says 'otehr' instead of
'other'

**Which issue(s) this PR fixes**:
n/a

**Special notes for your reviewer**:
n/a

**Checklist**
- [x] Reviewed the `CONTRIBUTING.md` guide
- [x] Documentation added
- [x] Tests updated
- [x] `CHANGELOG.md` updated
- [x] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",85,55,1,0,"2018-04-16 10:25:39","1666.17"
"grafana/loki","d87dbf9f8a13e7499484ac709bbd2fb052fc719b","aknuds1","2022-01-10 11:57:42","true","Chore: Upgrade to latest Cortex (#5085)

* Chore: Upgrade to latest Cortex

Signed-off-by: Arve Knudsen <arve.knudsen@gmail.com>

* Chore: Upgrade to Prometheus@692a54649ed7

Signed-off-by: Arve Knudsen <arve.knudsen@gmail.com>

* Fix build after upgrading dskit

Signed-off-by: Arve Knudsen <arve.knudsen@gmail.com>

* Add changelog entry

Signed-off-by: Arve Knudsen <arve.knudsen@gmail.com>",255,45,0,0,"2018-04-16 10:25:39","1359.81"
"grafana/loki","62d5122a11cf0d898e811dae4d3dd23a3bc9b573","pracucci","2019-08-30 16:08:13","false","Promtail exports metrics on sent and dropped log entries",120,16,0,0,"2018-04-16 10:25:39","499.49"
"grafana/loki","6ab9089a9b26ba89d1ac25f80e5b9fd59a11c844","tomwilkie","2018-05-18 17:57:14","false","Fix spaceFor, so we can add more than one entry per chunk.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",0,1,0,0,"2018-04-16 10:25:39","32.31"
"grafana/loki","b49b3ce6e132801f2dcac8243cd55b47f6255d16","chaudum","2023-10-16 14:00:00","true","Add basic structure of bloom gateways (#10782)

### Summary

This pull requests adds the basic structure for the new bloom gateway component.

- Adds new `bloom-gateway` target that runs with multiple instances joined by a ring
- Adds a querier and client component on the index gateway to filter chunk refs
- Adds the gRPC protobuf definitions for commication between index gateways and bloom gateways
- Adds a store component used on the bloom gateways to query binary bloom files

```

			     Querier   Query Frontend
			        |           |
			................................... service boundary
			        |           |
			        +----+------+
			             |
			     indexgateway.Gateway**
			             |
			   bloomgateway.BloomQuerier
			             |
			   bloomgateway.GatewayClient
			             |
			  logproto.BloomGatewayClient
			             |
			................................... service boundary
			             |
			      bloomgateway.Gateway
			             |
			       bloomshipper.Store
			             |
			      bloomshipper.Shipper
			             |
                        bloomshipper.BloomFileClient**
			             |
			        ObjectClient**
			             |
			................................... service boundary
			             |
		         object storage

** not part of this PR
```

This PR still contains a lot of TODOs and possibilities for optimisations, which will be addressed in subsequent pull requests.

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",24,66,1,1,"2018-04-16 10:25:39","2006.4"
"grafana/loki","392fde1e27471d706926f8f83a5090dea1f925b8","Juneezee","2022-01-27 15:24:44","true","refactor: use `T.TempDir` to create temporary test directory (#5253)

* refactor: use `T.TempDir` to create temporary test directory

The directory created by `T.TempDir` is automatically removed when the
test and all its subtests complete.

Reference: https://pkg.go.dev/testing#T.TempDir
Signed-off-by: Eng Zer Jun <engzerjun@gmail.com>

* docs: update CHANGELOG.md

Signed-off-by: Eng Zer Jun <engzerjun@gmail.com>",276,45,0,0,"2018-04-16 10:25:39","1376.96"
"grafana/loki","5602a494895ad2e44d9a6fddc36695b26d50fa54","slim-bean","2021-11-05 22:09:19","true","update references to new 2.4.0 image (#4672)",176,43,0,1,"2018-04-16 10:25:39","1295.24"
"grafana/loki","9c2da08ef5d7208a104e5f7665db79e5f8340f4e","rgarcia6520","2022-11-09 09:42:58","true","[Helm] Updating tokgen job imagePullSecret templating (#7524)

Signed-off-by: garcia.ryan <garcia.ryan@solute.us>

**What this PR does / why we need it**:
Updating `imagePullSecret` templating to correctly template in matching
key from values.

**Which issue(s) this PR fixes**:
Fixes #7523

Co-authored-by: Trevor Whitney <trevorjwhitney@gmail.com>",85,55,1,0,"2018-04-16 10:25:39","1663.97"
"grafana/loki","61fc02a00270c4d899037bdcc5450d91028365ee","woodsaj","2019-02-11 11:49:35","false","set currLabels when currEntry is set. (#308)

* set currLabels when creating new heapIterator

fixes #307

* update unit tests to ensure labels are set correctly",81,10,0,0,"2018-04-16 10:25:39","295.06"
"grafana/loki","24b4c0eed2ca35225c88d428f62766e4fffbc67a","james-callahan","2021-12-10 08:25:49","true","Remove duplicated code in ruler rule validation (#4903)",220,44,0,0,"2018-04-16 10:25:39","1329.67"
"grafana/loki","8ba1f8eb0a6628db90702df709e73869df24dae6","periklis","2022-11-07 13:12:07","true","operator: Increase lint timeout to 5m0s (#7612)",87,55,1,1,"2018-04-16 10:25:39","1662.12"
"grafana/loki","27153064e57ea144e16aab6ef43257b47c0330f8","daixiang0","2019-06-19 01:32:47","false","fix helm lint issue

Signed-off-by: Xiang Dai <764524258@qq.com>",84,14,0,0,"2018-04-16 10:25:39","427.88"
"grafana/loki","44402d14556c906b5aaf1bc715a2f75e3641fd22","vash-knives","2023-09-25 20:11:14","true","Add urls to connect Grafana (on Docker) to Loki (local buid instance) (#10694)

10692 - Added urls for Mac and Windows when connecting a Grafana running
on Docker to a locally built Loki instance

**What this PR does / why we need it**:
I've added 2 URLs (mac and windows) that needs to be used if the user is
running a Grafana with docker and trying to connect to a locally built
Loki running on localhost (not Docker). When trying to figure out how to
run the buids, it was very confusing as to why it's not working, I had
to research to try to make the connection work. zDocumentation in
setting up a local development environemtn can actually use some
improvement as well as I had to moved from one section to another.

**Which issue(s) this PR fixes**:
Fixes #10692

**Special notes for your reviewer**:



**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [x] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

Co-authored-by: A C N <145731451+aclassynerd@users.noreply.github.com>",34,65,1,0,"2018-04-16 10:25:39","1985.66"
"grafana/loki","f0715a2c8cd995100a972b174a3c772e3af2947b","osg-grafana","2021-04-21 13:42:31","true","Fix wget link. (#3633)",166,36,0,0,"2018-04-16 10:25:39","1100.89"
"grafana/loki","ca8fd8dfb7d4a67c696a3b78879851b5c0b81cdb","JStickler","2023-01-10 23:50:01","true","[Docs] Remove outdated canary logo (#8035)

Remove the rather outdated canary logo on the page describing the Loki
canary app.

https://grafana.com/docs/loki/latest/operations/loki-canary/ 


**Checklist**
- [X] Reviewed the `CONTRIBUTING.md` guide
- [X] Documentation added
- [N/A] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",99,57,1,0,"2018-04-16 10:25:39","1725.56"
"grafana/loki","8a2081a39ea1ff0458376196f44324d63be982a5","MasslessParticle","2021-08-05 07:37:24","true","Distributor: Truncate rather than drop log lines (#4051)

* Truncate rather than drop logs

- When log lines are longer than maxLineSize, truncate them to maxLineSize rather than dropping them

Fixes: #3747

* Review feedback:

- Rename 'max_line_size_should_truncate' to 'max_line_size_truncate'
- Add configurable truncated indicator
- Add Truncated Line metric
- Changed truncated metrics to have the name mutated_{samples,bytes}_total

* Linter

* Review Feedback

- Make metric variable names match metric names
- Add benchmarks
- reduce truncation allocs by 100x

* Linter

* Remove truncation indicator",102,40,0,1,"2018-04-16 10:25:39","1204.63"
"grafana/loki","da90b48898f11e0e203cf825cd1ce04052eaa843","tomwilkie","2018-05-16 10:39:13","false","Basic CLI.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",0,1,0,0,"2018-04-16 10:25:39","30.01"
"grafana/loki","9218e4654b66892bea03b5da2aa77e9b89bceb8f","owen-d","2022-06-10 21:13:21","true","TSDB/query-planning-groundwork (#6367)

* begins building queryrange compatible types for index sampling

* adds MatcherGroups() method to SampleExpr

* MatcherGroups test + ShardResolver interface

* index stats codec wiring

* millisecond precision on index stats codec

* lint

* cleanMatchers in tsdb.IndexClient for consistency + adds catchall matcher if nil",69,50,0,1,"2018-04-16 10:25:39","1515.45"
"grafana/loki","d320873e825f5e84bf6f1279c2ac9c8a989e286b","owen-d","2022-03-10 18:58:24","true","Tsdb/sharding (#5600)

* sharded support for GetChunkRefs and Series

* sharded support for multi-index

* linting",306,47,0,1,"2018-04-16 10:25:39","1420.11"
"grafana/loki","32f0dbc2a53bdda0547e8c20925748eb41c1bb2c","kevinburkesegment","2023-10-23 08:56:48","true","promtail/client: note client config is not deprecated (#10705)

**What this PR does / why we need it**:

Because the block of code immediately below `*Config` indicates that all
arguments are deprecated, I incorrectly assumed that the `*Config`
itself was deprecated and went hunting for a replacement. But the
`*Config` struct is still how a client is expected to be configured.

**Which issue(s) this PR fixes**: Updates #10702.

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [x] Tests updated
- [x] `CHANGELOG.md` updated
- [x] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [x] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [x] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",25,66,1,0,"2018-04-16 10:25:39","2013.19"
"grafana/loki","c6e18a2efb60884209b3485240ef8790ff3839e6","DylanGuedes","2023-06-20 13:34:07","true","Loki: Humanize downloaded file size (bytes format) (#9746)

**What this PR does / why we need it**:
Humanize reported size of downloaded file. 

**Which issue(s) this PR fixes**:
N/A",61,62,1,1,"2018-04-16 10:25:39","1890.38"
"grafana/loki","297f0e9d03cb93ca11e72f57106371f03f21004e","rfratto","2019-08-12 18:04:25","true","Makefile: build promtail with CGO_ENABLED if GOHOSTOS=GOOS=linux (#809)

This commit modifies the Makefile to build promtail with CGO_ENABLED if
both GOHOSTOS and GOOS are set to linux.

To facilitate the Docker container utilizing the journal support,
the container for promtail had to be modified to be based on top of
debian. The sd-journal library depends on libsystemd.so being present
at runtime. As alpine currently does not have a package for systemd,
the easiest approach is to change the base image to debian:stretch-slim.
A future solution for providing an alpine-based build will be considered
in the future and discussion for the approach will be tracked in #838.

This commit also updates the Dockerfile to default to using the
latest loki-build-image. If a specific version is required, it should
be provided as a build arg to docker build.",103,16,0,1,"2018-04-16 10:25:39","481.57"
"grafana/loki","afd63c598126a4f8b2c87809af29c896e1a41b02","trevorwhitney","2022-09-21 16:02:12","true","[helm] Add Loki Canary to Helm Chart (#7173)

**What this PR does / why we need it**:

This PR adds the Loki canary as well as the GEL provisioner to the Loki
helm chart. The Loki canary expands the self-monitoring functionality of
the Helm chart, giving operators insight beyond whether Loki is just
running, but also if it's functioning properly.

The GEL provisioner was necessary for the canary to work when the
enterprise option (`enterprise.enabled = true`) is enabled. Since
enabling enterprise in the helm chart also enables auth/multi-tenancy,
the addition of the provisioner allows the helm chart to automatically
create a tenant for the canary via the GEL admin API, and to create
applicable access policies and tokens. Furthermore, additional tenants
can also be specified, which will be provisioned, creating a read and
write token for each that will be stored in k8s secrets.

**Which issue(s) this PR fixes**:
Fixes #7019 

Co-authored-by: Karsten Jeschkies <k@jeschkies.xyz>
Co-authored-by: Dylan Guedes <djmgguedes@gmail.com>",85,53,1,1,"2018-04-16 10:25:39","1616.23"
"grafana/loki","53949dc5cd5c5a816835dbc659af02d22087cd84","trevorwhitney","2023-10-30 20:49:31","true","add scan-vulnerabilities make target (#10971)

**What this PR does / why we need it**:
 
Adds a make file target for running both trivy and snyk to scan our
images for vulnerabilities during/before releases.",17,66,1,1,"2018-04-16 10:25:39","2020.68"
"grafana/loki","86411496cafd5d49a442eb436523380b31aca635","steven-sheehy","2020-10-12 10:32:25","true","Fix linting errors and use of deprecated repositories (#2742)

* Bump Helm chart dependencies to fix linting

Signed-off-by: Steven Sheehy <steven.sheehy@hedera.com>

* Fix ct config

Signed-off-by: Steven Sheehy <steven.sheehy@hedera.com>

* Add new repos to Makefile

Signed-off-by: Steven Sheehy <steven.sheehy@hedera.com>",113,30,0,0,"2018-04-16 10:25:39","906.5"
"grafana/loki","05d771fee3b26197b7a7471292f6308b7288cf59","grafanabot","2023-07-21 15:32:44","true","[CI/CD] Update yaml file `./production/helm/loki/Chart.yaml` (+1 other) (#10015)

**Here is a summary of the updates contained in this PR:**
***
Update attribute `$.appVersion` in yaml file
`./production/helm/loki/Chart.yaml` to the following value: `2.8.3`
***
Bump version of Helm Chart
Add changelog entry to `./production/helm/loki/CHANGELOG.md`
Re-generate docs

Co-authored-by: Michel Hollands <42814411+MichelHollands@users.noreply.github.com>",55,63,1,0,"2018-04-16 10:25:39","1921.46"
"grafana/loki","699fffe9e583274ca55ef4e6073fa86d5d872548","AndreZiviani","2022-02-04 21:58:46","true","lambda-promtail: Add ability to ingest logs from S3 (#5065)

* Add ability to ingest logs from S3 on lambda-promtail

* fix ci

* fix typo

* bump golang and alpine version

* update changelog

* add s3 permissions on terraform

* use for_each instead of count

* fix typo

* improve function naming

* add documentation and an example of a s3 file path

* refact logic to identify event type

* add missing iam permission to allow lambda to run inside a vpc

* fix typo

* allow lambda to access only specified s3 buckets

* configure a default log retention policy on log group

* add missing depends_on to make sure iam role is created before lambda function

* update docs

* fix label naming convention

* fix merge conflict

* use new backoff lib and update dependencies

* add option to limit batch size

* cache s3 client

* update docs and terraform

* address some feedback on PR

* fix typo",277,45,0,0,"2018-04-16 10:25:39","1384.23"
"grafana/loki","e11cd61f33ed22c804115a83e7b50937dea61847","slim-bean","2019-06-03 20:35:56","false","change the helm pullPolicy since we will be using releases now",109,14,0,1,"2018-04-16 10:25:39","412.67"
"grafana/loki","1b25100d69b9fd30e0a018b12b4fb7ae72e81db4","slim-bean","2019-03-29 21:16:42","false","adding labels design doc",93,11,0,1,"2018-04-16 10:25:39","343.45"
"grafana/loki","15b382294ed1818616c4600b5123a94a4bcbfb67","bboreham","2023-01-20 17:21:07","true","Remove dependency on thanos-io/thanos (#8227)

**What this PR does / why we need it**:

This avoids complications trying to match up versions between Prometheus
and Thanos.

**Special notes for your reviewer**:

I don't know why the dependency on `github.com/efficientgo/e2e` has
appeared in go.mod, but it doesn't seem to change what is in vendor.

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- NA Documentation added
- NA Tests updated
- NA `CHANGELOG.md` updated
- NA Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",83,57,1,0,"2018-04-16 10:25:39","1735.29"
"grafana/loki","509896137d11fadbd6227cb470a4bbbee9c2d8a1","agoddard","2023-08-21 21:42:09","true","[docs] replace use of ""examplifies"" (#10296)

minor spelling correction

**What this PR does / why we need it**:
Trivial patch for grammar, updated sentence to match sentence structure
used elsewhere in the docs


**Checklist**
- [ x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)",50,64,1,0,"2018-04-16 10:25:39","1951.72"
"grafana/loki","ad70b5d54b230f55e079da9e16a817afb6bf2304","kavirajk","2023-08-01 10:24:44","true","fix(dependabot): Combine approve and enable auto-merge into one step (#10126)

**What this PR does / why we need it**:
Update the ""dependabot_reviewer"" Github Action workflow.

This should fix the issues we having when trying to enable ""auto-merge""
for example

https://github.com/grafana/loki/actions/runs/5680113173/job/15393583446?pr=10080

I have tested this using another repository
example.
https://github.com/kavirajk/dependabot-play/pull/7

With workflow change.

https://github.com/kavirajk/dependabot-play/blob/main/.github/workflows/dependabot_reviewer.yml#L27-L35

**Which issue(s) this PR fixes**:
Fixes #NA

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",53,63,1,1,"2018-04-16 10:25:39","1931.25"
"grafana/loki","183fe85f1cc27ad59e8c092f50b3fc531b97271f","wtchangdm","2023-03-22 09:23:35","true","Loki: Add route_randomly to Redis options (#8852)

**What this PR does / why we need it**:

Current Redis client only reads from master node, which makes master
node under heavy pressure.

Usually, one or more read replicas are expected on production
environments.

This PR helps to increase the utilization of read replicas.",84,59,1,0,"2018-04-16 10:25:39","1796.96"
"grafana/loki","6ac96478a7704a0d004888b9ca3e878c7d909d47","owen-d","2021-08-16 20:01:51","true","safely close nonOverlapping iterators (#4160)",132,40,0,1,"2018-04-16 10:25:39","1216.15"
"grafana/loki","e75257f8dd6456d1833d96037b1b563e6aa49c56","xperimental","2022-03-08 17:47:10","true","operator: Change endpoints for generated liveness and readiness probes (#5576)",303,47,0,1,"2018-04-16 10:25:39","1418.06"
"grafana/loki","ef63636f5ad3f0d9f2d04072a3af216afa148b4a","grafanabot","2023-05-03 14:21:02","true","[CI/CD] Update yaml file `./production/helm/loki/values.yaml` (+1 other) (#9388)

**Here is a summary of the updates contained in this PR:**
***
Update attribute `$.enterprise.version` in yaml file
`./production/helm/loki/values.yaml` to the following value: `v1.7.2`
***
Bump version of Helm Chart
Add changelog entry to `./production/helm/loki/CHANGELOG.md`
Re-generate docs

---------

Co-authored-by: Salva Corts <salva.corts@grafana.com>",81,61,1,0,"2018-04-16 10:25:39","1843.41"
"grafana/loki","9ac33e216e2eed70782ace0b690b8018e050012f","MasslessParticle","2023-03-08 15:53:48","true","Reimplement Unpack in terms of jsonparser rather than jsoniter (#8739)

This PR reimplements the functionality of `Unpack` using the
`jsonparser` library rather than `jsoniter`

Benchmarks:
```
name                                            old time/op    new time/op    delta
_Parser/unpack/no_labels_hints-8                   900ns ± 4%     309ns ± 3%  -65.62%  (p=0.000 n=10+10)
_Parser/unpack/labels_hints-8                     1.06µs ±12%    0.32µs ± 2%  -69.72%  (p=0.000 n=9+10)
_Parser/unpack-not_json_line/no_labels_hints-8    37.5ns ± 8%    10.6ns ± 3%  -71.70%  (p=0.000 n=9+9)
_Parser/unpack-not_json_line/labels_hints-8       39.6ns ±11%    10.3ns ± 2%  -74.00%  (p=0.000 n=10+9)

name                                            old alloc/op   new alloc/op   delta
_Parser/unpack/no_labels_hints-8                    536B ± 0%       80B ± 0%  -85.07%  (p=0.000 n=10+10)
_Parser/unpack/labels_hints-8                       536B ± 0%       80B ± 0%  -85.07%  (p=0.000 n=10+10)
_Parser/unpack-not_json_line/no_labels_hints-8     0.00B          0.00B          ~     (all equal)
_Parser/unpack-not_json_line/labels_hints-8        0.00B          0.00B          ~     (all equal)

name                                            old allocs/op  new allocs/op  delta
_Parser/unpack/no_labels_hints-8                    17.0 ± 0%       4.0 ± 0%  -76.47%  (p=0.000 n=10+10)
_Parser/unpack/labels_hints-8                       17.0 ± 0%       4.0 ± 0%  -76.47%  (p=0.000 n=10+10)
_Parser/unpack-not_json_line/no_labels_hints-8      0.00           0.00          ~     (all equal)
_Parser/unpack-not_json_line/labels_hints-8         0.00           0.00          ~     (all equal)
```",86,59,1,1,"2018-04-16 10:25:39","1783.23"
"grafana/loki","065bee7e72b00d800431f4b70f0d673d6e0e7a2b","MasslessParticle","2023-06-12 16:21:58","true","Label Volume Endpoint (#9588)

For a given set of matchers, returns the top N associated label/value
pairs by volume. A query for `{cluster=prod}` will return

```
cluster=prod: size (total logs matching this matcher)
 .
 .
 .
nth-label=nth-value
```

This is to service use cases where users want to understand where their
log volume has come from by label without making multiple requests to
the stats endpoint.

Note: This PR is a monster but it's mostly plumbing. I've pointed out
the most interesting bits that actually get the volumes from
ingesters/indexs",67,62,1,1,"2018-04-16 10:25:39","1882.5"
"grafana/loki","3e0621ebf68c3c9b0d3f541c8dd8e659a14b363d","sandeepsukhani","2019-09-19 07:34:52","false","verify backups to work on latest list of backups

when tables rotate, it creates a final backup of last active table.
verify backups was not having that last backup in the list so this change makes sure it has
latest list of backups",67,17,0,1,"2018-04-16 10:25:39","518.13"
"grafana/loki","0ade92aef0658db021f4f52232925c99ff00824d","gouthamve","2018-11-19 18:09:59","false","Initial Mixin (#25)

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>",5,7,0,0,"2018-04-16 10:25:39","213.32"
"grafana/loki","5ecbbbe5f58fcd4bc931b4acf63276590d769f60","chaudum","2022-03-25 13:56:16","true","Mark GELF support in Promtail as experimental (#5697)

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",309,47,0,1,"2018-04-16 10:25:39","1434.9"
"grafana/loki","24f8f6a4deef5c4412f6ae83af750df274f2d83d","owen-d","2021-03-26 08:55:08","true","compactor docs (#3543)",145,35,0,1,"2018-04-16 10:25:39","1070.44"
"grafana/loki","a795b93897add580acdbf8efac04f29ffd695fc0","kavirajk","2022-05-26 09:18:24","true","chore(cache): Make exprimental messages more clear for cache. (#6219)

Currently we see following message when any of the experimental feature is used for cache (say fifocache or redis).
But the problem it doesn't say __what_kind__ of cache is it exactly.

So this leads to confusion to track what kind of cache is the source of the experiment feature.

This PR fixes it by adding more clear message.

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",72,49,0,1,"2018-04-16 10:25:39","1500.95"
"grafana/loki","785fc2a62c4cb3fd5b50215dd4fa81c04e5c2583","MichelHollands","2023-01-10 17:15:18","true","Add docker-driver pipeline (#8083)

Copy the docker-driver pipeline from CirclCI to drone.

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",100,57,1,1,"2018-04-16 10:25:39","1725.28"
"grafana/loki","66106f34ebfae232ba1c9034426df2a6b6d83741","MichelHollands","2023-02-02 14:23:49","true","Pin windows build Go version (#8387)

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>
Signed-off-by: Christian Haudum <christian.haudum@gmail.com>
Co-authored-by: Christian Haudum <christian.haudum@gmail.com>",80,57,1,1,"2018-04-16 10:25:39","1747.17"
"grafana/loki","3df55613361ae1db5224a13e126e9c4e35e2a2b8","pstibrany","2019-10-09 19:56:14","false","Updated cortex to latest master. (#1088)

* Updated cortex to latest master.

* Updated cortex to latest master.

* Fix tests after updating cortex.

* go mod tidy and vendor",67,18,0,0,"2018-04-16 10:25:39","538.65"
"grafana/loki","d975b1fdd8e547deec428b581ec0c2b11e56fa47","aknuds1","2020-05-08 14:22:12","true","Fix spelling of per second (#2055)

Signed-off-by: Arve Knudsen <arve.knudsen@gmail.com>",115,25,0,0,"2018-04-16 10:25:39","752.66"
"grafana/loki","652e216a851ce74bee1d502a67e3b7c92190fa82","trevorwhitney","2022-12-02 21:42:57","true","[helm] Bump helm Loki and GEL version (#7760)

**What this PR does / why we need it**:

Bumps Loki to 2.7.0 and GEL to 1.6.0 in the helm chart.",94,55,1,1,"2018-04-16 10:25:39","1687.47"
"grafana/loki","c83b6c543d4abd86539490c4b9e3fae869e9cffc","trevorwhitney","2022-08-29 14:36:03","true","Helm: Add helm ci (#6988)

Tests Helm chart when changed as part of PR CI process.",80,52,1,1,"2018-04-16 10:25:39","1594.17"
"grafana/loki","7ccec83926d090c69b23e9e98eae123ac48145bb","slim-bean","2023-10-09 14:53:00","true","Index gateway simple mode connection pool (#10783)

**What this PR does / why we need it**:

The current implementation of ""simple mode"" (which does not use the ring
for gateway discovery) only makes a single connection at startup to a
single query. This doesn't lend to the best load balancing when running
with many gateways.

This PR introduces the same pool we use for ring mode with a DNS based
discovery mechanism.

Note: outside of the scope of this PR, we create a connection pool per
index schema period. This isn't really a problem but I think it would be
better to revisit this some day to only have a single connection pool
per querier.

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

---------

Signed-off-by: Edward Welch <edward.welch@grafana.com>
Co-authored-by: J Stickler <julie.stickler@grafana.com>
Co-authored-by: Poyzan <31743851+poyzannur@users.noreply.github.com>",24,66,1,1,"2018-04-16 10:25:39","1999.44"
"grafana/loki","3789f1717cc04a45cebbae77cb74a69ffdcb9146","jeschkies","2023-08-24 10:57:51","true","Set buckets for querier_wait_seconds histogram. (#10334)

**What this PR does / why we need it**:
We should set buckets for the `querier_wait_seconds` histogram.

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",50,64,1,1,"2018-04-16 10:25:39","1954.27"
"grafana/loki","8994eca7e5c554b7109502b5c5fd2c217e65cb29","fourstepper","2022-04-11 12:42:08","true","fix: adopters link for Heureka Group (#5862)",322,48,0,0,"2018-04-16 10:25:39","1450.84"
"grafana/loki","dd76bf4c655710dcd36290bc6049df60f516aea2","jiachengxu","2022-03-04 06:31:25","true","loki mixin: use labels selector for loki chunks dashboard (#5535)

Signed-off-by: Jiacheng Xu <jiachengxu@users.noreply.github.com>

Co-authored-by: Jiacheng Xu <jiachengxu@users.noreply.github.com>",297,46,0,0,"2018-04-16 10:25:39","1413.59"
"grafana/loki","d5d4e33d95b639cabc0d7351693544da7a58c618","slim-bean","2019-05-15 16:54:20","false","updating README",100,13,0,1,"2018-04-16 10:25:39","394.52"
"grafana/loki","91299ab729900ea8f90038d6666278b52405638b","hervenicol","2022-10-11 22:42:34","true","[helm loki] add support for custom analytics config (#7262)

**What this PR does / why we need it**:
I want to disable usage reporting to Grafana. On clusters that don't
have access to Internet it generates error logs.
And without this patch, the only way is to have the whole `loki.config`
section in my custom values file.

**Checklist**
- [x] Reviewed the `CONTRIBUTING.md` guide
- [x] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

Co-authored-by: Herve Nicol <12008875+hervenicol@users.noreply.github.com>",90,54,1,0,"2018-04-16 10:25:39","1636.51"
"grafana/loki","375daaee992afb4e59ce18a4a4e8cf92c0084ff1","slim-bean","2020-04-01 16:56:09","true","fixing release date

Signed-off-by: Edward Welch <edward.welch@grafana.com>",121,23,0,1,"2018-04-16 10:25:39","710.52"
"grafana/loki","ef97c1df2fc2725b127007c3b5fa5cd80c7456fc","jpinsonneau","2022-09-12 12:17:53","true","operator: Add network tenant for netobserv (#6769)",85,53,1,0,"2018-04-16 10:25:39","1607.08"
"grafana/loki","93b07f7a6f5c1cb2bf4d8cffefd91444c58f2040","MichelHollands","2023-07-26 13:45:05","true","Fix docs script and recreate reference (#10072)

**What this PR does / why we need it**:
The changes to the helm docs in PR
https://github.com/grafana/loki/pull/9974 missed out a corresponding
change needed in `docs/Makefile`. The reference.md file was also
regenerated so it's up to date now.

**Which issue(s) this PR fixes**:
Fixes #10069

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [X] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

Signed-off-by: Michel Hollands <michel.hollands@gmail.com>",54,63,1,1,"2018-04-16 10:25:39","1926.39"
"grafana/loki","e89c30ce6badcfa15cf435ebf86bc98ca71f4a42","MasslessParticle","2022-10-06 19:17:18","true","Fix Flaky Integration Tests (#7360)

Allow the OS kernel to decide what's an open port instead of trying to
guess",92,54,1,1,"2018-04-16 10:25:39","1631.37"
"grafana/loki","681ca6da7983506628964409f91359c6dbabdd80","periklis","2021-12-16 14:33:35","false","Prune ViaQ references from documentation resources",233,44,0,1,"2018-04-16 10:25:39","1335.92"
"grafana/loki","863408684cf2aa3e9f3f184a066c630e95dba7ff","3JIou-home","2022-01-27 15:25:30","true","Push: add deflate compression in post requests (#5249)

* deflate-compression-5247 - add deflate compression in post requests

* deflate-compression-5247 - add deflate tests by example gzip",276,45,0,0,"2018-04-16 10:25:39","1376.96"
"grafana/loki","0f139e2cb35daa9e56f8e0bbdaca472dbf802201","ssncferreira","2022-12-27 11:13:15","true","Update log queries regex documentation (#8002)

**What this PR does / why we need it**:

Update log queries regex documentation with a clarification on the
difference between the newline character in:
* label matching operator: `.*` does not match newlines
* line filter expressions: `.*` matches newlines

**Checklist**
- [x] Documentation updated",98,56,1,0,"2018-04-16 10:25:39","1712.03"
"grafana/loki","1db560fdc12160665152e83656535255cbf6678b","dannykopping","2023-06-08 12:19:58","true","Adding background cache (en|de)queue counters (#9665)

**What this PR does / why we need it**:
The background writeback cache exposes gauge metric currently for the
current queue size. Gauges can be useful, but they are susceptible to
sample errors because they only represent the point in time as the time
of the scrape.

Exposing counters for the bytes (en|de)queued to/from the cache will be
more useful because they can be aggregated.

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",68,62,1,1,"2018-04-16 10:25:39","1878.33"
"grafana/loki","11a0d28b611f834c81eee206e26a66b057e443a2","KMiller-Grafana","2021-08-31 14:02:25","true","Docs: first draft, Loki accepts out-of-order writes (#4237)

* Docs: first draft, Loki accepts out-of-order writes

* Update docs/sources/architecture/_index.md

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>",130,40,0,0,"2018-04-16 10:25:39","1230.9"
"grafana/loki","d88d20e44fa8143da98773b28ce1e24fe9166bdf","liguozhong","2022-01-24 14:38:06","true","[instrument] cache: add tracing instrumentation when error !=nil (#5202)",273,45,0,1,"2018-04-16 10:25:39","1373.93"
"grafana/loki","435c055488df2bc2404cfd3e994c72ddebc60854","liguozhong","2022-10-13 12:08:56","true","log panic full stack in boltdb recover block (#7410)",94,54,1,1,"2018-04-16 10:25:39","1638.07"
"grafana/loki","586b9042c637f01a977765cc72de0e2c66e60ca9","shantanualsi","2023-08-28 09:39:06","true","Upgrade Thanos objstore, dskit and other modules (#10366)

**What this PR does / why we need it**:
Upgrades various common modules including dskit, thanos objstore,
prometheus, etc. Fixes errors/ changes resulting due to module upgrades.

This is required in order to eventually upgrade BEL dependency in GEL to
point to master.

**Which issue(s) this PR fixes**:
None

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",49,64,1,0,"2018-04-16 10:25:39","1958.22"
"grafana/loki","e313d8a873f92c4095ac633abd61b239cd1dd134","MasslessParticle","2022-05-24 14:35:04","true","Remove __name__ from label calls (#6229)",73,49,0,1,"2018-04-16 10:25:39","1499.17"
"grafana/loki","bf2e712b32f4e8975d8c81ce27a5e6149c775ba8","trevorwhitney","2023-04-04 06:43:17","true","I do not think we have circleci jobs anymore (#9002)",80,59,1,1,"2018-04-16 10:25:39","1808.85"
"grafana/loki","db97058a84ee0e661314bee317d65f7f4293b465","MasslessParticle","2023-06-14 19:28:51","true","Series volume endpoint (#9704)

This changes the `label_volume` endpoint to the `series_volume`
endpoint. The new endpoint still returns volumes but now it does it for
the requested streams defined by the selector names passed rather than
individual labels. All relevant non-requested labels are aggregated into
the returned results

ex: Assume we have the following streams:
```
{cluster=""prod"", team=""A"", component=""foo""}
{cluster=""prod"", team=""B"", component=""foo""}
{cluster=""dev"", team=""A"", component=""foo""}
{cluster=""dev"", team=""B"", component=""foo""}
```

- requesting `{cluster=""prod""}` returns one result for all streams
containing `{cluster=""prod""}`
- requesting `{cluster=~"".+""}` returns two results for the streams
containing `{cluster=""prod""}` and `{cluster=""dev""}`
- requesting `{cluster=~"".+"", team="".+""}` returns four results for the
streams containing:
```
{cluster=""prod"", team=""A""}
{cluster=""prod"", team=""B""}
{cluster=""dev"", team=""A""}
{cluster=""dev"", team=""B""}
```

---------

Co-authored-by: Trevor Whitney <trevorjwhitney@gmail.com>",64,62,1,1,"2018-04-16 10:25:39","1884.63"
"grafana/loki","a4ef06890b5cc065e3507f7609ed3a0411a605b3","MasslessParticle","2023-05-23 23:06:52","true","revert count unflused chunks (#9504)

revert this commit:
https://github.com/grafana/loki/commit/aeba51ab0fe785ab251eaf8d7005f203ece0986f

We seem to be dramatically overcounting bytes now which is causing
oversharding

This is the same query before and after:

Before: ~20 GB
![image
(2)](https://github.com/grafana/loki/assets/1413241/6d0e3d4d-56ce-40aa-b57e-d2dd592eefb4)

After: ~8 EB
![image
(1)](https://github.com/grafana/loki/assets/1413241/f07cca10-0e32-467f-bf96-13a83eea8ce6)",67,61,1,1,"2018-04-16 10:25:39","1863.78"
"grafana/loki","efda5b2af7bf67a0eda76c1fff7c86862e0b24fb","MasslessParticle","2022-06-13 15:56:51","true","Don't interupt the query path if deletes aren't available (#6368)",67,50,0,1,"2018-04-16 10:25:39","1518.23"
"grafana/loki","32320736dbe968336518d5a53cfd04f59750e381","JStickler","2023-06-16 16:37:54","true","TOC Sync: Move files under Get Started. (#9717)

**Which issue(s) this PR fixes**:
Fixes #8711 

**Special notes for your reviewer**:
Part of the Database products table of contents alignment project.
Moves Getting Started and Fundamentals files under Get Started in TOC.
Updates front matter for the topic (headings, page weights,
descriptions, aliases to redirect from old URL to new URL)
Fixes links broken by the move.",59,62,1,0,"2018-04-16 10:25:39","1886.51"
"grafana/loki","08ac4f689b658c4f6cb84b3fbfa56fbd89a9d9da","Red-GV","2023-02-15 17:14:28","true","operator: Update Promtail and LogCLI addons to v2.7.3 (#8536)",74,58,1,1,"2018-04-16 10:25:39","1760.28"
"grafana/loki","f184c5db51b0eff78a97472c7550acea9fa2f53f","isimluk","2023-09-18 18:09:44","true","docs: master tag hasn't been pushed for almost 2 years (#10633)",39,65,1,0,"2018-04-16 10:25:39","1978.57"
"grafana/loki","f2de97c8808c40d49f2aeff95e62548b53c78fca","gouthamve","2018-12-10 17:05:40","false","Add external labels support (#43)

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>",11,8,0,0,"2018-04-16 10:25:39","234.28"
"grafana/loki","55756ec531f3109f04495463ae315108758ef311","paul1r","2023-10-12 15:58:23","true","Changes and updates to bloom-tester code (#10877)

**What this PR does / why we need it**:

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",24,66,1,0,"2018-04-16 10:25:39","2002.48"
"grafana/loki","eaf7f34f495195e5c8a938bd4d346c907db6b629","wujunwei","2022-09-07 07:46:22","true","bugfix:add cases.NoLower option (#7052)

<!--  Thanks for sending a pull request!  Before submitting:

1. Read our CONTRIBUTING.md guide
2. Name your PR as `<Feature Area>: Describe your change`.
a. Do not end the title with punctuation. It will be added in the
changelog.
b. Start with an imperative verb. Example: Fix the latency between
System A and System B.
  c. Use sentence case, not title case.
d. Use a complete phrase or sentence. The PR title will appear in a
changelog, so help other people understand what your change will be.
3. Rebase your PR if it gets out of sync with main
-->

**What this PR does / why we need it**:
see #7048 
if we don't apply cases.NoLower, it will upper first alphabet lower the
others
```go
package main

import (
	""fmt""
	""golang.org/x/text/cases""
	""golang.org/x/text/language""
	""strings""
)

func main() {
	source := ""testAPI""
	fmt.Println(cases.Title(language.Und).String(source)) // out: Testapi
	fmt.Println(cases.Title(language.Und, cases.NoLower).String(source)) // out: TestAPI
	fmt.Println(strings.Title(source)) // out: TestAPI
}
```
**Which issue(s) this PR fixes**:


**Special notes for your reviewer**:

<!--
Note about CHANGELOG entries, if a change adds:
* an important feature
* fixes an issue present in a previous release, 
* causes a change in operation that would be useful for an operator of
Loki to know
then please add a CHANGELOG entry.

For documentation changes, build changes, simple fixes etc please skip
this step. We are attempting to curate a changelog of the most relevant
and important changes to be easier to ingest by end users of Loki.

Note about the upgrade guide, if this changes:
* default configuration values
* metric names or label names
* changes existing log lines such as the metrics.go query output line
* configuration parameters 
* anything to do with any API
* any other change that would require special attention or extra steps
to upgrade
Please document clearly what changed AND what needs to be done in the
upgrade guide.
-->
**Checklist**
- [ ] Documentation added
- [ ] Tests updated
- [ ] Is this an important fix or new feature? Add an entry in the
`CHANGELOG.md`.
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

Signed-off-by: wujw39640 <wujw39640@hundsun.com>
Signed-off-by: wujunwei <wjw3323@live.com>
Co-authored-by: wujw39640 <wujw39640@hundsun.com>",85,53,1,0,"2018-04-16 10:25:39","1601.89"
"grafana/loki","e5d0be9d27aeee1a2bb08a8f88a61e295042859f","tomwilkie","2018-05-16 10:38:50","false","Update for dependancies.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",0,1,0,0,"2018-04-16 10:25:39","30.01"
"grafana/loki","44cd1a781314977211aed45c7f357d052382edba","tomwilkie","2018-04-17 13:38:11","false","Add readme.",0,0,0,0,"2018-04-16 10:25:39","1.13"
"grafana/loki","1a7b170cdbda27e17719a22a900136e5caf6ecef","chaudum","2022-03-25 13:55:25","true","Update Fluent Bit docs (#5402)

* Change links to fluentbit.io website

The documentation for the Fluent Bit Loki output plugin references the
fluentbit.io website multiple times. However, the structure of this
website seems to have changed. This commit updates the links to the
correct URLs (if possible).

Additionally, renamed occurences of ""fluentbit"" to ""Fluent Bit"", which
seems to be the correct spelling of the product according to their
website.

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* Remove trailing commas from JSON code blocks

Trailing commands are syntactically not allowed in JSON.

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* Apply suggestions from code review

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>",310,47,0,1,"2018-04-16 10:25:39","1434.9"
"grafana/loki","acb40ed40eb37808336eceb2e571b087887fe6c1","owen-d","2023-04-04 15:57:56","true","Eager stream merge (#8968)

This PR introduces a specialized heap based datastructure to merge
incoming log results in the frontend. Recently we've experienced an
increase in OOMs on frontends due to logs queries which match lots of
data. Sharded requests in loki split based on the amount of data we
expect and some queries see thousands of sub requests. For log queries,
we'll fetch up the `limit` from each shard, return them to the frontend,
and merge. High shard counts * limit log lines, especially combined with
large log lines (in byte terms) are accumulated on the frontend. Once
they all are received, the frontend merges them. This creates
opportunity for OOMs as it can hold up a lot of memory.

This PR addresses one of these problems by eagerly accumulating
responses as they're received and only retaining a total `limit` number
of entries. There's still OOM potential due to race conditions between
sub requests returning to the query-frontend and the query-frontend
merging other sub requests, but this definitely improves the situation.
I've been able to consistently run large limited queries that touch TBs
of data (i.e. `{cluster=~"".+""} |= ""a""`) that previously OOMed frontends.

---------

Signed-off-by: Owen Diehl <ow.diehl@gmail.com>",81,59,1,1,"2018-04-16 10:25:39","1809.23"
"grafana/loki","79b2d019706130ce97525ad817f27e1bb5a51cd2","ssncferreira","2022-06-29 07:59:22","true","Add label_replace and literal expressions to instant query split by range (#6515)

* Add label_replace logic to instant query split by range

* Add label_replace and literal expressions support
* Support binary operations with literal expressions

* Remove Literal expression as splittable

* Fix lint

* Address comments",74,50,0,0,"2018-04-16 10:25:39","1533.9"
"grafana/loki","84c97ce43bd929f70613e792a046c9c1e177f3d8","owen-d","2022-03-04 08:19:05","true","Revert ""metrics: Add `user` label to `worker_inflight_queries` (#5485)"" (#5534)

This reverts commit 45d5f28e67b156c84d412c36c2ffd2f082303dfe.",297,46,0,1,"2018-04-16 10:25:39","1413.66"
"grafana/loki","70e87256d6854538188f404a80e19aa288a9297d","cyriltovena","2021-02-26 16:11:58","true","Add finalizer to zstd. (#3306)

Fixes #3305

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",134,34,0,1,"2018-04-16 10:25:39","1040.74"
"grafana/loki","cfaf89bdad5ce9657428fc6366b4237dfdf93f8b","MrSaints","2020-01-27 13:34:54","false","Fix typo in changelog for 1.3.0 (#1586)

The last release was in December 2019.
1.3.0 was released in January 2020, not 2019.",100,21,0,0,"2018-04-16 10:25:39","646.38"
"grafana/loki","e7fb10f4567f191a8dbc2344b1e62c8072dd695e","pracucci","2022-07-08 16:25:51","true","Loki: Update `grafana/dskit` and `weaveworks/common` (#6643)

* Upgrade dskit and weaveworks/common

Signed-off-by: Marco Pracucci <marco@pracucci.com>

* 'go mod vendor' again

Signed-off-by: Marco Pracucci <marco@pracucci.com>",69,51,0,0,"2018-04-16 10:25:39","1543.25"
"grafana/loki","96237b5550495d8fc957543f7642d7deff98b338","pracucci","2019-10-02 19:08:09","false","logcli: added --step support to query command (#1103)

* logcli: added --step support to query command

* Changed query range API default step value from 1s to a dynamic value based on start/end input params",77,17,0,0,"2018-04-16 10:25:39","531.61"
"grafana/loki","5e0fe09f697e7eda0a2fea451eb72c80f7643500","adityacs","2020-05-27 13:47:55","true","Fix configuration docs (#2139)",122,25,0,1,"2018-04-16 10:25:39","771.64"
"grafana/loki","c681c76cc85348438a03f3e09661ac6aa59d7c7c","slim-bean","2019-04-16 00:03:19","false","periodically clean up positions file, removing any files which no longer exist",100,12,0,1,"2018-04-16 10:25:39","359.57"
"grafana/loki","43ae1db14c4f8bc5aeccb8a2db7887189f97f111","jeschkies","2023-03-29 15:45:37","true","Give examples for all cache configurations. (#8832)

**What this PR does / why we need it**:
#8373 documented how to setup Memcached for caching. The documentation
is missing some information on a few caches. These are added in this PR.

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

---------

Co-authored-by: J Stickler <julie.stickler@grafana.com>",84,59,1,1,"2018-04-16 10:25:39","1804.22"
"grafana/loki","d60b6f54406a7c265e2f5249e76844079e00f2b0","slim-bean","2019-05-31 18:33:18","false","PR feedback",109,13,0,1,"2018-04-16 10:25:39","410.59"
"grafana/loki","757eeacb884fbe01863b3f7e7758a07365ce00ff","cstyan","2021-08-20 16:24:51","true","[ingester/stream]: Add a byte stream rate limit. (#4191)

* Add a byte stream rate limit.

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* Track discarded lines due to stream rate limit + use ByteSize for the
config value.

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* Address review comments

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* Another round of review fixes.

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* Fix goimports issue.

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* Fix duplicate flag registration + stream rate limit test.

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* Fix stream rate/burst limit flags yaml naming.

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* Fix tests now that we have stream rate limit.

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* fix some comments

Signed-off-by: Callum Styan <callumstyan@gmail.com>",133,40,0,1,"2018-04-16 10:25:39","1220"
"grafana/loki","27395519becfc6cbd90e78de4b148eb1c38e84e5","obitech","2019-11-12 20:25:45","false","Fix promtail releases download link",68,19,0,0,"2018-04-16 10:25:39","571.67"
"grafana/loki","b88aa08d899da68dfb7970ea4673034cec085a05","bilbof","2023-03-31 17:12:30","true","Loki Canary: Enable insecure-skip-verify for all requests (#8869)

**What this PR does / why we need it**:

This supports cases where the cert cannot be trusted but we are not
using mTLS, i.e. `loki-canary -tls=true -insecure=true`

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",81,59,1,0,"2018-04-16 10:25:39","1806.28"
"grafana/loki","ce91076dd4cb6016f1f39b7a5126c2fd88a8b18e","salvacorts","2023-07-18 06:37:47","true","Add non-indexed metadata to chunks (#9700)

**What this PR does / why we need it**:
In https://github.com/grafana/loki/pull/9694 we support adding metadata
labels for each entry in the push payload. In this PR we take that
metadata and add it to the entries in the chunk. Supporting
serialization and deserialization of those metadata labels.

---------

Signed-off-by: Vladyslav Diachenko <vlad.diachenko@grafana.com>
Co-authored-by: Vladyslav Diachenko <vlad.diachenko@grafana.com>",57,63,1,1,"2018-04-16 10:25:39","1918.09"
"grafana/loki","375fc86af7595e2ec83d46d5482172c1bb69abf0","cyriltovena","2020-02-05 14:55:00","true","Fixes stats summary computation. (#1636)

* Fixes stats summary computation.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes division by zero

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",109,22,0,1,"2018-04-16 10:25:39","654.44"
"grafana/loki","5d75b6abd107bb009b73339b53df7b2650ef1127","nicknezis","2019-03-08 17:04:11","false","Updated with cleaner toYaml Helm logic",91,11,0,0,"2018-04-16 10:25:39","322.28"
"grafana/loki","a50cac767416b37bc25fd181a41dccc5b0f48d95","bboreham","2022-02-07 07:43:52","true","filters: use faster regexp package (#5315)

* regexp-filter: improve benchmark

Add a few more cases based on real-world usage.

Also simplify the loop to just run the number of times requested.
Go benchmarks run 'N' times to reach a duration, default 1 second.
Previously the benchmark was running N*1000000 times, which
took 7 seconds minimum for some cases.

* regexp filter: use modified package with optimisations

See https://github.com/grafana/regexp/tree/speedup#readme

Includes the following changes proposed upstream:
* [regexp: allow patterns with no alternates to be one-pass](https://go-review.googlesource.com/c/go/+/353711)
* [regexp: speed up onepass prefix check](https://go-review.googlesource.com/c/go/+/354909)
* [regexp: handle prefix string with fold-case](https://go-review.googlesource.com/c/go/+/358756)
* [regexp: avoid copying each instruction executed](https://go-review.googlesource.com/c/go/+/355789)
* [regexp: allow prefix string anchored at beginning](https://go-review.googlesource.com/c/go/+/377294)

* Add grafana/regexp to vendor directory",277,46,0,0,"2018-04-16 10:25:39","1386.64"
"grafana/loki","74ee19c39ccf3e528e879a0ad741cb7f55db6d41","oddlittlebird","2021-05-17 07:33:32","true","Update CODEOWNERS (#3722)",195,37,0,0,"2018-04-16 10:25:39","1126.63"
"grafana/loki","f17e55030a92939f6e135ea61aa0154c84fab050","chaudum","2023-09-14 19:42:48","true","Reflect release 2.9.1 on main branch (#10597)

**What this PR does / why we need it**:

Reflect Loki 2.9.1 release on main branch to be up-to-date with latest released version.

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",42,65,1,1,"2018-04-16 10:25:39","1974.64"
"grafana/loki","1036f00a5a24240cf1d797da6d2e9e5892fcffe8","owen-d","2021-02-22 13:26:17","true","Libsonnet/better sharding parallelism defaults (#3357)

* increases read path parallelism limits to be in line with global parallelism controls.

* noop: shard-factor -> 16 when sharding disabled

* 2048 sharded queue size",132,34,0,1,"2018-04-16 10:25:39","1036.63"
"grafana/loki","c795565ef7de100045374d75eb92476e06a5f591","kavirajk","2023-08-02 12:52:59","true","chore(dependabot): Change event type to `pull_request`. (#10144)

**What this PR does / why we need it**:
We are still facing permission error in enabling auto-merge for
dependabot PRs example:
https://github.com/grafana/loki/actions/runs/5737803871/job/15550129786?pr=10138

After discussing it with internal security team, they asked to try
changing the event type from `pull_request_target` -> `pull_request`.

Personally, I suspect this would make any difference, given It worked
with `pull_request_target` when testing it with my personal repo.

https://github.com/kavirajk/dependabot-play/blob/main/.github/workflows/dependabot_reviewer.yml#L5

Auto-merged PR.
https://github.com/kavirajk/dependabot-play/pull/15

But still wanted to test this.
**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",52,63,1,1,"2018-04-16 10:25:39","1932.35"
"grafana/loki","86461b3faa9e6eb10f1e15fac437a78fab66ae0a","kavirajk","2023-01-19 09:54:32","true","promtail: Add doc for `max-line-size` flag. (#8202)

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

**What this PR does / why we need it**:
Follow up from #8153

Changes:
* Change type of the flag from `int` to `flagext.ByteSize` (to be
consistent with similar flag in `distributor`)
* Add doc to promtail config page
* Fix changelog entries

**Which issue(s) this PR fixes**:
Fixes #NA

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [x] `CHANGELOG.md` updated

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",84,57,1,1,"2018-04-16 10:25:39","1733.98"
"grafana/loki","475560ba13f25890230eb6caa4f32e054095be98","KMiller-Grafana","2021-06-22 13:15:47","true","Corrected capitalization and formatting of ""Promtail"" (#3860)",104,38,0,0,"2018-04-16 10:25:39","1161.87"
"grafana/loki","c4ebfd3020c698a747776a9934deb35bed9c6aed","KMiller-Grafana","2022-04-28 20:15:46","true","Docs: revise getting started guide (#5939)

* Revise the getting started section

* Docs: revise getting started guide

* Intermediate commit of getting started material.

* Intermediate revision of the getting started guide.

    Add instructions to download, configure, and deploy the test environment.

* Add sample queries and instructions for breaking down the test env

* Revise prose using reviewer comments.

* update to use promtail and flog in the docker compose file

Signed-off-by: Edward Welch <edward.welch@grafana.com>

* Revise guide to put all parts into Docker containers.

* Add README files for examples directory. Revise getting started instructions.

* Address DylanGuedes review comments

* Getting started guide: incorporate suggestions from ssncferreira

Co-authored-by: Edward Welch <edward.welch@grafana.com>",119,48,0,0,"2018-04-16 10:25:39","1473.41"
"grafana/loki","87edab0867931f983004c8b87f6e9a217dbe0188","MichelHollands","2022-01-28 11:37:55","true","Ingester: remove the labelFilter (#5262)

* Remove the labelFilter

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Update changelog

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",275,45,0,1,"2018-04-16 10:25:39","1377.8"
"grafana/loki","f8da0db4bc29230c89377c563eb97596bf6ee018","jeschkies","2023-10-26 13:26:10","true","Initialize the request codec in the module chain. (#11042)

**What this PR does / why we need it**:
For enterprise we must be able to override the Codec that's injected
into the query frontend and the queriers.

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)
- [ ] If the change is deprecating or removing a configuration option,
update the `deprecated-config.yaml` and `deleted-config.yaml` files
respectively in the `tools/deprecated-config-checker` directory. <!--
TODO(salvacorts): Add example PR -->",19,66,1,1,"2018-04-16 10:25:39","2016.38"
"grafana/loki","9d9b05ad408876d51a773ca68f926c0da712259d","DylanGuedes","2023-10-20 17:41:50","true","Bloomgateway: Use RUnlock to unlock RLock instead (#10984)

**What this PR does / why we need it**:
Change `Len()` method to use `RUnlock()` instead, since it was locked
using `RLock()`.",23,66,1,1,"2018-04-16 10:25:39","2010.55"
"grafana/loki","695c5b0f833683d6cb5b69602b3253d3f69a85b9","ashwanthgoli","2023-10-17 08:29:30","true","chore: update examples, docs to use the latest loki version (#10925)

**What this PR does / why we need it**:
- run ./tools/release_update_tags.sh to use v2.9.2
- also updates the release security patch docs to include version
upgrade step

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",23,66,1,0,"2018-04-16 10:25:39","2007.17"
"grafana/loki","769693892883d68c9251481264ab743ea66f910d","trevorwhitney","2023-06-16 19:34:32","true","Update PR template to include add to release notes label (#9691)

**What this PR does / why we need it**:

Includes a checklist option to the PR template about the
`add-to-release-notes` label.

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",58,62,1,1,"2018-04-16 10:25:39","1886.63"
"grafana/loki","11caa492210c201bd0b0272d9187151be647d3e0","trevorwhitney","2022-08-25 21:37:34","true","Support helm migration from current grafana/loki chart (#6958)

<!--  Thanks for sending a pull request!  Before submitting:

1. Read our CONTRIBUTING.md guide
2. Name your PR as `<Feature Area>: Describe your change`.
  a. Do not end the title with punctuation. It will be added in the changelog.
  b. Start with an imperative verb. Example: Fix the latency between System A and System B.
  c. Use sentence case, not title case.
  d. Use a complete phrase or sentence. The PR title will appear in a changelog, so help other people understand what your change will be.
3. Rebase your PR if it gets out of sync with main
-->

**What this PR does / why we need it**:

These are changes to the helm chart and documentation need to migration from the current version of the `grafana/loki` helm chart to the new one in this repo.

The current plan (as outlined in the README) is to support 3 upgrade paths:

1. From the existing `grafana/loki` chart using filesystem storage. This path will result in a single binary deployment using local filesystem storage with the new chart. This PRs includes changes to make sure this path works.
2. ~From the existing `grafana/loki` chart using object storage. This path will result in an SSD deployment with 1 read and 1 write), and has yet to be tested/documented.~ (Edit: I no longer think we need to support this use case)
3. From the existing `grafana/loki-simple-scalable` chart using object storage. This path will result in an SSD reployment with 3 read and 3 write replicas, and has yet to be tested/documented.

By clarifying the three modes, and that single binary will only support a single, filesystem backed instance, it made possible some refactors. For example, the user no longer needs to specify a `deploymentMode`, and we were able to reorganize the templates a bit into a flatter folder structure.

**Checklist**
- [X] Documentation added
- [ ] Tests updated (will do in subsequent PR)
- [ ] Is this an important fix or new feature? Add an entry in the `CHANGELOG.md`.
- [ ] Changes that require user attention or interaction to upgrade are documented in `docs/sources/upgrading/_index.md`

Co-authored-by: Karsten Jeschkies <k@jeschkies.xyz>",82,52,0,1,"2018-04-16 10:25:39","1590.47"
"grafana/loki","a0809e5f273659f00257428d2740f701d574541f","periklis","2021-06-08 07:46:30","true","Fix query path configuration (#60)",201,38,0,1,"2018-04-16 10:25:39","1147.64"
"grafana/loki","23f998a5aa71182ca791612fb2c8165c3a140efb","rfratto","2019-08-19 16:24:10","true","ci: update apt-get before installing deps for rootless step (#914)",108,16,0,1,"2018-04-16 10:25:39","488.5"
"grafana/loki","de83272b2f197d02fcd7046998533485c33681fe","slim-bean","2019-07-09 22:03:34","false","Add support to timestamp stage to parse Unix seconds, milliseconds, and nanosecond timestamps",100,15,0,1,"2018-04-16 10:25:39","448.73"
"grafana/loki","6d8a1843341f5fa196722a4141abbd98191f82b2","MasslessParticle","2023-06-02 16:46:45","true","Revert ""revert count unflused chunks (#9504)"" (#9615)

Now that the bug where huge values is fixed and known not to be this.
Let's readd it.

Original: https://github.com/grafana/loki/pull/9479",69,62,1,1,"2018-04-16 10:25:39","1872.51"
"grafana/loki","d5a86e0ebec0e7ae92d980f4f06ed944143ee04e","chaudum","2022-11-08 16:18:04","false","Bump new version 1.2.19 of fluentd-plugin-grafana-loki

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",85,55,1,1,"2018-04-16 10:25:39","1663.24"
"grafana/loki","55ea89f9fded65b5c8a11dde4649d8b20e8fe296","owen-d","2022-05-06 12:25:14","true","Tsdb/head wal feedback (#6107)

* pr feedback, improved mutex unlocking

* tenant heads use sync.Map

* tenant heads bench

* Revert ""tenant heads use sync.Map""

This reverts commit 64adebc5354f270d8a27333678543a5c83edbefe.

* removes old code the removed TSDBs outside the shipper + minor fixes",75,49,0,1,"2018-04-16 10:25:39","1481.08"
"grafana/loki","de93a1bd541e314f993b79814ebe4296ba516c86","trevorwhitney","2021-06-14 20:51:31","true","Promtail: add consul agent service discovery (#3834)

* working prototype

Signed-off-by: Trevor Whitney <trevorjwhitney@gmail.com>

* update test for new responses and metadata labels

Signed-off-by: Trevor Whitney <trevorjwhitney@gmail.com>

* fix linting issues

Signed-off-by: Trevor Whitney <trevorjwhitney@gmail.com>

* clarify license/copyright/attribution to prometheus code

Signed-off-by: Trevor Whitney <trevorjwhitney@gmail.com>

* undo changes to go.sum when adding consul dep

Signed-off-by: Trevor Whitney <trevorjwhitney@gmail.com>

* add documentation around consul and consulagent scrape configs

Signed-off-by: Trevor Whitney <trevorjwhitney@gmail.com>

* Update docs/sources/clients/promtail/configuration.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* Update docs/sources/clients/promtail/configuration.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* Update docs/sources/clients/promtail/configuration.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* Update docs/sources/clients/promtail/configuration.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* Update docs/sources/clients/promtail/configuration.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* Update docs/sources/clients/promtail/configuration.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* Update docs/sources/clients/promtail/configuration.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* Update docs/sources/clients/promtail/configuration.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* Update docs/sources/clients/promtail/configuration.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* Update docs/sources/clients/promtail/configuration.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

Co-authored-by: Ed Welch <edward.welch@grafana.com>
Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>",119,38,0,1,"2018-04-16 10:25:39","1154.18"
"grafana/loki","67984692efd7d7ba5a0c2ee9657efa6379a94ade","StevenReitsma","2020-07-21 13:22:52","true","Add emptyDir volume type to promtail PSP (#2379)",119,27,0,0,"2018-04-16 10:25:39","825.62"
"grafana/loki","d21c30d260083672146ead0941a5c717907918e4","rfratto","2019-07-26 13:35:33","true","Merge pull request #794 from rfratto/forward-ingester-chunks

ingester: support chunk transfers on ingester shutdown.",100,15,0,1,"2018-04-16 10:25:39","465.38"
"grafana/loki","88372c93cc63369c5d24ac8e4699a0c1ceac32ec","MasslessParticle","2022-03-14 19:44:15","true","Query Filtering -- Querier (#5482)

* Query Filtering -- Querier

- Get deletes from the index gateway and attach them to store and ingester requests

* lint

* Fix test -- sometimes svc is nil

* don't test for delete overlap on each selector

* lint",302,47,0,1,"2018-04-16 10:25:39","1424.14"
"grafana/loki","173e8ea2a43370c57d1739dca7a057f6e29992c1","slim-bean","2019-08-13 16:03:21","true","fix(canary): Fix Flaky Tests (#889)

* make the missing entry lookup synchronous during tests to hopefully avoid races around the entry order and test verifications

* playing around with timings some more to get all tests to pass even on a really slow machine",103,16,0,1,"2018-04-16 10:25:39","482.48"
"grafana/loki","4db3e59a7d6e71ce7d4b66355f5484ca5ed58115","slim-bean","2022-02-22 07:39:10","true","Build: simplify make targets to just run every time (#5411)

* run the make targets regardless of file timestamps and changes, just run them every time.

Signed-off-by: Edward Welch <edward.welch@grafana.com>

* attempt #2

Signed-off-by: Edward Welch <edward.welch@grafana.com>

* don't need GO_FILES anymore

Signed-off-by: Edward Welch <edward.welch@grafana.com>

* remove all the mod=vendor flags required as we transitioned through go versions 13/14/15

Signed-off-by: Edward Welch <edward.welch@grafana.com>

* changing drone deps because check-generated-files removes protos and I guess this all happens in the same place at the same time in drone.

Signed-off-by: Edward Welch <edward.welch@grafana.com>

* fix rebase

Signed-off-by: Edward Welch <edward.welch@grafana.com>",297,46,0,1,"2018-04-16 10:25:39","1401.63"
"grafana/loki","695fa9d7a82b7daa0dd26b78d685690cf379d1b3","MichelHollands","2022-06-29 08:25:42","true","Add client type as label (#6469)

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",72,50,0,1,"2018-04-16 10:25:39","1533.92"
"grafana/loki","6d7422aabf7fa41c7ef527958cb4fda1566384b4","chaudum","2022-03-25 13:58:42","true","Assert that push values tuples consist of string values (#5685)

* Assert that push values tuples consist of string values

This fixes a bug in the parsing of push requests that could allowed users
sending non-string ""log lines"" from clients, such as full JSON objects.

The values were interpreted as strings, even though they weren't,
leading to unexpected log line transformation because the request did
not fail.

Fixes #5645

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* Add changelog entry

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

Co-authored-by: Cyril Tovena <cyril.tovena@gmail.com>",309,47,0,1,"2018-04-16 10:25:39","1434.9"
"grafana/loki","7d01d998e4d09e8a4beec486470939dfb95e0f6e","periklis","2023-05-03 16:18:21","true","operator: Add support for custom tenant topology in rules (#9366)",81,61,1,1,"2018-04-16 10:25:39","1843.49"
"grafana/loki","43f5841d47496f35892a3c860b9bdffdae24969c","unguiculus","2020-09-01 14:50:45","true","Promtail: Fix docker-compose.yaml (#2575)

This adjusts docker-compose.yaml to changes made in #2196.",121,28,0,0,"2018-04-16 10:25:39","865.68"
"grafana/loki","49a6c03c09f1eb98fc46a42e2b8cbc95843a480e","simonswine","2022-08-02 12:06:55","true","Treat version flag at any position (#6827)

The behaviour was changed as part of #6802. This should restore the
previous behaviour and allow the version to be displayed without config
file.",76,51,0,0,"2018-04-16 10:25:39","1567.07"
"grafana/loki","d93b410a93288e7e5a2be32f78ac243afaba5b0b","cyriltovena","2020-07-29 13:32:59","true","Set service values via --set for logstash. (#2415)

As per discussed in #2406.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",125,27,0,1,"2018-04-16 10:25:39","833.63"
"grafana/loki","cc45d70477b8f2c001ae18c5ca5fcf02e542d795","marcosnils","2019-10-02 14:06:48","false","Deploy prometheys from helm chart (#1104)

Add chart values to deploy prometheus locally. 
This disables persistentVolumes as it'd fail if deployed locally",76,17,0,0,"2018-04-16 10:25:39","531.4"
"grafana/loki","47e2c5884f443667e64764f3fc3948f8f11abbb8","hainenber","2023-10-12 13:00:48","true","fix(promtail): prevent panic due to duplicate metric registration after reloaded (#10798)

**What this PR does / why we need it**:
Prevent Promtail panicking after getting reloaded.

**Which issue(s) this PR fixes**:
Fixes #10796 

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

---------

Co-authored-by: Michel Hollands <42814411+MichelHollands@users.noreply.github.com>",26,66,1,0,"2018-04-16 10:25:39","2002.36"
"grafana/loki","beed298549e8a1229051b2227589d73b2b4f8479","dannykopping","2023-08-18 13:38:59","true","Dynamic client-side throttling to avoid object storage rate-limits (GCS only) (#10140)

**What this PR does / why we need it**:
Across the various cloud providers' object storage services, there are
different rate-limits implemented. Rate-limits can be imposed under
multiple conditions, such as server-side scale up (ramping up from low
volume to high, ""local"" limit), reaching some defined upper limit
(""absolute"" limit), etc.

We cannot know apriori when these rate-limits will be imposed, so we
can't set up a client-side limiter to only allow a certain number of
requests through per second. Additionally, that would require global
coordination between queriers - which is difficult.

With the above constraints, I have instead taken inspiration from TCP's
[congestion control
algorithms](https://en.wikipedia.org/wiki/TCP_congestion_control). This
PR implements
[AIMD](https://en.wikipedia.org/wiki/Additive_increase/multiplicative_decrease)
(Additive Increase, Multiplicative Decrease), which is used in the
congestion _avoidance_ phase of congestion control. The default window
size (object store requests per second) is 2000; in other words, we skip
the ""slow start"" phase.

The controller uses the Go
[`rate.Limiter`](https://pkg.go.dev/golang.org/x/time/rate), which
implements the token-bucket algorithm.

To put it simply:
- every successful request widens the window (per second client
rate-limit)
- every rate-limited response reduces the window size by a backoff
factor (0.5 by default, so it will halve)
- when the limit has been reached, the querier will be delayed from
making further requests until tokens are available",50,64,1,1,"2018-04-16 10:25:39","1948.38"
"grafana/loki","a183d6308e330485e60bfe7298bf99952ed3b43e","dannykopping","2023-01-24 12:01:01","true","Only print logger error when required (#8256)",83,57,1,1,"2018-04-16 10:25:39","1739.07"
"grafana/loki","1253d5c1b72fa99ae4b259f4749dd549dbdf890b","cyriltovena","2021-12-22 19:29:35","true","Update _index.md (#4893)",245,44,0,1,"2018-04-16 10:25:39","1342.13"
"grafana/loki","1f6f4337cee64f1ef212bcc46cd6c7f429762ae7","cyriltovena","2019-10-15 12:33:26","true","Add logql filter to match stages and drop capability (#1112)

* Add logql filter to match stages and drop capability

* use const string instead and remove unused value

* Uses action property instead of drop_entries",66,18,0,1,"2018-04-16 10:25:39","544.34"
"grafana/loki","d7f03be2122dc8f798fad5c13068d1e0f45af82d","abferm","2022-05-02 08:13:55","true","Update libsystemd-dev from bullseye-backports for arm32 docker images, fixes (#5938) (#6012)",79,49,0,0,"2018-04-16 10:25:39","1476.91"
"grafana/loki","729bf3fc91e205d2de71775097cd6d5a63df59b0","owen-d","2022-05-06 17:56:47","true","loads previously created TSDBs into shipper on startup (#6117)

* loads previously created TSDBs into shipper on startup

* noopTSDBManager impl

* info logs for initial tsdb loading",74,49,0,1,"2018-04-16 10:25:39","1481.31"
"grafana/loki","c81be6603ebb89b3fab100b30a48780c959af09c","cyriltovena","2020-05-19 14:43:28","true","Fixes unit in stats request log. (#2093)

* Fix unit conversion in stats log.

🤦

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fix the tests because you know ! you know ?

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",117,25,0,1,"2018-04-16 10:25:39","763.68"
"grafana/loki","8dd490d238f555e25fdfdf3cb1ae1422ff573099","slim-bean","2019-04-12 11:53:31","false","beginnings of label extraction pipeline",101,12,0,1,"2018-04-16 10:25:39","356.06"
"grafana/loki","e2842c69c5e089389b697faa792e368f42f84c19","Juneezee","2022-09-23 14:26:15","true","Replace deprecated `io/ioutil` with `io` and `os` packages (#7212)

The `io/ioutil` package has been deprecated in Go 1.16 (See
https://pkg.go.dev/io/ioutil). This PR replaces the existing `io/ioutil`
functions with their new definitions in `io` and `os` packages.

Signed-off-by: Eng Zer Jun <engzerjun@gmail.com>",86,53,1,0,"2018-04-16 10:25:39","1618.17"
"grafana/loki","abd6131bba18db7f3575241c5e6dc4eed879fbc0","MichelHollands","2023-04-19 15:17:37","true","Update prepare shutdown (#9175)

**What this PR does / why we need it**:

This updates the PrepareShutdown method so it supports GET and DELETE
methods as well. This makes it similar to Mimir:
https://github.com/grafana/mimir/pull/4718.
The status is now stored in a local file. A new config setting had to be
added for this file as there is no obvious place to store it.


**Checklist**
- [X] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [X] Documentation added
- [X] Tests updated
- [x] `CHANGELOG.md` updated
- [x] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

---------

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>
Co-authored-by: Dylan Guedes <djmgguedes@gmail.com>",78,60,1,1,"2018-04-16 10:25:39","1829.45"
"grafana/loki","78db3f8d110396f46c433b3a35e00f42e8f10660","vlad-diachenko","2023-02-24 11:56:41","true","Helm chart auto update (#8331)

**What this PR does / why we need it**:
implemented a pipeline that will run on Loki tag that starts with `v`
and will prepare updater config and run updater with prepared config to
update Loki helm chart with the released Loki version.

Example of PR that is generated by this Pipeline :
[here](https://github.com/grafana/loki/pull/8328)",63,58,1,0,"2018-04-16 10:25:39","1769.06"
"grafana/loki","824c65598f3a86de50699ff5e827552c2bb5769b","owen-d","2022-03-08 21:22:11","true","store tsdb bounds (#5582)",303,47,0,1,"2018-04-16 10:25:39","1418.21"
"grafana/loki","dbbadafca2075524870dddb5079ca83562deec37","owen-d","2023-04-18 17:46:15","true","Tsdb/v3 (#9070)

brief: adds page support for chunks within a series. This lets us do a
few optimizations, most notably skipping chunk ranges that don't overlap
with our query bounds. It also allows us to use aggregated stats for
pages when computing `Stats` calls that completely overlap all chunks in
a page.

teaser:
```
pkg: github.com/grafana/loki/pkg/storage/stores/tsdb/index
BenchmarkChunkStats/version_2/2_chunks-10         	10121240	       109.4 ns/op	      24 B/op	       1 allocs/op
BenchmarkChunkStats/version_3/2_chunks-10         	27591069	        43.51 ns/op	       0 B/op	       0 allocs/op
BenchmarkChunkStats/version_2/4_chunks-10         	 9410245	       128.7 ns/op	      24 B/op	       1 allocs/op
BenchmarkChunkStats/version_3/4_chunks-10         	21808070	        54.44 ns/op	       0 B/op	       0 allocs/op
BenchmarkChunkStats/version_2/10_chunks-10        	 6048235	       201.3 ns/op	      24 B/op	       1 allocs/op
BenchmarkChunkStats/version_3/10_chunks-10        	 9517605	       125.1 ns/op	       0 B/op	       0 allocs/op
BenchmarkChunkStats/version_2/100_chunks-10       	 1000000	      1081 ns/op	      24 B/op	       1 allocs/op
BenchmarkChunkStats/version_3/100_chunks-10       	 1669972	       715.4 ns/op	     528 B/op	       3 allocs/op
BenchmarkChunkStats/version_2/1000_chunks-10      	  118125	     10165 ns/op	      24 B/op	       1 allocs/op
BenchmarkChunkStats/version_3/1000_chunks-10      	  570576	      2125 ns/op	    4816 B/op	       6 allocs/op
BenchmarkChunkStats/version_2/10000_chunks-10     	   10000	    117447 ns/op	  123014 B/op	       3 allocs/op
BenchmarkChunkStats/version_3/10000_chunks-10     	   74524	     16225 ns/op	   48601 B/op	       9 allocs/op
BenchmarkChunkStats/version_2/100000_chunks-10    	     842	   1240380 ns/op	 3211679 B/op	      13 allocs/op
BenchmarkChunkStats/version_3/100000_chunks-10    	    8494	    141169 ns/op	  516530 B/op	      13 allocs/op

```

```
pkg: github.com/grafana/loki/pkg/storage/stores/tsdb/index
BenchmarkReadChunks/version_2/2_chunks-10         	13673050	        80.52 ns/op	     172 B/op	       0 allocs/op
BenchmarkReadChunks/version_3/2_chunks-10         	25713412	        64.06 ns/op	     201 B/op	       0 allocs/op
BenchmarkReadChunks/version_2/4_chunks-10         	12302040	        96.56 ns/op	     373 B/op	       0 allocs/op
BenchmarkReadChunks/version_3/4_chunks-10         	20512030	        84.93 ns/op	     346 B/op	       0 allocs/op
BenchmarkReadChunks/version_2/10_chunks-10        	 6974947	       168.7 ns/op	     490 B/op	       0 allocs/op
BenchmarkReadChunks/version_3/10_chunks-10        	 7436360	       161.0 ns/op	     632 B/op	       0 allocs/op
BenchmarkReadChunks/version_2/50_chunks-10        	 2038724	       599.3 ns/op	    2034 B/op	       0 allocs/op
BenchmarkReadChunks/version_3/50_chunks-10        	 2251822	       619.8 ns/op	    1926 B/op	       0 allocs/op
BenchmarkReadChunks/version_2/100_chunks-10       	  946430	      1092 ns/op	    4132 B/op	       0 allocs/op
BenchmarkReadChunks/version_3/100_chunks-10       	 1467297	      1000 ns/op	    3308 B/op	       1 allocs/op
BenchmarkReadChunks/version_2/150_chunks-10       	  674575	      1721 ns/op	    5767 B/op	       0 allocs/op
BenchmarkReadChunks/version_3/150_chunks-10       	 1000000	      1373 ns/op	    6171 B/op	       1 allocs/op
BenchmarkReadChunks/version_2/1000_chunks-10      	  109153	     10554 ns/op	   33063 B/op	       0 allocs/op
BenchmarkReadChunks/version_3/1000_chunks-10      	  158086	      6963 ns/op	   32829 B/op	       1 allocs/op
BenchmarkReadChunks/version_2/10000_chunks-10     	    9043	    114121 ns/op	  345258 B/op	       0 allocs/op
BenchmarkReadChunks/version_3/10000_chunks-10     	   22083	     79896 ns/op	  435493 B/op	       1 allocs/op
BenchmarkReadChunks/version_2/100000_chunks-10    	    1039	   1103621 ns/op	 3479873 B/op	       0 allocs/op
BenchmarkReadChunks/version_3/100000_chunks-10    	    2101	   1155419 ns/op	 4680266 B/op	       1 allocs/op
```

---------

Signed-off-by: Owen Diehl <ow.diehl@gmail.com>",79,60,1,1,"2018-04-16 10:25:39","1828.56"
"grafana/loki","5f0c06ac3aa9ebffe4a2dff9420b38118304ba4c","owen-d","2021-02-09 10:05:23","true","Logql/absent label optimization (#3299)

* absent_over_time does not extract unnecessary labels

* rebase fix",125,34,0,1,"2018-04-16 10:25:39","1023.49"
"grafana/loki","2856780b2f332b8ea6634e1aa657ec295be0bcd0","trevorwhitney","2021-12-21 15:25:02","true","add docker compose example for simple scalable mode (#4876)

* add docker compose expample for simple scalable mode

* add changelog entry

* Update docs/sources/installation/_index.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* Update docs/sources/installation/simple-scalable-docker.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* further clarify docs

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>",244,44,0,1,"2018-04-16 10:25:39","1340.96"
"grafana/loki","a419f9c1c9985f0faf7ed53346ea6daa6a85f6cd","chancez","2021-03-11 17:27:10","true","docs/upgrading: Fix typo (#3478)",154,35,0,0,"2018-04-16 10:25:39","1055.79"
"grafana/loki","b8b24f3129242145c7212adf7bf7bfcdb99b17dd","slim-bean","2020-09-01 14:52:43","true","clone labels when sending them to Handle function for stdin target (#2570)",121,28,0,1,"2018-04-16 10:25:39","865.69"
"grafana/loki","ebb4f483bfdbb803278fdc76dc1c0ff64e22a941","slim-bean","2019-05-01 16:06:48","false","updating tests
adding CRI and Docker format pipeline stage extensions
adding backwards compatibility with current config",100,13,0,1,"2018-04-16 10:25:39","380.49"
"grafana/loki","03dc4e63faa07410c923ce0b6e7910c0f708cb6a","slim-bean","2019-07-18 18:16:30","false","Parse the addr into a URL so we can extract the Host name for use in the TLSConfig (#778)",103,15,0,1,"2018-04-16 10:25:39","457.58"
"grafana/loki","8de21671e4a2c8ea4b62a11f541759f53ab15dcf","slim-bean","2020-07-17 19:38:52","true","add a Pod Disruption Budget for Loki ingesters to limit only 1 unavailable at a time (#2373)",120,27,0,1,"2018-04-16 10:25:39","821.88"
"grafana/loki","a8b94aec3d5d389f39d25da38ab7dc8365563938","cyriltovena","2020-05-11 20:46:36","true","Reverse entry iterator pool (#2064)

* wi

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add tests.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",118,25,0,1,"2018-04-16 10:25:39","755.93"
"grafana/loki","5d8bc6129eba9df85bb8c399ad09f59911d98ab6","cyriltovena","2022-02-17 19:52:43","true","Correctly sets hash value for headblock iterator (#5423)",294,46,0,1,"2018-04-16 10:25:39","1397.14"
"grafana/loki","45dd588d8fe6ae1156bc9d38fefaa7dd9fe45ae3","JordanRushing","2022-05-05 20:59:45","true","Update consistent hash ring docs with new index gateway ring (#6041)

* Update consistent hash ring docs with new index gateway ring

Signed-off-by: JordanRushing <rushing.jordan@gmail.com>

* Update docs/sources/fundamentals/architecture/rings.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>",76,49,0,0,"2018-04-16 10:25:39","1480.44"
"grafana/loki","d50acbebd4f6c5e1b195e7ad8924677cc7b5bff5","gouthamve","2019-05-14 14:10:42","true","fix minor issues with memcached config in ksonnet (#578)

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>",100,13,0,0,"2018-04-16 10:25:39","393.41"
"grafana/loki","ee1091211aca8a7ad5df7dee40a8a9ccebcf1f04","gouthamve","2019-08-02 10:43:16","false","Add comments for tricky code

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>",106,15,0,0,"2018-04-16 10:25:39","471.26"
"grafana/loki","6ea7122777a59cd508fbde0db0cf728ad994b6c9","ukolovda","2021-03-03 13:31:32","true","Distributor: append several tests for http parser. (#3416)",139,34,0,0,"2018-04-16 10:25:39","1047.63"
"grafana/loki","ee31c24044ddf54971d0c96333c64a3b3fca6152","gyrofx","2023-01-23 21:04:25","true","Helm: Add initContainers to write, backend, singleBinary templates (#8236)",83,57,1,0,"2018-04-16 10:25:39","1738.44"
"grafana/loki","2c2f4914f6ebd2eb5dda9657e9a30c8bec57671d","cstyan","2023-01-13 16:40:07","true","[jsonnet] port some common jsonnet for statefulset and ingester creation (#7039)

The mimir team turned a lot of jsonnet deployment code/config into
functions. The functions make common config across
deployments/statefulsets easier, and also creation of new similar but
slightly different deployments/statefulsets of exsting components
simpler as well. For example, it will make zone aware ingester creation
simpler.

The current changeset should (as in I tested it via `tk diff`) result in
no diff for our own environments.

Note that this is just ingester related, there's plenty of other nice
jsonnet things the mimir team is doing that we could also copy.

Signed-off-by: Callum Styan <callumstyan@gmail.com>

Signed-off-by: Callum Styan <callumstyan@gmail.com>",94,57,1,1,"2018-04-16 10:25:39","1728.26"
"grafana/loki","01d63c8ae8bb139d6ed41eee95a2248ed7bc4738","cstyan","2022-03-15 13:05:34","true","[promtail] Refactor promtail client metrics so that we can't have duplicate metrics collected for the lag metric. (#5521)

* Refactor promtail client metrics so that we can't have duplicate metrics
collected for the lag metric.

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* Set up new metrics passing for other client types.

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* Fix lint issues.

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* Update changelog and docs, also rename nested client configs struct to
configs.

Signed-off-by: Callum Styan <callumstyan@gmail.com>

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>",304,47,0,1,"2018-04-16 10:25:39","1424.86"
"grafana/loki","25afc7814b15212e9a40a1f8d99f8eef67c05fc2","periklis","2022-06-29 10:26:09","true","operator: Fix clusterserviceversion description (#6524)",72,50,0,1,"2018-04-16 10:25:39","1534"
"grafana/loki","2d93952929471eb5e6434ebfb719ee89cbc701dd","dannykopping","2023-03-22 06:44:34","true","(chore): remove incorrect cache config preample (#8859)

With the addition of the [config generation
tool](https://github.com/grafana/loki/pull/7916), a comment prefix was
added for all cache types:

`Cache config for index entry writing.`
https://grafana.com/docs/loki/next/configuration/#cache_config

This appears in the description of each cache config option, and is
misleading.",83,59,1,1,"2018-04-16 10:25:39","1796.85"
"grafana/loki","e4f8c1916f9777cf41302b189e654089346ecaff","trevorwhitney","2023-11-08 18:24:55","true","Default build-image target arch to amd64 (#11148)

**What this PR does / why we need it**:

The changes in https://github.com/grafana/loki/pull/11130 broke `make
build-image` and `make build-image-push`. This defaults the target arch
added in #11130 so those make targets still work.",1,67,1,1,"2018-04-16 10:25:39","2028.58"
"grafana/loki","414f6f0d094a8cf0bb81b5ea207870c00aa40101","trevorwhitney","2023-07-26 16:15:03","true","add volume and volume_range docs (#10047)

Add docs for the `volume` and `volume_range` endpoints.

---------

Co-authored-by: J Stickler <julie.stickler@grafana.com>",53,63,1,1,"2018-04-16 10:25:39","1926.49"
"grafana/loki","60ea486a31d18c9533c14cadcea83e4470bec2cc","tomwilkie","2019-01-31 11:39:47","false","Add lines & bytes read to promtail dashboard.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",73,9,0,0,"2018-04-16 10:25:39","285.05"
"grafana/loki","c1bc17e778440441f160f7c5db80c3bfd6ee50e2","gouthamve","2019-04-25 19:10:35","false","fix linting (#514)

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>",96,12,0,0,"2018-04-16 10:25:39","374.61"
"grafana/loki","5a1faa99c276f51bfbcfcd312e2dbf7f5361f034","cosmo0920","2019-03-15 07:34:51","false","Fix unused parameter warning for Fluentd

Signed-off-by: Hiroshi Hatake <cosmo0920.oucc@gmail.com>",93,11,0,0,"2018-04-16 10:25:39","328.88"
"grafana/loki","391984dded129a7afa0118aa5aa70e1ad462f6ed","KMiller-Grafana","2021-07-22 08:38:29","true","Revise portions of the docs LogQL section (#4012)

* Revise portions of the docs LogQL section

* Update query diagram per review request",97,39,0,0,"2018-04-16 10:25:39","1191.68"
"grafana/loki","90f3ddc681fa1cbf40fe0a85cfa28631479bf6f7","daixiang0","2019-03-21 03:32:34","false","Add backoff_config to ksonnet

Signed-off-by: Xiang Dai <764524258@qq.com>",92,11,0,0,"2018-04-16 10:25:39","334.71"
"grafana/loki","de1faa067129a056a8d6072a9ed9137f9ce370ff","MasslessParticle","2022-02-02 22:14:29","true","Fix transitive dependency error (#5308)

* Fix transitive dependency error

- Don't update the gems that come with the logstash image

* ci bump

* ci bump",278,45,0,1,"2018-04-16 10:25:39","1382.24"
"grafana/loki","92fa3e3e5c39b14df54e22f024ae03f2c2be5251","MichelHollands","2023-11-01 10:47:06","true","Remove timeout parameter (#11102)

**What this PR does / why we need it**:

The `helm-extra-args` causes an error with the new version of ct lint.
This change removes the timeout parameter specified in there and adds a
timeout in the CI step configuration.

**Special notes for your reviewer**:

**Checklist**
- [X] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)
- [ ] If the change is deprecating or removing a configuration option,
update the `deprecated-config.yaml` and `deleted-config.yaml` files
respectively in the `tools/deprecated-config-checker` directory.
[Example
PR](https://github.com/grafana/loki/pull/10840/commits/0d4416a4b03739583349934b96f272fb4f685d15)

Signed-off-by: Michel Hollands <michel.hollands@gmail.com>",16,66,1,1,"2018-04-16 10:25:39","2021.26"
"grafana/loki","9ee1d42720f42999dfe4f5dc4dabeb3a0bc46e8b","MichelHollands","2023-07-24 14:18:40","true","Update changelog to include 2.7.6 (#10042)

**What this PR does / why we need it**:
Add the details of the 2.7.6 branch to the changelog

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [X] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

Signed-off-by: Michel Hollands <michel.hollands@gmail.com>",54,63,1,1,"2018-04-16 10:25:39","1924.41"
"grafana/loki","ebf271e64bf54cb11d54a7b1b521528627181ac6","MattiasSegerdahl","2023-05-02 09:38:02","true","Update release-loki-build-image.md (#9322)

**What this PR does / why we need it**:

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",80,61,1,0,"2018-04-16 10:25:39","1842.22"
"grafana/loki","52fa2114df4af9bf0c26b43d535c6c7c4b39438a","chaudum","2022-01-12 13:05:01","true","fluentd: Fix bug that caused lines to be dropped when containing non utf-8 characters (#5107)

* fluentd: Remove non utf-8 characters from log lines

When a log line in hash format contains non UTF-8 characters fluentd
would drop the complete line because it failed to convert the line in
key-value format.

By forcing UTF-8 encoding and replacing non UTF-8 characters with empty
strings the log line will not be dropped but only contain the valid
UTF-8 characters.

Fixes #5099

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* Bump fluent-plugin-grafana-loki to version 1.2.17

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* fixup! fluentd: Remove non utf-8 characters from log lines

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* fixup! fluentd: Remove non utf-8 characters from log lines

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",259,45,0,1,"2018-04-16 10:25:39","1361.86"
"grafana/loki","4d9865acd41ca77931c13febe2f8f73cd4062653","owen-d","2020-11-27 14:42:58","true","Adds WAL support (experimental) (#2981)

* marshalable chunks

* wal record types custom serialization

* proto types for wal checkpoints

* byteswith output unaffected by buffer

* wal & record pool ifcs

* wal record can hold entries from multiple series

* entry pool

* ingester uses noopWal

* removes duplicate argument passing in ingester code. adds ingester config validation & derives chunk encoding.

* segment writing

* [WIP] wal recovery from segments

* replay uses sync.Maps & preserves WAL fingerprints

* in memory wal recovery

* wal segment recovery

* ingester metrics struct

* wal replay locks streamsMtx in instances, adds checkpoint codec

* ingester metrics

* checkpointer

* WAL checkpoint writer

* checkpointwriter can write multiple checkpoints

* reorgs checkpointing

* wires up checkpointwriter to wal

* ingester SeriesIter impl

* wires up ingesterRecoverer to consume checkpoints

* generic recovery fn

* generic recovery fn

* recover from both wal types

* cleans up old tmp checkpoints & allows aborting in flight checkpoints

* wires up wal checkpointing

* more granular wal logging

* fixes off by 1 wal truncation & removes double logging

* adds userID to wal records correctly

* wire chunk encoding tests

* more granular wal metrics

* checkpoint encoding test

* ignores debug bins

* segment replay ignores out of orders

* fixes bug between WAL reading []byte validity and proto unmarshalling refs

* conf validations, removes comments

* flush on shutdown config

* POST /ingester/shutdown

* renames flush on shutdown

* wal & checkpoint use same segment size

* writes entries to wal regardless of tailers

* makes wal checkpoing duration default to 5m

* recovery metrics

* encodes headchunks separately for wal purposes

* merge upstream

* linting

* addresses pr feedback

uses entry pool in stream push/tailer

removes unnecessary pool interaction

checkpointbytes comment

fillchunk helper, record resetting in tests via pool

redundant comment

defers wg done in recovery

s/num/count/

checkpoint wal uses a logger

encodeWithTypeHeader now creates its own []byte

removes pool from decodeEntries

wal stop can error

* prevent shared access bug with tailers and entry pool

* removes stream push entry pool optimization",120,31,0,1,"2018-04-16 10:25:39","951.68"
"grafana/loki","a69a83095cbefbf0ab330216ae580e9d7084f016","eamonryan","2020-06-01 12:52:49","true","Fix typo in promtail ClusterRole (#2152)

`pod` is not a valid resource in k8s, but `pods` is.",128,25,0,0,"2018-04-16 10:25:39","775.6"
"grafana/loki","b3f1965ff1d4841ed3b3e2297096debc2a5d5d3c","dannykopping","2022-07-14 08:43:31","true","Introduce an ""enable_groupcache"" config to control initialization better (#6673)

* Introduce an ""enable_groupcache"" config to control initialization better

We initialize groupcache as a module, which happens after the config is parsed. A function named applyFIFOCacheConfig is called to enable fifocache if no cache is configured, and at the time of its calling the modules have not been initialized. This new ""enable_groupcache"" value is set if groupcache is configured in common, or this value is set manually. With this setting, we can prevent automatic fifocache settings.

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Add tests

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Simplifying condition

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",71,51,0,1,"2018-04-16 10:25:39","1548.93"
"grafana/loki","764ee7c3bb3c23f87a7c349dfd17908a3634101e","Red-GV","2022-11-10 09:00:27","true","operator: Modify ingestionRate for respective shirt size (#7617)",84,55,1,1,"2018-04-16 10:25:39","1664.94"
"grafana/loki","bc1645034981b0b8fe98fb3ace8e998d0a64d28c","MasslessParticle","2022-09-01 21:19:03","true","Revert ""Hide duplicates caused by stream sharding (#7005)"" (#7031)

@owen-d had a suggestion that was dramatically dimpler. Revert this whole thing and the simplified PR will be forthcoming",81,52,1,1,"2018-04-16 10:25:39","1596.45"
"grafana/loki","de937e72cdb62062424e482fce1c87efc38bd9d9","ashwanthgoli","2023-07-05 08:35:38","true","promtail: apply defaults to HTTP client config (#9863)

**What this PR does / why we need it**:
Apply defaults to HTTPClientConfig and validate it. similar to how it's
done
[here](https://github.com/grafana/loki/blob/e9644d8186174654832e7b6f37a4b4ad34637b0d/vendor/github.com/prometheus/prometheus/config/config.go#L524)
in prometheus.

promtail [configuration
page](https://grafana.com/docs/loki/latest/clients/promtail/configuration/)
incorrectly claims that `follow_redirects` is true, but it is being set
to false given that the defaults are not being applied currently

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [x] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

---------

Signed-off-by: Ashwanth Goli <iamashwanth@gmail.com>
Co-authored-by: Christian Haudum <christian.haudum@gmail.com>",59,63,1,0,"2018-04-16 10:25:39","1905.17"
"grafana/loki","1779d755e187a2fc0156d2b93b1384119b0fad11","JoaoBraveCoding","2023-05-03 11:10:21","true","Add default PodAntiAffinity to Query-Frontend (#9343)

Signed-off-by: Joao Marcal <jmarcal@redhat.com>",81,61,1,0,"2018-04-16 10:25:39","1843.28"
"grafana/loki","c71620ae9437aa23142cdc410115f28ae8f29997","jeschkies","2022-12-14 13:58:03","true","Flush buffered logger on exit. (#7924)

**What this PR does / why we need it**:
I ran into this issue several times. No error logs were printed or no
generated token for GEL. This is because crashing runs can be much
faster than the flush period.

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the `CONTRIBUTING.md` guide
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",101,56,1,1,"2018-04-16 10:25:39","1699.15"
"grafana/loki","d5ec714ae095d1fadbcdff185e99bc252491aadd","slim-bean","2021-10-05 13:35:23","true","Loki: Bug: frontend waiting on results which would never come (#4411)

* We weren't also checking if the context was canceled while waiting for query results leading to goroutines waiting forever for results that would never come...

* return error from context upstream if the context is canceled",136,42,0,1,"2018-04-16 10:25:39","1264.88"
"grafana/loki","81fae24ce2f4b8a94705409ff5310b4b14b0fef1","jeschkies","2023-09-14 15:13:13","true","Return `StepResult` from `StepEvaluator.Next()`. (#10567)

**What this PR does / why we need it**:
This change makes the `StepEvaluator` more flexible for changes like
#10417 that introduce a different step result. With the interface
`StepResult` we can support other vector types in the future.

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [x] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",41,65,1,1,"2018-04-16 10:25:39","1974.45"
"grafana/loki","ff5ce4e129d29a9e2ceb87e13102ba4eb922bca2","jeschkies","2022-06-02 17:15:19","true","Document multi-tenant queries. (#5994)

* Document multi-tenant queries.

* Update docs/sources/operations/multi-tenancy.md

Co-authored-by: Aleksey <a.alexey.lazarev@gmail.com>

* Update docs/sources/operations/multi-tenancy.md

Co-authored-by: JordanRushing <rushing.jordan@gmail.com>

* Update docs/sources/operations/multi-tenancy.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* Update docs/sources/operations/multi-tenancy.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

Co-authored-by: Aleksey <a.alexey.lazarev@gmail.com>
Co-authored-by: JordanRushing <rushing.jordan@gmail.com>
Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>",72,50,0,1,"2018-04-16 10:25:39","1507.28"
"grafana/loki","4384371bc84b93e9455763a278879c73bf521896","slim-bean","2019-09-09 22:22:55","false","use the loki-build-image for calling circle, this is the same as what the circle job we are replacing did",118,17,0,1,"2018-04-16 10:25:39","508.75"
"grafana/loki","63aec06179ae6125f2286f4d72ea70ba28cfdd8a","slim-bean","2019-06-03 20:28:42","false","also restrict the release to master branch only (not sure if this is actually necessary)",109,14,0,1,"2018-04-16 10:25:39","412.67"
"grafana/loki","686d051eeaf3fa5a77e8085887c0dc0a47cbbd3f","grafanabot","2023-09-01 16:23:54","true","[Release Notes Appender] Add PR #8826: feat(storage): add support for IBM cloud object storage as storage client (#10424)

Add PR #8826 to release notes for next release

---------

Co-authored-by: Travis Patterson <travis.patterson@grafana.com>",45,64,1,0,"2018-04-16 10:25:39","1961.5"
"grafana/loki","e2d7ee2cffef0f59f718c39d3a216933d279ce0c","bboreham","2022-04-12 06:48:17","true","GCS: refactor creation of http client (#5838)

Separate the function into one part which creates the RoundTripper and
one which wraps it in instrumentation.",322,48,0,0,"2018-04-16 10:25:39","1451.6"
"grafana/loki","c3d1937eab9480321ba291ad91e94dbf69415206","jtlisi","2021-01-29 12:42:21","true","update vendored cortex and add new replace overrides (#3256)

* update vendored cortex and add new replace overrides

Signed-off-by: Jacob Lisi <jacob.t.lisi@gmail.com>

* update upstream function to new package

Signed-off-by: Jacob Lisi <jacob.t.lisi@gmail.com>

* update all moved functions

Signed-off-by: Jacob Lisi <jacob.t.lisi@gmail.com>

* update math to util_math

Signed-off-by: Jacob Lisi <jacob.t.lisi@gmail.com>",127,33,0,0,"2018-04-16 10:25:39","1013.59"
"grafana/loki","0be191309cae301baba203eeb57d80781f5f1615","ashwanthgoli","2023-10-10 13:58:20","true","config: better defaults for querier max concurrency (#10785)

**What this PR does / why we need it**:
To simply loki configuration, this pr removes
`querier.worker-parallelism` as it does not offer additional value to
already existing `querier.max-concurrent`

Also updates the default value of `querier.max-concurrent` to 4. This is
a better default for users that are just starting out. Users can
consider increasing it as they scale up their loki installation.

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [X] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [X] Documentation added
- [X] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [X] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",25,66,1,0,"2018-04-16 10:25:39","2000.4"
"grafana/loki","f9fc1df4c0e47408e50a5a04d7313a2b9df7af30","ashwanthgoli","2023-06-28 07:21:26","true","logfmt: add --strict flag to enable strict parsing, perform nostrict parsing by default (#9626)

**What this PR does / why we need it**:
Introduces `--strict` flag for logfmt parser to enable strict parsing.
With strict parsing enabled, logfmt parser stops scanning the log line
and returns early with an error if it encounters any poorly formatted
key=value pair.

This pr updates the parser to perform non-strict parsing by default
where it skips over the invalid tokens. This offers the flexibility to
parse semi-structured log lines.

Also adds `--keep-empty` flag to retain standalone keys(with empty
value) as labels with value set to empty string

**Special notes for your reviewer**:

**Checklist**
- [X] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [X] Documentation added
- [X] Tests updated
- [x] `CHANGELOG.md` updated
- [x] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

---------

Co-authored-by: Michel Hollands <42814411+MichelHollands@users.noreply.github.com>",62,62,1,0,"2018-04-16 10:25:39","1898.12"
"grafana/loki","411e4a8ce4b0444864409c6d691e951a5136385e","tomwilkie","2018-06-24 12:43:30","false","Plumb through label value queries.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",1,2,0,0,"2018-04-16 10:25:39","68.1"
"grafana/loki","4b9cc39f9f22846e09c4bd406824409e573bdc78","MasslessParticle","2023-01-24 21:24:04","true","fix remaining docs issues (#8263)",83,57,1,1,"2018-04-16 10:25:39","1739.46"
"grafana/loki","4e6333419b6e773d686364a9580884eb72ffdd73","ashwanthgoli","2023-10-17 15:03:53","true","[release-2.8.x] add release notes for 2.8.6 (#10929)

**What this PR does / why we need it**:

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",21,66,1,0,"2018-04-16 10:25:39","2007.44"
"grafana/loki","125e168a91bf40783fdc27b3ba45e3936760b407","jeschkies","2023-06-29 10:18:56","true","Replace flaky server for log level handler test. (#9822)

**What this PR does / why we need it**:
I've noticed that the `TestLevelHandler` were flaky because the code
wasn't waiting to the server to be running. Since the test is for a
handler it's much simpler to call it directly with a response recorder.

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [x] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",58,62,1,1,"2018-04-16 10:25:39","1899.25"
"grafana/loki","f52ae115fedca9023445022fedd258a26a3d8444","chaudum","2023-02-06 19:09:02","true","Bump version of `fluent-plugin-grafana-loki` to 1.2.20 (#8426)",79,58,1,1,"2018-04-16 10:25:39","1751.36"
"grafana/loki","7c78d7ea44afb420847255f9f5a4f677ad0f47bf","dannykopping","2023-01-16 13:15:43","true","Removing ""replace"" directive for line-buffered logger (#8162)",94,57,1,1,"2018-04-16 10:25:39","1731.12"
"grafana/loki","e9c93cd0f578114ff2af947d0ca1af201827fbf9","sandeepsukhani","2022-12-09 03:50:52","true","consider range and offset in queries while looking for schema config for query sharding (#7880)

**What this PR does / why we need it**:
We disable query sharding when a query touches multiple schema configs
since they might have different sharding factors and might handle
sharding differently. This check was done purely on the start and end
time of the query without considering `range` and `offset`, which would
change the length of the actual data being queried.

Besides being incorrect, it also causes us to fail queries when
migrating between tsdb and non-tsdb stores since both handle query
sharding differently. For e.g., if the prev schema is `boltdb-shipper`
and starting today, `tsdb` index is being used, so if we do a query
`sum(rate({foo=""bar""}[24h])` even with start and end within `tsdb`
range, we will fail the query with error `incompatible index shard` if
dynamic sharding goes with shard factor other than `32`(default shard
factor in ingester for inverted index). The reason being the `range`
here is `24h` which causes us to process data from previous schema as
well.

This PR takes care of the issue by factoring in `range` and `offset` in
the queries while looking for schema config for query sharding.

**Checklist**
- [x] `CHANGELOG.md` updated",96,56,1,1,"2018-04-16 10:25:39","1693.73"
"grafana/loki","32b3f974c610e5ebee0bba20a8b24612ac846d68","osg-grafana","2022-11-02 08:27:18","true","Remove CTA per @grafanawriter. (#7559)",89,54,1,0,"2018-04-16 10:25:39","1656.92"
"grafana/loki","d6f50ca5e172482d3955ab61b5db405ebcc7186c","owen-d","2022-06-16 15:37:41","true","[TSDB] Use index sampling to determine shard factor (#6396)

* use index sampling to determine shard factor

* logging/tracing + better parallelism planning

* queryrange downstreamer now checks max_query_parallelism

* lint

* handles interval, offset in tsdb planning and adds logging

* fixes ns->ms confusion in index stats proto

* handle zero shard value without panics

* shardmapper will downstream a single unsharded query

* uses concat expr with no shards to avoid query parsing errors

* better logging

* fixes wrong Size() method call and rounds to nearest KB when calculating chunk size

* humanize bytes in log line

* only adds defaultLookback to index sampling when interval is zero

* removes comment

* more logging

* adjust through correctly

* adds query length for index queries",67,50,0,1,"2018-04-16 10:25:39","1521.22"
"grafana/loki","0e86bfd5c31f469cfd20afa7beafb13bed3320ad","gouthamve","2019-05-14 06:43:37","true","Add support for memcaches (#564)

* vendor: update cortex

Don't be blocked on https://github.com/cortexproject/cortex/pull/1345 to
be merged and still maintain the fork

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>

* add memcached ksonnet

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>

* commit generated proto

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>",100,13,0,0,"2018-04-16 10:25:39","393.1"
"grafana/loki","9e85757d89a72f556ab42a1b29a102dfd1beda3c","owen-d","2020-09-21 14:38:15","true","adds prometheus ruler routes (#2650)",116,29,0,1,"2018-04-16 10:25:39","885.68"
"grafana/loki","00168b341a134d6d1c5ee65d73ec422383f1fcff","MrWong99","2021-10-12 14:47:06","true","Remove unused variable in fluentd output plugin (#4261)

I couldn't figure out why this variable is there. If I am missing any global variables by fluentd feel free to close this PR without any notice",146,42,0,0,"2018-04-16 10:25:39","1271.93"
"grafana/loki","2392cc3845d9620578fdbc25722fa7cd259345df","daixiang0","2019-01-18 02:12:03","false","cmd/logcli: support load config from file

Signed-off-by: Xiang Dai <764524258@qq.com>",62,9,0,0,"2018-04-16 10:25:39","271.66"
"grafana/loki","afbbc2fc4fb856a6b47aea1a5168fd55f648bd9b","JordanRushing","2021-10-18 19:07:24","true","Add metric prefix changes for chunk store and runtime config to upgrading.md (#4436)",160,42,0,0,"2018-04-16 10:25:39","1278.11"
"grafana/loki","74d206bf286b00a7b0bf9f45d35bf25917316fef","bboreham","2022-10-11 08:42:57","true","chunks: improve readability of compression benchmarks (#7246)

**What this PR does / why we need it**:

### BenchmarkWrite

Use Go runtime facilities to report MB/s for each operation and
compression ratio.

Before:
```
BenchmarkWrite/ordered-none-4               1018           1104885 ns/op         1431962 B/op         33 allocs/op
BenchmarkWrite/ordered-gzip-4                 12          87333201 ns/op         3516699 B/op        696 allocs/op
BenchmarkWrite/ordered-lz4-64k-4              51          21483048 ns/op         3095117 B/op        649 allocs/op
```

After:
```
BenchmarkWrite/ordered-none-4                841           1202007 ns/op        1054353.53 MB/s        101.9 %compressed         1569953 B/op         34 allocs/op
BenchmarkWrite/ordered-gzip-4                 13          86299699 ns/op        3357.25 MB/s             6.891 %compressed       3778896 B/op        702 allocs/op
BenchmarkWrite/ordered-lz4-64k-4              49          22332214 ns/op        34107.61 MB/s            9.880 %compressed       3407522 B/op        661 allocs/op
```

Stop collecting all compressed chunks, as this blows up the memory of
the benchmark and creates unrealistic test conditions for the later
encoding.

Before: `4724260 maxresident KB`; after: `375804 maxresident KB`

### BenchmarkRead

Replace reporting of MB/s which gave several values for each encoding as
Go hunted for the right number of benchmark iterations.

Add stats to the context for decoding, otherwise a new stats object is
created each time round the loop.

Re-order so all unsampled results come before all sampled results.

Before:
```
BenchmarkRead/none_66_kB-4                   278           4555157 ns/op          131744 B/op        717 allocs/op
BenchmarkRead/sample_none_66_kB-4            142           8238861 ns/op          129771 B/op        717 allocs/op
BenchmarkRead/gzip_66_kB-4                     6         179445187 ns/op         2100498 B/op      15010 allocs/op
BenchmarkRead/sample_gzip_66_kB-4              4         261040057 ns/op         2076030 B/op      15028 allocs/op
BenchmarkRead/lz4-64k_66_kB-4                 19          62855240 ns/op         1722979 B/op      14219 allocs/op
BenchmarkRead/sample_lz4-64k_66_kB-4                  10         115577796 ns/op         1706040 B/op      14220 allocs/op
BenchmarkRead/lz4-256k_66_kB-4                        18          66144317 ns/op         1880851 B/op      15078 allocs/op
BenchmarkRead/sample_lz4-256k_66_kB-4                  9         118405993 ns/op         1800396 B/op      15077 allocs/op
BenchmarkRead/lz4-1M_66_kB-4                          18          67832189 ns/op         1821806 B/op      15076 allocs/op
...
none_524 kB: 1828.92 MB/s
none_524 kB: 1809.33 MB/s
none_262 kB: 1790.79 MB/s
none_66 kB: 1673.84 MB/s
...
gzip_66 kB: 647.35 MB/s
...
```

After:
```
BenchmarkRead/none_66_kB-4                   286           4377585 ns/op        1725.23 MB/s       41896 B/op        600 allocs/op
BenchmarkRead/gzip_66_kB-4                     6         180770638 ns/op         655.82 MB/s      723426 B/op      13265 allocs/op
BenchmarkRead/lz4-64k_66_kB-4                 19          65380524 ns/op        1296.10 MB/s      727571 B/op      12925 allocs/op
BenchmarkRead/lz4-256k_66_kB-4                16          63737292 ns/op        1409.75 MB/s      786994 B/op      13707 allocs/op
BenchmarkRead/lz4-1M_66_kB-4                  18          65963825 ns/op        1362.17 MB/s      770441 B/op      13707 allocs/op
BenchmarkRead/lz4_66_kB-4                     18          64955415 ns/op        1383.31 MB/s     1003277 B/op      13707 allocs/op
BenchmarkRead/snappy_66_kB-4                  20          51588959 ns/op        1273.38 MB/s      361872 B/op       5020 allocs/op
BenchmarkRead/flate_66_kB-4                    6         172147502 ns/op         691.74 MB/s      715706 B/op      13242 allocs/op
BenchmarkRead/zstd_66_kB-4                     3         359473273 ns/op         390.07 MB/s    427247248 B/op     18551 allocs/op
...
BenchmarkRead/sample_none_66_kB-4            135           8533283 ns/op         885.04 MB/s       39866 B/op        600 allocs/op
BenchmarkRead/sample_gzip_66_kB-4              5         243016949 ns/op         487.84 MB/s      686358 B/op      13212 allocs/op
BenchmarkRead/sample_lz4-64k_66_kB-4                  10         114330032 ns/op         741.18 MB/s      707104 B/op      12926 allocs/op
BenchmarkRead/sample_lz4-256k_66_kB-4                  9         117294928 ns/op         766.05 MB/s      778461 B/op      13709 allocs/op
...
```

Note ""MB"" in previous code was 2^^20 while Go uses 10^6.

**Checklist**
- [x] Reviewed the `CONTRIBUTING.md` guide
- NA Documentation added
- [x] Tests updated
- NA `CHANGELOG.md` updated - not user-facing
- NA Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",92,54,1,0,"2018-04-16 10:25:39","1635.93"
"grafana/loki","782ffca40931e564d8355bf986c9a236aadfb241","periklis","2023-03-29 10:41:25","true","operator: Add missing replaces directives for release v0.2.0 (#8912)",85,59,1,1,"2018-04-16 10:25:39","1804.01"
"grafana/loki","b1e232c00720ff5a536b0c3d410a721354899e6e","cyriltovena","2019-12-13 15:17:06","false","Adds tenant-id for docker driver. (#1414)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",94,20,0,1,"2018-04-16 10:25:39","602.45"
"grafana/loki","b35bbd80d65f09eb6f1e6ba1bfe05bf4af712a97","jeschkies","2023-06-30 09:40:00","true","Support content negotiation between query frontend and querier. (#9813)

**What this PR does / why we need it**:
Currently, the querier sends results to the query frontend in JSON which
is then decoded to Protobuf. It is more efficient to send the results as
Protobuf.

This will also allow to extend the results with custom data structures.

The change is backwards compatible through content negotiation.

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [x] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",59,62,1,1,"2018-04-16 10:25:39","1900.22"
"grafana/loki","6cc1f315469996712e65b3e9cdaa906b2ca5e7aa","slim-bean","2022-04-07 21:01:20","true","update drone to push images on tagged builds (#5824)

Signed-off-by: Ed Welch <edward.welch@grafana.com>",320,48,0,1,"2018-04-16 10:25:39","1447.19"
"grafana/loki","c4ed0d0b7fcc0701a0c64dccc3af4fe412eadf4d","paul1r","2023-11-08 22:03:37","true","Tokenizer tests and TokenizeLine updates (#11133)

**What this PR does / why we need it**:
The thrust of this PR is to ensure we have tests for each major function
of the Bloom Tokenizer. In addition, there was some cleanup, in that
constants are used to set some common parameters.

Lastly, the TokenizeLine() call was updated to correctly tokenize a line
when a ""skip tokenizer"" is utilized.

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)
- [ ] If the change is deprecating or removing a configuration option,
update the `deprecated-config.yaml` and `deleted-config.yaml` files
respectively in the `tools/deprecated-config-checker` directory.
[Example
PR](https://github.com/grafana/loki/pull/10840/commits/0d4416a4b03739583349934b96f272fb4f685d15)",1,67,1,0,"2018-04-16 10:25:39","2028.73"
"grafana/loki","0d7b6b2622f9bcf5d9d151dc3d25a8c97c3f2039","cstyan","2023-10-26 10:30:00","true","Return empty responses for logproto request types from (#11029)

We need to return empty responses for logproto request types from
NewEmptyResponse based on types that can be returned from DecodeRequest.

---------

Signed-off-by: Callum Styan <callumstyan@gmail.com>",19,66,1,1,"2018-04-16 10:25:39","2016.25"
"grafana/loki","64c6f6b8ccd6350ec655e68e4e13d19bb8de299b","owen-d","2023-05-18 17:14:43","true","Better combines stats in ingesters (#9474)

* Reduces double counting streams when possible
* proportionally add stats based on chunk overlap range
* code reuse",69,61,1,1,"2018-04-16 10:25:39","1858.53"
"grafana/loki","4bffed22e4ab11261604bfe7769efd36ef022750","chaudum","2023-05-12 21:12:59","true","Reuse string/InstanceDesc buffers in index gateway clients (#9341)

**What this PR does / why we need it**:

When running the IndexGateway in ring mode, `ring.MakeBuffersForGet()`
in the index gateway client allocated fixed size
`[]string`/`[]InstanceDesc` slices with a capacity of 5 for each and
every request.
By using a `sync.Pool` the client can reduce the amount of allocations.
Additionally, since we run the index gateway ring with a high
replication factor to be able to scale them better horizontally, an
initial capacity of 5 is most of the time too low, leading to extra
allocations when growing the capacity of the slice.

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

---------

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",72,61,1,1,"2018-04-16 10:25:39","1852.7"
"grafana/loki","ef8b382c064ee8cb0dfb9b77e6387f1fb55185e0","trevorwhitney","2023-02-06 17:25:49","true","[helm] Single binary object storage (#8284)

Co-authored-by: J Stickler <julie.stickler@grafana.com>",80,58,1,1,"2018-04-16 10:25:39","1751.29"
"grafana/loki","da38da201a3e993ce730b007c91652a49ea3ff5b","rfratto","2022-12-04 17:27:36","true","loki-build-image: update faillint (#7841)

faillint needs an update for Go 1.19 where it fails unexpectedly. First
observed in #7826.

See fatih/faillint#36",96,56,1,1,"2018-04-16 10:25:39","1689.29"
"grafana/loki","355175ff890ac2145388c0ae6ba5fcf14fe8dc27","dannykopping","2022-10-05 11:59:59","true","Upgrade to Go 1.19 (#7243)

Upgrade Loki and all related components to Go 1.19.2.",94,54,1,1,"2018-04-16 10:25:39","1630.07"
"grafana/loki","45693b7941deaa8ee02224d0ba236ee8d53d2615","owen-d","2021-08-09 09:12:27","true","stream iterators account for unordered data (#4114)",110,40,0,1,"2018-04-16 10:25:39","1208.7"
"grafana/loki","f0d4adc53dcffe70d70ed41df41b14af44f880fb","chancez","2020-11-11 20:51:47","true","promtail: Add support for using syslog message timestamp (#2914)

Currently promtail sets the timestamp of incoming syslog messages to the
time it was received by promtail. In some cases, it is preferable to use
the source timestamp instead.

This adds a new `use_message_timestamp` option to the syslog target
config, which allows users to opt-in to the behavior of using the
timestamp on the message, if one exists.",129,31,0,0,"2018-04-16 10:25:39","935.93"
"grafana/loki","69f2eb2314eb7afd089b4cc27f7685e1a8e644c5","dvrkps","2020-10-07 13:42:38","true","hack: clean getStore (#2726)",119,30,0,0,"2018-04-16 10:25:39","901.64"
"grafana/loki","fb4b3320201fec102da7f38fd4f40735494a149d","sh0rez","2020-09-03 14:40:04","true","docs: fix broken links (#2595)

Several links were using a path format not understood by Hugo, which
renders these docs at https://grafana.com/docs/loki/latest.

To avoid 404s, these are now adapted.",121,29,0,0,"2018-04-16 10:25:39","867.68"
"grafana/loki","6b9f82d7f97cc89ba93f1f3b6e1c52c3b90492aa","slim-bean","2020-04-02 11:42:42","false","Adding a config change in release 1.4 upgrade doc
Updating readme with links to new docs

Signed-off-by: Edward Welch <edward.welch@grafana.com>",120,23,0,1,"2018-04-16 10:25:39","711.3"
"grafana/loki","d9d5c989ee03c5ca8731b5ddbb53ec1d6899f489","cyriltovena","2020-01-06 14:46:56","true","Update README.md (#1471)",106,21,0,1,"2018-04-16 10:25:39","625.43"
"grafana/loki","bf3740593a280d8b757de302c77ac8a7e0f1994e","granular-ryanbonham","2019-03-08 16:25:03","false","Merge remote-tracking branch 'upstream/master' into helm_timeouts",91,11,0,0,"2018-04-16 10:25:39","322.25"
"grafana/loki","db47e38157b9ed79c0943199b0d8d2eb6be8dcaa","thepalbi","2022-11-02 16:58:11","true","Fix Promtail GCP Logs diagram route (#7577)

**What this PR does / why we need it**:
Some of the latest changes to the GCP Logs Promtial docs include an
architecture diagram. It seems the link to this diagram is broken. This
PR attempts to fix that by removing a relative routing the image tag
path, since the image is deployed in
[here](https://grafana.com/docs/loki/next/clients/promtail/gcp-logs-diagram.png),
but was being fetched in this path:
`https://grafana.com/docs/loki/next/clients/promtail/gcplog-cloud/gcp-logs-diagram.png`.

The img is deployed in the same directory as the site, so should use a
`../` parent directory relative routing, as in
[here](https://github.com/grafana/loki/blob/3d6210e424574ae3b5a9c111a7527f1159645436/docs/sources/clients/promtail/troubleshooting.md#L48).

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the `CONTRIBUTING.md` guide
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",90,54,1,0,"2018-04-16 10:25:39","1657.27"
"grafana/loki","e0a7b28a61e1ef83d62493c52ad1d2a51ba76902","periklis","2022-11-04 11:45:42","true","Add single compactor http client for delete and gennumber clients (#7453)",89,55,1,1,"2018-04-16 10:25:39","1659.06"
"grafana/loki","46b7c2cfb6d178dd0a79f093c00efc2f5c0b9490","periklis","2023-03-27 13:55:59","true","operator: Prepare community release v0.2.0 (#8651)",81,59,1,1,"2018-04-16 10:25:39","1802.15"
"grafana/loki","d1365c17ab713e2d40a91535092104c30ed1948f","periklis","2022-08-05 08:16:01","true","operator: Use mod readonly when building container (#6843)",74,52,0,1,"2018-04-16 10:25:39","1569.91"
"grafana/loki","695ea32226b0065c9399d863ee4f957efc32095d","bboreham","2023-06-16 20:07:10","true","stores/series tests: use abstractions over Labels (#9613)

**What this PR does / why we need it**:

Stop assuming `labels.Labels` is a slice.

**Special notes for your reviewer:**

This PR only touches tests.

Upstream Prometheus is using a different implementation of
`labels.Labels`, so I plan to create a series of PRs which make Loki
compatible with that. #9532 was the first.

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- NA Documentation added
- [x] Tests updated
- NA `CHANGELOG.md` updated
- NA Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- NA For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",58,62,1,0,"2018-04-16 10:25:39","1886.65"
"grafana/loki","3f8963ce018f4cc7c6b5792727ed3625e63f027a","slim-bean","2019-04-15 21:18:36","false","Updating hpcloud tail library to forked version modified for our purposes.
Changes to the library move the handling of symlinks and re-opening to the tail library.
fsnotify events are only used now to start new tailers for files not previously seen.",100,12,0,1,"2018-04-16 10:25:39","359.45"
"grafana/loki","6387bf765c374468b10c39d235dc135fdb95b50d","vlad-diachenko","2023-09-01 18:40:49","true","[promtail] include the size of non-indexed labels into batch size (#10412)

**What this PR does / why we need it**:
When we added non-indexed-labels support to the promtail, we forgot to
adjust the batch size calculation which leads to the case when promtail
thinks that batch size is `X` but when it sends it to Loki, Loki rejects
it because the actual size of the payload is `X`+`N`(size of non-indexed
labels).

**Special notes for your reviewer**:
This feature is not released yet, so, changelog update is not needed.

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [x] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

Signed-off-by: Vladyslav Diachenko <vlad.diachenko@grafana.com>",45,64,1,0,"2018-04-16 10:25:39","1961.59"
"grafana/loki","86d943d8f43f3c7f6e7c210eb273708d10a6ee79","Starefossen","2023-06-23 09:09:06","true","helm: add updateStategy for canary pods (#9760)

**What this PR does / why we need it**:
Allows configuring Canary DaemonSet rollout.

**Which issue(s) this PR fixes**:
N/A

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [x] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [x] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [x] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",62,62,1,0,"2018-04-16 10:25:39","1893.2"
"grafana/loki","435391661f4e0f03eb378f77c07aaad5009cd6e9","chaudum","2022-04-13 12:52:20","true","Update golangci-lint in build image (#5901)

* Update golangcli-lint in build image to v1.45.2

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* Use correct URL to download golangci-lint

See installation instructions https://golangci-lint.run/usage/install/#ci-installation

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* Update build image version in .drone.jsonnet

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",319,48,0,1,"2018-04-16 10:25:39","1452.85"
"grafana/loki","c491e68c924a3a5ee4ab6f2d76982722d7a8b81f","saerosV","2022-09-10 00:41:40","true","Docs: Fix Helm chart link path (#7107)

<!--  Thanks for sending a pull request!  Before submitting:

1. Read our CONTRIBUTING.md guide
2. Name your PR as `<Feature Area>: Describe your change`.
a. Do not end the title with punctuation. It will be added in the
changelog.
b. Start with an imperative verb. Example: Fix the latency between
System A and System B.
  c. Use sentence case, not title case.
d. Use a complete phrase or sentence. The PR title will appear in a
changelog, so help other people understand what your change will be.
3. Rebase your PR if it gets out of sync with main
-->

**What this PR does / why we need it**:

Fix the link path leading to Loki's Helm chart, in
`production/README.md`.

[Current broken
link](https://github.com/grafana/loki/blob/main/production/production/helm/loki/README.md).

**Special notes for your reviewer**:

Hey @trevorwhitney, just found out the broken link added by #6985. 

<!--
Note about CHANGELOG entries, if a change adds:
* an important feature
* fixes an issue present in a previous release, 
* causes a change in operation that would be useful for an operator of
Loki to know
then please add a CHANGELOG entry.

For documentation changes, build changes, simple fixes etc please skip
this step. We are attempting to curate a changelog of the most relevant
and important changes to be easier to ingest by end users of Loki.

Note about the upgrade guide, if this changes:
* default configuration values
* metric names or label names
* changes existing log lines such as the metrics.go query output line
* configuration parameters 
* anything to do with any API
* any other change that would require special attention or extra steps
to upgrade
Please document clearly what changed AND what needs to be done in the
upgrade guide.
-->
**Checklist**
- [ ] Documentation added
- [ ] Tests updated
- [ ] Is this an important fix or new feature? Add an entry in the
`CHANGELOG.md`.
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

Co-authored-by: Trevor Whitney <trevorjwhitney@gmail.com>",85,53,1,0,"2018-04-16 10:25:39","1604.59"
"grafana/loki","ed649eec370a2aaa8a77291c302527da012fe060","owen-d","2021-01-07 19:37:27","true","Don't fail writes due to full WAL disk (#3136)

* dont fail writes on full wal disk

* wal full failure will cause flush on shutdown

* logs the first full WAL failure",116,33,0,1,"2018-04-16 10:25:39","991.88"
"grafana/loki","f083aab09dc08da57d0c5c982662cd7c51075790","kavirajk","2022-01-28 14:22:54","true","Remove `cortexpb` dependency from Loki packages. Use only `logproto` now. (#5264)

* Getting rid of `cortexpb`

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Get rid of `cortex/pkg/tenants`

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Fix linter errors

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* go mod vendor

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Rename some import alias

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",276,45,0,1,"2018-04-16 10:25:39","1377.91"
"grafana/loki","e6f8d6ffad75db953aad0e6e603ded691ce9ac32","pracucci","2019-07-16 17:01:25","false","Added date without year support to timestamp stage (#760)",98,15,0,0,"2018-04-16 10:25:39","455.52"
"grafana/loki","f3370cf120edc25c6228ef013d2da1ee29a2e075","pracucci","2019-10-08 13:41:41","false","docs: fix Promtail / Loki capitalization (#1130)

* docs: fixed Promtail capitalization

* docs: fixed Loki capitalization",72,18,0,0,"2018-04-16 10:25:39","537.39"
"grafana/loki","dc5cc4c494701052f6e63a23bb55f5c314b01163","ashwanthgoli","2022-12-26 12:08:14","true","store: write overlapping chunks to multiple stores (#7988)

Signed-off-by: Ashwanth Goli <iamashwanth@gmail.com>

**What this PR does / why we need it**:
When a chunk falls on the period boundary it should be written to both
the stores as it gets referred to by the indexes on both sides. But we
currently skip the writes for subsequent periods if the chunk is found
in the cache. This PR ensures that overlapping chunks get written to
both the stores

**Which issue(s) this PR fixes**:
Fixes #7847 

**Special notes for your reviewer**:
Downside of this approach is that we end up writing the overlapping
chunk multiple times, once from each instance in the replica set. But
these duplicate writes would be infrequent given this occurs only on
schema changes

**Checklist**
- [X] Reviewed the `CONTRIBUTING.md` guide
- [X] Tests updated
- [x] `CHANGELOG.md` updated

Signed-off-by: Ashwanth Goli <iamashwanth@gmail.com>",98,56,1,0,"2018-04-16 10:25:39","1711.07"
"grafana/loki","18faf99fcb4c85cf31bd9134870fb23d1bf5260b","eraac","2020-01-08 08:05:56","false","<doc>: information about max_look_back_period (#1474)

* <doc>: information about max_look_back_period

* update example

* added a note to retention doc and fixed a spell error

Co-authored-by: Sandeep Sukhani <sandeep.d.sukhani@gmail.com>",103,21,0,0,"2018-04-16 10:25:39","627.15"
"grafana/loki","901562e040ee76aa155fb1a2e68d2af6549c7f86","slim-bean","2020-11-18 09:48:40","true","update loki-stack to use latest logstash version (#2940)",123,31,0,1,"2018-04-16 10:25:39","942.47"
"grafana/loki","44ba39055d8caa3ebdbecb0df3512742587e2eff","slim-bean","2022-02-01 06:57:10","true","logstash: re-add bundle update and update bundler (#5284)

* update to latest logstash and bundler

Signed-off-by: Edward Welch <edward.welch@grafana.com>

* re-add bundle update

Signed-off-by: Edward Welch <edward.welch@grafana.com>",276,45,0,1,"2018-04-16 10:25:39","1380.61"
"grafana/loki","4f75939efbc7b76c67df88754492a819107f4d48","slim-bean","2022-05-04 19:52:55","true","Revert ""Loki: Change live tailing to only allow mutating the log line not the number of streams. (#6063)"" (#6097)

This reverts commit 98fda9b0a063f5a4160802ccd8490f1aa18d3d54.",75,49,0,1,"2018-04-16 10:25:39","1479.39"
"grafana/loki","e25587bfd7896c12cc225bf0a1d54104d8f6f0ea","jeschkies","2021-08-23 10:03:40","true","Document known Docker driver issues. (#4190)

* Document known Docker driver issues.

* Update docs/sources/clients/docker-driver/_index.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* Update docs/sources/clients/docker-driver/_index.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* Update docs/sources/clients/docker-driver/_index.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>",127,40,0,1,"2018-04-16 10:25:39","1222.73"
"grafana/loki","6a855dc037a99c4857ac1155d02afce5a6ce64f4","camilleryr","2021-03-17 13:15:35","true","Update boltdb-shipper.md (#3464)",160,35,0,0,"2018-04-16 10:25:39","1061.62"
"grafana/loki","c42a0ba8687f3444873b23b4cc21cd112d659f1d","MasslessParticle","2023-03-01 17:11:40","true","Optimize .+ regex line filter (#8646)

Interpolated variables from Grafana dashboards may result in the regex
matcher `.+`. Filters with `+` are already being rewritten to be non
greedy but there is a further optimization to make replace the regex
altogether with a filter that just matchers `len(line) > 0`",72,58,1,1,"2018-04-16 10:25:39","1776.28"
"grafana/loki","8cb57424e3238130edbb688328e27ad765239d9e","JordanRushing","2021-10-25 17:36:26","true","Update CHANGELOG.md and /docs with info on new `overrides-exporter` module for Loki (#4540)

* Update CHANGELOG.md and /docs with info on new overrides-exporter module for Loki

* Apply small changes to `overrides-exporter` docs

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>",164,42,0,0,"2018-04-16 10:25:39","1285.05"
"grafana/loki","6e5527755283fb286fcb398f50038d21147d7e31","periklis","2020-06-08 17:32:20","true","Add flag to disable tracing (#2191)",135,26,0,1,"2018-04-16 10:25:39","782.8"
"grafana/loki","9a49ab78fec663c0e7b1a5d6bb03f8a4eccfc09b","KMiller-Grafana","2022-01-04 19:08:20","true","Docs: revise block names (ring and filesystem) and correct spelling (#5015)

* Docs: revise block names (ring and filesystem) and correct spelling

* Docs: scheduler_ring and compactor_ring point to ring config
   Change made per review comment.",253,44,0,0,"2018-04-16 10:25:39","1354.11"
"grafana/loki","ec54c723ebbeeda88000dde188d539ecfe05dad8","hainenber","2023-10-13 11:58:46","true","feat(lambda/promtail): support dropping labels (#10755)

**What this PR does / why we need it**:

**Which issue(s) this PR fixes**:
Fixes #10669 

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [x] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

---------

Signed-off-by: hainenber <dotronghai96@gmail.com>
Co-authored-by: Michel Hollands <42814411+MichelHollands@users.noreply.github.com>",26,66,1,0,"2018-04-16 10:25:39","2003.31"
"grafana/loki","dca859afafc2fea3de8e0b68ac2725a4fe7c19ac","Red-GV","2023-03-21 18:58:45","true","operator: Update Dockerfile to go1.20 images (#8857)",84,59,1,1,"2018-04-16 10:25:39","1796.36"
"grafana/loki","ef49909430f8894301f5275a99c2fab55cffcef8","ssncferreira","2022-03-07 13:23:21","true","Refactor sharding engine to downstream engine (#5546)",301,47,0,0,"2018-04-16 10:25:39","1416.87"
"grafana/loki","3d2282745bf121377ade603432347e6ca23b9235","cstyan","2022-05-24 20:45:14","true","Runtime reloadable config; ring migration setup (#6214)

* Clean up setting of memberlist and multikv config for Loki services that
use the ring. Also sets the multi client runtime config function for all
services that use the ring.

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* Add a test for the multi kv setup

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* Fix lint issues.

Signed-off-by: Callum Styan <callumstyan@gmail.com>",73,49,0,1,"2018-04-16 10:25:39","1499.43"
"grafana/loki","4feee18825d8bbc486fa19cdf5df2cda4dd348b3","periklis","2021-12-16 14:42:47","false","Remove ViaQ from source code and manifests",233,44,0,1,"2018-04-16 10:25:39","1335.93"
"grafana/loki","027c2ef9570935262ab100e0cc5ea29b353b0997","hamishforbes","2023-02-03 16:39:29","true","Jsonnet: Allows gateway tenant ID to be configured (#7624)

Co-authored-by: Karsten Jeschkies <karsten.jeschkies@grafana.com>",78,57,1,0,"2018-04-16 10:25:39","1748.26"
"grafana/loki","4fd670dc7a327ee4789866cb5c738a30cba40f44","cyriltovena","2020-05-01 18:15:51","true","Support Post request in the frontend queryrange handler. (#2023)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",120,25,0,1,"2018-04-16 10:25:39","745.83"
"grafana/loki","105dbec480c546b87f8d02bd53695c075d6503ba","rfratto","2019-09-10 20:09:29","false","docs: fix example with pulling systemd logs

/etc/machine-id must be mounted in the container for promtail to know
which systemd journal to read from.",71,17,0,1,"2018-04-16 10:25:39","509.66"
"grafana/loki","55c96bfe90f71c8d0daf8708785ce8dc2d23caa7","slim-bean","2023-03-10 19:57:14","true","Loki: add lines processed to metrics.go (#8764)

**What this PR does / why we need it**:

Typically `throughput` and `total_bytes` are the most common fields in
the `metrics.go` log line which we look at for query performance.

However, there are cases where query performance is better measured by
`total_lines` and `lines_per_second` (e.g. when processing a lot of high
volume but relatively short log lines) and having this information in
metrics.go can be very helpful.

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

Signed-off-by: Edward Welch <edward.welch@grafana.com>",87,59,1,1,"2018-04-16 10:25:39","1785.4"
"grafana/loki","ed98d781b7565bcda7e401a11ee91293bbf27b10","slim-bean","2023-07-26 00:24:49","true","update drone signature (#10060)

**What this PR does / why we need it**:

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

---------

Signed-off-by: Edward Welch <edward.welch@grafana.com>",53,63,1,1,"2018-04-16 10:25:39","1925.83"
"grafana/loki","f51ee849b03c5f6b79f3e93cb7fd7811636bede2","rgroothuijsen","2023-10-12 13:23:08","true","fix(promtail): correctly parse list of drop stage sources from YAML (#10848)

**What this PR does / why we need it**:
This PR fixes YAML parsing of the `source` field in the drop stage when
said field is a list of strings. Because this list is not being
recognized in the code as a list of strings, but rather as a list of
generic `interface{}` elements, it fails a type check and throws an
error. In order to fix this, an `interface{}` list is manually converted
to a `string` list. The problem was already reproducible with existing
tests, but the test YAML mistakenly referred to the field as `sources`
rather than `source`.

**Which issue(s) this PR fixes**:
Fixes #10095 

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [x] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

---------

Co-authored-by: Michel Hollands <42814411+MichelHollands@users.noreply.github.com>",25,66,1,0,"2018-04-16 10:25:39","2002.37"
"grafana/loki","94ab31413ffeee3523e1062ac707909e53eab919","isimluk","2023-10-19 18:21:00","true","Fix docs for fluentd client (#10639)

Fluentd client configuration has changed recently. The default config
already
[reflects](https://github.com/grafana/loki/blob/main/clients/cmd/fluentd/docker/conf/loki.conf#L5-L8)
the new syntax. However, the examples on the page haven't been updated
yet.",20,66,1,0,"2018-04-16 10:25:39","2009.58"
"grafana/loki","5113906c6723234c1441838c0d5896f28d15d3e3","trevorwhitney","2023-04-03 22:47:35","true","Update helm and jsonnet for 2.8 release (#9003)

Prepare helm and jsonnet for 2.8 release.",80,59,1,1,"2018-04-16 10:25:39","1808.52"
"grafana/loki","da9b4c9369d1221844c2fedac4b16096e7e44ec6","sandeepsukhani","2022-02-11 14:27:55","true","cleanup common index set after cleaning up all the user index sets (#5372)",282,46,0,1,"2018-04-16 10:25:39","1390.92"
"grafana/loki","d265e1d206a539b5d6d4a3582c3d27768b05a56c","dannykopping","2021-10-08 08:27:46","true","Do not clear HTTP client config (#4437)

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",139,42,0,1,"2018-04-16 10:25:39","1267.67"
"grafana/loki","a7d41f014a14441a0b81d39c889bc464750c83cb","davkal","2019-03-29 16:24:29","true","Merge pull request #434 from olafure/logcli-skip-label-option

Added a flag --no-labels to skip printing labels in the output from l…",93,11,0,0,"2018-04-16 10:25:39","343.25"
"grafana/loki","4b41a3aab43e50f59a1db25c72932cb207395b3e","trevorwhitney","2022-01-11 23:31:23","true","update helm docs, add simple scalable (#4925)

* update helm docs, add simple scalable

* Update docs/sources/installation/simple-scalable-helm.md

Co-authored-by: Dylan Guedes <djmgguedes@gmail.com>

* close code snippet

* add doc changes from karen

Co-authored-by: Dylan Guedes <djmgguedes@gmail.com>",257,45,0,1,"2018-04-16 10:25:39","1361.3"
"grafana/loki","0949632dca5d455e4f7eeddc01d09d91e2665b04","blockloop","2021-04-19 22:16:26","true","add some tests to verify services will match pods (#29)",161,36,0,0,"2018-04-16 10:25:39","1099.24"
"grafana/loki","060600c104905be8bd6c503c4600bbef226f9c75","trevorwhitney","2023-11-03 18:03:40","true","add vulnerability scanning github action (#11096)

Adds a GitHub action that will run `snyk` and `trivy` scans against PRs
and comment on the PR if a high or critical vulnerability is found",11,66,1,1,"2018-04-16 10:25:39","2023.57"
"grafana/loki","d3615f7e9e7b349c504b0b90416303c9b8c4e60a","GeorgeTsilias","2022-11-30 09:14:21","true","promtail: Handle nil error on target Details() call (#7771)

**What this PR does / why we need it**:
This PR addresses issue [#6930](https://github.com/grafana/loki/issues/6930).
Promtail should not panic when the Details() method is called for a target that has no errors.

**Which issue(s) this PR fixes**:
Fixes #6930",94,55,1,0,"2018-04-16 10:25:39","1684.95"
"grafana/loki","5b9f5b9efaa52bfa737e963392975e942e83861b","jeschkies","2021-11-08 13:41:17","true","Run benchmarks in cron jobs. (#4636)

* Run benchmarks in cron jobs.

* Increase benchmark timeout.

* Trigger every four hours.",183,43,0,1,"2018-04-16 10:25:39","1297.89"
"grafana/loki","8d43969d6b75a9038fb9fd70727553efff108506","jeschkies","2023-02-01 07:48:16","true","Helm: Align ingress timeout and size limits. (#8352)",80,57,1,1,"2018-04-16 10:25:39","1745.89"
"grafana/loki","7bb77ecdd8efe06e426f0c19319179c26f77da52","pstibrany","2019-12-12 16:21:25","false","Convert string to bytes once only when doing string filtering. (#1405)

This makes it slightly faster:

name              old time/op    new time/op    delta
ContainsFilter-4    18.2ns ± 2%     9.8ns ± 1%  -46.20%  (p=0.000 n=10+8)

name              old alloc/op   new alloc/op   delta
ContainsFilter-4     0.00B          0.00B          ~     (all equal)

name              old allocs/op  new allocs/op  delta
ContainsFilter-4      0.00           0.00          ~     (all equal)

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>",97,20,0,0,"2018-04-16 10:25:39","601.5"
"grafana/loki","ffd9e29486d3222aeb33b500f79be162fba10982","DylanGuedes","2021-12-29 17:41:39","true","Docs: Fix list of Ruler supported storages (#5008)

* Fix list of Ruler supported storages.

* Update number of supported storages",254,44,0,1,"2018-04-16 10:25:39","1349.05"
"grafana/loki","e03637151bdc5473965e706cf6d18669d74026fd","chaudum","2023-09-21 11:02:17","true","Remove legacy ingester shutdown handler (#10655)

The handler was deprecated for a while and is removed in favour or `/ingester/shutdown?flush=true`.

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>
Co-authored-by: J Stickler <julie.stickler@grafana.com>",32,65,1,1,"2018-04-16 10:25:39","1981.28"
"grafana/loki","3e075497cd84785703a8441a93393a29d2735935","owen-d","2020-01-31 19:37:41","true","Feature/per tenant splitby (#1565)

* split by overrides by tenant

* tenant aware metric query splitting

* consistent split_queries_by_interval naming

* updates readme

* fixes rebase conflict

* refactor to support limit based splitby intervals in all locations

* simplifies limits cachesplitter

* fixes comment",103,21,0,1,"2018-04-16 10:25:39","650.63"
"grafana/loki","46e835fb3cd3e6252322fc8e5deee9ba65c4b496","wtchangdm","2023-04-14 19:14:01","true","Docs: Replace mimir example config path with a loki one (#9125)

**What this PR does / why we need it**:

The example config path on Loki's query scheduler is using
`-config.file=/mimir/config/mimir.yaml`, which looks a little bit
confusing on Loki's document, even though there are multiple references
to Mimir.


https://github.com/grafana/loki/blob/7bec727c6dff8e6268f9a8f9b64fee725d4195f8/docs/sources/operations/scalability.md?plain=1#L23

This PR replaces the Mimir config path with the one found in
query-frontend's document.


https://github.com/grafana/loki/blob/7bec727c6dff8e6268f9a8f9b64fee725d4195f8/docs/sources/configuration/query-frontend.md?plain=1#L115

**Which issue(s) this PR fixes**:
N/A

**Special notes for your reviewer**:
I noticed this when checking configuration of 2.6, but this is still the
case in the [latest
version](https://grafana.com/docs/loki/v2.8.x/operations/scalability/).

**Checklist**
- [X] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",81,60,1,0,"2018-04-16 10:25:39","1819.37"
"grafana/loki","1592bf5cc9d345439d0e4df1e2fecb5323314a5b","vlad-diachenko","2022-07-08 13:46:43","true","removed redundant 2.6.0 release title (#6640)",69,51,0,0,"2018-04-16 10:25:39","1543.14"
"grafana/loki","fd3a6dfaf15934a1b3619062adfca658b7116074","owen-d","2022-11-01 08:22:13","true","Adds extra docs to flehs out ParseLabels implementation (#7562)

Adding some extra comments for archaeological purposes",89,54,1,1,"2018-04-16 10:25:39","1655.91"
"grafana/loki","f5cf930ab47261a252fc38c79b17b40456408a9b","jeschkies","2021-08-10 15:51:40","true","Define ksonnet lib for query scheduler. (#4102)

* Define ksonnet definition for query scheduler.

* Enable query scheduler based on config flag.",113,40,0,1,"2018-04-16 10:25:39","1209.98"
"grafana/loki","54340e7aee504363631f8cb7197d7c3afbfbccab","slim-bean","2019-05-07 19:31:25","false","make clean removes `pkg/promtail/server/ui/assets_vfsdata.go` which meant the `pkg/promtail/server/ui/assets_vfsdata.go: assets` target is never activated causing a build error, updating to make the target hit on `server.go` which has a dependency on the deleted `assets_vfsdata.go` triggering a run of `make assets` before go builds that file (#555)",99,13,0,1,"2018-04-16 10:25:39","386.63"
"grafana/loki","2eebdff2e252f30d529d1327c55e108546f6a1d7","ivanahuckova","2022-03-03 15:20:34","true","Update metric_queries.md (#5525)

Provided query is incorrect as it has extra `)`. This PR fixes it.",298,46,0,0,"2018-04-16 10:25:39","1412.95"
"grafana/loki","2db309271c20ec6660a95aeefdb32d2d091cb7f3","kavirajk","2022-02-07 14:12:22","true","Makes `tailer.droppedStreams` slice bounded. (#5334)

* Makes `tailer.droppedStreams` slice bounded.

For slow receiver, this dropped streams may cause ingester memory to keep increasing.

Sometimes OOMing the ingester.

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Make droppedStreams slice size configurable

Update tests

Adding logging when slice is dropped

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Add test for dropped stream

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",278,46,0,1,"2018-04-16 10:25:39","1386.91"
"grafana/loki","7d501729c37124018a1e852a7732396f7d89bd7c","DylanGuedes","2022-01-13 08:55:17","true","Add missing forked gateway tests (#5118)

* Add missing tests for `storegateway`.

* Fork cortex tsdb testutil package.

* Fix import lint.",263,45,0,1,"2018-04-16 10:25:39","1362.69"
"grafana/loki","81e100f18f2982d1f041a4f0c48fd5fa4f42c56e","kavirajk","2021-06-24 10:34:12","true","Make `overrides` configmap names and mount path as variables. (#3888)

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",107,38,0,1,"2018-04-16 10:25:39","1163.76"
"grafana/loki","18cb7a005094ff26caeba196edf32e24e238a578","owen-d","2021-03-04 22:22:18","true","simplifies jsonnet sharding (#3439)",141,34,0,1,"2018-04-16 10:25:39","1049"
"grafana/loki","8e5fa03de3b3cf7efa15e4959bd5b7decae2d944","tomwilkie","2020-04-07 19:35:17","false","s/dashboards/grafanaDashboards.

Signed-off-by: Tom Wilkie <tom@grafana.com>",115,24,0,0,"2018-04-16 10:25:39","716.63"
"grafana/loki","fa63c094185c19694f52690519a4d755a82c9daa","pracucci","2020-01-09 15:14:23","true","Fixed TOUCH_PROTOS in all DroneCI pipelines (#1494)

* Fixed TOUCH_PROTOS in all DroneCI pipelines
* Fixed drone.yaml generation

Signed-off-by: Marco Pracucci <marco@pracucci.com>",104,21,0,0,"2018-04-16 10:25:39","628.45"
"grafana/loki","094f8f3b20d9bb5485ccd52b2daf9b31abc8802a","owen-d","2022-07-08 14:27:24","true","[TSDB]  fingerprint offsets is now correctly 16 byte aligned (#6630)

* simpler shard factor calculations, disallows identity factor of 1
Signed-off-by: Owen Diehl <ow.diehl@gmail.com>

* log interval span as soon as it finishes
Signed-off-by: Owen Diehl <ow.diehl@gmail.com>

* another shard bounds test
Signed-off-by: Owen Diehl <ow.diehl@gmail.com>

* indexclient span logging
Signed-off-by: Owen Diehl <ow.diehl@gmail.com>

* more index span logging
Signed-off-by: Owen Diehl <ow.diehl@gmail.com>

* correctly match single shard
Signed-off-by: Owen Diehl <ow.diehl@gmail.com>

* shardedPostings test
Signed-off-by: Owen Diehl <ow.diehl@gmail.com>

* shardedPostings maxOffset is properly exclusive
Signed-off-by: Owen Diehl <ow.diehl@gmail.com>

* minor posting idiomatic-ness
Signed-off-by: Owen Diehl <ow.diehl@gmail.com>

* store 16 byte aligned offsets for fingerprint table
Signed-off-by: Owen Diehl <ow.diehl@gmail.com>",69,51,0,1,"2018-04-16 10:25:39","1543.17"
"grafana/loki","81e32dd6d6698c4d6e6b1e9462a4d3a8cc86b067","chaudum","2023-04-24 14:50:30","true","Re-organize store related interfaces for better composability (#9249)

**What this PR does / why we need it**:

I got confused by our store related interfaces, so I split them up into
smaller ones and composed them.

**Special notes for your reviewer**:

What I also noticed is that we sometimes prefix interface method with
`Get`, e.g. `GetChunkRefs`, and sometimes we don't, e.g. `Series`.

I think that re-organizing the package structure of the `pkg/storage/`
package would help to better understand the individual purposes of the
interfaces.

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",79,60,1,1,"2018-04-16 10:25:39","1834.43"
"grafana/loki","0a7737e7c7eb81890b8f9a18af8020d6bc8a9808","owen-d","2023-10-23 15:41:32","true","adds a merge-builder for building blocks from other blocks+storage (#10974)

Some minor refactoring + a (simple) `MergeBuilder` struct to build bloom
blocks from other blocks and storage, depending on what's already been
indexed into the blocks.",24,66,1,1,"2018-04-16 10:25:39","2013.47"
"grafana/loki","cf94dac37b01bb090e0e88327b115c9052c7724f","trevorwhitney","2022-09-09 14:35:59","true","Make helm with style more consistent (#7096)

**What this PR does / why we need it**:

Small helm style fix to be more consistent across templates when
checking an `enabled` flag in a nested struct.",85,53,1,1,"2018-04-16 10:25:39","1604.17"
"grafana/loki","d6f2d4a041afd4f1805b5bec8097452a0753730a","7olstoy","2021-08-02 21:21:40","true","Change service names in docker-compose files (#3768)

Co-authored-by: Dmitry Tolstoy <33700018+A-styler@users.noreply.github.com>",103,39,0,0,"2018-04-16 10:25:39","1202.21"
"grafana/loki","fd619b693196c3614310b25a39efa956d0b31b71","cyriltovena","2021-01-22 13:12:40","true","Fixes tail api marshalling for v1. (#3211)

Introduce a bug by removing the default marshalling (#3163) but the tail api was using the default json. This fixes it by forcing the usage of jsoniter package.
Added a missing test so that it doesn't happen again.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",117,33,0,1,"2018-04-16 10:25:39","1006.62"
"grafana/loki","41d81fbb0c64885a1a58cbc6b863f92459746c09","daniellee","2018-12-13 09:35:57","true","Merge pull request #87 from metalmatze/readme-datasource-url

Be more specific about Loki's URL with docker",18,8,0,0,"2018-04-16 10:25:39","236.97"
"grafana/loki","ec4b88955fcef750cce981636ea22d30376e24c8","trevorwhitney","2023-04-04 15:45:31","true","Add 2.8 release notes (#9004)

Adds 2.8 release notes.",81,59,1,1,"2018-04-16 10:25:39","1809.22"
"grafana/loki","6b6e5b8ee6e1446b88c314fd7628fb617a2373e0","grafanabot","2023-10-18 10:10:32","true","[CI/CD] Update yaml file `./production/helm/loki/values.yaml` (+1 other) (#10951)

**Here is a summary of the updates contained in this PR:**
***
Update attribute `$.enterprise.version` in yaml file
`./production/helm/loki/values.yaml` to the following value: `v1.8.4`
***
Bump version of Helm Chart
Add changelog entry to `./production/helm/loki/CHANGELOG.md`
Re-generate docs

Co-authored-by: Kaviraj Kanagaraj <kavirajkanagaraj@gmail.com>",21,66,1,0,"2018-04-16 10:25:39","2008.24"
"grafana/loki","5aac00f4d940dc039776c55954d9eedf433dbd21","slim-bean","2019-05-15 02:17:19","false","changing response_latency buckets some more, making exponential and configurable",100,13,0,1,"2018-04-16 10:25:39","393.91"
"grafana/loki","a877febf75be114073ac45e135452bfdb6a594e9","foutrelis","2022-06-06 15:32:10","true","Use fake credentials in storage/chunk/storage tests (#6187)

Enable insecure mode for the GCS client so fake credentials are used
when running the storage tests (see commit c0cc004333b1 (""gcs client:
use fake credentials in unit test"").

Fixes: https://github.com/grafana/loki/issues/6185",74,50,0,0,"2018-04-16 10:25:39","1511.21"
"grafana/loki","15cbba724205289b93923b2e9f1699be378bff47","rfratto","2019-07-23 14:17:59","false","ingester: clean up chunk transfer code",103,15,0,1,"2018-04-16 10:25:39","462.41"
"grafana/loki","9fcc42dc48a9819304c7ef3d760cfa3b515e4ff4","jeschkies","2023-10-18 14:16:30","true","Support protobuf  `QueryRequest` in querier. (#10858)

**What this PR does / why we need it**:
This is one step to support pure protobuf encoding without `httpgrpc`.
It is only on the scheduler and is fully backwards compatible.

**Which issue(s) this PR fixes**:
This is a sub change of https://github.com/grafana/loki/pull/10688

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [x] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

---------

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>
Co-authored-by: Kaviraj <kavirajkanagaraj@gmail.com>
Co-authored-by: Danny Kopping <dannykopping@gmail.com>",21,66,1,1,"2018-04-16 10:25:39","2008.41"
"grafana/loki","f9b25968f77ff295c09816102a6b8fa9a3445ff5","slim-bean","2019-12-12 21:50:54","true","change the chunk size histogram to allow for bigger buckets (#1409)

* change the chunk size histogram to allow for bigger buckets

Signed-off-by: Edward Welch <edward.welch@grafana.com>

* changing buckets again

Signed-off-by: Edward Welch <edward.welch@grafana.com>",99,20,0,1,"2018-04-16 10:25:39","601.73"
"grafana/loki","337659602ebea5a107cc38739ea62159fe6f605e","simonswine","2022-04-21 07:50:54","true","Add string representation of boltdb shipper mode (#5982)",171,48,0,0,"2018-04-16 10:25:39","1465.89"
"grafana/loki","c725de60350afc2325e9baaa24d87ec13608e7a0","dannykopping","2023-08-28 11:20:37","true","Querier: add chunk refs fetch time to metrics (#10362)

**What this PR does / why we need it**:
Adds an entry to the `metrics.go` log line to track how long a query
waits for its chunk references to be returned by the index. This is
useful when trying to understand where processing time is being spent.",49,64,1,1,"2018-04-16 10:25:39","1958.29"
"grafana/loki","6c843044303ca9d3ffe7df88a41c76c3b21f1063","ldb","2022-02-25 13:59:42","true","promtail/targets/syslog: Enable best effort parsing for Syslog messages (#5409)

* promtail/targets/syslog: enable best effort parsing

* promtail/targets/syslog: fmt",300,46,0,0,"2018-04-16 10:25:39","1404.9"
"grafana/loki","a7d47748593783323f6958456a6f6246dc07f157","simonswine","2020-11-20 15:08:07","true","Add community forum to README.md (#2969)",118,31,0,0,"2018-04-16 10:25:39","944.7"
"grafana/loki","ef47e0ee8a79c1200e5905837f559093e1d04509","MasslessParticle","2022-09-09 19:38:28","true","Fix errors loading deletes after force-removing partially-completed delete (#7125)

When sharded deletes that are partially completed are force-removed,
everything is removed except the shards that are currently being
deleted. The shards being deleted aren't necessarily in numerical order
so there's no way to know assume which shards have and haven't been
deleted.

The Delete store assumed it could look up requests in sequential order
and returned empty requests where there were gaps in the stored data.
This change takes the `sequence number` from the stored key of the
delete requests it finds and uses that to look up details.",85,53,1,1,"2018-04-16 10:25:39","1604.38"
"grafana/loki","6185d543209a16772e8e84eb712e8f58d3fcf0c8","joe-elliott","2019-09-13 12:53:59","false","Updated stream json objects to be more parse friendly (#1010)

* Added custom marshaller for Entry

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Added comment and test

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Fixed spelling error

* Added a custom marshaller to map entries => values

* Added support for labels

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Changed test to only check to the microsecond level

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Extended Entry tests

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Swapped to nanosecs encoded as strings

* Cleaned up docs with new loki paths.  Removed references to deprecated endpoints

* Added support for /loki/api/v1/push

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Removed obsolete comment

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Updated docs for new push endpoint

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Ran gofmt on test file

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Set GOGC=20 on test to avoid out of memory issue in circle ci

Signed-off-by: Joe Elliott <number101010@gmail.com>",71,17,0,0,"2018-04-16 10:25:39","512.35"
"grafana/loki","b90c460769d8c0b1d46434f5ba68de7545a9f9b6","KMiller-Grafana","2022-05-19 19:22:31","true","Rename fudge_duplicate_timestamp to be increment_duplicate_timestamp (#6120)

* Rename fudge_duplicate_timestamp to be increment_duplicate_timestamp

* run `gofmt -d -w pkg/validation/limits.go`

Co-authored-by: Christian Simon <simon@swine.de>",72,49,0,0,"2018-04-16 10:25:39","1494.37"
"grafana/loki","b0a7cf8f9df8e72f86f17c8ece6987b47e6227b7","pstibrany","2019-12-14 14:06:07","false","Change default LZ4 buffer size to 64k.

Added more LZ4 buffer size options for testing.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>",93,20,0,0,"2018-04-16 10:25:39","603.4"
"grafana/loki","69eabfcefd16d51612d1b158f776ef7f31bc42fa","MasslessParticle","2022-06-03 15:29:22","true","Fix delete cancellation timeout (#6285)",72,50,0,1,"2018-04-16 10:25:39","1508.21"
"grafana/loki","eb9d73251727b7f7a1cb662ee8469e9638f2cf40","minhdanh","2019-10-10 14:38:53","false","Helm chart: Allow additional scrape_configs to be added (#1134)

* Allow additional scrape_configs to be added

* Bump version of loki-stack chart",66,18,0,0,"2018-04-16 10:25:39","539.43"
"grafana/loki","95888f5bd19c778bd963052901412fb5a3589a10","trevorwhitney","2023-04-27 16:44:38","true","Expose signature version property for s3 storage configs (#9299)

**What this PR does / why we need it**:
This exposed the a `signatureVersion` property in the helm chart's
storage config options that can be used to set the `signature_version`
for a Loki S3 storage config.",80,60,1,1,"2018-04-16 10:25:39","1837.51"
"grafana/loki","683efa0f4d090df338b01017cb1ba5d2abbc4695","trevorwhitney","2022-11-22 17:07:48","true","Refactor nix to make it easier to import into other projects (#7635)

**What this PR does / why we need it**:

This makes it easier for projects that depend on Loki (like enterprise
logs) to more easily import the Loki nix flake in order to use the
overlays and configurations it contains.

It also removes the `build-vars.nix` because it was super annoying
without really getting us much.",94,55,1,1,"2018-04-16 10:25:39","1677.28"
"grafana/loki","45a7556da20f635c45370bc8a2261a15b4c7a8d8","slim-bean","2019-05-14 03:32:43","false","improving metrics
improving tests
config via flags
added ksonnet config",100,13,0,1,"2018-04-16 10:25:39","392.96"
"grafana/loki","07da8e1d1104d5fbe25ffc69514176ee56d1f19d","slim-bean","2019-05-21 11:10:18","false","Refactor to make everything a stage.
Still needs:  Matcher stage work, pipeline test work",105,13,0,1,"2018-04-16 10:25:39","400.28"
"grafana/loki","9803eab94749ad7bcb5fb647f76ab5fc85eeb5ea","slim-bean","2020-05-14 19:34:29","true","Loki: Allow configuring query_store_max_look_back_period when running a filesystem store and boltdb-shipper (#2073)

* Allow configuring query_store_max_look_back_period when running a filesystem store, which allows for boltdb-shipper to horizontally scale filesystem store.

Signed-off-by: Ed Welch <edward.welch@grafana.com>

* Update docs/operations/storage/boltdb-shipper.md

Co-authored-by: Sandeep Sukhani <sandeep.d.sukhani@gmail.com>

* add some more precision to the timestamp used to make the name unique just to make sure there are not collisions if for some reason the ID is empty (which can happen if the hostname doesn't resolve for some reason)

Signed-off-by: Ed Welch <edward.welch@grafana.com>

* Allow the ingester to query the store for labels if query store is enabled.

Signed-off-by: Ed Welch <edward.welch@grafana.com>

* make queriers aware of the fact that ingesters may be querying the store so they don't duplicate query efforts

Signed-off-by: Ed Welch <edward.welch@grafana.com>

* improve the docs

Signed-off-by: Ed Welch <edward.welch@grafana.com>

* add tests to the calculateMaxLookBack

Signed-off-by: Ed Welch <edward.welch@grafana.com>

Co-authored-by: Sandeep Sukhani <sandeep.d.sukhani@gmail.com>",120,25,0,1,"2018-04-16 10:25:39","758.88"
"grafana/loki","22fbfe225585bf7716ff935df25fcd8258604a0c","Duologic","2020-11-05 14:37:52","true","fix(loki-mixin): refer to super.annotations (#2873)

fixes #2729",130,31,0,0,"2018-04-16 10:25:39","929.68"
"grafana/loki","b34c2b0bd35e742057ede230e42305ec79f11c1b","cyriltovena","2019-12-02 14:11:17","true","Move to jsoniter instead of default json package (#1249)

* Move to jsoniter instead of default json package

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Removes jsoniter on the logcli output

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",91,19,0,1,"2018-04-16 10:25:39","591.41"
"grafana/loki","7fc25743eb37dc6e495652610b45b9ab5f55ca23","ssncferreira","2023-01-19 21:10:42","true","Docs fix: add missing sections on index.template file (#8216)

**What this PR does / why we need it**:

PR https://github.com/grafana/loki/pull/7916 which introduced the
documentation automation tool for Loki's configuration values,
incorrectly removed the last sections of the documentation. This PR
introduces them accordingly.

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",82,57,1,0,"2018-04-16 10:25:39","1734.45"
"grafana/loki","82161fe329f6aef99c52368a47a30f096887d14e","periklis","2022-11-22 14:56:25","true","operator: Fix object storage TLS spec CAKey descriptor (#7744)",95,55,1,1,"2018-04-16 10:25:39","1677.19"
"grafana/loki","9e5da9875d3e4158ee3cfd4d4bead8aa8bbab4c8","periklis","2021-12-17 18:05:23","true","Fix failing operator github actions (#4966)",237,44,0,1,"2018-04-16 10:25:39","1337.07"
"grafana/loki","4c5b08452500979b593008f4b94d4913a9309807","JordanRushing","2021-10-08 21:38:23","true","Add DroneCI pipeline stage to validate loki example configs; create example configuration files (#4358)

* Add DroneCI pipeline stage to validate loki example configs; create example configuration files

* Actually run loki in the validate-example-configurations pipeline stage

* Change method for running loki binary

* Add step dependency for config validation pipeline stage

* Actually loop over example configs and verify them!

* Push bad config to test failing builds

* Create remaining example configs

* Fix provided example loki configs

* Use make target to validate example configs

* Add make target to generate a new example configuration doc; add make target for CI to verify doc is re-generated upon changes to example configs

* Update CI to check the generated example config doc

* Clean up Makefile

* Mark new example config validation make targets as phony; fix conditional for config example doc checking

* Fix conditional

* Remove redundant step in generate-example-config-doc phony make target

* Add a correction to PR 4358

* Improve grammar and add newlines in example configuration descriptions

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* Regenerate examples.md

Co-authored-by: Karen Miller <karen.miller@grafana.com>
Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>",139,42,0,0,"2018-04-16 10:25:39","1268.22"
"grafana/loki","874aa6495e823998c194f6a21238fba202a003d7","chroberts","2022-06-09 06:03:21","true","Fix max series test loop that returns early (#6345)

Signed-off-by: Christopher Norris <christopher.norris@grafana.com>",73,50,0,0,"2018-04-16 10:25:39","1513.82"
"grafana/loki","0b947d956fdfd3c0bbb52934a4f3fcbbe3c7e740","KMiller-Grafana","2022-05-26 09:04:47","true","Docs: Reimplement PR 5649 on troubleshooting timeout errors (#6183)",73,49,0,0,"2018-04-16 10:25:39","1500.94"
"grafana/loki","1c95a5b0e7c6bfa809c3ab1c737bd22e4189d27f","cyriltovena","2019-07-05 13:48:45","true","update grafana to fix dashboard provider (#674)",96,15,0,1,"2018-04-16 10:25:39","444.39"
"grafana/loki","14fa7d8f3ae8307fc29b90cf21c1d20bf8f59508","cyriltovena","2021-05-06 09:23:38","true","Removes file sync syscall for compaction. (#3693)

Because we mostly download, read and upload but also  because all those operations are idempotent we don't
need to try to outsmart the OS by forcefully syncing the file to disk. The OS will use cache on files and we'll most likely not suffer from high disk io.

This was a conclusion I made after some digging of why the operation of compaction+retention was a bit slow sometimes. (+5s)

I've tried the PR in dev and the whole process execute now below 40s whereas because it was 4min.

strace before:

```
% time     seconds  usecs/call     calls    errors syscall
------ ----------- ----------- --------- --------- ----------------
 75.75   12.333637        2122      5812       561 futex
 10.81    1.760698         242      7267           nanosleep
  7.69    1.252697          88     14287           epoll_pwait
  2.86    0.464888          22     21608           write
  1.08    0.175313       19479         9           fsync                <----------
  1.06    0.172173          15     11249      4334 read
  0.40    0.064422        2147        30        15 unlinkat
  0.15    0.023945          19      1246           madvise
  0.09    0.015288        1529        10           munmap
  0.04    0.006098          23       263           tgkill
  0.03    0.004134          16       263           getpid
```

strace after:

```
% time     seconds  usecs/call     calls    errors syscall
------ ----------- ----------- --------- --------- ----------------
 77.01   58.085485        4599     12631       840 futex
  9.81    7.395901         230     32145           nanosleep
  8.34    6.287953         175     35882           epoll_pwait
  3.33    2.512512          18    141141           write
  0.79    0.596351          16     37911     13536 read
  0.51    0.382579        3985        96        48 unlinkat
  0.08    0.058465        1720        34           munmap
  0.04    0.031904          26      1219           tgkill
  0.03    0.023962          22      1082           madvise
  0.02    0.013831          11      1219           getpid
  0.01    0.011042           9      1219        12 rt_sigreturn
  0.01    0.005348         111        48           fdatasync
  0.01    0.003785          36       105           openat
  0.00    0.003603           8       435           pwrite64
  0.00    0.003005          13       229       200 epoll_ctl
  0.00    0.001828          19        96        34 newfstatat
```

As you can see the fsync and write are less intensive after.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",184,37,0,1,"2018-04-16 10:25:39","1115.71"
"grafana/loki","4f03ff914074280827de0b1eca6a306677f51b44","tomwilkie","2018-04-16 19:26:55","false","Streaming heap/merge for query path.",0,0,0,0,"2018-04-16 10:25:39","0.38"
"grafana/loki","b36bc5ab3272dbbfbdab00f23afa98e8abc9dbfe","kavirajk","2021-08-30 09:17:54","true","Add metrics for gcplog scrape. (#4235)

* Add metrics for gcplog scrape.

Also fix the Ready() method of target

* Fix typo with help message",129,40,0,1,"2018-04-16 10:25:39","1229.7"
"grafana/loki","8c1fe88409fe832b45da1f8f3cdd8116d81f4048","owen-d","2020-11-27 16:22:23","true","Introduces per stream chunks mutex (#3000)

* marshalable chunks

* wal record types custom serialization

* proto types for wal checkpoints

* byteswith output unaffected by buffer

* wal & record pool ifcs

* wal record can hold entries from multiple series

* entry pool

* ingester uses noopWal

* removes duplicate argument passing in ingester code. adds ingester config validation & derives chunk encoding.

* segment writing

* [WIP] wal recovery from segments

* replay uses sync.Maps & preserves WAL fingerprints

* in memory wal recovery

* wal segment recovery

* ingester metrics struct

* wal replay locks streamsMtx in instances, adds checkpoint codec

* ingester metrics

* checkpointer

* WAL checkpoint writer

* checkpointwriter can write multiple checkpoints

* reorgs checkpointing

* wires up checkpointwriter to wal

* ingester SeriesIter impl

* wires up ingesterRecoverer to consume checkpoints

* generic recovery fn

* generic recovery fn

* recover from both wal types

* cleans up old tmp checkpoints & allows aborting in flight checkpoints

* wires up wal checkpointing

* more granular wal logging

* fixes off by 1 wal truncation & removes double logging

* adds userID to wal records correctly

* wire chunk encoding tests

* more granular wal metrics

* checkpoint encoding test

* ignores debug bins

* segment replay ignores out of orders

* fixes bug between WAL reading []byte validity and proto unmarshalling refs

* conf validations, removes comments

* flush on shutdown config

* POST /ingester/shutdown

* renames flush on shutdown

* wal & checkpoint use same segment size

* writes entries to wal regardless of tailers

* makes wal checkpoing duration default to 5m

* recovery metrics

* encodes headchunks separately for wal purposes

* merge upstream

* linting

* adds chunkMtx to ingester streams

* all flush locking locks streams -> chunks in order to prevent deadlocks

* wal integration tests

* addresses pr feedback

uses entry pool in stream push/tailer

removes unnecessary pool interaction

checkpointbytes comment

fillchunk helper, record resetting in tests via pool

redundant comment

defers wg done in recovery

s/num/count/

checkpoint wal uses a logger

encodeWithTypeHeader now creates its own []byte

removes pool from decodeEntries

wal stop can error

* cleans up merge

* lint

* inline functions to simplify unlocking",120,31,0,1,"2018-04-16 10:25:39","951.75"
"grafana/loki","c12a1f4f436927a5a6be193bb4cc40c528bc6b37","chaudum","2022-06-14 13:44:01","true","feature: Add ingester handler for shutdown and forget tokens (#6179)

* Update grafana/dskit to 07166f9

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* Add /ingester/shutdown handler

This handler replaces the deprecated /ingester/flush_shutdown handler
and can be used to gracefully shut down a Loki instance and delete the
file that persists the tokens of the ingester ring.

In production environments you usually want to persist ring tokens so
that during a restart of an ingester instance, or during rollout, the
tokens from that instance are not re-distributed to other instances, but
instead kept so that the same streams end up on the same instance once
it is up and running again. For that, the tokens are written to a file
that can be specified via the `-ingester.tokens-file-path` argument.

In certain cases, however, you want to forget the tokens and
re-distribute them when shutting down an ingester instance. This was
already possible by calling `/ingester/flush_shutdown`, deleting the
tokens file and terminating the process. The new handler
`/ingester/shutdown` combines these manual steps into a
single handler.

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* Add changelog entry

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",67,50,0,1,"2018-04-16 10:25:39","1519.14"
"grafana/loki","872c29dacc75218cbea117bd7699ff8e3a720cca","MichelHollands","2023-01-03 08:20:04","true","Use gotestsum to run unit tests (#8022)

**What this PR does / why we need it**:

Add gotestsum to the build image. Then use it to run the unit tests. The
output format is easier to parse so we can get statistics about the
builds.

Passing test cases look like this:

```
PASS pkg/storage/stores/shipper/index/compactor.TestTable_RecreateCompactedDB/compacted_db_old_enough (2.64s)
PASS pkg/storage/stores/shipper/index/compactor.TestTable_RecreateCompactedDB (10.26s)
PASS pkg/storage/stores/shipper/index/compactor.TestExtractIntervalFromTableName/0 (0.00s)
```

Failing test cases are shown at the end and are easier to parse:

```
=== FAIL: pkg/storage/stores/indexshipper/compactor/deletion TestGRPCGetCacheGenNumbers (unknown)
panic: Fail in goroutine after TestGRPCGetCacheGenNumbers/error_getting_from_store has completed

goroutine 293 [running]:
testing.(*common).Fail(0xc0005aa680)
        /usr/local/Cellar/go/1.19.4/libexec/src/testing/testing.go:824 +0xe5
...
```

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",98,56,1,1,"2018-04-16 10:25:39","1717.91"
"grafana/loki","d3972852eee55c8aeee1318d63dc902433d9894e","joe-elliott","2020-01-17 19:35:17","false","Minor typo fixes (#1545)

Signed-off-by: Joe Elliott <number101010@gmail.com>",104,21,0,0,"2018-04-16 10:25:39","636.63"
"grafana/loki","ff60204ec12082f2d9bcdfd0c075cb1208f648dd","daixiang0","2019-04-17 02:15:30","false","Add help for GKE

Signed-off-by: Xiang Dai <764524258@qq.com>",103,12,0,0,"2018-04-16 10:25:39","365.91"
"grafana/loki","7c41a09bb1ecce24322a31fc6f94133ce4b739fa","daixiang0","2019-04-28 01:40:52","false","bump up chart version

Signed-off-by: Xiang Dai <764524258@qq.com>",96,12,0,0,"2018-04-16 10:25:39","376.89"
"grafana/loki","ffa07c0cca56f0bf831ac79452db8b348d90a2cf","daixiang0","2019-01-10 21:22:30","false","tools/promtail.sh: add DATAROOT option (#98)

* tools/promatail.sh: add DATAROOT option

Signed-off-by: Xiang Dai <764524258@qq.com>

* ksonnet: support custom data root

Signed-off-by: Xiang Dai <764524258@qq.com>

* Move dataroot setting to $._config.promtail_config.dataroot

* whitespace fix

* Update promtail.libsonnet",60,9,0,0,"2018-04-16 10:25:39","264.46"
"grafana/loki","306c96ce8a63875e8574a93adbeebe2346f873b8","thepalbi","2023-05-17 22:16:02","true","Notification based Promtail WAL Watcher polling approach (#9135)

**What this PR does / why we need it**:

This PR implements a new mechanism for the wal Watcher in Promtail, to
know there are new records to be read. It uses a combination of:
- https://github.com/prometheus/prometheus/pull/11950
- https://github.com/prometheus/prometheus/pull/11949

The main idea is that the primary mechanism is a notification channel
between the `wal.Writer` and `wal.Watcher`. The Watcher subscribes to
write events the writer publishes, getting notified if the wal has been
written. The same subscriptions design is used for cleanup events.

As a backup, the watcher has a timer that implements an exponential
backoff strategy, which is constrained by a minimum and maximum that the
user can configure.

Below the cpu difference is shown of running both main and this branch
against the same scrape target.

<img width=""2496"" alt=""image""
src=""https://user-images.githubusercontent.com/2617411/232099483-7e5c36fa-9360-4eb9-8240-687adf46e330.png"">

The yellow line is the latest main build from where this branch started,
and the green line is this branch. Both promtails tailing docker logs,
and using the following metrics to get cpu usage from cadvisor:
```
avg by (name) (rate(container_cpu_usage_seconds_total{job=~"".+"", instance=~"".+"", name=~""promtail-wal-test_promtail.+""}[$__rate_interval]))
```

**Which issue(s) this PR fixes**:
Part of https://github.com/grafana/loki/issues/8197

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",70,61,1,0,"2018-04-16 10:25:39","1857.74"
"grafana/loki","33bf36aa21060c7e69dcd4bbf2a5346c26f6b466","dannykopping","2022-10-12 15:22:18","true","Promtail: flush logs on exit (#7400)

Promtail is using the line-buffered logger (https://github.com/grafana/loki/pull/6954), and log messages were not being printed on exit",91,54,1,1,"2018-04-16 10:25:39","1637.21"
"grafana/loki","bedab491ac1a262570f5a56996ea97d85a7df4f6","cyriltovena","2020-06-04 13:09:41","true","Allows to change the log driver mode and buffer size. (#2116)

Before those configs where not allowed, but docker can use them to have a different log delivery behaviour.

see https://docs.docker.com/config/containers/logging/configure/#configure-the-delivery-mode-of-log-messages-from-container-to-log-driver

Potentially fixes #2017

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",128,26,0,1,"2018-04-16 10:25:39","778.61"
"grafana/loki","2861c0036fb1866d15edd3c3a543488b71ce9bfe","cyriltovena","2023-01-12 23:57:59","true","Improve the JSON parser performance. (#7723)

Sorry I couldn't help myself and worked a bit on the JSON parser by
using another library that allows way less allocations.

On top of this, the parser code is also much simpler to understand.

I realize that we could possibly also intern/cache (limited obviously)
extracted JSON value per key. I would do it per key because otherwise, a
high cardinality key can take over the intern/cache which will make it
worthless. Happy to walk someone through the idea, I think this would be
a big jump too.

Would be great to run and test this in our dev environment using some
JSON queries before releasing it.

```
❯ benchstat before.txt after.txt                                                                                                              
name                             old time/op    new time/op    delta
_Parser/json/no_labels_hints-10    2.53µs ± 0%    2.16µs ± 2%  -14.59%  (p=0.008 n=5+5)
_Parser/json/labels_hints-10       1.93µs ± 0%    1.47µs ± 0%  -23.96%  (p=0.008 n=5+5)

name                             old alloc/op   new alloc/op   delta
_Parser/json/no_labels_hints-10      656B ± 0%      280B ± 0%  -57.32%  (p=0.008 n=5+5)
_Parser/json/labels_hints-10         512B ± 0%      176B ± 0%  -65.62%  (p=0.008 n=5+5)

name                             old allocs/op  new allocs/op  delta
_Parser/json/no_labels_hints-10      46.0 ± 0%      18.0 ± 0%  -60.87%  (p=0.008 n=5+5)
_Parser/json/labels_hints-10         39.0 ± 0%      12.0 ± 0%  -69.23%  (p=0.008 n=5+5)
```",97,57,1,1,"2018-04-16 10:25:39","1727.56"
"grafana/loki","15c4ebb35fc656366ec8301750c5622314417433","cyriltovena","2020-04-16 17:48:44","true","Fixes case handling in regex simplification. (#1950)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",115,24,0,1,"2018-04-16 10:25:39","730.81"
"grafana/loki","986fe5cf05324709e0c821e25d2169459f252bf3","cyriltovena","2022-04-26 15:13:41","true","Remove empty match within concat of regex (#6026)

* Remove empty match within concat of regex

* add back tests",172,48,0,1,"2018-04-16 10:25:39","1471.2"
"grafana/loki","9cb87c2c7dabb546c2caf5498192ad6d7295a09c","tomwilkie","2018-05-16 10:54:00","false","Fix a few NPEs.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",0,1,0,0,"2018-04-16 10:25:39","30.02"
"grafana/loki","0a81f708007566360a5c35d49ae3af5fcc9dd2e6","cyriltovena","2021-01-20 20:33:34","true","Improves checkpointerWriter memory usage (#3188)

* Logs PushRequest data.

This will allows to find information about received size and total entries per tenant.

Example of a log from my dev testing:

```
level=debug ts=2021-01-15T11:16:21.735663076Z caller=http.go:67 org_id=3927 traceID=11c4774c6ec4bbf4 msg=""push request parsed"" path=/loki/api/v1/push content-type=application/x-protobuf body-size=""11 kB"" streams=5 entries=298 streamLabelsSize=""1.9 kB"" entriesSize=""45 kB"" totalSize=""47 kB""
```

Of course this means we can use LogQL on this.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Move metrics to avoid request traversal twice.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes tests.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Set a base benchmark.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Improves checkpointwriter memory usage.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Kavi feedback.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",113,33,0,1,"2018-04-16 10:25:39","1004.92"
"grafana/loki","ec7d453fefbb7ce6023db4cd6ba56b9a1824e603","cyriltovena","2019-05-17 07:26:44","false","fixes ingester querier not honoring filters (#594)",101,13,0,1,"2018-04-16 10:25:39","396.13"
"grafana/loki","15a372387f6d7570cfc7bbc8ee60973f1fcb349f","garo","2019-04-09 06:42:01","false","Fix underscores with Markdown rendering in Promtail examples",99,12,0,0,"2018-04-16 10:25:39","352.84"
"grafana/loki","405cdab96a67145293d8f1d91155130fd23887ad","JordanRushing","2022-06-07 21:41:21","true","Expose Memberlist status page on MemberlistKV module init (#6322)

* Expose Memberlist status page on MemberlistKV module init

Signed-off-by: JordanRushing <rushing.jordan@gmail.com>

* Add Server dependency to MemberlistKV module to properly serve status page

Signed-off-by: JordanRushing <rushing.jordan@gmail.com>",72,50,0,0,"2018-04-16 10:25:39","1512.47"
"grafana/loki","305936a861c2c9a957649a6cf128930c8c51ef2b","dannykopping","2022-07-18 07:47:52","true","Update production-ready Loki in docker-compose (#6691)

* Improved docker-compose setup:

- S3-like storage
- Interactive debugging by optionally exposing dlv ports
- Improve performance
- Use SSD mode (read/write)
- GroupCache
- Latest versions of loki, promtail, grafana
- Scaling

* Adding diagram & updated README

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Upgrade guide

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Adding steps to build debug image

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Add prometheus

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Add datasources and disable Grafana auth

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",69,51,0,1,"2018-04-16 10:25:39","1552.89"
"grafana/loki","369a6ac2f1505371dabc2a7972c88a57a77a44c7","dannykopping","2021-12-03 14:18:42","true","Adding PR gatekeeper (#4869)

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",215,43,0,1,"2018-04-16 10:25:39","1322.91"
"grafana/loki","3547d8948c2163b81578c9cee4d185f65063c5e4","alanconway","2022-05-17 19:28:39","true","Fix typo in operator/docs/hack_operator_make_run.md (#6180)",74,49,0,0,"2018-04-16 10:25:39","1492.38"
"grafana/loki","aca1f6c327dd30d93fd8bf1212850ebb802e59e9","oddlittlebird","2020-07-30 16:57:49","true","Create CODEOWNERS (#2454)",129,27,0,0,"2018-04-16 10:25:39","834.77"
"grafana/loki","2629e9a3d67445a7503e4606f0858bf83f3e21f8","slim-bean","2020-05-05 20:28:09","true","fixes the cpu usage graphs (#2044)

Signed-off-by: Ed Welch <edward.welch@grafana.com>",115,25,0,1,"2018-04-16 10:25:39","749.92"
"grafana/loki","0401fda6fa9f91d25794dba75c445f87dc6997d2","DanCech","2018-12-06 20:18:51","true","simple script to generate promtail yaml",9,8,0,0,"2018-04-16 10:25:39","230.41"
"grafana/loki","6f5e6b637b81e8d0fd90dd577d381f41e85c274b","julienduchesne","2021-06-09 13:15:48","true","Fix broken link in `Windows Event Log` scraping docs (#3828)",204,38,0,0,"2018-04-16 10:25:39","1148.87"
"grafana/loki","ef56b7375820d49d6360042cb80b6c99a268fdf8","MichelHollands","2022-04-21 05:58:36","true","Add query filtering to the tailer (#5969)

* Add some comments

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Use deletes in tail

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Change error message

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",171,48,0,1,"2018-04-16 10:25:39","1465.81"
"grafana/loki","48b65834a0972a595379e46e0731904bd72faebb","MichelHollands","2020-12-17 21:20:43","true","Make server publicly available (#3087)

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",122,32,0,1,"2018-04-16 10:25:39","971.95"
"grafana/loki","6d7d537518f524c57e9a1c4ced5ad17f396a4a80","xperimental","2022-11-29 18:00:43","true","operator: Replace fifocache usage by embedded_cache (#7808)",94,55,1,1,"2018-04-16 10:25:39","1684.32"
"grafana/loki","cb6cc7d878a87a985d1d981e0a23b5e8b7333b79","MattiasSegerdahl","2023-05-01 08:20:25","true","Update recording-rules.md (#9324)

**What this PR does / why we need it**:

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",79,60,1,0,"2018-04-16 10:25:39","1841.16"
"grafana/loki","4c4c7e3010fae0ae51c9931fd9bd493b06576bd2","darxriggs","2023-03-27 07:57:25","true","Promtail: Fix examples how to build it (#8898)

The build flags have to be provided before the package paths.

Otherwise the `build` command fails with this error:
> malformed import path ""--tags=promtail_journal_enabled"": leading dash

See `go help build`:
> usage: go build [-o output] [build flags] [packages]",80,59,1,0,"2018-04-16 10:25:39","1801.9"
"grafana/loki","b99be1d310bf4a297f6eacc2b0017b0b374c7509","dannykopping","2021-10-07 15:01:04","true","Ruler: Overwrite instead of merge remote-write headers (#4431)

* Overwrite instead of merge remote-write headers

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Allowing for clearing of headers when empty map is given

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",139,42,0,1,"2018-04-16 10:25:39","1266.94"
"grafana/loki","d32f3f7b68e77e3268a61d7bce152bafc54fb2b4","dannykopping","2022-11-07 10:30:17","true","Querier: remove expensive & low-value debug log line (#7532)

Removes a low-value debug log line that, in one recent example, can logs
tens of thousands of times in a short span of time.

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",88,55,1,1,"2018-04-16 10:25:39","1662"
"grafana/loki","ee0f46beed12f482032649966ece7fd1df7abdb5","jdbaldry","2023-02-07 09:07:04","true","Update publishing workflows to use organization secret (#8435)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>",79,58,1,0,"2018-04-16 10:25:39","1751.95"
"grafana/loki","449dd819810a4b04731e34efbd202af9914f0e55","dannykopping","2022-08-24 07:29:08","true","Restoring metrics removed by #6957, simplifying implementation (#6962)

Adding all available metrics from Go

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",82,52,0,1,"2018-04-16 10:25:39","1588.88"
"grafana/loki","c0a66448278fcb6283ebde91c692a570b66bdcba","daniellee","2018-12-11 18:40:27","true","Merge pull request #64 from grafana/readme-provisioning

adds Grafana provisioning example to the readme",12,8,0,0,"2018-04-16 10:25:39","235.34"
"grafana/loki","6d2b3e8b76ef11a0f1308bd91ccb1dc071d17b55","slim-bean","2023-07-18 21:17:42","true","Loki: Fix a merge error when getting rules from sharded rulers using the `/prometheus/api/v1/rules` endpoint (#9973)

**What this PR does / why we need it**:

The `/prometheus/api/v1/rules` api endpoint will return all the rules
currently loaded and being evaluated by the ruler.

Previously when we merged the rule groups from all rulers in a sharded
ruler setup, we only used the rule group name as the key in the map used
for merging the results. This introduced a bug when multiple rule groups
have the same name but in different namespaces, leading to some rules
being reported in the incorrect namespace.

This is just a visualization bug, the rules are in the correct space and
operating as defined, however Grafana uses this API in conjunction with
`/loki/api/v1/rules` to track the state of a rule being added or
removed. The `/loki/api/v1/rules` endpoint returns rules as they exist
in storage.

When someone has multiple rule groups with the same name in different
namespaces this can lead to the Grafana UI showing rules in a perpetual
state of creating and deleting as it's possible for rules to be returned
from `/prometheus/api/v1/rules` in the wrong group.

Adding the namespace to the key used in the map for merging rule results
prevents this issue.

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

Signed-off-by: Edward Welch <edward.welch@grafana.com>",57,63,1,1,"2018-04-16 10:25:39","1918.7"
"grafana/loki","8d3c50f40d66e049bed539ac735aa8531b78d380","owen-d","2023-01-23 22:48:14","true","tsdb docs first pass (#8048)

Co-authored-by: J Stickler <julie.stickler@grafana.com>",83,57,1,1,"2018-04-16 10:25:39","1738.52"
"grafana/loki","738b68a5eb83049e772a7c56d3d52ed82d0759cc","jeschkies","2023-01-12 11:10:17","true","Install build dependencies to cross build promtail. (#8111)",100,57,1,1,"2018-04-16 10:25:39","1727.03"
"grafana/loki","40e05198f95a9856367401c32c0edd082075935b","sandeepsukhani","2022-02-02 12:49:18","true","fix a panic in index-gateway caused by double closing of a channel (#5298)",277,45,0,1,"2018-04-16 10:25:39","1381.85"
"grafana/loki","4b5b16569d879e4d218b6b8327410b7b06e4abd1","afayngelerindbx","2022-08-26 07:07:13","true","compactor: adds tunable to control upload parallelism (#6817)

**What this PR does / why we need it**:
This can help with compaction latency. I patched the compactor to set this to 100.

**Which issue(s) this PR fixes**:
Helps with #6775

**Checklist**
- [x] Documentation added",82,52,0,0,"2018-04-16 10:25:39","1590.86"
"grafana/loki","776c9df9e3586a63cb331737c50024314436908e","jeschkies","2021-01-07 20:37:14","true","Give another example for multiline. (#3138)

* Give another example for multiline.

Summary:
This is a new example I've tested. It uses the zero-width space
character `U+200B` to identify the first line of a multline block.

* Update docs/sources/clients/promtail/stages/multiline.md

Co-authored-by: Cyril Tovena <cyril.tovena@gmail.com>

* Apply suggestions from code review

Co-authored-by: Cyril Tovena <cyril.tovena@gmail.com>",116,33,0,1,"2018-04-16 10:25:39","991.92"
"grafana/loki","0a0ad68af23cb459913e0b1696eb7a7bb8d6099f","sandeepsukhani","2020-08-27 13:45:13","true","fix dir setup based on which mode it is running (#2559)",121,28,0,1,"2018-04-16 10:25:39","861.64"
"grafana/loki","04a93b78803f95f5ad13b1a37bc93b6eb1489df0","pracucci","2019-10-21 18:22:14","false","promtail: fix handling of JMESPath expression returning nil while parsing JSON (#1179)",66,18,0,0,"2018-04-16 10:25:39","550.58"
"grafana/loki","f20244d7ac579958f420badb9ce5f368c23e3b8c","rfratto","2019-08-28 08:46:14","true","ksonnet: remove prefix from kvstore.consul settings in loki config (#946)

prefix has been removed as a field in Cortex and needs to be removed
from the ksonnet as well.",122,16,0,1,"2018-04-16 10:25:39","497.18"
"grafana/loki","b9ea7981639ca30551b55680ee8ab9019c542a3d","slim-bean","2023-01-12 16:37:02","true","Remove public key used for signing helm charts as we are removing chart signing (#8104)

We are no longer signing helm charts, this removes the pub key which as
associated with this.

See: https://github.com/grafana/helm-charts/pull/2107

Signed-off-by: Edward Welch <edward.welch@grafana.com>",100,57,1,1,"2018-04-16 10:25:39","1727.26"
"grafana/loki","0011c2d7b78180a0f99e20c54c93ddde65078402","owen-d","2022-06-08 18:02:03","true","TSDB/index-sampling-wiring (#6338)

* wires up index sampling

* regens protos

* mockstore stats impl

* addtl linting

* renames to avoid duplicate via linter",72,50,0,1,"2018-04-16 10:25:39","1513.32"
"grafana/loki","0eabd8c8676377c413a7a1ebe933b1ded7b1216e","RichiH","2020-06-29 16:36:13","true","Fix typo (#2273)

Signed-off-by: Richard Hartmann <richih@richih.org>",131,26,0,0,"2018-04-16 10:25:39","803.76"
"grafana/loki","d63add09c502249db5a36c497951da92696e5e0c","simonswine","2022-08-12 16:29:03","true","Fix free port allocation flake (#6898)

Occassionaly we can see test flakes like that:

> server: listen tcp :34473: bind: address already in use

This is because we allocated ports by checking if they are free and then
using them. Altough there is a chance that already allocated ports are
used twice. This changes prevents this from happening by keeping track
of the ports that are about to be used.",83,52,0,0,"2018-04-16 10:25:39","1577.25"
"grafana/loki","6f3489e661f880fa0553faa43661091bcab550e9","adityacs","2020-03-03 16:10:32","true","Fix single job with multiple service discovery elements (#1770)",117,22,0,1,"2018-04-16 10:25:39","682.49"
"grafana/loki","89b04a97b38fb7dcdec286ae5ab712e8b1d70f07","MasslessParticle","2022-02-02 22:30:42","true","storage: update azure blobstore client to use new sdk (#5302)

* Update azure blobstore client to use new sdk

* changelog

* fix hardcoded maxretries

* linter

* more linting

* Fix flaky test",278,45,0,1,"2018-04-16 10:25:39","1382.25"
"grafana/loki","60edfe0006b0adf6041b7ac437b8c47d66d1ead6","MasslessParticle","2023-08-30 06:22:35","true","Implement ""or"" statement in line filters (#8962)

It might be nice to not force a user to use `|~` when they need to
express `or` in LogQL.

Example:
`{app=""foo""} |= ""foo"" or ""bar""`

Edit:
A ton of this is generated code or refactors. I've highlighed the parts
most interesting to a reviewer

---------

Co-authored-by: Karsten Jeschkies <karsten.jeschkies@grafana.com>",46,64,1,1,"2018-04-16 10:25:39","1960.08"
"grafana/loki","4ca7676272c4ff92c67c5dac07c173f5bf7e56cf","MasslessParticle","2022-07-27 22:45:45","true","Groupcache improvements (#6752)

* Groupcache communicates with own server

* Don't distribute the index cache

* Fix tests

* go mod fix",78,51,0,1,"2018-04-16 10:25:39","1562.51"
"grafana/loki","9735f91bb200f016dc70ed18b02af19d55199f4e","tomwilkie","2018-05-22 15:36:39","false","Dedupe entries; don't print URL.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",1,1,0,0,"2018-04-16 10:25:39","36.22"
"grafana/loki","81f2cb4aea2cd5087bcb2a7fdc374d0342979619","kavirajk","2023-08-24 07:57:09","true","release-notes: Add back the entry on hedged requests improvements. (#10327)

**What this PR does / why we need it**:
This PR somehow overwrote the entry.
https://github.com/grafana/loki/pull/10286/files

probably some rebase issue.

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",50,64,1,1,"2018-04-16 10:25:39","1954.15"
"grafana/loki","f980febd975f24cc75240f4833849493ee013fce","kavirajk","2021-06-07 10:18:51","true","Update the docker-driver doc about default labels (#3814)

* Update the docker-driver doc about default labels

Add more information on `container_name` default label and when it will be added to log line.

* Update docs/sources/clients/docker-driver/configuration.md

Co-authored-by: Rui Lopes <rgl@ruilopes.com>

* Make it clear when to use pipeline_stages vs relabelling on docker-driver

Co-authored-by: Rui Lopes <rgl@ruilopes.com>",200,38,0,1,"2018-04-16 10:25:39","1146.75"
"grafana/loki","e0dacd2795ebc4179e0b34250b170bb706c9ee5e","owen-d","2020-05-14 21:11:48","true","removes yolostring (#2078)",118,25,0,1,"2018-04-16 10:25:39","758.95"
"grafana/loki","86cb8d52d335d9287620cad2014438688de27c4b","owen-d","2022-04-01 14:01:26","true","ensure tsdb is sorted by hash then labelset (#5746)",312,47,0,1,"2018-04-16 10:25:39","1440.9"
"grafana/loki","56fbb3b771f534b4f723455dba6f48065a0e7ed4","dannykopping","2023-03-10 09:21:09","true","Expand `which-release.sh` to cover weekly builds as well (#8768)

**What this PR does / why we need it**:
Expanding tool introduced in https://github.com/grafana/loki/pull/8706

**Special notes for your reviewer**:
Knowing which, if any, weekly builds the commit is in can also be
useful.

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",87,59,1,1,"2018-04-16 10:25:39","1784.96"
"grafana/loki","391ffcec69122b0807f49ee7e15faf58a8e949ed","paul1r","2023-08-17 17:19:29","true","Add compat libs to Loki Canary BoringCrypto Docker image (#10287)

**What this PR does / why we need it**:
Add compatibility libs to BoringCrypto Loki Canary image. As it is
dynamically linked, the runtime libs need to be added so the executable
can run",52,64,1,0,"2018-04-16 10:25:39","1947.54"
"grafana/loki","922b2d02cde8c8322f167523203449814ac29931","slim-bean","2019-07-01 22:16:19","false","changing the log length histogram to be a normal histogram with only a `path` label, also removing the label values when no longer tailing the file.  Following the same pattern we used for readBytes and totalBytes.",97,14,0,1,"2018-04-16 10:25:39","440.74"
"grafana/loki","2bad98dc8e1f9c4ddfb415a91f93fe0ea32b4c71","bboreham","2023-01-06 23:47:24","true","dashboards: add k8s resource requests to CPU and memory panels (#8047)

**What this PR does / why we need it**:

This lets administrators see at a glance if requests are too low, which
risks overloading nodes, or too high which wastes provisioning.

Example:
<img width=""356"" alt=""image""
src=""https://user-images.githubusercontent.com/8125524/210851875-f9ccbb60-1a3c-4276-b65f-645aec0268be.png"">

**Checklist**
- [x] Reviewed the `CONTRIBUTING.md` guide
- NA Documentation added
- NA Tests updated
- [x] `CHANGELOG.md` updated
- NA Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>",97,57,1,0,"2018-04-16 10:25:39","1721.56"
"grafana/loki","017bcefb3f746b56cb66e898b8c178c1e8e5ce60","gouthamve","2019-05-06 05:15:18","true","Better buckets for chunk sizes (#529)

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>",98,13,0,0,"2018-04-16 10:25:39","385.03"
"grafana/loki","88ef940ede3ecf965481a104b4fdb35cad7bb79f","slim-bean","2021-11-16 00:52:17","true","Loki: Set querier worker max concurrent regardless of run configuration. (#4761)

* always set the querier worker MaxConcurrentRequests

* removing a test which doesn't apply as this setting isn't being set in worker_service.go anymore",200,43,0,1,"2018-04-16 10:25:39","1305.35"
"grafana/loki","199e3341261b9b2b8d2e2cbc0ba9f83f652f8535","adityacs","2020-05-13 06:32:02","true","Update loki to cortex master (#2030)",121,25,0,1,"2018-04-16 10:25:39","757.34"
"grafana/loki","3f4a663dbe555a3fdc372092b5f5c3ce2b143aa4","owen-d","2022-06-09 17:53:31","true","Tsdb/index sampling endpoint (#6347)

* index sampling endpoint

* fix bug in withTenantLabelMatcher

* show zero values in stats

* handles new errcase

* fixes comments",71,50,0,1,"2018-04-16 10:25:39","1514.31"
"grafana/loki","c91493a16bad171b02d3a46c053d7703c6621309","blockloop","2021-03-17 19:28:10","true","create querier, and querier frontend",159,35,0,0,"2018-04-16 10:25:39","1061.88"
"grafana/loki","64814851595ae577ce2dd4c242ccfdc071e738e5","belminf","2019-03-09 20:16:18","false","Adds netpol to allow promtail to reach loki",90,11,0,0,"2018-04-16 10:25:39","323.41"
"grafana/loki","26d2989086b0347a26a48c8d75106954eed1e11b","periklis","2022-10-18 07:34:09","true","Expose ring and memberlist handlers through internal server listener (#7436)",89,54,1,1,"2018-04-16 10:25:39","1642.88"
"grafana/loki","f1264555f59a0fdda9bab3cb6bea8a16430db93d","daixiang0","2019-04-11 01:56:30","false","Update helm docs

Signed-off-by: Xiang Dai <764524258@qq.com>",97,12,0,0,"2018-04-16 10:25:39","354.65"
"grafana/loki","82fac990a1c757cc471e9d065b6dcdebedf6f919","ssncferreira","2022-02-03 10:42:39","true","Update promtail to support duration string formats (#5290)

* Update promtail to support duration string formats

* Address comments",276,45,0,0,"2018-04-16 10:25:39","1382.76"
"grafana/loki","d36dd9edc42850041bc4a46f00b24ea176cebc69","ssncferreira","2022-12-21 13:18:09","true","Add README file to doc-generator tool (#7983)

**What this PR does / why we need it**:

Add README file to doc-generator tool",97,56,1,0,"2018-04-16 10:25:39","1706.12"
"grafana/loki","b5ed39c599d08e90a17f6f259dc19a1689b6e7af","thepalbi","2023-02-06 23:27:09","true","Promtail WAL support: Implement writer side (#8267)

Co-authored-by: Callum Styan <callumstyan@gmail.com>",80,58,1,0,"2018-04-16 10:25:39","1751.54"
"grafana/loki","7aa596752d33e8a0445aec59c23642b83baf4328","nervo","2023-01-19 06:59:28","true","Helm - Loki: Introduce runtimeConfig (#8179)",85,57,1,0,"2018-04-16 10:25:39","1733.86"
"grafana/loki","07487cd89d819957147c5e80fd3ecfea80c44686","owen-d","2023-01-13 23:02:49","true","fixes bug with queryIngesterWithin logic in asyncStore ingester stats… (#8145)

Fixes a previous mistake in the logic calculating when to skip querying
ingesters in the async store Statistics method. Notably `through.After`
should be `through.Before` when skipping querying ingesters as that's
when there's no overlap with the `query-ingesters-within` period:

```go
	// OLD CODE BELOW
	if a.queryIngestersWithin != 0 {
		// don't query ingesters if the query does not overlap with queryIngestersWithin.
		if !through.After(model.Now().Add(-a.queryIngestersWithin)) { // <----- should be through.Before
			return a.Store.Stats(ctx, userID, from, through, matchers...)
		}
	}
```

I discovered the problem while debugging querier OOMs during a
boltdb-shipper -> tsdb migration and ultimately found this happened
under the following circumstances:

* Queries over high volumes of _recent_ data wouldn't query ingesters
for index metadata
* Without index metadata, we only checked storage metadata
* There is a delay before we ship the index to storage, meaning we don't
see it if ingesters are skipped
* Calculating ideal shard factors without recent data for queries that
only touch recent data _dramatically_ underestimates the desired shard
factor
* Queries aren't split enough and get scheduled onto too few querier
replicas
* They oom. We had some fun examples like a single replica trying to
download 419,000 chunks/query

To be clear, this is still a hypothesis, but a plausible one, especially
after finding the boolean logic error this PR fixes.

Instead of changing this one line, I took the opportunity to refactor
this into a shared utility used by our other `GetChunkRefs` method which
is already tested, ensuring the logic works as expected. I also added
some more logging visibility into this code so we can understand what
the difference is when querying statistics from storage vs ingesters.
Finally, I added a helper to prepare our `Stats` objects to be logged
which is now used in a few places.",94,57,1,1,"2018-04-16 10:25:39","1728.53"
"grafana/loki","4464abbb7065516b1d8e2e686d89601f75b72923","jeschkies","2023-01-11 13:52:46","true","Use GiB and bytes for sizing tool. (#8078)",101,57,1,1,"2018-04-16 10:25:39","1726.14"
"grafana/loki","10b869c82e2a903898ce3a9462f3fef0d2dd60a5","mar4uk","2022-12-14 13:48:05","true","Move to fork github.com/grafana/gomemcache (#7936)",101,56,1,0,"2018-04-16 10:25:39","1699.14"
"grafana/loki","bf9eb33385760f2395ec7f4dfef9a577b628f023","trevorwhitney","2022-01-13 19:00:16","true","add jsonnet for simple scalable deploymnet (#5138)",262,45,0,1,"2018-04-16 10:25:39","1363.11"
"grafana/loki","72666dc799f18dc5c922bf3f8736d9cdb82a1276","owen-d","2021-01-05 15:29:41","true","self documenting pipeline process ifc (#3122)",113,33,0,1,"2018-04-16 10:25:39","989.71"
"grafana/loki","081cc024d67d0292a377f5995f4822a07a8e38af","andsens","2020-10-27 20:17:43","true","fluent-plugin: Improve escaping in key_value format (#2434)

The key_value format does not seem to be well specified.
This change assumes ""logfmt"" as the format and escapes
values accordingly:
The code itself is lifted from here:
https://github.com/csquared/node-logfmt/blob/e279d43cde019acfcca0abe99ea6b7ce8327e1f7/lib/stringify.js
Grafana seems to handle values escaped in this manner
much better than before.
e.g.:
query=""{program=""loki""}"")
was shown as (IIRC)
query=""{program=
and is now displayed correctly.

As an added bonus only values that require quoting will
actually be quoted, improving readability and derived
fields regexes.",121,30,0,0,"2018-04-16 10:25:39","921.91"
"grafana/loki","68568f141e7837a390d5e4fc3b02b67605dcd1ad","adityacs","2020-08-08 16:41:00","true","colored labels output for logcli (#2470)

* colored labels output for logcli

* add period to all cli description",125,28,0,1,"2018-04-16 10:25:39","842.76"
"grafana/loki","c715f862db44e9367094f5046710bd7ae53c7367","slim-bean","2020-02-25 22:55:50","false","strip the leading 'v' in front of docker images based on repo tags, grafana/loki:v1.4.0 -> grafana/loki:1.4.0
unpin the drone manifest plugin

Signed-off-by: Edward Welch <edward.welch@grafana.com>",117,22,0,1,"2018-04-16 10:25:39","674.77"
"grafana/loki","899faf1e6c2263ef4c5780c79fddfdc01f56fd58","tomwilkie","2019-02-05 12:00:35","false","Don't commit jsonnet lock file.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",80,9,0,0,"2018-04-16 10:25:39","289.07"
"grafana/loki","96223322ba0dd4803c7f500029b0817d26f62d49","tomwilkie","2018-07-03 11:01:58","false","Make queries take nanoseconds since epoch.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",4,3,0,0,"2018-04-16 10:25:39","77.03"
"grafana/loki","3f6eefb883d539ff99972a9cb02fafa2dec8127d","tomwilkie","2018-11-20 13:42:02","false","RingConfig is in the IngesterConfig, so don't repeat it.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",5,7,0,0,"2018-04-16 10:25:39","214.14"
"grafana/loki","644d4beff7810ab32c110dd258b6abfd2347ee5c","jgehrcke","2020-03-09 14:52:32","true","docs: observability.md: clarify lines vs. entries (#1738)

* docs: observability.md: vscode md format

* docs: observability.md: clarify lines vs. entries

Signed-off-by: Dr. Jan-Philip Gehrcke <jp@opstrace.com>",117,23,0,0,"2018-04-16 10:25:39","688.44"
"grafana/loki","83ba93c867d9a29a98fa7d167b53740aa4dbf1e7","MasslessParticle","2023-03-14 18:09:22","true","fix to-string for noop label filters (#8799)

Label Filter optimizations omit `.*` label filters from the execution
pipeline but intruduced a bug where those stages were also ommitted from
calls to `String` on the expression. This results in unparsable queries
and panics when queries are cloned via `query.String()`

This PR makes `noopLabelFilter` embed matchers and inherit their
`String` method just like the `StringLabelFilters` do",89,59,1,1,"2018-04-16 10:25:39","1789.32"
"grafana/loki","8f8f12713db4664afef5b29c08e9e2b1d2452a4f","owen-d","2021-08-18 15:08:24","true","add unordered writes to local config (#4149)",132,40,0,1,"2018-04-16 10:25:39","1217.95"
"grafana/loki","b65e11ec9b1caf96b246933a0966248b99b5df02","conorevans","2022-06-21 22:53:31","true","fix(documentation): correct spelling and scrape_config (#6454)

Signed-off-by: Conor Evans <coevans@tcd.ie>",70,50,0,0,"2018-04-16 10:25:39","1526.52"
"grafana/loki","c03614efe5032c7e4b0a94a12e94407bd806526b","KMiller-Grafana","2022-01-06 08:35:24","true","Docs: add an empty subsection for v2.4.2 bug fix items (#5056)",253,45,0,0,"2018-04-16 10:25:39","1355.67"
"grafana/loki","1dc0d978e47f6dacabcb3e2953fbea6599308832","JordanRushing","2022-04-13 07:18:59","true","Add a Ring to IndexGateway (#5358)

* Begin to add a Ring to IndexGateway

Signed-off-by: Jordan Rushing <jordan.rushing@grafana.com>

* Implement missing methods for IndexGateway.

- Implement missing methods for the IndexGateway to be used as a
  BasicLifecyclerDelegate. The methods are stored in a lifecycle file
  and follow the same approach of the Ruler ring
- Make Gateway public and add missing parameters to the IndexGateway's
  initialization method

* Fix failing linter

Signed-off-by: Jordan Rushing <jordan.rushing@grafana.com>

* Implement IndexGateway support for dynamic configs.

- Add memberlist as a dependency of the IndexGateway
- Add IndexGateway support for the common configuration section
- Modify Loki to register IndexGateway flags. This fixes the default
  flag values for the IndexGateway
- Make IndexGateway configurations public. Without this, we can't use
  them.

* Implement NewBasicService for the IndexGateway.

- If IndexGateway is running with a ring, it uses the IdleService.
  Otherwise, it uses the BasicService
- Implement IndexGateway support to handle ring HTTP pages

* Test IndexGateway dynamic configuration.

* Implement new IndexGatewayGRPCPool entity.

* Make IndexGateway attributes public.

* Implement IndexGatewayRing reader.

- Implement new IndexGatewayRing service
- Add IndexGatewayRing as a Store dependency
- Modify store to pass IndexGatewayRing as a parameter
- Implement IndexGatewayClient ring mode

* Implement Ring mode in the IndexGatewayClient.

- Moves IndexGateway configuration to the IndexGatewayClient struct
  within the boltdb-shipper
- Reuse the IndexGatewayClient everywhere
- Implement IndexGateway gRPC pool

* Add new ring index gateway parameter to new Store calls.

* Use errors.Wrap instead of fmt.Errorf.

* Extract tenantID from context instead of iterating on queries.

* Remove indexGateway ring param.

- Instead, add it to the store configuration and bubble it down to
  deeper modules.

* Split IndexGateway server from client implementation.

* Fix imports order.

* Remove ring as parameter from IndexGateway-related funcs.

* Fix default flag value and IndexQuerier type.

* Remove additional mode field and reuse it from cfg.

* Remove redundant service init.

* Add sanity check for IndexGateway client constructor.

* Move mode assigning to initStore method.

* Reorder IndexGateway constructor.

* Rewrite indexClient chunk.IndexClient as querier Index.Querier.

* Fix flag registration for IndexGateway server.

- In a previous PR I changed how it works and forgot to update how the flag
  registration occurs.

* Fix flag registration for test.

* Keep only one reference to indexQuerier.

* Add guard-clause on IndexGatewayRing service.

- Without this, we would be initializing ring-related things even if the
  index gateway is in simple mode.

* Move IndexGatewayClientCfg to gateway_client file.

* Update CHANGELOG.md for `IndexGateway` support for `RingMode`

Signed-off-by: JordanRushing <rushing.jordan@gmail.com>

* Update GatewayClient to use dskit tenant package

Signed-off-by: JordanRushing <rushing.jordan@gmail.com>

* Add listenport configuration for IndexGateway and Ring

Signed-off-by: JordanRushing <rushing.jordan@gmail.com>

* Make IndexGateway replication factor configurable.

- Add `replication_factor` flag to the IndexGateway config struct
- Modify Index Gateway ring config struct to be inline with a new
  struct, since it doesn't expose a replication factor config
- Modify dynamic config wrapper to reuse a common replication factor on
  the Index Gateway ring

* Randomize replication set access.

- If we don't randomize access, we'll always access same Index Gateway
  instances in same order for the same tenant

* Remove unwanted merge HEAD tags.

* Move away from stores/chunk package.

* Pass util_log in factory.

* Change index gateway client ring to ignore replicas.

- This is accomplished by using
 `NewIgnoreUnhealthyInstancesReplicationStrategy`
- It is already done by  the server

* Refactor where the common replication factor is applied.

* Housekeeping config_wrapper IndexGateway configs.

- Remove unnecessary/wrong comments
- Only set replication factor at a single place

Co-authored-by: Dylan Guedes <djmgguedes@gmail.com>",320,48,0,0,"2018-04-16 10:25:39","1452.62"
"grafana/loki","29cccbe576d4a32d9ca5dc07bb24edb9d00c573f","liguozhong","2022-01-11 08:08:43","true","[enhancement] querier cache: WriteBackCache should be off query path (#5083)

* [enhancement] querier cache: WriteBackCache should be off query path #5072

* [enhancement] querier cache: WriteBackCache should be off query path #5083

* Update pkg/storage/chunk/chunk_store_utils.go

Co-authored-by: Danny Kopping <dannykopping@gmail.com>

* [enhancement] querier cache: WriteBackCache should be off query path #5083

* [enhancement] querier cache: WriteBackCache should be off query path #5083

* Update pkg/storage/chunk/cache/cache.go

Co-authored-by: Danny Kopping <dannykopping@gmail.com>

* [enhancement] querier cache: WriteBackCache should be off query path #5083

* [enhancement] querier cache: WriteBackCache should be off query path #5083

* Update pkg/storage/chunk/chunk_store_utils.go

Co-authored-by: Danny Kopping <dannykopping@gmail.com>

* [enhancement] querier cache: WriteBackCache should be off query path #5083

Co-authored-by: Danny Kopping <dannykopping@gmail.com>",256,45,0,1,"2018-04-16 10:25:39","1360.65"
"grafana/loki","acc3a2fe2306d5f3669e5be47f681f51a7a7679e","kavirajk","2022-07-29 08:07:06","true","chore(groupcache): Fix panic with stats collector wrapper (#6798)

* chore(groupcache): Fix panic with stats collector wrapper

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* update

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",76,51,0,1,"2018-04-16 10:25:39","1563.9"
"grafana/loki","1f2b450f2d1363ce6460149f2ba6c6e21003e9bc","salvacorts","2022-03-17 15:43:35","true","Add inflight requests metric to scheduler (#5658)",308,47,0,1,"2018-04-16 10:25:39","1426.97"
"grafana/loki","a4db1a435953195051adc9f7e74e035e0a9b8158","owen-d","2021-07-19 14:22:30","true","Headblock interop (#3995)

* merge feature/unordered-replay

* interoperable head chunks",105,39,0,1,"2018-04-16 10:25:39","1188.91"
"grafana/loki","08e741b7c604cf397d7d2f3dd417cb8a067dde91","MOZGIII","2023-07-21 10:05:49","true","helm: Allow altering the canary label name (#9945)

**What this PR does / why we need it**:

Allows changing the label name at the canary in the helm chart.

**Which issue(s) this PR fixes**:
Idk, none?

**Special notes for your reviewer**:

This is a very trivial change.

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [x] Tests updated
- [x] `CHANGELOG.md` updated
- [x] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [x] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [x] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

---------

Co-authored-by: Michel Hollands <42814411+MichelHollands@users.noreply.github.com>
Co-authored-by: Travis Patterson <travis.patterson@grafana.com>",57,63,1,0,"2018-04-16 10:25:39","1921.24"
"grafana/loki","195971e37aa55acc6f1097298f4ab1ef4e4ad121","daixiang0","2019-03-26 11:27:59","false","add miss promtail client config option

Signed-off-by: Xiang Dai <764524258@qq.com>",91,11,0,0,"2018-04-16 10:25:39","340.04"
"grafana/loki","4e20aeb9526f4a04484fe90610b0c8cd230945a0","daixiang0","2019-03-29 10:47:26","false","update check

Signed-off-by: Xiang Dai <764524258@qq.com>",93,11,0,0,"2018-04-16 10:25:39","343.02"
"grafana/loki","93a5a71e621f742b47fdb49d4f11ae6c0ead27b9","liguozhong","2022-09-05 09:21:26","true","[doc] logql: logql engine support exec vector(0) grama (#7044)

<!--  Thanks for sending a pull request!  Before submitting:

1. Read our CONTRIBUTING.md guide
2. Name your PR as `<Feature Area>: Describe your change`.
  a. Do not end the title with punctuation. It will be added in the changelog.
  b. Start with an imperative verb. Example: Fix the latency between System A and System B.
  c. Use sentence case, not title case.
  d. Use a complete phrase or sentence. The PR title will appear in a changelog, so help other people understand what your change will be.
3. Rebase your PR if it gets out of sync with main
-->

**What this PR does / why we need it**:
logql engine support exec vector(0) grama.
new PR of :https://github.com/grafana/loki/pull/7023

**Which issue(s) this PR fixes**:
Fixes #6946

**Special notes for your reviewer**:
preview
![image](https://user-images.githubusercontent.com/9583245/188355186-9a74d1ce-f062-45e8-8516-52c89383eeec.png)

<!--
Note about CHANGELOG entries, if a change adds:
* an important feature
* fixes an issue present in a previous release, 
* causes a change in operation that would be useful for an operator of Loki to know
then please add a CHANGELOG entry.

For documentation changes, build changes, simple fixes etc please skip this step. We are attempting to curate a changelog of the most relevant and important changes to be easier to ingest by end users of Loki.

Note about the upgrade guide, if this changes:
* default configuration values
* metric names or label names
* changes existing log lines such as the metrics.go query output line
* configuration parameters 
* anything to do with any API
* any other change that would require special attention or extra steps to upgrade
Please document clearly what changed AND what needs to be done in the upgrade guide.
-->
**Checklist**
- [ ] Documentation added
- [ ] Tests updated
- [ ] Is this an important fix or new feature? Add an entry in the `CHANGELOG.md`.
- [ ] Changes that require user attention or interaction to upgrade are documented in `docs/sources/upgrading/_index.md`

Co-authored-by: Danny Kopping <dannykopping@gmail.com>",78,53,1,1,"2018-04-16 10:25:39","1599.96"
"grafana/loki","11bf736c9058a23df2a9f97360c128f585387f2d","taisho6339","2021-11-26 11:35:54","true","Refactor tests of Promtail filetarget (#4802)

* Refactor tests of Promtail filetarget

* Move tests depend on inotify to filetargetmanager test
* Add handling file creation event via channel case in filetarget test

* Use Eventually function for waiting",216,43,0,0,"2018-04-16 10:25:39","1315.8"
"grafana/loki","f0542c04e11aa714d43351ed4d86cda4f4bf40b6","dannykopping","2021-07-28 13:38:43","true","Updating drone signature (#4072)

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",109,39,0,1,"2018-04-16 10:25:39","1197.88"
"grafana/loki","e69ceefd84351d4e1833d44291fd86f3f22429d4","MichelHollands","2021-11-26 11:32:30","true","Add LabelFilterer and Store wrapper (#4818)

* Add LabelFilterer and Store wrapper

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Address review comments

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",216,43,0,1,"2018-04-16 10:25:39","1315.8"
"grafana/loki","cd962322df6de92dd5ed29fb011ee13092286c15","xperimental","2023-07-17 17:43:19","true","operator: Fix application tenant alertmanager configuration (#9963)

Co-authored-by: Periklis Tsirakidis <periklis@redhat.com>",58,63,1,1,"2018-04-16 10:25:39","1917.55"
"grafana/loki","16761723f4f2dbdeece4697377239b99d25368fe","MichelHollands","2022-10-31 19:14:13","true","Add way to override userId for caching (#7542)

**What this PR does / why we need it**:

Add a way to change the userId used in caching.

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the `CONTRIBUTING.md` guide
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",89,54,1,1,"2018-04-16 10:25:39","1656.37"
"grafana/loki","109b9dce9a3cb8ee9fb3adabbf623bbb4e42a4cf","MichelHollands","2022-10-18 09:53:11","true","Add remote schema option (#7442)

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",89,54,1,1,"2018-04-16 10:25:39","1642.98"
"grafana/loki","eb390523e3e9eee6dae54596907d5ba0145a541b","adamdecaf","2019-01-11 13:05:51","false","all: update dependencies (#211)

* all: update dependencies

* Update some more dependancies and pin the right versions for Prometheus deps.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",60,9,0,0,"2018-04-16 10:25:39","265.11"
"grafana/loki","7399beff4aaacb1a1c0c925101d88bedf2cd9666","adityacs","2020-07-02 14:17:40","true","Fix local.md doc (#2285)",130,27,0,1,"2018-04-16 10:25:39","806.66"
"grafana/loki","6f0690e7bf7c388d6c8056b1a63beda897fb0489","kavirajk","2022-09-14 10:35:59","true","fix(ruler): Initialize multi remote clients config (#7151)

<!--  Thanks for sending a pull request!  Before submitting:

1. Read our CONTRIBUTING.md guide
2. Name your PR as `<Feature Area>: Describe your change`.
a. Do not end the title with punctuation. It will be added in the
changelog.
b. Start with an imperative verb. Example: Fix the latency between
System A and System B.
  c. Use sentence case, not title case.
d. Use a complete phrase or sentence. The PR title will appear in a
changelog, so help other people understand what your change will be.
3. Rebase your PR if it gets out of sync with main
-->

**What this PR does / why we need it**:
To be backward compatible with single client config.
```
ts=2022-09-14T08:24:04.549961234Z caller=memberlist_logger.go:74 level=debug msg=""Initiating push/pull sync with:  10.132.18.167:7946""                                                                                                                     │
│ panic: assignment to entry in nil map                                                                                                                                                                                                                      │
│ goroutine 1 [running]:                                                                                                                                                                                                                                     │
│ github.com/grafana/loki/pkg/ruler.NewRuler({{{0xc00002a120}, {0x0, 0x0, 0x0}, {0x6400000, 0x6400000, {0x0, 0x0}, 0x0, 0x0, ...}, ...}, ...}, ...)                                                                                                          │
│     /src/enterprise-logs/vendor/github.com/grafana/loki/pkg/ruler/ruler.go:21 +0x1b7   
```
**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

<!--
Note about CHANGELOG entries, if a change adds:
* an important feature
* fixes an issue present in a previous release, 
* causes a change in operation that would be useful for an operator of
Loki to know
then please add a CHANGELOG entry.

For documentation changes, build changes, simple fixes etc please skip
this step. We are attempting to curate a changelog of the most relevant
and important changes to be easier to ingest by end users of Loki.

Note about the upgrade guide, if this changes:
* default configuration values
* metric names or label names
* changes existing log lines such as the metrics.go query output line
* configuration parameters 
* anything to do with any API
* any other change that would require special attention or extra steps
to upgrade
Please document clearly what changed AND what needs to be done in the
upgrade guide.
-->
**Checklist**
- [ ] Documentation added
- [ ] Tests updated
- [ ] Is this an important fix or new feature? Add an entry in the
`CHANGELOG.md`.
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",88,53,1,1,"2018-04-16 10:25:39","1609.01"
"grafana/loki","c5aa9f197d6eb765f22a336fc23d0196c9b03f15","kavirajk","2022-01-10 19:55:29","true","Handle `context` cancellation in some of the `querier` downstream requests (#5080)

* Fix deadlock in disconnecting querier

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* todo

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Add more logs to queriers cancellation

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* new span

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixe log

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Exit earlier for batch iterator

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add missing return

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Add store context cancellation

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes a possible cancellation issue

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Rmove code to find issues

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add splitMiddleware back to handler

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Remove query split

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Remove split middleware and context cancel check for chunks

* Handle context cancel properly on `getChunk()` via select.

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Use context in getChunk without starting new goroutine

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Just normal ctx.Err() check instead of using Done channel

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Remove debug logs

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Update pkg/querier/http.go

Co-authored-by: Cyril Tovena <cyril.tovena@gmail.com>

* Remove unused imports

Co-authored-by: Cyril Tovena <cyril.tovena@gmail.com>",253,45,0,1,"2018-04-16 10:25:39","1360.15"
"grafana/loki","2e5622bd3dada0529779bfa879cbc8eacef41b3a","cameronattard","2023-01-10 23:50:17","true","Helm: add support for memcached client addresses (#7995)

**What this PR does / why we need it**:

See
https://grafana.com/docs/mimir/latest/operators-guide/configuring/about-dns-service-discovery/
for details

Usage is documented here:
https://grafana.com/docs/loki/latest/configuration/#cache_config

**Checklist**
- [x] Reviewed the `CONTRIBUTING.md` guide
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",99,57,1,0,"2018-04-16 10:25:39","1725.56"
"grafana/loki","27541762399e04232380ec1201f525aebb677a8f","salvacorts","2023-08-04 11:27:48","true","Fixes for non-indexed metadata (#10167)

**What this PR does / why we need it**:

This PR fixes a bug while recovering from the WAL. Before this PR, when
reading a head from the WAL, we'd attempt to create a chunk with the
head fmt of the WAL head. If we change the chunk fmt to v4, we'd fail to
rebound chunks since v4 may be incompatible with the head fmt from the
WAL. Instead, in this PR we will always use the Default head fmt for the
new chunk (which will change when we change the default chunk fmt to
v4).

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

---------

Signed-off-by: Vladyslav Diachenko <vlad.diachenko@grafana.com>
Co-authored-by: Vladyslav Diachenko <vlad.diachenko@grafana.com>",53,64,1,1,"2018-04-16 10:25:39","1934.29"
"grafana/loki","30152d96837b35b466a95c385f9db6fe4c22cf96","deepansh96","2023-05-01 08:34:18","true","Update index.md (#9291)

**What this PR does / why we need it**:
A small typo in the documentation

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",79,60,1,0,"2018-04-16 10:25:39","1841.17"
"grafana/loki","34b9b9a11feb689d748c3ec6c9e0a1717ceaac27","dannykopping","2023-10-27 13:45:09","true","Improve observability of index queries (#11064)

**What this PR does / why we need it**:
Requests to the following APIs previously had limited or incorrect
logging, which made understanding their behaviour at runtime difficult.

[GET
/loki/api/v1/labels](https://grafana.com/docs/loki/latest/reference/api/#list-labels-within-a-range-of-time)
[GET
/loki/api/v1/label/<name>/values](https://grafana.com/docs/loki/latest/reference/api/#list-label-values-within-a-range-of-time)
[GET
/loki/api/v1/series](https://grafana.com/docs/loki/latest/reference/api/#list-series)
[GET
/loki/api/v1/index/stats](https://grafana.com/docs/loki/latest/reference/api/#index-stats)
[GET
/loki/api/v1/index/volume](https://grafana.com/docs/loki/latest/reference/api/#volume)
[GET
/loki/api/v1/index/volume_range](https://grafana.com/docs/loki/latest/reference/api/#volume)

All of these APIs now have querier and query-frontend logs; sharding and
time-based splitting are applied to these requests, and it's valuable to
see all requests.",17,66,1,1,"2018-04-16 10:25:39","2017.39"
"grafana/loki","e382a4175cf1491c5d37c707850ccfcf4c5bf00a","JStickler","2023-02-07 08:27:24","true","Fix numbering issue in second procedure. (#8429)",79,58,1,0,"2018-04-16 10:25:39","1751.92"
"grafana/loki","7c26c8c093ac7fc84d5f767f5e646275b5c88f11","simonswine","2023-05-25 15:22:31","true","Fix panic in `pkg/analytics` (#9502)

We discovered a bug in Phlare
https://github.com/grafana/phlare/pull/706. There can be a race occuring
between two different `New<Counter|Int>` calls for the same `name`.",66,61,1,0,"2018-04-16 10:25:39","1865.46"
"grafana/loki","9617c06a70a5388d2d93b7a2902fa2f8d44d549e","periklis","2023-07-14 03:53:23","true","operator: Use PodAntiAffinity for all components (#9930)

Co-authored-by: Robert Jacob <xperimental@solidproject.de>
Co-authored-by: Robert Jacob <rojacob@redhat.com>",56,63,1,1,"2018-04-16 10:25:39","1913.98"
"grafana/loki","29a3240e17b9d76ef5f4e5556d145eddb7355a83","cyriltovena","2021-03-25 18:21:11","true","Support for single step metric query. (#3540)

When splitting correctly steps in the frontend, some queries might be of a single step, e.g start == end.

This PR add supports for those queries, which are already supported by Cortex and Prometheus, but for some reason not Loki.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",145,35,0,1,"2018-04-16 10:25:39","1069.83"
"grafana/loki","66b36cb34cd1bfb0e4132633315e6d6c23c78671","jeschkies","2023-11-01 18:13:30","true","Update golangci-lint to 1.55.1. (#11114)

**What this PR does / why we need it**:
This updates golangci-lint in our build image so that we can use
`gochecksumtype`.

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)
- [ ] If the change is deprecating or removing a configuration option,
update the `deprecated-config.yaml` and `deleted-config.yaml` files
respectively in the `tools/deprecated-config-checker` directory.
[Example
PR](https://github.com/grafana/loki/pull/10840/commits/0d4416a4b03739583349934b96f272fb4f685d15)",15,66,1,1,"2018-04-16 10:25:39","2021.57"
"grafana/loki","fc389b6ab5bcc58da38d57f1c452519d71701937","slim-bean","2019-05-02 16:29:01","false","don't delete elements from a map while iterating over it
improve locking of positions",99,13,0,1,"2018-04-16 10:25:39","381.5"
"grafana/loki","92eea517d398a976a9123dafda1e70603d40aa19","slim-bean","2020-01-22 18:09:11","false","updating to 1.3.0 release

Signed-off-by: Edward Welch <edward.welch@grafana.com>",96,21,0,1,"2018-04-16 10:25:39","641.57"
"grafana/loki","8340232b0435baac698b637add121f38eaddf951","slim-bean","2019-05-10 17:54:09","false","initial checkin
mostly working, need to extract out the config
needs a proper ksonnet or helm deployment or both
needs a makefile",98,13,0,1,"2018-04-16 10:25:39","389.56"
"grafana/loki","6d442673b7279eef4b7aa88d0af0ceb72bba7fe9","slim-bean","2020-11-24 14:47:29","true","adding a function to safely open boltdb files and recover from any panics thrown by boltdb when opening a file. (#2983)",113,31,0,1,"2018-04-16 10:25:39","948.68"
"grafana/loki","4f9a2fe2d9a10b48fcaf0dd130bf8329014b814b","slim-bean","2020-04-30 20:32:16","true","I <3 you Linter (#2022)

Signed-off-by: Ed Welch <edward.welch@grafana.com>",120,24,0,1,"2018-04-16 10:25:39","744.92"
"grafana/loki","bf5eabe2decb60c9952155f58e4201f42759b109","pracucci","2019-10-03 13:51:50","false","Do not retry chunks transferring on shutdown in the local dev env (#1085)",75,17,0,0,"2018-04-16 10:25:39","532.39"
"grafana/loki","7effeec6424fcd670b8f7b2fe6ac19c7c78f44df","owen-d","2020-03-27 14:28:29","true","Sharding optimizations I: AST mapping (#1846)

* [wip] sharding evaluator/ast

* [wip] continues experimenting with ast mapping

* refactoring in preparation for binops

* evaluators can pass state to other evaluators

* compiler alignment

* Evaluator method renamed to StepEvaluator

* chained evaluator impl

* tidying up sharding code

* handling for ConcatSampleExpr

* downstream iterator

* structure for downstreaming asts

* outlines sharding optimizations

* work on sharding mapper

* ast sharding optimizations

* test for different logrange positions

* shard mapper tests

* stronger ast sharding & tests

* shardmapper tests for string->string

* removes sharding evaluator code

* removes unused ctx arg

* Update pkg/logql/evaluator.go

Co-Authored-By: Cyril Tovena <cyril.tovena@gmail.com>

Co-authored-by: Cyril Tovena <cyril.tovena@gmail.com>",119,23,0,1,"2018-04-16 10:25:39","706.42"
"grafana/loki","50bc1cee71309d4a44bb22c6cd15a793c2a9b08d","trevorwhitney","2023-04-27 22:17:51","true","Rename usagestats to analytics (#9212)

**What this PR does / why we need it**:

Rename usagestats to analytics. The config section in the yaml is
already called analytics, this makes things more consistent.

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [ ] Tests updated
- [x] `CHANGELOG.md` updated
- [x] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",80,60,1,1,"2018-04-16 10:25:39","1837.74"
"grafana/loki","0c4f704deb145e946884accc70f7804f2badd2fc","adityacs","2020-07-31 12:29:05","true","fix panic in cassandra storage while registering metrics (#2457)",127,27,0,1,"2018-04-16 10:25:39","835.59"
"grafana/loki","2d4ff73cc27541e50d4b27581c34b011a7ea9773","sandeepsukhani","2022-06-01 11:22:34","true","add metrics for tracking index shipper operations (#6278)",72,49,0,1,"2018-04-16 10:25:39","1506.04"
"grafana/loki","071a20803bc3b9275c54ac5bea67daec79ca2e0e","sandeepsukhani","2020-10-26 07:18:40","true","Revendor cortex to latest master (#2794)",119,30,0,1,"2018-04-16 10:25:39","920.37"
"grafana/loki","e4fbd3c9494c99594d0ef63ea9794194150ae016","Tolsto","2023-01-13 16:33:36","true","Loki: Add support for Azure Workload Identity authentication (#7540)",94,57,1,0,"2018-04-16 10:25:39","1728.26"
"grafana/loki","93de7a7061f4ada4213874247668ae66480e6695","owen-d","2022-05-03 11:15:39","true","renames skip -> ok in ProcessString (#6064)

* renames skip -> ok in ProcessString
Signed-off-by: Owen Diehl <ow.diehl@gmail.com>

* streampipeline matches convention
Signed-off-by: Owen Diehl <ow.diehl@gmail.com>",74,49,0,1,"2018-04-16 10:25:39","1478.03"
"grafana/loki","190c3a4b92d00f981034778ceb21b64acc47bcb6","jeschkies","2021-11-30 16:01:33","true","Lint Loki and Promtail mixins. (#4848)

* Lint Loki and Promtail mixins.

Summary:
- Check whether Jsonnet files have been formatted.
- Run mixtool on mixins.

Closes #4841

* Format Jsonnet files.

* Define uids for dashboards.

* Exclude `vednor` from lintin.

* Reference Docker image.",214,43,0,1,"2018-04-16 10:25:39","1319.98"
"grafana/loki","edae9d32eaf170d88628efc6374d546ce5c68cd4","jeschkies","2023-10-27 11:44:14","true","Stop processing split queries on first error. (#11067)

**What this PR does / why we need it**:
The `TestMetricsTripperware` became flaky after #10688. The race
condition in the splitter has been there before but the change exposed
it. When an error occurs, e.g. when query would be too large, the
splitter would return. However, there was a small time window when the
loop could still be fed a new request. #10688 just amplified this effect
because it removed the serialization of requests and responses.

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)
- [ ] If the change is deprecating or removing a configuration option,
update the `deprecated-config.yaml` and `deleted-config.yaml` files
respectively in the `tools/deprecated-config-checker` directory. <!--
TODO(salvacorts): Add example PR -->

---------

Co-authored-by: Danny Kopping <dannykopping@gmail.com>",17,66,1,1,"2018-04-16 10:25:39","2017.3"
"grafana/loki","f9c90a0e43242dc8bf3863325edcf2def6ca2369","trevorwhitney","2023-03-31 16:16:23","true","Diff configs script (#8944)

**What this PR does / why we need it**:

I always forget this trick for diffing configs when preparing a new
release so I added it to a script.",81,59,1,1,"2018-04-16 10:25:39","1806.24"
"grafana/loki","f59eb418058b7d674048042bab55bd6f5a43d5d2","slim-bean","2019-05-21 18:04:45","false","need to bump helm chart after PR #598",106,13,0,1,"2018-04-16 10:25:39","400.57"
"grafana/loki","11937d3c3ab573d3565aa0995f34e35c2d7d9223","adityacs","2020-05-13 11:30:30","true","Targets not required in promtail config (#2026)

* Targets not required in promtail config

* changing the defaulted value from `dummy` to `localhost`, I think this will be more intuitive for people, also re-worded the docs a bit.

Signed-off-by: Ed Welch <edward.welch@grafana.com>

Co-authored-by: Ed Welch <edward.welch@grafana.com>",120,25,0,1,"2018-04-16 10:25:39","757.55"
"grafana/loki","14b2c093c19e17103e564b0aa6af0cf16ff0e5bc","kavirajk","2021-03-17 15:13:03","true","Add unique promtail_instance id to labels for gcptarget (#3501)

* Add unique promtail_instance id to labels for gcptarget

Rationale:
To make labelset unique per promtail instance to avoid out-of-order errors

* Update docs/sources/clients/promtail/scraping.md

Co-authored-by: Danny Kopping <dannykopping@gmail.com>

Co-authored-by: Danny Kopping <dannykopping@gmail.com>",160,35,0,1,"2018-04-16 10:25:39","1061.7"
"grafana/loki","57cec8e496ab0825610f5f9da6aadc20344d9c87","owen-d","2022-08-09 03:16:16","true","[TSDB] Ingester Index Sampling (#6852)

* queryrangebase definitions protos & aliases
Signed-off-by: Owen Diehl <ow.diehl@gmail.com>

* indexgatewaypb to logproto
Signed-off-by: Owen Diehl <ow.diehl@gmail.com>

* updates queryrange.proto for new definitions file
Signed-off-by: Owen Diehl <ow.diehl@gmail.com>

* s/indexgatewaypb/logproto/g
Signed-off-by: Owen Diehl <ow.diehl@gmail.com>

* renames to indexseries for clobbering reasons
Signed-off-by: Owen Diehl <ow.diehl@gmail.com>

* more indexgatewaypb removal compatibility work
Signed-off-by: Owen Diehl <ow.diehl@gmail.com>

* proto fmt
Signed-off-by: Owen Diehl <ow.diehl@gmail.com>

* rebuild imports
Signed-off-by: Owen Diehl <ow.diehl@gmail.com>

* goimports -s
Signed-off-by: Owen Diehl <ow.diehl@gmail.com>

* query ingesters for index stats
Signed-off-by: Owen Diehl <ow.diehl@gmail.com>

* compatibility during rollouts for idx-gw+ingester-querier post proto refactor
Signed-off-by: Owen Diehl <ow.diehl@gmail.com>

* proto compatibility with old indexgateway pkg path
Signed-off-by: Owen Diehl <ow.diehl@gmail.com>

* test compat
Signed-off-by: Owen Diehl <ow.diehl@gmail.com>

* gofmt
Signed-off-by: Owen Diehl <ow.diehl@gmail.com>",75,52,0,1,"2018-04-16 10:25:39","1573.7"
"grafana/loki","edb5fc51762b1f73632eec10933fe045be77d96d","rsteneteg","2020-09-10 13:42:58","true","Promtail: adding pipeline stage for dropping labels (#2571)

* adding pipeline stage for dropping labels, our use case for this is to move unbound labels into the log line and dropping the label, fixes #2421

Signed-off-by: Roger Steneteg <rsteneteg@ea.com>

* Update docs/sources/clients/promtail/stages/labeldrop.md

Co-authored-by: Diana Payton <52059945+oddlittlebird@users.noreply.github.com>

* Update docs/sources/clients/promtail/stages/_index.md

Co-authored-by: Diana Payton <52059945+oddlittlebird@users.noreply.github.com>

* fixed inconsistent naming, removed unused logger in the labeldrop stage

Signed-off-by: Roger Steneteg <rsteneteg@ea.com>

Co-authored-by: Diana Payton <52059945+oddlittlebird@users.noreply.github.com>",116,29,0,0,"2018-04-16 10:25:39","874.64"
"grafana/loki","5eba0286563c9de6df1273e68b30bf5b58e54ba3","mar4uk","2023-01-13 16:53:04","true","Move to fork github.com/grafana/cloudflare-go (#8133)

**What this PR does / why we need it**:
The PR https://github.com/cloudflare/cloudflare-go/pull/743 to the
upstream repo https://github.com/cloudflare/cloudflare-go was closed
with the resolution:

> We've spoken to the Grafana Loki team and they'll be building out an
integration with Logpush so I don't think this is needed from their side
anymore.

I
[spoke](https://raintank-corp.slack.com/archives/C9T1FLN9K/p1666293494583359)
to Loki team and found out that moving to Logpush is not on the
shortlist plan right now.

I suggest moving to
[github.com/grafana/cloudflare-go](https://github.com/grafana/cloudflare-go)
fork as the main dependency to get rid of replacement directive.


https://github.com/grafana/loki/blob/02e0b3ae89fb5b0dc8849448a1cd2911e0efa1a2/go.mod#L320

Another point is replace directives complicate using loki as a
dependency in other packages because replace directives should be moved
to the upstream package as well.
In general, replace was designed as a temporary solution to test code.
It shouldn't be used permanently.

**Which issue(s) this PR fixes**:
Fixes
https://github.com/open-telemetry/opentelemetry-collector-contrib/issues/16722,
https://github.com/open-telemetry/opentelemetry-collector-contrib/issues/16453

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the [`CONTRIBUTING.md`](../CONTRIBUTING.md) guide
(**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",94,57,1,0,"2018-04-16 10:25:39","1728.27"
"grafana/loki","30ddd771501fa0f2661ae7b32bbc752ea71a5cd2","kavirajk","2022-11-30 08:50:51","true","loki-canary: respect `useTLS` flag when `push` mode is enabled. (#7701)

**What this PR does / why we need it**:
Currently `useTLS` flag is ignored on the push writer. This PR consider
that flag and adjust the schema (http -> https) when that flag is
enabled.

**Which issue(s) this PR fixes**:
Fixes #7692 

**Special notes for your reviewer**:

**Checklist**",95,55,1,1,"2018-04-16 10:25:39","1684.93"
"grafana/loki","4176de17d15aa76351bc6bc8b887e01b56890bb3","periklis","2022-10-18 10:01:51","true","Add compactor delete client tls client config (#7426)",89,54,1,1,"2018-04-16 10:25:39","1642.98"
"grafana/loki","0bc51b55fee84f66130af36db2f7271664e40c14","daixiang0","2019-03-30 03:11:00","false","Update logcli doc

Signed-off-by: Xiang Dai <764524258@qq.com>",93,11,0,0,"2018-04-16 10:25:39","343.7"
"grafana/loki","9498ea2c02dea53bd93d4d1b39358a2701e9c756","bboreham","2022-09-30 15:16:52","true","chunks: decode varints directly from byte buffer; stop panicing on some corrupt inputs (#7264)

**What this PR does / why we need it**:

This is much faster, since we don't pay for byte-at-a-time reads from
the buffer.

For best performance with gzip and lz4, we still want a bufio.Reader. We
don't need the pool of buffered readers now.

Other compression formats have their own internal buffers so don't need
extra buffering.

**Checklist**
- [x] Reviewed the `CONTRIBUTING.md` guide
- NA Documentation added
- NA Tests updated
- [x] `CHANGELOG.md` updated
- NA Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

(using changes from https://github.com/grafana/loki/pull/7246, ignoring
lines that didn't change much)

```
name                           old time/op      new time/op      delta
Write/ordered-lz4-256k-4           24.1ms ± 7%      22.1ms ± 2%    -8.52%  (p=0.008 n=5+5)
Write/unordered-lz4-4              54.6ms ±29%      49.1ms ± 1%   -10.04%  (p=0.016 n=5+4)
Read/none_66_kB-4                  4.16ms ± 6%      2.54ms ± 2%   -38.87%  (p=0.008 n=5+5)
Read/gzip_66_kB-4                   177ms ± 4%       161ms ± 4%    -9.09%  (p=0.008 n=5+5)
Read/lz4-64k_66_kB-4               59.5ms ± 2%      49.5ms ± 3%   -16.80%  (p=0.008 n=5+5)
Read/lz4-256k_66_kB-4              62.9ms ± 0%      51.2ms ± 1%   -18.58%  (p=0.016 n=4+5)
Read/lz4-1M_66_kB-4                62.9ms ± 2%      51.5ms ± 1%   -18.03%  (p=0.008 n=5+5)
Read/lz4_66_kB-4                   63.7ms ± 4%      51.2ms ± 1%   -19.68%  (p=0.008 n=5+5)
Read/snappy_66_kB-4                51.1ms ± 2%      41.9ms ± 1%   -17.95%  (p=0.016 n=5+4)
Read/flate_66_kB-4                  168ms ± 4%       150ms ± 2%   -10.49%  (p=0.008 n=5+5)
Read/zstd_66_kB-4                   334ms ±16%       272ms ± 6%   -18.52%  (p=0.008 n=5+5)
Read/none_262_kB-4                 3.93ms ± 1%      2.48ms ± 2%   -36.91%  (p=0.008 n=5+5)
Read/gzip_262_kB-4                  159ms ± 5%       143ms ± 2%   -10.12%  (p=0.008 n=5+5)
Read/lz4-64k_262_kB-4              53.5ms ± 1%      43.2ms ± 3%   -19.35%  (p=0.008 n=5+5)
Read/lz4-256k_262_kB-4             55.8ms ± 1%      45.3ms ± 2%   -18.75%  (p=0.008 n=5+5)
Read/lz4-1M_262_kB-4               57.5ms ± 2%      45.5ms ± 2%   -20.91%  (p=0.008 n=5+5)
Read/lz4_262_kB-4                  56.8ms ± 2%      45.3ms ± 2%   -20.26%  (p=0.008 n=5+5)
Read/snappy_262_kB-4               46.0ms ± 2%      37.5ms ± 1%   -18.57%  (p=0.008 n=5+5)
Read/flate_262_kB-4                 153ms ± 3%       134ms ± 2%   -12.33%  (p=0.008 n=5+5)
Read/none_524_kB-4                 3.85ms ± 2%      2.46ms ± 2%   -36.04%  (p=0.008 n=5+5)
Read/gzip_524_kB-4                  128ms ± 2%       119ms ± 2%    -7.64%  (p=0.008 n=5+5)
Read/lz4-64k_524_kB-4              44.6ms ± 3%      34.7ms ± 1%   -22.19%  (p=0.008 n=5+5)
Read/lz4-256k_524_kB-4             45.4ms ± 1%      36.7ms ± 5%   -19.07%  (p=0.008 n=5+5)
Read/lz4-1M_524_kB-4               47.3ms ± 1%      38.6ms ± 2%   -18.36%  (p=0.008 n=5+5)
Read/lz4_524_kB-4                  47.4ms ± 1%      38.0ms ± 1%   -19.70%  (p=0.008 n=5+5)
Read/snappy_524_kB-4               37.3ms ± 1%      31.1ms ± 3%   -16.47%  (p=0.008 n=5+5)
Read/flate_524_kB-4                 122ms ± 1%       111ms ± 3%    -9.04%  (p=0.008 n=5+5)
Read/sample_none_66_kB-4           7.81ms ± 1%      6.62ms ± 6%   -15.24%  (p=0.008 n=5+5)
Read/sample_gzip_66_kB-4            237ms ± 2%       219ms ± 1%    -7.57%  (p=0.008 n=5+5)
Read/sample_lz4-64k_66_kB-4         105ms ± 2%        92ms ± 1%   -12.03%  (p=0.008 n=5+5)
Read/sample_lz4-256k_66_kB-4        109ms ± 1%        98ms ± 2%    -9.65%  (p=0.008 n=5+5)
Read/sample_lz4-1M_66_kB-4          113ms ± 8%        98ms ± 2%   -13.66%  (p=0.008 n=5+5)
Read/sample_lz4_66_kB-4             109ms ± 1%        99ms ± 2%    -9.29%  (p=0.008 n=5+5)
Read/sample_snappy_66_kB-4         86.6ms ± 1%      77.2ms ± 6%   -10.92%  (p=0.008 n=5+5)
Read/sample_flate_66_kB-4           236ms ± 8%       214ms ± 3%    -9.11%  (p=0.008 n=5+5)
Read/sample_none_262_kB-4          7.70ms ± 2%      6.34ms ± 2%   -17.67%  (p=0.008 n=5+5)
Read/sample_lz4-64k_262_kB-4       94.7ms ± 1%      84.4ms ± 2%   -10.90%  (p=0.008 n=5+5)
Read/sample_lz4-256k_262_kB-4      98.4ms ± 1%      87.7ms ± 2%   -10.93%  (p=0.008 n=5+5)
Read/sample_lz4-1M_262_kB-4         101ms ± 2%        90ms ± 2%   -11.19%  (p=0.008 n=5+5)
Read/sample_lz4_262_kB-4            100ms ± 2%        90ms ± 3%   -10.78%  (p=0.008 n=5+5)
Read/sample_snappy_262_kB-4        77.9ms ± 2%      68.7ms ± 2%   -11.84%  (p=0.008 n=5+5)
Read/sample_flate_262_kB-4          211ms ± 2%       190ms ± 2%    -9.86%  (p=0.008 n=5+5)
Read/sample_none_524_kB-4          7.82ms ± 2%      6.43ms ± 2%   -17.80%  (p=0.008 n=5+5)
Read/sample_gzip_524_kB-4           176ms ± 1%       164ms ± 2%    -6.80%  (p=0.008 n=5+5)
Read/sample_lz4-64k_524_kB-4       77.7ms ± 1%      69.8ms ± 4%   -10.10%  (p=0.008 n=5+5)
Read/sample_lz4-256k_524_kB-4      81.7ms ± 2%      72.1ms ± 3%   -11.79%  (p=0.008 n=5+5)
Read/sample_lz4-1M_524_kB-4        83.8ms ± 1%      74.4ms ± 1%   -11.21%  (p=0.008 n=5+5)
Read/sample_lz4_524_kB-4           83.2ms ± 0%      76.1ms ± 8%    -8.53%  (p=0.016 n=4+5)
Read/sample_snappy_524_kB-4        63.6ms ± 2%      56.5ms ± 2%   -11.23%  (p=0.008 n=5+5)
Read/sample_flate_524_kB-4          172ms ± 2%       157ms ± 1%    -8.88%  (p=0.008 n=5+5)

name                           old speed        new speed        delta
Write/ordered-lz4-256k-4          687MB/s ± 6%     749MB/s ± 2%    +9.09%  (p=0.008 n=5+5)
Write/unordered-lz4-4             313MB/s ±24%     341MB/s ± 1%    +9.23%  (p=0.016 n=5+4)
Read/none_66_kB-4                1.82GB/s ± 6%    2.97GB/s ± 2%   +63.42%  (p=0.008 n=5+5)
Read/gzip_66_kB-4                 669MB/s ± 4%     736MB/s ± 4%   +10.00%  (p=0.008 n=5+5)
Read/lz4-64k_66_kB-4             1.42GB/s ± 2%    1.71GB/s ± 3%   +20.21%  (p=0.008 n=5+5)
Read/lz4-256k_66_kB-4            1.43GB/s ± 0%    1.76GB/s ± 1%   +22.83%  (p=0.016 n=4+5)
Read/lz4-1M_66_kB-4              1.43GB/s ± 2%    1.74GB/s ± 1%   +21.99%  (p=0.008 n=5+5)
Read/lz4_66_kB-4                 1.41GB/s ± 4%    1.76GB/s ± 1%   +24.44%  (p=0.008 n=5+5)
Read/snappy_66_kB-4              1.29GB/s ± 2%    1.57GB/s ± 1%   +21.86%  (p=0.016 n=5+4)
Read/flate_66_kB-4                710MB/s ± 4%     793MB/s ± 2%   +11.70%  (p=0.008 n=5+5)
Read/zstd_66_kB-4                 425MB/s ±14%     517MB/s ± 6%   +21.74%  (p=0.008 n=5+5)
Read/none_262_kB-4               1.93GB/s ± 1%    3.06GB/s ± 2%   +58.54%  (p=0.008 n=5+5)
Read/gzip_262_kB-4                701MB/s ± 5%     779MB/s ± 2%   +11.20%  (p=0.008 n=5+5)
Read/lz4-64k_262_kB-4            1.47GB/s ± 1%    1.82GB/s ± 3%   +24.03%  (p=0.008 n=5+5)
Read/lz4-256k_262_kB-4           1.48GB/s ± 1%    1.82GB/s ± 2%   +23.09%  (p=0.008 n=5+5)
Read/lz4-1M_262_kB-4             1.46GB/s ± 2%    1.84GB/s ± 2%   +26.44%  (p=0.008 n=5+5)
Read/lz4_262_kB-4                1.48GB/s ± 2%    1.85GB/s ± 2%   +25.42%  (p=0.008 n=5+5)
Read/snappy_262_kB-4             1.31GB/s ± 2%    1.61GB/s ± 1%   +22.80%  (p=0.008 n=5+5)
Read/flate_262_kB-4               729MB/s ± 3%     831MB/s ± 2%   +14.05%  (p=0.008 n=5+5)
Read/none_524_kB-4               1.97GB/s ± 2%    3.08GB/s ± 2%   +56.33%  (p=0.008 n=5+5)
Read/gzip_524_kB-4                714MB/s ± 2%     773MB/s ± 2%    +8.27%  (p=0.008 n=5+5)
Read/lz4-64k_524_kB-4            1.47GB/s ± 3%    1.88GB/s ± 1%   +28.48%  (p=0.008 n=5+5)
Read/lz4-256k_524_kB-4           1.50GB/s ± 1%    1.86GB/s ± 5%   +23.63%  (p=0.008 n=5+5)
Read/lz4-1M_524_kB-4             1.49GB/s ± 1%    1.83GB/s ± 2%   +22.51%  (p=0.008 n=5+5)
Read/lz4_524_kB-4                1.49GB/s ± 1%    1.86GB/s ± 1%   +24.53%  (p=0.008 n=5+5)
Read/snappy_524_kB-4             1.34GB/s ± 1%    1.60GB/s ± 3%   +19.75%  (p=0.008 n=5+5)
Read/flate_524_kB-4               750MB/s ± 1%     824MB/s ± 3%    +9.97%  (p=0.008 n=5+5)
Read/sample_none_66_kB-4          967MB/s ± 1%    1142MB/s ± 6%   +18.13%  (p=0.008 n=5+5)
Read/sample_gzip_66_kB-4          501MB/s ± 2%     542MB/s ± 1%    +8.19%  (p=0.008 n=5+5)
Read/sample_lz4-64k_66_kB-4       811MB/s ± 2%     922MB/s ± 1%   +13.66%  (p=0.008 n=5+5)
Read/sample_lz4-256k_66_kB-4      825MB/s ± 1%     913MB/s ± 2%   +10.68%  (p=0.008 n=5+5)
Read/sample_lz4-1M_66_kB-4        795MB/s ± 7%     920MB/s ± 1%   +15.67%  (p=0.008 n=5+5)
Read/sample_lz4_66_kB-4           824MB/s ± 1%     909MB/s ± 2%   +10.25%  (p=0.008 n=5+5)
Read/sample_snappy_66_kB-4        759MB/s ± 1%     852MB/s ± 6%   +12.37%  (p=0.008 n=5+5)
Read/sample_flate_66_kB-4         506MB/s ± 7%     556MB/s ± 4%    +9.88%  (p=0.008 n=5+5)
Read/sample_none_262_kB-4         983MB/s ± 2%    1194MB/s ± 2%   +21.47%  (p=0.008 n=5+5)
Read/sample_lz4-64k_262_kB-4      830MB/s ± 1%     932MB/s ± 2%   +12.24%  (p=0.008 n=5+5)
Read/sample_lz4-256k_262_kB-4     839MB/s ± 1%     942MB/s ± 2%   +12.28%  (p=0.008 n=5+5)
Read/sample_lz4-1M_262_kB-4       829MB/s ± 2%     934MB/s ± 2%   +12.60%  (p=0.008 n=5+5)
Read/sample_lz4_262_kB-4          836MB/s ± 2%     937MB/s ± 3%   +12.11%  (p=0.008 n=5+5)
Read/sample_snappy_262_kB-4       774MB/s ± 2%     878MB/s ± 2%   +13.44%  (p=0.008 n=5+5)
Read/sample_flate_262_kB-4        529MB/s ± 2%     587MB/s ± 2%   +10.94%  (p=0.008 n=5+5)
Read/sample_none_524_kB-4         970MB/s ± 2%    1180MB/s ± 2%   +21.64%  (p=0.008 n=5+5)
Read/sample_gzip_524_kB-4         521MB/s ± 1%     559MB/s ± 2%    +7.31%  (p=0.008 n=5+5)
Read/sample_lz4-64k_524_kB-4      842MB/s ± 1%     937MB/s ± 4%   +11.30%  (p=0.008 n=5+5)
Read/sample_lz4-256k_524_kB-4     834MB/s ± 2%     945MB/s ± 3%   +13.37%  (p=0.008 n=5+5)
Read/sample_lz4-1M_524_kB-4       842MB/s ± 1%     949MB/s ± 1%   +12.63%  (p=0.008 n=5+5)
Read/sample_lz4_524_kB-4          849MB/s ± 0%     929MB/s ± 7%    +9.53%  (p=0.016 n=4+5)
Read/sample_snappy_524_kB-4       783MB/s ± 2%     882MB/s ± 2%   +12.65%  (p=0.008 n=5+5)
Read/sample_flate_524_kB-4        534MB/s ± 2%     585MB/s ± 1%    +9.73%  (p=0.008 n=5+5)

name                           old alloc/op     new alloc/op     delta
Write/unordered-lz4-4              18.8MB ± 4%      17.2MB ± 7%    -8.28%  (p=0.008 n=5+5)
Read/none_66_kB-4                  41.9kB ± 0%      43.7kB ± 0%    +4.41%  (p=0.008 n=5+5)
Read/gzip_66_kB-4                   713kB ± 0%       741kB ± 0%    +3.85%  (p=0.016 n=5+4)
Read/lz4-64k_66_kB-4                730kB ± 1%       748kB ± 0%    +2.53%  (p=0.016 n=5+4)
Read/lz4-256k_66_kB-4               770kB ± 0%       806kB ± 3%    +4.70%  (p=0.016 n=4+5)
Read/lz4-1M_66_kB-4                 770kB ± 0%       812kB ± 4%    +5.43%  (p=0.016 n=4+5)
Read/lz4_66_kB-4                    770kB ± 0%       792kB ± 0%    +2.83%  (p=0.029 n=4+4)
Read/snappy_66_kB-4                 361kB ± 0%       376kB ± 0%    +4.02%  (p=0.008 n=5+5)
Read/flate_66_kB-4                  715kB ± 0%       743kB ± 0%    +3.88%  (p=0.016 n=5+4)
Read/none_262_kB-4                 11.2kB ± 0%      11.7kB ± 0%    +4.12%  (p=0.016 n=5+4)
Read/gzip_262_kB-4                  198kB ± 0%       203kB ± 0%    +2.93%  (p=0.016 n=4+5)
Read/lz4-64k_262_kB-4               169kB ± 0%       174kB ± 0%    +2.75%  (p=0.008 n=5+5)
Read/lz4-256k_262_kB-4              177kB ± 0%       182kB ± 0%    +2.79%  (p=0.008 n=5+5)
Read/lz4-1M_262_kB-4                181kB ± 0%       186kB ± 0%    +2.77%  (p=0.008 n=5+5)
Read/lz4_262_kB-4                   181kB ± 0%       186kB ± 0%    +2.73%  (p=0.016 n=5+4)
Read/snappy_262_kB-4               87.8kB ± 0%      90.1kB ± 0%    +2.58%  (p=0.008 n=5+5)
Read/flate_262_kB-4                 197kB ± 0%       203kB ± 0%    +2.63%  (p=0.016 n=5+4)
Read/zstd_262_kB-4                  553MB ± 0%       552MB ± 0%    -0.15%  (p=0.032 n=5+5)
Read/none_524_kB-4                 5.94kB ± 0%      6.16kB ± 0%    +3.76%  (p=0.016 n=5+4)
Read/gzip_524_kB-4                 96.2kB ± 0%      98.3kB ± 0%    +2.16%  (p=0.016 n=4+5)
Read/lz4-64k_524_kB-4              70.9kB ± 0%      72.8kB ± 0%    +2.71%  (p=0.016 n=4+5)
Read/lz4-256k_524_kB-4             73.8kB ± 0%      75.8kB ± 0%    +2.68%  (p=0.008 n=5+5)
Read/lz4-1M_524_kB-4               76.5kB ± 0%      78.7kB ± 0%    +2.77%  (p=0.016 n=4+5)
Read/lz4_524_kB-4                  76.5kB ± 0%      78.6kB ± 0%    +2.74%  (p=0.016 n=5+4)
Read/snappy_524_kB-4               39.1kB ± 0%      39.5kB ± 0%    +1.19%  (p=0.008 n=5+5)
Read/flate_524_kB-4                95.4kB ± 0%      97.3kB ± 0%    +2.06%  (p=0.008 n=5+5)
Read/sample_none_66_kB-4           39.9kB ± 0%      41.7kB ± 0%    +4.62%  (p=0.008 n=5+5)
Read/sample_gzip_66_kB-4            686kB ± 0%       715kB ± 0%    +4.23%  (p=0.016 n=4+5)
Read/sample_lz4-64k_66_kB-4         707kB ± 0%       728kB ± 0%    +2.88%  (p=0.016 n=5+4)
Read/sample_lz4-256k_66_kB-4        749kB ± 0%       783kB ± 4%    +4.65%  (p=0.008 n=5+5)
Read/sample_lz4_66_kB-4             748kB ± 0%       770kB ± 0%    +2.91%  (p=0.016 n=5+4)
Read/sample_snappy_66_kB-4          350kB ± 0%       364kB ± 0%    +4.04%  (p=0.029 n=4+4)
Read/sample_flate_66_kB-4           688kB ± 0%       716kB ± 0%    +4.08%  (p=0.029 n=4+4)
Read/sample_none_262_kB-4          10.6kB ± 0%      11.0kB ± 0%    +4.23%  (p=0.016 n=5+4)
Read/sample_gzip_262_kB-4           194kB ± 0%       199kB ± 0%    +2.48%  (p=0.016 n=4+5)
Read/sample_lz4-64k_262_kB-4        165kB ± 0%       169kB ± 0%    +2.86%  (p=0.016 n=4+5)
Read/sample_lz4-256k_262_kB-4       172kB ± 0%       177kB ± 0%    +2.92%  (p=0.016 n=4+5)
Read/sample_lz4-1M_262_kB-4         176kB ± 0%       181kB ± 0%    +2.91%  (p=0.029 n=4+4)
Read/sample_lz4_262_kB-4            176kB ± 0%       181kB ± 0%    +2.81%  (p=0.016 n=5+4)
Read/sample_snappy_262_kB-4        88.1kB ± 0%      90.8kB ± 0%    +3.11%  (p=0.029 n=4+4)
Read/sample_flate_262_kB-4          194kB ± 0%       198kB ± 0%    +2.13%  (p=0.029 n=4+4)
Read/sample_none_524_kB-4          5.56kB ± 0%      5.76kB ± 0%    +3.65%  (p=0.016 n=5+4)
Read/sample_gzip_524_kB-4          95.4kB ± 0%      96.9kB ± 0%    +1.56%  (p=0.008 n=5+5)
Read/sample_lz4-64k_524_kB-4       69.0kB ± 0%      71.0kB ± 0%    +2.87%  (p=0.008 n=5+5)
Read/sample_lz4-256k_524_kB-4      71.8kB ± 0%      73.8kB ± 0%    +2.79%  (p=0.016 n=4+5)
Read/sample_lz4-1M_524_kB-4        74.5kB ± 0%      76.6kB ± 0%    +2.75%  (p=0.008 n=5+5)
Read/sample_lz4_524_kB-4           74.5kB ± 0%     188.4kB ±89%  +152.98%  (p=0.008 n=5+5)
Read/sample_snappy_524_kB-4        40.7kB ± 1%      41.3kB ± 1%    +1.58%  (p=0.008 n=5+5)
Read/sample_flate_524_kB-4         95.2kB ± 0%      96.2kB ± 0%    +0.95%  (p=0.008 n=5+5)

name                           old allocs/op    new allocs/op    delta
Read/gzip_66_kB-4                   13.2k ± 0%       13.2k ± 0%    -0.04%  (p=0.000 n=5+4)
Read/zstd_66_kB-4                   18.0k ± 1%       17.8k ± 1%    -1.06%  (p=0.032 n=5+5)
Read/gzip_262_kB-4                  4.61k ± 0%       4.61k ± 0%    -0.11%  (p=0.029 n=4+4)
Read/flate_262_kB-4                 4.61k ± 0%       4.60k ± 0%    -0.11%  (p=0.008 n=5+5)
Read/zstd_262_kB-4                  7.10k ± 2%       6.88k ± 3%    -3.01%  (p=0.008 n=5+5)
Read/gzip_524_kB-4                  2.62k ± 0%       2.62k ± 0%    -0.06%  (p=0.000 n=4+5)
Read/zstd_524_kB-4                  6.13k ± 2%       5.94k ± 2%    -3.03%  (p=0.024 n=5+5)
Read/sample_flate_66_kB-4           13.2k ± 0%       13.2k ± 0%    -0.01%  (p=0.029 n=4+4)
Read/sample_flate_262_kB-4          4.62k ± 0%       4.61k ± 0%    -0.22%  (p=0.029 n=4+4)
Read/sample_zstd_262_kB-4           7.12k ± 1%       6.97k ± 1%    -2.11%  (p=0.008 n=5+5)
Read/sample_gzip_524_kB-4           2.63k ± 0%       2.63k ± 0%    -0.11%  (p=0.008 n=5+5)
Read/sample_flate_524_kB-4          2.63k ± 0%       2.62k ± 0%    -0.15%  (p=0.008 n=5+5)
Read/sample_zstd_524_kB-4           6.11k ± 2%       5.89k ± 1%    -3.68%  (p=0.016 n=5+4)
```

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>",91,53,1,0,"2018-04-16 10:25:39","1625.2"
"grafana/loki","ed4822b523712ce721597575a714f970119979f5","daixiang0","2019-02-24 02:39:53","false","fix small language issue

Signed-off-by: Xiang Dai <764524258@qq.com>",81,10,0,0,"2018-04-16 10:25:39","307.68"
"grafana/loki","4e61c6029616facd54d254fab2ce6c4189934964","szczepad","2022-10-11 10:59:21","true","Loki: Renames metric 'loki_log_messages_total' to 'loki_internal_log_messages_total' (#7361)

**What this PR does / why we need it**:
Renames the metric 'loki_log_messages_total' to a more descriptive name.
Keeps and deprecates the previously existing metric to not break
functionality.

**Which issue(s) this PR fixes**:
Fixes #7088 

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the `CONTRIBUTING.md` guide
- [x] Documentation added
- [x] Tests updated
- [x] `CHANGELOG.md` updated
- [x] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",92,54,1,0,"2018-04-16 10:25:39","1636.02"
"grafana/loki","2a6ddffb49bd26aef51dbc80ab85d093267eab49","KMiller-Grafana","2021-11-22 17:07:42","true","Docs: Modify label names of configuration blocks (#4787)

* Docs: Add label names of configuration blocks

* Docs: Match configuration block name with docs subsection name",212,43,0,0,"2018-04-16 10:25:39","1312.03"
"grafana/loki","6be2fb0aed22e9200ac4ee30303258ade3c49d97","liguozhong","2021-06-03 09:14:56","true","[doc] mtric -> metric (#3578)",207,38,0,1,"2018-04-16 10:25:39","1142.7"
"grafana/loki","895d144303b2d0fadc367db4c7955eb7a34a9e28","ssncferreira","2021-11-05 12:47:19","true","Fix dskit/ring metric with 'cortex_' prefix (#4656)",172,43,0,0,"2018-04-16 10:25:39","1294.85"
"grafana/loki","5dc3af01fce9f0f78011218c882d231e1f24b8a4","Champ-Goblem","2021-11-15 07:47:12","true","Add northflank to the adopters list (#4729)

Signed-off-by: Champ-Goblem <cameron_mcdermott@yahoo.co.uk>",194,43,0,0,"2018-04-16 10:25:39","1304.64"
"grafana/loki","636f3843b735485a875c0182e850d5580d3f9b11","JoaoBraveCoding","2023-06-20 10:12:36","true","operator: adjusts 1x.extra-small resources according to findings (#9735)",61,62,1,0,"2018-04-16 10:25:39","1890.24"
"grafana/loki","4c5cd1d239b5bf2cc21cab35a68d34b884e36c2e","btaani","2023-04-25 12:00:28","true","operator: Add PodDisruptionBudget to the Ruler (#9262)",79,60,1,0,"2018-04-16 10:25:39","1835.32"
"grafana/loki","6a7403c4f5cd0a01dea13954fe6f51631f485ad1","owen-d","2023-02-10 10:41:13","true","correctly calculate max shards (#8494)",79,58,1,1,"2018-04-16 10:25:39","1755.01"
"grafana/loki","5031ae1b4ea692e47138e1652ddc8b4777330720","kavirajk","2023-01-18 18:37:10","true","doc(promtail): Doc about how log rotate works with promtail. (#8096)

Changes
1. Why log rotation matters?
2. Different components involving in reading, writing and rotating logs
3. Different types of log rotation.
4. How to configure log rotation effectively to work with promtail

Fixes # Should resolve all confusions around log rotation errors with
promtail

Related: #7967 

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",84,57,1,1,"2018-04-16 10:25:39","1733.34"
"grafana/loki","f86d12f49887fbeaeff1c39eeb09d754c69b477d","chaudum","2022-12-12 12:51:05","false","Update dskit to latest commit

Diff: https://github.com/grafana/dskit/compare/b1b307db4f30..3e308a49441b

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",99,56,1,1,"2018-04-16 10:25:39","1697.1"
"grafana/loki","01fe534751ff7d6ad058688c0f3709d56403a7a1","trevorwhitney","2022-06-16 15:04:02","true","Add index gateway to the read path (#6385)",67,50,0,1,"2018-04-16 10:25:39","1521.19"
"grafana/loki","88b5a767bc20c86325d32479b9b0d9d93bf4b1e3","sandeepsukhani","2022-01-20 09:27:32","true","changes on read path for supporting per user index with boltdb-shipper (#5073)",266,45,0,1,"2018-04-16 10:25:39","1369.71"
"grafana/loki","0d70e340f21b5cd7ddec99a356ce60db01c4f085","slim-bean","2021-02-26 15:49:33","true","Tooling: Update chunks-inspect to understand the new chunk format as well as new compression algorithms (#3377)

* Update chunks-inspect to understand the new chunk format as well as new compression algorithms

* forgot to add go mod files

* Update cmd/chunks-inspect/loki.go

Co-authored-by: Kaviraj <kavirajkanagaraj@gmail.com>

Co-authored-by: Kaviraj <kavirajkanagaraj@gmail.com>",135,34,0,1,"2018-04-16 10:25:39","1040.72"
"grafana/loki","45d40a5c0091cafa6bc9c3837259d2409a64072d","adityacs","2020-02-17 16:58:09","true","Fix panic in debug message (#1687)",115,22,0,1,"2018-04-16 10:25:39","666.52"
"grafana/loki","7b7b32f1437101aca724ed37b4891d2dadeac27e","granular-ryanbonham","2019-02-25 02:15:46","false","Add support for setting terminationGracePeriodSeconds. Add example readiness proble for loki and example antiaffinity.",82,10,0,0,"2018-04-16 10:25:39","308.66"
"grafana/loki","d084dc7f4b791c8fd89288f0c67c90a520516bf0","owen-d","2022-03-17 17:05:32","true","Tsdb/hash order (#5631)

* encode fingerprint into series in tsdb

* uses series fingerprint in index reads

* order tsdb series by fprint

* tsdb writes fingerprint offsets table

* shardannotation is part of tsdb/index, fixes testware

* loads fingerprint offsets from tsdb

* removes unnecessary sortedpostings

* adds prefix sharding logic

* sharded tsdb postings

* updates benchmark to pass nil hash

* runs tsdb benches with variable count",308,47,0,1,"2018-04-16 10:25:39","1427.03"
"grafana/loki","32d2f64b31dad817485961cd1023c49e8998b80e","tomwilkie","2019-04-19 07:39:35","false","Fix ingester test.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",95,12,0,0,"2018-04-16 10:25:39","368.13"
"grafana/loki","7ee1cff8c773a276303183c41df20b6d49ba7017","JStickler","2023-10-17 14:22:04","true","Fixing 404s (#10921)

Fixes several broken cross-references.

**Which issue(s) this PR fixes**:
Fixes #10867",22,66,1,0,"2018-04-16 10:25:39","2007.41"
"grafana/loki","9cab6650557a3b98ef4b69ebde2a6ee503101079","Red-GV","2022-08-03 12:46:42","true","Adding properties file (#6799)",77,52,0,1,"2018-04-16 10:25:39","1568.1"
"grafana/loki","c4261b19fd8b154d8562e12a8dff4bb9de3ed085","MasslessParticle","2023-04-13 19:22:39","true","Fix parsing of long queries (#9134)

Loki uses a `scanner.Scanner` to consume the characters in a query.
`lex.go` relies heavily on the assumption a scanner can be copied to
perform speculative parsing. The problem is that sometimes speculative
parsing overruns the scanners internal buffer of `1024` bytes and incurs
an additional read to the underlying reader. At that point, all
subsequent scanners are out of sync with their underlying readers and
the query may fail to be parsed.

In the case of #9132, there is a function call at line `1024`. `lex.go`
tries to understand this is a function call by speculatively parsing and
incurs an underlying read which consumers the rest of the reader. When
the lexer tries to scan the next character with the original scanner,
the reader is already consumed even though only 1024 bytes have been
scanned

The scanner has an internal buffer size of `1024 bytes`. This PR copies
`scanner.Scanner` from the `text/scanner` package and increases the
internal buffer to `maxInputSize` which guarantees that no calls to
`Scan` will incur reads beyond the first one.

Ideally we wouldn't pass Scanners around in such a way but the cost of
that is to rethink much of Loki's lexing logic. Given we know a max
input size and we already have that in memory, this solution should
suffice.

Fixes https://github.com/grafana/loki/issues/9132",84,60,1,1,"2018-04-16 10:25:39","1818.37"
"grafana/loki","94113ee080a6397a7f6e35146e4a4e0b64879381","kavirajk","2021-11-18 13:53:07","true","Logql `stdin` support only log queries (#4606)

* Hack stdin client into LogCLI

Add flag to choose what kind of client to make request to.

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Label filter working

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Demo checkpoint1

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Metrics query working.

Issue was with default value of `step` (1 nanosecond).
StepEvaluator try to go through every nanosecond to apply aggregate on sample data
during the metric queries.

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Basic tests for fileClient

* Tests for logqueries direction

* Use HeapIterator for Entries.

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Remove some debug statements

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Remove support for metric queries. Stick with only log queries

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Small rough usage doc

* Remove filesampleiterator

* Fix some typos and tests

* Fix breaking test cases

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Make linter happy

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* PR remarks.

1. Add `--stdin` in examples of the usage
2. Add `--stdin` in all the command help output

* PR remarks
- Use parsed labels correctly
- Fix indendation with --stdin flag

* Fix issue with direction

* Fix linter

* MaxInt64 -> MaxInt (to support even arm32 images)

* Add note on calculating `step` value on the client side",204,43,0,1,"2018-04-16 10:25:39","1307.89"
"grafana/loki","06b50590a7f1e89694e5984edcecff9a9689b013","gouthamve","2020-05-06 12:51:39","true","Fix bug in logql parsing that leads to crash. (#2046)

* Fix bug in logql parsing that leads to crash.

```
panic: runtime error: invalid memory address or nil pointer dereference
[signal SIGSEGV: segmentation violation code=0x1 addr=0x18 pc=0x20ae356]
goroutine 39530021 [running]:
github.com/grafana/loki/pkg/logql.andFilter.Filter(0x0, 0x0, 0x3beffc0, 0xc01f065bc0, 0xc01aaaec00, 0x13d, 0x200, 0xffffffffffffffff)
	/src/loki/pkg/logql/filter.go:66 +0x26
github.com/grafana/loki/pkg/chunkenc.(*bufferedIterator).Next(0xc00a48fba0, 0x0)
	/src/loki/pkg/chunkenc/memchunk.go:616 +0x1cb
github.com/grafana/loki/pkg/iter.(*nonOverlappingIterator).Next(0xc00130ae40, 0x0)
	/src/loki/pkg/iter/iterator.go:438 +0x135
github.com/grafana/loki/pkg/iter.(*timeRangedIterator).Next(0xc00130ae80, 0x0)
	/src/loki/pkg/iter/iterator.go:497 +0x48
github.com/grafana/loki/pkg/iter.(*reverseIterator).load(0xc00072ac40)
	/src/loki/pkg/iter/iterator.go:555 +0x70
github.com/grafana/loki/pkg/iter.(*reverseIterator).Next(0xc00072ac40, 0x0)
	/src/loki/pkg/iter/iterator.go:563 +0x2f
github.com/grafana/loki/pkg/iter.(*nonOverlappingIterator).Next(0xc00130af40, 0x10)
	/src/loki/pkg/iter/iterator.go:438 +0x135
```

This is caused by people doing `|= """"` which would result in parsing of
TrueFilter but would be returned as nil.

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>

* Add tests for the panic

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>",118,25,0,0,"2018-04-16 10:25:39","750.6"
"grafana/loki","2745b7c956ddfe251dad2e15aeb29e5409c51b89","slim-bean","2020-04-01 15:08:52","true","Adding upgrade doc and updating changelog for release

Signed-off-by: Edward Welch <edward.welch@grafana.com>",121,23,0,1,"2018-04-16 10:25:39","710.45"
"grafana/loki","d5141c05a7b0e2e63fd2ae679d098577f1076cc9","slim-bean","2020-12-10 20:45:47","true","update changelog",122,32,0,1,"2018-04-16 10:25:39","964.93"
"grafana/loki","e384efd10732b440974fb1b956025ac87f85fe86","slim-bean","2021-05-25 19:07:43","true","fix make docs target (#3764)",202,37,0,1,"2018-04-16 10:25:39","1135.11"
"grafana/loki","16266433db17e92ab03ce7ffcfca5a3cc3c1ef70","slim-bean","2020-10-26 22:09:43","true","Docs: improve the helm upgrade section (#2811)

* improve the helm upgrade section

* wording",119,30,0,1,"2018-04-16 10:25:39","920.99"
"grafana/loki","9dbdcb3fce7d24390d0c25f33143f24ca903ce5a","rgroothuijsen","2023-04-26 08:02:49","true","[loki] Replace deprecated MinIO environment variables (#9244)

**What this PR does / why we need it**:
This PR replaces the deprecated `MINIO_ACCESS_KEY` and
`MINIO_SECRET_KEY` environment variables in the Docker Compose templates
with their new names `MINIO_ROOT_USER` and `MINIO_ROOT_PASSWORD`. This
change has only been applied to the templates which do not have a pinned
MinIO version.

**Which issue(s) this PR fixes**:
Fixes #8702

**Special notes for your reviewer**:
This splits the previous PR #9150 in order to have separate PRs for Loki
and Operator.

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

Co-authored-by: Michel Hollands <42814411+MichelHollands@users.noreply.github.com>",80,60,1,0,"2018-04-16 10:25:39","1836.15"
"grafana/loki","2427fab32d42117b37f7f72250ab5491628c134f","trevorwhitney","2021-10-21 17:58:08","true","Configuration: add a common config section for object storage (#4473)

* add common config for object storage

Signed-off-by: Trevor Whitney <trevorjwhitney@gmail.com>

* wip

Signed-off-by: Trevor Whitney <trevorjwhitney@gmail.com>

* add test to compactor config override

Signed-off-by: Trevor Whitney <trevorjwhitney@gmail.com>

* update changelog

Signed-off-by: Trevor Whitney <trevorjwhitney@gmail.com>

* changes from PR review

* rename object_store -> storage

* add local/filesytem support to common object storage config",165,42,0,1,"2018-04-16 10:25:39","1281.06"
"grafana/loki","a8e73e1ae05d7f345484cff9e7c696d91049970a","siavashs","2020-10-28 18:52:26","true","Docs: -querier.split-queries-by-day deprecation (#2833)

Add missing description and deprecation note.",123,30,0,0,"2018-04-16 10:25:39","922.85"
"grafana/loki","a3b9534f372a99a5faae6995eb0ba03d8a3c31a0","chaudum","2023-09-22 16:45:08","true","Restructure API reference documentation (#10654)


* Removed unsupported APIs
* Change order so it matches the list on top 
* Write better headings
* Make cURL examples consistent with command-response-blocks

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",35,65,1,1,"2018-04-16 10:25:39","1982.51"
"grafana/loki","e2cde4000921809987da385ad402ffe33e21fab1","chaudum","2022-04-29 09:31:20","true","Add query scheduler to ""Read Resources"" mixin dashboard (#6028)

This component has been around for a while but has not been added to the
loki-mixin yet.

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",94,48,0,1,"2018-04-16 10:25:39","1473.96"
"grafana/loki","5c9a913caa69546b3127d6320f052b6501f43459","owen-d","2020-12-02 13:50:19","true","loki wal libsonnet (#3014)",124,31,0,1,"2018-04-16 10:25:39","956.64"
"grafana/loki","f861068df4800215c425dbe76c6f83e6a31fedee","owen-d","2023-10-16 15:17:10","true","moves boomfilters lib into loki (#10898)

In an effort to speed up development, this moves a subset of [my
fork](https://github.com/owen-d/BoomFilters) of the
https://github.com/tylertreat/BoomFilters library into loki itself. I've
done my best to preserve original license headers/etc.",24,66,1,1,"2018-04-16 10:25:39","2006.45"
"grafana/loki","7c680e4ce0b59e574c86618450ba078bbacb8e79","MichelHollands","2022-08-10 16:48:26","true","update dskit and fix (#6868)

* update dskit and fix

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Use a separate registry to avoid duplicate registration

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Fix runtime config initialization

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* run go mod tidy

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Update vendor/modules.txt

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",77,52,0,1,"2018-04-16 10:25:39","1575.27"
"grafana/loki","f2fb161a08a1f8735939fd8fb65c7fd0006fcb5f","gouthamve","2019-05-17 11:37:07","true","Fix local config: Use DayTime (#598)

* Fix local config: Use DayTime

Psst, the date is the first commit date for loki ;)

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>

* Fix the config in ksonnet and helm too

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>",102,13,0,0,"2018-04-16 10:25:39","396.3"
"grafana/loki","f951f083ca000236f138239a446dc1f695a677dd","grafanabot","2023-08-17 16:25:28","true","[Release Notes Appender] Add PR #8646: Optimize .+ regex line filter (#10286)

Add PR #8646 to release notes for next release

---------

Co-authored-by: Travis Patterson <travis.patterson@grafana.com>",52,64,1,0,"2018-04-16 10:25:39","1947.5"
"grafana/loki","0885a4937010391c50b487d5dfba99cf40e12540","adityacs","2020-07-14 18:26:41","true","configuration doc improvements (#2318)",118,27,0,1,"2018-04-16 10:25:39","818.83"
"grafana/loki","d563d2c28b3196d965a80b89a4d9d06f79af9304","cyriltovena","2022-02-25 13:56:12","true","Fixes Reads dashboard boltdb panels. (#5475)",300,46,0,1,"2018-04-16 10:25:39","1404.9"
"grafana/loki","d9380eaac950c669864c0af60fd99eae281d2438","cyriltovena","2021-05-12 09:03:50","true","Add a target to find dead link in our documentation. (#3713)

This is not part of the CI because it can be throttle and it's not super fast ~2min.

But still usefull to check that no link are down if we make some big structure changes.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",191,37,0,1,"2018-04-16 10:25:39","1121.69"
"grafana/loki","a6df09bc97f64584c2efbeb2550a2d59526f39c0","afayngelerindbx","2022-11-10 05:51:49","true","adds Dropbox to the adopters list (#7651)

**What this PR does / why we need it**:
Dropbox recently deployed Loki. This PR adds us to the adopters list",84,55,1,0,"2018-04-16 10:25:39","1664.81"
"grafana/loki","0a3621822bf60abe7ca7e05fc5255df228fc8509","polar3130","2020-03-23 15:13:13","true","Helm/loki-stack: refresh default grafana.image.tag to 6.7.0 (#1825)

* update grafana.image.tag in loki-stack' helm chart

* bump loki-stack chart

Co-authored-by: Cyril Tovena <cyril.tovena@gmail.com>",120,23,0,0,"2018-04-16 10:25:39","702.45"
"grafana/loki","c955702b32c32e4fa401ef22d2d7a6d2a68f7db7","pracucci","2019-08-07 13:50:06","false","Fixed out of order entries allowed in a chunk on edge case (#859)",97,16,0,0,"2018-04-16 10:25:39","476.39"
"grafana/loki","fcd5dce0eef6e97bd64430614f23d47c500568ed","kavirajk","2023-09-26 07:59:24","true","doc: Add patching vulnerabilities step on release doc (#10710)

**What this PR does / why we need it**:

Follow up to other release related docs #10646
https://github.com/grafana/loki/pull/10676

Goal is make the doc complete for all type of Loki releases.
Stable/Patch/Security releases.

Changes:
1. Two new docs
a. Patch-Vulnerabilities Overview - patching go dependencies, Go
compiler and Docker images
b. Patch-Go-Version - How to patch Go version on both loki build image
and loki binaries.
2. Renamed files to remove number prefix on the file name e.g:
`1-create-release-branch` to just `create-release-branch`. Makes it easy
to add more docs without much change.

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

Follow up to other release related docs #10646
https://github.com/grafana/loki/pull/10676

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added

---------

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",33,65,1,1,"2018-04-16 10:25:39","1986.15"
"grafana/loki","5652a7baf43be3a5c70983c1debd40fa4abda60d","chaudum","2023-09-05 07:56:19","true","chore(storage): Simplify store interfaces and abstractions (pt 1) (#10435)

In an attempt to simplify the store abstractions/interfaces, this PR does the following cleanups:

* Remove duplicate store field in `pkg/storage.*store`
* Remove duplicate index.Filterable interface inheritance
* Remove nesting from CompositeStore
* Rename/move ChunkReader to ./pkg/storage.SelectStore

---------

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",47,65,1,1,"2018-04-16 10:25:39","1965.15"
"grafana/loki","4d1c6e0169978f958e5e6e25dd80264327108b98","owen-d","2021-02-02 16:20:44","true","adds another test (#3278)",122,33,0,1,"2018-04-16 10:25:39","1016.75"
"grafana/loki","f78ceec941549481a880ebb135753d9a333b86c7","owen-d","2023-04-28 18:29:46","true","fixes bug during chunk iteration using markers (#9328)

Tricky one to find, but this does the following
* correctly subtracts remaining chunk count when skipping a page (this
was previously using a zero-valued marker)
* correctly set previous maxt on pages that are skipped. This is
important because chunks themselves are delta-encoded against the
previous chunk.
* removes the markers pool from the chunk decoding which isn't needed.
* adds a test
* adds a bit more logging on which series resulted in a decoding error
during chunk iteration",79,60,1,1,"2018-04-16 10:25:39","1838.59"
"grafana/loki","b315ed0ddf3a345fb6e9937052cf8053a268df88","chaudum","2022-06-16 13:44:28","true","Sum values in unwrapped rate aggregation instead of treating them as counter (#6361)

* Revert unwrapped rate aggregation to previous implementation

This PR reverts the implementation done in #5013 to the original
implementation that sums the extracted values from the log lines instead
of treating them like a Prometheus counter metric.

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* Move changelog entry

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* Remove unused/dead code

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* Clean changelog

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",67,50,0,1,"2018-04-16 10:25:39","1521.14"
"grafana/loki","ab92ec8863234c0692c32a4fcd4bc858d1701482","slim-bean","2020-03-06 20:32:07","true","Update the CD deploy task name (#1780)

Signed-off-by: Edward Welch <edward.welch@grafana.com>",116,23,0,1,"2018-04-16 10:25:39","685.67"
"grafana/loki","cdc0dc47e160be9b10c8378cd093ff2c91c32670","rfratto","2019-10-02 21:17:53","false","build: enable journal in promtail linux release build  (#1072)

* build: override promtail release build with cgo-enabled binary

The published binary of promtail for linux/amd64 was not built with CGO
support, so journal tailing could not be used.

This is kind of a dirty hack: we just re-build promtail at the end of
building everything else with CGO enabled. It's not clear how it could
be done more cleanly.

Fixes #1057.

* build: break out gox builds",77,17,0,1,"2018-04-16 10:25:39","531.7"
"grafana/loki","80313471e544ef90ebe05eb8bfa972296f14a8d5","joe-elliott","2019-10-02 21:08:27","false","Updated push path to current prod (#1108)

Signed-off-by: Joe Elliott <number101010@gmail.com>",77,17,0,0,"2018-04-16 10:25:39","531.7"
"grafana/loki","fa378ac0ece4ac922af339287611ff67032e4b9a","poyzannur","2023-11-08 08:57:33","true","Add first step for creating a single bloom from series (#11115)

**What this PR does / why we need it**:
This is the first step to create a bloom from a series. The logic to get tenants and tables is a temporary hack and will be replaced by the ring logic in https://github.com/grafana/loki/pull/11154

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:
It does not handle appending multiple blooms into blocks. 
It does not handle creating and uploading of meta files. 

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)
- [ ] If the change is deprecating or removing a configuration option,
update the `deprecated-config.yaml` and `deleted-config.yaml` files
respectively in the `tools/deprecated-config-checker` directory.
[Example
PR](https://github.com/grafana/loki/pull/10840/commits/0d4416a4b03739583349934b96f272fb4f685d15)",2,67,1,0,"2018-04-16 10:25:39","2028.19"
"grafana/loki","e5138ce9b198b6c72c8f04461352ca3c573b00fa","irizzant","2023-04-26 17:21:25","true","Loki microservices tanka: remove useless PVC (#9213)

**What this PR does / why we need it**:
Remove useless pvc. There are multiple PVCs defined for Ingesters and there should be only one.

**Which issue(s) this PR fixes**:
Fixes #9211",81,60,1,0,"2018-04-16 10:25:39","1836.54"
"grafana/loki","b7e868ad5c5d21814d244ff0b27a6b6d0a535be1","slim-bean","2020-03-26 20:12:00","true","docs: tweak the doc section of the readme a little (#1856)

* tweak the doc section of the readme a little

Signed-off-by: Edward Welch <edward.welch@grafana.com>

* reword

Signed-off-by: Edward Welch <edward.welch@grafana.com>",121,23,0,1,"2018-04-16 10:25:39","705.66"
"grafana/loki","3fef08ca1aaa71d0387859ca632563f8403099b5","slim-bean","2021-11-05 20:21:29","true","2.4 release notes, changelog, upgrade guide (#4658)

* update changelog, release notes, and upgrade guide for 2.4

* tweak release notes a little

* make path relative for kafka config

* update upgrade guide

* more docs
fix the cache size not applied to results cache.

* fix prefix name in ring_config",176,43,0,1,"2018-04-16 10:25:39","1295.16"
"grafana/loki","44173400896892aa1dfb0fa1815e4ee90160c1b3","garrettlish","2021-10-05 14:22:55","true","add on and ignoring clauses in binOpExpr (#4391)

* add on and ignoring clauses in binOpExpr

* add on/ignoring new operator shardmapper unit test

* add doc for on and ignoring keywords

* resolve comments

* use a scoped error to replace mutate stepEvaluator via type switching
* change VectorMatching Include from empty string array to nil
* prohibit sharding when we're changing the label groupings such as on or ignoring
* add unit test to cover multiple matches for labels error
* fix expr.y format issue

* resolve comments

* reformat on and ignoring keywords doc
* add sharding unit test for on and ignoring keywords

* resolve comments: add a sentence for each example to help docs readers to understand the larger picture

Co-authored-by: garrettlish <garrettlish@163.com>",136,42,0,0,"2018-04-16 10:25:39","1264.91"
"grafana/loki","10e55a635956d65dd905b5396888e5b56eea0f79","ashwanthgoli","2023-06-23 09:41:17","true","store: fix incorrect usage of period config in table range (#9754)

**What this PR does / why we need it**:
We are incorrectly taking reference to a loop variable in store init, I
overlooked this part as the reference was being taken in the call to
`GetIndexTableNumberRange`

As a result of this, `TableRange` of each period (which is used by
index-shipper) points to the latest `periodConfig`. This in itself is
not a problem if the index prefix doesn't change as we use the
`periodConfig` only to generate the `tableName`. But if the index prefix
changes across periods, we end up losing access to the indexes using the
old prefix.


**Special notes for your reviewer**:

**Checklist**
- [X] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [x] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

---------

Signed-off-by: Ashwanth Goli <iamashwanth@gmail.com>",62,62,1,0,"2018-04-16 10:25:39","1893.22"
"grafana/loki","2a64b30600c600aaec2262a23467b488f354af82","tomwilkie","2019-03-06 11:27:13","true","Remove some white noise.",88,11,0,0,"2018-04-16 10:25:39","320.04"
"grafana/loki","e04fb0073b4645312171c5122f009b89a3adaf25","chaudum","2022-11-08 16:16:13","false","Add make target for building and pushing the fluentd plugin

The fluentd plugin can now easily be published using the `make
fluentd-plugin-push` make target.

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",85,55,1,1,"2018-04-16 10:25:39","1663.24"
"grafana/loki","db283da0882cdffc3d6ba425d0c31943890d88a7","kavirajk","2022-01-25 09:31:22","true","Add `MaxSurge` and `MaxUnavailable` strategy to all Loki k8 workloads. (#5227)

* Add `MaxSurge` and `MaxUnavailable` strategy to all loki k8 workloads.

This fixes couple of issues.
1. By default these configs are 25% in k8, meaning during rollout 25% of pods are allowed to shutdown immediately.
2. Due to (1), during graceful shutdown process, 25% of all the pods access consul to `unregister()` from shared key value.

(2) makes CAS rate of underlying KV store high (leads to lots of retry and failing) sometimes failing to unregister leaving the ring ""unhealthy""

Also this PR make these configs consistent across all k8 workloads.

More details: https://github.com/grafana/dskit/issues/117

* Remove it from statefulset workloads

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",275,45,0,1,"2018-04-16 10:25:39","1374.71"
"grafana/loki","9d5665e34aba3fb01cd17aa5c16c562af0ea8a06","Whyeasy","2022-12-12 23:31:28","true","[Jsonnet] Fix memberlist when using a stateful ruler (#6662)

Signed-off-by: Whyeasy <Whyeasy@users.noreply.github.com>

<!--  Thanks for sending a pull request!  Before submitting:

1. Read our CONTRIBUTING.md guide
2. Name your PR as `<Feature Area>: Describe your change`.
a. Do not end the title with punctuation. It will be added in the
changelog.
b. Start with an imperative verb. Example: Fix the latency between
System A and System B.
  c. Use sentence case, not title case.
d. Use a complete phrase or sentence. The PR title will appear in a
changelog, so help other people understand what your change will be.
3. Rebase your PR if it gets out of sync with main
-->

**What this PR does / why we need it**:

When using stateful rulers and the memberlist as its ring, generating
the resources with jsonnet throws in an error regarding the
`ruler_deployment`. The `ruler_statefulset` didn't receive the meberlist
labels either.

<!--
Note about CHANGELOG entries, if a change adds:
* an important feature
* fixes an issue present in a previous release, 
* causes a change in operation that would be useful for an operator of
Loki to know
then please add a CHANGELOG entry.

For documentation changes, build changes, simple fixes etc please skip
this step. We are attempting to curate a changelog of the most relevant
and important changes to be easier to ingest by end users of Loki.

Note about the upgrade guide, if this changes:
* default configuration values
* metric names or label names
* changes existing log lines such as the metrics.go query output line
* configuration parameters 
* anything to do with any API
* any other change that would require special attention or extra steps
to upgrade
Please document clearly what changed AND what needs to be done in the
upgrade guide.
-->
**Checklist**
- [ ] Documentation added
- [ ] Tests updated
- [x] Is this an important fix or new feature? Add an entry in the
`CHANGELOG.md`.
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

Signed-off-by: Whyeasy <Whyeasy@users.noreply.github.com>",100,56,1,0,"2018-04-16 10:25:39","1697.55"
"grafana/loki","9e275792e3023fa269ca009d978ef34bbe55030a","trevorwhitney","2023-08-31 14:35:37","true","Fix k3d and docker-compose local development envs (#10387)

This PR fixes bugs in two of the local dev envs we have.

* production/docker was missing a required CLI flag for the backend
target
* tools/dev/k3d was failing to bring up a k8s cluster due to an issue
with the prometheus operator crd bundled with the kube-prometheus-stack
chart.",45,64,1,1,"2018-04-16 10:25:39","1961.42"
"grafana/loki","183d6f2c39b03b335d016763517fe27c33ad04e2","shantanualsi","2023-10-10 07:04:10","true","Upgrade prometheus to 0.47.1 and dskit  (#10814)",25,66,1,0,"2018-04-16 10:25:39","2000.11"
"grafana/loki","0d79b219b24d725949813eb493617e858f2fc6c7","JStickler","2023-07-07 19:51:58","true","Update redirects to use new alias format. (part 1 of 2) (#9881)

**Special notes for your reviewer**:
@jdbaldry commented on #9717 that the alias format had changed, but we
[agreed](https://github.com/grafana/loki/pull/9717#issuecomment-1594960563)
that I could update it in a follow up PR. This is that follow up. Also
updating previously merged file moves that used the old alias format.

Breaking the alias updates into two PRs to make for smaller reviews.",57,63,1,0,"2018-04-16 10:25:39","1907.64"
"grafana/loki","f43dd58459239057cf8ca0dbe53b5e7ef89c7ae9","periklis","2023-06-06 17:00:40","true","operator: Fix timeout config constructor when only tenants limits (#9623)",70,62,1,1,"2018-04-16 10:25:39","1876.52"
"grafana/loki","c9a3ff53e4b60330c53fe8659d5632fd4d12d734","jeschkies","2023-05-31 16:49:24","true","Set unique timestamp in lambda-promtail. (#9560)",69,61,1,1,"2018-04-16 10:25:39","1871.52"
"grafana/loki","a99bbc9440909c1f16bd374fd8bcbf7cbe4067a6","JStickler","2023-03-17 20:56:03","true","TOC Sync: Move alerting and recording rules under Alert. (#8805)

**Which issue(s) this PR fixes**:
Fixes #8717 

**Special notes for your reviewer**:
Part of the Database products table of contents alignment project.
Moves alerting and recording rules from Rules to new Alert heading in
TOC.
Updates front matter for the topic.
Fixes links broken by the move.",86,59,1,0,"2018-04-16 10:25:39","1792.44"
"grafana/loki","6ec978ee43e752e07f7d84eb3a0b26ec35f03d06","joe-elliott","2019-11-05 14:14:59","false","Removed references to Loki free tier (#1231)

* Removed references to Loki free tier

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Update production/README.md

Co-Authored-By: Ed Welch <ed@oqqer.com>",67,19,0,0,"2018-04-16 10:25:39","564.41"
"grafana/loki","5e3630815b0151e1806949e7c9162a1bbdc2aa1f","tomwilkie","2019-04-17 16:31:19","false","Errors and wiring.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",102,12,0,0,"2018-04-16 10:25:39","366.5"
"grafana/loki","79485cd30de16be377d465a42903634e76967576","MichelHollands","2023-06-14 14:04:15","true","Add handling of timezones in unixToTime tests (#9707)

**What this PR does / why we need it**:

The unit tests for unixToTime do not take the current timezone into
account.


**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [x] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

---------

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",66,62,1,1,"2018-04-16 10:25:39","1884.4"
"grafana/loki","bbaef790dbea7c7d8aca6b86317f00f8250e47fb","cyriltovena","2022-02-10 12:54:13","true","Add usage report into Loki. (#5361)

* Adds leader election process

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* fluke

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* fixes the kv typecheck

* wire up the http client

* Hooking into loki services, hit a bug

* Add stats variable.

* re-vendor dskit and improve to never fail service

* Intrument Loki with the package

* Add changelog entry

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes compactor test

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add configuration documentation

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Update pkg/usagestats/reporter.go

Co-authored-by: Danny Kopping <dannykopping@gmail.com>

* Add boundary check

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add log for success report.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* lint

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Update pkg/usagestats/reporter.go

Co-authored-by: Danny Kopping <dannykopping@gmail.com>

Co-authored-by: Danny Kopping <dannykopping@gmail.com>",282,46,0,1,"2018-04-16 10:25:39","1389.85"
"grafana/loki","d0cf3b07bca7cba7f1fbfe0e28c79402a91a41c9","grafanabot","2023-10-13 10:11:47","true","[CI/CD] Update yaml file `./production/helm/loki/values.yaml` (+1 other) (#10888)

**Here is a summary of the updates contained in this PR:**
***
Update attribute `$.enterprise.version` in yaml file
`./production/helm/loki/values.yaml` to the following value: `v1.8.3`
***
Bump version of Helm Chart
Add changelog entry to `./production/helm/loki/CHANGELOG.md`
Re-generate docs

---------

Co-authored-by: Ashwanth Goli <iamashwanth@gmail.com>",26,66,1,0,"2018-04-16 10:25:39","2003.24"
"grafana/loki","b830d65bdde8a56076100253e55b34e7b6cc01fa","56quarters","2021-07-08 19:29:31","true","Use the Cortex wrapper for getting tenant ID from a context (#3973)

This change replaces all uses of the weaveworks/common method
for getting tenant/org ID with the Cortex wrapper which performs
some extra validation.

Signed-off-by: Nick Pillitteri <nick.pillitteri@grafana.com>",118,39,0,0,"2018-04-16 10:25:39","1178.13"
"grafana/loki","d960ee70c64a2951d68398d79d0b1d7a931982ed","chaudum","2023-02-13 11:20:30","true","Helm: Remove unreleased setting from Helm chart configuration file (#8515)

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",77,58,1,1,"2018-04-16 10:25:39","1758.04"
"grafana/loki","f86785b68e52866259b294bcba0e6bcc1c90572b","owen-d","2020-04-14 16:00:23","true","bumps helm to keepalive-master after cortex vendoring (#1937)

* bumps helm to keepalive-master after cortex vendoring

* minor helm version bump + keepalive image for promtail",122,24,0,1,"2018-04-16 10:25:39","723.48"
"grafana/loki","e22f365025cf0dc091f343ebda75141ed733f2f5","owen-d","2020-07-08 20:03:50","true","remove DynamoDB chunk store doc (#2317)

Removes DynamoDB as a supported chunk store in our docs. It's a very poor fit for loki.",123,27,0,1,"2018-04-16 10:25:39","812.9"
"grafana/loki","77ea11724b438c15acd3890626430729832817f2","DylanGuedes","2021-10-25 16:43:25","true","Loki: Enable FIFO cache by default (#4519)

* Set default FIFO cache with reasonable defaults.

Signed-off-by: Mauro Stettler <mauro.stettler@gmail.com>

* Remove FIFO cache feature flag.

- We noticed that we always want that behavior, so the logic is better
  implemented in the `ApplyDinamicConfig` method
- Update documentation

* Move FIFO cache default behavior.

- Move FIFO cache default behavior implementation to ApplyDinamicConfig

* Add tests for the new FIFO cache default behavior.

- The tests tests the behavior of the four existing caches (query results, query
index, write dedupe, and chunk results)
- Add changelog entry
- Fix lint issues regarding import order
- Revert moving of EnableFifoCache check

* Apply suggestions from code review

- Change `EnableFifoCache` description to mention that it is only applied for chunk and query results cache

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>

Co-authored-by: Mauro Stettler <mauro.stettler@gmail.com>
Co-authored-by: Owen Diehl <ow.diehl@gmail.com>",164,42,0,1,"2018-04-16 10:25:39","1285.01"
"grafana/loki","5f3e9a194343e3346fcf51abe06493824dc18d91","cstyan","2021-10-14 18:35:55","true","Update loki-build-image to drone 1.4.0 (#4462)

* Update loki-build-image to drone 1.4.0

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* update build image go versions plus fix install of drone-cli

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* Update build image version used in makefile

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* update drone yaml built via new build image (updated drone cli version)

Signed-off-by: Callum Styan <callumstyan@gmail.com>",158,42,0,1,"2018-04-16 10:25:39","1274.09"
"grafana/loki","88f0ad2196b3c256c5600c52c47eb2351fe202be","simonswine","2022-08-15 08:12:31","true","Update build-image to 0.23.0 (#6899)",83,52,0,0,"2018-04-16 10:25:39","1579.91"
"grafana/loki","0a02aecdb993da9d56714d756a6be73039e5317d","slim-bean","2021-04-19 20:22:42","true","fix drone dependencies for manifest (#3624)",161,36,0,1,"2018-04-16 10:25:39","1099.16"
"grafana/loki","374ac1b70fd822268fe2529c96e19bd3bde91d53","JensErat","2019-11-26 18:58:33","false","fluent-bit: tenant ID configuration (#1273)

* fluent-bit: tenant ID configuration

Both promtail and the fluentd plugin already have support for sending a
tenant ID, and all necessary for doing so in fluent-bit is actually
passing through the configuration item. Configuration is aligned with
the fluentd plugin for consistency.

We're lucky, since no configuration will result in an empty string that
will be treated as no tenant ID by the Loki shipping client.

Signed-off-by: Jens Erat <email@jenserat.de>

* promtail: minor typo in documentation

Signed-off-by: Jens Erat <email@jenserat.de>",82,19,0,0,"2018-04-16 10:25:39","585.61"
"grafana/loki","d8e6debaa50c5fe42e3ec7ce79dbf513134917ea","slim-bean","2021-10-21 15:39:44","true","Loki: Fix bug where items are returned to a sync.Pool incorrectly (#4518)

* Make sure calls to the SampleIteratorWithClose Close() function are idempotent.

* the linter hates my fun error messages",166,42,0,1,"2018-04-16 10:25:39","1280.97"
"grafana/loki","f502ef30a2e6616d3782e9704c58b5e4046540f6","tomwilkie","2018-05-15 15:44:56","false","Allow users to override hostname with envvar.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",0,1,0,0,"2018-04-16 10:25:39","29.22"
"grafana/loki","b1242432d65fb215b8a8ac7a5dcd4bfe9e81764c","cstyan","2021-11-23 20:13:23","true","Refactor dashboard utils to include a separate function per template (#4807)

variables and another for tag+links so we don't always have to use
addClusterSelectorTemplate which adds cluster/namespace/tag/links all in
one.

Signed-off-by: Callum Styan <callumstyan@gmail.com>",213,43,0,1,"2018-04-16 10:25:39","1313.16"
"grafana/loki","9ed086379a4473e93a1ca5b114d27150a981e928","MattiasSegerdahl","2023-05-01 08:31:25","true","Update index.md (#9307)

**What this PR does / why we need it**:

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",79,60,1,0,"2018-04-16 10:25:39","1841.17"
"grafana/loki","44ae10eaebfa1b310a8a40f7e915f161f5fe7e7c","MichelHollands","2023-07-24 09:23:33","true","Add 2.8.3 release to changelog (#10014)

**What this PR does / why we need it**:
Add the PRs of the 2.8.3 release to the changelog

---------

Signed-off-by: Michel Hollands <michel.hollands@gmail.com>",54,63,1,1,"2018-04-16 10:25:39","1924.21"
"grafana/loki","3c1accccb1e9f7a2db3d42dd032c772562009499","cstyan","2022-06-02 19:58:54","true","Import memberlist.libsonnet in loki.libsonnet. (#6294)

Signed-off-by: Callum Styan <callumstyan@gmail.com>",71,50,0,1,"2018-04-16 10:25:39","1507.4"
"grafana/loki","cc756b2e674c60c6d8f5c301fdb7b9673fa0ca9c","blockloop","2021-03-05 22:28:10","true","init",142,34,0,0,"2018-04-16 10:25:39","1050"
"grafana/loki","5d971cd874080b5c802197044a716789a1f1a3ab","woodsaj","2019-02-11 18:22:07","true","Merge pull request #314 from grafana/20190212-fixPromtailKsonnet

dont add pods twice if they have app and name labels",80,10,0,0,"2018-04-16 10:25:39","295.33"
"grafana/loki","6cc41f92f8adfabe3df4fab7780f56830b408eec","kavirajk","2021-01-19 09:10:19","true","Gcplog targetmanager (#3083)

* Add new target manager(PubsubTarget)  for promtail

Lets you to scrape log entries from pubsub topic and
send it to lok

- Basic `Target` and `TargetManager`
- Minimum config to make it work

* make the receive loop on pubsub manager work

* Add mmock pubsub server for testing

* Remove debugging logs

* Minor changes to messages pushing into loki

* Basic formatter to convert GCP log entry to loki log entry

* Reverting go.mod, go.sum and vendors to master branch

* only pubsub dependencies

* rebuild proto

* Fix protobuf diffs

* Remove debug printfs

* Add basic formatter for GCP log entry

- Create uniq label to create stream without out-of-order timestamp
- extract instance id and timestamp from log entry

* - Small fixes to formatter
- Config changes on pubsub manager for testing

* - Formatting changes
- Rewrite timestamp to avoid out-of-order errors on loki
- Minor config changes to Pubsub Target manager

* Fix target formatter tests

* PR remarks

* Minor refactoring and following changes

- Rename Pubsub* entities to Gcplog*
- Rename pubsub package into gcplog
- Add flag `KeepIncomingTimestamp` to toggle between either keeping incoming timestamps or rewriting with current timestamp
- Tests for gcplog target
- Docs and basic metrics to gcplog target

* Add docs for cloud configure for gcplog.

* Add docs for cloud configure for gcplog.

* Review feedback

* Checkin generated files

* Making linters happy

Co-authored-by: Edward Welch <edward.welch@grafana.com>",109,33,0,1,"2018-04-16 10:25:39","1003.45"
"grafana/loki","30db6c120eff18632c6e0ce9e378bf57d57c07dc","owen-d","2022-08-30 19:06:29","true","[TSDB] 600MB max per shard in query planning (#7004)

This PR gives a little better understanding into shard query planning and targets a range of `(300MB,600MB]` per shard. Doubling this also allows us to halve query parallelism configs and still schedule the same amount of work in parallel, which should make for easier schema upgrades as the parallelism differences between TSDB and prior period configs will be less.

Co-authored-by: Dylan Guedes <djmgguedes@gmail.com>",80,52,1,1,"2018-04-16 10:25:39","1595.36"
"grafana/loki","6b4563cd538efbf17df5c7fb6981d3976d0a57f4","owen-d","2022-10-31 18:08:05","true","Prevent IndexShipper from leaking mutex accesses. (#7548)

# What

Inverts control in the `index-shipper` so consumers don't manage
accesses to mutexes. This prevents deadlocks and no longer requires
consumers have internal knowledge of the `index-shipper` itself.

This PR reverts a few previous attempts. Look at the last commit to see
the net-additions.

# Background:

TSDB previously didn't use mmap, which meant we could freely pass around
TSDBs as `[]byte`. Since they were immutable, we didn't need to know
when an underlying index was cleaned up/closed; this coordination was
unnecessary and the garbage collector would clean up dangling memory for
us. After introducing TSDB, we needed to control access to avoid
use-after-free bugs. A few attempts at controlling this became
increasingly complex & error prone. Instead of requiring _consumers_ to
prevent deadlocks on index-shipper internals, it makes more sense that
references to the index-shipper's resources should not leak outside the
`ForEach` functions that give temporary access to them. This _inverts
control_ from the consumer (code which queries the indices) to the
producer (the index-shipper).

Co-authored-by: Dylan Guedes <djmgguedes@gmail.com>",89,54,1,1,"2018-04-16 10:25:39","1656.32"
"grafana/loki","0e622072e9e0cb16353879aa89f7a80e60e6bb7b","owen-d","2021-09-01 18:48:07","true","replaces old cortex_chunk_store prefix with loki_chunk_store (#4255)",132,40,0,1,"2018-04-16 10:25:39","1231.1"
"grafana/loki","f6d0857ddf1e058a85946e77f80df346c353b614","slim-bean","2019-02-13 11:29:09","false","Adding a sync() function to filetarget (#293)

* Adding a sync() function to filetarget which runs on a timer to catch any events missed by fsnotify

* moving where we mark the final position to avoid a race condition exposed in testing, we want to stop the tailer before shutting down our tailer loop

* Fix changes from PR and refactor to remove circular imports and make config consistent

* Adding an ""integration"" type unit test which tests promtail as a whole

* fixing a bunch of imports I munged
moved tailer to its own file
refactoring filetarget to make synclogic easier to follow and reused as much as possible",84,10,0,1,"2018-04-16 10:25:39","297.04"
"grafana/loki","a2dd73158621441fe2d83346e792913c6770c945","aknuds1","2022-01-20 17:53:16","true","Chore: Add pkg/util/log package (#5187)

* Chore: Add pkg/util/log package

Signed-off-by: Arve Knudsen <arve.knudsen@gmail.com>

* Add changelog entry

Signed-off-by: Arve Knudsen <arve.knudsen@gmail.com>

* Fix documentation of loki_log_messages_total

Signed-off-by: Arve Knudsen <arve.knudsen@gmail.com>",268,45,0,0,"2018-04-16 10:25:39","1370.06"
"grafana/loki","9b264e5b2e2956729619ff577c1b984cfa42aea8","rfratto","2020-01-06 14:23:48","true","Makefile: re-enable journal scraping on ARM (#1469)

Drone should be able to handle this since it has native ARM machines.

Fixes #1459.",106,21,0,1,"2018-04-16 10:25:39","625.42"
"grafana/loki","afedabf0e9f22ee4b3e158573dece7606d6034fe","MasslessParticle","2022-08-11 15:52:06","true","Remove unused code (#6872)",81,52,0,1,"2018-04-16 10:25:39","1576.23"
"grafana/loki","d5758e39d756f2a9766507ea1db83e2a4343dec3","joe-elliott","2019-10-29 22:25:17","false","Update loki operational (#1212)

* Added deployment annotations and cassandra metrics

* Added wrapper annotations

Signed-off-by: Joe Elliott <number101010@gmail.com>",69,18,0,0,"2018-04-16 10:25:39","558.75"
"grafana/loki","0f229f471bfefecbd3d012c8ee766226d6133396","chaudum","2021-09-07 00:05:44","true","cli: Register configuration option `store.max-look-back-period` as CLI argument (#4242)

* Register CLI flag for ChunkStoreConfig.MaxLookBackPeriod

Even though the flag is already deprecated, registering the flag is necessary
for generating the config reference documentation.

* Update pkg/storage/store.go

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>",121,41,0,1,"2018-04-16 10:25:39","1236.32"
"grafana/loki","12221f43b54f9082a2da0d74f1067b4124af0c7d","MasslessParticle","2023-08-24 16:27:06","true","Put unescaped regexes in a raw string literal (#10331)

[This PR](https://github.com/grafana/loki/pull/10277) fixed an issue
where regexes were being escaped multiple times and causing otherwise
valid queries to fail our length check. It put the resulting regexes in
double quotes which meant that any regexes that _needed_ escaping were
now invalid.

This PR make is so the unescaped regex is put in a raw string literal so
any extra escaping in unnecessary.",50,64,1,1,"2018-04-16 10:25:39","1954.5"
"grafana/loki","9c8a827576c36575cedd2efd52b5c60375a3a3b5","periklis","2022-10-16 20:57:12","true","Fix enable of internal server for modules (#7423)

**What this PR does / why we need it**:
Makes adding the internal server modules to the module map more robust.
The previous implementation accidentally dropped other modules.

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the `CONTRIBUTING.md` guide
- [ ] Documentation added
- [x] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",93,54,1,1,"2018-04-16 10:25:39","1641.44"
"grafana/loki","7eceea082bf1247872f2e3cc81860ce6ce51ef20","KMiller-Grafana","2021-07-06 23:59:01","true","Docs: Make identification of experimental items consistent and more obvious. (#3911)",119,39,0,0,"2018-04-16 10:25:39","1176.31"
"grafana/loki","442c81817efa2f9522fb094bb58c6ef4952c9599","periklis","2021-04-12 15:20:32","true","Ensure bundle dependencies are overwritable bei env (#20)",155,36,0,1,"2018-04-16 10:25:39","1086.7"
"grafana/loki","632db54db39d2dbe7f501ee66fc79d757e4f09db","daixiang0","2019-04-18 06:15:19","false","Add comment

Signed-off-by: Xiang Dai <764524258@qq.com>",96,12,0,0,"2018-04-16 10:25:39","367.08"
"grafana/loki","17c36d60f3bbfb1517d01fc85fd5e3ac025d2789","MarNicGit","2022-11-07 10:09:31","true","Promtail: Fix collecting userdata field from Windows Event Log (#7461)

**What this PR does / why we need it**:
The windows event log target for Promtail had a typo that led to
`EventData` being assigned to `UserData`. This PR fixes this typo.

**Which issue(s) this PR fixes**:
Fixes #6167",89,55,1,0,"2018-04-16 10:25:39","1661.99"
"grafana/loki","7d666cceb273960b6c85b63d9a65fe0b618aeb15","sesky4","2021-06-10 09:11:12","true","lz4: update lz4 version to v4.1.7 to avoid possibly panic (#3835)

* lz4: update lz4 version to v4.1.7 to avoid possibly panic

* lz4: add lz4 v4.1.7 to vendor",164,38,0,0,"2018-04-16 10:25:39","1149.7"
"grafana/loki","07e5eb33d32e8a3915f4c766555623ecf7f5a56a","cyriltovena","2022-02-18 15:12:13","true","Do not use WaitGroup context for StepEvaluator (#5425)",293,46,0,1,"2018-04-16 10:25:39","1397.95"
"grafana/loki","f939e42afd9f34f145f495c4452e93fa45897dcb","cyriltovena","2019-06-10 14:30:53","true","add support for RFC3339Nano in query timestamps (#656)",108,14,0,1,"2018-04-16 10:25:39","419.42"
"grafana/loki","f0d26b416546153edda7e702d03cbb06d9876b60","KMiller-Grafana","2021-08-10 12:15:28","true","Docs: Fix typos and grammar. Inject newlines for readability. (#4113)",113,40,0,0,"2018-04-16 10:25:39","1209.83"
"grafana/loki","9f8eb8f452eee2033eb96375c4043623937c76fc","joe-elliott","2019-10-28 14:48:14","false","Chunk iterator performance improvement (#1203)

* Improved chunk performance

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Added guard code to prevent a panic

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Added .Entry() to improve benchmark

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Improved test

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Reversed range

Signed-off-by: Joe Elliott <number101010@gmail.com>

* go mod tidy/vendor

Signed-off-by: Joe Elliott <number101010@gmail.com>",70,18,0,0,"2018-04-16 10:25:39","557.43"
"grafana/loki","7794d15b6ac7e7553710851f2e26d25e9662c061","joe-elliott","2019-09-23 18:59:42","false","Extended test query to expose broken query.  Parsed logql correctly in validate (#1044)

Signed-off-by: Joe Elliott <number101010@gmail.com>",67,17,0,0,"2018-04-16 10:25:39","522.61"
"grafana/loki","f6d547d32dbff41767f50bac8a7a8d3f15ea7df7","tomwilkie","2019-01-31 11:07:46","false","Don't log request body.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",72,9,0,0,"2018-04-16 10:25:39","285.03"
"grafana/loki","0a6c4e99ab925357744c4966e59bd091bbca6393","tomwilkie","2018-06-24 13:54:14","false","Add kingpin.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",1,2,0,0,"2018-04-16 10:25:39","68.14"
"grafana/loki","25e13254f0db2732f0c22d51f40360de36e01215","owen-d","2020-10-12 13:24:11","true","fixes path in prom rules api docs (#2750)",111,30,0,1,"2018-04-16 10:25:39","906.62"
"grafana/loki","2406ea72bc077691721246e5c31cf856219cbd5a","cyriltovena","2020-12-07 10:59:36","true","Allows by/without to be empty and available for max/min_over_time  (#3030)

* Allows by/without to be empty and available for max/min_over_time operations.

This essentially allows to aggregate over all dimensions when using by () while without() is a noop.
This also makes it possible for max and min range vector aggregation to use grouping, which is simpler than doing max by (foo) max_over_time(...)

Examples:
- `max_over_time(...) by ()` gives your the max over time accross of all series.
- `min_over_time(...) by (namespace)` gives you the min over time per namespace.
- `max_over_time(...) without (namespace)` gives you the max over time removing the namespace dimension.

PS: I've also refactored a bit how we  optimized grouping to make it more clear.

Fixes #2884

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* nit doc.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",123,32,0,1,"2018-04-16 10:25:39","961.52"
"grafana/loki","6c64e2ca6ba2c10c4728fd8d4fdd36f9f144c73f","cyriltovena","2020-01-08 15:30:57","true","Fixes the typo in the result cache config of the Loki ksonnet lib. (#1478)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",104,21,0,1,"2018-04-16 10:25:39","627.46"
"grafana/loki","e5c8aed77480427e3a929bb48e038392015b316c","ggrossetie","2023-09-02 17:47:52","true","Fix typo ""most be"" -> ""must be"" (#10427)",45,64,1,0,"2018-04-16 10:25:39","1962.56"
"grafana/loki","40b8ac73dfd3870773b49f6809eaa44c1242e5d8","grafanabot","2023-08-03 08:47:59","true","[CI/CD] Update yaml file `./production/helm/loki/values.yaml` (+1 other) (#10154)

**Here is a summary of the updates contained in this PR:**
***
Update attribute `$.enterprise.version` in yaml file
`./production/helm/loki/values.yaml` to the following value: `v1.7.3`
***
Bump version of Helm Chart
Add changelog entry to `./production/helm/loki/CHANGELOG.md`
Re-generate docs

---------

Co-authored-by: Trevor Whitney <trevorjwhitney@gmail.com>
Co-authored-by: Ashwanth Goli <iamashwanth@gmail.com>",53,64,1,0,"2018-04-16 10:25:39","1933.18"
"grafana/loki","f42942768e5356b3fe960315d04b87e7eab12235","kavirajk","2023-04-14 19:14:52","true","Makefile: Support debug build for `logcli`. (#9093)

**What this PR does / why we need it**:
Support debug build for `logcli` binary. This writes debug binary under
`logcli-debug` name in the same `cmd/logcli` directory.

Already faced situation multiple times this is useful to debug some
issues with LogQL locally.

**Which issue(s) this PR fixes**:
Fixes NA

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",81,60,1,1,"2018-04-16 10:25:39","1819.37"
"grafana/loki","340f62ac7a32f33b7c4d1935eeb790bf753e7499","Whyeasy","2023-02-03 16:47:36","true","[Mixin] Update clusterlabel usage (#8247)

Signed-off-by: Whyeasy <Whyeasy@users.noreply.github.com>",78,57,1,0,"2018-04-16 10:25:39","1748.27"
"grafana/loki","664ea78154452b1555c4cf8e971e8ad6d94b71f1","periklis","2023-01-18 05:05:08","true","operator: Remove custom webhook cert mounts for OLM-based deployment (#8173)",94,57,1,1,"2018-04-16 10:25:39","1732.78"
"grafana/loki","b59277b4728e7ec1010c3b25e84b19454ecec1d9","owen-d","2022-10-17 19:31:16","true","Revert ""Revert ""Update Thanos dependency to latest version"""" (#7372)

Reverts grafana/loki#7371

PR re re-enable Thanos dependency bump.",89,54,1,1,"2018-04-16 10:25:39","1642.38"
"grafana/loki","ead9444d7892e893ead34c1c5986dd25b2470cdb","jeschkies","2022-02-28 16:47:48","true","Document all support API timestamp formats. (#5439)

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>",300,46,0,1,"2018-04-16 10:25:39","1408.02"
"grafana/loki","f48e86700235b6c10085d8436f69cd02b147f2f8","aknuds1","2021-09-14 11:53:47","true","Upgrade dskit (#4313)

Signed-off-by: Arve Knudsen <arve.knudsen@gmail.com>

Use middleware package from dskit

Signed-off-by: Arve Knudsen <arve.knudsen@gmail.com>",135,41,0,0,"2018-04-16 10:25:39","1243.81"
"grafana/loki","071fd5be555b2af710b7edb43bdfe26a6e9134ec","kavirajk","2021-03-03 13:01:45","true","Modify script to accept inclusion and exclustion filters as variables (#3422)",140,34,0,1,"2018-04-16 10:25:39","1047.61"
"grafana/loki","47e7ec5ec6b4b677562ec788bda9618aa3f4bc10","owen-d","2021-02-15 23:30:14","true","adds some flushing instrumentation/logs (#3340)",132,34,0,1,"2018-04-16 10:25:39","1030.04"
"grafana/loki","d8e571e3134a6bd7de05742084a5d892a8a7e39c","owen-d","2020-09-29 16:13:43","true","updates alerting docs with new cortex tool loki linting support (#2697)",122,29,0,1,"2018-04-16 10:25:39","893.74"
"grafana/loki","08aa2dabd6ec95bffdbc2a5cfbaf6a85b0ace30c","slim-bean","2020-04-01 13:22:39","true","docs: update promtail docs for backoff (#1879)

Signed-off-by: Edward Welch <edward.welch@grafana.com>
(cherry picked from commit 08b3b459899c67b6c865bcde452a22c62704ce7e)",121,23,0,1,"2018-04-16 10:25:39","710.37"
"grafana/loki","dc2190f80b04db75aefd7949001cc2c72d96589e","slim-bean","2019-06-17 20:32:51","false","updating the loki dashboards to use the metrics from the new gateway",83,14,0,1,"2018-04-16 10:25:39","426.67"
"grafana/loki","b24a1430434770a5c4eddc19bfe8e1eddf498a15","slim-bean","2020-07-08 18:32:45","true","Promtail: Loki Push API (#2296)

* refactor to put targets in separate packages

* rename scrape package to scrapeconfig

* Push implementation, working with logging

* adding new vendored library

* adding tests

* adding documentation and an additional config option.

* fixing journal test

* rename scrape config entry

* Update docs/clients/promtail/configuration.md

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>

* PR feedback

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>",124,27,0,1,"2018-04-16 10:25:39","812.84"
"grafana/loki","8012362674568379a3871ff8c4a2bfd1ddba7ad1","slim-bean","2021-03-10 02:43:50","true","Loki: Per Tenant Runtime Configs (#3460)

* Add per tenant configs mechanism

* Add per tenant logging of stream creation

* fix tests

* enable per tenant configs on push request logging.

* fixing up the stream log, changing log levels to debug",148,35,0,1,"2018-04-16 10:25:39","1054.18"
"grafana/loki","53e01a795a4f8fc293e2dbe2a69bee89f46b81ac","ashwanthgoli","2022-09-06 11:21:55","true","tsdb: build tsdb from tenantheads (#7036)

**What this PR does / why we need it**:
refactors tsdb manager code to expose a new method `BuildFromHead` which comes in handy for building tsdb from tenant heads after rotation.

Currently we build it by recovering head from WAL even when we have access to the in-mem tenant heads.

**Special notes for your reviewer**:
using `loki_tsdb_head_rotations_*` metric to track loop failures which could be caused either by rotation failures or if rotation is blocked by prev head failing to build

**Checklist**
- [ ] Documentation added
- [x] Tests updated
- [ ] Is this an important fix or new feature? Add an entry in the `CHANGELOG.md`.
- [ ] Changes that require user attention or interaction to upgrade are documented in `docs/sources/upgrading/_index.md`

Signed-off-by: Ashwanth Goli <iamashwanth@gmail.com>",79,53,1,0,"2018-04-16 10:25:39","1601.04"
"grafana/loki","b0042d087a3a787f9a2d30e8da3e51999a2cf48d","slim-bean","2020-10-26 16:32:03","true","Update helm and jsonnet to new release (#2809)

* helm and ksonnet to use boltdb-shipper

* updating image versions and chart versions

* update the chart deps

* updating reference to new version

* fix helm config for boltdb-shipper",118,30,0,1,"2018-04-16 10:25:39","920.75"
"grafana/loki","eb176b6a47c650b9db04747dfd5c2e40ec73935d","jeschkies","2022-11-23 17:48:45","true","Only release Helm Chart when version changed. (#7747)

**What this PR does / why we need it**:
The Helm Chart release often breaks when changes missed to update the
Helm Chart version. There is also often a conflict in the version.

This solution proposes to check the `Chart.yaml` for changes.",93,55,1,1,"2018-04-16 10:25:39","1678.31"
"grafana/loki","3245625c40d17b153fad318119d2b407f923636e","ashwanthgoli","2022-09-20 08:32:01","true","ingester_querier: early exit queries on reaching quorum (#7172)

Currently `forGivenIngesters` and its derivatives don't allow passing
down context to the work function as a result of which we are not making
use of the tracking functionality provided by `replicationSet.Do` to
exit early and relieve pressure on the ingesters.

This change ensures that Unary rpc calls receive ctx populated by the
replication set tracker to exit early on reaching quorum or max
failures.

The same cannot be applied to stream rpc calls given how the code is
structured at the moment where we are processing the streams outside of
the work func",87,53,1,0,"2018-04-16 10:25:39","1614.92"
"grafana/loki","f08794d39a0300f76733caa8c3ad44b02ae8a62f","ashwanthgoli","2023-05-12 07:38:41","true","docs: add memberlist section to the configuration page (#9452)

**What this PR does / why we need it**:
`memberlist_config` section is not present in 2.8.x release, must have gotten removed by mistake when we moved to the doc generation tool. This PR adds it back.

**Which issue(s) this PR fixes**:
Fixes #9423

Signed-off-by: Ashwanth Goli <iamashwanth@gmail.com>",76,61,1,0,"2018-04-16 10:25:39","1852.13"
"grafana/loki","3bbc5a92f109edcd73da8509848bf7f14ab08740","MasslessParticle","2022-07-29 16:03:06","true","Allow fifocache to be configured with groupcache (#6806)",77,51,0,1,"2018-04-16 10:25:39","1564.23"
"grafana/loki","06de835f6ec28c96cb010dfb0706434274196590","lzh-lab","2021-01-11 17:28:29","true","update github.com/gorilla/websocket to fixes a potential DoS (#3152)

Signed-off-by: allenzhli <allenzhli@tencent.com>",109,33,0,0,"2018-04-16 10:25:39","995.79"
"grafana/loki","4d97dc0cbb9b9af02419863951ce208c9b49fb62","knylander-grafana","2023-01-09 19:36:30","true","[DOC] Fix broken links in docs (#8065)

**What this PR does / why we need it**:

This PR fixes several broken links in the Promtail, operations, and
install sections of the doc.",98,57,1,0,"2018-04-16 10:25:39","1724.38"
"grafana/loki","426f55f38bb39a933b6068e8f7e2006babc601bc","periklis","2021-10-01 14:08:09","true","Use docker/build-push-action@v1 (#84)",138,41,0,1,"2018-04-16 10:25:39","1260.9"
"grafana/loki","857c94ea254c02ffe7e3c50eae2231223fd76625","periklis","2022-03-10 17:18:52","true","Add RBAC for Prometheus service discovery to Loki component metrics (#5588)",307,47,0,1,"2018-04-16 10:25:39","1420.04"
"grafana/loki","f59bdcd0ec7755a4dd84c0d7c9d394a290b9908e","tomwilkie","2018-11-22 12:14:42","false","Auth streaming grpc requests.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",5,7,0,0,"2018-04-16 10:25:39","216.08"
"grafana/loki","e45c77e25bd6afa3c7ad0c3813a60c60c560c396","periklis","2021-10-01 13:07:44","true","Publish images to quay.io (#83)",138,41,0,1,"2018-04-16 10:25:39","1260.86"
"grafana/loki","10d49e798b7133b8f438a327a5c712e051bc4386","tomwilkie","2019-02-05 18:09:37","false","Remove stream from index when its remove from memory.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",80,10,0,0,"2018-04-16 10:25:39","289.32"
"grafana/loki","10d4d4dc2bd20ed046dba97cbe5e01b6591e1287","cstyan","2021-11-29 07:54:48","true","Add a stat panel function so we can more easily create grid layouts via (#4836)

the loki dashboard utils.

Signed-off-by: Callum Styan <callumstyan@gmail.com>",214,43,0,1,"2018-04-16 10:25:39","1318.65"
"grafana/loki","c3e282e0308a012ed4b2039eda47ba27fd55f8ef","periklis","2021-11-04 08:37:48","true","Fix local kind deployments (#101)",170,43,0,1,"2018-04-16 10:25:39","1293.68"
"grafana/loki","c1f07f08a7f769c809f024aae5a7ff1d8565b9d5","adityacs","2020-09-01 15:35:13","true","Validate max_query_length in Label API (#2572)",119,28,0,1,"2018-04-16 10:25:39","865.71"
"grafana/loki","600b24101ec7ddbddae4593020a3661c65686a4f","tomwilkie","2018-12-04 11:57:05","true","Promtail updates (#30)

* Make promtail read all its config from a file.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>

* Use gokit logging everywhere.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>

* Start work to parse normal log lines.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>

* update common and kuberesolver.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>

* lint

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>

* Get EntryParser stuff working, so we can tail raw log files.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>

* Make sure filename label works.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>

* lint, remove interfacer.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",6,7,0,0,"2018-04-16 10:25:39","228.06"
"grafana/loki","6b47aab2de9838f6b4c02136b393220f168b0b8e","alexandre1984rj","2022-08-09 07:42:27","true","promtail/client: add bot fields (#6828)

* chore: add bot fields

* Update CHANGELOG.md

* chore: update cloudflare configuration section URI

* docs: include BotScore and BotScoreSrc to all set of fields

* Update CHANGELOG.md",74,52,0,0,"2018-04-16 10:25:39","1573.89"
"grafana/loki","fa6f9c638ab68d4bb5bd35d5eeb6ac7fe50079b7","slim-bean","2023-07-19 17:38:33","true","Loki: add 'post_filter_lines' stat for tracking how many lines are match a queries filter expression(s) (#9983)

**What this PR does / why we need it**:

To better understand query behavior and labeling strategies of users,
logging the number of log lines ""post filtering"" can be very useful, we
already log the total_lines processed in a query so this will allow us
to see how many lines in the label selector matched what the query was
looking for.

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

Signed-off-by: Edward Welch <edward.welch@grafana.com>",58,63,1,1,"2018-04-16 10:25:39","1919.55"
"grafana/loki","3a4c0e2d47f74ab73db577e7b08f4686cbd8f873","jeschkies","2023-08-30 09:01:41","true","Rename evaluator and its method to emphasize it's a factory. (#10381)",46,64,1,1,"2018-04-16 10:25:39","1960.19"
"grafana/loki","7264e0ef530ed56fc8dfd0926c95100e135b3228","slim-bean","2023-03-31 16:23:44","true","Loki: Remove global singleton of the tsdb.Store and keep it scoped to the storage.Store (#8928)

**What this PR does / why we need it**:

I made this change to fix an issue with the cmd/migrate tool which I'm
also sneaking a few fixes on in this PR too.

We had a global singleton of the tsdb.Store which was leading to the
migrate tool reading from and writing to the `source` storage.Store
because it created the singleton with an object store client only
pointing to the source store.

This PR changes the scoping of that singleton to not be global but
instead local to each instance of storage.Store

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

Signed-off-by: Edward Welch <edward.welch@grafana.com>",81,59,1,1,"2018-04-16 10:25:39","1806.25"
"grafana/loki","e4654c9773cd4de286273679d9018b4495c24785","slim-bean","2023-06-16 19:28:03","true","Jsonnet: add dns+ to join_members in memberlist config (#9723)

**What this PR does / why we need it**:

We use a headless service called `gossip-ring` which contains all the
memberlist members, previously we passed this headless service into our
memberlist code as

```
join_members:
  - gossip-ring.loki-ops.svc.cluster.local:7946
```

What this resulted in was the dskit wrapper around the memberlist
library thinking there was only 1 join_node, so it passed this directly
to the join method in memberlist. The memberlist lib would then do a DNS
resolution on this and it would find **all** the members behind this
service.

This is generally not noticeable until you get to very large clusters
with thousands of memberlist members and it results in new joiners
attempting to join to ALL the existing members instead of just a few.

This PR prefixes the url with `dns+` which changes the behavior inside
dskit in an important way.

```
join_members:
  - dns+gossip-ring.loki-ops.svc.cluster.local:7946
```

Now dskit will resolve the address to find all the memberlist members,
first, then apply code which selects a subset of all the nodes to be
used for first join (based on some logarithmic math)

This subset is then passed to the memberlist library which will join
just this set instead of all members.



**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

Signed-off-by: Edward Welch <edward.welch@grafana.com>",58,62,1,1,"2018-04-16 10:25:39","1886.63"
"grafana/loki","91bbe86a7301202d3c974e487a6336ee09574c47","rfratto","2019-11-25 21:11:32","true","Document systemd journal scraping (#1261)",83,19,0,1,"2018-04-16 10:25:39","584.7"
"grafana/loki","7cb9538c85bb0c8a583c7833e2884b6f7a42d4de","pstibrany","2019-09-25 13:22:24","false","dep ensure (#1054)",69,17,0,0,"2018-04-16 10:25:39","524.37"
"grafana/loki","9bf1130f088e706e3dcf2451d2172bcdf5db7203","pstibrany","2020-06-18 20:45:25","true","Remove single newline from the line before printing. (#2235)

Lines are printed with Println, so this avoids having extra empty line
between printed log lines.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>",145,26,0,0,"2018-04-16 10:25:39","792.93"
"grafana/loki","50af51bb36f2a90a16bd0f1924a7201a43fd094b","trevorwhitney","2023-02-08 00:04:42","true","[helm] set compactor address (#8427)",77,58,1,1,"2018-04-16 10:25:39","1752.57"
"grafana/loki","216fb7569bd515de462be6a434f4daf21f716932","HandyDaddy","2023-09-13 11:51:24","true","fix xss vulnerability (#10559)

**What this PR does / why we need it**:
XSS vulnerability of fmt.Sprintf. fmt.Sprintf would reflect part of the
input in the output without escaping, which causes XSS.",39,65,1,0,"2018-04-16 10:25:39","1973.31"
"grafana/loki","f5b9cffc2eaed5fe49d8f54d9cf304d618e82ad9","bkmit","2020-05-08 19:33:59","true","Docker driver: Allow to provision external pipeline files to plugin (#2054)

* Use latest Alpine version

* Allow to provision external pipeline files to plugin

* Add custom pipeline documentation

* Untabify on reviewer request

Co-authored-by: Mike Futerko <mike@maytech.net>",115,25,0,0,"2018-04-16 10:25:39","752.88"
"grafana/loki","8e25567e9f2659cb3453ec1e460128c9336bf9a6","alvintownsend","2023-06-30 19:34:06","true","Loki Promtail: Don't Create home directory for `promtail` user in promtail-postinstall.sh (#9800)

**What this PR does / why we need it**:

When the `promtail-postinstall` script creates a `promtail` user, I do
not believe that user requires a home directory to function correctly,
and there are cases where the directory cannot be created causing the
installation to fail.

**Which issue(s) this PR fixes**:
n/a - trivial fix

**Special notes for your reviewer**:

**Checklist**
- [X] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)",61,62,1,0,"2018-04-16 10:25:39","1900.63"
"grafana/loki","37c1ec442fecbdab36038087545679d686fdce5c","dannykopping","2023-01-13 08:09:35","true","Correct template and LID (#8128)

The extra colon causes a YAML parsing failure, see
https://github.com/grafana/loki/actions/runs/3905966435/jobs/6678935989

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",97,57,1,1,"2018-04-16 10:25:39","1727.91"
"grafana/loki","5a6157ecf37cce58575f29fa9e95a1c26c300708","owen-d","2022-06-07 19:03:19","true","Tsdb/index sampling (#6329)

* groundwork for index sampling

* go mod

* bloom filter utils

* removes unnecessary atomics

* Stats() impl for tsdb index

* use passed var

* lint",72,50,0,1,"2018-04-16 10:25:39","1512.36"
"grafana/loki","b4e6c599368278b8da20852a9acc4722f70af603","MichelHollands","2022-06-20 10:12:17","true","Compactor: add per tenant compaction delete enabled flag (#6410)

* Add per tenant compaction delete enabled flag

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Remove changes in wrong place

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Add compactor deletion enabled field

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Use limit in compactor

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Use http middleware and add test

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Fix lint issue

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Add changelog

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Revert to default setting if no override

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Add default value command line option

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Update the docs

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Enable access to deletion API for integration test

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Rename flag to allow_deletes

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Update per review comments

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",67,50,0,1,"2018-04-16 10:25:39","1524.99"
"grafana/loki","d21f0d3725e08c0cfc3010ef8c65b070a65e833f","xperimental","2022-09-14 17:07:16","true","operator: Manage global stream-based retention (#7106)",88,53,1,1,"2018-04-16 10:25:39","1609.28"
"grafana/loki","b82d2e89d2f4303dc35c0e1f08d1041b7aa00f4e","adityacs","2020-07-10 13:44:40","true","fix bug in ingester series query (#2264)",125,27,0,1,"2018-04-16 10:25:39","814.64"
"grafana/loki","5c5b27db50924c133c116ca66cbebcee0c704699","angaz","2023-02-27 10:32:43","true","[logcli] set default instead of error for parallel-max-workers validation (#8641)

**What this PR does / why we need it**:
Fixes regression reported here:
https://github.com/grafana/loki/pull/8518#issuecomment-1446014229

@dannykopping can you please verify that it fixes the issue for you?

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",69,58,1,0,"2018-04-16 10:25:39","1772"
"grafana/loki","a1e75da9707d4fe5bacf5d3aea947225c5781d09","kavirajk","2022-07-21 21:05:06","true","doc: Add shuffle sharding doc (#6173)

* doc: Add shuffle sharding doc

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Add query-scheduler config as well

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Update docs/sources/operations/shuffle-sharding.md

Co-authored-by: Dan Mihai Dinu <33793329+danmdinu@users.noreply.github.com>

* Update docs/sources/operations/shuffle-sharding.md

Co-authored-by: Dan Mihai Dinu <33793329+danmdinu@users.noreply.github.com>

* Update docs/sources/operations/shuffle-sharding.md

Co-authored-by: Dan Mihai Dinu <33793329+danmdinu@users.noreply.github.com>

* Update docs/sources/operations/shuffle-sharding.md

Co-authored-by: Dan Mihai Dinu <33793329+danmdinu@users.noreply.github.com>

* Update docs/sources/operations/shuffle-sharding.md

Co-authored-by: Dan Mihai Dinu <33793329+danmdinu@users.noreply.github.com>

* Update docs/sources/operations/shuffle-sharding.md

Co-authored-by: Dan Mihai Dinu <33793329+danmdinu@users.noreply.github.com>

* Update docs/sources/operations/shuffle-sharding.md

Co-authored-by: Dan Mihai Dinu <33793329+danmdinu@users.noreply.github.com>

* Update docs/sources/operations/shuffle-sharding.md

Co-authored-by: Dan Mihai Dinu <33793329+danmdinu@users.noreply.github.com>

* Add line explaining what is ""query-of-death"" exactly means

* PR remarsk from Karen

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Fix image URL

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Update docs/sources/operations/shuffle-sharding.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

Co-authored-by: Dan Mihai Dinu <33793329+danmdinu@users.noreply.github.com>
Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>",72,51,0,1,"2018-04-16 10:25:39","1556.44"
"grafana/loki","a8a349690bfbd2ca304f9a492b722d0ccc565f5b","rasta-rocket","2023-07-25 08:54:14","true","feat(promtail): retrieve BotTags field from cloudflare (#10010)

**What this PR does / why we need it**:
Hey folks 👋

Little contribution here to add a useful log field for cloudflare users.
Indeed I add the [BotTags
field](https://developers.cloudflare.com/bots/concepts/cloudflare-bot-tags/)
which is pretty useful when debugging some specific traffic handled by
cloudflare

Don't hesitate to reach me if you have any questions

Cheers 😉
**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

---------

Co-authored-by: Michel Hollands <42814411+MichelHollands@users.noreply.github.com>",54,63,1,0,"2018-04-16 10:25:39","1925.19"
"grafana/loki","2997986ad3a7d01a27d158874b7dfb8c6dff0658","trevorwhitney","2022-11-10 10:44:16","true","[helm] Ignore single binary headless service from service-monitor (#7638)

**What this PR does / why we need it**:

Ignore the headless service from the Prometheus service-monitor as it
was resulting in duplicate metrics. Replaces
https://github.com/grafana/loki/pull/7049",84,55,1,1,"2018-04-16 10:25:39","1665.01"
"grafana/loki","7797a980748d2d138c70651605276bfff0740152","JStickler","2023-07-07 16:54:04","true","TOC Sync: Move configuration files under Configure (#9879)

**Which issue(s) this PR fixes**:
Fixes #8713

**Special notes for your reviewer**:

Replaces PR [#8817](https://github.com/grafana/loki/pull/8817), which
was stale and badly out of date.

Part of the Database products table of contents alignment project.
Moves configuration files from Configuration to new Configure heading in
TOC.
Updates front matter for the topic.
Fixes links broken by the move.
Updates the MakeFile to point to the new Configure DOCS_SOURCES_PATH.",59,63,1,0,"2018-04-16 10:25:39","1907.52"
"grafana/loki","a7ff0fd70e3cd6080fed60c34fb262fc3d27dd32","dannykopping","2023-03-20 12:13:08","true","Removing backend target from SSD docker setup (#8836)

**What this PR does / why we need it**:
The `backend` target is only present in v2.8.",83,59,1,1,"2018-04-16 10:25:39","1795.07"
"grafana/loki","c64a3fbc60ee2033934790a92c42cb51eb001cc1","periklis","2021-10-01 15:09:15","true","Create codeql-analysis.yml",138,41,0,1,"2018-04-16 10:25:39","1260.95"
"grafana/loki","07cbef92268aecc0f20d1791a6df390c2df5c072","tpaschalis","2023-10-04 11:11:12","true","Update Prometheus dependency to v2.46.0 (#10777)

This PR updates the Prometheus dependency to v2.46.0.

We need this to update the Agent to use Prometheus' Native Histograms after some bug fixes in the latest version.

I bumped the version in go.mod, ran `go mod tidy && go mod vendor` and fixed compilation issues.

**Special notes for your reviewer**:

The only changes needed to have `make all` successfully compile was to use the new `wlog.NewSize` to use wlog.CompressionNone (instead of false), and wlog.CompressionSnappy (the default, instead of true), as well as add a new argument to the textparse.New constructor to work as it did without scraping native histograms via protobuf.

I don't think there are any other user-facing changes or changes related to Loki.

---------

Signed-off-by: Paschalis Tsilias <paschalis.tsilias@grafana.com>",28,66,1,0,"2018-04-16 10:25:39","1994.28"
"grafana/loki","b892cade6a87931de96c7dcc03233cb73fa81abb","slim-bean","2023-03-31 15:42:23","true","Loki: Fixes incorrect query result when querying with start time == end time (#8979)

**What this PR does / why we need it**:

In several places within Loki we need to determine if a query is a
`range query` or `instant query`, this is done by checking to see if the
start and end time are equal **and** the `step=0`

The downstream handler was not checking for `step=0` and thus it
incorrectly mapped a range query to an instant query when a query has a
start time equal to and end time.

There are a few other things at play here, mainly that we should really
error anytime someone tries to run an instant query for logs which would
have exposed this error much more easily. But that's something I'd like
to handle in a different PR as it will be considered a breaking change
depending on how we do it.

This PR uses an existing function we have for testing the query type and
addresses the issue found in #8885

**Which issue(s) this PR fixes**:
Fixes #8885

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

---------

Signed-off-by: Edward Welch <edward.welch@grafana.com>",82,59,1,1,"2018-04-16 10:25:39","1806.22"
"grafana/loki","e3a4814a95e5ae7fe65d06129f9fc0533b21d0a1","slim-bean","2019-10-24 15:57:47","false","reducing binary parallelism to prevent circle from OOMing",68,18,0,1,"2018-04-16 10:25:39","553.48"
"grafana/loki","fe223a21e5b4cba648bc8a4393200a2ef3e0599c","LinAnt","2023-09-21 13:16:49","true","helm: improve gitops compatibility (#10452)

**What this PR does / why we need it**:

In its current form, this helm chart is annoying to deploy using GitOps
tools like fluxcd/argocd. This is due to missing fields that get added
automatically once the objects are applied in the cluster.

A workaround is to just add exceptions for these fields in the gitops
tool, but I think this is a more robust solution.

Screenshot from ArgoCD app diff:

![image](https://github.com/grafana/loki/assets/11833599/21644b4c-bffd-4052-8a4c-bf602e88a878)


**Which issue(s) this PR fixes**:

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [x] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

---------

Co-authored-by: Michel Hollands <42814411+MichelHollands@users.noreply.github.com>",33,65,1,0,"2018-04-16 10:25:39","1981.37"
"grafana/loki","08ac5336d57dfebfdd11d0c4d3b9402b1d5fee61","bboreham","2023-03-01 21:47:39","true","WAL: store pointers in record pool (#8667)

**What this PR does / why we need it**:

Storing a slice in `sync.Pool` wastes 24 bytes every time it is returned
to the heap; see https://staticcheck.io/docs/checks#SA6002

Storing a pointer to a slice allows the Pool to work without waste.

This came up in discussion about the benchmark in #8489 - with this
change the memory usage comes down:
```
name                                                      old time/op    new time/op    delta
Writer_WriteEntries/1000_lines,_1_different_label_sets-4    7.37ms ±13%    7.45ms ± 9%     ~     (p=0.841 n=5+5)

name                                                      old alloc/op   new alloc/op   delta
Writer_WriteEntries/1000_lines,_1_different_label_sets-4     727kB ± 0%     679kB ± 0%   -6.63%  (p=0.008 n=5+5)

name                                                      old allocs/op  new allocs/op  delta
Writer_WriteEntries/1000_lines,_1_different_label_sets-4     12.0k ± 0%     10.0k ± 0%  -16.68%  (p=0.000 n=5+4)
```

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- NA Documentation added
- [x] Tests updated
- NA `CHANGELOG.md` updated
- NA Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",72,58,1,0,"2018-04-16 10:25:39","1776.47"
"grafana/loki","709c8508da16a37cdc60012fe04afdb90777f45f","osg-grafana","2022-10-19 11:32:27","true","Update MAINTAINERS.md (#7467)

This change removes removes Karen Miller, and includes at least one
alternative, interim technical writer.

Co-authored-by: Christian Haudum <christian.haudum@gmail.com>",90,54,1,0,"2018-04-16 10:25:39","1644.05"
"grafana/loki","add847ce14dd42a84dda182ec44c24494cf8198f","blockloop","2021-03-19 21:02:27","true","add golangci-lint, github actions",169,35,0,0,"2018-04-16 10:25:39","1063.94"
"grafana/loki","d4dd4eda4ac9fc932d3016c3291c6bc157f4d79f","ssncferreira","2022-03-29 07:37:12","true","Update docker repo to grafana/loki-query-tee (#5716)

* Update docker repo to grafana/loki-querytee

* Sign drone.yml file

* Update makefile

- update target to generate query-tee image with correct name
- update error message on drone target

* Update Makefile drone target error message

Co-authored-by: Danny Kopping <danny.kopping@grafana.com>

Co-authored-by: Danny Kopping <danny.kopping@grafana.com>",310,47,0,0,"2018-04-16 10:25:39","1438.63"
"grafana/loki","83d0f1c05ac238d1d31f578f1091cfbffa347808","osg-grafana","2022-11-08 15:25:49","true","Swap direction in ""The label identifier is always on the right side of the operation."" sentence (#7631)",86,55,1,0,"2018-04-16 10:25:39","1663.21"
"grafana/loki","03c1195065494a84fadaf7292837353967f6c5b8","osg-grafana","2022-11-09 16:01:06","true","Update maintainers of documentation. (#7646)

Relates to #7645 and #7647",84,55,1,0,"2018-04-16 10:25:39","1664.23"
"grafana/loki","ee88599e5e4bd1f8d431a7a6db92836bef7caac2","Red-GV","2022-09-30 08:21:06","true","operator: Add lokistack operations alerts and sop (#6951)",92,53,1,1,"2018-04-16 10:25:39","1624.91"
"grafana/loki","9322ed0a68a2f9fdf0d09ca4efe043e29a90f50f","MasslessParticle","2023-01-11 20:41:49","true","Change delimiter in  test  ""sed"" command to ':' (#8108)

The current delimiter is `/` which breaks when a branch name contains
that character. `:` is disallowed in branch names so should serve as a
suitable delimiter

This is the same as https://github.com/grafana/loki/pull/8107 but the
branch name doesn't include a `/`. That shouldn't be an issue after this
is merged",100,57,1,1,"2018-04-16 10:25:39","1726.43"
"grafana/loki","cc1d478bb2e5735c74a387ed9532c791b64ecf43","dannykopping","2021-10-21 21:10:58","true","Clarify error message (#4524)

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",165,42,0,1,"2018-04-16 10:25:39","1281.2"
"grafana/loki","d61dd1872ad680ea4759bca5ece636d148dcd33c","taisho6339","2021-11-19 07:41:45","true","Expose Kafka message key in labels (#4745)

* expose kafka message key in labels

* add changelog entry

* improve performance

* goimported

* fix label name in test

* add empty message key test case

* pass actual value in message key",204,43,0,0,"2018-04-16 10:25:39","1308.64"
"grafana/loki","703d68bc76844c4b6335bc3450722742b89a37e7","dannykopping","2021-10-21 21:11:56","true","Promtail: allow for customisable stream lag labels (#4507)

* Allow for customisable stream lag labels

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Updating test

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Allowing for multiple labels

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Adding field to docs

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",165,42,0,1,"2018-04-16 10:25:39","1281.2"
"grafana/loki","e2ac2d50e2d74b46cf743e58037564aba7bab0aa","dannykopping","2023-03-10 09:31:09","true","Changes from linter (#8769)

**What this PR does / why we need it**:
We had a few outstanding linter issues, and running `make lint` fixes
them all automatically.

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",87,59,1,1,"2018-04-16 10:25:39","1784.96"
"grafana/loki","6a8225d533cbdc441b4544633464700cb53514ea","elliotdobson","2023-08-16 19:12:20","true","lambda-promtail: s3: update log parsing to support NLBs (#7194)

<!--  Thanks for sending a pull request!  Before submitting:

1. Read our CONTRIBUTING.md guide
2. Name your PR as `<Feature Area>: Describe your change`.
a. Do not end the title with punctuation. It will be added in the
changelog.
b. Start with an imperative verb. Example: Fix the latency between
System A and System B.
  c. Use sentence case, not title case.
d. Use a complete phrase or sentence. The PR title will appear in a
changelog, so help other people understand what your change will be.
3. Rebase your PR if it gets out of sync with main
-->

**What this PR does / why we need it**:
Fixes the filename and timestamp regex for AWS Network Load Balancer
(NLB) logs and adds logic to make NLB log timestamps RFC3339 compatible.
Also adds a test to check the parsed timestamp is as expected.

**Which issue(s) this PR fixes**:
Fixes #6455 

**Special notes for your reviewer**:

<!--
Note about CHANGELOG entries, if a change adds:
* an important feature
* fixes an issue present in a previous release, 
* causes a change in operation that would be useful for an operator of
Loki to know
then please add a CHANGELOG entry.

For documentation changes, build changes, simple fixes etc please skip
this step. We are attempting to curate a changelog of the most relevant
and important changes to be easier to ingest by end users of Loki.

Note about the upgrade guide, if this changes:
* default configuration values
* metric names or label names
* changes existing log lines such as the metrics.go query output line
* configuration parameters 
* anything to do with any API
* any other change that would require special attention or extra steps
to upgrade
Please document clearly what changed AND what needs to be done in the
upgrade guide.
-->
**Checklist**
- [x] Documentation added
- [x] Tests updated
- [ ] Is this an important fix or new feature? Add an entry in the
`CHANGELOG.md`.
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

---------

Signed-off-by: Callum Styan <callumstyan@gmail.com>
Co-authored-by: Callum Styan <callumstyan@gmail.com>",52,64,1,0,"2018-04-16 10:25:39","1946.62"
"grafana/loki","75e1d97d85aa389a030aec732f5a9598a139ed77","KMiller-Grafana","2022-06-15 15:31:59","true","Docs: revise changelog entry for PR 5626 (#6406)",68,50,0,0,"2018-04-16 10:25:39","1520.21"
"grafana/loki","d5629a77b0ec977c30baf27bbbeab11bf6b25848","daixiang0","2018-12-15 03:25:50","false","fix wrong url

Signed-off-by: Xiang Dai <764524258@qq.com>",32,8,0,0,"2018-04-16 10:25:39","238.71"
"grafana/loki","070a145ea686e189e086b916f113d451ecf187b7","cyriltovena","2020-11-09 07:31:18","true","Improve the chunksize test. (#2892)

This gives now the ratio, and the characters inserted in human readable format.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",119,31,0,1,"2018-04-16 10:25:39","933.38"
"grafana/loki","bfef7bad4434717367637e6e5cc8275e0636c549","cstyan","2022-01-25 17:11:11","true","Start refactor of storage (chunks) clients metrics into structs (#5057)

* Refactor azure metrics to be a struct (+ add an overall client metrics
struct), add an azure client metric for total egress bytes.

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* Add changelog entry for new azure metric.

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* Fixes based on Kavi's review.

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* Fix one more merge conflict that I missed in the merge commit.

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* Fix failing tests.

Signed-off-by: Callum Styan <callumstyan@gmail.com>",271,45,0,1,"2018-04-16 10:25:39","1375.03"
"grafana/loki","c3ed8fe180f962ababb71fa35b74889d5c3f8e79","periklis","2021-10-01 14:25:50","true","Move to docker-push-action@v2 (#86)",138,41,0,1,"2018-04-16 10:25:39","1260.92"
"grafana/loki","85392a9728b3b6e949fd2da70b04ebdfedfe6c69","rfratto","2022-12-04 18:12:46","true","Update Prometheus dependency to latest release (v2.40.4) (#7826)

Closes #7811, which is needed for Grafana Agent to update to v2.40 and
add support for native histograms.

I did not add support for native histograms to Loki, sorry :)",96,56,1,1,"2018-04-16 10:25:39","1689.32"
"grafana/loki","65013218b72cdd45237b73732aab420e67adc5a5","rfratto","2020-01-14 19:17:33","true","pkg/chunkenc: ignore duplicate lines pushed to a stream (#1519)

* pkg/chunkenc: ignore duplicate lines pushed to a stream

This commit changes the behavior of appending to a stream to ignore
an incoming line if its timestamp and contents match the previous line
received. This should reduce the chances of ingesters storing duplicate
log lines when clients retry push requests whenever a 500 is returned.

Fixes #1517",102,21,0,1,"2018-04-16 10:25:39","633.62"
"grafana/loki","e642c28d9337916a20155d804d36be3a3a69eae9","polar3130","2020-01-27 19:20:51","false","Helm/loki-stack: add template for the service name to connect to loki (#1587)

* add helper for the service name to connect to loki

* Bump loki-chart version.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

Co-authored-by: Cyril Tovena <cyril.tovena@gmail.com>",100,21,0,0,"2018-04-16 10:25:39","646.62"
"grafana/loki","38ee57c7d56756c02ff559e24f9cc0a29fd7c4f3","adityacs","2020-06-01 15:35:27","true","Feature: Replace stage in pipeline (#2060)",128,25,0,1,"2018-04-16 10:25:39","775.72"
"grafana/loki","291360ddcb680d1322472bf307b69fa445b63698","JordanRushing","2022-01-07 16:05:24","true","Simpler new chunk key v12 (#5054)

* starts hacking new chunk paths

* Create new chunk key for S3; update parsing and add basic test and benchmark

Signed-off-by: Jordan Rushing <jordan.rushing@grafana.com>

Fix `TestGrpcStore` to work with new chunk key structure

Signed-off-by: Jordan Rushing <jordan.rushing@grafana.com>

Add a function to SchemaConfig that returns the correct PeriodConfig for
a given time.

Signed-off-by: Callum Styan <callumstyan@gmail.com>

Add schema config to object client so it we can use the right external
key function based on the schema version.

Signed-off-by: Callum Styan <callumstyan@gmail.com>

Fix failing compactor tests by passing SchemaConfig to chunkClient

Remove empty conditional from SchemaForTime

Define schema v12; wire-in ChunkPathShardFactor and ChunkPathPeriod as configurable values

Add PeriodConfig test steps for new values ChunkPathShardFactor and ChunkPathPeriod in v12

Update test for chunk.NewExternalKey(); remove completed TODO

Set defaults for new ChunkPathPeriod and ChunkPathShardFactor SchemaConfig values; change FSObjectClient to use IdentityEncoder instead of Base64Encoder

Use IdentityEncoder everywhere we use FSObjectClient for Chunks

Add ExternalKey() function to SchemaConfig; update ObjectClient for Chunks

* Finish plumbing through the chunk.ExternalKey ->
schemaConfig.ExternalKey change.

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* Clean up lint failures

Signed-off-by: Jordan Rushing <jordan.rushing@grafana.com>

* Clean up chunk.go and fix tests

Signed-off-by: Jordan Rushing <jordan.rushing@grafana.com>

* Break SchemaConfig.ExternalKey() into smaller functions

Signed-off-by: Jordan Rushing <jordan.rushing@grafana.com>

* Quickly fix variable name in SchemaConfig.newerExternalKey()

Signed-off-by: Jordan Rushing <jordan.rushing@grafana.com>

* Clean up ExternalKey conditional logic; add better comments; add tests

Signed-off-by: Jordan Rushing <jordan.rushing@grafana.com>

* Fix a bug where we are prepending userID to legacy Chunk keys but never parsing it; refactor key tests and benchmarks

Signed-off-by: Jordan Rushing <jordan.rushing@grafana.com>

* Add small SchemaConfig test

Signed-off-by: Jordan Rushing <jordan.rushing@grafana.com>

* Update docs and CHANGELOG.md

Signed-off-by: Jordan Rushing <jordan.rushing@grafana.com>

* Correctly return an error when failing to parse a chunk external key

Signed-off-by: Jordan Rushing <jordan.rushing@grafana.com>

* Revert IdentityEncoder to Base64Encoder after testing

Signed-off-by: Jordan Rushing <jordan.rushing@grafana.com>

* Fix assignment in test for linter

Signed-off-by: Jordan Rushing <jordan.rushing@grafana.com>

* Remove leftover comments from development

Signed-off-by: Jordan Rushing <jordan.rushing@grafana.com>

* Change v12 version comment format; remove redundant login in `ParseExternalKey()`

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>

* Change remaining v12 comment style

Signed-off-by: Jordan Rushing <jordan.rushing@grafana.com>

* Pass chunk.SchemaConfig to new parallel chunk client

* Simplify chunk external key prefixes for schema v12

* Fix broken benchmark; add benchmarks for old parsing conditional

Signed-off-by: Jordan Rushing <jordan.rushing@grafana.com>

* Remove unneeded lines from upgrading doc

* Add benchmarks for root chunk external key parsing functions

Signed-off-by: Jordan Rushing <jordan.rushing@grafana.com>

* memoizes schema number calculations

* Resolve linter issue with PeriodConfig receiver name

Signed-off-by: Jordan Rushing <jordan.rushing@grafana.com>

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>
Co-authored-by: Callum Styan <callumstyan@gmail.com>",255,45,0,0,"2018-04-16 10:25:39","1356.99"
"grafana/loki","42b747b693f9f6ff90f4fd741a1ace948983449f","slim-bean","2019-11-20 05:48:02","true","updating helm and ksonnet to version v1.0.0 (#1292)",74,19,0,1,"2018-04-16 10:25:39","579.06"
"grafana/loki","efffe0ce50e612659fa814f1e2e1f8781eae0421","slim-bean","2022-01-31 19:47:42","true","add some timing to the logs for downloading and opening index tables (#5042)

Signed-off-by: Edward Welch <edward.welch@grafana.com>",276,45,0,1,"2018-04-16 10:25:39","1381.14"
"grafana/loki","3e6a75e1821331d408992ab0291e4db4113ce0ef","slim-bean","2019-01-29 17:09:09","false","removing incorrect calling of positions.Stop from within a target as it runs single instance within promtail, moved the call to Stop up to promtail.go within the Shutdown() method.  Should Fix #249 (#252)",70,9,0,1,"2018-04-16 10:25:39","283.28"
"grafana/loki","b0092bcc25de8f1194e86477935e5ee8081f74ff","jeschkies","2023-10-09 09:05:07","true","Pin grafana/docs-base image version. (#10815)

**What this PR does / why we need it**:
Currently we use `grafana/base-docs:latest` which broke our build. We
should pin the version to make CI builds reproducible and test version
updates.

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",25,66,1,1,"2018-04-16 10:25:39","1999.19"
"grafana/loki","54320e827c9e5d609753275a22d8f996c48d2c20","jeschkies","2022-11-21 14:41:49","true","Correct Helm documentation aliases. (#7537)

**What this PR does / why we need it**:
#7034 introduced a regression in the documentation. This changes
corrects the aliases of the Helm documentation pages.

**Checklist**
- [ ] Reviewed the `CONTRIBUTING.md` guide
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",94,55,1,1,"2018-04-16 10:25:39","1676.18"
"grafana/loki","c9cdd44e13d1939a31a694ed596b94ed71210d30","ivanahuckova","2021-09-09 00:27:26","true","Update _index.md (#4277)",127,41,0,0,"2018-04-16 10:25:39","1238.33"
"grafana/loki","84e6b65bf45596b0c96cf14c31ac9109dfa4bbf2","oddlittlebird","2020-04-20 20:53:59","true","Docs: Update docker.md (#1966)",114,24,0,0,"2018-04-16 10:25:39","734.94"
"grafana/loki","be2ecdc241c0ecca3ff3a465a0851349641767ae","poyzannur","2023-09-07 16:09:39","true","(Fix) cpu calculation queries in loki / operational (#10477)

**What this PR does / why we need it**:
irate is debated to show finer details, however it discards samples and
only uses last two in range.
This results in some smoothing out in our CPU utilisation graphs which
mislead us during an investigation a while back.
See the screenshot below from a random ingester. 

![Screenshot 2023-09-06 at 15 58
45](https://github.com/grafana/loki/assets/31743851/d57483f2-e207-485b-b4b5-fd43c1d0ddca)

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:
I choose to change the entire query to be in line with rest of the Loki
Read/Write Resources dashboards.

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",43,65,1,0,"2018-04-16 10:25:39","1967.49"
"grafana/loki","dcfba366de2fbe036df31e28200df983d4808e67","DylanGuedes","2022-09-26 20:48:48","true","Loki: Shard streams based on desired rate (#7199)

**What this PR does / why we need it**:
Modify our sharding mechanism to be dictated by the desired rate and ingestion rate.
Once the number of shards is calculated, the stream entries will be distributed across the shards. If the number of entries is lower than number of shards, we report a metric and use number of entries as the number of shards.",87,53,1,1,"2018-04-16 10:25:39","1621.43"
"grafana/loki","e6802394daf44473e90028586e8e8204b115f119","jpinsonneau","2023-06-07 09:07:35","true","operator: Expose per_stream_rate_limit & burst (#9630)

Co-authored-by: Periklis Tsirakidis <periklis@redhat.com>",68,62,1,0,"2018-04-16 10:25:39","1877.2"
"grafana/loki","ca94b2cc91593caec2602184608074e062ef0e2c","dojci","2020-07-17 13:57:17","true","Fix fluent-bit exit callback deadlock when buffering for loki is enabled (#2365)",121,27,0,0,"2018-04-16 10:25:39","821.65"
"grafana/loki","267dbe0085a7dbff8062b850f2e5776268acf4d2","rfratto","2020-02-07 21:36:03","true","pkg/promtail/positions: handle empty positions file (#1660)

If the positions file is empty, unmarshaling it will lead to a nil
map being created. This commit ensures that positions is always
initialized to be non-nil.

Potentially handles #1659.",115,22,0,1,"2018-04-16 10:25:39","656.72"
"grafana/loki","a8af1c0c84a18192d0c3fb04dc1634cedc8fd078","owen-d","2020-12-01 13:37:06","true","adds the ability to read chunkFormatV3 while writing v2 (#2984)",120,31,0,1,"2018-04-16 10:25:39","955.63"
"grafana/loki","e8bd3cb57946b52932abcae9474557a4dd4d9d04","owen-d","2021-11-03 13:24:00","true","Default wal to enabled in jsonnet lib (#4629)

* default wal to enabled

* update changelog & upgrade.md",170,42,0,1,"2018-04-16 10:25:39","1292.87"
"grafana/loki","35a627df49ddff6a6067bb7100fc8973cbd0f0b8","owen-d","2020-12-01 13:37:06","true","adds the ability to read chunkFormatV3 while writing v2 (#2984)

(cherry picked from commit a8af1c0c84a18192d0c3fb04dc1634cedc8fd078)",120,31,0,1,"2018-04-16 10:25:39","955.63"
"grafana/loki","cba31024d4d0cc5c45612dd051c032f248817729","chaudum","2023-03-27 07:56:12","true","Extend scheduler queue metrics with enqueue/dequeue counters (#8891)

**What this PR does / why we need it**:

Better o11y of the scheduler. This change yields new metrics with potentially high cardinality on the scheduler.

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",80,59,1,1,"2018-04-16 10:25:39","1801.9"
"grafana/loki","2d7ef074947dbcff5b15d110884d58d56a1548d4","DylanGuedes","2022-08-18 20:26:31","true","Fix `increment_duplicate_timestamps` for multiple dupped timestamps (#6924)",83,52,0,1,"2018-04-16 10:25:39","1583.42"
"grafana/loki","7f6c9104e28ae75fb119254773204a0ff0f55bd0","kavirajk","2023-09-07 08:14:12","true","post-release: Changelog adjustments on `main` branch (#10497)

**What this PR does / why we need it**:
Adjust changelog on `main` branch post release of v2.9.0

Cleanup unreleased changes w.r.t changes went into v2.9.0

**Which issue(s) this PR fixes**:
Related: #10468 

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)

- [x] `CHANGELOG.md` updated

---------

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>
Co-authored-by: Christian Haudum <christian.haudum@gmail.com>",44,65,1,1,"2018-04-16 10:25:39","1967.16"
"grafana/loki","aed11c25e66a91260ad7136fa7a4564dfe960aff","taharah","2022-06-13 07:52:19","true","fix(loki): allow global and per tenant sigv4 config (#6358)

Signed-off-by: Trevor Wood <Trevor.G.Wood@gmail.com>",71,50,0,0,"2018-04-16 10:25:39","1517.89"
"grafana/loki","a2c2a9090768e3d11529a1aeff56d7c91c6f01fe","pstibrany","2019-12-17 07:51:34","false","Lint: comments

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>",94,20,0,0,"2018-04-16 10:25:39","606.14"
"grafana/loki","b94c8aaf16282ebbdf6e3352b763574dde89a0b4","adityacs","2023-02-22 13:09:06","true","feature: geoip stage in promtail (#3493)

Co-authored-by: Ed Welch <edward.welch@grafana.com>",69,58,1,1,"2018-04-16 10:25:39","1767.11"
"grafana/loki","d32b20e91011681b4be6355df2c850eade3cdf34","chaudum","2023-09-01 14:49:58","true","Add deprecations to next release notes (#10421)

**What this PR does / why we need it**:

This PR adds important deprecations to next release notes.

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",45,64,1,1,"2018-04-16 10:25:39","1961.43"
"grafana/loki","6bfd2baec426dab4a24c669df567cdc0c989c7c4","owen-d","2023-11-01 17:40:24","true","Bloom/fuse queries (#11088)

Introduces a ""Fuse"" operation on a single block querier which
multiplexes queries against a single block. This is advantageous for a
few reasons:
* A ""query"" contains one of more series, with each series needing to
test one or more chunks for some search string(s).
* Blocks are sorted by fingerprint, which are the result of a hash
function. This means series are ~uniformly distributed across the hash
keyspace (`uint64` in our case). Because of this, a query for some
number of series are likely to be spread out across the block itself.
* Blocks are organized into individually compressed ""pages"". In essence,
querying them requires Seeking to the correct offset, decompressing the
page, then seeking within the page to the actual offset for a particular
series.
* Since the series for any query are likely spread out across the block,
performing `n` queries decompresses each page `n` times.
* By multiplexing many queries into a single pass iteration of the
block, we amortize the cost of loading & decompressing

Misc:
Also introduces a bunch of generic-powered iterators. These can probably
be optimized (I bet they use dynamic dispatch under the hood), but
they're very convenient to prototype with and we can improve them in the
future if it proves warranted.",15,66,1,1,"2018-04-16 10:25:39","2021.55"
"grafana/loki","6d0ca24251af03b25c3254db35fe9bd9df851f7e","MasslessParticle","2022-02-22 22:31:29","true","Fix operational dashboard (#5448)",298,46,0,1,"2018-04-16 10:25:39","1402.25"
"grafana/loki","d6e8788eae790d0cd6113d72481f18459c20af59","tomwilkie","2018-12-17 11:06:46","true","Don't forget to apply regexp filters to chunk entries. (#124)

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",39,8,0,0,"2018-04-16 10:25:39","241.03"
"grafana/loki","d080e46e2a2204d3326ff1da73aea65c40128b83","takanabe","2019-10-30 12:39:01","false","Correct wrong document paths about querying (#1214)",68,18,0,0,"2018-04-16 10:25:39","559.34"
"grafana/loki","41647d1302e12ec5a4867d4fcf126e2a08333631","periklis","2022-05-06 12:26:58","true","operator: Ruler enhancement proposal (#5985)",75,49,0,1,"2018-04-16 10:25:39","1481.08"
"grafana/loki","8f1835fe3d18c9e11d3e16cf0aa11e3eaef1fe83","slim-bean","2023-01-11 16:42:49","true","Helm: Remove signing of helm charts (#8099)

More information in: https://github.com/grafana/helm-charts/pull/2107



Signed-off-by: Edward Welch <edward.welch@grafana.com>

**What this PR does / why we need it**:

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the `CONTRIBUTING.md` guide
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

Signed-off-by: Edward Welch <edward.welch@grafana.com>",101,57,1,1,"2018-04-16 10:25:39","1726.26"
"grafana/loki","3a2ac64b7ced573e7a7ed513b7f1e4df344a1c4d","slim-bean","2019-05-30 19:58:09","false","cleaning up remaining TODO's, adding tests
cleaning up GoDoc
pipeline_name is now optional for matcher stage",108,13,0,1,"2018-04-16 10:25:39","409.65"
"grafana/loki","887f0cce7b818b226ceefc91160c2dd2c2c9ac7b","rfratto","2020-01-24 20:24:55","false","Disable transfers in loki-local-config.yaml (#1579)

* Disable transfers in loki-local-config.yaml

#1425 added the ability to disable transfers by setting the max amount of retries to zero or lower. The PR, however, didn't change the default setting in loki-local-config.yaml. This commit changes the setting in loki-local-config.yaml to disable transfers since they would never succeed with the default settings of an inmemory ring anyway.

* Set `max_transfer_retries` to 0 in helm charts",98,21,0,1,"2018-04-16 10:25:39","643.67"
"grafana/loki","001d36f510f0b126678ef55fd0ce38f1f517f668","rfratto","2019-08-13 13:07:04","true","pkg/promtail/positions: remove executable bit from positions file (#893)

File permissions on creation of positions.yaml will now be 0600
instead of 0700.

Fixes #892.",104,16,0,1,"2018-04-16 10:25:39","482.36"
"grafana/loki","58718a548cbdcd01c421a412366c978064330a2f","pracucci","2022-05-26 12:56:31","true","Add jsonnet tools to build image (#6255)

Signed-off-by: Marco Pracucci <marco@pracucci.com>",72,49,0,0,"2018-04-16 10:25:39","1501.1"
"grafana/loki","4c6090756f255d9dd216cb87bdf3dab7f548ab27","adityacs","2020-07-17 14:17:32","true","Loki Logstash Plugin (#1822)

* Logstash plugin

* include_labels

* include_labels

* Removes binary.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Improve documentation and remove the push path.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Move to cmd.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add more precision for jruby.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Update docs/clients/logstash/README.md

* p
Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* ignore

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* remove ignore file/

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* More precision for installing jruby

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Rename without Grafana

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* A lot of refactoring and testing.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* change delay logic

* Fully tested version.

Now testing/writing docs and charts.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Forgot to save merge.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* working version.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Makefile + easier docker build.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* adds ci to build logstash image.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fix build for logstash.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Adds example with helm charts.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fix target to send 10 logs with logstash.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Improved documentation.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* add missing helm add repo for external repo

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Review comment.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes loki service in Promtail.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Update loki-stack version

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

Co-authored-by: Cyril Tovena <cyril.tovena@gmail.com>",120,27,0,1,"2018-04-16 10:25:39","821.66"
"grafana/loki","3a80bdcddd3fc60a310c101683cb34099b8e67c0","blockloop","2021-03-17 21:10:29","true","cleanup",159,35,0,0,"2018-04-16 10:25:39","1061.95"
"grafana/loki","6601a9285a5e5c57d86a4dec0e6a7064056fa574","blockloop","2021-03-19 14:47:23","true","set ownerRefs",167,35,0,0,"2018-04-16 10:25:39","1063.68"
"grafana/loki","69d6ee293ee0b8c9de85847a3b0394149615d7f0","sandeepsukhani","2023-03-31 11:45:35","true","tsdb: use unique uploader name while building tsdb index filename, same as boltdb-shipper (#8975)

**What this PR does / why we need it**:
While building file names from `boltdb-shipper` and `tsdb`, we add the
name of the uploader to it.
To avoid collisions in filenames when running multiple ingesters with
the same name, we also add a nanosecond precise timestamp to the
ingester name, which is persistent as the uploader name in the active
index directory.

This is not being done for the tsdb index built from ingesters which can
cause collisions in filenames when running multiple ingesters with the
same name. I have moved the code to manage the uploader name to the
index shipper config and used the same to share it with tsdb.",83,59,1,1,"2018-04-16 10:25:39","1806.06"
"grafana/loki","92b698584aee28471a030cd1eb6f7222467f9856","SadFaceSmith","2023-10-27 13:22:32","true","add secret scanning workflow (#11053)

**What this PR does / why we need it**:
Short PR to add GitHub Action workflow to run Trufflehog on each PR.
Will only fail/alert on verified secrets. This can be tweaked and
configured later if need be.

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)
- [ ] If the change is deprecating or removing a configuration option,
update the `deprecated-config.yaml` and `deleted-config.yaml` files
respectively in the `tools/deprecated-config-checker` directory. <!--
TODO(salvacorts): Add example PR -->

Co-authored-by: Michel Hollands <42814411+MichelHollands@users.noreply.github.com>",17,66,1,0,"2018-04-16 10:25:39","2017.37"
"grafana/loki","ee9298d4b3b5c5a492c307227eb9eecc9c79fdae","gouthamve","2018-12-10 21:57:37","false","Remove invalidated key (#56)

* Remove invalidated key

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>

* Remove env, put logcli docs in separate md file.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",11,8,0,0,"2018-04-16 10:25:39","234.48"
"grafana/loki","fb3ad058e0de6bb4e3041691085df8a2c10efafb","periklis","2022-12-12 12:42:21","true","operator: Update Loki operand to v2.7.1 (#7910)",99,56,1,1,"2018-04-16 10:25:39","1697.09"
"grafana/loki","41eb82bc502e73bf0bb57be56a4c2054abeabdb8","periklis","2023-10-02 08:57:37","true","operator: Add memberlist IPv6 support (#10562)

Co-authored-by: Joao Marcal <joao.marcal12@gmail.com>
Co-authored-by: Robert Jacob <xperimental@solidproject.de>",30,65,1,1,"2018-04-16 10:25:39","1992.19"
"grafana/loki","9c470d4f9a9ec16fea1fe87a02d4ba4cef22c0dd","slim-bean","2021-03-11 15:04:45","true","update for 2.2 release (#3477)",154,35,0,1,"2018-04-16 10:25:39","1055.69"
"grafana/loki","f3da16797742bc7135ebd5ab1e27187a8d9ddd2f","slim-bean","2020-12-24 14:41:17","true","Merge branch 'release-2.1.0'

# Conflicts:
#	CHANGELOG.md",124,32,0,1,"2018-04-16 10:25:39","978.68"
"grafana/loki","8d50fd5196e888e9bf613dbc620113ea53033519","shwetaap","2023-08-03 06:57:29","true","operator: Add recovery steps for ingester pods in zone-failure outages (#10057)

Signed-off-by: Shweta Padubidri <spadubid@redhat.com>
Co-authored-by: Periklis Tsirakidis <periklis@redhat.com>",53,64,1,0,"2018-04-16 10:25:39","1933.11"
"grafana/loki","6f7d8a2e41558c46dea76f7160cb341d3b692046","kavirajk","2023-08-02 10:22:20","true","chore(CODEOWNERS): Add dependabot as codeowners for dependencies (#10141)

**What this PR does / why we need it**:
Add dependabot as codeowner for dependencies related files (`go.mod`,
`go.sum` and `/vendor`)

This is needed because, we have branch protection rule (for `main`
branch) with ""Required review of code owners"" as one of the checks
**Which issue(s) this PR fixes**:
Fixes #NA

**Special notes for your reviewer**:
Follow up to #10126 

NOTE: Github linter may show ""@dependabot is unknown and may not have
write permission for the repo"" But that's fine. I tested it on my
personal repository.

example: Before having it as CODEOWNERS.
https://github.com/kavirajk/dependabot-play/pull/10 (GH action waited
for another user from CODOWNER to review before merging)

example: After adding it to CODEOWNERS
https://github.com/kavirajk/dependabot-play/pull/13 (GH action merged
the PR because approve from dependabot is good enough as it's code owner
for `go.mod`related files)

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",52,63,1,1,"2018-04-16 10:25:39","1932.25"
"grafana/loki","636e19dfebe5b0d57eb7f7c26e3cb03c2a1d3aba","MasslessParticle","2023-01-19 20:53:05","true","place canary docs in their own package and fix links+description (#8217)

There is a PR blocked on incorrect canary docs:
https://github.com/grafana/loki/pull/8205

This PR should clear that CI error so the author can rebase and have the
PR accepted

This was failing three lint checks:
1. Docs need a `description` header
2. Images have to link to the same directory so `./` instead of `../`
3. Images can only be linked from `_index.md` files so a new package is
required",82,57,1,1,"2018-04-16 10:25:39","1734.44"
"grafana/loki","d81f757ecb8637016664bec27965622e30068f47","cyriltovena","2021-11-12 07:31:48","true","Refactor and simplify stats package. (#4712)

* Refactor and simplify stats package.

This PR refactors the stats package and make it smaller and simpler to work with.

- It doesn't expose the context which can causes race when mutating it.
- Uses concurrency primitive to ensure correctness
- Replace trailers with in-batch statistics to propagate ingesters stats.

Fixes #3366

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* fix tests and lint issues.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes moar tests.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* mod-check

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* More fixes.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",195,43,0,1,"2018-04-16 10:25:39","1301.63"
"grafana/loki","ec725db9d0aee23d737106ad67b0ebb2f751e7d8","cyriltovena","2020-11-25 07:31:31","true","Add ProcessString to Pipeline. (#2972)

* Add ProcessString to Pipeline.

Most of the time, you have a buffer that you want to test again a log pipeline, when it passed you usually copy via string(buff).

In some cases like headchunk and tailer you already have an allocated immutable string, since pipeline never mutate the line passed as parameter, we can create ProcessString pipeline method that will avoid re-allocating the line.

benchmp:

```
❯ benchcmp before.txt after.txt
benchmark                                           old ns/op     new ns/op     delta
BenchmarkHeadBlockIterator/Size_100000-16           20264242      16112591      -20.49%
BenchmarkHeadBlockIterator/Size_50000-16            10186969      7905259       -22.40%
BenchmarkHeadBlockIterator/Size_15000-16            3229052       2202770       -31.78%
BenchmarkHeadBlockIterator/Size_10000-16            1916537       1392355       -27.35%
BenchmarkHeadBlockSampleIterator/Size_100000-16     18364773      16106425      -12.30%
BenchmarkHeadBlockSampleIterator/Size_50000-16      8988422       7730226       -14.00%
BenchmarkHeadBlockSampleIterator/Size_15000-16      2788746       2306161       -17.30%
BenchmarkHeadBlockSampleIterator/Size_10000-16      1773766       1488861       -16.06%

benchmark                                           old allocs     new allocs     delta
BenchmarkHeadBlockIterator/Size_100000-16           200039         39             -99.98%
BenchmarkHeadBlockIterator/Size_50000-16            100036         36             -99.96%
BenchmarkHeadBlockIterator/Size_15000-16            30031          31             -99.90%
BenchmarkHeadBlockIterator/Size_10000-16            20029          29             -99.86%
BenchmarkHeadBlockSampleIterator/Size_100000-16     100040         40             -99.96%
BenchmarkHeadBlockSampleIterator/Size_50000-16      50036          36             -99.93%
BenchmarkHeadBlockSampleIterator/Size_15000-16      15031          31             -99.79%
BenchmarkHeadBlockSampleIterator/Size_10000-16      10029          29             -99.71%

benchmark                                           old bytes     new bytes     delta
BenchmarkHeadBlockIterator/Size_100000-16           27604042      21203941      -23.19%
BenchmarkHeadBlockIterator/Size_50000-16            13860654      10660652      -23.09%
BenchmarkHeadBlockIterator/Size_15000-16            4231360       3271363       -22.69%
BenchmarkHeadBlockIterator/Size_10000-16            2633436       1993420       -24.30%
BenchmarkHeadBlockSampleIterator/Size_100000-16     17799137      14598973      -17.98%
BenchmarkHeadBlockSampleIterator/Size_50000-16      7433260       5833137       -21.53%
BenchmarkHeadBlockSampleIterator/Size_15000-16      2258099       1778096       -21.26%
BenchmarkHeadBlockSampleIterator/Size_10000-16      1393600       1073605       -22.96%
```

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* add some precision about why Sum64 is not a concern.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Update pkg/chunkenc/memchunk.go

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>",112,31,0,1,"2018-04-16 10:25:39","949.38"
"grafana/loki","43184298b2cb274f602e280da858b07790ad8057","cyriltovena","2021-04-30 10:10:31","true","Trigger compaction prior retention. (#3665)

* Trigger compaction prior retention.

This should allow to process table where the amount of index files is below 4.
Currently they are not processed and we should process them since they may never be compacted.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Hook retention into compaction.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Remove unused flags.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Better comment.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Better cancellation.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Missing ctx in test.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes flags that are not used.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add compactor retention tests.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Review feedback.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",179,36,0,1,"2018-04-16 10:25:39","1109.74"
"grafana/loki","19c7315bcc7e659fd48ee709c2eb7c787a589415","simonswine","2022-08-04 13:53:51","true","Improve error message when max error message is hit (#6834)

before:  `entry with timestamp 2022-08-02 12:32:37 +0000 UTC ignored, reason: 'entry too far behind' for stream: {foo=""bar2""}`
after: `entry with timestamp 2022-08-02 12:32:37 +0000 UTC ignored, reason: 'entry too far behind, oldest acceptable timestamp is: 2022-08-03T15:25:57Z' for stream: {foo=""bar2""}`",74,52,0,0,"2018-04-16 10:25:39","1569.14"
"grafana/loki","ca6fce19cc071b6a93597d90953f947f1214dd1d","daixiang0","2019-10-01 13:02:55","false","docs(stage): add docker and cri (#1091)

Signed-off-by: Xiang Dai <764524258@qq.com>",73,17,0,0,"2018-04-16 10:25:39","530.36"
"grafana/loki","4ebd6c7f7e8591ab08bfe4f5694126de257d60fb","daixiang0","2019-05-17 05:39:43","true","Merge branch 'master' into reduce-config-option",102,13,0,0,"2018-04-16 10:25:39","396.05"
"grafana/loki","3c78f35c7387744f08d13884710b490f2cef6942","daixiang0","2019-03-19 01:26:42","true","Merge branch 'master' into enable-loki",102,11,0,0,"2018-04-16 10:25:39","332.63"
"grafana/loki","fc6c5c063ff3d0fcadef4f73d2c5b2ff00b27189","joe-elliott","2019-09-30 12:37:27","false","dep => go mod (#1062)

* go mod files added.  dep removed

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Magically got prometheus version to stick

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Cortex updated and prometheus updated

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Updated prometheus dependency

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Added additional deps

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Added two replaces from Gopkg.toml.  Tests passing

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Added deps

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Updated build image to 1.12

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Updated golangci-lint to use vendored dependencies

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Added check-mod makefile step and referenced in drone and circle ci configs

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Updated loki-build-image to 1.12

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Fixed linting error.  Force go111module on for linting

Signed-off-by: Joe Elliott <number101010@gmail.com>

* go mod vendor

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Forced the inclusion of modtimevfs

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Pin client-go due to issue with v12 go.mod

Signed-off-by: Joe Elliott <number101010@gmail.com>

* go mod tidy

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Added check-mod to drone

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Re-readded correct golang client

Signed-off-by: Joe Elliott <number101010@gmail.com>

* go mod tidy

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Pinned golang/x/net to avoid proxy errors

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Removed check-mod from all.  Not necessary for tests

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Updated go.sum to match new pin

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Upgraded proto to match build image

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Force check-mod to wait til after test and lint are successful

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Added mod vendor to go builds to force usage of vendored dependencies

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Turn on gomodules on all builds

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Revert ""Added mod vendor to go builds to force usage of vendored dependencies""

This reverts commit 65865a24c9a23133e0fa52942f2828ead7c22147.

* Moved builds out of the gopath to enforce vendor usage

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Revert ""Turn on gomodules on all builds""

This reverts commit b5847f0158e928e935e0b3c1b1d4eaba840ca3dc.

* Explicitly choose build image for docker driver

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Updated golang.org/x/sys to match prometheus's version to fix promtail windows compilation

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Added fluentbit dependency

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Added dependency management clause

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Updated go version in contributing

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Added phony makefile targets

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Circle CI is increasingly failing linting

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Force vendored deps on builds

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Added logcli to gitignore

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Reduced concurrency to help CircleCI

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Moved drone builds out of GOPATH to force use of go module

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Added mod vendor to prevent go clean from redownloading all packages

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Added to test as well

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Added mod-vendor to final go commands

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Moved fluent-bit out of GO_PATH to force go modules

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Pass mod vendor to the last holdout:  go generate

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Updated ugorji/go to 1.17 to avoid version regression

Signed-off-by: Joe Elliott <number101010@gmail.com>

* go mod tidy and go mod vendor for ugorji/go

Signed-off-by: Joe Elliott <number101010@gmail.com>",71,17,0,0,"2018-04-16 10:25:39","529.34"
"grafana/loki","7d8b0c83ccbd1336015750bc8f6a5977a3b62720","sboschman","2019-04-24 14:24:55","false","allow additional pod labels (#509)",98,12,0,0,"2018-04-16 10:25:39","373.42"
"grafana/loki","a12b0803f0b630475fed27174377cd6f79f3abd3","knylander-grafana","2022-08-26 10:00:56","true","[Doc] Fixed comma and missing ""of"" in observability.md (#6976)

**What this PR does / why we need it**:

Correcting two mistakes that @osg-grafana found in PR#6971. 

**Checklist**
- [X] Documentation added
- [ ] Tests updated
- [ ] Is this an important fix or new feature? Add an entry in the `CHANGELOG.md`.
- [ ] Changes that require user attention or interaction to upgrade are documented in `docs/sources/upgrading/_index.md`",82,52,0,0,"2018-04-16 10:25:39","1590.98"
"grafana/loki","14370bb8ce67873c3d68107dc544bcbec6ca31d4","paul1r","2023-05-09 14:13:16","true","Revert ""Augment statistics.."" PR 9400. (#9430)

**What this PR does / why we need it**:
This PR reverts PR 9400. The data collected within that PR was not
sufficient. When queries are done, they are filtered before the merge
iterator, resulting in an inability to collect an accurate count of
duplicated data.

**Which issue(s) this PR fixes**:


**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",82,61,1,0,"2018-04-16 10:25:39","1849.41"
"grafana/loki","b2fafdf3603909eed77a8e0c1d6da50c49441c53","tomwilkie","2019-03-20 18:18:30","false","Export position in file, not bytes read.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",91,11,0,0,"2018-04-16 10:25:39","334.33"
"grafana/loki","64c1de8c7670d8a7d38586fb57463bf3e3748300","daixiang0","2019-10-16 12:15:27","false","Update golint (#1157)

* golangci: replace deadline with timeout

Signed-off-by: Xiang Dai <764524258@qq.com>

* put concurrency into config file

Signed-off-by: Xiang Dai <764524258@qq.com>",65,18,0,0,"2018-04-16 10:25:39","545.33"
"grafana/loki","c6b9711df00d3d09393e713f3736572394c1c2af","slim-bean","2023-07-27 18:55:38","true","update drone signature (#10087)

**What this PR does / why we need it**:

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

Signed-off-by: Edward Welch <edward.welch@grafana.com>",50,63,1,1,"2018-04-16 10:25:39","1927.6"
"grafana/loki","b95805dcf685f5ba685b8ca10b0d80140c58601c","daixiang0","2019-04-28 01:32:59","false","fix a typo

Signed-off-by: Xiang Dai <764524258@qq.com>",96,12,0,0,"2018-04-16 10:25:39","376.88"
"grafana/loki","77dcb16b4ede42f9116bb959e4b73fa16972b172","taisho6339","2021-12-03 07:12:12","true","Fix duplicate registry.MustRegister call in Promtail Kafka (#4866)

* Move pipeline creation to new targetsyncer func

* registry.MustRegister is called every newPipeline so ensure it only at once

* add changelog entry",216,43,0,0,"2018-04-16 10:25:39","1322.62"
"grafana/loki","f38126473cd9e53fa5324ff0660a0142b15c45f9","jdbaldry","2021-08-17 20:49:01","true","Jsonnet: Add Grafana Enterprise Logs library (#4165)

* feat: Add enterprise-logs Jsonnet library

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* fixup: Use correct image for GEL

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* fix: Separate k8s-libsonnet dependency

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* chore: Simplify Makefile

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* fix: Remove extra comma in jsonnetfile.json

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* fix: Remove unused prerequisite of test evaluation

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* doc: Remove unnecessary comments

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* fix: Remove storageClassName from PVCs

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* feat: Ensure all GEL Pods run as non-root user

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* feat: Configure memberlist for a more stable ring

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* style: Simplify gossip-ring Service ports configuration

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* chore: Update dependency lock

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* chore: Add convenience test target

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* fix: Disable tokengen Job by default

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* doc: Add TODO for utility functions

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* chore: Add tooling for developer testing

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>",130,40,0,0,"2018-04-16 10:25:39","1217.18"
"grafana/loki","afb94b2df276c52d2168a30bc4b508ed24dfbc22","dannykopping","2022-03-01 11:52:47","true","Replacing cortex_bigtable* metrics with the correct loki_bigtable* metrics (#5500)

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",300,46,0,1,"2018-04-16 10:25:39","1410.81"
"grafana/loki","6978ee5d73878d7406bda68296a3dd8ecda4d538","slim-bean","2020-10-26 15:47:40","true","Loki Release: update release notes and docs (#2808)

* update release notes and docs!

* add go and cortex version

* tweaks

* tweak wording

* change paths

* typo, thanks Cyril ;)

* thanks Owen ;)",118,30,0,1,"2018-04-16 10:25:39","920.72"
"grafana/loki","fdf91663bf8becdef9079bcf505d98468c1cec67","charandas","2020-08-20 13:16:02","true","Fix broken links (#2521)",118,28,0,0,"2018-04-16 10:25:39","854.62"
"grafana/loki","321b928ce665d31b21d0c711e89e7010131008b5","slim-bean","2019-08-02 18:35:55","true","docs(Release): Update Changelog (#844)",105,15,0,1,"2018-04-16 10:25:39","471.59"
"grafana/loki","ad2baa5109289813ca2fb519dbb456006c943b51","tomwilkie","2018-05-18 18:47:27","false","Plumb through time-window args on the cli.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",0,1,0,0,"2018-04-16 10:25:39","32.35"
"grafana/loki","63a57c7b5c075f9a35afc566f3db39dd3d4d5590","liguozhong","2022-12-01 15:10:18","true","[bugfix] scheduler: Gracefully shutdown querier when using query-scheduler (#7735)

**What this PR does / why we need it**:
Gracefully shutdown querier when using query-scheduler
This PR is an attempt to fix a bug that my loki cluster is unavailable
for logql. The source code and ideas are from mimir of LGTM. Thanks
mimir and pr author @pracucci

**Which issue(s) this PR fixes**:
Fixes #7722

**Special notes for your reviewer**:
mimir PR
https://github.com/grafana/mimir/pull/1756
https://github.com/grafana/mimir/pull/1767


**Checklist**
- [x] Reviewed the `CONTRIBUTING.md` guide
- [ ] Documentation added
- [x] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

Co-authored-by: Karsten Jeschkies <k@jeschkies.xyz>",93,55,1,1,"2018-04-16 10:25:39","1686.2"
"grafana/loki","8c8fc33d7f1e8a3a345630483556b50397feb79b","daixiang0","2019-09-26 13:04:38","false","doc: skip jb init when using Tanka (#1068)

Signed-off-by: Xiang Dai <764524258@qq.com>",71,17,0,0,"2018-04-16 10:25:39","525.36"
"grafana/loki","4593e581151287fe954f7207ced218764adb64f8","daixiang0","2019-03-28 08:46:41","false","Logcli: remove config part

Since kinpin.v2 not support use config like this, remove them.

Signed-off-by: Xiang Dai <764524258@qq.com>",92,11,0,0,"2018-04-16 10:25:39","341.93"
"grafana/loki","be1a9c4ec535df7b25b090ab1bb1dd0fa4d359dc","vlad-diachenko","2023-07-17 06:35:36","true","Revert ""updated to the latest version of dskit"" (#9953)

Reverts grafana/loki#9920",59,63,1,0,"2018-04-16 10:25:39","1917.09"
"grafana/loki","c2f96221dcd89d41bbb119965e5fde2d21131b36","JStickler","2023-06-14 20:53:57","true","Update that Loki accepts out-of-order rewrites by default. (#9670)

**Which issue(s) this PR fixes**:
Fixes #7477",64,62,1,0,"2018-04-16 10:25:39","1884.69"
"grafana/loki","4d997a5a10945977e874f17bc5509f5e1716849c","thampiotr","2023-06-12 15:24:26","true","Fix promtail cluster template not finding all clusters. (#9684)

**What this PR does / why we need it**:
In promtail-mixin, the dropdown template for clusters would only include
clusters that run loki. So if a cluster only run promtail and not loki,
it doesn't appear.",67,62,1,0,"2018-04-16 10:25:39","1882.46"
"grafana/loki","af896eb5f6d69cd6891d2bdeabb96890de5b1b51","dannykopping","2023-04-20 12:06:27","true","Ruler: log rule evaluation detail (#9206)

**What this PR does / why we need it**:
This logs some extra detail around rule evaluation to enable more
effective troubleshooting when a rule is not behaving as expected.",77,60,1,1,"2018-04-16 10:25:39","1830.32"
"grafana/loki","db6fd7e779e4bd30062f826e437dd9842431ac45","owen-d","2020-02-14 20:42:16","true","api support for scalars (#1704)

* adds conversions to loghttp scalar types

* logcli prints scalars, lothttp scalars use prometheus json marshaling",120,22,0,1,"2018-04-16 10:25:39","663.68"
"grafana/loki","1c6a2410d661f52efbc90f0d675511b428298615","kavirajk","2022-08-02 08:32:37","true","doc(retention): Add clarity on default behavior. (#6815)

* doc(retention): Add clarity on default behavior.

Currently if you read through the entire doc, it's not super clear what happens if I don't enable retention.

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* update

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",76,51,0,1,"2018-04-16 10:25:39","1566.92"
"grafana/loki","1f0b7cc5dafedc39f639cbebdd8b6b24e94d670c","flouthoc","2019-09-26 17:29:17","false","Fix Docs: Change Imagepull policy to IfNotpresent / Add loki-canary base manifests (#1073)",69,17,0,1,"2018-04-16 10:25:39","525.54"
"grafana/loki","c860fc6442663170897f1cab73d4f9a4f6af4158","KMiller-Grafana","2022-04-05 15:09:10","true","Docs: Document Promtail global rate limiting (#5737)

* Docs: Document Promtail global rate limiting

* Update docs/sources/clients/promtail/configuration.md

Co-authored-by: Jennifer Villa <jvilla2013@gmail.com>

* Revise strings that explain the new configuration parameters

* For rate limiting, limit_config becomes limits_config

Co-authored-by: Jennifer Villa <jvilla2013@gmail.com>",321,47,0,0,"2018-04-16 10:25:39","1444.95"
"grafana/loki","8ac08e65d90d58bfa7e4635a51a063f66a5934d1","KMiller-Grafana","2022-08-11 15:34:04","true","Docs: improve wording and grammar (#6861)",81,52,0,0,"2018-04-16 10:25:39","1576.21"
"grafana/loki","e8ac2214fb212f182b3ae8bbdb548ea851a4f73f","KMiller-Grafana","2021-09-13 22:23:07","true","Docs: inject newlines for configuration section readability (#4247)",135,41,0,0,"2018-04-16 10:25:39","1243.25"
"grafana/loki","ad65cc29bc3f17db4b99fdfbce54bd9b984b3341","kavirajk","2022-06-09 06:03:50","true","Support `series|labels` query_type in `logql_query_duration` (#6341)

So that you can do quantile calculation on metadata queries.

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",73,50,0,1,"2018-04-16 10:25:39","1513.82"
"grafana/loki","1530120c2ea26587e1009567876e89a3b6cf444a","owen-d","2020-06-05 14:47:54","true","Logql comparison ops (#2182)

* comparison binops

* starts comparison operator docs

* implements bool modifier for comparison binops

* vector-vector binop merging cases, including bool modifier

* logql docs formatting

* resets protos

* linter fixes

* goimports local

* gofmt",130,26,0,1,"2018-04-16 10:25:39","779.68"
"grafana/loki","3c334001cd864bef53fb468805765779a2222171","owen-d","2022-05-19 18:30:36","true","creates a single tsdb for entire wal recovery (#6203)

* creates a single tsdb for entire wal recovery

* tsdb wal replay builds TSDBs with unrounded timestamps to avoid clobbering",72,49,0,1,"2018-04-16 10:25:39","1494.34"
"grafana/loki","45b10effac911f7247441da62c08a564cd22ec91","vlad-diachenko","2023-11-01 15:42:57","true","embedded cache refactoring (#10989)

**What this PR does / why we need it**:
refactored embedded cache to allow using it for any types, not only for
`string -> []byte`.
Also, the new implementation allows passing the callback that will be
called for the removed entry.

---------

Signed-off-by: Vladyslav Diachenko <vlad.diachenko@grafana.com>",15,66,1,0,"2018-04-16 10:25:39","2021.47"
"grafana/loki","2eb666b0a8b53fb24e315b29a84c2bfdffa33532","rfratto","2019-07-22 18:04:01","false","ingester: fix lint issues for chunk transfers",103,15,0,1,"2018-04-16 10:25:39","461.57"
"grafana/loki","0f5fceef8f6f18f4c341f07cf7ae3d18e9534822","adityacs","2021-03-17 13:04:53","true","Support labelallow stage in Promtail (#3468)

* add labelallow stage

* added docs

* add docs

* fix lint

* update stage name in _index.md",160,35,0,1,"2018-04-16 10:25:39","1061.61"
"grafana/loki","6e2b7d25898f321bfd6f94de05d6ce934c785da9","dannykopping","2022-10-05 10:05:50","true","Patching loki-build-image with latest golangci-lint version (#7337)

**What this PR does / why we need it**:
Currently the `loki-build-image` has a version of golangci-lint which is
based on Go 1.18.
[This issue](https://drone.grafana.net/grafana/loki/16278/2/9) has
arisen in our CI: https://github.com/golangci/golangci-lint/issues/3107",94,54,1,1,"2018-04-16 10:25:39","1629.99"
"grafana/loki","aa31b46d26c0392cbb4bcbd5c0fc20870120bc79","cstyan","2022-06-17 15:45:45","true","[modules] pin version of memberlist (#6413)

* Use a replace directive to ensure we're using the same version of
memberlist as mimir.

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* run go mod tidy

Signed-off-by: Callum Styan <callumstyan@gmail.com>",67,50,0,1,"2018-04-16 10:25:39","1522.22"
"grafana/loki","aa44de07bb6409c83798000008cdfcb6904dc62f","tomwilkie","2018-05-14 12:55:06","false","Move promtail from kausalco/public, update it for prometheus changes.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",0,1,0,0,"2018-04-16 10:25:39","28.1"
"grafana/loki","ee91824234f802803c11578da8396d52c6b23d68","tomwilkie","2018-04-23 19:35:53","false","Ingester doesn't need a ring.",0,0,0,0,"2018-04-16 10:25:39","7.38"
"grafana/loki","c88e797b64edc428a86032265e2cb5e12f85ff76","tomwilkie","2018-04-17 10:59:20","false","Add in-memory inverted index for ingesters.",0,0,0,0,"2018-04-16 10:25:39","1.02"
"grafana/loki","5331449f633afd9e2ec00c48239f59eb463249ed","salvacorts","2023-05-03 14:35:01","true","Add missing release notes for 2.8.2 (#9389)

**What this PR does / why we need it**:

Part of v2.8.2 release

---------

Co-authored-by: J Stickler <julie.stickler@grafana.com>",81,61,1,1,"2018-04-16 10:25:39","1843.42"
"grafana/loki","4779b8bd2bedfeef59f049f080f34f8110998297","sh0rez","2019-07-08 14:13:17","false","fix(loki): panic on missing config (#720)

* fix(loki): pass missing config error to user

Missing config errors are handled at the library level. Our own check mitigated
this and causes loki to SEGFAULT later on

* feat(loki): default config file in container

The container provides a default config file. Use it by default

* Revert ""fix(loki): pass missing config error to user""

This reverts commit b2744fcf427b2b386dce5e999c855ae5c899e4e2, because loki it
assumed loki was incapable of running without config, which is not the case.",98,15,0,0,"2018-04-16 10:25:39","447.41"
"grafana/loki","4b20f9509874ecb39daab5b5dd996819d312cfde","kavirajk","2023-11-10 09:19:45","true","chore(jsonnet): Upgrade memcached-exporter to `0.11.3` (#11187)

**What this PR does / why we need it**:
Rationale being
1. Unify with extstore based cache we use on cloud
2. Looks like some extra useful metrics are exported on `0.11.3`

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)
- [ ] If the change is deprecating or removing a configuration option,
update the `deprecated-config.yaml` and `deleted-config.yaml` files
respectively in the `tools/deprecated-config-checker` directory.
[Example
PR](https://github.com/grafana/loki/pull/10840/commits/0d4416a4b03739583349934b96f272fb4f685d15)

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",0,67,1,1,"2018-04-16 10:25:39","2030.2"
"grafana/loki","4d2a94ebd3153aa6ebfed22ea81f7bc714e97dae","trevorwhitney","2023-08-15 21:43:35","true","Return intersecting labels when aggregating volume by label (#10248)

This PR changes the behavior the `index/volume` endpoint to return
intersecting labels when requesting volume aggregating by label.
Previously it only returned labels that matched selectors in the query.
The old behavior is still possible using the `targetLabels` argument.",55,64,1,1,"2018-04-16 10:25:39","1945.72"
"grafana/loki","d07a9e7dfc1110b7d0ae95be53468fae652c8cb0","slim-bean","2023-05-12 21:20:49","true","Loki: also store the bytes we de-duplicate alongside the count (#9449)

**What this PR does / why we need it**:

We have a metric which stores a count of de-duplicated chunks, this PR
creates a metric to also show bytes de-duplicated

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

Signed-off-by: Edward Welch <edward.welch@grafana.com>",72,61,1,1,"2018-04-16 10:25:39","1852.7"
"grafana/loki","9b90aad7ce20545fa17cf0b1649448159964c36b","jeschkies","2022-12-12 19:31:36","true","Fix sizing tool. (#7899)

**What this PR does / why we need it**
The current sizing tool is broken because it would not allow cross
origin requests. See LogQL Analyzer
(https://github.com/grafana/loki/blob/main/docs/sources/logql/analyzer/script.js#L115)
for the proper way to call its API.",99,56,1,1,"2018-04-16 10:25:39","1697.38"
"grafana/loki","7867451a93b7b8aefcbcc6b727d2cbd21f18aae6","KMiller-Grafana","2022-01-03 13:54:38","true","Docs: SSD mode read target runs the compactor (#5016)",254,44,0,0,"2018-04-16 10:25:39","1352.9"
"grafana/loki","2f192bbb25131b1b9b414973de3e778578c84e84","jdbaldry","2022-07-07 11:07:56","true","Append .x to the versioned directories for the website sync (#6611)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>",71,51,0,0,"2018-04-16 10:25:39","1542.03"
"grafana/loki","400cb1e28a2e726486c59a4a357ef8e1118abae0","daniellee","2018-12-11 14:37:44","true","Merge pull request #62 from grafana/readme-image-tweak

Centers badges in the readme",12,8,0,0,"2018-04-16 10:25:39","235.18"
"grafana/loki","409bff5796f2e84c2731f970240959e5fec4a418","granular-ryanbonham","2019-03-19 15:23:48","false","Support AWS Storage w/ HELM template (#337)

* Migrate config from configmap to secret. Add support for AWS Storage Config.

* Add checksome for secret as pod annoation to ensure pod rotates if we update secret.

* Move aws_storage_configs to storage_configs. Move local storage options under a local_storage key.

* Allow specification of storage_config directly as yaml in values.yaml

* Fix syntax for _helpers.tpl",95,11,0,0,"2018-04-16 10:25:39","333.21"
"grafana/loki","c6110bd93fee3c5e7b88ffcfa6ff5b62032191e7","owen-d","2021-01-28 13:27:17","true","updates tanka installation docs (#3239)",124,33,0,1,"2018-04-16 10:25:39","1012.63"
"grafana/loki","8d2b3f7aa5be5bee89a8e1d2cb006fd28caf4289","chaudum","2022-01-29 12:39:21","true","Return early if push payload does not contain data (#5229)

Optimize for:

* payload does not contain any streams
* a stream does not contain any entries
* none of the streams contain any entries

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",276,45,0,1,"2018-04-16 10:25:39","1378.84"
"grafana/loki","7fdece94e72c49b35320d7f307350dff6fbfef1d","chri2547","2021-10-28 16:29:43","true","update curl post example (#4559)",166,42,0,0,"2018-04-16 10:25:39","1288"
"grafana/loki","241bde1271025fcefa742a180e3ebd1578b84f02","bboreham","2022-05-02 08:30:29","true","Add dot to some DNS address to reduce lookups (#5789)

Kubernetes sets up a DNS search path like `namespace.svc.cluster.local,
svc.cluster.local, cluster.local, google.internal`; any unqualified name
is first tried as a prefix to each of these. These requests, which will
never succeed, add latency and increase load on the DNS service.

Adding a `.` at the end makes the name fully-qualified, so Go's DNS
client will skip the search path and use the name as-is.

Note only changes a subset of addresses in the config; others didn't
seem to be causing a problem.",78,49,0,0,"2018-04-16 10:25:39","1476.92"
"grafana/loki","65116c43eb4a9e9130477e98fb7124126cbf8650","grafanabot","2023-08-23 13:26:00","true","[Release Notes Appender] Add PR #7754: index-shipper: add support for multiple stores (#10306)

Add PR #7754 to release notes for next release

---------

Co-authored-by: Ashwanth Goli <iamashwanth@gmail.com>",50,64,1,0,"2018-04-16 10:25:39","1953.38"
"grafana/loki","2fdd24038bf952ad43e0d5be52491ccb615a93c5","ssncferreira","2022-01-03 13:56:38","true","Move querier.split-queries-by-interval to a per-tenant configuration (#5023)",254,44,0,0,"2018-04-16 10:25:39","1352.9"
"grafana/loki","8c03d2389c60251a781cf67c19b199ca4fa9a39e","periklis","2022-04-29 11:02:09","true","operator: Merge gh index page with README.md to link to docs (#6048)",93,48,0,1,"2018-04-16 10:25:39","1474.03"
"grafana/loki","1cfff09117e99e78d14edd3bfa0a2ae8285785e1","JordanRushing","2022-03-30 17:07:38","true","Implement `Series` and `Label` for MultiTenantQuerier (#5566)

**What this PR does / why we need it**:

re: #5490, #5517

This PR continues implementing the `Querier` interface by adding `Label` and `Series` methods for `MultiTenantQuerier`. 

Two new functions are also added to `pkg/logproto`: `MergeSeriesResponses` and `MergeLabelResponses` which consolidate multi-tenant responses into a single response.

**Which issue(s) this PR fixes**:

N/A

**Special notes for your reviewer**:

N/A

**Checklist**
- [ ] Documentation added
- [x] Tests updated
- [ ] Add an entry in the `CHANGELOG.md` about the changes.

Signed-off-by: JordanRushing <rushing.jordan@gmail.com>
Co-authored-by: Karsten Jeschkies <k@jeschkies.xyz>",309,47,0,0,"2018-04-16 10:25:39","1440.03"
"grafana/loki","23ff2e9ddbcb562a1441764847e14ed55257330d","marcusteixeira","2022-04-13 11:09:03","true","docs: fix query_ingester_only config (#5873)

* docs: fix query_ingester_only config

* fix: change msg when query_store_only and query_ingester_only is enabled",319,48,0,0,"2018-04-16 10:25:39","1452.78"
"grafana/loki","8dc9a9cd910cdfd096b40995cf56c36fd73bdc53","slim-bean","2020-06-04 13:09:11","true","docs: fix config error for new metrics in docs (#2163)",128,26,0,1,"2018-04-16 10:25:39","778.61"
"grafana/loki","ff59711a0242f5328e65d3771bc59877e9503b24","owen-d","2021-08-10 18:51:13","true","brief out of order docs (#4125)",114,40,0,1,"2018-04-16 10:25:39","1210.1"
"grafana/loki","116d61e198761b90a99332f08af1683e9f4cd1c9","kavirajk","2022-06-13 11:34:12","true","chore(jsonnet-lint): Make `promtail-mixin` depends on `loki-mixin` `main` version (#6379)

We had to change it to some older version to revert this PR
https://github.com/grafana/loki/pull/6377

Issue, context and long-term fix are explained in this
https://github.com/grafana/loki/issues/6378

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",69,50,0,1,"2018-04-16 10:25:39","1518.05"
"grafana/loki","a53ba0bb04488ca8fd465ef0030e98b6d7cbef14","cstyan","2022-08-01 07:13:40","true","populate the memberlist label by default (#6800)

Signed-off-by: Callum Styan <callumstyan@gmail.com>",77,51,0,1,"2018-04-16 10:25:39","1565.87"
"grafana/loki","7045c92086b5f82f0d1d758e830b091e47014bff","periklis","2021-05-22 05:46:12","true","Set lokistack condition failed/pending/ready based on pod status map (#53)",201,37,0,1,"2018-04-16 10:25:39","1131.56"
"grafana/loki","877f524c36bf23c1eebca712dff425c5146f5d03","slim-bean","2021-02-27 18:35:07","true","Loki: Revert reduce list operations and crash after timeout (#3396)

* revert: boltdbshipper: fix crash of ""timeout"" panic when boltdbshipper do init (#3369)

This appears to have introduced a different problem, still investigating.

* Revert ""reduce number of list calls on shared object store when using boltdb-shipper (#3283)""

This reverts commit 76e713f5",135,34,0,1,"2018-04-16 10:25:39","1041.84"
"grafana/loki","72b99243686e05dc85fd1abab92fe261ac61d02b","daixiang0","2019-04-09 02:24:37","false","Log error/debug info to stderr

Signed-off-by: Xiang Dai <764524258@qq.com>",100,12,0,0,"2018-04-16 10:25:39","352.67"
"grafana/loki","7109c56bdccc7c90e3f1fcdb16c8a586b3a773c6","jeschkies","2023-04-24 14:49:07","true","Use un-escaped regexp literal for string matching. (#9252)

**What this PR does / why we need it**:
The Regexp simplification would use the original string value instead of
the escaped literal. E.g. ``` | logfmt | level =~ `foo\.bar` ``` would
match the label `level` against `foo\.bar` and not `foo.bar`.

That is why the un-escaped literalt should be used in the equal and
not-equal matchers.

**Which issue(s) this PR fixes**:
Fixes #9111

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [x] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",80,60,1,1,"2018-04-16 10:25:39","1834.43"
"grafana/loki","22a1bd5f45b8fa200c30becdf7fdf4f61f343fe1","pracucci","2019-08-28 07:26:41","false","promtail: do not send the last batch - to ingester - if empty (#934)

* Do not send the last batch from promtail on graceful shutdown if the batch is empty

* Tested promtail Client.Handle()",121,16,0,0,"2018-04-16 10:25:39","497.13"
"grafana/loki","94041307b16745b42a00d4af2068ae8d7cb6050f","pracucci","2021-03-12 12:32:16","true","Upgrade Cortex (#3466)

* Upgrade Cortex

Signed-off-by: Marco Pracucci <marco@pracucci.com>

* Updated vendor/modules.txt

Signed-off-by: Marco Pracucci <marco@pracucci.com>",155,35,0,0,"2018-04-16 10:25:39","1056.59"
"grafana/loki","f70f9110aa954abe52eca34acdf1e52a114e2400","JStickler","2023-07-07 18:33:27","true","Update version in docker driver command. (#9870)

**Which issue(s) this PR fixes**:
Fixes #9802 

There is an 2.5 year old image in Docker Hub with the tag `latest`, so
updating the documentation to not reference this tag, as it pulls the
incorrect image.",58,63,1,0,"2018-04-16 10:25:39","1907.59"
"grafana/loki","bc7f7b5cef12094ef4af3ae0900c2878c8b3c396","blockloop","2021-03-25 15:13:51","true","make lint a non-requirement for specific make targets (#10)",144,35,0,0,"2018-04-16 10:25:39","1069.7"
"grafana/loki","0c6c3be77f5bd587f73e95d2c94d5211869b4874","daixiang0","2019-04-12 01:56:21","false","Update chart version

Signed-off-by: Xiang Dai <764524258@qq.com>",100,12,0,0,"2018-04-16 10:25:39","355.65"
"grafana/loki","9614b021d1b8ce72fc917581860dcc4bc8d87267","joe-elliott","2019-09-23 15:34:55","false","Loki HTTP/JSON Model Layer (#1022)

* First pass data model

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Use prom model b/c we're serializing promql objects

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Added legacy query support and tests

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Added legacy label test

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Added tail response marshalling and tests

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Fixed marshallers and test

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Expanded legacy test cases

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Dropped streams nano test

Signed-off-by: Joe Elliott <number101010@gmail.com>

* First pass v1 new objects

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Added failing tail response tests

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Added failing tailresponse test

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Partial v1 tests

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Improved legacy labels test

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Improved legacy query tests

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Moved all legacy tests to new method

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Added v1 tests and fixed stream marshalling bug

Signed-off-by: Joe Elliott <number101010@gmail.com>

* First pass new Model

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Added vector test

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Added matrix tests

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Added conversions for all things except tailed responses

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Fixed mixed case issues

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Fixed tail marshalling

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Removed unused testStream

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Moved TailResponse to loghttp

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Removed legacy tailresponse objects in favor of actual legacy tailresponse objects

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Updated v1 methods to take legacy tail objects

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Cleaned up tests.  Added some comments

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Versioned tail endpoint

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Improved readability on loghttp packages in http.go

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Removed new as a var name

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Started all error messages with lowercase alerts

Signed-off-by: Joe Elliott <number101010@gmail.com>

* new => ret

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Added comments on exported methods

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Removed two personal notes

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Changed legacy package name to loghttp

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Moved and renamed loghttp v1 package

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Moved marshalling code out of model

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Added package comments

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Added legacy testing

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Changed DroppedStream slice to value type for consistency

Signed-off-by: Joe Elliott <number101010@gmail.com>

* gofmt'ed test files

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Cleaned up linting issues

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Minor comment cleanup

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Adjusted GOGC to make CircleCI happy

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Changed legacy => loghttp for consistency

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Fixed matrix error message to be correct

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Moved label query over to loghttp response

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Added marshal loop tests

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Added response type test

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Fixed tail response marshal/unmarshal

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Passing unmarshal/marshal queryresponse tests

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Fixed vector and matrix

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Added output support for streams minus ordering

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Fixed tailing

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Fixed output tests

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Fixed query tests

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Order log output

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Use labels instead of stream

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Lowered parallelization for CircleCI

Signed-off-by: Joe Elliott <number101010@gmail.com>",67,17,0,0,"2018-04-16 10:25:39","522.46"
"grafana/loki","8646436b1825cd71c69070bf7891c94304f2b781","MasslessParticle","2022-01-27 14:26:40","true","Fix docker plugin build (#5240)

- Rebuild the rootfs before each plugin build",276,45,0,1,"2018-04-16 10:25:39","1376.92"
"grafana/loki","46cfdaede0c37b9f99cca2d8cd91d09a16a172f3","slim-bean","2020-04-27 11:36:47","true","Add a missing method to facade which is called by the metrics storage client in cortex (#1987)

Signed-off-by: Ed Welch <edward.welch@grafana.com>",115,24,0,1,"2018-04-16 10:25:39","741.55"
"grafana/loki","89985399817dde28fe5b94de990133d904bc3e5b","sapslaj","2023-08-04 00:19:29","true","lambda-promtail: Support AWS Organization CloudTrail (#10147)

**What this PR does / why we need it**:

The S3 object key for Organization CloudTrail events includes the org's
ID at the beginning. Currently, trying to ingest Organization CloudTrail
events with lambda-promtail fails due to the object key not matching the
regex. This PR adds support for both matching and parsing out that org
ID.

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

- instead of adding a new regex I just amended the existing regex just
to avoid too heavy of a refactor
- I also threw in error logging on the handler because that was
_invaluable_ debugging why lambda-promtail wasn't working in our
environment. I figure others might get some benefit from it.

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [x] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",52,64,1,0,"2018-04-16 10:25:39","1933.83"
"grafana/loki","75ef5c82c81ca503551b4971b95e2095aa88c157","adityacs","2020-03-02 15:00:21","false","Fix error in templating when extracted key has nil value",118,22,0,1,"2018-04-16 10:25:39","681.44"
"grafana/loki","a3fcd3cc759ef8f29be1d6abe8d6e2c8fecc334c","MichelHollands","2022-01-27 09:59:36","true","Update Go version to latest and bump build image version (#5250)

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",275,45,0,1,"2018-04-16 10:25:39","1376.73"
"grafana/loki","f1c1097bbe57f1bb0679d85f284ff363f43c958c","rfratto","2019-10-08 14:10:17","false","pkg/canary: use default HTTP client when reading from Loki

The documentation[1] for net/http.Client says the following:

  A Client is an HTTP client. Its zero value (DefaultClient) is a usable
  client that uses DefaultTransport.

  The Client's Transport typically has internal state (cached TCP
  connections), so Clients should be reused instead of created as needed.
  Clients are safe for concurrent use by multiple goroutines.

  A Client is higher-level than a RoundTripper (such as Transport) and
  additionally handles HTTP details such as cookies and redirects.

Canary was creating a new http.Client every time a query request was
made to Loki, causing a new TCP connection to be established each time.
If Loki has an outage, it's possible to get into a situation where all
websocket requests are failing and for a high volume of requests to go
through the normal query route. This can possibly lead to networking
issues like socket starvation.

[1]: https://golang.org/pkg/net/http/#Client",70,18,0,1,"2018-04-16 10:25:39","537.41"
"grafana/loki","aae92b9840c9a3ff9f478bc50750d8cc31032e75","JStickler","2023-07-21 21:19:40","true","[Docs] Create top-level Setup section  (#9974)

**Which issue(s) this PR fixes**:
Fixes #8712 

**Special notes for your reviewer**:
Move the following files under a new Setup section (with three
subsections: Install, Migrate, and Upgrade).

- ./sources/installation/sizing/index.md
- ./sources/installation/_index.md
- ./sources/installation/docker.md
- ./sources/installation/helm/_index.md
- ./sources/installation/helm/concepts.md
- ./sources/installation/helm/configure-storage/index.md
- ./sources/installation/helm/install-monolithic/index.md
- ./sources/installation/helm/install-scalable/index.md
- ./sources/installation/helm/migrate-from-distributed/index.md
- ./sources/installation/helm/migrate-to-three-scalable-targets/index.md
- ./sources/installation/helm/monitor-and-alert/index.md
- ./sources/installation/helm/reference.md
- ./sources/installation/helm/upgrade-from-2.x/index.md
- ./sources/installation/install-from-source.md
- ./sources/installation/istio.md
- ./sources/installation/local.md
- ./sources/installation/tanka.md
Updates cross-references broken by the move,
Updates file metadata (descriptions, weights) and adds aliases for
redirects to avoid 404s.
Probably fixes a couple of typos too.",55,63,1,0,"2018-04-16 10:25:39","1921.7"
"grafana/loki","1951eef914cfc8f83791426a49f9f8c894c0ab40","JStickler","2023-08-11 18:26:49","true","[Docs] Create top level Send data section, part 1 (#10192)

Part of the database information architecture Epic # 8710

**Which issue(s) this PR fixes**:
First half of work for issue # 8741

Move the following files under Send data:
/sources/clients/_index.md
./sources/clients/aws/_index.md
./sources/clients/aws/ec2/_index.md
./sources/clients/aws/ecs/_index.md
./sources/clients/aws/eks/_index.md
./sources/clients/docker-driver/_index.md
./sources/clients/docker-driver/configuration.md
./sources/clients/fluentbit/_index.md
./sources/clients/fluentd/_index.md
./sources/clients/k6/_index.md
./sources/clients/k6/log-generation.md
./sources/clients/k6/query-scenario.md
./sources/clients/k6/write-scenario.md
./sources/clients/lambda-promtail/_index.md
./sources/clients/logstash/_index.md

Updates the metadata (descriptions, weights)
Adds aliases to redirect from the old URLs.
Updates cross-references broken by the move/renaming.
A few other small fixes (headings, typos, etc.)

NOTE:The promtail files will move in a second PR.",52,64,1,0,"2018-04-16 10:25:39","1941.58"
"grafana/loki","334cc1e59a94e66868d7ce0253bcfec993a12db5","alrs","2020-09-14 12:51:11","true","pkg/storage/stores/shipper/uploads: fix test error (#2620)

Signed-off-by: Lars Lehtonen <lars.lehtonen@gmail.com>",115,29,0,0,"2018-04-16 10:25:39","878.6"
"grafana/loki","4030c12e17a9da58cfcffd0f156afb120e7f8139","cstyan","2022-08-01 07:11:45","true","only set the consul kvstore configs if memberlist is not being used (#6809)

Signed-off-by: Callum Styan <callumstyan@gmail.com>",77,51,0,1,"2018-04-16 10:25:39","1565.87"
"grafana/loki","86bc3c05186fc2b2aac65802530e9f98084581f0","cyriltovena","2019-07-08 17:59:23","true","Query label values and names are now fetched from the store. (#521)

* Query label values and names are now fetched from the store.

A time range is now required by the /api/prom/label with a sane default (6 hours from now).

* fix http querystring and update doc

* update vendor

* rebased",97,15,0,1,"2018-04-16 10:25:39","447.57"
"grafana/loki","0e53190e724d51b62c060f3452b1a380fac8a3cc","cyriltovena","2020-04-08 14:44:04","true","Add cap_net_bind_service linux capabilities to Loki. (#1916)

* Add cap_net_bind_service linux capabilities to Loki.

This allow Loki to bind to port below port 1024 without being a root user.
Also update tanka to use 80 as default port since this is more intuitive to remember.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Move setcap to build step

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Doesn't work inside the build step.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Set 3100 default port.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Again back to 80 :p

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",116,24,0,1,"2018-04-16 10:25:39","717.43"
"grafana/loki","a76a17877b2d36dd6578b92b8b6208d8817d7dd9","cyriltovena","2021-03-30 10:05:49","true","Add a target to reproduce fuzz testcase (#3553)

* Add a make target to facilitate fuzz testing locally.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* missing target....

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",142,35,0,1,"2018-04-16 10:25:39","1074.49"
"grafana/loki","959e275b4f158b93c045ff721ed4560f892329e8","kavirajk","2023-01-19 09:36:12","true","promtail: Fix title and image path on `logrotation` doc (#8208)

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

**What this PR does / why we need it**:
This fixes
1. Missing UI link to the side panel
2. Image paths


![Screenshot_2023-01-19_10-04-58](https://user-images.githubusercontent.com/3735252/213400320-66061f0d-dbbc-4024-a666-f2b0830f2227.png)

![Screenshot_2023-01-19_10-04-40](https://user-images.githubusercontent.com/3735252/213400323-b786765a-4c5d-4b23-ad98-70cec030a202.png)


**Which issue(s) this PR fixes**:
Fixes #NA

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>
Co-authored-by: Danny Kopping <danny.kopping@grafana.com>",84,57,1,1,"2018-04-16 10:25:39","1733.97"
"grafana/loki","4c9e4f5f0676097e5e5f53b224c38c27b0952e25","jeschkies","2021-11-19 07:41:25","true","Make `*` and `+` non-greedy to double regex filter speed. (#4775)

* Optimize regular expressions in filters.

* Run original RE2 tests.

* Run both tests.

* Update pkg/logql/log/filter.go

Co-authored-by: Bryan Boreham <bjboreham@gmail.com>

* Update pkg/logql/log/filter.go

Co-authored-by: Bryan Boreham <bjboreham@gmail.com>

* Fix tests.

* Format code.

Co-authored-by: Bryan Boreham <bjboreham@gmail.com>",204,43,0,1,"2018-04-16 10:25:39","1308.64"
"grafana/loki","8a9f519d8250c0642d22d7f6702de35e9136a895","MichelHollands","2023-05-31 08:13:45","true","Fix version number of helm chart (#9576)

**What this PR does / why we need it**:

There were 2 commits for the helm chart with the same version number. In
this case the build scripts only releases 1 new helm chart, containing
the first commit. This PR adds a new version so a helm chart will be
created that contains the later PR.

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [X] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",68,61,1,1,"2018-04-16 10:25:39","1871.16"
"grafana/loki","dfc0013163733201f8a232391c9c302cd0c248fa","low613","2023-11-06 21:21:33","true","Use correct plugin name for fluentbit ecs task (#11127)

**What this PR does / why we need it**:
Currently the docs suggest using the `loki` output plugin, however the
options provided align with the `grafana-loki` plugin

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)
- [ ] If the change is deprecating or removing a configuration option,
update the `deprecated-config.yaml` and `deleted-config.yaml` files
respectively in the `tools/deprecated-config-checker` directory.
[Example
PR](https://github.com/grafana/loki/pull/10840/commits/0d4416a4b03739583349934b96f272fb4f685d15)

Co-authored-by: J Stickler <julie.stickler@grafana.com>",9,67,1,0,"2018-04-16 10:25:39","2026.71"
"grafana/loki","e76047c077189feb00e6523aad5b427b75287236","tomwilkie","2018-05-16 14:55:14","false","Make queries work/

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",0,1,0,0,"2018-04-16 10:25:39","30.19"
"grafana/loki","259089fa1a7e3c542e551b130198a84fcf303021","tomwilkie","2018-04-16 12:01:09","false","Try using build image on gcr.",0,0,0,0,"2018-04-16 10:25:39","0.07"
"grafana/loki","3f161f5c1a17128c05dfdc88b230b5bc11172018","salvacorts","2023-07-21 09:41:58","true","Improve observability for non-indexed labels usage (#9993)

**What this PR does / why we need it**:
In https://github.com/grafana/loki/pull/9700, we support encoding and
decoding metadata for each entry into the chunks.
In this PR we:
- Update the bytes processed stats to account for the bytes from those
non-indexed labels
- Add new stats for bytes processed for those non-indexed labels
- Add new ingestion metrics to track ingested non-indexed bytes

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [x] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",57,63,1,1,"2018-04-16 10:25:39","1921.22"
"grafana/loki","6fb86c4def007e6cd8629aa49ed4e26ff79beaa4","irizzant","2022-05-17 07:26:44","true","fix(tanka): add customizable common env vars (#6124)

Signed-off-by: Ivan Rizzante <i.rizzante@gmail.com>",76,49,0,0,"2018-04-16 10:25:39","1491.88"
"grafana/loki","ab7854c3816f455eb118458fa07ee567b2a35ef4","periklis","2023-07-24 15:22:00","true","operator: Exit bundle action if uncommitted changes (#10013)",54,63,1,1,"2018-04-16 10:25:39","1924.46"
"grafana/loki","3cc024a591d65af60c6470915e5827aa1f038574","periklis","2021-06-08 11:17:35","true","Fix minor glitches and tidy modules (#61)",201,38,0,1,"2018-04-16 10:25:39","1147.79"
"grafana/loki","11f5218ebf1eefc2b34355b55b5a468c7c4ad0ce","cstyan","2023-05-12 21:31:33","true","Add docs/migration guide for zone aware ingesters (#9290)

This is migration guide is based on the internal migration guide we
created when migrating our own environments to zone aware ingesters.

We should probably structure some config documentation similar to
https://grafana.com/docs/mimir/latest/operators-guide/configure/configure-zone-aware-replication/
as well

---------

Signed-off-by: Callum Styan <callumstyan@gmail.com>",72,61,1,1,"2018-04-16 10:25:39","1852.71"
"grafana/loki","50533cbd519fa7968bb6370fa0be66778a6bb4a2","hervenicol","2022-06-14 12:59:56","true","Mixins templatize clusterlabel fixes (#6383)

* fix formating

* re-apply https://github.com/grafana/loki/pull/6353

* promtail-mixin: gitignore vendor/

* promtail-mixin: support for config

* mixins: improve config files

* re-trigger build

Co-authored-by: Herve Nicol <12008875+hervenicol@users.noreply.github.com>",67,50,0,0,"2018-04-16 10:25:39","1519.11"
"grafana/loki","084a0804f164487b41b023e5b4ba1c62254da328","simonswine","2022-04-29 13:00:36","true","docker-compose: Disable auth in Grafana (#5998)",93,48,0,0,"2018-04-16 10:25:39","1474.11"
"grafana/loki","1b251e54a48e0b5861d1e3f1d601ba90b5b9ba48","beorn7","2019-10-28 17:21:27","false","Simplify regexp's (#1202)

This is mostly to remove redundant anchoring (as it makes people
believe that Prometheus's regexp's aren't anchored by default, which
will backfire badly at some point), but it also removes useless
grouping (again to avoid confusion).

Signed-off-by: beorn7 <beorn@grafana.com>",70,18,0,0,"2018-04-16 10:25:39","557.54"
"grafana/loki","fd627f2a49d94b29091b12e461acb58335363d9e","periklis","2022-05-24 11:59:55","true","operator: Add rules support (#5986)",73,49,0,1,"2018-04-16 10:25:39","1499.07"
"grafana/loki","b2bfe53e3578b99967ce6725c001cce0a6b412b5","ashwanthgoli","2023-10-12 13:20:43","true","upgrade golang.org/x/net@v0.17.0 (#10872)

**What this PR does / why we need it**:
CVE-2023-39325 is fixed with golang.org/x/net@v0.17.0


```
❯ trivy i grafana/loki:main-98551ce-amd64

──────────────────┬────────────────┬──────────┬────────┬───────────────────┬───────────────┬──────────────────────────────────────────────┐
│     Library      │ Vulnerability  │ Severity │ Status │ Installed Version │ Fixed Version │                    Title                     │
├──────────────────┼────────────────┼──────────┼────────┼───────────────────┼───────────────┼──────────────────────────────────────────────┤
│ golang.org/x/net │ CVE-2023-39325 │ MEDIUM   │ fixed  │ v0.13.0           │ 0.17.0        │ rapid stream resets can cause excessive work │
│                  │                │          │        │                   │               │ (CVE-2023-44487)                             │
│                  │                │          │        │                   │               │ https://avd.aquasec.com/nvd/cve-2023-39325   │
└──────────────────┴────────────────┴──────────┴────────┴───────────────────┴───────────────┴──────────────────────────────────────────────┘
```

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",25,66,1,0,"2018-04-16 10:25:39","2002.37"
"grafana/loki","1d14ff0b1042f2059f4bda99bab00ffe4c897e10","alegmal","2021-06-07 07:19:27","true","Update _index.md (#3810)

duplicated word",201,38,0,0,"2018-04-16 10:25:39","1146.62"
"grafana/loki","5157a80ad1457070fec70b821b1cb613609811d0","periklis","2021-12-07 10:24:19","false","Switch license to AGPL v3",214,44,0,1,"2018-04-16 10:25:39","1326.75"
"grafana/loki","d36e11d04f846043d6b0d905965069cb34304ca4","jeschkies","2021-08-10 09:52:01","true","Document operation with the query scheduler. (#4100)

* Support Cortex Frontend V2.

* Format code.

* Start query scheduler in Docker compose.

* Model query flow in sequence diagram.

* Model calls to downstreamer.

* Move diagram to docs.

* Embed generated SVG.

* Descripe calls.

* Launch Cortex query scheduler.

* Disable sharding for now.

* Log which framework is used.

* Configure querier to use scheduler.

* Remove unwanted docs.

* Enable query splitting again.

* Document scheduler address.

* Document new scheduler options for frontend as well.

* Document operation with the query scheduler.

* Replace Cortex with Loki image.

* Remove unused Corte config.

* Correct merger errors.

* Clear up confusing sentence.

* Update docs/sources/operations/scalability.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>",113,40,0,1,"2018-04-16 10:25:39","1209.73"
"grafana/loki","dcd2d06823e2e0a1491fa3610b50eda3212d3490","xperimental","2022-10-04 07:48:21","true","operator: Add extended-validation for rules on OpenShift (#7295)",92,54,1,1,"2018-04-16 10:25:39","1628.89"
"grafana/loki","1375fa0654083e26baeafa2d2cc107c4d19f833a","kavirajk","2023-01-02 14:14:07","true","chore(promtail): Make `batchwait` and `batchsize` config explicit with yaml tags. (#8027)

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

**What this PR does / why we need it**:
These configs can be used via `batchwait` and `batchsize` keys in yaml.
This PR just makes it explicit via yaml tags.

**Which issue(s) this PR fixes**:
Fixes #NA

**Special notes for your reviewer**:
We already have test to cover those keys.

https://github.com/grafana/loki/blob/kavirajk%2Fbatch-configs-make-yaml-explicit/clients/pkg/promtail/client/config_test.go#L28-L29

Also we have config pages for those keys.

https://grafana.com/docs/loki/latest/clients/promtail/configuration/#clients

**Checklist**
- [x] Reviewed the `CONTRIBUTING.md` guide
- [x] `CHANGELOG.md` updated

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",99,56,1,1,"2018-04-16 10:25:39","1717.16"
"grafana/loki","88c4781dc72b410a30e054f82d2c4aad0558afbb","DylanGuedes","2022-04-27 17:51:06","true","Revendor `grafana/tail` to fix promtail symlink behavior (#6034)

* Revendor grafana/tail.

- This revendoring brings the fix to relative symlinks, as described in
  https://github.com/grafana/loki/issues/3374.

* Prune package from `go mod tidy`.

* noop",173,48,0,1,"2018-04-16 10:25:39","1472.31"
"grafana/loki","dc9ca8e19a8f18ed5c9a3385cf1125c42b268d16","owen-d","2023-04-17 22:30:16","true","Tools/index analyzer (#9074)

Adds a tool that allows downloading and querying statistics across TSDB
indices.

Example output:
```
analyzed 1046302 series and 7607495 chunks for an average of 7.270841 chunks per series. max chunks/series was 45695. number of series with over 1k chunks: 15
```

---------

Signed-off-by: Owen Diehl <ow.diehl@gmail.com>",83,60,1,1,"2018-04-16 10:25:39","1827.75"
"grafana/loki","83873d1c6f8e497b69d130815fb83b21fe4eda67","adityacs","2020-05-08 14:22:33","true","Fix promtail client default values (#2049)",115,25,0,1,"2018-04-16 10:25:39","752.66"
"grafana/loki","7bec727c6dff8e6268f9a8f9b64fee725d4195f8","rfratto","2023-04-12 18:52:13","true","promtail: support configurable polling interval (#8874)

Currently, Promtail always polls files every 250ms. This PR allows the
polling period to be customized, starting at a minimum polling period
and exponentially increasing the polling frequency to a bounded maximum
if the file has no changes.

When file changes are detected, the polling frequency resets to the
minimum.

The default behavior is the existing behavior; both the minimum and
maximum polling intervals are set to 250ms.

I'm opening this in draft to get early feedback. There's a few open
questions:

* Where can I add validations to ensure that the min/max polling
intervals are configured properly?
* Is this the right approach for implementation? Do I need to make any
changes?
* Does this need tests? 

I'll update the CHANGELOG and Documentation after we're agreed on an
approach.",83,60,1,1,"2018-04-16 10:25:39","1817.35"
"grafana/loki","f6be636e13a4312db91805db73e9108b2f2bff8f","pstibrany","2019-12-13 11:37:14","false","RangeQuery benchmark optimizations (#1413)

* Added some duplicate streams.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Instead of using sort.Sort(), we keep tuples sorted already.

Also just return first element if there is only one tuple.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Don't do time comparison twice, compare nanoseconds instead.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>",95,20,0,0,"2018-04-16 10:25:39","602.3"
"grafana/loki","27479484f8258915b6a767979890f10422bcf32b","Red-GV","2022-03-17 18:32:52","true","operator: Adding instructions to respond to alerts (#5579)",308,47,0,1,"2018-04-16 10:25:39","1427.09"
"grafana/loki","fce2b3cc7e4abfa4d3eec4a9684a7cdece8f2a6c","agrahamlincoln","2023-05-25 08:09:00","true","Helm: Quote tenantId value in logsInstance (#9486)

**What this PR does / why we need it**: Quotes the value of `tenantId`
for the cases where tenantId is made up of only numerical values (i.e.
if tenantId is `0`)

the motivation for this is that we have long used the tenant id `0` in
our loki instance for some stuff. We probably should fix that, but it's
going to be easier (at least for us) to patch this than to rename this
tenant or migrate to a new tenant.

**Which issue(s) this PR fixes**:
N/A - If you'd like me to file an issue to track this there as well, let
me know and i'll write one up. i figured this fix was simple enough

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [x] Tests updated
- [x] `CHANGELOG.md` updated
- [x] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",68,61,1,0,"2018-04-16 10:25:39","1865.16"
"grafana/loki","414f5d2d2114a4d66a6d95b101ed8252f7a0f718","blockloop","2021-04-14 19:09:33","true","update readme with some instructions for development (#22)",157,36,0,0,"2018-04-16 10:25:39","1088.86"
"grafana/loki","c9ef0621d13f00c73df0cd56f76d3966bdf3abb7","thepalbi","2022-08-02 16:35:19","true","Promtail: Add new target for receiving GCP PubSub Push messages (#6777)",76,51,0,0,"2018-04-16 10:25:39","1567.26"
"grafana/loki","3b66d94e0f3e52d8eb24150f7ca4de367ec07d2a","rsteneteg","2021-11-03 18:26:35","true","resolve issue with promtail not scraping target if only path changed in a simpler way that dont need mutex to sync threads (#4599)

Signed-off-by: Roger Steneteg <rsteneteg@ea.com>",171,42,0,0,"2018-04-16 10:25:39","1293.08"
"grafana/loki","6c0f3442cce0e186cd6eab73f1acf36e3e713582","dannykopping","2023-03-07 07:40:26","true","Tools: add tool to determine which release (if any) a commit appears in (#8706)

I've often found myself needing to determine which release a particular
PR appears in. This tool makes that easy, and it accepts the merge
commit ref of the PR.

Example from https://github.com/grafana/loki/pull/7044, in which [a user
is asking which version this feature appears
in](https://github.com/grafana/loki/pull/7044#issuecomment-1455694087).

```bash
$ ./tools/which-release.sh 93a5a71                                 
Commit was found in the following releases:
  release-2.7.x
```",83,59,1,1,"2018-04-16 10:25:39","1781.89"
"grafana/loki","b709b32d6a6ce093056635df363bb64569a7191d","CCOLLOT","2023-05-30 08:52:45","true","feat(lambda-promtail): add cloudtrail log ingestion support (#9497)

**What this PR does / why we need it**:
### Add support for AWS CloudTrail audit logs ingestion using
lambda-promtail

Calls to AWS APIs are logged in AWS Cloudtrail and are helpful for
security and debugging purposes. However, I've experienced difficulties
with it:
+ The AWS CloudTrail service is not well integrated with Prometheus (no
metrics, no alerts) and I don't want to manage alerts in CloudWatch
Alerts
+ The search experience is painful with CloudTrail via the AWS Console
(I will not elaborate 😅).

This PR allows ingesting CloudTrail audit logs sent to an S3 bucket
using the same approach as VPC flow logs or Load Balancer logs.

**Special notes for your reviewer**:

+ Because the Cloudtrail file format is not text but json, we stream the
json CloudTrail records instead of using the already existing scanner.
+ Because the Cloudtrail filename format is not the same as for the Flow
log or the Load balancer log files, we need to split the regexes by
service (although many AWS services seem to share the same
`defaultFilenameRegex`).
+ In the `getLabels` function, we expect the `type` parameter to be
found in the filename using the Regex. For some log files (ex:
Cloudfront log files). The file name has no reference to the service
name. This is why, as a default, when no type is found in the name of
the file, I set it to use the key of the matching Regex expression.

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [x] Tests updated
- [x] `CHANGELOG.md` updated
- [x] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",70,61,1,0,"2018-04-16 10:25:39","1870.19"
"grafana/loki","b5e632f62cc26da311257e5248929e12e7da4b3e","daixiang0","2019-04-11 15:56:03","false","Remove useless func (#472)

Remove useless func

No one called this func, keep it only mislead.

Signed-off-by: Xiang Dai <764524258@qq.com>",99,12,0,0,"2018-04-16 10:25:39","355.23"
"grafana/loki","cb4f5b4bd247e69f9cf50fed8b7f3af0a69e55ba","putrasattvika","2019-11-05 17:22:38","false","fluent-plugin: Add client certificate verification (#1189)

* fluent-plugin: Add client certificate verification

* use OpenSSL::PKey.read to read private key

* remove gem file",66,19,0,0,"2018-04-16 10:25:39","564.54"
"grafana/loki","5026dfea576902f4ba2738f0b3282155e987511d","owen-d","2020-01-23 15:57:33","false","ingester.max-chunk-age (#1558)

* ingester.max-chunk-age

* bumps helm & changelog

* adjusts max-chunk-age test

* bumps wait period to let ci catch up

* updates changelog",98,21,0,1,"2018-04-16 10:25:39","642.48"
"grafana/loki","78c6aa49b4b4ae6f47ca8f0869df93675d4750bc","slim-bean","2019-08-13 21:18:13","true","feat(ksonnet): make our ksonnet a little more modular by parameterizing the chunk and index stores (#874)",103,16,0,1,"2018-04-16 10:25:39","482.7"
"grafana/loki","c8760f31e26acfe575d2f1e71ce6044c69606ca4","slim-bean","2023-01-20 15:57:46","true","Loki: Remove validation of matchers when performing label values lookup. (#8224)

the curren validation fails on != style matchers when they are the only
matchers present, requiring at least one `=` matcher.

However for looking up label values in TSDB, by design it uses a
`desired_label != """"` style query, as such it should be allowed to also
include these as matchers.

Additional matchers on this Label Value queries typically only exist
with LBAC headers adding additional labels.

Signed-off-by: Edward Welch <edward.welch@grafana.com>

**What this PR does / why we need it**:

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

Signed-off-by: Edward Welch <edward.welch@grafana.com>
Signed-off-by: Christian Haudum <christian.haudum@gmail.com>
Co-authored-by: Owen Diehl <ow.diehl@gmail.com>
Co-authored-by: Danny Kopping <danny.kopping@grafana.com>
Co-authored-by: Christian Haudum <christian.haudum@gmail.com>",83,57,1,1,"2018-04-16 10:25:39","1735.23"
"grafana/loki","97837579323e3088e393ad7f09539465306c7860","salvacorts","2023-04-12 16:27:10","true","Proportional TSDB index stats for chunks partially fitting in queried time range. (#9096)

**What this PR does / why we need it**:

When computing index stats for a query, we sum up the stats from all the
chunks the query would read, even if some chunks will only be read
partially.

Moreover, if the query spans across two different TSDB tables, and there
are chunks duplicated on both tables (at the end of the first one and at
the beginning of the next one), the chunks' stats will be counted twice.

This PR improves how we compute stats by taking care of partially
matching chunks. Assuming entries and bytes are evenly distributed in
the chunk, we will take the proportional number of entries and the
number of bytes that fit on the span.

For example, a chunk spans from t1 to t10 and has 10 entries and 10 KBs.
A query from t3 through t7 would hit 50% of the chunk time span.
Therefore, we estimate that the query would load 5 KBs and 5 entries
from the chunk.

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [x] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",83,60,1,1,"2018-04-16 10:25:39","1817.25"
"grafana/loki","fcf198e701f9e0c922278de236be12ca7e15b763","MichelHollands","2023-01-11 16:56:22","true","Add drone env vars to test output to distinguish the 2 unit test runs. (#8093)

**What this PR does / why we need it**:

Add the drone step name and branch to the test output. These are used to
distinguish between the two unit tests runs in a drone build. One unit
test run is for the current branch, the other is for the branch to be
merged to. This change helps in not reporting the unit tests results
twice.

There is also a fix for the TestPromtail test. The missing newline made
the test reporting fail.

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",101,57,1,1,"2018-04-16 10:25:39","1726.27"
"grafana/loki","8a1f4e190d4ac1dc82d34cef19096731b6d61e18","gouthamve","2018-07-09 10:59:22","false","Fix broken test.

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>",5,3,0,0,"2018-04-16 10:25:39","83.02"
"grafana/loki","25163470b0b861d5c539b66a4c5613e46666e0c8","cstyan","2021-09-30 12:54:28","true","Improve error message for stream rate limit. (#4207)

* Improve error message for stream rate limit.

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* Move stream rate limit error message to validation package.

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* Use ByteSize for number values in stream rate limit error so we can
print human readable rate limits and log line byte lengths.

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* Fix lint issues.

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* Don't need to type assert twice.

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* Compare errors contents instead of doing error equals comparison
directly since the rate limit error is an RPC error.

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* Don't call Limit on hot path just to log the value in errors.

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* Make coment about rate limit clearer.

Signed-off-by: Callum Styan <callumstyan@gmail.com>",139,41,0,1,"2018-04-16 10:25:39","1259.85"
"grafana/loki","f8700e4d01e25a7bd5e8cc591b7037cc9cbf11fc","periklis","2021-04-27 19:12:07","true","Streamline API terms based on enhancement proposal (#37)",175,36,0,1,"2018-04-16 10:25:39","1107.12"
"grafana/loki","bd23b2b46ced22d2f73f6268d2eb74739e3ad9df","MichelHollands","2023-02-02 15:08:00","true","Add table of Loki versions in helm chart (#8383)",79,57,1,1,"2018-04-16 10:25:39","1747.2"
"grafana/loki","38f52e416003f7453f558c24657f7606e6dc90c4","daixiang0","2018-12-29 18:00:38","false","add comment for go get (#189)

Signed-off-by: Xiang Dai <764524258@qq.com>",55,8,0,0,"2018-04-16 10:25:39","253.32"
"grafana/loki","880725f268f5a5dc321304767a579790147eb09a","woodsaj","2019-01-17 11:28:15","false","Fluentd plugin (#210)

* add beginnings of fluentd plugin

* working fluentd output plugin for loki

* refactor fluentd plugin

- update the plugin to support extra_labels, label_keys, line_format
  and drop_single_key options
- update rspec tests
- update readme
- build custom docker image for docker-compose
- default to systemd input by default.

* update readme todo section

* remove extra license file",63,9,0,0,"2018-04-16 10:25:39","271.04"
"grafana/loki","6d822928b48be8a47f01275e41a7657e03ab8c0b","DylanGuedes","2023-11-03 11:51:43","true","Jsonnet: Fix unit used by per-pod latency panel (#11104)

**What this PR does / why we need it**:
The per-pod latency panel should use ""ms"" as the unit, instead of the
default (which is ""short"").
I'm also wrapping everything around ""defaults"", because that's how it is
used everywhere.

**Which issue(s) this PR fixes**:
N/A",11,66,1,1,"2018-04-16 10:25:39","2023.31"
"grafana/loki","300bb267e96cfa9a3d8ca297c3ebad23c82d0b47","ashwanthgoli","2023-10-17 07:03:52","true","[Post release] release-2.9.2: update changelog (#10918)

**What this PR does / why we need it**:
Update the changelog on main to reflect 2.9.2 changes

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",23,66,1,0,"2018-04-16 10:25:39","2007.11"
"grafana/loki","65bef5c360b31f091523e8fcb59b89b8b2cf6025","nervo","2023-01-18 23:28:23","true","Helm: Fix components notes (#8194)

Add component `backend` in the list of installed components on helm
notes, based on `read.legacyReadTarget` value, just like backend
statefulset.",85,57,1,0,"2018-04-16 10:25:39","1733.54"
"grafana/loki","b523ff336e91e1e8a607073551b8a3525b6ba917","trevorwhitney","2022-10-31 14:45:52","true","[Helm] Fix invalid ruler config when filesystem storage is used (#7528)

**What this PR does / why we need it**:

When using filesystem storage, there's a bug in the configmap helm
template that sets `ruler.storage` to `null`. This fixes that bug.

**Which issue(s) this PR fixes**:
Fixes #7267",90,54,1,1,"2018-04-16 10:25:39","1656.18"
"grafana/loki","df898593697abce70802f18d95a72da9b84c4590","danieldabate","2019-12-03 16:04:32","false","HTTP API: Support duration and float formats for step parameter (#1355)

* Support duration and float formats for step parameter in http api

* Support Prometheus duration format and add missing tests

* Fixes linter

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",90,19,0,0,"2018-04-16 10:25:39","592.49"
"grafana/loki","94725e79084aff513b39d9aa42fafa45d6dfe706","jeschkies","2023-03-23 16:03:16","true","Define `RequiredLabels` query limit. (#8851)

**What this PR does / why we need it**:
Some end-users can impose great workload on a cluster by selecting too
many streams in their queries. We should be able to limit them.

Therefore we introduce a new limit `RequiredLabelMatchers` which list
label names that must be included in the stream selectors.

The implementation follows the same approach as for max query limit.

**Which issue(s) this PR fixes**:
Fixes #8745

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [x] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",83,59,1,1,"2018-04-16 10:25:39","1798.23"
"grafana/loki","28009050b40e574ccdf559e0570e131a1e4b5231","slim-bean","2019-12-04 15:10:19","true","Update changelog for 1.1.0 release (#1360)

* Update changelog for 1.1.0 release",92,19,0,1,"2018-04-16 10:25:39","593.45"
"grafana/loki","ae87c90bc3e78d3cafbd4c71d587f97715b6c75c","slim-bean","2021-09-06 19:06:52","true","Build: update stalebot message to be more descriptive and friendlier (#4252)

* Build: update the stalebot message to be more descriptive and friendly.

* Update .github/stale.yml

Co-authored-by: Danny Kopping <danny.kopping@grafana.com>

* Update .github/stale.yml

Co-authored-by: Danny Kopping <danny.kopping@grafana.com>

Co-authored-by: Danny Kopping <danny.kopping@grafana.com>",121,41,0,1,"2018-04-16 10:25:39","1236.11"
"grafana/loki","8628b15624e0c1f5cd730cc9ee585416926c09c3","MichelHollands","2023-10-30 14:57:06","true","Use metrics namespace for more metrics (#11025)

**What this PR does / why we need it**:

Use the metrics namespace setting instead of hardcoding to `cortex`.
This is a follow up to (and based on)
https://github.com/grafana/loki/pull/11014.

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [X] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)
- [ ] If the change is deprecating or removing a configuration option,
update the `deprecated-config.yaml` and `deleted-config.yaml` files
respectively in the `tools/deprecated-config-checker` directory. <!--
TODO(salvacorts): Add example PR -->

---------

Signed-off-by: Michel Hollands <michel.hollands@gmail.com>
Co-authored-by: Ashwanth <iamashwanth@gmail.com>",17,66,1,1,"2018-04-16 10:25:39","2020.44"
"grafana/loki","3edcda744e6cbf2e9044d3e1a65b96880ac0ce06","kavirajk","2021-01-05 10:11:45","true","mention the use of `config.expand-env` flag in the doc. (#3078)",114,33,0,1,"2018-04-16 10:25:39","989.49"
"grafana/loki","7e3d2433ed5745bb5b6a47ca36dc478b71de51f0","kavirajk","2022-08-09 10:49:32","true","embedded-cache: Bring `fifocache` and `groupcache` into single tent. (#6821)

* chore(groupcache): Rename groupcache into memcache{distributed: true}

1. Introduced new config called memorycache config.
2. It has flag `distributed`. By enabling it, we use groupcache

Going forward. We will bring fifocache into memcache config(with distributed:false)

This PR is just a POC. To show how we can simplify in-built memory cache config and bring it into single config.

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Memorycache -> EmbeddedCache

* Bring fifocache into embeddedcache tent

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Fix edge case with enabling fifocache

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Fix missing flags for embedded cache

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Add changelog

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Warning message for fifocache config

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Make linter happy

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Fix listenport issue

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* idk. review remarks

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* PR remarks
1. update changelog and upgrade guide
2. s/Embeddedcache/EmbeddedCache/g
3. /groupcache/ handler -> /embedded-cache/
4. some typos
5. Fix some cache prefixes

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Fixing corresponding tests

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Support extra timeouts on embedded-cache

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Remove unwanted single struct field

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* fix(stats-collector): Let cache.New() wrap stats collector for distributed cache

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* PR remarks

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Deprecate max_size_items from fifocache

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* PR remarks about the flag description

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Update docs/sources/upgrading/_index.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>",74,52,0,1,"2018-04-16 10:25:39","1574.02"
"grafana/loki","c129cfe93c65430b178108928f66904d4c743774","dapeleg-dn","2023-07-06 13:36:46","true","Docs: add reference to flog CLI args (#9638)

**What this PR does / why we need it**:

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",57,63,1,0,"2018-04-16 10:25:39","1906.38"
"grafana/loki","bd4d516262c107a0bde7a962fa2b1e567a2c21e5","owen-d","2020-04-20 16:06:54","true","chunk bounds metric now records 8h range in 1h increments (#1964)",114,24,0,1,"2018-04-16 10:25:39","734.74"
"grafana/loki","03531f5013ec49b57342872d83f059088016534b","owen-d","2023-04-25 05:48:24","true","start writing tsdb v3 (#9276)",78,60,1,1,"2018-04-16 10:25:39","1835.06"
"grafana/loki","2107148acd4157880d49275bcebb84e30ea395ba","owen-d","2021-07-19 14:21:28","true","fixes chunk size method in facade (#3981)",105,39,0,1,"2018-04-16 10:25:39","1188.91"
"grafana/loki","8aaf5c10a8224ddedce39b7daed0e7be7cdf9830","trevorwhitney","2023-07-24 15:04:56","true","add stats, volume, and volume_range commands to logcli (#9966)

Add `stats`, `volume`, and `volume_range` commands to `logcli`.

Does not implement the file client for now. I think it would be cool if
in the future the file client could read from a downloaded TSDB index
file for these commands.",54,63,1,1,"2018-04-16 10:25:39","1924.44"
"grafana/loki","6a473a8407a80f33cfd022fdf8fb5d3875815648","JStickler","2023-01-23 21:40:56","true","[Docs] Adding context to Istio installation. (#8248)",83,57,1,0,"2018-04-16 10:25:39","1738.47"
"grafana/loki","76b0fc566394604ae941d181e94791463753bdd8","Red-GV","2022-04-04 12:56:13","true","operator: Update Prometheus go client to resolve CVE-2022-21698 (#5748)",319,47,0,1,"2018-04-16 10:25:39","1443.85"
"grafana/loki","f1bbdc51dcfbc4294b4d7ea3802e78189b0af1b2","shantanualsi","2023-08-30 14:29:58","true","Remove split_queries_by_interval and forward_headers_list (#10395)

…range config
Removed split_queries_by_interval and forward_headers_list from
query_range config

The fields were deprecated and hence going to be removed in the next
major version

**What this PR does / why we need it**:

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [x] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",45,64,1,0,"2018-04-16 10:25:39","1960.42"
"grafana/loki","94dd7565c3dc2c283f0fc2b9248059b8079f4217","PabloCastellano","2020-01-31 19:41:38","true"," Recommend using the latest schema version (v11) (#1608)",102,21,0,0,"2018-04-16 10:25:39","650.64"
"grafana/loki","f58a14fab1067a0eb5a35a32b3d9f39d2214cb25","SadFaceSmith","2022-06-01 11:25:18","true","Snyk SBOM workflow add (#6274)

* Snyk SBOM workflow add

* Update snyk.yml",72,49,0,0,"2018-04-16 10:25:39","1506.04"
"grafana/loki","0a2640a50857ae04fffa7f074df6cc4873c8e400","DanCech","2018-12-05 19:54:45","true","fix typo in README",6,8,0,0,"2018-04-16 10:25:39","229.4"
"grafana/loki","a4b897482b319970fe1ea5c6133be66454881ff9","kavirajk","2021-09-08 09:04:15","true","Add custom UnmarshalJSON for bytesize type (#4289)

* Add custom UnmarshalJSON for bytesize type

* Add more test case

* Fix limits test",126,41,0,1,"2018-04-16 10:25:39","1237.69"
"grafana/loki","1389857846eac10f0b2faf55526406003af976cd","kavirajk","2022-05-04 12:46:05","true","`metrics.go` support for metadata queries(labels and series) (#5971)

* Add different functions to record labels and series queries

* Add tests for logging series and labels queries

* Add statistics to the Series and Labels proto response types

* Plug in the statistics recorder on the query handler

* Remove duplicate imports and cleanup comments

* Remove the need to add usage statistics for metadata queries.

* Add status based on returned error from the api

* Fixing lint error by fixin return values order

* Use explicit logger

* Remove unused recorders

* Add `total_entries` representing length of total result returned

* Inject statscollector middleware for metadata queries

* Fix query frontend stats middleware

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Fix tests with change in extra `totalEntriesReturned` field

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* `make check-generated-files`

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Fix typo

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Fix tripperware middleware for label values endpoint

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Fix bug with label extraction

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Add changelog entry

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Fix `total_entries` value for range query

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",76,49,0,1,"2018-04-16 10:25:39","1479.1"
"grafana/loki","eb7fbfe0b43d3a9c1556e2061f53ae3aa58d7e33","MasslessParticle","2022-12-01 20:31:37","true","Improve ratestore performance (#7810)

This PR changes the Rate Store to use multi-level maps rather than
`tenant+stream-fingerprint` key.

Benchmarks:

*old*
```
goos: linux
goarch: amd64
pkg: github.com/grafana/loki/pkg/distributor
cpu: 11th Gen Intel(R) Core(TM) i7-1165G7 @ 2.80GHz
BenchmarkRateStore-8         117          10420080 ns/op         3201761 B/op     200025 allocs/op

PASS
ok      github.com/grafana/loki/pkg/distributor 14.646s
```

*new*
```
goos: linux
goarch: amd64
pkg: github.com/grafana/loki/pkg/distributor
cpu: 11th Gen Intel(R) Core(TM) i7-1165G7 @ 2.80GHz
BenchmarkRateStore-8         320           3811906 ns/op            2660 B/op         26 allocs/op
```

*stats*
```
name         old time/op    new time/op    delta
RateStore-8    10.7ms ± 8%     4.1ms ± 8%  -61.42%  (p=0.000 n=10+10)

name         old alloc/op   new alloc/op   delta
RateStore-8    3.20MB ± 0%    0.00MB ± 0%  -99.92%  (p=0.000 n=8+9)

name         old allocs/op  new allocs/op  delta
RateStore-8      200k ± 0%        0k ± 0%  -99.99%  (p=0.000 n=9+10)
```",92,55,1,1,"2018-04-16 10:25:39","1686.42"
"grafana/loki","0adf27df3e4fe8e673f90d056142a9e4cb9755bc","dannykopping","2023-05-03 09:34:07","true","Adding CHANGELOG entry missed in #9370 (#9376)

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",80,61,1,1,"2018-04-16 10:25:39","1843.21"
"grafana/loki","52312cac78a207b29c260f187f0d55357437e39e","dannykopping","2022-03-01 10:23:21","true","CI: moving autodeploy configuration secret to new location (#5491)

* Moved autodeploy configuration into common so Loki team can access & modify the secret

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* make drone

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",300,46,0,1,"2018-04-16 10:25:39","1410.75"
"grafana/loki","cb798635f5e7241f36517ae89ce764c13729f130","slim-bean","2020-02-05 19:31:30","true","Improve promtail configuration docs (#1602)

* fixing the promtail stage name docs to match their actual stage names, added the docker and cri stages, clarified and improved the examples a little.

Signed-off-by: Edward Welch <edward.welch@grafana.com>

* fixing newlines

Signed-off-by: Edward Welch <edward.welch@grafana.com>

* Update docs/clients/promtail/configuration.md

Co-Authored-By: Robert Fratto <robert.fratto@grafana.com>

* Update docs/clients/promtail/configuration.md

Co-Authored-By: Robert Fratto <robert.fratto@grafana.com>

* addressing feedback

Signed-off-by: Edward Welch <edward.welch@grafana.com>

Co-authored-by: Robert Fratto <robertfratto@gmail.com>",110,22,0,1,"2018-04-16 10:25:39","654.63"
"grafana/loki","31bae5af4c50d94d9a32dc78c8a838bba62fc4d9","kavirajk","2023-07-24 12:30:58","true","chore(loki): Enable `auto-merge` of `dependabot` pr(s) (#10029)

**What this PR does / why we need it**:
This just enables ""auto-merge"" and PR is still merged only after all the
checks are passed.

Also related #10025 

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

Main rationale here is keep loki dependencies up to date and avoid
frequent toil of needing manual work to merge dependabot PR.

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",54,63,1,1,"2018-04-16 10:25:39","1924.34"
"grafana/loki","5d441b5526c9d36dea23e624b9df737f8fb9c6fc","besteban1989","2022-10-05 15:02:47","true","Service selector for single binary deployment fix. (#7301)

Single binary deployment is not working when going through default
service. The issue is with the labels that currently includes the canary
pods.

Fixes #7260",94,54,1,0,"2018-04-16 10:25:39","1630.19"
"grafana/loki","3bd725e826a9adde008bac8f9849a096e4b589ac","cyriltovena","2021-02-02 16:34:16","true","Fixes logfmt parser hints. (#3279)

Recently introduce a bug where label where tested for extraction against non sanitized version.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",122,33,0,1,"2018-04-16 10:25:39","1016.76"
"grafana/loki","46eff3c12cc0170c21905b783c90e8a1653a4b83","wardbekker","2021-04-08 17:36:14","true","Added Architecture Diagram (#3526)

* Added Architecture Diagram

* Update _index.md

* Rename LokiArchitectureDiagram.svg to loki_architecture_components.svg",154,36,0,0,"2018-04-16 10:25:39","1082.8"
"grafana/loki","f1b8d4d8ad05fce640e373fa0527b56d23609bd2","cyriltovena","2020-01-24 20:25:12","true","Improve logql query statistics collection. (#1573)

* Improve logql query statistics collection.
This also add information about ingester queries.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Improve documentation.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes bad copy/past in the result log.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes ingester tests.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Improve headchunk efficiency.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fix bad commit on master.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes new interface of ingester grpc server.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Improve documentations of fields.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",98,21,0,1,"2018-04-16 10:25:39","643.67"
"grafana/loki","7edda371eae0e0a2535791ace6c87d7670cee925","JordanRushing","2023-04-11 18:49:57","true","Add journald support to Promtail amd64 binary builds (#9095)

**What this PR does / why we need it**:

Previously, in https://github.com/grafana/loki/pull/8131, we enabled
journald support for Promtail arm/arm64 binary builds but not amd64.

**Which issue(s) this PR fixes**:

- https://github.com/grafana/loki/issues/9060

**Special notes for your reviewer**:

N/A

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

---------

Signed-off-by: JordanRushing <rushing.jordan@gmail.com>
Co-authored-by: Trevor Whitney <trevorjwhitney@gmail.com>",82,60,1,0,"2018-04-16 10:25:39","1816.35"
"grafana/loki","9ff621825ac46b79caf792b6a831e56e8de53a30","simonswine","2022-06-16 14:52:44","true","Parallize label queries to both stores (#5997)

* Parallize label queries to both stores

This executes label queries against ingesters and store in parallel,
rather than sequentially

* Return err without any checks as suggested",67,50,0,0,"2018-04-16 10:25:39","1521.19"
"grafana/loki","f24b84c15a86374507de6b789a957575c446cca7","cstyan","2022-01-25 12:20:46","true","[querier] Abort a query in limitedRoundTripper if parallelism is 0 (#5190)

* Abort a query in limitedRoundTripper if parallelism is 0.

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* Fix failing tests related to fakeLimits change.

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* Change limitedRoundTripper parallelism error message.

Signed-off-by: Callum Styan <callumstyan@gmail.com>",272,45,0,1,"2018-04-16 10:25:39","1374.83"
"grafana/loki","38556c1d373fe02938622ba4353400247e567160","periklis","2023-08-09 12:07:49","true","operator: Add support for reconciling loki-mixin dashboards on OpenShift Console (#9468)

Co-authored-by: Robert Jacob <xperimental@solidproject.de>",53,64,1,1,"2018-04-16 10:25:39","1939.32"
"grafana/loki","68fa134c3b8adf6d1e58360112744d0d7bbc4494","periklis","2023-04-05 12:43:46","true","operator: Align common instance addr with memberlist advertise addr (#8958)",82,59,1,1,"2018-04-16 10:25:39","1810.1"
"grafana/loki","56bf3a49a2ee80f320396c7cd3ef4174cdc2688f","headcr4sh","2022-06-30 08:48:16","true","Fix documentation of environment variable defaults (#6536)

For some reason, the `-` character was missing here in the documentation.
After struggling for some time, I finally figured out that -- quite obviously -- envsubst default behavior applies and thus the documentation was wrong. :-)",73,50,0,0,"2018-04-16 10:25:39","1534.93"
"grafana/loki","00bd6cc1a24b199461f790a63759bfd3b8849d01","dannykopping","2022-02-16 15:33:37","true","Run `make drone` to use the new build image (#5368)

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",292,46,0,1,"2018-04-16 10:25:39","1395.96"
"grafana/loki","7d195a4cb907eb9cd154eca93dace8fa58c203eb","cyriltovena","2020-10-24 22:32:54","true","Logqlv2 docs (#2797)

* Working on the logql v2 documentation.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Wip

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* wip

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add informations about metrics queries.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* doc work

* small fixes

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>",118,30,0,1,"2018-04-16 10:25:39","919.01"
"grafana/loki","a3741d10686b250b346da509c0ef7aa6d5102b10","jeschkies","2023-08-10 16:27:22","true","Include response type in merging error message and merge already merged views. (#10218)",53,64,1,1,"2018-04-16 10:25:39","1940.5"
"grafana/loki","c971e8e65a71d6f21d23817cf57ec662ce72be5a","cyriltovena","2021-01-06 08:27:15","true","Optimizes SampleExpr to remove unnecessary line_format. (#3065)

* Optimizes SampleExpr to remove unnessary line_format.

When doing count_over_time and rate(), it doesn't make sense to have a line_format since you're counting line, you don't really care about what the line contains.

At the same time this set the foundation of for further optimization, like parsing only required labels during label parsing.

I've also found a bug where `topk by(foo) (1...` where not correctly parsed.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* For all range vector operations.

Except for bytes one which count bytes in lines.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Update pkg/logql/optimize_test.go

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>",115,33,0,1,"2018-04-16 10:25:39","990.42"
"grafana/loki","cd79adc8ab0c80c55a0f39b43322839c6ffb05d8","KMiller-Grafana","2021-08-12 12:55:20","true","Docs: fluentd client phrasing and formatting (#4147)

- Adds corrections from closed PR https://github.com/grafana/loki/pull/3880",121,40,0,0,"2018-04-16 10:25:39","1211.85"
"grafana/loki","8dcc4b3ec88f86b69a18d85fe11d5026c602fd2c","liguozhong","2022-10-17 06:50:09","true","Do not log 'unable to read rules directory' at startup if directory hasn't been created yet (#7434)",92,54,1,1,"2018-04-16 10:25:39","1641.85"
"grafana/loki","f811dbfc18cc61c7cf903dd6502aa40bf2ce446c","KMiller-Grafana","2021-07-21 17:07:40","true","Docs: fix bad links (#4024)",98,39,0,0,"2018-04-16 10:25:39","1191.03"
"grafana/loki","3d2aa76349471fe528d51939cd669e0446f5db2d","Red-GV","2022-08-15 09:29:50","true","Adding valid subscription annotation to metadata (#6907)",82,52,0,1,"2018-04-16 10:25:39","1579.96"
"grafana/loki","1e67b96d3137e241ce585e3de3ded7f99f82be22","osg-grafana","2022-11-09 12:47:39","true","Replace person with team for documentation reviews (#7645)

(Internal) See
https://github.com/grafana/technical-documentation/issues/520.",83,55,1,0,"2018-04-16 10:25:39","1664.1"
"grafana/loki","1bb535a730856bc992493c94991765ada682e4bd","Red-GV","2022-08-30 08:14:03","true","operator: Fixing logcli pod image value for operator addons (#6997)",80,52,1,1,"2018-04-16 10:25:39","1594.91"
"grafana/loki","2fd633cded9a97c8c6b29160549a157678d1fa2f","simonswine","2021-07-21 13:49:53","true","Restrict path segments in TenantIDs (#4020)

Updates cortex dependency to prevent paths derived from TenantIDs to
become vulnerable to path traversal attacks. CVE-2021-36156
CVE-2021-36157

Signed-off-by: Christian Simon <simon@swine.de>",95,39,0,0,"2018-04-16 10:25:39","1190.89"
"grafana/loki","3478e180211c17bfe2f3f3305f668d5520f40481","irizzant","2023-05-04 10:23:19","true","Loki microservices Tanka: fix error during manifest generation (#9362)

**What this PR does / why we need it**:
Fixes an error on the ServiceMonitor generated when
```
memberlist_ring_enabled: true,
create_service_monitor: true,
```
It also adds some checks on `memberlist.libsonnet` to avoid generating
invalid kubernetes manifests.

**Which issue(s) this PR fixes**:
Fixes #9361",81,61,1,0,"2018-04-16 10:25:39","1844.25"
"grafana/loki","6b4a9348eef297d0dd2ee5599254709489a66a18","candlerb","2019-07-15 12:31:39","false","fluentd-plugin-grafana-loki: avoid exception when remove/label_keys is unset (#750)

Fixes #749

Signed-off-by: Brian Candler <b.candler@pobox.com>",101,15,0,0,"2018-04-16 10:25:39","454.34"
"grafana/loki","8d6e2f0275279d06557904338b269eb82bef0df9","Red-GV","2022-06-21 11:14:04","true","operator: Extend schema validation in LokiStack webhook (#6411)",68,50,0,1,"2018-04-16 10:25:39","1526.03"
"grafana/loki","77b04b796350616c7c22994a1b6950774b5621c3","MasslessParticle","2023-07-28 22:05:58","true","Logging improvements for volume requests (#10099)

I noticed we were logging volume requests as metric requests in
`metrics.go`. This PR logs volume requests on their own with relevant
data.",52,63,1,1,"2018-04-16 10:25:39","1928.74"
"grafana/loki","14afb13d36edf0c566ca587efc46737fb172d061","kavirajk","2022-01-05 09:28:41","true","Chore: Copy `cortex/util/math` into Loki (#5036)

* Copy `cortex/pkg/util/math` into Loki.

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Fix linter

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Move `MinUint32` from `util` package into `util/math` package

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Remove NewEWMARate and related helpers

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Remove unwanted spaces

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Fix spaces in import paths

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",252,45,0,1,"2018-04-16 10:25:39","1354.71"
"grafana/loki","220d084fc423030ccbc54d3f9a4eb326f09721b9","vlad-diachenko","2022-07-08 12:27:15","true","manually backported upgrading guide from release 2.6.0 (#6631)",69,51,0,0,"2018-04-16 10:25:39","1543.08"
"grafana/loki","cc4ab7487ab3cd3b07c63601b074101b0324083b","MichelHollands","2022-12-19 08:32:48","true","Fix typo (#7956)

**What this PR does / why we need it**:
Fix docs as reported by user

**Which issue(s) this PR fixes**:
Fixes https://github.com/grafana/loki/issues/7893

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",97,56,1,1,"2018-04-16 10:25:39","1703.92"
"grafana/loki","766d4b7b5d2475d9424ca03e2a746e4c0e46660f","xperimental","2022-09-01 17:26:08","true","operator: Configure default node affinity for all pods (#7000)",80,52,1,1,"2018-04-16 10:25:39","1596.29"
"grafana/loki","4903df6ae53bb5132aefee57f40ae1b8a5af8dc1","owen-d","2022-06-03 15:22:22","true","Tsdb/inverted index wiring (#6252)

* multi inverted index

* delete in inverted index signature

* multi inverted index

* inverted index testing + skip nil indices

* wires up period config aware multi-inverted-idx through ingesters

* better inverted index validation

* apply shipper defaults to last relevant period config, not current one.

* more verbose error",72,50,0,1,"2018-04-16 10:25:39","1508.21"
"grafana/loki","89d80a6fc469daba5302bdf8f58dfc40595c4422","owen-d","2020-05-26 21:44:58","true","Feature/querysharding ii (#1927)

* [wip] sharding evaluator/ast

* [wip] continues experimenting with ast mapping

* refactoring in preparation for binops

* evaluators can pass state to other evaluators

* compiler alignment

* Evaluator method renamed to StepEvaluator

* chained evaluator impl

* tidying up sharding code

* handling for ConcatSampleExpr

* downstream iterator

* structure for downstreaming asts

* outlines sharding optimizations

* work on sharding mapper

* ast sharding optimizations

* test for different logrange positions

* shard mapper tests

* stronger ast sharding & tests

* shardmapper tests for string->string

* removes sharding evaluator code

* removes unused ctx arg

* Revert ""removes sharding evaluator code""

This reverts commit 55d41b9519da9496e9471f13a5048d903ea04aaa.

* interfaces for downstreaming, type conversions

* sharding plumbing on frontend

* type alignment in queryrange to downstream sharded queriers

* downstreaming support for sharding incl storage code

* removes chainedevaluator

* comment alignment

* storage shard injection

* speccing out testware for sharding equivalence

* [wip] shared engine refactor

* sorting streams, sharding eval fixes

* downstream evaluator embeds defaultevaluator

* other pkgs adopt logql changes

* metrics & logs use same middleware instantiation process

* wires up shardingware

* middleware per metrics/logfilter

* empty step populating StepEvaluator promql.Matrix adapter

* sharding metrics

* log/span injection into sharded engine

* sharding metrics avoids multiple instantiation

* downstreamhandler tracing

* sharding parameterized libsonnet

* removes querier replicas

* default 32 concurrency for workers

* jsonnet correct level override

* unquote true in yaml

* lowercase error + downstreamEvaluator defaults to embedded defaultEvaluator

* makes shardRecorder private

* logs query on failed parse

* refactors engine to be multi-use, minimizes logger injection, generalizes Query methods, removes Engine interface

* basic tests for querysharding mware

* [wip] concurrent evaluator

* integrates stat propagation into sharding evaluator

* splitby histogram

* extends le bounds for bytes processed

* byte throughput histogram buckets to 40gb

* chunk duration mixin

* fixes merge w/ field rename

* derives logger in sharded engine via ctx & logs some downstream evaluators

* moves sharded engine to top, adds comments

* logs failed merge results in stats ctx

* snapshotting stats merge logic is done more effectively

* per query concurrency controlled via downstreamer

* unexports decodereq

* queryrange testware

* downstreamer tests

* pr requests",122,25,0,1,"2018-04-16 10:25:39","770.97"
"grafana/loki","853260cfae3bbc18279b67a5b5209284fd8a3801","owen-d","2021-10-29 13:38:41","true","regenerates assets from current vfsgen dependency (#4588)",169,42,0,1,"2018-04-16 10:25:39","1288.88"
"grafana/loki","035f673e24f58d279857dbcfa051887bd3c4560c","MichelHollands","2023-03-29 08:02:11","true","Update Loki version to latest (#8926)

**What this PR does / why we need it**:
Update to v2.7.5

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [X] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",85,59,1,1,"2018-04-16 10:25:39","1803.9"
"grafana/loki","f598484a947a1c57e3b7b5a90f17f36954150679","owen-d","2022-02-04 22:42:45","true","Release entryBufferPool once (#5324)

* release entryBufferPool once

* reverseEntryIterator.Next is safe to call past expiry",277,45,0,1,"2018-04-16 10:25:39","1384.26"
"grafana/loki","410c1a0d38dce13d8ac63e20d443ba4e0d7c414d","adityacs","2022-05-26 09:15:30","true","feat(ruler): support alert relabeling (#6220)",73,49,0,1,"2018-04-16 10:25:39","1500.95"
"grafana/loki","eb04d637536b5b127c53a5cdb58e23f29f11aa05","DylanGuedes","2022-06-30 11:13:26","true","Loki: Update `grafana/dskit` to `3624a96` (#6529)",73,50,0,1,"2018-04-16 10:25:39","1535.03"
"grafana/loki","05b8537e79edabfd7473fbf26f5fbf71c43cabb2","owen-d","2021-07-12 13:02:29","true","WAL Replay counter (#3974)

* speccing out unordered head block

* testware & unordered serialise

* common utils for iter & sampleIter

* more generic forEntries

* more efficient unordedHeadChunk serialise (no internal re-casting)

* roundtripping unordered head block, exit headchunk iteration early, add constant for current default chunk version

* adds head block write benchmarks for ordered & unordered writes

* fixes bench

* removes unused initializer

* gofmt

* linting

* introduces an entry counter into streams & wal records

* sets & resets entrycount on checkpoint recovery and after wal replay finishes

* pushing to streams checks counter

* reject pre-applied entries test

* removes commented test",107,39,0,1,"2018-04-16 10:25:39","1181.86"
"grafana/loki","3abd26097587779b461a8befef1af06700d0ae13","periklis","2023-04-24 09:25:08","true","Bump dskit from 528d8a7 to 1725bcc (#9184)",81,60,1,1,"2018-04-16 10:25:39","1834.21"
"grafana/loki","b49663c287f023ef90a941099e55a20084bb3dea","jeschkies","2023-04-04 16:27:37","true","Add goimports to Loki build image. (#9013)",81,59,1,1,"2018-04-16 10:25:39","1809.25"
"grafana/loki","28d845d26c947bb285c8dfebaaf094c407e99f4a","jeschkies","2023-03-03 18:25:36","true","Make Loki Overrides public. (#8696)

**What this PR does / why we need it**:
Follow up to #8689 that will allow to inject a different overrides
implementation.


Signed-off-by: Callum Styan <callumstyan@gmail.com>
Co-authored-by: Callum Styan <callumstyan@gmail.com>",73,58,1,1,"2018-04-16 10:25:39","1778.33"
"grafana/loki","a56a88bd356867347508ed13673f656822e11e9d","chaudum","2022-06-16 20:16:46","true","Add unwrapped aggregation `rate_counter()` (#6412)

`rate_counter()` takes an unwrapped range as input, but unlike `rate()`
it treats the values extracted from the log lines as ""counter metric""
like in Prometheus' `rate()` function.

This is a replacement for the reverted change of #5013

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",67,50,0,1,"2018-04-16 10:25:39","1521.41"
"grafana/loki","a1989f8efd407be278002fed0d48b4dfe85056f1","jiachengxu","2022-03-04 07:03:28","true","loki mixin: make labelsSelector in loki chunks dashboards configurable (#5536)

Signed-off-by: Jiacheng Xu <jiachengxu@users.noreply.github.com>

Co-authored-by: Jiacheng Xu <jiachengxu@users.noreply.github.com>",297,46,0,0,"2018-04-16 10:25:39","1413.61"
"grafana/loki","c3edeac990a863aff0699e1a610674b90f50d5df","DylanGuedes","2022-02-28 22:31:34","true","Docs: fix link reference to ""Step vs Interval"" section. (#5495)",301,46,0,1,"2018-04-16 10:25:39","1408.25"
"grafana/loki","b485b81ff9c22e2c904909bc9dd79ecc6d3b4e20","MasslessParticle","2022-02-28 14:24:34","true","Fix potential deadlock in the table manager (#5472)

* Fix potential deadlock in the table manager

* Ensure second lock is released on return

* use t.TempDir instead of os.TempDir

* fix broken test

Co-authored-by: Sandeep Sukhani <sandeep.d.sukhani@gmail.com>",299,46,0,1,"2018-04-16 10:25:39","1407.92"
"grafana/loki","9d213fb5606b539c18f3c9c7a1e157dfb195a183","owen-d","2020-11-05 16:02:54","true","WAL design doc (#2704)

* wal first pass

* design doc wal

* formatting/consistency",127,31,0,1,"2018-04-16 10:25:39","929.73"
"grafana/loki","0761d655257eb3cdf2449d87d073661de5811fc5","daixiang0","2019-06-18 02:18:46","true","Merge branch 'master' into reduce-config-option",83,14,0,0,"2018-04-16 10:25:39","426.91"
"grafana/loki","e269759f6c47e9e07752493f2ba5df3718ef8a89","jeschkies","2023-02-01 07:47:32","true","Display Memory request in sizing tool. (#8326)",81,57,1,1,"2018-04-16 10:25:39","1745.89"
"grafana/loki","5b7057dbdfda880b9fa04db51f2088bc8961e5dd","slim-bean","2019-03-26 22:47:44","false","Fixing promtail.sh to include the parser value in the generated yaml, defaults to docker",91,11,0,1,"2018-04-16 10:25:39","340.52"
"grafana/loki","c3da1ca04b42b34fa7a19414256a88ebbdaf5ae6","Mrgove10","2023-07-17 21:41:05","true","Docs : fix promtal typo (#9951)

**What this PR does / why we need it**: Fix a typo in installation
documentation, Promtal instead of Promtail

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

Co-authored-by: J Stickler <julie.stickler@grafana.com>",58,63,1,0,"2018-04-16 10:25:39","1917.72"
"grafana/loki","156023ae9abc4acbdbd5d6e32dc9146b42700827","FrederikNS","2020-05-26 21:32:56","true","Allow configuring more options for output configuration (#2089)

* Allow configuring more options for output configuration

The `TenantID`, `BatchWait`, `BatchSize` and `AutoKubernetesLabels` options in the fluent-bit loki output plugin were not configurable. This change allows configuring those options via the helm chart.

* typo in production/helm/fluent-bit/README.md

Co-authored-by: Joseph Petersen <josephp90@gmail.com>

Co-authored-by: Joseph Petersen <josephp90@gmail.com>
Co-authored-by: Cyril Tovena <cyril.tovena@gmail.com>",122,25,0,0,"2018-04-16 10:25:39","770.96"
"grafana/loki","7980943787f9a21458f584c5b82b7c27bf1bd91d","johgsc","2022-04-18 06:55:22","true","Update CHANGELOG.md (#5935)",321,48,0,0,"2018-04-16 10:25:39","1462.85"
"grafana/loki","2cc80c59c4c734aa23f953d212c9068fe0a1b3ad","owen-d","2023-09-05 10:28:01","true","per tenant gate for structured metadata feature (#10402)

Adds a per tenant configuration to block access to the upcoming
structured-metadata push API extension.

---------

Co-authored-by: Salva Corts <salva.corts@grafana.com>",47,65,1,1,"2018-04-16 10:25:39","1965.25"
"grafana/loki","b72198c80a2d406f928acc2a11ad4d9a0cd8c520","owen-d","2021-01-08 09:29:25","true","better boltdb errmsg (#3139)",117,33,0,1,"2018-04-16 10:25:39","992.46"
"grafana/loki","308af871cf59329a651e779bde59a369a1b2f34b","owen-d","2021-11-02 18:52:10","true","uses ring.Write instead of ring.WriteNoExtend for compactor ring checks (#4615)",167,42,0,1,"2018-04-16 10:25:39","1292.1"
"grafana/loki","da99a2b2c00faf6699a6c9b21047d870dec4725d","owen-d","2020-08-19 00:29:47","true","memberlist correct yaml path. closes #2499 (#2508)",116,28,0,1,"2018-04-16 10:25:39","853.09"
"grafana/loki","f25b5bdbf2c166391f661797bc539bb7225a1e09","xperimental","2023-08-10 08:32:30","true","operator: Automatically order imports based on contributing guide (#9692)",52,64,1,1,"2018-04-16 10:25:39","1940.17"
"grafana/loki","2ad4d7aba3b0c70c7dcb35a84437ca679a3c99e1","pstibrany","2020-01-28 18:54:19","false","Move chunks-inspect tool to Loki repo (#1577)

* Move chunks-inspect tool to Loki repo

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Added README.md

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Added .gitignore. Added more description to README.md

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>",106,21,0,0,"2018-04-16 10:25:39","647.6"
"grafana/loki","de026a00ac4f4aed8ffefefbf1c199ad799c95e3","pracucci","2019-10-24 13:50:11","false","Fix compiled logproto protobuf (#1183)

* Enforce recompile of protobuf sources on 'make check-generated-files'

* Pinned version of protobuf in loki-build-image

* Pinned version of goyacc in loki-build-image

* Added 'make build-image-push' to Makefile

* Documented how to release loki-build-image",69,18,0,0,"2018-04-16 10:25:39","553.39"
"grafana/loki","37c39dab7ba60179e5e70c2a821f73facac4dffe","cyriltovena","2020-05-01 12:54:19","true","Adds :delegated flags to speed up build experience on MacOS. (#2009)

This is ignored by other OS, see https://docs.docker.com/docker-for-mac/osxfs-caching/#delegated.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",121,24,0,1,"2018-04-16 10:25:39","745.6"
"grafana/loki","fd16425062fcb840196184f1d7da21101f0144e9","salvacorts","2023-04-18 10:26:42","true","Cache index stats requests (#8972)

**What this PR does / why we need it**:

As described in https://github.com/grafana/loki/issues/8973, we are
substantially increasing the load of index stat requests we sent to our
index gateways. Many of these requests should be easily re-used by
caching them.

This PR adds caching for index stat requests by reusing the results
cache. Here's a demo ([source][1]):


![image](https://user-images.githubusercontent.com/8354290/229104609-4dd26f0a-9260-4f21-85ef-ac4a86ebba7a.png)

**Which issue(s) this PR fixes**:
Fixes https://github.com/grafana/loki/issues/8973

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [x] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

[1]:
https://ops.grafana-ops.net/d/afcaef21-e5ad-49e7-ab06-42a9d7d915eb/index-stats?orgId=1&var-datasource=dev-cortex&var-cluster=dev-eu-west-2&var-namespace=loki-dev-009&var-loki_datasource=Grafana%20Logging&from=1680259907288&to=1680260431814&var-operation=All

---------

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>",82,60,1,1,"2018-04-16 10:25:39","1828.25"
"grafana/loki","a8397161dd067698d1e4a6b1088eb2a4390083be","owen-d","2022-02-22 19:55:39","true","Adds a tool for converting boltdb->tsdb and benchmarking queries (#5430)

* exports NewChunkIndexIterator

* starts building tsdb-bench

* adds query benchmark for tsdb prototyping

* lint",298,46,0,1,"2018-04-16 10:25:39","1402.15"
"grafana/loki","82c1d1276cb9d9c833b5b7b05f1cc44b5066ddbe","MarNicGit","2022-10-12 05:11:10","true","Update installation.md (#7388)

**What this PR does / why we need it**:

This PR attempts to clarify where someone can find the latest binary
release of Promtail. I spent a good hour trying to find a download for
Promtail before realizing it is included in the assets of each Loki
release. Opening the releases page barely shows any mention of Promtail
until you fold out the assets list.

**Special notes for your reviewer**:

This is a documentation change.

**Checklist**
- [x] Reviewed the `CONTRIBUTING.md` guide
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",90,54,1,0,"2018-04-16 10:25:39","1636.78"
"grafana/loki","cb337c3b710f66aa02bc49aa9695e3b64328a25c","periklis","2021-07-21 07:06:58","true","Add LogQL AST walker (#3991)

* Make expressions public scoped

* Add walkable implementation

* Use walkable in logql/optimize",95,39,0,1,"2018-04-16 10:25:39","1190.61"
"grafana/loki","3303844cb02c777d68dfdb3f75f3f579650fbf16","akhilanarayanan","2023-08-23 21:41:19","true","Refactored forGivenIngestors to use DoUntilQuorum instead of Do (#9984)

This changes the forGivenIngestors function in
pkg/querier/ingester_querier.go to use `DoUntilQuorum` (from [PR
#293](https://github.com/grafana/dskit/pull/293)) instead of `Do`.

`DoUntilQuorum` is much more efficient than `Do`. The exact differences
between them can be seen
[here](https://github.com/grafana/dskit/pull/293).

---------

Co-authored-by: Trevor Whitney <trevorjwhitney@gmail.com>",49,64,1,0,"2018-04-16 10:25:39","1953.72"
"grafana/loki","7856db62bbf61770d7c5463c6e9269244802a5e8","DylanGuedes","2022-01-28 17:06:19","true","Copy `cortex/pkg/storage/bucket` package dependency into Loki (#5258)

* Fork cortex `storage/bucket` into Loki.

* Replace storage/bucket usage from Cortex to Loki one.

* Remove redundant error check.

* Revert SwiftConfig struct and remove cortex pkgs alias.

* Add missing test files.

* Replace `cortex/pkg/util` with our own implementation.

* Remove unused cortex packages.",275,45,0,1,"2018-04-16 10:25:39","1378.03"
"grafana/loki","d235e483c4bbe11af53c386fcbd745255533f28c","pracucci","2019-07-11 19:22:28","false","Added source validation to regex and json stages",101,15,0,0,"2018-04-16 10:25:39","450.62"
"grafana/loki","bdfc0f92a09257bd59830cd945a99485cbbb8c9d","DylanGuedes","2023-04-18 17:55:04","true","Loki: Add debug event to ingester `GetStreamRates` (#9157)

**What this PR does / why we need it**:
- Add a new span event to our ingesters `GetStreamRates` function.
- Add how many streams were updated on a `updateRates` call.",79,60,1,1,"2018-04-16 10:25:39","1828.56"
"grafana/loki","38c42a26c6955ffbe43e484894a7b0bc461e9a13","kavirajk","2021-12-16 17:34:44","true","Move `cortex/pkg/tenant` dependency to Loki. (#4944)",232,44,0,1,"2018-04-16 10:25:39","1336.05"
"grafana/loki","9934132b0fdbbf38b87761f5341d1342cf01b528","vitaliyf","2023-07-24 14:53:40","true","docs: fixed typos in caching.md (#10043)

**What this PR does / why we need it**:

Fixes two silly typos in caching.md

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",54,63,1,0,"2018-04-16 10:25:39","1924.44"
"grafana/loki","61311957a3d3d020b7ffa81cad8659e3d01c4a40","dannykopping","2023-03-14 13:49:15","true","Integration Tests: allow loki logs to be optionally output in integration tests (#8793)

**What this PR does / why we need it**:
Debugging integration tests can be difficult without Loki's logs being
output.

Changing the call from `cluster.New()` to `cluster.New(true,
level.WarnValue())` now allows the author the option to temporarily or
permanently enable logging for their test, as well as configure a level
filter to control the noise.

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",89,59,1,1,"2018-04-16 10:25:39","1789.14"
"grafana/loki","67e7285bf5f3f22d298b92b2a715760d66225460","cyriltovena","2022-05-24 12:44:29","true","Improve labels computation during LogQL pipeline (#6110)

* Improve labels computation during LogQL pipeline

* Fixes a bug that was mutating the base labels",73,49,0,1,"2018-04-16 10:25:39","1499.1"
"grafana/loki","a1aaec1658b7b4bfa01403f20396389ae7a63f9d","dannykopping","2021-09-22 12:03:39","true","Create custom struct that eases json/yaml unmarshaling of complex relabel.Config struct (#4364)

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",126,41,0,1,"2018-04-16 10:25:39","1251.82"
"grafana/loki","0ecaa108c1de8b7a9e45b9d47e193949b9ab559e","RichiH","2020-06-16 17:21:59","true","[WIP] Propose new governance (#2137)

Add new governance

Signed-off-by: Richard Hartmann <richih@richih.org>
Co-authored-by: Cyril Tovena <cyril.tovena@gmail.com>",138,26,0,0,"2018-04-16 10:25:39","790.79"
"grafana/loki","0684a2236d6e193b4eae628f97055cd476016765","cyriltovena","2019-08-01 19:15:11","true","fix grafana image tag by pinning it (#835)",106,15,0,1,"2018-04-16 10:25:39","470.62"
"grafana/loki","2abce2ce638987ad40c454681eb3e54ae5a5d098","cyriltovena","2019-04-19 12:52:42","false","rebase to the new structure",94,12,0,1,"2018-04-16 10:25:39","368.35"
"grafana/loki","a161e02af5b9bf25e913a4d073e7bb3dc30aa651","davkal","2019-03-18 15:41:40","true","Merge pull request #390 from SvenDowideit/add-default-loki-fluentd-conf

Use the example fluentd conf files, and show a way to use them",102,11,0,0,"2018-04-16 10:25:39","332.22"
"grafana/loki","059d7d8561d314d5d1d53bdb3547fb8957be77d2","tomwilkie","2018-12-11 13:25:46","true","Add logo to readme. (#59)

* Add logo to readme.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>

* Fix image width

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>

* Tweak readme.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>

* Add apache 2.0 license.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",12,8,0,0,"2018-04-16 10:25:39","235.13"
"grafana/loki","e33a029c97effbc95944174df26a1ca640ed21cb","tomwilkie","2018-05-18 19:16:16","false","Reverse the order of the iterators so they go from end to start.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",0,1,0,0,"2018-04-16 10:25:39","32.37"
"grafana/loki","d6b85876ca0e27282426029bbaddd6cfc7fcb298","owen-d","2020-02-13 18:07:40","true","max line lengths (component + tenant overrides) (#1686)

* bytesize flag support

* max line limits

* configurable tenant override options for max line size

* bytesize yaml support

* validator methods

* distributor validator type

* human friendly line size output, distributor test

* invalid labels distributor test

* docs + vendor

* removes dead limits code",115,22,0,1,"2018-04-16 10:25:39","662.57"
"grafana/loki","70f6bf2e4528a9ce4b1aff283ee28aa0a95d3315","owen-d","2022-10-24 19:03:17","true","Index gw lock bugfix (#7497)

While I'm still in favor of a longer refactor to address the complexity
described in https://github.com/grafana/loki/pull/7490, I'm opening this
PR as a shorter, more immediate alternative that should fix the
deadlocks. This also reduces the number of total lock calls in many
cases as we lock to act over entire groups rather than individual items.",90,54,1,1,"2018-04-16 10:25:39","1649.36"
"grafana/loki","12ebd33f940de4da4456636615760d86c673d24d","owen-d","2022-09-16 16:03:48","true","TSDB indexBuckets helper logs instead of errors (#7187)

indexBuckets will return the list of overlapping TSDB buckets for a time
range. Historically, this errored when there was no overlap, which is
generally impossible. While mutating period configurations as a test
(which should never be done in production), I realized this would
preemptively error us when there were old TSDB WALs from a bucket that
no longer belonged to a TSDB period (i.e. by replacing a `tsdb` index
with a `boltdb-shipper` one).

This PR changes this to a log line instead as we don't need to error and
stop computation; it's better to return an empty overlap instead.

Co-authored-by: Dylan Guedes <djmgguedes@gmail.com>",88,53,1,1,"2018-04-16 10:25:39","1611.23"
"grafana/loki","798677ae7f3ef43e1432ca411b6261be5f5d10fe","chaudum","2022-06-22 14:38:19","true","Fix panic in instant query splitting when using unwrapped rate (#6348)

* Fix panic in instant query splitting when using unwrapped rate

The range aggregation `rate()` supports both log ranges and unwrapped
ranges, e.g.

`rate({app=""foo""} [$__interval])`
and
`rate({app=""foo""} | unwrap bar [$__interval])`

Since `rate()` was split into multiple `count_over_time()` over total
duration, but `count_over_time()` does not support `unwrap`, unwrapped
rate queries caused panics.

This fix changes the splitting of `rate({app=""foo""} | unwrap bar [$__interval]`
into multiple `sum_over_time()` over total duration.

Fixes #6344

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* Add tests

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* Integrate review feedback

Co-authored-by: Susana Ferreira <susana.ferreira@grafana.com>

Co-authored-by: Susana Ferreira <susana.ferreira@grafana.com>",70,50,0,1,"2018-04-16 10:25:39","1527.18"
"grafana/loki","ff36227d87e0cb5c2efd8dc9d97b542e080a6fb7","jeschkies","2023-04-12 16:06:18","true","Ignore broken query limits header. (#9103)",84,60,1,1,"2018-04-16 10:25:39","1817.24"
"grafana/loki","7ad413e87d8cf4e0e9b1e161861ef76182a11699","salvacorts","2023-02-03 14:21:24","true","Re-stablish tailing websocket connection if it's closed unexpectedly. (#8374)",78,57,1,1,"2018-04-16 10:25:39","1748.16"
"grafana/loki","807aa459d4958994a98c8dd7eddcd1dbb5c20ffc","kavirajk","2023-01-25 14:46:14","true","logql: Support `urlencode` and `urldecode` template functions (#8271)

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",86,57,1,1,"2018-04-16 10:25:39","1740.18"
"grafana/loki","15378cf0e657f6339da82ed70c5ccb54f9be3816","owen-d","2020-06-22 18:49:23","true","avoids recording stats in the sharded engine (#2249)",138,26,0,1,"2018-04-16 10:25:39","796.85"
"grafana/loki","8ea6c381cb39f5aae2592a1948e59060f9956009","slim-bean","2020-10-04 21:12:25","true","Promtail: Fix deadlock on tailer shutdown. (#2717)

* to avoid a deadlock on shutdown, leave the goroutine running which reads the Lines channel from the tailer and it will exit when the tailer closes the channel.

* remove the flag I added a few weeks ago and instead when updating the position information of the file gracefully fail if the file no longer exists.

* update the vendoring of the tail library, more re-work on how tailing shutdown and errors are handled.

* fix mistake

* updating tail lib to merged commit hash

* go mod tidy

* update tail library with additional mutex lock

* break up the tailer goroutine into two separate goroutines to make it a little more clear and remove some special case logic.

* don't forget to close your channels!

* make the stop method in the tailer only execute at most one time.

* update hp-tail again with improvements to the mutex locking in closeFile

* replace the more complicated channel based single execution code with a sync.Once",115,30,0,1,"2018-04-16 10:25:39","898.95"
"grafana/loki","4995c97ff30b9570b89b0ce2857cef6a7e68e9b3","slim-bean","2020-04-06 20:48:51","false","updating helm and ksonnet to 1.4.1
updating Fluent Bit to correct image

Signed-off-by: Edward Welch <edward.welch@grafana.com>",114,24,0,1,"2018-04-16 10:25:39","715.68"
"grafana/loki","1cfc30fb239cde7575573cf5426887dbde72b3a4","salvacorts","2022-06-20 10:54:11","true","Evenly spread queriers across available nodes (#6415)

* Evenly spread queriers across available nodes

* Fix lint issue

* Add entry to the CHANGELOG and the Upgrade Guide

* Make topology spread configurable

* Apply CR feedback",67,50,0,1,"2018-04-16 10:25:39","1525.02"
"grafana/loki","b195e94f3952171f0ba082623bed0389df657524","hedss","2020-12-07 09:29:58","true","fluent-bit: Rename Fluent Bit plugin output name. (#2974)

This prevents a clash with the Loki plugin now included with
the Fluent Bit agent by default.

The output plugin is now named `grafana-loki`.

Signed-off-by: Heds Simons <heds@whaleway.net>",124,32,0,0,"2018-04-16 10:25:39","961.46"
"grafana/loki","8fbb095aae28fae42d7d678c5b1571a99413d705","AleksandrKovshariov","2023-05-25 15:42:50","true","Update replication factor ceveat sentence (#9358)

**What this PR does / why we need it**:

This sentence ""There’s also an edge case where we acknowledge a write if
2 of the three ingesters do which means that in the case where 2 writes
succeed, we can only lose one ingester before suffering data loss."" is
really hard to understand.

I suggest ""If a write is acknowledged by 2 out of 3 ingesters, we can
tolerate the loss of one ingester but not two, as this would result in
data loss.""

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",66,61,1,0,"2018-04-16 10:25:39","1865.47"
"grafana/loki","ec0bf700456f6683fd36e4914db177f7d8a3d213","periklis","2022-09-29 12:34:37","true","operator: Expose Loki Ruler API via the lokistack-gateway (#7254)",91,53,1,1,"2018-04-16 10:25:39","1624.09"
"grafana/loki","f25b375ec331a1d283637b982e858bdae972d399","daixiang0","2019-04-10 08:02:17","false","Add link to chunk format doc

Signed-off-by: Xiang Dai <764524258@qq.com>",99,12,0,0,"2018-04-16 10:25:39","353.9"
"grafana/loki","d0baa40df3f318e0192c6807d0009c86e0614164","hamishforbes","2023-06-30 19:43:10","true","Only modify identical timestamps when increment-duplicate-timestamps enabled (#9437)

When `-validation.increment-duplicate-timestamps` is enabled out of
order log entries within the same push request can have their timestamps
incorrectly mutated.

The code is currently just looking for 2 consecutive entries where the
timestamp is not increasing.
It should only affect entries where the timestamp is a *duplicate*

Test push request payload:

```json
{
  ""streams"": [
    {
      ""stream"": {
        ""increment_duplicate_timestamp"": ""fixed|true|false""
      },
      ""values"": [
        [
          ""1683665111628000000"",
          ""1a: 1683665111628000000""
        ],
        [
          ""1683665111628000000"",
          ""1b: 1683665111628000000""
        ],
        [
          ""1683665111628000003"",
          ""3: 1683665111628000003""
        ],
        [
          ""1683665111628000002"",
          ""2: 1683665111628000002""
        ]
      ]
    }
  ]
}
````

As only the first 2 of these timestamps are the same I would expect all
but `1b` to have the timestamps recorded as-is and the logs returned by
a query in the order: 1a,1b,2,3.

Actual Results:

```
> logcli query --forward --limit 100 -z UTC -q --no-labels  --since 60m -o jsonl  '{increment_duplicate_timestamp=""fixed""}' | jq
{
  ""line"": ""1a: 1683665111628000000"",
  ""timestamp"": ""2023-05-09T20:45:11.628Z""
}
{
  ""line"": ""1b: 1683665111628000000"",
  ""timestamp"": ""2023-05-09T20:45:11.628000001Z""
}
{
  ""line"": ""2: 1683665111628000002"",
  ""timestamp"": ""2023-05-09T20:45:11.628000002Z""
}
{
  ""line"": ""3: 1683665111628000003"",
  ""timestamp"": ""2023-05-09T20:45:11.628000003Z""
}

> logcli query --forward --limit 100 -z UTC -q --no-labels  --since 60m -o jsonl  '{increment_duplicate_timestamp=""true""}' | jq
{
  ""line"": ""1a: 1683665111628000000"",
  ""timestamp"": ""2023-05-09T20:45:11.628Z""
}
{
  ""line"": ""1b: 1683665111628000000"",
  ""timestamp"": ""2023-05-09T20:45:11.628000001Z""
}
{
  ""line"": ""3: 1683665111628000003"",
  ""timestamp"": ""2023-05-09T20:45:11.628000003Z""
}
{
  ""line"": ""2: 1683665111628000002"",
  ""timestamp"": ""2023-05-09T20:45:11.628000004Z""
}

> logcli query --forward --limit 100 -z UTC -q --no-labels  --since 60m -o jsonl  '{increment_duplicate_timestamp=""false""}' | jq
{
  ""line"": ""1a: 1683665111628000000"",
  ""timestamp"": ""2023-05-09T20:45:11.628Z""
}
{
  ""line"": ""1b: 1683665111628000000"",
  ""timestamp"": ""2023-05-09T20:45:11.628Z""
}
{
  ""line"": ""2: 1683665111628000002"",
  ""timestamp"": ""2023-05-09T20:45:11.628000002Z""
}
{
  ""line"": ""3: 1683665111628000003"",
  ""timestamp"": ""2023-05-09T20:45:11.628000003Z""
}
```

`true` and `false` were written to Loki 2.8.2 with the
`-validation.increment-duplicate-timestamps` enabled or disabled
`fixed` with this patch applied and the flag enabled

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [x] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",61,62,1,0,"2018-04-16 10:25:39","1900.64"
"grafana/loki","2ebbecfcbd7e484fdcfad4669cf33fd8dda64eb4","cstyan","2022-03-22 15:11:15","true","Require unique client configs when there are multiple clients. (#5688)

* Require unique client configs when there are multiple clients.

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* Fixing linter error

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

Co-authored-by: Danny Kopping <danny.kopping@grafana.com>",311,47,0,1,"2018-04-16 10:25:39","1431.95"
"grafana/loki","f17b189a3f84a41ac06aefc1e7d5af8862912a08","owen-d","2021-08-18 15:39:54","true","Promote/ruler api (#4132)

* unmark the ruler api as experimental

* deprecation notice for experimental prefix

* removes vendor changes, adds -ruler.enable-api (without experimental prefix) on our ruler.Config",131,40,0,1,"2018-04-16 10:25:39","1217.97"
"grafana/loki","692240a12dffb3174a4b6528809e292a0b6000cf","JStickler","2023-09-06 08:04:02","true","[Docs] Minor update to more user friendly link text (#10460)

Small update to change link text to be more user friendly and capitalize the company name.",46,65,1,0,"2018-04-16 10:25:39","1966.15"
"grafana/loki","61db56778bf682f0c52118a4e97e168d729ba799","tomwilkie","2018-12-14 21:41:42","true","Don't push docker images on forks. (#111)

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",28,8,0,0,"2018-04-16 10:25:39","238.47"
"grafana/loki","9f257c591a873b3faabfeafc5d2d577c0f6e99e8","tomwilkie","2018-12-10 22:07:37","true","[WIP] Persistence (#44)

Persistence chunks using the Cortex chunk store.",11,8,0,0,"2018-04-16 10:25:39","234.49"
"grafana/loki","5a5430190ff192033878b449ccda770a23be70a9","jeschkies","2023-02-01 14:05:55","true","Clarify query performance in sizing tool. (#8327)

**Which issue(s) this PR fixes**:
Fixes #8297",79,57,1,1,"2018-04-16 10:25:39","1746.15"
"grafana/loki","8efe8b037f505588d6bea269333cec3a6161f5aa","jeschkies","2023-10-10 09:00:56","true","Fix docker buildx install (#10838)

**What this PR does / why we need it**:
I've forgot to copy the binary in
https://github.com/grafana/loki/pull/10833/.

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",25,66,1,1,"2018-04-16 10:25:39","2000.19"
"grafana/loki","fcdd55b6c90718252f4c9b45e60ac09b8e568fcb","ashwanthgoli","2023-09-29 05:23:48","true","embedded cache: update metric namespace and remove duplicate metrics (#10693)

**What this PR does / why we need it**:

Removes the following embedded cache metrics since
`loki_cache_request_duration_seconds` (which instruments requests made
to all the caches) [already covers
them](https://github.com/grafana/loki/blob/6a07988491124c91d4acb1cbbf2ee2a4d7dc8900/pkg/storage/chunk/cache/cache.go#L110):
- `querier_cache_added_total`
- `querier_cache_gets_total`
- `querier_cache_misses_total`

Updates the namespace and subsystem for the following metrics
- `querier_cache_added_new_total` is renamed to
`loki_embeddedcache_added_new_total`
- `querier_cache_evicted_total` is renamed to
`loki_embeddedcache_evicted_total`
- `querier_cache_entries` is renamed to `loki_embeddedcache_entries`
- `querier_cache_memory_bytes` is renamed to
`loki_embeddedcache_memory_bytes`

Removes already deprecated metric `querier_cache_stale_gets_total`


**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [x] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [x] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",29,65,1,0,"2018-04-16 10:25:39","1989.04"
"grafana/loki","1549fec2fa050326104731f81d4e930bc6ffb6eb","JoaoBraveCoding","2023-03-23 15:10:06","true","mixins: Normalize headless service name for query-frontend/scheduler (#8880)

**What this PR does / why we need it**:
Mixins in general are rather complex pieces of code to consume. When
trying to use the loki mixins it wasn't apparent at first that I could
use a headless service for DNS SRV discovery for both query_frontend and
query_scheduler, especially because for frontend the service is named
`query_frontend_headless_service` and for the scheduler, it's named
`query_scheduler_service_discovery`. Furthermore, the query_frontend
mixin provides a non-headless version of the service while
query_scheduler doesn't. This PR aims at normalizing this for end users,
both headless services are now named `query_frontend_headless_service`
and `query_scheduler_headless_service` and both also provide a
non-headless version of the service.",83,59,1,0,"2018-04-16 10:25:39","1798.2"
"grafana/loki","3ac9818f82b19be88bb99423a9b6de40c1e526d0","sandeepsukhani","2021-12-02 12:30:24","true","recreate compacted boltdb files from compactor when they are more than 12 hours old (#4853)",213,43,0,1,"2018-04-16 10:25:39","1321.84"
"grafana/loki","cd5368a44d53a91ef4f08ae389460f9130a3f1c8","slim-bean","2019-07-17 19:37:58","false","preparing for move into loki repo",101,15,0,1,"2018-04-16 10:25:39","456.63"
"grafana/loki","047cc1baa4a7bec324e2753e803fab2caab01200","hasonhai","2019-02-15 14:54:17","true","Loki pod needs secret mounting privileges",88,10,0,0,"2018-04-16 10:25:39","299.19"
"grafana/loki","d7493ad044b36194ae0e7a9e645c0cfd7f8f783b","ashwanthgoli","2023-09-07 05:34:32","true","chore: add 2.9.x entry to  release-notes index page (#10491)

**What this PR does / why we need it**:
Adds 2.9.x release to release notes page

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",45,65,1,0,"2018-04-16 10:25:39","1967.05"
"grafana/loki","dbf7dd4bac112a538a59907a8c6092504e7f4a91","hainenber","2023-10-09 09:08:23","true","fix(helm): bump nginx-unprivilege to fix CVE (#10754)

**What this PR does / why we need it**:

**Which issue(s) this PR fixes**:
Fixes #10746 

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [x] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",25,66,1,0,"2018-04-16 10:25:39","1999.2"
"grafana/loki","bb0a64a64bcb4be19440838e7bd275c02be73e30","daixiang0","2019-12-18 14:05:05","false","fix all misspell (#1437)

Signed-off-by: Xiang Dai <764524258@qq.com>",97,20,0,0,"2018-04-16 10:25:39","607.4"
"grafana/loki","73f9ece8679e85a6d09ad367838b3f7d820af84f","liguozhong","2023-03-31 15:43:54","true","[doc] client : ilogtail loki integration (#8970)

**What this PR does / why we need it**:
https://github.com/alibaba/ilogtail/pull/685

ilogtail is a very popular log agent in China, with tens of millions of
installations. The open source community of ilogtail has completed the
integration of loki. This PR is completed as a supplement to loki doc

demo config，Type: flusher_loki
```yaml
enable: true
inputs:
  - Type: file_log
    LogPath: .
    FilePattern: simple.log
flushers:
  - Type: flusher_loki
    URL: http://localhost:3100/loki/api/v1/push
    ExternalLabels:
      source: ilogtail
```

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:
flusher_loki PR snapshot

![image](https://user-images.githubusercontent.com/9583245/229053024-66fcd286-a2f8-4a32-9ec5-758b63554986.png)

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",81,59,1,1,"2018-04-16 10:25:39","1806.22"
"grafana/loki","8154f3f2b4e7f40b81e4a8374ca31f4b51a92cbc","Red-GV","2022-03-18 08:11:37","true","operator: Update developer addons (#5599)",309,47,0,1,"2018-04-16 10:25:39","1427.66"
"grafana/loki","1c9160bc4b936f521d84fc136dccaa510d2227d9","JStickler","2023-07-12 15:50:06","true","Remove aliases to current location. (#9911)

Re: [this comment
](https://github.com/grafana/loki/pull/9890#pullrequestreview-1521562982)from
@jdbaldry on #9890 that ""Relative aliases that refer to the current page
location won't be effective and should be removed because they can cause
confusion and might result in mistaken redirects in the future if pages
are moved again.""

Removing aliases that refer to the current location of the pages.",59,63,1,0,"2018-04-16 10:25:39","1912.48"
"grafana/loki","20d801a09da3605ae6e24584a08abb2e958fd893","TeddyAndrieux","2022-11-22 15:51:57","true","helm/loki: Remove extra `/` if `registry` or `repository` is empty (#7746)

**What this PR does / why we need it**:

It removes the extra `/` when `registry` or `repository` is empty

**Which issue(s) this PR fixes**:
Fixes #7739 

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the `CONTRIBUTING.md` guide
- [x] `CHANGELOG.md` updated",95,55,1,0,"2018-04-16 10:25:39","1677.23"
"grafana/loki","4202ceda8fb8276c925c8a364ef6e5914f96d960","dawidmalina","2019-11-27 19:01:40","false","Wrong api endpoiont in fluent-plugin-grafana-loki (#1326)

Closes: #1307",84,19,0,0,"2018-04-16 10:25:39","586.61"
"grafana/loki","a96f6aefcdb9d07d1bae1391b56de347392f9627","sleleko","2019-04-11 07:04:51","true","Create promtail-examples.md

simple configs and description",97,12,0,0,"2018-04-16 10:25:39","354.86"
"grafana/loki","8d6bcd4083606b0271f2cbba67d5d73c2225292d","periklis","2023-10-02 13:01:23","true","operator: Allow endpoint_suffix in azure object storage secret (#10715)

Co-authored-by: Robert Jacob <xperimental@solidproject.de>",31,65,1,1,"2018-04-16 10:25:39","1992.36"
"grafana/loki","f6dabc81c0278733bcf642ea2d62377a1cc73fde","periklis","2022-11-17 13:06:46","true","operator: Refactor proxy env variables (#7682)",93,55,1,1,"2018-04-16 10:25:39","1672.11"
"grafana/loki","a8d1839b224580446f2ebb8532ba27f20714bac8","periklis","2022-10-04 10:32:51","true","operator: Move Loki operand from v2.6.1 to main-ec0bf70 (#7298)",92,54,1,1,"2018-04-16 10:25:39","1629.01"
"grafana/loki","c8bdb37ef36fe00db84f9d38f8f0f71eaf6b7011","cyriltovena","2022-03-04 13:58:33","true","update loki go version to 1.17.8 (#5543)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",297,46,0,1,"2018-04-16 10:25:39","1413.9"
"grafana/loki","5c006783e9da7bcb264299d32e36777e19ab4356","woodsaj","2019-01-29 09:02:57","false","set __path__ correctly in promtail config (#245)

__path__ is now expected to be a `glob` match, not a directory.  In k8s the ""glob"" expression needed is just the exact file path of the container log, which is `/var/log/pods/<podUID>/<container_name>/0.log`",66,9,0,0,"2018-04-16 10:25:39","282.94"
"grafana/loki","4bf77662d35789b92a2bf04bfec3c802caba3473","cyriltovena","2019-07-18 12:49:58","true","rounds nanoseconds boundaries to milliseconds (#771)

* rounds nanoseconds boundaries to milliseconds

* convert also store query",103,15,0,1,"2018-04-16 10:25:39","457.35"
"grafana/loki","238053f8c3f1c35f5fe34e2c0ae790d7bf78e859","hongbo-miao","2023-08-27 23:51:44","true","docs: fix menu title (#10343)

**What this PR does / why we need it**:

Just fix a small typo at
https://grafana.com/docs/loki/latest/logql/analyzer/ ☺️


![image](https://github.com/hongbo-miao/loki/assets/3375461/19b79610-eb69-4c99-b2da-3aea8d9acb35)

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",49,64,1,0,"2018-04-16 10:25:39","1957.81"
"grafana/loki","b9b447d0324662704cbccac1e1d2b1dc45986264","MichelHollands","2023-10-06 18:27:21","true","Build and publish build image (#10807)

**What this PR does / why we need it**:

This will create a new 0.30 build image and publish it to github.

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

Signed-off-by: Michel Hollands <michel.hollands@gmail.com>",25,66,1,1,"2018-04-16 10:25:39","1996.58"
"grafana/loki","8afb2ce3f11f73b361c192fc3096977e41a764a3","espenmeidell","2023-02-01 14:39:41","true","Loki: Add the ability to wait on SIGTERM before shutting down (#8371)

Co-authored-by: Michel Hollands <42814411+MichelHollands@users.noreply.github.com>",78,57,1,0,"2018-04-16 10:25:39","1746.18"
"grafana/loki","da54d33e336e76642bf793f5c5f484e8b0c2b84d","rfratto","2021-01-22 14:06:34","true","promtail: pass registerer to gcplog (#3191)

* promtail: pass registerer to gcplog

* enforce gcplog NewMetrics registerer to be non-nil

* reformat gcplog/targetmanager.go",117,33,0,1,"2018-04-16 10:25:39","1006.65"
"grafana/loki","e2e695e8cdad15f3e9099ed628d72c9b35e533fe","MasslessParticle","2023-07-06 18:29:11","true","Get basic statistics from series volume requests (#9832)

The `series_volume` endpoint returns stats about the call. This PR wires
things up such that basic stats are returned:
- Execution time
- Number of responses",58,63,1,1,"2018-04-16 10:25:39","1906.59"
"grafana/loki","2b0d0201461eda81e5c428a5596758dd267b3cc4","pracucci","2021-11-26 16:29:53","true","Refactor pkg/util/server to avoid cortexpb import in downstream projects vendoring logql (#4833)

Signed-off-by: Marco Pracucci <marco@pracucci.com>",215,43,0,0,"2018-04-16 10:25:39","1316"
"grafana/loki","d4cae667ae84d0528bef68185f40d26141a029c2","pstibrany","2020-01-24 13:14:43","false","loki: use new runtimeconfig package from Cortex (#1484)

* loki: use new runtimeconfig package from Cortex

runtimeconfig is a generalization of previous ""overrides"" mechanism,
and can be used not for per-tenant limits, but other parts of Loki
too (only one additional usage for now is ""multi"" KV client).

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* go mod tidy, go mod vendor

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Removed RuntimeConfig from Ingester dependencies.

Ingester already depends on RuntimeConfig via Store and Overrides mechanism.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Removed extra new line.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Remove unused method.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Fix broken code after rebasing.
Removed incorrect comment.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Updated docs with section about runtime configuration. Mostly copied from Cortex.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* go mod tidy, go mod vendor

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Updated Cortex to current master.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Go mod tidy, vendor

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>",99,21,0,0,"2018-04-16 10:25:39","643.37"
"grafana/loki","d84026cab6a2de6bccbb65d25c970969dbd8afbb","chaudum","2023-10-18 15:28:04","true","Adjust bloom gateway request structure (#10926)

**What this PR does / why we need it**:

Since we already group chunkRefs by fingerprint on the client side to
determine the correct bloom gateway to send the request to, we can keep
the grouping for the gRPC request.
This will not only optimize the request size, but also helps to reduce
complexity of querying blooms on the bloom gateway itself.

There is still conversion between `[]*logproto.ShortRef` and
`v1.ChunkRefs` required, which could be removed by sending
`v1.ChunkRefs` over the wire.

**Special notes for your reviewer**:

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",20,66,1,1,"2018-04-16 10:25:39","2008.46"
"grafana/loki","57b384df8fab9c1c02ec2f20e6172b0fd659d333","chaudum","2022-01-31 15:38:45","true","Auto-expire old items from FIFO cache (#5148)

* Remove validity from FIFO cache

We can remove the validity setting of 1h in 2.4 for the
chunks cache because it doesn't reduce memory usage and instead leads to
valid chunks being ignore when querying the cache. Chunks are immutable
so it doesn't make sense to not return them if they are present in the
cache.

Closes #4922

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* Add periodic task to prune old FIFO cache elements

As described in #4921 this PR adds a periodic task that prunes expired
items from the FIFO cache to free up memory.

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* Apply suggestions from code review

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>",277,45,0,1,"2018-04-16 10:25:39","1380.97"
"grafana/loki","9a82f5c04a58ac04c93623e3ce03b638839594ed","chaudum","2022-06-03 12:13:18","true","Look up config file in default locations (#6160)

* Look for config.yaml file in ./ and ./config directories

This change makes Loki look for a config file in the current directory
or in the config/ sub-directory.

This is a pre-requisite for making an easy-to-use tarball distribution
that also ships a config.yaml

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* Rename YAMLFlag to ConfigFileLoader

The `YAMLFlag` function is solely used for loading config files.

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* fixup! Look for config.yaml file in ./ and ./config directories

* fixup! fixup! Look for config.yaml file in ./ and ./config directories

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* fixup! fixup! fixup! Look for config.yaml file in ./ and ./config directories

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",72,50,0,1,"2018-04-16 10:25:39","1508.07"
"grafana/loki","feba83a3ac34c3a63a6bef6e73ddf4ce00572462","vlad-diachenko","2023-07-31 19:29:47","true","[GEL jsonnet] fixed PDB creation (#10121)

removed redundant pdb name override because the constructor of
`podDisruptionBudget` requires the name to be defined during object
creation.

Re: https://github.com/grafana/loki/pull/9978/files

Signed-off-by: Vladyslav Diachenko <vlad.diachenko@grafana.com>",52,63,1,0,"2018-04-16 10:25:39","1931.63"
"grafana/loki","92b010230ff43fe272aac3de01d01c649ee8f9b3","grafanabot","2023-10-27 14:50:41","true","[CI/CD] Update yaml file `./production/helm/loki/Chart.yaml` (+1 other) (#11027)

**Here is a summary of the updates contained in this PR:**
***
Update attribute `$.appVersion` in yaml file
`./production/helm/loki/Chart.yaml` to the following value: `2.9.2`
***
Bump version of Helm Chart
Add changelog entry to `./production/helm/loki/CHANGELOG.md`
Re-generate docs",17,66,1,0,"2018-04-16 10:25:39","2017.43"
"grafana/loki","0215a171486eacc3d59c813f9b87d3d54b184a62","eraac","2023-04-14 19:22:29","true","gcplog: improve formatter (#9044)

**What this PR does / why we need it**:

Add two improvement to the target `gcplog`
* capability to ignore the `textPayload` from the log line -> don't
trunk important metadata
* add new source labels (severity and root labels of log entry) -> more
relabel_config possibilities

**Special notes for your reviewer**:

I'm not sure about the naming of the option `useFullLine`, feel free to
suggest any name, but I guess this feature must be disable by default
for compatibility?

**Checklist**
- [X] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [X] Documentation added
- [X] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

---------

Signed-off-by: Kevin Labesse <kevin@labesse.me>
Co-authored-by: J Stickler <julie.stickler@grafana.com>",81,60,1,0,"2018-04-16 10:25:39","1819.37"
"grafana/loki","03c15a6ee58d4f7803f502c519ce45b642779b84","slim-bean","2019-11-20 05:31:06","true","update changelog for 1.0.0 (#1291)",74,19,0,1,"2018-04-16 10:25:39","579.05"
"grafana/loki","bb8f01fed40465b08af131877ad07c50d50eae66","kavirajk","2023-08-04 09:28:20","true","chore(CODEOWNERS): Remove dependabot (#10165)

**What this PR does / why we need it**:
This is not needed as
(1) Adding it on codeowners have no impact for dependabot 
(2) CODEOWNER linter errors complanining about dependabot not existing
and don't have write access to the repo

<img width=""619"" alt=""Screenshot 2023-08-04 at 10 00 44""
src=""https://github.com/grafana/loki/assets/3735252/ad6b190d-27cf-4fd9-b05e-d076b0e4c62f"">


**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",52,64,1,1,"2018-04-16 10:25:39","1934.21"
"grafana/loki","20696522fee0a6f3011274c9a0f8f42019a7fbd2","chaudum","2023-02-16 16:17:07","true","lambda-promtail: Add option to omit extra labels prefix `__extra_` (#8548)

If you want to add an extra label env, lambda-promtail would add the __extra_ prefix, so that the resulting label is __extra_env. However, if you already have the env variable in other stream and you want to have consistent label naming, you would want to omit the prefix so the resulting label is env.

Closes https://github.com/grafana/loki/issues/8471

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",72,58,1,1,"2018-04-16 10:25:39","1761.24"
"grafana/loki","59a2afaed9f089f7f20412147e144f1160c62899","MichelHollands","2023-11-03 10:22:16","true","Update changed metrics in docs (#11109)

**What this PR does / why we need it**:

After the default metrics namespace is changed to ""loki"" these metrics
mentioned in the docs have to change as well. Should be merged at the
same time as https://github.com/grafana/loki/pull/11110

**Checklist**
- [X] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)
- [ ] If the change is deprecating or removing a configuration option,
update the `deprecated-config.yaml` and `deleted-config.yaml` files
respectively in the `tools/deprecated-config-checker` directory.
[Example
PR](https://github.com/grafana/loki/pull/10840/commits/0d4416a4b03739583349934b96f272fb4f685d15)

Signed-off-by: Michel Hollands <michel.hollands@gmail.com>",11,66,1,1,"2018-04-16 10:25:39","2023.25"
"grafana/loki","de236b22137c24631ee501d79b4b1fdb55922658","periklis","2021-10-01 14:34:19","true","Fix target registry for docker-push-action (#88)",138,41,0,1,"2018-04-16 10:25:39","1260.92"
"grafana/loki","12d418b7ccf275395425a3fec06ae580e68388a9","sandeepsukhani","2021-06-17 07:00:17","true","docs for logs deletion feature (#3826)

* docs for logs deletion feature

* update doc

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>",102,38,0,1,"2018-04-16 10:25:39","1156.61"
"grafana/loki","8ea5fd173f01a42f0d9d409909e839d9b6268da1","cyriltovena","2020-11-20 15:21:35","true","Implement io.WriteTo by chunks. (#2962)

This allows to totally defer the buffer creation to the user.
`Marshal(w io.Writer) error` Now don't even need to create a buffer.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",118,31,0,1,"2018-04-16 10:25:39","944.71"
"grafana/loki","a85ce664ea3e303fbe3e9370185c3b81a3928159","slim-bean","2020-02-05 19:03:29","false","improve systemd field docs

Signed-off-by: Edward Welch <edward.welch@grafana.com>",109,22,0,1,"2018-04-16 10:25:39","654.61"
"grafana/loki","26596b5c793b1974be16c3f23047921c085d25bd","daixiang0","2019-04-26 03:16:10","false","Add custom help info

Signed-off-by: Xiang Dai <764524258@qq.com>",96,12,0,0,"2018-04-16 10:25:39","374.95"
"grafana/loki","8fd956e439cf096130e7ce55fd1e13fb05506eea","SadFaceSmith","2023-02-01 15:15:14","true","Snyk Workflow add (#8375)",78,57,1,0,"2018-04-16 10:25:39","1746.2"
"grafana/loki","297cc63e5d889ee6631fe6749deebae2e5cd54aa","erwinvaneyk","2019-09-19 16:46:42","false","Fix externalURL and path prefix issues (#1026)",66,17,0,0,"2018-04-16 10:25:39","518.51"
"grafana/loki","fe71c7e9d91b6de4c2aee1c02a673684428e892c","ceriath","2023-10-05 11:02:45","true","helm: Add complete object schema to single-binary volumeClaimTemplate to avoid synchronization issues (#10519)

**What this PR does / why we need it**:
This PR completes the object schema for the volumeClaim template inside
the single-binary helm chart. Currently it omits the apiVersion and the
kind.
This is working, because kubernetes auto-fills those values, however it
is causing an issue when you are trying to synchronize your helm chart
with your deployment (in my case with argoCD). It will be shown as out
of sync, because kubernetes has the fields, while the chart does not.
Syncing works, because kubernetes accepts it without apiVersion and
kind, but adds it itself again. That results in an endless sync-loop,
that could be avoided by adding these to the helm template.

Since both values are already filled in by kubernetes, this will not
break anything nor result in any diff for existing deployments.

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [x] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

Co-authored-by: Michel Hollands <42814411+MichelHollands@users.noreply.github.com>",26,66,1,0,"2018-04-16 10:25:39","1995.28"
"grafana/loki","c7a1a1fb2e71514567dcbbcdb9e6011aa3da9df9","slim-bean","2020-04-27 14:09:57","true","Loki: Adds an `interval` paramater to query_range queries allowing a sampling of events to be returned based on the provided interval (#1965)

* Adds an `interval` paramater to query_range queries allowing a sampling of events to be returned based on the provided interval

Signed-off-by: Ed Welch <edward.welch@grafana.com>

* lint

Signed-off-by: Ed Welch <edward.welch@grafana.com>

* extract function for parsing parameter

Signed-off-by: Ed Welch <edward.welch@grafana.com>

* Clarify the experimental nature of interval in the docs.

Signed-off-by: Ed Welch <edward.welch@grafana.com>

* make min time a constant

Signed-off-by: Ed Welch <edward.welch@grafana.com>

* Expand the docs around the experimental nature of interval a little more

Signed-off-by: Ed Welch <edward.welch@grafana.com>",115,24,0,1,"2018-04-16 10:25:39","741.66"
"grafana/loki","0c9beadaaa1793b30f13e09975f7365e9daefc4e","slim-bean","2021-11-01 15:07:06","true","Loki: Add a ring to the compactor used to control concurrency when not running standalone (#4574)

* add a ring to the compactor

* wiring up the start/stop functionality

* add some monitoring for multiple compactors running at the same time.

* Add compactor to `read` target

* fix tests/validation requirements

* Update pkg/storage/stores/shipper/compactor/compactor_ring.go

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>

* Update pkg/storage/stores/shipper/compactor/compactor_ring.go

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>

* Update pkg/storage/stores/shipper/compactor/compactor_ring.go

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>

* used a shared ring_config between scheduler and compactor to avoid some duplication

* fix lint

* better handling of the tokens file with a way to easily tell all the rings to persist tokens

* fix query scheduler replication factor

* removing ""scheduler"" from log line which may be called by components other than a scheduler in the future.

* update changelog

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>",169,42,0,1,"2018-04-16 10:25:39","1290.95"
"grafana/loki","d3bf21e7742882d6696e865ddde0f8b8a081bc96","slim-bean","2020-10-01 18:46:46","true","Promtail: (and also fluent-bit) change the max batch size to 1MB  (#2710)

* change the max batch size to 1MB for all the defaults including helm and fluent-bit, attempt to centralize this config a little where possible.

* fix test",116,29,0,1,"2018-04-16 10:25:39","895.85"
"grafana/loki","806cd73e53af2f206330d4d955d9d79bca4918c5","cest-pas-faux","2023-06-07 13:37:50","true","Fix configmap checksum in read sts (#9642)

**What this PR does / why we need it**:

@NilsGriebner : complement to #9579

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [x] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

---------

Co-authored-by: Michel Hollands <42814411+MichelHollands@users.noreply.github.com>",68,62,1,0,"2018-04-16 10:25:39","1877.38"
"grafana/loki","b136d0dab36adb732fc9d503e76222e182d85792","slim-bean","2022-04-05 11:55:44","true","Increase flush_op_timeout to 10m, 10s is often much too short for a big WAL replay which can generate a lot of chunks very quickly. (#5768)

Signed-off-by: Ed Welch <edward.welch@grafana.com>",320,47,0,1,"2018-04-16 10:25:39","1444.81"
"grafana/loki","0c58c788285384a25d99c459efdbdc2ad4700469","slim-bean","2023-10-06 13:34:39","true","Index Gateway: Set some concurrency limits around concurrent index table processing (#10768)

**What this PR does / why we need it**:

This addresses an issue we've seen with index gateways when handling
queries that touch a large number of series, although these are
improvements not necessarily solutions.

We've seen a tremendous amount of goroutines being spawned while
processing GetChunkRefs requests, specifically when the gateways have
recently found a lot of uncompacted recent ingester tables.

This PR puts some limits on the parallelism of processing tables, the
implementation is a bit arbitrary, we limit the concurrent iterations to
GOMAXPROCS/2

In practice this is potentially still too much as an index gateway will
be serving many requests in parallel witch each able to do parallel
table iteration, however it's a more reasonable line in the sand than
having no limits and eases some pressure on the Go scheduler.

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

---------

Signed-off-by: Edward Welch <edward.welch@grafana.com>",26,66,1,1,"2018-04-16 10:25:39","1996.38"
"grafana/loki","09927db78da8a3904c39452877a9b68a9d6a75db","slim-bean","2023-10-13 16:15:18","true","Jsonnet: update index gateway client to use headless service, fix a bug in index gateway storage config application (#10894)

fixes a bug in applying the storage_config for tsdb (the else{}
prevented the configs from applying, don't know why.

Updates the index gateway client to use the new headless service.

**What this PR does / why we need it**:

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

---------

Signed-off-by: Edward Welch <edward.welch@grafana.com>",25,66,1,1,"2018-04-16 10:25:39","2003.49"
"grafana/loki","4b44e50dfe13a55790649139a046e993c99d45bb","shokada","2020-02-11 13:40:43","true","Update tanka.md so that promtail.yml is in the correct format (#1671)",112,22,0,0,"2018-04-16 10:25:39","660.39"
"grafana/loki","7979cfbe076da067ab4057b513f1df7502eb4404","MasslessParticle","2022-10-06 22:12:38","true","Implement Distributor Rate Store (#7349)

The `RateStore` concurrently queries all ingester `GetStreamRate` APIs
and stores the results. `RateStore` deduplicates replicas and combines
sharded streams so a caller of `RateFor` gets an unsharded view of a
stream's rate.",92,54,1,1,"2018-04-16 10:25:39","1631.49"
"grafana/loki","7bac502ddaed8a0fedb381bd0171c9f325e25f5f","owen-d","2021-04-13 22:58:34","true","Dashboard/fix operational vars (#3601)

* loki operational dashboard uses more refined variables

* excludes loki canary",156,36,0,1,"2018-04-16 10:25:39","1088.02"
"grafana/loki","ebef2fe1cd3dd73702b7b4452bc70233bbbffb98","chaudum","2023-09-12 09:55:41","true","Remove backup index writer from TSDB configuration (#10534)

The setting `use_boltdb_shipper_as_backup` (`-tsdb.shipper.use-boltdb-shipper-as-backup`) was a remnant from the
development of the TSDB storage.
It was used to allow writing to both TSDB and BoltDB when TSDB was still highly experimental.
Since TSDB is now stable and the recommended index type, the setting has become irrelevant and therefore was removed.
The previous default value `false` is applied.

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",42,65,1,1,"2018-04-16 10:25:39","1972.23"
"grafana/loki","b9f276cfed85a8c569cc58f46fd2127756df1ea0","hassanfarid","2020-05-26 20:51:22","true","updated documentation links to relative. (#2135)

* updated documentation links to relative.

The documentation is pointing to mast always, and is difficult and in-accurate to navigate for specific tag / version.

* fixed relative path",122,25,0,0,"2018-04-16 10:25:39","770.93"
"grafana/loki","2bbb46484851ca41d699335e98017a3f32ca3a20","pracucci","2019-07-08 14:09:59","false","Fixed orderedDeps() order stability (#721)",98,15,0,0,"2018-04-16 10:25:39","447.41"
"grafana/loki","690a387cce93bbd5d6e243210c431d2129c4f26f","kavirajk","2020-10-14 10:50:59","true","fix: Remove depricated `entry_parser` from scrapeconfig (#2752)",113,30,0,1,"2018-04-16 10:25:39","908.52"
"grafana/loki","cb757a4a3a9f98f71b29d09138291a674dc2757d","xperimental","2022-03-22 12:34:45","true","operator: Update to Go 1.17 (#5695)

* Update Go 1.17

* Migrations for Go 1.17

* Update bingo and add missing sum files

* Update mention in doc

* Update changelog

* Update Go in workflows",310,47,0,1,"2018-04-16 10:25:39","1431.84"
"grafana/loki","1269c9266382e7e72b29512d00beb151868a8571","owen-d","2020-01-23 15:57:53","false","refactors splitby to not require buffered channels (#1569)",98,21,0,1,"2018-04-16 10:25:39","642.48"
"grafana/loki","a32cbeb37ad7421499d2d835caa6d68f940e68a4","bboreham","2023-08-30 05:38:11","true","indexshipper/storage: fix race conditions (#10314)

**What this PR does / why we need it**:
There were many race conditions reported if you run `go test -race` on
this package.
Google's 'singleflight' package is much neater and makes all the race
warnings go away.

**Which issue(s) this PR fixes**:
Relates to #8586

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- NA Documentation added
- NA Tests updated
- [x] `CHANGELOG.md` updated
- NA If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- NA Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- NA For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",47,64,1,0,"2018-04-16 10:25:39","1960.05"
"grafana/loki","3d7119d8a7fab7e70af500afce8f18ac750458e2","gouthamve","2019-05-09 12:15:52","false","Add a histogram for chunk encoding time (#565)

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>",98,13,0,0,"2018-04-16 10:25:39","388.33"
"grafana/loki","ef31a4c56480c5943fb890d3611c94713e0e2b39","periklis","2021-04-06 16:08:24","true","Add API for the Loki stack (#15)

Co-authored-by: Periklis Tsirakidis <periklis@redhat.com>",146,36,0,1,"2018-04-16 10:25:39","1080.74"
"grafana/loki","c75b822fc6998ca57bf53451ec6dc2038c7c1a5e","MasslessParticle","2022-11-01 15:00:17","true","Track rates per stream and per tenant (#7564)

It is possible for two tenants to have streams with the same labels.
This PR changes the stream tracking in the `shard_tracker`,
`stream_rate_calculator`, and `rate_store` to account for tenant ID when
tracking streams.",88,54,1,1,"2018-04-16 10:25:39","1656.19"
"grafana/loki","bdacf39013186817f305d30db309e49fcdbb4f6e","sboschman","2019-04-01 12:41:06","false","include all lifecycler ring config",96,11,0,0,"2018-04-16 10:25:39","345.09"
"grafana/loki","e60164bef6e416bc0884c953c6a18aba52b41b65","pstibrany","2020-04-23 16:21:51","true","Convert Loki modules to services (#1804)

* Loki now uses module services to start and stop its work.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Use services methods to initialize some components.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Use Cortex' NewModuleService.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Converted server to a service.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Converted distributor to service.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Use table manager service

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* querier service

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* query-frontend service

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Merged stopping method into shutdown

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Converted ingester to a service.

It now starts all background tasks in Starting state.
Stopping needs little work, as does reacting on lifecycler errors.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Loki

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* If lifecycler fails, ingester fails too.

It now doesn't call os.Exit, but shuts down gracefully and enters Failed state.
That triggers Loki to shutdown completely.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Ignore ErrStopProcess errors from services

This is a signal that Loki should stop.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Use single /ready handler

It checks the state of all services, and asks ingester for its own check as well.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Removed unused value.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Lint

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Fix test.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Go mod tidy, vendor

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Tailers, not trailers.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Adds return for the healtcheck in case of error.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

Co-authored-by: Cyril Tovena <cyril.tovena@gmail.com>",116,24,0,0,"2018-04-16 10:25:39","737.75"
"grafana/loki","4c418430be1622fc5b3b091a3daec83a0bedd75c","rfratto","2019-08-21 19:01:25","true","promtail: add ""max_age"" field to configure cutoff for journal reading (#921)

The journal scrape config in promtail has been updated to support
a ""max_age"" field. max_age determines the oldest journal entry
promtail will read when starting the journal reader. When
unspecified, max_age defaults to 7h.

Even if a position in the journal is saved in the promtail
positions file, that position may be ignored if the entry corresponding
to that position is older than the max_age cutoff time.

Example promtail config for getting up to the last 12h of journal
entries:

  server:
    http_listen_port: 9080
    grpc_listen_port: 0

  positions:
    filename: /tmp/positions.yaml

  clients:
    - url: http://localhost:3100/api/prom/push

  scrape_configs:
  - job_name: journal
    journal:
      max_age: 12h
      path: /var/log/journal
      labels:
        job: systemd-journal
    relabel_configs:
      - source_labels: ['__journal__systemd_unit']
        target_label: 'unit'",117,16,0,1,"2018-04-16 10:25:39","490.61"
"grafana/loki","044d06015d0d6fe9d44891f1d8c678298a109b67","owen-d","2022-10-03 17:49:26","true","adds result cache key version comparison metrics (#7323)

Followup to https://github.com/grafana/loki/pull/7300 which gives more
metric visibility into the underlying errors when comparing cache key
versions on the queriers vs query frontends.",92,53,1,1,"2018-04-16 10:25:39","1628.31"
"grafana/loki","4a3e6f9d95aa612bf275ea3ebd5c00402a2283d4","MasslessParticle","2023-01-12 16:59:43","true","Bump go modules GitHub.com prometheus alertmanager 0.25.0 (#8100)

This PR required some code changes:
https://github.com/grafana/loki/pull/8095

We have all the information, it's just plumbed in a little different
now.

Signed-off-by: dependabot[bot] <support@github.com>
Co-authored-by: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>",100,57,1,1,"2018-04-16 10:25:39","1727.27"
"grafana/loki","dd4c1387b6da97452c1b2d9a18e29500d6eaf6d8","joe-elliott","2019-10-30 18:23:58","false","Remove rules that reference no longer existing metrics

Signed-off-by: Joe Elliott <number101010@gmail.com>",67,18,0,0,"2018-04-16 10:25:39","559.58"
"grafana/loki","ee74fbdf3a07c572376b02ecf74b1d9253d58f6b","bboreham","2023-05-30 15:47:17","true","logql/log tests: use abstractions over labels (#9532)

**What this PR does / why we need it**:

Call functions like `FromStrings`, so we don't have to know how the data
structure is laid out.

`FromStrings` sorts labels, so we don't have to call `Sort()`.

**Special notes for your reviewer**:

This PR only touches tests. 

Upstream Prometheus is using a different implementation of
`labels.Labels`, so I plan to create a series of PRs which make Loki
compatible with that.

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- NA Documentation added
- [x] Tests updated
- NA `CHANGELOG.md` updated
- NA Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- NA For Helm chart changes bump the Helm chart version.

Signed-off-by: Bryan Boreham <bjboreham@gmail.com>",68,61,1,0,"2018-04-16 10:25:39","1870.47"
"grafana/loki","8f6d3d97e36447a74f8c32a9caf6dc1b43a89250","Red-GV","2022-02-24 16:39:40","true","Add support for additional storage backends in operator (#5432)",302,46,0,1,"2018-04-16 10:25:39","1404.01"
"grafana/loki","0c826b834a68e064306c835e834fff7e08172109","owen-d","2022-04-07 19:17:12","true","Tsdb/compaction (#5783)

* ChunkMetas.finalize uses pool

* slight refactoring. Uses pools during chunkmetas.finalize and adds an InclusiveBounds helper

* multi idx explicitly wraps tsdb files

* TSDB Checksum helper + requires at least 2 indices for MultiIndex constructor

* tsdb compaction impl

* skips compacting a single file

* compaction + testing

* tsdb compaction tests

* passes reference to &index.ChunkMetasPool for avoiding nocopy

* linting

* gitignore .vscode

* s/Combine/FilePath/g",320,48,0,1,"2018-04-16 10:25:39","1447.12"
"grafana/loki","38e5e410feb128730f2bf4bc9a97d4c33863fbdf","chaudum","2022-04-21 06:53:42","true","Do not parse string of empty matchers (#5980)

This fixes a bug in the index gateway when querying values for a label.
Since the gRPC handler for LabelValuesForMetricName in the index gateway
allows empty matchers in the LabelValuesForMetricNameRequest, we need to
check if the matchers string is an empty matcher (`{}`) before we parse
the string.

This bug was introduced with the index gateway api refactoring in #5892

Fixes: #5965

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",172,48,0,1,"2018-04-16 10:25:39","1465.85"
"grafana/loki","fee58f1a7183e38f56c37611453d95ada93fdaa5","owen-d","2020-04-15 14:10:12","true","delete tag script filters by prefix instead of substring (#1942)",120,24,0,1,"2018-04-16 10:25:39","724.41"
"grafana/loki","475eb6a1905bbf630498b6912be818d19bb35958","MichelHollands","2023-04-27 14:47:07","true","Remove shutdown marker file when shutting down (#9314)

**What this PR does / why we need it**:

This removes the shutdown marker file when actually shutting down. If
the PVC is re-used then the marker file shouldn't be there.

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>
Co-authored-by: Dylan Guedes <djmgguedes@gmail.com>",80,60,1,1,"2018-04-16 10:25:39","1837.43"
"grafana/loki","6a12aef09710a07fb2389f46d5fe11c95727cb40","periklis","2021-05-20 06:50:16","true","Add support for a per component pod status map (#50)",201,37,0,1,"2018-04-16 10:25:39","1129.6"
"grafana/loki","e07fe7c3382d59dc21ed0ede4b7ba6377ebb49fc","ssncferreira","2022-12-14 15:43:47","true","Deprecate CLI flag -ruler.wal-cleaer.period in favor of CLI flag -ruler.wal-cleaner.period (#7937)

**What this PR does / why we need it**:

Deprecate CLI flag `-ruler.wal-cleaer.period` in favor of CLI flag
`-ruler.wal-cleaner.period`.

**Which issue(s) this PR fixes**:
Fixes https://github.com/grafana/loki/pull/7916#issuecomment-1348276269
and https://github.com/grafana/loki/pull/7916#discussion_r1047043534

**NOTE:** correctly registring the `ruler.wal-cleaner` configuration
flags is not a breaking change and doesn't require an upgrade guide,
because the ruler WAL cleaner initialization code already guarantees
that the default values are used:
https://github.com/grafana/loki/blob/c71620ae9437aa23142cdc410115f28ae8f29997/pkg/ruler/storage/cleaner/cleaner.go#L76-L101

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the `CONTRIBUTING.md` guide
- [x] Documentation added
- [ ] Tests updated
- [x] `CHANGELOG.md` updated
- [x] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",101,56,1,0,"2018-04-16 10:25:39","1699.22"
"grafana/loki","f93b91bfb57e65f0a783d97fc3875283d7997409","ssncferreira","2022-12-14 10:47:54","true","Add configuration documentation generation tool (#7916)

**What this PR does / why we need it**:

Add a tool to generate configuration flags documentation based on the
flags properties defined on registration on the code. This tool is based
on the [Mimir doc generation
tool](https://github.com/grafana/mimir/tree/main/tools/doc-generator)
and adapted according to Loki configuration specifications.

Prior to this PR, the configuration flags documentation was dispersed
across two sources:
*
[_index.md](https://github.com/grafana/loki/blob/5550cd65ecd2299b219d26501221df0b191d8a78/docs/sources/configuration/_index.md)
* configuration flags registration in the code

This meant that there was no single source of truth. 
In this PR, the previous `_index.md` file is replaced with the new file
generated by the tool.

The next step includes adding a CI step that validates if the _index.md
file was generated according to the flags settings. This will be done in
a follow-up PR.

**NOTE:** this is not a documentation update PR. Apart from some minor
typo fixes, the documentation changes on the code, were copied from the
`_index.md` file.

**Which issue(s) this PR fixes**:
Fixes https://github.com/grafana/loki-private/issues/83

**Special notes for your reviewer**:

Files:
*
[docs/sources/configuration/index.template](https://github.com/grafana/loki/blob/5550cd65ecd2299b219d26501221df0b191d8a78/docs/sources/configuration/index.template):
template used to generate the final configuration file
*
[/docs/sources/configuration/_index.md](https://github.com/grafana/loki/blob/c32e5d0acb3cdacc9e50bb71a83a9ba42721e0e2/docs/sources/configuration/_index.md):
file generated by tool
* `loki/pkg` directory files updated with up-to-date documentation from
`_index.md` file
*
[tools/doc-generator](https://github.com/grafana/loki/tree/5550cd65ecd2299b219d26501221df0b191d8a78/tools/doc-generator)
directory with documentation generation tool.

**Checklist**
- [ ] Reviewed the `CONTRIBUTING.md` guide
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",101,56,1,0,"2018-04-16 10:25:39","1699.02"
"grafana/loki","bd3d80ad80445a20d7c0b5860b001bc9be557a47","MasslessParticle","2022-08-10 15:27:49","true","Add ability to limit the impact of pathological delete requests. (#6854)

* make per-tenant override the mode rather than binary on/off

* Rely on overrides to configure deletion

- Remove 'deletion_mode' flag

* add ability to delete requests at any time

* don't load requests from disabled tenants

* review comments

* fix tests

* loadDeleteRequestsToProcess cleanup

* lint

* docs

* review feedback

* lint",77,52,0,1,"2018-04-16 10:25:39","1575.21"
"grafana/loki","874d016bd75a6037b6553998f96b212e515b400c","rfratto","2019-12-17 16:03:32","false","promtail: add support for passing through journal entries as JSON

This commit adds an extra configuration field (`json`) to the journal
target configuration schema. When set to true, messages from the journal
target will be passed through as JSON, containing all of the fields from
the entry as keys and their values as the value.

For backwards compatibility, the value for `json` defaults to false.

Closes #1288.",95,20,0,1,"2018-04-16 10:25:39","606.48"
"grafana/loki","a2ceb8d2ad87388723d3770d2e9e0710761fe18d","pracucci","2019-07-15 12:24:11","false","Documented /ready, /metrics and /flush endpoints (#743)",104,15,0,0,"2018-04-16 10:25:39","454.33"
"grafana/loki","4de90321fd5b444c16113da473bb1e5e71b2a95f","telefax","2022-01-24 10:50:46","true","Update docker.md (#5213)

Create the containers in detached mode and name the promtail container ""promtail"".
Without this fix the first container must be stopped before the second one is started since they are running in foreground.
The promtail container didn't have any ""--name"" flag so docker assigns a random name to it.",273,45,0,0,"2018-04-16 10:25:39","1373.77"
"grafana/loki","fed39435960b2cf49e7ece3d4dc3ed679a608944","woodsaj","2019-01-17 18:22:45","false","allow promtail path to be a glob match (#206)

* allow promtail target path to be a glob match

Promtail now expects __path__ to be a glob. All files that match
the glob expression will be tailed.  If new files are created that
match the glob, they will immediately be tailed.

* remove entry from positions file when file is deleted

* fix syncing the current positions to positions file

* handle file renames

When a file is renamed a ""rename"" and a ""create"" event are sent.
We need to treat the rename as a remove.  If the new filename matches
the path glob, then we will start tailing it when the ""create"" event
is reveived.

* lint",62,9,0,0,"2018-04-16 10:25:39","271.33"
"grafana/loki","3640429532303fefc447e993141ab981bf040665","cyriltovena","2020-10-01 18:30:10","true","Bypass sharding middleware when a query can't be sharded. (#2709)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",117,29,0,1,"2018-04-16 10:25:39","895.84"
"grafana/loki","2909fe54e1f858ae4282451e1808fc0a20c80ee1","cyriltovena","2019-06-13 14:54:50","true","Docker Logging Driver (#663)

* adds first version of docker driver

* without logrus and fixes some linter issue

* fix the driver and start a build system

* adds swarm label discovery

* Add documentation and more targets

* make the linter happy :heart:

* indent config.json

* with circleci steps for master and branch

* Review Feebacks",108,14,0,1,"2018-04-16 10:25:39","422.44"
"grafana/loki","0a9beea929e9c912472061c5cc1d84b76fa5eff2","slim-bean","2019-05-03 15:07:16","false","adding benchmarks",98,13,0,1,"2018-04-16 10:25:39","382.45"
"grafana/loki","eedd3d9fc2cb6f47aae879722ebf0df6d118eabb","slim-bean","2019-07-09 18:58:06","false","prune interval is configurable
canary will suspend all operations on SIGINT but not exit, allowing you to shutdown the canary without it being restarted by docker/kubernetes
SIGTERM will shutdown everything and end the process",100,15,0,1,"2018-04-16 10:25:39","448.61"
"grafana/loki","9e16ffbd3b356495fc959bc324ba6f8c7a415420","jeschkies","2022-03-03 17:36:40","true","Support `SelectLogs` and `SelectSamples` in multi-tenant querier. (#5517)

**What this PR does / why we need it**:
This patch adds some functionality to the `MultiTenantQuerier` stub. `SelectLogs` and `SelectSamples` fan out into multiple calls, one for each tenant. The returned iterators are then merged back together and the proper tenant label is added.

**Which issue(s) this PR fixes**:
Fixes grafana/loki-private#232

**Special notes for your reviewer**:

**Checklist**
- [ ] Documentation added
- [x] Tests updated
- [ ] Add an entry in the `CHANGELOG.md` about the changes.",297,46,0,1,"2018-04-16 10:25:39","1413.05"
"grafana/loki","cbb272da00c632b5496a0939135590fab078afd4","salvacorts","2023-07-28 07:28:17","true","Add `_extracted` to non-indexed labels with same name as stream labels (#10082)

**What this PR does / why we need it**:

In https://github.com/grafana/loki/pull/9702 we added support for
returning non-indexed labels in the labels results. The problem is that
non-indexed labels may overwrite stream labels if both are named the
same way. This PR fixes this by adding an `_extracted` suffix if the
non-indexed label is already present in the stream labels.

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [x] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",51,63,1,1,"2018-04-16 10:25:39","1928.13"
"grafana/loki","00196ed35895f778476ff7c0bf74bb5f7e9ce5fc","blockloop","2021-04-06 21:28:30","true","fix make bundle (#18)",146,36,0,0,"2018-04-16 10:25:39","1080.96"
"grafana/loki","776e229e94f6a22cf1394437e5fb78121b504285","BenoitKnecht","2022-02-23 10:35:13","true","pkg/ruler/base: Add external_labels option (#5450)

This option can be used to add a set of labels to all alerts emitted by the
ruler.

Signed-off-by: Benoît Knecht <bknecht@protonmail.ch>",299,46,0,0,"2018-04-16 10:25:39","1402.76"
"grafana/loki","5fbc747392b96add1c2d0089191d21c384f738e7","JStickler","2023-02-27 09:03:32","true","Fixing broken link and removing out of date blog post. (#8632)

**Which issue(s) this PR fixes**:
* Starts to address #8631
* Removes link to outdated blog post that says ""Loki is very much alpha software and should not be used in production environments.""
* Fixes broken link to Configuration file.",70,58,1,0,"2018-04-16 10:25:39","1771.94"
"grafana/loki","3aff4dfe2f22c36911509cadf4c09ea70768adc5","pstibrany","2019-12-13 00:55:18","false","pkg/cfg: print help only when requested, and print it on stdout (#1396)

When invalid parameter or value is provided, error is printed to stderr,
together with message indicating how to get list of all parameters.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>",100,20,0,0,"2018-04-16 10:25:39","601.85"
"grafana/loki","5227f5bee066e0335b090ea01f67afee605cf5e7","owen-d","2019-12-07 15:56:41","false","application/x-www-form-urlencoded support (#1381)

* application/x-www-form-urlencoded support

* handler func instead of unnecessary struct",92,20,0,1,"2018-04-16 10:25:39","596.48"
"grafana/loki","230cd9cf943d37153d955d9968fb0f70818a0648","chaudum","2022-11-21 12:56:03","false","Make the `test` stage depend on `check-generated-files`

This is necessary, because the `check-generated-files` make target
depends on `protos`, which again depends on `clean-protos`.

When the `test` target is run and the protos are cleaned, compiling the
test binaries will fail.

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",95,55,1,1,"2018-04-16 10:25:39","1676.1"
"grafana/loki","8daa694d12665148ba1ba18fa2da9d6f8fea1f20","owen-d","2022-07-20 07:57:58","true","[Fix] Furthers gcs latency buckets (#6721)

* furthers gcs latency buckets
Signed-off-by: Owen Diehl <ow.diehl@gmail.com>

* adjusts bucket upper bound
Signed-off-by: Owen Diehl <ow.diehl@gmail.com>",71,51,0,1,"2018-04-16 10:25:39","1554.9"
"grafana/loki","46690e29311a080df7989b290e27b7fbf488d04c","wilfriedroset","2023-02-07 08:38:08","true","Add OVHcloud to sizing tool (#8423)

Signed-off-by: Wilfried Roset <wilfriedroset@users.noreply.github.com>",79,58,1,0,"2018-04-16 10:25:39","1751.93"
"grafana/loki","33553c9462ecc2a3ad7fd9d2b6b505bccdf21bd7","jdbaldry","2023-01-19 12:55:08","true","Use latest release of doc-validator image (#8211)

- Fixes regression where non-Markdown files are considered for linting.
- Uses a canonical algorithm for converting headings to anchor identifiers taken from the Hugo source.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>",83,57,1,0,"2018-04-16 10:25:39","1734.1"
"grafana/loki","e3db2671f4fd3e0ed449df970561694d0b5f394f","cyriltovena","2022-02-23 18:29:54","true","Do not insert point when missing when sharding (#5444)",301,46,0,1,"2018-04-16 10:25:39","1403.09"
"grafana/loki","0fd933104461b68a9818eb3694ae325a52e0fe36","JoaoBraveCoding","2023-07-21 08:59:33","true","operator: Fix OIDC.IssuerCAPath by updating it to type CASpec (#9972)

Co-authored-by: Periklis Tsirakidis <periklis@redhat.com>",57,63,1,0,"2018-04-16 10:25:39","1921.19"
"grafana/loki","ab24efe1bf6532673c56e5acbba434f38e6c5c01","owen-d","2022-09-16 11:03:32","true","allow backup store metrics registration by including backend type in labels (#7177)

The refactor
[here](https://github.com/grafana/loki/blob/main/pkg/storage/store.go#L237)
introduced in https://github.com/grafana/loki/pull/7154 will cause a
panic due to duplicate registration via the same store prefix when using
a backup index store (for use during tsdb migrations).

This PR adds more granularity to the label value to differentiate these
and avoid the problem.",88,53,1,1,"2018-04-16 10:25:39","1611.03"
"grafana/loki","a58dc3f6a88a25479dc6012f88aaeda5863b38d5","kavirajk","2022-05-20 07:05:11","true","doc(storage-example-configs): AWS single store configs (#6196)

* doc(storage-example-configs): AWS single store configs

Our example configs are bit misleading here. Particularly AWS deployment.
https://grafana.com/docs/loki/latest/storage/#examples

As a new user, I come here and all I can conclude is, we cannot use s3 as a single store under AWS deployment. Doc seems to recommend AWS deployment always  needs S3 + DynamoDB.
(in fact it was real confusion for new user from the community)

https://grafana.slack.com/archives/CEPJRLQNL/p1652867888720979

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Update schema_config.configs.store

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",72,49,0,1,"2018-04-16 10:25:39","1494.86"
"grafana/loki","ef304780cb10855d410fa900a4adf427e899c82c","kavirajk","2022-07-27 13:36:59","true","chore(groupcache): disable hotcache for chunks (#6784)

* chore(groupcache): disable hotcache for chunks

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* PR remarks

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* GetCacheType()

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",75,51,0,1,"2018-04-16 10:25:39","1562.13"
"grafana/loki","d4a472893341b576394db3e02539c82d33bbf43a","vlad-diachenko","2022-02-03 09:46:14","true","changed logic to respond with '500 Internal Server Error' if rpc error with code 'Cancelled' happened. it's made to allow loki to retry the request to the querier instead of returning '499 The request was cancelled by the client.' back to the client. (#5297)",277,45,0,0,"2018-04-16 10:25:39","1382.72"
"grafana/loki","55acdbd08f9759cc32cd39c7c4935e12211a3fc8","sandeepsukhani","2022-02-24 12:01:20","true","boltdb shipper index gateway client improvements (#5456)

Index Gateway query performance improvements by bounding the number of concurrent grpc calls we make from the client.",300,46,0,1,"2018-04-16 10:25:39","1403.82"
"grafana/loki","a046d7926122cef1b619d89bfcf15403e14e0de3","garrettlish","2021-10-19 07:37:55","true","make LogQL syntax scope from private to public (#4446)

* make LogQL syntax scope from private to public

The follow-up for https://github.com/grafana/loki/pull/3991, it makes using LogQL syntax outside possible, it also makes LogRange implements Expr interface.

* make constructor also public

* Revert ""make constructor also public""

This reverts commit ab9d0a942c1e96a450307330c82692cb7084220c.",159,42,0,0,"2018-04-16 10:25:39","1278.63"
"grafana/loki","33761194d971a2ed9e8549181171be70108668a5","slim-bean","2022-06-29 12:40:17","true","Loki: Add the ability to use the log line timestamp in label and line formatter (#6517)

* Change Stage interface Process method to include the timestamp of the line

Signed-off-by: Edward Welch <edward.welch@grafana.com>

* allow using log line timestamp in formatter

Signed-off-by: Edward Welch <edward.welch@grafana.com>

* update formatting in test

Signed-off-by: Edward Welch <edward.welch@grafana.com>

* update docs

Signed-off-by: Edward Welch <edward.welch@grafana.com>

* Update docs/sources/logql/template_functions.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>",73,50,0,1,"2018-04-16 10:25:39","1534.09"
"grafana/loki","14385b1d5463c62b3d6de0dc1d0b4ccc125056d7","slim-bean","2020-12-23 20:27:06","true","Merge branch 'release-2.0.1'

# Conflicts:
#	pkg/chunkenc/memchunk_test.go",124,32,0,1,"2018-04-16 10:25:39","977.92"
"grafana/loki","204e61afe345af684bfb16a28282e4d92d48de30","slim-bean","2020-07-24 18:07:39","true","Loki-Canary: Backoff retries on query failures, add histograms for query performance. (#2413)

* Canary needs to wait before spot-checking entries some reasonable amount of time else the nature of the async thread doing the testing can ask for them from Loki only a few ms after they are written and they would have no chance of being present.
Adding two histograms for tracking the performance of the spot check and metric test queries

* Adding backoff to queries if they fail specifically waiting 5mins when a 429 is received from Loki

* fix order of parameters",124,27,0,1,"2018-04-16 10:25:39","828.82"
"grafana/loki","303856ef7edbc0acb110f904527c42ab38732c49","MichelHollands","2022-06-15 05:53:13","true","Add deleted lines panel to deletion dashboard (#6390)

* Add deleted lines panel to deletion dashboard

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Fix missing comma

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Use cluster variable

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Run make loki-mixin

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",67,50,0,1,"2018-04-16 10:25:39","1519.81"
"grafana/loki","56363801b6c3501b4823a263feed44ca7eb26319","xperimental","2022-06-21 13:12:00","true","operator: Update Grafana and forwarding documentation (#6442)",68,50,0,1,"2018-04-16 10:25:39","1526.12"
"grafana/loki","d6dc43b9580a8c3bffaea1e4ad4417d5406237ff","dannykopping","2021-07-19 07:17:29","true","Adding @grafana/loki-team as default CODEOWNERS (#4007)

In order to notify the team of PRs requiring review

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",108,39,0,1,"2018-04-16 10:25:39","1188.62"
"grafana/loki","3fa6cc9fded401be1ed1febbea08612042fb243e","dannykopping","2022-04-21 11:51:10","true","Querier: prevent unnecessary calls to ingesters (#5984)

* Restrict gRPC calls to ingesters when requesting series if there is no overlap within the query_ingesters_within value

* Add tests for isWithinIngesterMaxLookbackPeriod

* Adding tests for calculateIngesterMaxLookbackPeriod

* Only send query for range overlapping with ingesters

* Restrict gRPC calls to ingesters when requesting series if there is no overlap within the query_ingesters_within value

* Add tests for isWithinIngesterMaxLookbackPeriod

* Adding tests for calculateIngesterMaxLookbackPeriod

* Only send query for range overlapping with ingesters

* Add test for when to query ingester and storage

* Fix deadlock in Series when just queriying the ingesters

* Refactored slightly for better readability

* Added CHANGELOG entry

* Fix typo

* Rephrase test cases names

* Move block to outer loop

Co-authored-by: Salva Corts <salva.corts@grafana.com>",170,48,0,1,"2018-04-16 10:25:39","1466.06"
"grafana/loki","5a85f6647e3b0a8fe8193632d75c40125d435e62","cstyan","2023-03-10 05:21:40","true","Add initial implementation of per-query limits (#8727)

**What this PR does / why we need it**:
Sometimes we want to limit the impact of a single query by imposing
limits that are stricter than the current tenant limit. E.g. the maximum
query length could be seven days but based on the query or an admins
decision a query should just have a maximum length of one day. This is
where per-request limits come into play. They are passed via the
`X-Loki-Query-Limit` header and extracted into the requests context.

It is the responsibility of the operator or admin that the header is
valid.

**Which issue(s) this PR fixes**:
Fixes #8762

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [x] Tests updated
- [x] `CHANGELOG.md` updated
- [x] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

---------

Signed-off-by: Callum Styan <callumstyan@gmail.com>
Co-authored-by: Karsten Jeschkies <karsten.jeschkies@grafana.com>",88,59,1,1,"2018-04-16 10:25:39","1784.79"
"grafana/loki","93a1c21da5c9d768dc685210bf5e7adff282fe1c","periklis","2023-03-23 13:32:19","true","operator: Break the API types out into their own module (#8863)",82,59,1,1,"2018-04-16 10:25:39","1798.13"
"grafana/loki","858f8ea54a8000788c685155b580a3bce18c3a8c","kavirajk","2022-01-28 16:52:12","true","Fix transitive dependency failure while building logstash plugin (#5268)

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",275,45,0,1,"2018-04-16 10:25:39","1378.02"
"grafana/loki","0a5e01ba017fd25232ffe1ff1bcbb940f3936982","owen-d","2022-02-25 17:43:45","true","Rounds chunk bytes to kb in tsdb and includes benchmarking script (#5479)

* rounds chunk bytes to kb in tsdb and includes benchmarking script

* shellcheck

* fix querier test",297,46,0,1,"2018-04-16 10:25:39","1405.05"
"grafana/loki","e4b22c4988b7fdb4e98a1640c113bb5acd1f1b68","ashwanthgoli","2023-10-17 14:14:43","true","modules: add dependency on server for bloom compactor ring (#10934)

**What this PR does / why we need it**:

bloom compactor ring relies on the
[server](https://github.com/grafana/loki/blob/d1a7d9b86097c6dcf21181739fa6bc1ffa028054/pkg/loki/modules.go#L1371),
initing the ring before the server is up would result in a panic. This
pr adds server as a dependency for bloom compactor ring

fixes flaky test
`TestIndexGatewayRingMode_when_TargetIsLegacyReadOrBackend` that was
running into panics

```
panic({0x102ff9f40?, 0x104974530?})                                                                                                                                                   [240/9420]
        /opt/homebrew/Cellar/go/1.21.2/libexec/src/runtime/panic.go:914 +0x218
github.com/grafana/loki/pkg/loki.(*Loki).initBloomCompactorRing(0x140008ea000)
        /Users/grafana/Workspace/loki/pkg/loki/modules.go:1371 +0xd4
github.com/grafana/dskit/modules.(*Manager).initModule(0x1400000e438, {0x1025a7e90, 0x4}, 0x1031c3340?, 0x14000abf818?)
        /Users/grafana/Workspace/loki/vendor/github.com/grafana/dskit/modules/modules.go:136 +0x1a4
```

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [x] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",22,66,1,0,"2018-04-16 10:25:39","2007.41"
"grafana/loki","6dfae7c42d4a0ccb6790cddf5fe00c3d0e064385","MichelHollands","2023-02-22 15:10:03","true","Use golangci-lint v1.51.2 in build image (#8587)

**What this PR does / why we need it**:

Golangci-lint [1.50.0
OOMs](https://github.com/golangci/golangci-lint/issues/3538#issuecomment-1414341372)
when used with go 1.20.1. This also updates the build image.

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

---------

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>
Signed-off-by: Christian Haudum <christian.haudum@gmail.com>
Co-authored-by: Christian Haudum <christian.haudum@gmail.com>",67,58,1,1,"2018-04-16 10:25:39","1767.2"
"grafana/loki","34c2c0c4a91c77813fff46d630cabb8af7712a30","MichelHollands","2022-09-05 08:09:02","true","Update metrics descriptions (#6982)

**What this PR does / why we need it**:

The docs team reviewed and fixed the descriptions of the deletion metrics added to the documentation in https://github.com/grafana/loki/pull/6971. The fix is in a separate PR https://github.com/grafana/loki/pull/6976. This PR fixes that same description in the code.

**Checklist**
- [ ] Documentation added
- [ ] Tests updated
- [ ] Is this an important fix or new feature? Add an entry in the `CHANGELOG.md`.
- [ ] Changes that require user attention or interaction to upgrade are documented in `docs/sources/upgrading/_index.md`

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",78,53,1,1,"2018-04-16 10:25:39","1599.91"
"grafana/loki","2ce5af1b9f8b271f9f93a095032bfedd8ae733be","daixiang0","2019-04-28 01:34:41","true","Merge branch 'master' into debug-helm",96,12,0,0,"2018-04-16 10:25:39","376.88"
"grafana/loki","f634f5342caa094e6ce1a70c66a0292cb6dcbab0","daixiang0","2019-04-02 09:23:49","false","Update logcli config

Signed-off-by: Xiang Dai <764524258@qq.com>",96,11,0,0,"2018-04-16 10:25:39","345.96"
"grafana/loki","2064f91b54da46ca5c0cf50f393b489c20cbcf40","daixiang0","2019-09-02 03:28:25","false","sync release pkgs name with release note

Signed-off-by: Xiang Dai <764524258@qq.com>",123,16,0,0,"2018-04-16 10:25:39","500.96"
"grafana/loki","d787a0fe289da2c7138eb119830c65921b76d4d7","KMiller-Grafana","2022-02-04 21:18:22","true","Docs: remove ""regular"" from string definition (#5309)",277,45,0,0,"2018-04-16 10:25:39","1384.2"
"grafana/loki","9734c4b83220d2a9d481678c56e2dc08fee52bf9","dannykopping","2023-08-23 09:29:05","true","Minor fixes to congestion control mechanism (#10319)

**What this PR does / why we need it**:
Minor logging / metric improvements to #10140",50,64,1,1,"2018-04-16 10:25:39","1953.21"
"grafana/loki","8f6d31c34e64309d95828e4af0d2b753bef87aa7","alfredo-d","2023-04-14 19:19:29","true","Docs: update template function (#9037)

**What this PR does / why we need it**:
- Add `eq` function
- Add example for nested if and `AND`/`OR` logic

**Which issue(s) this PR fixes**:
Fixes #<issue number>
N/A

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",81,60,1,0,"2018-04-16 10:25:39","1819.37"
"grafana/loki","8233a1560a55e1102c78beab60b6cb394f46f11c","dannykopping","2023-03-31 16:24:23","true","Adding release cadence docs (#8893)

**What this PR does / why we need it**:
Members of our community often ask about our release cadence, so I have
documented it for easy future reference.

---------

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>
Co-authored-by: J Stickler <julie.stickler@grafana.com>",81,59,1,1,"2018-04-16 10:25:39","1806.25"
"grafana/loki","720dfe047629ee06786614d339c5573621624f13","liguozhong","2022-11-29 07:26:40","true","fifocache config is deprecated. use embedded-cache instead (#7800)",99,55,1,1,"2018-04-16 10:25:39","1683.88"
"grafana/loki","ae4c3b1afcc0a6ad5a2841db8ce8bc699026056d","Red-GV","2022-03-23 14:54:45","true","operator: Fix multiple storage support for boltdb_shipper and schema (#5699)",310,47,0,1,"2018-04-16 10:25:39","1432.94"
"grafana/loki","c9276aa98973185f9020d07f367d61ed2eb6acd3","KMiller-Grafana","2021-06-23 11:28:53","true","Docs: improve section on building from source (#3882)",106,38,0,0,"2018-04-16 10:25:39","1162.79"
"grafana/loki","1ed19f7380fb2248d2794b01a7091b3c5774f9c6","sandeepsukhani","2021-07-15 13:29:32","true","add a metric for counting number of failures in opening existing files while loading tables from active index in uploads package (#3977)",106,39,0,1,"2018-04-16 10:25:39","1184.88"
"grafana/loki","46637db9cc4055a720f65b5d34f86913c07fd5ab","jdbaldry","2020-12-01 10:10:22","true","doc: Fix query-frontend typo (#3009)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>",121,31,0,0,"2018-04-16 10:25:39","955.49"
"grafana/loki","14a5e22c31f8cdd7b86ea3848cbc971f7a50a3c7","sandeepsukhani","2020-11-23 07:37:53","true","add missing ingester query routes in loki reads and operational dashboard (#2961)",110,31,0,1,"2018-04-16 10:25:39","947.38"
"grafana/loki","e2aee2a9c32817486acb601e773d9d08090e19b9","cyriltovena","2020-11-06 07:11:52","true","LogQL: Improve template format (#2822)

* Add error labels on failure and new functions for templates.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Updates docs.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Update docs/sources/logql/_index.md

Co-authored-by: Diana Payton <52059945+oddlittlebird@users.noreply.github.com>

* Update docs/sources/logql/_index.md

Co-authored-by: Diana Payton <52059945+oddlittlebird@users.noreply.github.com>

* Update docs/sources/logql/functions.md

Co-authored-by: Diana Payton <52059945+oddlittlebird@users.noreply.github.com>

* Update docs/sources/logql/functions.md

Co-authored-by: Diana Payton <52059945+oddlittlebird@users.noreply.github.com>

* Update docs/sources/logql/functions.md

Co-authored-by: Diana Payton <52059945+oddlittlebird@users.noreply.github.com>

* Update docs/sources/logql/functions.md

Co-authored-by: Diana Payton <52059945+oddlittlebird@users.noreply.github.com>

* Update docs/sources/logql/functions.md

Co-authored-by: Diana Payton <52059945+oddlittlebird@users.noreply.github.com>

* Update docs/sources/logql/functions.md

Co-authored-by: Diana Payton <52059945+oddlittlebird@users.noreply.github.com>

* Update docs/sources/logql/functions.md

Co-authored-by: Diana Payton <52059945+oddlittlebird@users.noreply.github.com>

* Update docs/sources/logql/functions.md

Co-authored-by: Diana Payton <52059945+oddlittlebird@users.noreply.github.com>

* Update docs/sources/logql/functions.md

Co-authored-by: Diana Payton <52059945+oddlittlebird@users.noreply.github.com>

* Update docs/sources/logql/functions.md

Co-authored-by: Diana Payton <52059945+oddlittlebird@users.noreply.github.com>

* Update docs/sources/logql/functions.md

Co-authored-by: Diana Payton <52059945+oddlittlebird@users.noreply.github.com>

* Update docs/sources/logql/functions.md

Co-authored-by: Diana Payton <52059945+oddlittlebird@users.noreply.github.com>

* Update docs/sources/logql/functions.md

Co-authored-by: Diana Payton <52059945+oddlittlebird@users.noreply.github.com>

* Update docs/sources/logql/functions.md

Co-authored-by: Diana Payton <52059945+oddlittlebird@users.noreply.github.com>

* Update docs/sources/logql/functions.md

Co-authored-by: Diana Payton <52059945+oddlittlebird@users.noreply.github.com>

* Update docs/sources/logql/functions.md

Co-authored-by: Diana Payton <52059945+oddlittlebird@users.noreply.github.com>

* Update docs/sources/logql/functions.md

Co-authored-by: Diana Payton <52059945+oddlittlebird@users.noreply.github.com>

* Update docs/sources/logql/functions.md

Co-authored-by: Diana Payton <52059945+oddlittlebird@users.noreply.github.com>

* Update docs/sources/logql/functions.md

Co-authored-by: Diana Payton <52059945+oddlittlebird@users.noreply.github.com>

* Update docs/sources/logql/functions.md

Co-authored-by: Diana Payton <52059945+oddlittlebird@users.noreply.github.com>

* Update docs/sources/logql/functions.md

Co-authored-by: Diana Payton <52059945+oddlittlebird@users.noreply.github.com>

* Improve docs based off review feedback.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Review feedback.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes panic out of boundary

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Update docs/sources/logql/functions.md

Co-authored-by: achatterjee-grafana <70489351+achatterjee-grafana@users.noreply.github.com>

* Update docs/sources/logql/functions.md

Co-authored-by: achatterjee-grafana <70489351+achatterjee-grafana@users.noreply.github.com>

* Update docs/sources/logql/functions.md

Co-authored-by: achatterjee-grafana <70489351+achatterjee-grafana@users.noreply.github.com>

* Update docs/sources/logql/functions.md

Co-authored-by: achatterjee-grafana <70489351+achatterjee-grafana@users.noreply.github.com>

* Update docs/sources/logql/_index.md

Co-authored-by: Diana Payton <52059945+oddlittlebird@users.noreply.github.com>

* Update docs/sources/logql/functions.md

Co-authored-by: Diana Payton <52059945+oddlittlebird@users.noreply.github.com>

* Update docs/sources/logql/functions.md

Co-authored-by: Diana Payton <52059945+oddlittlebird@users.noreply.github.com>

* Update docs/sources/logql/_index.md

Co-authored-by: achatterjee-grafana <70489351+achatterjee-grafana@users.noreply.github.com>

* Apply suggestions from code review

Co-authored-by: achatterjee-grafana <70489351+achatterjee-grafana@users.noreply.github.com>
Co-authored-by: Diana Payton <52059945+oddlittlebird@users.noreply.github.com>

* Apply suggestions from code review

Co-authored-by: achatterjee-grafana <70489351+achatterjee-grafana@users.noreply.github.com>

* Apply suggestions from code review

Co-authored-by: achatterjee-grafana <70489351+achatterjee-grafana@users.noreply.github.com>

Co-authored-by: Diana Payton <52059945+oddlittlebird@users.noreply.github.com>
Co-authored-by: achatterjee-grafana <70489351+achatterjee-grafana@users.noreply.github.com>",127,31,0,1,"2018-04-16 10:25:39","930.37"
"grafana/loki","2a7a97d05254898769a45475da65b82a2216e3f3","cyriltovena","2019-05-31 12:40:12","false","Remove LogCount",109,13,0,1,"2018-04-16 10:25:39","410.34"
"grafana/loki","7dae970676d3bc163709999f00a59289af15b274","tomwilkie","2018-05-18 09:08:53","false","Add extra vendor stuff.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",0,1,0,0,"2018-04-16 10:25:39","31.95"
"grafana/loki","8a914b5c2fab45f250a9adc83d32aafcdeebbd30","taisho6339","2021-11-23 13:01:25","true","Aggregate inotify watcher to file target manager (#4794)

* Aggregate inotify watcher

* rename to target event handler

* Add changelog entry

* refactor: make event handler testable

* Use context to handle done

* doc: add description to sendFileCreateEvent",212,43,0,0,"2018-04-16 10:25:39","1312.86"
"grafana/loki","c1aa93d3c91bd848ea12a909647e86563bf6b32c","tomwilkie","2018-06-25 13:06:56","false","Add usage instructions.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",1,2,0,0,"2018-04-16 10:25:39","69.11"
"grafana/loki","7d906cbe511878c0ff75d4b2650247bdde022147","tomwilkie","2018-11-20 14:36:13","false","Stop module correctly.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",5,7,0,0,"2018-04-16 10:25:39","214.17"
"grafana/loki","d38d481f355cacc0c68719dda3fb30cbbd94c0e6","dannykopping","2023-03-27 08:53:20","true","Distributor: add detail to stream rates failure (#8900)

**What this PR does / why we need it**:
Currently we cannot see if a single ingester is the source of the
`unable to get stream rates` failures. This change adds the client
address to the log entry.

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",80,59,1,1,"2018-04-16 10:25:39","1801.94"
"grafana/loki","eef896c51d8255f8695bd83905f002f9b6f17ef4","dannykopping","2021-09-20 13:11:39","true","Ruler: adding `pkg/metrics` from agent (#4354)

* Adding pkg/metrics from agent

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Adding notice to all copied files

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Adding two utility files that are needed as well

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",136,41,0,1,"2018-04-16 10:25:39","1249.87"
"grafana/loki","110ff6fb9e478da530e45ee7dc41e7b4109a375f","dannykopping","2021-06-07 14:00:28","true","Extracting queue interface (#3816)

Exporting metrics entry type

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",199,38,0,1,"2018-04-16 10:25:39","1146.9"
"grafana/loki","d4cdc376820867cd88248a9b6874e18b1cdac6e6","thepalbi","2022-07-18 14:40:01","true","promtail: Inject tenant ID when receiving X-Scope-OrgID in heroku target (#6695)

* inject tenant ID header

* fix import order",69,51,0,0,"2018-04-16 10:25:39","1553.18"
"grafana/loki","c14b443b7bf8b84028bc39d9513965bad5567019","fredr","2020-11-10 13:12:29","true","Add max_cache_freshness_per_query to docs (#2909)",124,31,0,0,"2018-04-16 10:25:39","934.62"
"grafana/loki","226799214baf0a328c56864c638db43ccd2b4c0b","apodkutin","2018-12-16 16:47:44","false","Fix typo, add external links, change formatting (#112)

Signed-off-by: apodkutin <apodkutin@gmail.com>",35,8,0,0,"2018-04-16 10:25:39","240.27"
"grafana/loki","bfcf939c9bdc780c7178d36562fc7a9af7a265b9","cyriltovena","2021-07-06 13:23:13","true","Allow no overrides config for tenants. (#3949)

Recently came accross this issue when testing Loki, if we don't provide overrides, Loki will crash on a nil pointer.
This PR fixes this issue, having no overrides is a valid use case.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",119,39,0,1,"2018-04-16 10:25:39","1175.87"
"grafana/loki","e2f1581313b5401596d83fb2f81ea755bc2f6b30","robbymilo","2020-07-23 12:14:10","true","Docs - update links, readme (#2398)

* docs - update links

* update readme",118,27,0,0,"2018-04-16 10:25:39","827.58"
"grafana/loki","18d8fee4393c857c8e71489e7f8316feb782df7f","fredrikekre","2021-11-23 16:05:09","true","[doc]: Update URL for LokiLogger.jl (Julia client) (#4784)",211,43,0,0,"2018-04-16 10:25:39","1312.99"
"grafana/loki","3745020dc75662b5a4fe5a2a74c514ac8b4e5e8a","MasslessParticle","2023-04-24 15:04:14","true","mark helm as the recommended installation method (#9259)

AFAIK, we're recommending folks use the helm chart to install these
days. Make the installation documentation reflect that",79,60,1,1,"2018-04-16 10:25:39","1834.44"
"grafana/loki","61bfa20ad5fe5071439bc53434acd74f65c7c4e5","joe-elliott","2020-03-03 01:59:58","true","Dashboard Cleanup (#1767)

* Removed env references from operational dashboard

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Updated refresh on template vars

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Standard formatting

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Removed env references

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Added queries

Signed-off-by: Joe Elliott <number101010@gmail.com>

* memory => working set

Signed-off-by: Joe Elliott <number101010@gmail.com>",116,22,0,0,"2018-04-16 10:25:39","681.9"
"grafana/loki","64798e2a98a7a8b9748295545b81282384a31569","slim-bean","2020-01-24 21:11:38","true","tweaking the names a little per some discussions to make things easier to understand (#1582)

Signed-off-by: Edward Welch <edward.welch@grafana.com>",98,21,0,1,"2018-04-16 10:25:39","643.7"
"grafana/loki","0352b75f0d43f915ceb2f27b28164ef6f07f9b84","slim-bean","2023-03-10 19:57:50","true","Loki: Add new logql template functions `bytes`, `duration`, `unixEpochMillis`, `unixEpochNanos`, `toDateInZone`, `b64Enc`, and `b64Dec` (#8774)

**What this PR does / why we need it**:

This adds several new template functions to the logql to be used in
`line_format` and `label_format`

- bytes
- duration (and duration_seconds)
- unixEpochMillis
- unixEpochNanos
- toDateInZone
- b64Enc and b64Dec

`bytes` and `duration` adds parity with the `unwrap` pipeline stage in
logql, allowing you to convert human readable versions of bytes and
times into their respective primitives of bytes and seconds. This makes
it possible to do math and comparisons of these extracted values in
`line_format` and `label_format`

`unixEpochMillis` and `unixEpochNanos` extends the existing `unixEpoch`
function which can only generate seconds level precision to allow having
millisecond and nanosecond level precision.

`toDateInZone` allows for specifying a specific timezone when parsing a
date.

`b64Enc` and `b64Dec` allow base64 encoding and decoding values.

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

@JStickler I made a lot of changes to the template_functions.md doc page
to try and create some more consistency as well as remove some notices
that really aren't relevant anymore:

* Tried to make sure every function had a `Signature` and `Examples`
block
* Removed a lot of `NOTE` about functions being introduced in a specific
version
* Removed documentation for some deprecated string functions (they still
exist in code but I removed the docs for them, their exist better
replacements for all of them)

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [x] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

---------

Signed-off-by: Edward Welch <edward.welch@grafana.com>",87,59,1,1,"2018-04-16 10:25:39","1785.4"
"grafana/loki","33b7e51342512fcad25da1702ec35d89082fc333","jeschkies","2023-11-01 10:51:57","true","Bring back RED metrics for querier when processing scheduler requests. (#11097)

**What this PR does / why we need it**:
A previous change removed the RED metrics for the querier. This adds
them back as part of a middleware.

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)
- [ ] If the change is deprecating or removing a configuration option,
update the `deprecated-config.yaml` and `deleted-config.yaml` files
respectively in the `tools/deprecated-config-checker` directory.
[Example
PR](https://github.com/grafana/loki/pull/10840/commits/0d4416a4b03739583349934b96f272fb4f685d15)",16,66,1,1,"2018-04-16 10:25:39","2021.27"
"grafana/loki","57e7a1c3864f4cfd2212fed00c3532fc7c0f18a1","rfratto","2019-10-01 13:55:46","true","docs: update stages README with the docker and cri stages (#1094)",73,17,0,1,"2018-04-16 10:25:39","530.4"
"grafana/loki","b16da1d7c3b4dd3bc3a0932759e2e5db2ecc9eb4","tomwilkie","2019-04-16 13:30:41","false","Parse pipelines of regex matches.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",103,12,0,0,"2018-04-16 10:25:39","365.38"
"grafana/loki","84e40383775e34aa4aef7d0371a820fdb0a7e8e6","MattiasSegerdahl","2023-05-01 08:28:12","true","Update _index.md (#9313)

**What this PR does / why we need it**:

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",79,60,1,0,"2018-04-16 10:25:39","1841.17"
"grafana/loki","835d0452d48dcadd85f9672477f511e435e3ddc4","xperimental","2023-09-16 15:00:12","true","operator: Update example configurations to use demo size (#10606)",41,65,1,1,"2018-04-16 10:25:39","1976.44"
"grafana/loki","27a536718fa5f627d634af6acc717b181fd2d17a","johgsc","2022-04-18 06:56:01","true","Update _index.md (#5934)

changed URLs for [Fluentd](https://github.com/grafana/loki/tree/main/clients/cmd/fluentd) and [Fluent Bit](https://github.com/grafana/loki/tree/main/clients/cmd/fluent-bit) since the old URLs where leading to a 404 on GitHub.",321,48,0,0,"2018-04-16 10:25:39","1462.85"
"grafana/loki","74a4dca54e4077b65a39c18b8390e76870b01526","kavirajk","2023-06-19 07:10:19","true","fix(async_store): Fix the `storageconfig.EnableAsyncStore` config (#9725)

**What this PR does / why we need it**:
During reverting this [PR](https://github.com/grafana/loki/pull/9715). I
missed one important flag switch. Which this PR fixes it.

**Which issue(s) this PR fixes**:
Fixes NA

**Special notes for your reviewer**:
We found a bug on querier due to async_store and we tracked down to[
this PR](https://github.com/grafana/loki/pull/9476). So I reverted the
PR in [this PR ](https://github.com/grafana/loki/pull/9715)(manually.
Auto revert was not possible as things changed a lot meanwhile)

But during my revert PR I missed switching this async store config.


**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",58,62,1,1,"2018-04-16 10:25:39","1889.11"
"grafana/loki","93b85f92faf6bcebc12914154523544fdbcfe348","pstibrany","2019-12-16 16:11:35","false","pkg/ingester: Added possibility to disable transfers. (#1425)

Previously, with -ingester.max-transfer-retries set to zero,
transfers would never stop. Now zero means don't transfer at all.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>",93,20,0,0,"2018-04-16 10:25:39","605.49"
"grafana/loki","a1c72ad562229cbd5d9fcd0e1075f3e80a6a3745","owen-d","2022-06-17 16:41:24","true","Tsdb/wal rotate fix (#6423)

* rotate tsdb wal under mutex
Signed-off-by: Owen Diehl <ow.diehl@gmail.com>

* ensure we rotate and doublecheck conditions under lock in tsdb headmanager
Signed-off-by: Owen Diehl <ow.diehl@gmail.com>",68,50,0,1,"2018-04-16 10:25:39","1522.26"
"grafana/loki","48c3fb4c7c57aa2b8692058964eeb8e773f9a835","chaudum","2022-11-23 16:04:46","false","Fix label selector for gateway service in operational dashboard

Use `job=~\""$namespace/cortex-gw(-internal)?\""` throughout the
dashboard. This fixes the occurrence where a regex value was used in
combination with an exact label match.

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",93,55,1,1,"2018-04-16 10:25:39","1678.24"
"grafana/loki","dafb9d8425e04ac3771baf3b0b948d6a5fe03af3","owen-d","2019-12-20 22:43:35","false","Enables Series API in loki (#1419)

* helpers for parsing /series requests

* logproto.SeriesResponse impl

* passes unparsed matchers in protobuf for simplicity

* ingester support for series queries

* labels map coercion

* fixes label match loghttp test

* removes labelmatcher protobuf adapters

* series api impl

* tests matchers for dispatching series queries

* series looked up serially for /series api

* splits series api async code and remove unnecessary type assertion

* adds series handle to /api/prom/series and includes docs

* compatibility changes w/ upstream merge",98,20,0,1,"2018-04-16 10:25:39","609.76"
"grafana/loki","87c94527338ecb0c5e80ba21c0e2c8a643a0f205","polar3130","2019-10-24 15:08:00","false","Helm: Fix the reference error of loki/loki helm chart (#1056)

* fix a reference error of loki/loki helm chart
add new valuable ""client.name""
instead of ""promtail.name""

* bump loki-stack chart

* Add missing chart version

Co-authored-by: cyriltovena <cyril.tovena@gmail.com>",69,18,0,0,"2018-04-16 10:25:39","553.45"
"grafana/loki","56db7331899ce25c99fcda1f31797ab905770064","Dieterbe","2018-12-18 11:12:22","false","Loki is a component, not the entire stack (#146)

* Loki is a component, not the entire stack

* Loki has a capital el.",38,8,0,0,"2018-04-16 10:25:39","242.03"
"grafana/loki","35d1b5e667ee15165144d7ee2f64c4304892dabc","tomwilkie","2018-04-16 13:25:02","false","Push images.",0,0,0,0,"2018-04-16 10:25:39","0.12"
"grafana/loki","6fd4b5e89b67b2c8eaa83891be470fb750d26911","bboreham","2023-02-24 08:01:05","true","Update prometheus/prometheus from 2.41 to 2.42 (#8571)

**What this PR does / why we need it**:

Brings in the latest updates from upstream.
These open up some opportunities for optimisations in TSDB indexing.

Dependencies updated:
* github.com/Azure/go-autorest/autorest/adal v0.9.21 -> v0.9.22
(comment-only change)
* github.com/docker/docker v20.10.21 -> v20.10.23 (fixing filters bug)
* golang.org/x/exp fae10dda9338 -> d38c7dcee874 (optimisations in
`BinarySearch` function)

Indirect dependencies also updated:
* github.com/digitalocean/godo v1.91.1 -> v1.95.0 (nothing alarming in
[release notes](https://github.com/digitalocean/godo/releases))
* github.com/google/pprof aee1124e3a93 -> 76d1ae5aea2b (no changes
pulled into vendor)
* golang.org/x/tools v0.4.0 -> v0.5.0 (relating to Go compiler
utilities)
* google.golang.org/genproto 76db0878b65f -> 31e0e69b6fc2
* k8s.io/api v0.26.0 -> v0.26.1 (comment-only change)
* k8s.io/apimachinery v0.26.0 -> v0.26.1 (no changes pulled into vendor)
* k8s.io/client-go v0.26.0 -> v0.26.1 (small fixes)

**Special notes for your reviewer**:

A couple of interfaces changed; these have required matching changes in Loki code.
Those changes are split into separate commits.
I also note that most calls to `relabel` ignore when the rule says ""drop"". Maybe this is wrong?",63,58,1,0,"2018-04-16 10:25:39","1768.9"
"grafana/loki","25e8365d05c5fb50ffafd35c24f12441d3720ff1","MichelHollands","2022-08-18 09:37:18","true","Improve error message (#6913)

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",83,52,0,1,"2018-04-16 10:25:39","1582.97"
"grafana/loki","52a7c0fd36e16d3128d577f589e6e05128fd5001","kavirajk","2023-10-16 12:07:35","true","ruler: Support `writeNotify` on Loki ruler (#10906)

**What this PR does / why we need it**:
prometheus ruler added a feature of notifying the reader when a sample
is appended, instead of waiting in a loop burning the CPU cycles.
https://github.com/prometheus/prometheus/pull/11949

This changes a default behaviour a bit. Now if `notify` is not enabled,
next read is done only when next readTicker is triggered.

**Which issue(s) this PR fixes**:
Also should fix https://github.com/grafana/loki/issues/10859

**Special notes for your reviewer**:
Adding few more details for the sake of completeness.

We found this via more frequent failures of rule-evaluation integration
tests linked on the issue above. After some investigation, we tracked
down to prometheus changes.

Prometheus introduced new type `wlog.WriteNotified` interface with
`Notify()` method with a goal to notify any waiting readers, that some
write is done.

Two types implements this type `wlog.Watcher` and `remote.Storage`.
`remote.Storage` implements `Notify()` by just calling it's queues
`wlog.Watcher`'s `Notify()` under the hood.

How are these types impacts Loki ruler?

Loki ruler also uses `remote.Storage`. So when any samples got committed
via `appender`, we have to notify the remote storage.

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

---------

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",25,66,1,1,"2018-04-16 10:25:39","2006.32"
"grafana/loki","69afb6ffbeb75b01a5c4eb20ac3b7fb39f43ab9f","chaudum","2023-09-22 17:53:23","true","Fix internal reference in API docs (#10686)

**What this PR does / why we need it**:

When I rebased https://github.com/grafana/loki/pull/10654 before merging
I did not resolve the merge conflict correctly. I forgot to remove the
link to the section that was removed on main already with a previous
commit.

Resolves
https://github.com/grafana/loki/pull/10654#discussion_r1334601729

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",34,65,1,1,"2018-04-16 10:25:39","1982.56"
"grafana/loki","761319759385ff13470061f8d4222639dded4538","owen-d","2021-02-26 15:46:57","true","prevents duplicate log lines from being replayed. closes #3378 (#3388)",139,34,0,1,"2018-04-16 10:25:39","1040.72"
"grafana/loki","3170edf3e3cf9cc354c41cf01556eb6024016d4f","MasslessParticle","2022-08-11 17:13:29","true","Add timeouts to deletions  (#6879)

* Add context to chunk iteration

* Configure timeouts

* add expiration timeout

* update test

* update test

* Clarify timeout implications, log more specifically",81,52,0,1,"2018-04-16 10:25:39","1576.28"
"grafana/loki","7ec51e8b9d7bef802ab4bd540a9c843f0b423b3f","jeschkies","2022-11-29 09:03:12","true","Log rule changes through API. (#7790)

**What this PR does / why we need it**:
This change should make it easier to detect changes to rules via the
API.

**Which issue(s) this PR fixes**:
Fixes #7789

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the `CONTRIBUTING.md` guide
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

Co-authored-by: Christian Haudum <christian.haudum@gmail.com>",98,55,1,1,"2018-04-16 10:25:39","1683.94"
"grafana/loki","e90e3b769f8d196f9a541d81a7528a9c6be20ac8","slim-bean","2020-04-23 21:05:57","true","incorporate some better defaults into table-manager configs (#1976)

* Set less aggressive poll interval and a larger grace period for creating new periodic tables in the ksonnet config.
Add some rate limiting and retry settings for the table manager bigtable arguments.

Signed-off-by: Ed Welch <edward.welch@grafana.com>

* Removing the dynamodb provisioning of 0 from config files

Signed-off-by: Ed Welch <edward.welch@grafana.com>",115,24,0,1,"2018-04-16 10:25:39","737.94"
"grafana/loki","34bb9db758807a7cf577a865c488a07949867927","slim-bean","2019-05-14 15:02:40","false","using an environment variable passed into an arg instead of reading the pod name from a file and the downardApi
added a makefile",100,13,0,1,"2018-04-16 10:25:39","393.44"
"grafana/loki","b3664ff25557ee030a170e417df4f5a6aeeec215","liguozhong","2022-11-08 09:54:28","true","[fix]  cassandra: reconnection when k8s cassandra pods restart (#6725)

**What this PR does / why we need it**:

level=error ts=2022-07-20T04:07:11.881370946Z caller=flush.go:146
org_id=166256_8sxv2 msg=""failed to flush user"" err=""store put chunk:
gocql: no hosts available in the pool""

The restart of cassandra （on k8s） caused the production accident that
loki had to restart. It happened 4 times in our production environment
in only half a year.

I hope this problem can be fixed. The code of this PR is not
particularly complete, but this PR seems to be available.

If this PR does not merge, I also hope that other contributors in the
loki community can propose another PR to fix this problem.

The restart of cassandra that caused loki to be unavailable is already a
conclusion recorded in our JIRA.

**Which issue(s) this PR fixes**:
Fixes #1821 #7140",87,55,1,1,"2018-04-16 10:25:39","1662.98"
"grafana/loki","89996c9714a049877607805d6e53ac6e435c3de6","thepalbi","2023-03-29 21:46:20","true","Promtail WAL support: Implement reader side (#8302)

**What this PR does / why we need it**:
This PR is the second in a series that will implement WAL support into
Promtail. The main objective of this PR is implement the reader side of
WAL. That is, using the previously instantiated `client.Manager` to
somehow read entries from the WAL instead of receiving them from a
channel.

**Pending work**:
- [x] Implement mechanism so that `WriteTo` targets of each
`wal.Watcher` can cleanup un-used series
- [x] Write a full fledged test-case that tests a WAL enabled Promtail
(maybe in a follow up)

**Which issue(s) this PR fixes**:
Part of #8197 

**Special notes for your reviewer**:
The line count might be big since this PR implements two fully fledged
test cases of Promtail with WAL enabled.

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",83,59,1,0,"2018-04-16 10:25:39","1804.47"
"grafana/loki","9afda2c81ed2360b49f494af13efeacb6416131b","daixiang0","2019-12-03 15:40:33","false","doc(promtail): fix prometheus link (#1333)

Signed-off-by: Xiang Dai <764524258@qq.com>",91,19,0,0,"2018-04-16 10:25:39","592.47"
"grafana/loki","8391e557b1b9e36c11a1c9458de3d8e28f56b16e","jdbaldry","2023-06-13 20:01:50","true","Update doc-validator to v3.0.0 (#9666)

## 3.0.0

### Added

- Structured output for use with
[`reviewdog`](https://github.com/reviewdog/reviewdog).
You can achieve the original error output by piping the output to the
following `jq` expression: `jq -r '""ERROR:
\(.location.path):\(.location.range.start.line):\(.location.range.start.column):
\(.message)""'`.
- Suggestions for simple link fixes. In GitHub,
[`reviewdog`](https://github.com/reviewdog/reviewdog) comments these
suggestions for convenient replacement.
- Support for anchors referring to repeated headings.
In the case that a page has multiple headings that share the same text,
the renderer appends a zero indexed, numbered suffix to the identifier.
For example, when there are two headings that are both ""Heading text"",
the first anchor identifier is `heading-text` and the second is
`heading-text-1`.
- Error when running `doc-validator` on no files.

**Notes for reviewer:**

This also updates the `make-docs` procedure. Please ensure you can run
`make docs` from the `docs/` directory before approving and merging this
PR.

---------

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>",67,62,1,0,"2018-04-16 10:25:39","1883.65"
"grafana/loki","7046c2ddcd45c6825535f2b651123caca03c5418","grafanabot","2023-09-01 16:52:01","true","[Release Notes Appender] Add PR #7127: [new feature] promtail: Add a Promtail stage for probabilistic sampling (#10425)

Add PR #7127 to release notes for next release

Co-authored-by: Travis Patterson <travis.patterson@grafana.com>",45,64,1,0,"2018-04-16 10:25:39","1961.52"
"grafana/loki","4cd0aedc76679e4b46ae7d591404debce5f9585b","dannykopping","2023-04-24 10:45:22","true","Fix output of limited response body when remote rule evaluation fails (#9253)",80,60,1,1,"2018-04-16 10:25:39","1834.26"
"grafana/loki","2caf5f7c5d0669c77417db0cf1bab99949503748","dannykopping","2022-10-14 09:11:29","true","Promtail: correctly hashes the config on reload (#7421)",93,54,1,1,"2018-04-16 10:25:39","1638.95"
"grafana/loki","1d25e17b321a13c451db3e4c5f58fd1a20629c9e","n4mine","2022-05-04 07:59:35","true","Docs: fix pic location in `sources/fundamentals/architecture/deployment-modes.md` (#6089)",74,49,0,0,"2018-04-16 10:25:39","1478.9"
"grafana/loki","d0160cb09c1e9f6fb3ddec1054a81634317f7a49","aknuds1","2022-04-29 09:33:38","true","Upgrade inet.af/netaddr (#6046)

Signed-off-by: Arve Knudsen <arve.knudsen@gmail.com>",94,48,0,0,"2018-04-16 10:25:39","1473.96"
"grafana/loki","20068ca36c8b15d1bf03857eeaf4a8f760567c09","periklis","2022-03-23 16:05:50","true","operator: Replace frontend_worker parallelism with match_max_concurrent (#5693)",310,47,0,1,"2018-04-16 10:25:39","1432.99"
"grafana/loki","15dde37518ae17aa05194cd16f9455a852169d0b","sandeepsukhani","2022-02-28 18:21:16","true","initialize overrides when running index gateways which is required to run them (#5496)",301,46,0,1,"2018-04-16 10:25:39","1408.08"
"grafana/loki","7886f35b8f2d5e40c8d4e5a1d18ca25eadb584ee","cyriltovena","2021-03-03 13:21:02","true","Introduce a unpack parser. (#3420)

* Introduce a unpack parser.

To go with the new pack stage in promtail https://github.com/grafana/loki/pull/3401 this PR introduces a unpack parser
that will automatically unpack all labels packed into the log line and set back the original log line.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add documentation.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* tweak promtail docs a little now that we have unpack in Loki

Co-authored-by: Edward Welch <edward.welch@grafana.com>",139,34,0,1,"2018-04-16 10:25:39","1047.62"
"grafana/loki","d21c60b62d43dfb845d26ebccebea58afb40d8ee","sandeepsukhani","2019-08-07 12:05:17","false","fix broken jsonnet for querier",97,16,0,1,"2018-04-16 10:25:39","476.32"
"grafana/loki","46ae0efc0f2434bc0fd8f1389a75a532109d2aba","owen-d","2022-08-01 17:38:51","true","Simplify shard membership calculations (#6810)",78,51,0,1,"2018-04-16 10:25:39","1566.3"
"grafana/loki","aea6c3a36da8b66230daad9c4733684ff407974f","owen-d","2020-08-25 19:58:51","true","Feature/ruler (take 2) (#2458)

* begins speccing out ruler

ruler memhistory encapsulates metricsHistory

removes mutex from memhistory

ruler module

* upstream conflicts

* implicit ast impls, parser for ruler

* /api/prom ruler routes, ruler enabled in single binary

* registers ruler flags, doesnt double instantiate metrics

* cleanup for old samples in ruler

* begins ruler tests

* ForStateAppenderQuerier tests

* memhistory stop

* RestoreForState test

* upstream querier ifc

* introducing loki ruler metrics

* removes rule granularity metric -- to be discussed in pr

* validates ruler cfg

* renames gauge metrics to not use total

* removes unnecessary logs

* logs synthetic restoreforstate

* logs tenant in ruler

* sets cortex to owen's unmerged fork

* begins porting rules pkg

* memstore work

* work on queryable based in memory series store

* removes unused pkgs, adds memstore test

* MemStore must be started after construction

* MemstoreTenantManager

* ruler loading

* ruler instantiation

* better metrics & logging in ruler

* grpc cortex compatibility in go.mod

* cortex vendoring compat

* increments memory cache hits only if cached

* loki in memory metrics use prometheus default registerer

* ruler only depends on ring

* managerfactory rename

* revendors cortex

* ignore emacs stashing

* adds comments

* ruler /loki/api/v1 prefix

* revendoring compat

* comment",125,28,0,1,"2018-04-16 10:25:39","859.9"
"grafana/loki","bfc77118a161f9cb7afe95c7fa89fffd523bbabe","trevorwhitney","2021-11-05 20:07:56","true","Update local and docker config for simple scalable deployment (#4660)

* first draft of local config

* remove a few more defaults

* interface names fix means we do not need lifecycler ip

* update rings to use collectors/ prefix
fix replication factor
chunks-retain-period default to 0s
fix a bug introduced with a Go upgrade? on printing the schema date.

* simplify the config
for the ruler, synthesize the local directory

* simplify loki-docker-config.yaml

* change common filesystem config to have chunks and rules directory

* now that we are calling register flags on the common ring config we set more values and some of the tests needed to be tweaked.

updated a few paths as well.

* fix tests

Co-authored-by: Edward Welch <edward.welch@grafana.com>",176,43,0,1,"2018-04-16 10:25:39","1295.15"
"grafana/loki","c53457feb95a871e7494d22c5e072004874a197c","pracucci","2021-11-26 11:30:35","true","Upgrade Cortex, Prometheus and Thanos (#4830)

* Upgrade Cortex, Prometheus and Thanos

Signed-off-by: Marco Pracucci <marco@pracucci.com>

* Fixed imported ordering

Signed-off-by: Marco Pracucci <marco@pracucci.com>

* Fixed data type used for series ref when recovering from checkpoint/WAL

Signed-off-by: Marco Pracucci <marco@pracucci.com>

* Upgraded Thanos to fix arm build

Signed-off-by: Marco Pracucci <marco@pracucci.com>

* Run go mod tidy

Signed-off-by: Marco Pracucci <marco@pracucci.com>",216,43,0,0,"2018-04-16 10:25:39","1315.8"
"grafana/loki","127a8e27e7463fc60a459bd03746a9f3d144b724","vlad-diachenko","2023-10-13 08:24:08","true","[BloomShipper] updated bloom shipper to extract the block using the library (#10876)

Initial implementation was done based on the assumption that we would
use ZIP to archive the blocks.
However, we will use `.tar.gz` archives, so, the implementation has been
adjusted to use helpers from the library that allow to archive/unarchive
`.tar.gz` files.
re: https://github.com/grafana/loki/pull/10849

Signed-off-by: Vladyslav Diachenko <vlad.diachenko@grafana.com>",26,66,1,0,"2018-04-16 10:25:39","2003.17"
"grafana/loki","f3b72c8b591e1cfc49a2688316382dcb9ff22b3d","DylanGuedes","2022-09-27 16:12:39","true","Promtail: Change max support compressed line size to be 2MB (#7268)

**What this PR does / why we need it**:
Change Promtail compression support max line size to 2MB instead of 4096
bytes (~4KB).
This however doesn't change the default buffer size.
4096 bytes means we can't ever have a buffer size bigger than ~4KB but
since the default mem page size is 4096
([source](https://unix.stackexchange.com/questions/128213/how-is-page-size-determined-in-virtual-address-space)),
we end up ignoring all lines.",89,53,1,1,"2018-04-16 10:25:39","1622.24"
"grafana/loki","ce14592686482a6b757309cf3920c598ab6bbc80","MichelHollands","2023-03-28 19:14:55","true","Update version used in production scripts (#8925)

**What this PR does / why we need it**:
Update to 2.7.5

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",83,59,1,1,"2018-04-16 10:25:39","1803.37"
"grafana/loki","e2a63e582c4251f2afa35263f0fe04d522444288","owen-d","2023-06-27 14:27:55","true","adds tsdb-max-bytes-per-shard limit (#9811)

Adds the per tenant limit `tsdb-max-bytes-per-shard` which is used in
configuring the shard size for tsdb subqueries. This effectively gives
control over how big subqueries should be (assuming they're shardable).
The default is no different (`600MB`) than the previously hardcoded
initial value.

This should help us iterate to find optimal shard sizes to improve
operations in the long term.",62,62,1,1,"2018-04-16 10:25:39","1897.42"
"grafana/loki","c340f3e20260345acbdf055114db3fcef7adbd2a","owen-d","2022-08-19 17:17:39","true","[TSDB] disables bloom filters for tsdb index on ingesters (#6939)

* disables bloom filters for tsdb index on ingesters
Signed-off-by: Owen Diehl <ow.diehl@gmail.com>

* gofmt -s
Signed-off-by: Owen Diehl <ow.diehl@gmail.com>

* faillint exception for proto sync/atomic
Signed-off-by: Owen Diehl <ow.diehl@gmail.com>",82,52,0,1,"2018-04-16 10:25:39","1584.29"
"grafana/loki","b502ee23adb74b31d5467f46289c6cd0c834836c","chaudum","2023-03-21 14:47:34","true","Remove ./tools/fetch-tags invocation from Makefile (#8854)

**What this PR does / why we need it**:

This invocation causes problems when make targets are executed in the build image container (`BUILD_IN_CONTAINER=true`), e.g. the `yacc` target, because git tries to fetch tags from `origin` using ssh, causing
error message like these:

```
Host key verification failed.
fatal: Could not read from remote repository.

Please make sure you have the correct access rights
and the repository exists.
error: Could not fetch origin
```

This is because local ssh keys are not mounted into the build container.

In order not to break CI builds (https://github.com/grafana/loki/pull/8232) we need to manually fetch the tags as the first step in release pipelines. This is added to the Drone configuration.

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",84,59,1,1,"2018-04-16 10:25:39","1796.18"
"grafana/loki","f066de3b09c137fd3a3248759ac0f3b403cefcf5","JoaoBraveCoding","2023-05-09 09:59:21","true","Add default TopologySpreadContraints to querier (#9418)

Signed-off-by: Joao Marcal <jmarcal@redhat.com>",82,61,1,0,"2018-04-16 10:25:39","1849.23"
"grafana/loki","5f73598389218d47913995ab704b85abbc6ae2bc","tomwilkie","2018-12-05 13:06:01","true","Rename Tempo to Loki. (#36)

* Rename Tempo to Loki.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>

* Use new build image, don't delete generated files on clean.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",7,8,0,0,"2018-04-16 10:25:39","229.11"
"grafana/loki","21addf79351477c061afdea566dcce175d80a396","arl","2020-09-21 20:24:20","true","pkg/distributor: fix test by looking for loopback interface (#2645)

TestDistributor_PushIngestionRateLimiter failed if the system had no
interface name in ""eth0"", ""en0"" or ""lo0"".

Fix that by looking at the name of the loopback interface in the list
of the system's network interfaces, then using that name in the test.

Fixes #2356",115,29,0,0,"2018-04-16 10:25:39","885.92"
"grafana/loki","b43e2539256cb2fe499c6f586b1231cc1a5e40d1","chaudum","2023-10-22 19:28:21","true","chore(ksonnet): Simplify configuration of ingester deployment (#10542)

Simplify deployment with ksonnet: Remove `stateful_ingesters` flag, because ingesters should always be deployed as StatefulSet with WAL (write ahead log) enabled.


Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",25,66,1,1,"2018-04-16 10:25:39","2012.63"
"grafana/loki","a8827380a7aef88bf07006be891d1fa583b3e56f","kavirajk","2023-09-21 16:58:02","true","docs: Make `release` steps in `_index.md` (#10667)",33,65,1,1,"2018-04-16 10:25:39","1981.52"
"grafana/loki","358b8965c4fe5e6d95d09aa3166a02213974bd64","DylanGuedes","2023-05-18 12:13:41","true","Distributor: Add org_id to log error (#9475)

**What this PR does / why we need it**:
Add `org_id` to push error when the error is ""max active streams limit
exceeded"". Apparently all other push errors correctly report the
`org_id`, but not this one.

**Which issue(s) this PR fixes**:
N/A",69,61,1,1,"2018-04-16 10:25:39","1858.33"
"grafana/loki","6141347b7953658d5082bac9e9a5d5941d9d0101","dannykopping","2023-05-09 18:26:03","true","Adding more buckets to loki_memcache_request_duration_seconds histogram (#9431)

**What this PR does / why we need it**:
Users using extstore (with NVMe drives) may experience latencies higher
than the ~250ms max as previously defined.

---------

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",82,61,1,1,"2018-04-16 10:25:39","1849.58"
"grafana/loki","9cc0f3c3a5d6d288aef22b3ee0ecd5a746e34fee","osg-grafana","2022-11-01 08:18:43","true","Remove CTA per @grafanawriter. (#7558)",89,54,1,0,"2018-04-16 10:25:39","1655.91"
"grafana/loki","6363e8da0acba6250f52d9c7b9329ba2185866f5","cyriltovena","2020-02-24 13:16:35","true","Better logql metric status code. (#1718)

* Fixes querier logql error to be 400 only for ast parsing error.
Improve frontend metrics to use a more granular status_code.
Improve prometheus histogram granularity.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add latency type dimensions to bytes throughput metric.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Use IsParseError in panic recovering.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* typo

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",118,22,0,1,"2018-04-16 10:25:39","673.37"
"grafana/loki","0d282f72ab194a9c8a75e7d24136840790ac9293","periklis","2022-07-04 07:43:02","true","operator: Fix make target deps for web-pre (#6565)",73,51,0,1,"2018-04-16 10:25:39","1538.89"
"grafana/loki","7f9536ff966bbe70c03a3c60269886f244adf1db","jdbaldry","2022-07-07 10:26:02","true","Fix release workflow (#6610)

* Use ""next"" as directory for `publish-tehcnical-documentation-next` test job

Co-authored-by: Susana Ferreira <susana.ferreira@grafana.com>

* Use ""release"" as directory for `publish-tehcnical-documentation-release` test job

Co-authored-by: Susana Ferreira <susana.ferreira@grafana.com>

* Fix content target folder

Co-authored-by: Susana Ferreira <susana.ferreira@grafana.com>

* Correctly escape period in regexp

Co-authored-by: Susana Ferreira <susana.ferreira@grafana.com>",71,51,0,0,"2018-04-16 10:25:39","1542"
"grafana/loki","9a6b5dbf7cf6f466f1720f86d402350c9769befc","geowa4","2019-10-09 18:49:16","false","Client recommendations documentation tweaks (#1124)

* consistent use of proper noun for Fluent Bit

* add notes about metrics extraction to client selection docs",68,18,0,0,"2018-04-16 10:25:39","538.6"
"grafana/loki","b01e830cde371534d60518c7e587ece2c522f99b","jeschkies","2023-10-18 08:30:06","true","Update dskit to 7b512eb. (#10927)

**What this PR does / why we need it**:
This is a small update to dskit that includes
https://github.com/grafana/dskit/pull/406 which will allow us to
intercept gRPC request in call clients.

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

---------

Co-authored-by: Michel Hollands <42814411+MichelHollands@users.noreply.github.com>",21,66,1,1,"2018-04-16 10:25:39","2008.17"
"grafana/loki","1e796b070f4e8456f738097f6914cfff55be2c85","jeschkies","2021-11-12 13:18:39","true","Give more context to rule parser errors. (#4730)

Summary:
- Give record and group name for failing parsing.",193,43,0,1,"2018-04-16 10:25:39","1301.87"
"grafana/loki","45ffebd4d81303269bee9cc4e4e39bb82375e983","jeschkies","2022-04-12 12:38:16","true","Return HTTP 400 when multiple tenants are present in push. (#5800)",320,48,0,1,"2018-04-16 10:25:39","1451.84"
"grafana/loki","af6e8cb6c9a02be44a978c4933fb17778cb401b7","slim-bean","2020-10-25 21:05:06","true","Update local and docker default config files to use boltdb-shipper with a few other config changes (#2803)

* change the default local and docker config files to use boltdb-shipper
also change them to use chunk_target_size

* create ruler local filesystems directories if they don't exist
change the ruler paths to be a little more consistent

* don't need to create temp dir, also checking for the storage type

* add compactor config to docker config file.",119,30,0,1,"2018-04-16 10:25:39","919.94"
"grafana/loki","953c36e3ede5a06ac6838f5f5c807b5f9a41d67f","simonswine","2022-08-16 07:34:57","true","Remove unnecessary spin up of mock (#6911)

This removes the unnecessary spinning up of a mock for
TestDoubleRegistration. The client itself is not used at all and that
causes it to be stopped before it is actually started.

Example flake: https://drone.grafana.net/grafana/loki/14724/2/5",83,52,0,0,"2018-04-16 10:25:39","1580.88"
"grafana/loki","a5aa34137a48b69ec2b005719e134fbeb68af6ec","beorn7","2020-05-22 17:09:15","false","Adjust Loki dashboards to the new label order

- container_name and pod_name have disappeared in K8s 1.16.

- We are changing the instance name in Prometheus (and removing it in
  Loki altogether). The instance name used to be the pod name, so
  switch usage of the instance label to the pod label.

The pod label will generally only appear as a target label with
rolling out recent changes to target labels. This will unfortunately
break dashboards if looking at older data.",120,25,0,0,"2018-04-16 10:25:39","766.78"
"grafana/loki","8f62334a58c49d79744ae337c501bb93edd60bae","cstyan","2022-04-19 04:53:47","true","[promtail] Add a log message stating that client level stream lag labels are deprecated (#5850)

* Add a log message stating that client level stream lag labels are
deprecated and will not be used.

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* Error on startup if a client level stream lag labels value is set.

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* fix lint error

Signed-off-by: Callum Styan <callumstyan@gmail.com>",173,48,0,1,"2018-04-16 10:25:39","1463.77"
"grafana/loki","6a85d7f94bd7911e30c253201c5bb0536aec2d39","periklis","2021-10-01 14:52:40","true","Make Dockerfile compatible for multi-platform builds (#91)",138,41,0,1,"2018-04-16 10:25:39","1260.94"
"grafana/loki","a20dae346304a8a7d467540290f8e7efaca31105","periklis","2021-05-07 17:40:09","true","Add support for runtime config (#45)",186,37,0,1,"2018-04-16 10:25:39","1117.05"
"grafana/loki","caa0b7f2eae95e6e372dbc147fed44d15f2818df","periklis","2021-12-16 14:57:15","false","Add missing index-gateway to pod status map",233,44,0,1,"2018-04-16 10:25:39","1335.94"
"grafana/loki","a13dec4d39531b582662f53e792cd3d132f4b4a1","woodsaj","2019-01-19 02:50:35","true","Merge pull request #229 from grafana/issue190

add container_name label to logs",63,9,0,0,"2018-04-16 10:25:39","272.68"
"grafana/loki","f15567297a17744e71e96e2aa4c37bf6dbe17adb","sleleko","2019-04-11 07:06:10","true","Merge pull request #1 from sleleko/sleleko-patch-doc-1

Create promtail-examples.md",97,12,0,0,"2018-04-16 10:25:39","354.86"
"grafana/loki","e938644ef8cb349484e5c3ecec8d7018849fa734","joe-elliott","2019-10-31 13:33:38","false","Helm path update (#1061)

* Updated helm chart push paths

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Updated helm chart versions

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Updated test to use new format when pushing

Signed-off-by: Joe Elliott <number101010@gmail.com>",68,18,0,0,"2018-04-16 10:25:39","560.38"
"grafana/loki","98f409a495e11069a76fc96e29b6227cd1451f70","MasslessParticle","2023-01-30 17:25:17","true","Only report test coverage when it changes (#8339)",82,57,1,1,"2018-04-16 10:25:39","1745.29"
"grafana/loki","f6871d8f5fb8e2eb799d28698b72eeac5d86eee0","Red-GV","2023-02-22 19:47:58","true","operator: Remove deprecated field querier.engine.timeout (#8579)",66,58,1,1,"2018-04-16 10:25:39","1767.39"
"grafana/loki","5ae6ea71f8509ae1af9dc47f9e85be018c002928","pstibrany","2020-03-10 13:17:18","true","Update Cortex to master (#1785)

* Update Cortex to v0.7.0-rc.0

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Fixed errors after updating to latest master.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Fixed errors after updating to latest master.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Fixed errors after updating to latest master.

queryrange.NewRetryMiddleware in NewLogFilterTripperware is now created
without metrics, as that would collide with metrics in NewMetricTripperware.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Make sure to start client.Pool before using it.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Use shared singleton memberlist KV. Fix queryrange metrics.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Make lint happy

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* go mod tidy

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Return err early.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>",119,23,0,0,"2018-04-16 10:25:39","689.37"
"grafana/loki","5f04eedc03083b6d0ce972f70f09ce62d5fbe600","thepalbi","2023-07-21 19:28:23","true","Refactor Promtail's `client.Manager` to do multi client instantiation (#9908)

**What this PR does / why we need it**:
This PR refactors Promtails `client.Manager` to include both WAL-enabled
client, and WAL disabled. This will make the transition easier towards
the agent codebase, only needing to instantiate one primitive to support
both WAL enabled/disabled clients under the `loki.write` component.
Also, re-uses a bunch of logic shared by both.

**Which issue(s) this PR fixes**:
Part of https://github.com/grafana/loki/issues/8197

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [x] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",55,63,1,0,"2018-04-16 10:25:39","1921.63"
"grafana/loki","0259f85d3b113421ec5c058ffb3c2f6b6d08ab36","RichiH","2020-12-04 09:34:46","true","Create ADOPTERS.md (#3033)

Signed-off-by: Richard Hartmann <richih@richih.org>",126,31,0,0,"2018-04-16 10:25:39","958.46"
"grafana/loki","a252a8fc01476586951f8a0140f6fc0401a37139","cyriltovena","2020-04-03 19:30:49","true","Fixes possible panic in json pipeline stage. (#1894)

This was reported to me today and it happens because the previous source can be nil.
This was only happening when debug log was on. And the problem was only in the json because it was using .String on a nil value.

I've added a test and activate debug during tests to cover those path too.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",119,23,0,1,"2018-04-16 10:25:39","712.63"
"grafana/loki","88feda41a02f9c544d7476f61e296373e83fbe72","cyriltovena","2021-11-19 07:42:01","true","Improve heap iterators. (#4731)

Mostly improve allocations but I'm planning to do more using those benchmark.

```
name                   old time/op    new time/op    delta
HeapIterator-16          3.87ms ± 6%    3.41ms ± 1%  -11.92%  (p=0.008 n=5+5)
HeapSampleIterator-16    2.09ms ± 1%    2.09ms ± 1%     ~     (p=0.421 n=5+5)

name                   old alloc/op   new alloc/op   delta
HeapIterator-16          10.5kB ± 0%     8.2kB ± 0%  -21.88%  (p=0.008 n=5+5)
HeapSampleIterator-16    8.40kB ± 0%    6.10kB ± 0%  -27.34%  (p=0.000 n=5+4)

name                   old allocs/op  new allocs/op  delta
HeapIterator-16            12.0 ± 0%       5.0 ± 0%  -58.33%  (p=0.008 n=5+5)
HeapSampleIterator-16      12.0 ± 0%       5.0 ± 0%  -58.33%  (p=0.008 n=5+5)
```

I want to introduce a difference between the need to dedupe vs order data.

The later doesn't requires poping from the heap, we could actually use a sort.slice.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",203,43,0,1,"2018-04-16 10:25:39","1308.64"
"grafana/loki","7682f133b6426b7726e4cf0a64341cb8152c581c","cyriltovena","2021-01-05 13:06:16","true","Improve JSON parser and add labels parser hints. (#3080)

* Improve JSON parser and add labels parser hints.

This is a rework of the json parser, that now uses iteration over reflection allowing to avoid allocations.

I've also implemented a way to guess and hints  what labels needs to be parsed when doing metric queries, this means we can extract only the few labels required from the log line.

benchcmp

```
❯ benchcmp  before.txt after.txt5
benchmark                                      old ns/op     new ns/op     delta
Benchmark_Parser/json/no_labels_hints-16       9889          3281          -66.82%
Benchmark_Parser/logfmt/no_labels_hints-16     1624          1671          +2.89%
Benchmark_Parser/logfmt/labels_hints-16        1601          790           -50.66%
benchmark                                      old allocs     new allocs     delta
Benchmark_Parser/json/no_labels_hints-16       139            56             -59.71%
Benchmark_Parser/logfmt/no_labels_hints-16     31             31             +0.00%
Benchmark_Parser/logfmt/labels_hints-16        31             5              -83.87%
benchmark                                      old bytes     new bytes     delta
Benchmark_Parser/json/no_labels_hints-16       3671          912           -75.16%
Benchmark_Parser/logfmt/no_labels_hints-16     464           464           +0.00%
Benchmark_Parser/logfmt/labels_hints-16        464           144           -68.97%
```

I've experienced a 2x to 4x improvement in my cluster.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* typos.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Review feedback.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",113,33,0,1,"2018-04-16 10:25:39","989.61"
"grafana/loki","c98dfa0da1599c290c5400edc12174d3aeb93338","cyriltovena","2020-12-03 14:15:31","true","Fixes a swallowed context err in the batch storage. (#3025)

Fixes #2999

There's still a potential cases where, the context is done (and so the Err is not nil) and we're finished
with iterating over the list of batches. I didn't introduce the error here because I think I would prefer a success in this case.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",125,31,0,1,"2018-04-16 10:25:39","957.66"
"grafana/loki","16d4f874f0252b2efdc7853eae9ead0105593558","periklis","2022-09-12 12:06:07","true","operator: Fix flaky TLSProfile feature gate test (#7131)",85,53,1,1,"2018-04-16 10:25:39","1607.07"
"grafana/loki","5acf651b59f4fd7ad75ceefd7248d3fc7f75b75e","periklis","2022-09-23 15:22:10","true","operator: Fix ruler grpc tls client configuration (#7214)",87,53,1,1,"2018-04-16 10:25:39","1618.21"
"grafana/loki","ca944a5e8c01949dbf2c8b0062251d8c4adc0739","periklis","2021-12-17 16:18:43","true","Fix operator action for sending code coverage (#4965)",237,44,0,1,"2018-04-16 10:25:39","1337"
"grafana/loki","da6fd014448061df7ca3ffe71e469ab2f2d2e77b","cstyan","2022-08-29 14:40:03","true","[docs] document logfmt pipeline stage (#6238)

I noticed earlier while writing a design doc that the `logfmt` pipeline
stage is not documented. It was originally added here:
https://github.com/grafana/loki/pull/4346

I've also fixed a minor typo in the json pipeline stage docs.

Signed-off-by: Callum Styan <callumstyan@gmail.com>
Signed-off-by: Edward Welch <edward.welch@grafana.com>
Co-authored-by: Ed Welch <ed@oqqer.com>
Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>
Co-authored-by: Edward Welch <edward.welch@grafana.com>",80,52,1,1,"2018-04-16 10:25:39","1594.18"
"grafana/loki","b7a4035ba69f0ded089e523bf8370e0aa42cafba","woodsaj","2019-01-19 02:28:29","false","add container_name label to logs

fixes #190
Pods can have multiple containers. This fix ensures that we collect
logs for all containers.",63,9,0,0,"2018-04-16 10:25:39","272.67"
"grafana/loki","7435695991b23c93603af16ece7aa34a43c94f40","bulletfactory","2018-12-12 18:17:28","false","Add files via upload (#83)

* Add files via upload

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>

* Centering not working for some reason.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",19,8,0,0,"2018-04-16 10:25:39","236.33"
"grafana/loki","714e5d357b61faeb4ad4fe47498a023922a2bd45","tomwilkie","2018-05-19 09:09:53","false","Honor limit in ingesters

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",0,1,0,0,"2018-04-16 10:25:39","32.95"
"grafana/loki","c2e610b29dfd82490fa603b683fbefc172521f91","alexandre-allard","2020-09-10 13:28:14","true","Add support for PV selector in Loki statefulset (#2554)",116,29,0,0,"2018-04-16 10:25:39","874.63"
"grafana/loki","afc1e53df9cdfc929794e296546c7b9d1fbd010b","jeschkies","2020-12-03 15:58:49","true","Collapse multiline logs based on a start line. (#3024)

* Collapse multiline logs based on a start line.

Summary:
This is a very simple approach based on #1380 to provide multiline
or block log entries in promtail.

A `multiline` stage is added to pipelines. This stages matches a start
line. Once a start line is matched all following lines are appended
to an entry and not passed on to downstream stages. Once a new start
line is matched the former block of multilines is sent.

If now new line arrives withing `max_wait_time` the block is flushed to
the next stage and a new block is started.

* Test multiline stage process.

* Format code.

* Flush multiline block after `max_lines`.

* Capture internal state of the stage.

* Process different multiline streams in parallel.

* Start documenting multiline stage.

* Give an example configuration for `multiline` stage.

* Make linter happy.

* Pass through entries until first start line.

* Update pkg/logentry/stages/multiline.go",124,31,0,1,"2018-04-16 10:25:39","957.73"
"grafana/loki","6853c387ed7b8197ac0c0559bcc2f1f8d6a52c87","slim-bean","2021-10-26 07:11:41","true","Loki: Apply the ingester ring config to all other rings (distributor, ruler, query-scheduler) (#4546)

* apply the ingester ring config to all other rings in ApplyDynamicConfig

* update the test, only verify ingester config wasn't manipulated by the step to apply the common memberlist config when join_members is defined.",165,42,0,1,"2018-04-16 10:25:39","1285.62"
"grafana/loki","efac69032854e9f0e31aa2133caf9141e9c3c968","jeschkies","2023-07-20 16:24:36","true","Use series hash to identify uniques in merge. (#9985)

**What this PR does / why we need it**:
A run of the protobuf encoding for the querier showed a spike in memory
usage in the `codec.MergeResponse` method. The routine was allocating a
lot of memory for the `series.String()` method which is then hashed.
Instead, we can use a `uint64` hash.

```
› go test -v -run=^$ -bench ""Benchmark_MergeResponses$"" -count=10 ./pkg/querier/queryrange
...
                   │ before.txt │             after.txt              │
                   │   sec/op   │   sec/op    vs base                │
_MergeResponses-16   4.563 ± 1%   1.197 ± 1%  -73.77% (p=0.000 n=10)

                   │   before.txt    │              after.txt               │
                   │      B/op       │     B/op      vs base                │
_MergeResponses-16   6578.715Mi ± 0%   2.362Mi ± 0%  -99.96% (p=0.000 n=10)

                   │  before.txt   │              after.txt              │
                   │   allocs/op   │  allocs/op   vs base                │
_MergeResponses-16   40500.1k ± 0%   100.1k ± 0%  -99.75% (p=0.000 n=10)

```

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [x] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",58,63,1,1,"2018-04-16 10:25:39","1920.5"
"grafana/loki","849f45ea8cd04ee724d37c5946691501b55bd17a","JordanRushing","2022-01-25 18:23:15","true","Update loki-mixin gcs queries in the Loki operational dashboard (#5232)

Signed-off-by: Jordan Rushing <jordan.rushing@grafana.com>",271,45,0,0,"2018-04-16 10:25:39","1375.08"
"grafana/loki","c4d2966fdfc82ad75ebe57cb03c7930272100e80","periklis","2023-06-01 16:12:11","true","operator: Remove general production use warning (#9598)",68,61,1,1,"2018-04-16 10:25:39","1871.49"
"grafana/loki","5640cd0f7c06f0ed9bcc33f23f0d8a564952ba33","cstyan","2021-11-03 12:31:54","true","Simplify standard label selectors (datsource, cluster, namespace) on (#4618)

multiple dashboards + fix broken logs dashboard.

Signed-off-by: Callum Styan <callumstyan@gmail.com>",170,42,0,1,"2018-04-16 10:25:39","1292.84"
"grafana/loki","9393f3f11a0ddbde5be450809b7259139410dc9f","jeschkies","2023-07-05 14:25:28","true","Test querier handlers reponse format. (#9854)

**What this PR does / why we need it**:
This is a follow up to #9813 that introduced a handler test to verify
the response format for the legacy and v1 APIs.

The test requires mocking of the engine and query which meant the
introduction of a query engine interface.

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [x] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",59,63,1,1,"2018-04-16 10:25:39","1905.42"
"grafana/loki","e75acd79fc48c357008a4822733133d6b1092c97","slim-bean","2019-08-18 12:56:17","false","update  helm and ksonnet to 0.3.0",106,16,0,1,"2018-04-16 10:25:39","487.35"
"grafana/loki","ee28dbff2dc975d4c32816fffbfa288593586159","slim-bean","2020-08-24 11:06:39","true","implement shutdown for the no-op server (#2542)

(cherry picked from commit b4c6065b9726d2d5bba3f2dea0d726c698d8eb0f)",122,28,0,1,"2018-04-16 10:25:39","858.53"
"grafana/loki","ba91a0e48a759f72c18040919b8c26682f82b342","slim-bean","2022-01-05 13:33:48","true","lock the mutex before working with the `fileEventWatchers` (#5043)

Signed-off-by: Edward Welch <edward.welch@grafana.com>",251,45,0,1,"2018-04-16 10:25:39","1354.88"
"grafana/loki","1557dab34f1d2e70c7bd9abefc4beb5eb7ef50ad","taisho6339","2021-11-09 14:42:14","true","Add SASL&mTLS authentication support for Kafka in Promtail (#4663)

* Add xdg-go module

* Add mTLS, SASL/PLAIN, SASL/SCRAM authentication support

* docs: Add authentication configuration

* Add test tools for kafka authentication

* Add test stacks for SSL, SASL/PLAIN, SASL/SCRAM, SASL over TLS authentication

* Fix shelllint",188,43,0,0,"2018-04-16 10:25:39","1298.93"
"grafana/loki","54d1d3bea730c2dac85b72614cacd1a3a71cd408","liguozhong","2021-01-15 16:52:11","true","[doc] fix:querier do not handle ""/flush"" api (#3165)",120,33,0,1,"2018-04-16 10:25:39","999.77"
"grafana/loki","3abee7829d4d8db655feb2a9d49ddc82d039aef9","slim-bean","2020-03-17 13:18:04","true","Log the full stats and send to stderr instead of stdout (#1808)

Signed-off-by: Edward Welch <edward.welch@grafana.com>",115,23,0,1,"2018-04-16 10:25:39","696.37"
"grafana/loki","35510ba4eb3615da78b15934bf6355b43378f499","slim-bean","2023-01-30 16:24:07","true","Loki: only log ""executing query"" once per query in the frontend (#8337)

Signed-off-by: Edward Welch <edward.welch@grafana.com>
Co-authored-by: Danny Kopping <danny.kopping@grafana.com>",83,57,1,1,"2018-04-16 10:25:39","1745.25"
"grafana/loki","0b1dbe26fe7643c7681560ecca9585b4cf976dd9","slim-bean","2020-09-18 16:15:39","true","Promtail: Add a stream lagging metric (#2618)

* add a metric which displays how far a stream lags the last timestamp in a batch

* register your metrics

* recorded metric in the wrong spot, moved to the correct spot

* cardinality is much too high if we add all the stream labels, instead just use filename.

* work on using an interface to set/remove metrics

* reworking interface again

* for now just register this metric based on filename only, we can improve this in the future if the need arises

* change the timeout to 1min for expiring the metric

* add host label

* include host label when removing metric

* change the batch size for promtail from 100kb to 1Mb, this will not affect sending for lower volumes which are still driven by the BatchWait setting. Through the addition of this metric it was found that for higher volume files > 100kb/sec this was much too low causing too many batches to be unnecessarily sent.",120,29,0,1,"2018-04-16 10:25:39","882.74"
"grafana/loki","a7e0e48245bf02f520d59af4eeecf6985fa0a8db","rfratto","2019-08-15 14:37:39","true","ksonnet: update ingester config to transfer chunks on rollout (#894)

ingester.max_transfer_retries and
ingester.lifecycler.{join_after, claim_on_rollout} have been
added and set to match values proven to work for Cortex in production.",102,16,0,1,"2018-04-16 10:25:39","484.43"
"grafana/loki","4b74a5b8155b39404e2b4eba4a638aa81d26b983","chaudum","2023-03-08 13:35:03","true","Implement hierarchical queues for query scheduler (#8691)

### What this PR does / why we need it:

This PR is the first step towards hierarchical queues within the query scheduler.
Hierarchical queues can be used to ensure query fairness across multiple actors within a single tenant, such as individual (human) users using the same tenant.

The change is described in the LID [""Query fairness across users within tenants""](https://grafana.com/docs/loki/next/lids/0003-queryfairnessinscheduler/).

* Extract metrics for `RequestQueue` into their own `metrics` field, so that they can extended and passed more easily in the future.
* Move mapping for tenant queues into its own data structure (ordered map) so its functionality can be reused. It also simplifies the code inside the `tenantQueues` struct.
* Add the `LeafQueue` struct that implements hierarchical queues. Sub-queues are dequeued in a round-robin manner using the same implementation of `Mapping` that is also used by the tenant queues.

### Special notes for your reviewer

Part of https://github.com/grafana/loki/pull/8585
Contains the changes from PR https://github.com/grafana/loki/pull/8722

**This PR does not yet make use of the new hierarchical queues, it only adds the relevant data structures. Wiring up will be done in a follow up PR.**

While the new `Mapping` data structure adds an unsignificant overhead to the time/op I consider the simplification an overall better tradeoff.

```console
$ benchstat scheduler-bench-old.txt scheduler-bench-new.txt 
name              old time/op    new time/op    delta
GetNextRequest-8    18.0µs ± 2%    20.5µs ± 3%  +13.89%  (p=0.008 n=5+5)
QueueRequest-8      56.6µs ± 0%    53.5µs ± 3%   -5.48%  (p=0.008 n=5+5)

name              old alloc/op   new alloc/op   delta
GetNextRequest-8    1.60kB ± 0%    1.60kB ± 0%     ~     (all equal)
QueueRequest-8      35.6kB ± 0%    29.8kB ± 0%  -16.37%  (p=0.008 n=5+5)

name              old allocs/op  new allocs/op  delta
GetNextRequest-8       100 ± 0%       100 ± 0%     ~     (all equal)
QueueRequest-8         819 ± 0%       806 ± 0%   -1.59%  (p=0.008 n=5+5)
```

#### Complexity of operations

| Operation | Function | Complexity |
| --------- | -------- | ---------- |
| Insert | `Put(key string, value *tenantQueue) bool` | `O(1)`|
| Select | `GetNext(idx QueueIndex) *tenantQueue` | `O(1)` (best case)
`O(n)` (worst case) |
| Remove | `Remove(key string) bool` | `O(1)` |

---

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",84,59,1,1,"2018-04-16 10:25:39","1783.13"
"grafana/loki","c405db43179c58e6aef18a8aed8129fb5b83c5a2","owen-d","2023-10-06 15:56:58","true","Format + Library for building bloom filter ""blocks"" from chunks (#10780)

This PR introduces both a binary format for bloom filter ""blocks"" and a
library for building/querying them.

Each ""block"" consists of two files:
1) `Index`. This is a list of individually compressed pages of
stream+chunk information sorted in ascending fingerprint order. Each
series lists both the chunks indexed in the bloom filters as well as the
relevant offsets for said series in the bloom file.
2) `Blooms`. This is a list of individually compressed pages of bloom
filters for each series, again sorted in ascending fingerprint order.


There is still more work to do, but I'm opening this PR as an initial
pass.",25,66,1,1,"2018-04-16 10:25:39","1996.48"
"grafana/loki","2e6e050453558b5bac97158e82ef9675e6131714","chaudum","2022-01-25 09:59:04","true","Improve docs on how to install logcli from source (#5126)

* Improve docs on how to install logcli from source

Closes #5108

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* fixup! Improve docs on how to install logcli from source

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",274,45,0,1,"2018-04-16 10:25:39","1374.73"
"grafana/loki","c9b85b33ace5fb3c1a71b1bf418a5cbe3fdcc146","owen-d","2021-01-07 14:07:45","true","Integrates label replace into sharding code (#3132)

* avoid sharding label replace

* updates sharding tests

* matrix stepper end-inclusive for rangeVectorIterator parity

* Revert ""matrix stepper end-inclusive for rangeVectorIterator parity""

This reverts commit 2f34deab98810df52ed1b1d9270b3a0f43d82181.

* removes sharding equivalence tests due to interference by non-sharding bug in the control case",115,33,0,1,"2018-04-16 10:25:39","991.65"
"grafana/loki","e93f5bfd93d03411af791405663156726f475693","MichelHollands","2023-11-03 10:21:30","true","Add dashboard changes for migrating from cortex_ metrics to loki_ metrics (#11082)

**What this PR does / why we need it**:

- add missing namespace param for ruler manager metrics
- update the loki mixin to use the renamed metrics so both are supported
- created the compiled mixin
- make the prefix of the cortex_distributor_ingester_clients metrics
configurable

**Checklist**
- [X] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)
- [ ] If the change is deprecating or removing a configuration option,
update the `deprecated-config.yaml` and `deleted-config.yaml` files
respectively in the `tools/deprecated-config-checker` directory.
[Example
PR](https://github.com/grafana/loki/pull/10840/commits/0d4416a4b03739583349934b96f272fb4f685d15)

---------

Signed-off-by: Michel Hollands <michel.hollands@gmail.com>",11,66,1,1,"2018-04-16 10:25:39","2023.25"
"grafana/loki","0dda4924a7467ee6f2b4f68954f24633499c7c8f","MattiasSegerdahl","2023-05-01 08:26:15","true","Update index.md (#9319)

**What this PR does / why we need it**:

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",79,60,1,0,"2018-04-16 10:25:39","1841.17"
"grafana/loki","33a3fd2bf265fa98a64a298beb623a380b689acb","kavirajk","2023-08-11 12:01:13","true","CODEOWNERS: Add additional files as part of loki-operators (#10226)

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",53,64,1,1,"2018-04-16 10:25:39","1941.32"
"grafana/loki","347a3e18f4976d799d51a26cee229efbc27ef6c9","slim-bean","2019-08-02 19:04:42","false","release: update ksonnet and helm charts to version v0.2.0",106,15,0,1,"2018-04-16 10:25:39","471.61"
"grafana/loki","1b79df3754f60426459ea51b84fb8a387c4b9ff5","slim-bean","2020-12-23 21:57:03","true","add more notes to changelog",124,32,0,1,"2018-04-16 10:25:39","977.98"
"grafana/loki","e97e53f1b3eee18b60f55c4d857a62fef9071a20","slim-bean","2023-07-28 12:28:21","true","Loki: add an expirmental l2 chunks cache (#10061)

**What this PR does / why we need it**:

As we play around with our caching strategies, there has surfaced a
potential benefit to having 2 layers of chunks cache with a `duration
from now` handoff. i.e. chunks older than _x_ days get sent to an L2
chunks cache.

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

---------

Signed-off-by: Edward Welch <edward.welch@grafana.com>",51,63,1,1,"2018-04-16 10:25:39","1928.34"
"grafana/loki","68922fb7f27cb0840449d1d74d191a7dda146608","tomwilkie","2018-12-05 16:24:29","true","Update github.com/weaveworks/common. (#39)

Fixes #37.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",7,8,0,0,"2018-04-16 10:25:39","229.25"
"grafana/loki","488a21bff77eb876353c6915fecdff6319b14389","BenoitKnecht","2021-08-24 12:09:19","true","pkg/storage/chunk/aws: Add s3.http.ca-file option (#4211)

* pkg/storage/chunk/aws: Fix insecure-skip-verify documentation

The documentation claimed that the `s3.http.insecure-skip-verify` option needed
to be set to `false` in order to skip verifying certificates, but it needs to
be set to `true`.

Signed-off-by: Benoît Knecht <bknecht@protonmail.ch>

* pkg/storage/chunk/aws: Add s3.http.ca-file option

This option lets users set a custom CA file for connections to S3, in case they
use a local S3 instance with an internal PKI.

Signed-off-by: Benoît Knecht <bknecht@protonmail.ch>",126,40,0,0,"2018-04-16 10:25:39","1223.82"
"grafana/loki","46b7d92ecf026263dcf7ab5032ae81249f1ff85c","JStickler","2023-04-25 15:37:49","true","Mark template as draft to unpublish. (#9284)

**What this PR does / why we need it**:

Marks the LID template as ""draft"" so that the template is not published
to the docs site.

**Which issue(s) this PR fixes**:
Fixes #9283",81,60,1,0,"2018-04-16 10:25:39","1835.47"
"grafana/loki","db3a9c961e65f186f910cc07e7f46b32779ca9a0","kavirajk","2023-01-20 14:36:34","true","distributor: Fix `loki_mutated_bytes_total` metric increment (#8223)

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

Previously this metric was not not incremented for all the log lines in the stream. This PR fixes it.",83,57,1,1,"2018-04-16 10:25:39","1735.17"
"grafana/loki","c7eb757ed8d42dbda3207ff843243e43de3dfeb5","paul1r","2023-10-26 19:08:44","true","Initial loki bloom creation library (#10957)

**What this PR does / why we need it**:

Optimization and benchmarking of various LRUs that sit in front of the
bloom filters.
Initial creation of a library that can be used to create blooms from
chunks

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

---------

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>",19,66,1,0,"2018-04-16 10:25:39","2016.61"
"grafana/loki","9a86cc882a4326b3c4278b9b4ca988496581ca13","m0rtalis","2021-12-22 20:44:33","true","Add default tags for docker-compose (#4916)

The docker driver parses `compose_project` and `compose_service` when container in deployed with Docker Compose.

Relevant code:
https://github.com/grafana/loki/blob/24b4c0eed2ca35225c88d428f62766e4fffbc67a/clients/cmd/docker-driver/config.go#L260-L268",245,44,0,0,"2018-04-16 10:25:39","1342.18"
"grafana/loki","a6bec98b20a847e506c039ae8aab5cd9cd42d65e","simonswine","2022-04-13 11:14:40","true","Raise version of build image correctly (#5900)

Was using the makefile first. Now read the docs again:

https://github.com/grafana/loki/blob/main/docs/sources/maintaining/release-loki-build-image.md",319,48,0,0,"2018-04-16 10:25:39","1452.78"
"grafana/loki","14a84bbfdecd175aab9fb1c107d17d8c630adc3f","periklis","2022-03-15 15:05:18","true","operator: Use tenant name as id for mode openshift-logging (#5624)",304,47,0,1,"2018-04-16 10:25:39","1424.94"
"grafana/loki","4c6f8e8149443b92223d16378dff3afc66807b05","scoof","2021-01-26 14:21:50","true","docs: point to latest release for docker installation (#3235)

Signed-off-by: Andreas Plesner <apj@mutt.dk>",121,33,0,0,"2018-04-16 10:25:39","1010.66"
"grafana/loki","f6af9fcb3b8b1a0a76bc53ba6ae83d8d657c5036","daniellee","2018-12-11 13:58:25","false","centers badges in the readme

Signed-off-by: Daniel Lee <dan.limerick@gmail.com>",12,8,0,0,"2018-04-16 10:25:39","235.15"
"grafana/loki","13a3df8826d87c07e683cdc1049c1b64f443fc95","bboreham","2021-08-31 08:51:34","true","Simplify Distributor.push (#4240)

Instead of creating another goroutine to wait for the background
`sendSamples()` to finish, give the channels it is sending on a buffer
so that they can send without a listener.

Signed-off-by: Bryan Boreham <bjboreham@gmail.com>",129,40,0,0,"2018-04-16 10:25:39","1230.68"
"grafana/loki","91ec2fc2bb9f29744e8496bd22a3aa208a954240","trevorwhitney","2023-11-03 16:57:43","true","add tests for log volume middleware (#11126)

**What this PR does / why we need it**:
 
This adds some tests around the volume middleware, which were very
useful in understanding a recent issue",11,66,1,1,"2018-04-16 10:25:39","2023.52"
"grafana/loki","fd5d78784fbc0200bb2ca9250515b818d4c24c0e","salvacorts","2023-04-11 10:32:32","true","Estimate chunk size on compaction looking at data uncompressed size (#9099)

**What this PR does / why we need it**:
At `compactedIndex.ToIndexFile` we were not computing the size of the
chunk correctly. We were looking at the size of the chunk ref. Since the
size of the chunk ref is always a bunk of bytes, the chunk meta KB field
would always be 0.

https://github.com/grafana/loki/blob/4e893a0a88b2c8c3ea9d1d8b1037f54d8fb7f1af/pkg/storage/stores/tsdb/compactor.go#L367

Instead, we should get the approx KBs by looking at the chunks data
uncompressed size. As we do at `store.IndexChunk`:

https://github.com/grafana/loki/blob/d405162516be78beb3d0712cfd57256c7873fe78/pkg/storage/stores/tsdb/store.go#L189",83,60,1,1,"2018-04-16 10:25:39","1816"
"grafana/loki","dd80d86210bbb9250b573fdb13a1956cd5c5e5a5","periklis","2022-06-30 09:54:49","true","operator: Publish docs as public website (#6449)",73,50,0,1,"2018-04-16 10:25:39","1534.98"
"grafana/loki","d69d3b664c57b8c6999fc83f7dff6e8790237a1f","wujunwei","2022-09-05 07:41:02","true","Deprecation Fix: Replace strings.Title with cases.Title().String() (#7048)

Signed-off-by: wujunwei <wjw3323@live.com>

<!--  Thanks for sending a pull request!  Before submitting:

1. Read our CONTRIBUTING.md guide
2. Name your PR as `<Feature Area>: Describe your change`.
  a. Do not end the title with punctuation. It will be added in the changelog.
  b. Start with an imperative verb. Example: Fix the latency between System A and System B.
  c. Use sentence case, not title case.
  d. Use a complete phrase or sentence. The PR title will appear in a changelog, so help other people understand what your change will be.
3. Rebase your PR if it gets out of sync with main
-->

**What this PR does / why we need it**:

[Golang 1.18 deprecates the `strings.title function`](https://github.com/golang/go/issues/48367)  use `cases.Title(language.Und, cases.NoLower).String()` instead.

**Which issue(s) this PR fixes**:


**Special notes for your reviewer**:

<!--
Note about CHANGELOG entries, if a change adds:
* an important feature
* fixes an issue present in a previous release, 
* causes a change in operation that would be useful for an operator of Loki to know
then please add a CHANGELOG entry.

For documentation changes, build changes, simple fixes etc please skip this step. We are attempting to curate a changelog of the most relevant and important changes to be easier to ingest by end users of Loki.

Note about the upgrade guide, if this changes:
* default configuration values
* metric names or label names
* changes existing log lines such as the metrics.go query output line
* configuration parameters 
* anything to do with any API
* any other change that would require special attention or extra steps to upgrade
Please document clearly what changed AND what needs to be done in the upgrade guide.
-->
**Checklist**
- [ ] Documentation added
- [ ] Tests updated
- [ ] Is this an important fix or new feature? Add an entry in the `CHANGELOG.md`.
- [ ] Changes that require user attention or interaction to upgrade are documented in `docs/sources/upgrading/_index.md`

Signed-off-by: wujw39640 <wujw39640@hundsun.com>",78,53,1,0,"2018-04-16 10:25:39","1599.89"
"grafana/loki","abc0fd26d2255d670b21d18e305b2d0b69d54af5","chaudum","2023-03-30 08:16:08","true","Enforce per tenant queue size (#8947)

**What this PR does / why we need it**:

Prior to the changes in https://github.com/grafana/loki/pull/8752 the max queue size per tenant was enforced by the size of the buffered channel to which a request was enqueued.
However, since we have hierarchical queues, every sub-queue has the same channel capacity as the root (tenant) queue. Therefore the total queue size per tenant needs to be tracked separately, so requests can be rejected when the max queue size is reached.

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",84,59,1,1,"2018-04-16 10:25:39","1804.91"
"grafana/loki","9cef86b162536179180724a0036956fc3572d904","MasslessParticle","2022-04-21 17:13:52","true","Invalidate caches on delete (#5661)

* Generate cache invalidation numbers in the delete store

* Get cache generation numbers from the store on request

* changlog

* rename tombstones to something more meaningful

* User invisible module

* query frontend relies on a compactor to get the cache generation number

* fix serialization

* source -> name

* lint errors

* lint errors

* log non-200 responses

* add jsonnet changes

* lint

* review feedback

* review feedback

* client rename",167,48,0,1,"2018-04-16 10:25:39","1466.28"
"grafana/loki","bcdf17b0a5e20bd497a7ad292ce4870f9a20f7e5","Red-GV","2022-09-29 09:21:03","true","Configurable TLS MinVersion and CipherSuites (#7227)",90,53,1,1,"2018-04-16 10:25:39","1623.96"
"grafana/loki","383eb6e70b395809cb103a8ada69fa74c1252e92","joe-elliott","2020-04-06 12:31:35","true","Addition of a `/suspend` endpoint to Loki Canary (#1891)

* First pass loki canary pause

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Write suspending msg to stderr

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Added resume endpoint

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Added documentation on new endpoints

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Pass both signals to the same channel

Signed-off-by: Joe Elliott <number101010@gmail.com>

* lint

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Removed return on startCanary

Signed-off-by: Joe Elliott <number101010@gmail.com>",118,24,0,0,"2018-04-16 10:25:39","715.34"
"grafana/loki","ce818952410d3c22009b1e982e10d1f446fecb71","chaudum","2023-06-20 18:56:42","true","Add shuffle sharding to index gateway (#9710)

This PR introduces shuffle sharding of the index files across index gateways where the shuffle sharding key is the tenant ID.

Instead of having a global replication factor on the index gateways which affects all tenants the same, whether they are small or large tenants, the shuffle sharding allows to specify a shard factor per tenant (on top of the replication factor). This a) reduces the amount of indexes that are downloaded on individual index gateways in case of a high replication factor (which is currently the de-factor standard to deal with high load) and b) allows to scale tenants individually.

The shuffle sharding algorithm is part of dskit's ring implementation and is not part of this commit.
If you have set a high RF for the index gateways, it is required to reduce the RF and instead set the shard factor for the tenants.


Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",61,62,1,1,"2018-04-16 10:25:39","1890.6"
"grafana/loki","ee67b9c70728e3ac97c341425ac8ede66ee0545e","rfratto","2020-09-08 18:12:25","true","Expose UserAgent and fix User-Agent version source (#2603)

* Use prometheus/common/version for reporting build version in User Agent header

Promtail wasn't using github.com/prometheus/common/version for the
User-Agent header when obtaining the build version. Instead, it imported
github.com/grafana/loki/pkg/build which modifies the Prometheus version
package on init.

This causes problems for importers that also import and modify
github.com/prometheus/common/version with their own build information
(i.e., grafana/agent).

This PR changes Promtail to obtain the build info from the common
dependency to obtain the correct build information regardless of
how Promtail is being run.

* expose UserAgent to allow it to be modifiable by importers",115,29,0,1,"2018-04-16 10:25:39","872.82"
"grafana/loki","b5c03b0802e24fd4c07eea7b737ed5583879ca15","owen-d","2019-11-19 14:51:34","false","Fix duplicate labels (update cortex) (#1280)

* Update to latest cortex to fix duplicate labels

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Start the licycler in the ingester

Required since this cortex change in https://github.com/cortexproject/cortex/commit/00566f61af49f2dd8257413d9e49a3053f708fce\#diff-dcd65a4ff2de424be70a561f141e067bR180

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* go mod tidy

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Move cortex to a fork for ARM support

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* updates cortex to master

Signed-off-by: Owen Diehl <ow.diehl@gmail.com>

* go mod tidy/vendor

Signed-off-by: Owen Diehl <ow.diehl@gmail.com>",72,19,0,1,"2018-04-16 10:25:39","578.43"
"grafana/loki","5d6d552d1a59ef827e21e2fd3ac6000e2dba490f","owen-d","2021-02-18 14:48:38","true","removes sharding queue math after global concurrency PR (#3356)",131,34,0,1,"2018-04-16 10:25:39","1032.68"
"grafana/loki","c638d924af376384e28f39f293a125ad967e7fa0","owen-d","2023-01-30 23:45:17","true","Update index metrics (#8316)",80,57,1,1,"2018-04-16 10:25:39","1745.56"
"grafana/loki","4c3959b5733dca68c55c1bc93f749fb4d0e416cf","owen-d","2022-04-14 13:01:26","true","Implements TSDB Head (#5864)

* begins speccing out TSDB Head

* auto incrementing series ref + mempostings

* mintime/maxtime methods

* tsdb head IndexReader impl

* head correctly populates ref lookup

* tsdb head tests

* adds prometheus license to tsdb head

* linting",320,48,0,1,"2018-04-16 10:25:39","1453.86"
"grafana/loki","75df21a4e5f2dd2af700d659b984367607fc269c","adityacs","2018-12-13 04:51:11","false","Updated README to mention the required go version for build. (#86)

Signed-off-by: Aditya C S <aditya.gnu@gmail.com>",18,8,0,1,"2018-04-16 10:25:39","236.77"
"grafana/loki","153a276178a3d605954184a8d7064ffaec62bafc","vlad-diachenko","2022-11-07 10:35:26","true","added empty changelog section for the next release (#7606)

**What this PR does / why we need it**:
we forgot to add an empty section for the next release to place
changelog entries there...",88,55,1,0,"2018-04-16 10:25:39","1662.01"
"grafana/loki","20567f9ed82187281ae6c361d7f83e541b1c09f5","DylanGuedes","2023-05-09 14:41:21","true","Ingester: Avoid repeating `streamName` on error message (#9419)

**What this PR does / why we need it**:
Modify how our ingesters build the final error message to not append the
streamName for every single entry. All entries are already part of the
same stream, so repeating it is unnecessary.",82,61,1,1,"2018-04-16 10:25:39","1849.43"
"grafana/loki","d8ed87d04c989cf1adcc4ca50217564d99349781","MichelHollands","2022-02-16 15:16:31","true","Update dskit version (#5392)

* Update dskit version

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* update changelog

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Add debug printing to see interfaces in CI. This will be reverted

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Add comment to remember to remove

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Use netutil.PrivateNetworkInterfacesWithFallback for the other rings

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Move import to place indicated by linter

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Remove debug printing

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Determine local interfaces in tests

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Rearrange import to satify linter

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Update build image in CircleCI

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Change changelegog message to show customer visible changes

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Add doc tag and use private network interfaces in common config

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Add comment about filtered out non private IP addresses

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Update the documentation of the interface names settings

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",292,46,0,1,"2018-04-16 10:25:39","1395.95"
"grafana/loki","f08984debf430147de8ddb58fb055a11a86a2ed6","granular-ryanbonham","2019-02-25 02:29:39","false","fix port in readinessProbe example",82,10,0,0,"2018-04-16 10:25:39","308.67"
"grafana/loki","2bd9c91564d3a71b721224178bbbf41a6afa3d8e","owen-d","2022-10-03 15:32:27","true","Bugfix include cache generations on querier response (#7300)

We check the cache number (incremented by deletes) after executing a
query with the value returned by the queriers which executed it. If
they’re different, we know we can’t safely cache. However, we’re never
actually returning a number from the queriers. This means that as soon
as this cache number is incremented by a delete, it’ll disable the
results cache for that tenant completely.

I suspect this has been a latent bug since we forked cortex (goes back
to missing some code from this
[PR](https://github.com/cortexproject/cortex/pull/2279) into cortex from
@sandeepsukhani back in the day!). It just showed itself once we started
using deletes.",92,53,1,1,"2018-04-16 10:25:39","1628.21"
"grafana/loki","9f49e1d51640142db7442f768ab3aed173f9dd99","sboschman","2019-04-23 18:45:20","false","allow additional container args for Loki (#503)",98,12,0,0,"2018-04-16 10:25:39","372.6"
"grafana/loki","3e90d5f972d1228997ef7b76c9bd56e6cab17050","kavirajk","2022-11-16 22:22:52","true","docs(v2.7.0): Minor tweaks on 2.7 release notes (#7672)

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

**What this PR does / why we need it**:
1. Tweak entry about `fifocache`
2. Also fix upgrade guide ref on release notes.
`#260 -> #270`

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [x] Documentation added
- [x] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",93,55,1,1,"2018-04-16 10:25:39","1671.5"
"grafana/loki","7eadddbcfcc23bd345ae130630e4e0554a032d0d","gguillotte-grafana","2022-09-23 14:34:14","true","Docs: Populate empty index pages (#7200)

Three docs index pages are dead ends - they are either blank or have no
links. In lieu of more detailed content, this PR populates these pages
with `{{< section >}}` shortcodes that automatically generate TOC-like
links to subpages.",86,53,1,0,"2018-04-16 10:25:39","1618.17"
"grafana/loki","1c3f5d09856627fd3dedbeb1904e3331f8845811","jeschkies","2022-08-30 22:26:18","true","Helm: Upgrade Minio chart dependency to 4.0.12. (#6974)

**What this PR does / why we need it**:
Changes to a supported Minio chart. Minio is also enabled by default.

**Which issue(s) this PR fixes**:
Fixes #6973

**Checklist**
- [x] Documentation added
- [ ] Tests updated
- [ ] Is this an important fix or new feature? Add an entry in the `CHANGELOG.md`.
- [ ] Changes that require user attention or interaction to upgrade are documented in `docs/sources/upgrading/_index.md`",80,52,1,1,"2018-04-16 10:25:39","1595.5"
"grafana/loki","ff224c3f72e8285a89f1d200d1742c1c767e0b71","slim-bean","2020-12-23 21:47:21","true","update changelog and upgrade guide for 2.1.0",124,32,0,1,"2018-04-16 10:25:39","977.97"
"grafana/loki","52da3844f9dec578adaf56c7e7e6e581061ce798","dannykopping","2021-07-30 11:17:10","true","Ruler: Adding group_key label to recording_rules_samples_queue_capacity metric (#4080)

* Adding group_key label to recording_rules_samples_queue_capacity metric

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Appeasing the linter

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",102,39,0,1,"2018-04-16 10:25:39","1199.79"
"grafana/loki","234f18a74733f4838c7702fb7408ececb7613c61","KMiller-Grafana","2022-01-12 16:32:41","true","Docs: Draft 2.4.2 release notes (#5105)

* Docs: Draft 2.4.2 release notes

* Docs: revise release note item for PR 4968

* Update docs/sources/release-notes/v2-4.md

Co-authored-by: Susana Ferreira <ssncferreira@gmail.com>

* add PR link

Signed-off-by: Edward Welch <edward.welch@grafana.com>

Co-authored-by: Susana Ferreira <ssncferreira@gmail.com>
Co-authored-by: Edward Welch <edward.welch@grafana.com>",262,45,0,0,"2018-04-16 10:25:39","1362"
"grafana/loki","69392de8b6762f7dfbc18c98312f6deec4768f0b","periklis","2023-06-05 13:44:49","true","Fix duplicate label values from ingester streams (#9629)",70,62,1,1,"2018-04-16 10:25:39","1875.39"
"grafana/loki","88419512ab0fd3191ec6fc4db88dd224fd5a7d91","periklis","2021-05-10 05:35:01","true","[API-CHANGE] Remove field MaxStreamsPerTenant in favor of using only MaxGlobalStreamsPerTenant (#48)",189,37,0,1,"2018-04-16 10:25:39","1119.55"
"grafana/loki","d3986b9e009a8229cd72e84525b790118c451b10","periklis","2021-05-11 22:04:23","true","Provide CSV markers to display CRD fields properly in OpenShift Console (#49)",191,37,0,1,"2018-04-16 10:25:39","1121.24"
"grafana/loki","60e33e37056d2ffe30e9098763b130c5f979800a","periklis","2023-07-27 21:01:09","true","Fix operator-bundle action syntax error (#10084)",50,63,1,1,"2018-04-16 10:25:39","1927.69"
"grafana/loki","c4091c83f490075b29bd9519c0013ba002b73a15","saurabhsadhale","2023-01-13 17:41:08","true","operator: Fix docs for OpenShift Data Foundation storage uses bucketnames instead of bucketname (#8139)",94,57,1,0,"2018-04-16 10:25:39","1728.3"
"grafana/loki","1c43a576a0d5fbf08cf3053d99e6fe5715301797","periklis","2022-11-18 12:38:58","true","operator: Fix api doc generation (#7718)",94,55,1,1,"2018-04-16 10:25:39","1673.09"
"grafana/loki","a02ce69a98e7ffe498078324df891affdfacaafe","KMiller-Grafana","2022-08-12 17:38:17","true","Docs: add minimal docs explaining how to use the LogQL Analyzer (#6900)",83,52,0,0,"2018-04-16 10:25:39","1577.3"
"grafana/loki","96bf8c7f475c8e3c610b34eeb1cb3dbd82079b95","MasslessParticle","2022-07-15 10:59:37","true","Document loki lable format (#6647)",71,51,0,1,"2018-04-16 10:25:39","1550.02"
"grafana/loki","ba7e36afd1809fdfe6f999a87152da761d2e1c5a","KMiller-Grafana","2022-06-15 15:06:07","true","Docs: Edits for several PRs that did not have a docs review (#6398)",68,50,0,0,"2018-04-16 10:25:39","1520.19"
"grafana/loki","d73df0834ad3627e26d27d3d59ac5ee8e71bd701","cyriltovena","2022-04-29 09:38:08","true","Improve series store index queries (#6045)",93,48,0,1,"2018-04-16 10:25:39","1473.97"
"grafana/loki","ede12d8435d22bf1784732a5e2e5cc96ca8a598d","dannykopping","2021-09-09 16:21:44","true","Revert ""Bug fixed in line 643 (#4298)"" (#4299)

This reverts commit 598cad896e63543540d5d188fd58bea4b83aec76.",129,41,0,1,"2018-04-16 10:25:39","1239"
"grafana/loki","968cfc026894e2f8e6fa28528591ec393fa04d93","periklis","2021-07-22 10:44:48","true","Fix broker to read a CR and generate manifests (#64)",96,39,0,1,"2018-04-16 10:25:39","1191.76"
"grafana/loki","7cc9e4843a8e7d94dfa3dccbcc7e6b98b9ed9ca5","periklis","2021-04-19 21:32:28","true","Fix default CSV sample (#31)",161,36,0,1,"2018-04-16 10:25:39","1099.21"
"grafana/loki","1664a98111b2e40364f3e3e0a5202229b79d75e4","slim-bean","2020-09-04 17:33:53","true","Ran htmltest on the generated site and fixed all the broken links (#2600)",118,29,0,1,"2018-04-16 10:25:39","868.8"
"grafana/loki","81c7bd33f549d787384be2f15a941c7e9c7d78d2","cyriltovena","2020-07-20 14:33:29","true","Fixes the fluentbit batchwait  backward compatiblity. (#2375)

We move from second `1` to duration `1s`, but we can keep that compatible.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",116,27,0,1,"2018-04-16 10:25:39","824.67"
"grafana/loki","24fd56683328514b58257972d6ca5baa9aeec51b","salvacorts","2023-07-28 08:13:51","true","Do not send back non-indexed labels for each entry in query response (#10090)

**What this PR does / why we need it**:
Since the non-indexed labels are part of the returned labels results, we
don't need to send them also along with each returned entry. This PR
will:
-  Reduce the size of the response payload
- Solve a problem in Grafana only showing the last log line

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [x] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",51,63,1,1,"2018-04-16 10:25:39","1928.16"
"grafana/loki","a4aeb0e651fe999273f9cbc08b892b935490f884","patsevanton","2023-03-31 17:48:34","true","Update rbac.authorization.k8s.io/v1beta1 to rbac.authorization.k8s.io/v1 (#8270)

rbac.authorization.k8s.io/v1beta1 ClusterRole is deprecated in v1.17+,
unavailable in v1.22+; use rbac.authorization.k8s.io/v1 ClusterRole

Signed-off-by: Anton Patsev <patsev.anton@gmail.com>

Which of these should I fill out in this PR ?

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

Signed-off-by: Anton Patsev <patsev.anton@gmail.com>",81,59,1,0,"2018-04-16 10:25:39","1806.31"
"grafana/loki","69d4a7a1e0210b036c1e234889fd37b4a9838fd9","blockloop","2021-03-19 21:16:18","true","gofmt internal/handlers/lokistack_create_test.go",169,35,0,0,"2018-04-16 10:25:39","1063.95"
"grafana/loki","d59b6481b2150c0f2bb80829ab3aa8f733bbbba2","daixiang0","2019-09-26 13:51:29","false","unify references to GOPATH (#1069)

Signed-off-by: Xiang Dai <764524258@qq.com>",71,17,0,0,"2018-04-16 10:25:39","525.39"
"grafana/loki","51b09d771fc01b00d0ba75e3a87a6c6ab45f89aa","jeschkies","2022-08-01 08:40:52","true","Open access to Minio console in dev setup. (#6807)",76,51,0,1,"2018-04-16 10:25:39","1565.93"
"grafana/loki","b1a948e28b13aa6a17ccd5e4f35030ed81ee6550","jeschkies","2023-08-21 11:49:53","true","Record waiting time for queriers to receive requests. (#10253)

**What this PR does / why we need it**:
We want to investigate whether work stealing among queriers would be
useful. So we are recording the wait time of queriers for new requests
in their queue.

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",50,64,1,1,"2018-04-16 10:25:39","1951.31"
"grafana/loki","82845e4f78dcdfbdd0182225de0a108559b040fc","slim-bean","2020-08-13 15:31:17","true","Adds --analyize-labels to logcli series command. (#2497)

Changes the series command to use the common matcher input found in the query and instant-query commands, instead of `logcli series --matcher='{foo=""bar""}'` it's now `logcli series '{foo=""bar""}'`",119,28,0,1,"2018-04-16 10:25:39","847.71"
"grafana/loki","191f87a376b2e59e6454cf7ccdc67786c227d892","slim-bean","2019-12-04 18:00:18","true","Adding `zip` to the build image (#1364)

Adding `drone` to the build image and updating the make target to run the drone command in the build image
Re-adding `GO111MODULE=on` to the dependency import as it is still required and was removed in error. (Also updated the comment a little to reflect why it is still needed)",92,20,0,1,"2018-04-16 10:25:39","593.57"
"grafana/loki","c212f4064d156036a373e104d28c6aee09fa6c55","oddlittlebird","2019-09-18 15:02:50","false","Update CONTRIBUTING.md (#1025)

Clarified link text",67,17,0,0,"2018-04-16 10:25:39","517.44"
"grafana/loki","33d7cf29562f98bd0641b7caf25b1dd73ed94800","slim-bean","2020-04-07 14:40:33","false","push images for `k` branches

Signed-off-by: Edward Welch <edward.welch@grafana.com>",116,24,0,1,"2018-04-16 10:25:39","716.43"
"grafana/loki","e22e666ca41218a10b5a0693de03d7a7cb3a003c","jdbaldry","2021-07-22 12:28:44","true","fix: Restore /config endpoint and correct handlerFunc for buildinfo (#4027)

As far as I can tell from reading the ""next"" documentation, the
/loki/api/v1/status/buildinfo endpoint should return the build
information. The /version endpoint is also listed further down in the
documentation but from the code prior to this change, it looks like it
should perform the same function as buildinfo endpoint so I have
removed it.

I've updated the documentation to reflect my changes.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>",96,39,0,0,"2018-04-16 10:25:39","1191.84"
"grafana/loki","8a546b31a92a02c9277ba9b63ad58e321e6eb423","dannykopping","2021-09-22 09:52:51","true","Ruler: per-tenant WAL (#4344)

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",127,41,0,1,"2018-04-16 10:25:39","1251.73"
"grafana/loki","4381b28c8045718a78de7f2dd6f88e56c68beea1","pstibrany","2019-12-19 15:30:17","false","pkg/chunkenc: BenchmarkRead focuses on reading chunks (#1423)

Previously BenchmarkRead asked for every single line from chunks to be returned.
This causes a lot of unnnecessary allocations, which dominate the benchmark.
Instead of counting bytes when reading, we now count size when generating data
for logging speed.

Another test was added to show that these two approaches are comparable.

This change makes BenchmarkRead to report real time needed to decode chunks:

name           old time/op    new time/op    delta
Read/none-4      86.2ms ± 0%    33.2ms ± 0%   ~     (p=1.000 n=1+1)
Read/gzip-4       255ms ± 0%     194ms ± 0%   ~     (p=1.000 n=1+1)
Read/lz4-4        121ms ± 0%      64ms ± 0%   ~     (p=1.000 n=1+1)
Read/snappy-4     119ms ± 0%      67ms ± 0%   ~     (p=1.000 n=1+1)

name           old alloc/op   new alloc/op   delta
Read/none-4       134MB ± 0%       0MB ± 0%   ~     (p=1.000 n=1+1)
Read/gzip-4       135MB ± 0%       0MB ± 0%   ~     (p=1.000 n=1+1)
Read/lz4-4        136MB ± 0%       1MB ± 0%   ~     (p=1.000 n=1+1)
Read/snappy-4     135MB ± 0%       0MB ± 0%   ~     (p=1.000 n=1+1)

name           old allocs/op  new allocs/op  delta
Read/none-4        491k ± 0%        3k ± 0%   ~     (p=1.000 n=1+1)
Read/gzip-4        491k ± 0%        3k ± 0%   ~     (p=1.000 n=1+1)
Read/lz4-4         491k ± 0%        3k ± 0%   ~     (p=1.000 n=1+1)
Read/snappy-4      491k ± 0%        3k ± 0%   ~     (p=1.000 n=1+1)

Decompression speed is now also more correct (esp. None is much higher than LZ4/Snappy)

		Before (/s)			Now (/s)
None	1.1 GB (n=1)		4.0 GB (n=1)
None	1.5 GB (n=9)		3.8 GB (n=38)
None	1.6 GB (n=13)
Gzip	516 MB (n=1)		640 MB (n=1)
Gzip	509 MB (n=3)		664 MB (n=4)
Gzip	514 MB (n=4)		649 MB (n=6)
LZ4		1.1 GB (n=1)		1.7 GB (n=1)
LZ4		1.1 GB (n=9)		1.9 GB (n=15)
Snappy	1.1 GB (n=1)		2.0 GB (n=1)
Snappy	1.1 GB (n=9)		1.8 GB (n=16)

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>",97,20,0,0,"2018-04-16 10:25:39","608.46"
"grafana/loki","7ac9e4ac9848f03c7b9a208c51a79ce6306af652","pracucci","2019-10-02 16:24:51","false","docs: improved table manager documentation (#1099)",77,17,0,0,"2018-04-16 10:25:39","531.5"
"grafana/loki","4d78e165dcb93d54538dd3f0738eb167847fac52","kovetskiy","2018-12-16 20:43:42","false","Fix duplicating base directory for file create event (#128)

Signed-off-by: Egor Kovetskiy <e.kovetskiy@gmail.com>",35,8,0,0,"2018-04-16 10:25:39","240.43"
"grafana/loki","096976511f134f027efbb2ca19b4fe419de60526","slim-bean","2020-08-04 12:21:22","true","Make a clone of the LabelSet before handling, the handler contains a full pipeline and can modify the labels uniquely per each line which will lead to some concurrent map access panics if you don't pass a copy of the labels to each Handle invocation. (#2464)",123,28,0,1,"2018-04-16 10:25:39","838.58"
"grafana/loki","81b9decfb525f6dd19043c1d53607aaeff47f8cd","slim-bean","2020-07-13 20:43:59","true","Loki-Canary: Add query spot checking and metric count checking (#2344)

* Add spot check capability to canary to query certain values over time to make sure they are still in Loki.
Add a context timeout to Loki queries

* Updating canary to use /loki/api/v1 endpoints
adding a metric test query

* fixing metric names to have _total for counters

* fix parsing of timestamp from log line and don't use entry timestamp

* Tweak the metric test query to adjust the range to the time the canary has been running to get accurate results until the requested range has been reached.
Add a total spot check entry counter to get a ratio of success

* Add some debugging logs to troubleshoot missing entries

* add more tests, fix some log lines

* update docs, make the spot-check timer separate from prune entries

* just how many paramaters can I add to the constructor....

* run prune entries on a separate thread, only run one at a time.",117,27,0,1,"2018-04-16 10:25:39","817.93"
"grafana/loki","aedf6dfc217fb71df4e7c873b158319b0b6da27c","jeschkies","2023-10-26 12:01:47","true","Remove `GetHeaders` from `logproto.VolumeResponse`. (#11049)

**What this PR does / why we need it**:
Replaces https://github.com/grafana/loki/pull/11048/. We would return
`logproto.VolumeResponse` but not match it in the codec.

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)
- [ ] If the change is deprecating or removing a configuration option,
update the `deprecated-config.yaml` and `deleted-config.yaml` files
respectively in the `tools/deprecated-config-checker` directory. <!--
TODO(salvacorts): Add example PR -->",19,66,1,1,"2018-04-16 10:25:39","2016.32"
"grafana/loki","4e7a123c776e14771c8f38b9a39370012214de96","cyriltovena","2020-12-08 07:35:24","true","Support rate for unwrap expressions. (#3048)

This allows to bytes throughput  if there were printed in a log line.

Examples :

```logql
sum by (device) (rate({app=""network-dev""} |= ""192.16.8.1"" | json | unwrap recv_bytes [1m]))
```

Closes #3044

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",127,32,0,1,"2018-04-16 10:25:39","962.38"
"grafana/loki","97dfb297a071f4eb45057bf4a25100ae97cd4c43","sandeepsukhani","2020-08-24 12:40:54","true","compress boltdb files to gzip while uploading from shipper (#2507)",122,28,0,1,"2018-04-16 10:25:39","858.59"
"grafana/loki","78723a48bbad1c3e8bfe3b6f969abdd581e9b024","tivvit","2020-08-14 11:11:15","true","Update README.md (#2501)

fix incorrect upgrade link",117,28,0,0,"2018-04-16 10:25:39","848.53"
"grafana/loki","1761db6d7147913d10609c467c87294ad81da17d","codesome","2020-01-15 15:51:07","false","Support <selector> <range> <filters> for aggregation (#1526)

Signed-off-by: Ganesh Vernekar <cs15btech11018@iith.ac.in>",103,21,0,0,"2018-04-16 10:25:39","634.48"
"grafana/loki","35d5a15aa951c7508c13aab1c0ef3d6d20617d00","candlerb","2019-09-17 15:04:26","false","Escape double-quotes in labels, and suppress labels with value nil (#928)

Fixes #927",69,17,0,0,"2018-04-16 10:25:39","516.44"
"grafana/loki","fea52f6a379ca0b54e19420e9fddb0c48d5c1307","cyriltovena","2019-05-10 15:59:27","false","adds test for json metrics",98,13,0,1,"2018-04-16 10:25:39","389.48"
"grafana/loki","eaa0919e53eb1a5bed8ced14695cc06d56271308","owen-d","2022-10-06 15:11:22","true","Use labelbuilder in syntax.ParseLabels to remove empty label values (#7355)

There's a bug in TSDB where empty label values alter the series
fingerprints used in chunk addresses, but are stripped out and create
different fingerprints in our TSDB based index. I plan to open a PR to
Prometheus, but I also prefer normalizing labels here by removing empty
label values.

According to
[Prometheus](https://prometheus.io/docs/concepts/data_model/),
> A label with an empty label value is considered equivalent to a label
that does not exist.

Our bug comes from the Prometheus model `LabelBuilder` stripping out
empty label values,
[here](https://github.com/grafana/loki/blob/main/vendor/github.com/prometheus/prometheus/model/labels/labels.go#L419-L423).
This means that `Labels.NewBuilder({job=""foo"",bar=""""}) => {job=""foo""}`.
The
[labels.Hash()](https://github.com/grafana/loki/blob/main/vendor/github.com/prometheus/prometheus/model/labels/labels.go#L136-L182)
function does not skip empty label values, meaning it's easy to end up
with different fingerprints for effectively the same series (an empty
label value is supposed to be equivalent to a missing label in
prometheus, but they generate different label hashes).",93,54,1,1,"2018-04-16 10:25:39","1631.2"
"grafana/loki","fed9115627973beb8394c7bfd7c0333d5e3c0502","cyriltovena","2021-07-22 08:41:38","true","Improve decoding of JSON responses. (#4019)

* Improves frontend allocations

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Improves also labels

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* refactoring.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add some more tests.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes tests and review feedback.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",97,39,0,1,"2018-04-16 10:25:39","1191.68"
"grafana/loki","603eb637f65efed6084ec6050aed552408f28059","salvacorts","2023-08-24 13:37:18","true","Add docs for non-indexed labels (#10073)

**What this PR does / why we need it**:

Adds documentation for the new experimental non-indexed labels feature.

---------

Co-authored-by: J Stickler <julie.stickler@grafana.com>
Co-authored-by: Sandeep Sukhani <sandeep.d.sukhani@gmail.com>
Co-authored-by: Vladyslav Diachenko <82767850+vlad-diachenko@users.noreply.github.com>",50,64,1,1,"2018-04-16 10:25:39","1954.38"
"grafana/loki","5ab9515020658860053590c9e38e0262be78a9b1","salvacorts","2023-09-12 07:49:33","true","Fix regression when parsing numbers in Push request (#10550)

**What this PR does / why we need it**:
Even though the[ Loki HTTP API docs for the push endpoint][1] state that
the stream label values should be strings, we previously didn't enforce
this requirement. With https://github.com/grafana/loki/pull/9694, we
started enforcing this requirement, and that broke some users.

In this PR we are reverting this type of assertion and adding a bunch of
tests to avoid the regression in the future.


[1]:
https://grafana.com/docs/loki/latest/reference/api/#push-log-entries-to-loki",42,65,1,1,"2018-04-16 10:25:39","1972.14"
"grafana/loki","9440dc9c32db4d661ef65d875de8dbf93caae897","daixiang0","2019-04-26 14:12:03","false","Update troubleshooting (#498)

* Update troubleshooting

- remove ""no label"" title
- add tracing part

Signed-off-by: Xiang Dai <764524258@qq.com>

* Add helm help

Signed-off-by: Xiang Dai <764524258@qq.com>",95,12,0,0,"2018-04-16 10:25:39","375.41"
"grafana/loki","c0f51b9851c45ecc7ee18e2839cdd4d93d02f772","afayngelerindbx","2022-04-21 06:04:09","true","redact s3 credential values when printing config to logs (#5961)",171,48,0,0,"2018-04-16 10:25:39","1465.82"
"grafana/loki","3fc93288624b914f5515d1dc1c3d594eac9a5d55","fl42","2023-06-02 08:03:23","true","Fix: HPA for single binary deployment (#9585)

**What this PR does / why we need it**:
Add HPA for single binary deployment. Off by default.

**Which issue(s) this PR fixes**:
Fixes #7097

**Special notes for your reviewer**:

**Checklist**
- [X] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [N/A] Documentation added
- [N/A] Tests updated
- [X] `CHANGELOG.md` updated
- [N/A] Changes that require user attention or interaction to upgrade
are documented in `docs/sources/upgrading/_index.md`
- [X] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

---------

Co-authored-by: Michel Hollands <42814411+MichelHollands@users.noreply.github.com>",69,62,1,0,"2018-04-16 10:25:39","1872.15"
"grafana/loki","4a45ca5e3ae72258a55e868f8b526f89c2309131","owen-d","2020-07-28 12:29:20","true","Revendor cortex (#2427)

* vendoring bump

* vendoring compat",126,27,0,1,"2018-04-16 10:25:39","832.59"
"grafana/loki","9d62f051b840eee03bc21aead3f40e3d29f4e687","MichelHollands","2022-03-29 16:59:40","true","Update fluent-bit output name (#5711)

* Update fluent-bit output name

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Empty commit

* Another empty commit",309,47,0,1,"2018-04-16 10:25:39","1439.02"
"grafana/loki","94af4c4f843bb013c1cb9dc5441ddbd297578f87","MichelHollands","2021-04-01 12:34:15","true","Some small docs fixes (#3568)

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",145,35,0,1,"2018-04-16 10:25:39","1075.59"
"grafana/loki","7ec24827247a7814e83ac22a2c25696fc47d3126","MattiasSegerdahl","2023-05-01 08:31:07","true","Update _index.md (#9308)

**What this PR does / why we need it**:

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",79,60,1,0,"2018-04-16 10:25:39","1841.17"
"grafana/loki","cae0491e403225ffa432139d2342880bc1d455d5","pracucci","2019-09-03 14:22:47","false","Moved promtail doc into dedicated subfolder (#933)",125,17,0,0,"2018-04-16 10:25:39","502.41"
"grafana/loki","5b8d9b4ed6216fb96f22fb6446da4d41fff2aac6","adityacs","2020-06-03 13:24:32","true","Support series query in query-frontend (#2123)",125,26,0,1,"2018-04-16 10:25:39","777.62"
"grafana/loki","afa53f19398c8cf37b9a4b858a988df6cc79a3ef","pracucci","2022-05-26 13:39:32","true","Loki mixin: publish compiled version of the mixin (#6254)

* Publish compiled mixin

Signed-off-by: Marco Pracucci <marco@pracucci.com>

* Update Makefile

Co-authored-by: Kaviraj Kanagaraj <kavirajkanagaraj@gmail.com>

* Updated build image version

Signed-off-by: Marco Pracucci <marco@pracucci.com>

Co-authored-by: Kaviraj Kanagaraj <kavirajkanagaraj@gmail.com>",72,49,0,0,"2018-04-16 10:25:39","1501.13"
"grafana/loki","aa3f06f36b440a73631915d8c58e78a4789fb1b5","domcyrus","2022-05-16 10:53:05","true","update auth header env variable usage help (#6169)",78,49,0,0,"2018-04-16 10:25:39","1491.02"
"grafana/loki","e2c4454a2d7deeec9996eb4c8a6303e44f4a996f","pixiono","2023-03-31 20:41:51","true","Fix dns-port in network-policy (#8733)

**What this PR does / why we need it**:
Currently the port for DNS is hardcoded in the network policy which
causes problems in our setup because we use a different port for this.
However, since the coredns pod always names the port ""dns"" we could use
this name.

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

Co-authored-by: Travis Patterson <travis.patterson@grafana.com>",81,59,1,0,"2018-04-16 10:25:39","1806.43"
"grafana/loki","e38ccb44180fd0c5ea29fa3864b34388739b2933","adeverteuil","2023-05-25 15:39:57","true","Uniformize ""Available Labels"" headers in Promtail config reference doc (#9436)

**What this PR does / why we need it**:

There were various formats for the ""Available Labels"" headings. This PR
makes them all the same heading level and spelling.",66,61,1,0,"2018-04-16 10:25:39","1865.47"
"grafana/loki","bcf917f65ad70568467d4af02c385607c7032ac9","faustodavid","2023-08-31 09:24:41","true","Helm: Increase HPA minReplicas and maxReplicas (#9843)",45,64,1,0,"2018-04-16 10:25:39","1961.21"
"grafana/loki","aa713f54f4e142862b197e37208d83417650f754","cstyan","2021-10-25 20:19:39","true","Modify lambda-promtail docs based on rewrite. (#4539)

Signed-off-by: Callum Styan <callumstyan@gmail.com>",162,42,0,1,"2018-04-16 10:25:39","1285.16"
"grafana/loki","a30629e36e7312f70ee657e866c10d563156b1eb","dannykopping","2023-08-21 07:21:02","true","Azure Blob Storage is no longer experimental (#10299)

**What this PR does / why we need it**:
Azure Blob Storage is being used in production by many organisations,
including Grafana Labs. It should no longer be marked experimental.

**Which issue(s) this PR fixes**:
Fixes #10298

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",51,64,1,1,"2018-04-16 10:25:39","1951.12"
"grafana/loki","a2370e3af3260e3705061092c0c5e8314d2669ee","periklis","2023-03-23 12:03:32","true","operator: Refactor all type validations into own package (#8878)",82,59,1,1,"2018-04-16 10:25:39","1798.07"
"grafana/loki","cd2ebeb27924971798816afbabac64681fda5ca5","MasslessParticle","2022-07-17 14:01:43","true","Fix per-tenant delete client (#6696)

- Don't make the request for a disabled tenant even if golbal deletion is allowed",70,51,0,1,"2018-04-16 10:25:39","1552.15"
"grafana/loki","aec00c2507c4894f8d05538a097724a8f84605b9","owen-d","2021-10-22 12:44:01","true","safely checks read ring for potentially nil scheduler (#4525)",165,42,0,1,"2018-04-16 10:25:39","1281.85"
"grafana/loki","feb5d711c7f4b9df239dd9183a75a2b5284db4ef","chaudum","2021-12-13 13:57:42","true","Add `-list-targets` command line flag (#4920)

* Add -list-targets flag to list available targets

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* Mark user-invisible modules as such

so they are not shown as run targets when listing available targets
using the `-list-targets` flag.

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* Mention command line flag in configuration docs

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* Add changelog entry

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* fixup! Add -list-targets flag to list available targets

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",230,44,0,1,"2018-04-16 10:25:39","1332.9"
"grafana/loki","e3e4e27c8cccc2b99bf27096fc851394cb18c4d0","MasslessParticle","2022-10-05 16:44:58","true","Implement ingester API to return stream rates (#7176)

This PR introduces an API on the Ingester that reports all current
streams in memory and their current rate in bytes/second. The reponse
from the API contains a slice of `StreamRate` structs:

```go
type StreamRate struct {
	StreamHash        uint64 `protobuf:""varint,1,opt,name=streamHash,proto3"" json:""streamHash,omitempty""`
	StreamHashNoShard uint64 `protobuf:""varint,2,opt,name=streamHashNoShard,proto3"" json:""streamHashNoShard,omitempty""`
	Rate              int64  `protobuf:""varint,3,opt,name=rate,proto3"" json:""rate,omitempty""`
}
```

In the interest of space on the caller and in transmission, only hashes
and rates are sent.
- `StreamHash` will be used to deduplicate replicas
- `StreamHashNoShard` will be used to aggregate a sharded stream's total
rate.

Co-authored-by: Dylan Guedes <djmgguedes@gmail.com>",93,54,1,1,"2018-04-16 10:25:39","1630.26"
"grafana/loki","1f408305c45ea10dfeb37af678c5cca3d1cd73dd","JStickler","2023-09-06 23:42:17","true","[Docs] Create top level Manage section (#10461)

**What this PR does / why we need it**:

Part of the Epic to create a consistent documentation information
architecture across the three DB projects.

**Which issue(s) this PR fixes**:
Fixes #8718 

**Special notes for your reviewer**:
The original Issue called for moving files under Manage, but rather than
rename the folder and break links, I chose to make the ""move"" by
updating the topic metadata.
This PR also includes updates to topic metadata and removes or updates
page weights.",46,65,1,0,"2018-04-16 10:25:39","1966.8"
"grafana/loki","e08fbd12abc8b4f48ad4168aa206c5d6e319e29e","sandeepsukhani","2021-06-22 10:01:02","true","Fix jsonnet for index-gateway (#3877)

* set index-gateway image in jsonnet

* update instead of overriding boltdb-shipper storage config",103,38,0,1,"2018-04-16 10:25:39","1161.73"
"grafana/loki","6a36cf6745337ff3fbe962d6cc7ca191690604fc","sandeepsukhani","2021-07-08 12:19:30","true","add some tests in compactor and fix a bug in IntervalHasExpiredChunks check in retention with tests (#3969)

* add some tests in compactor and fix a bug in IntervalHasExpiredChunks check in retention with tests

* check only for start time",124,39,0,1,"2018-04-16 10:25:39","1177.83"
"grafana/loki","360d9a7f97c30031733190a9c52b7ba43381ebd5","adityacs","2020-05-21 20:10:01","true","Support querying labels on time range in logcli (#2083)",119,25,0,1,"2018-04-16 10:25:39","765.91"
"grafana/loki","dac3b84d08936038e7766e4a89ccfccd22467ad6","trevorwhitney","2023-02-24 21:18:13","true","Loki cloud integration instructions (and necessary mixin changes) (#8492)

**What this PR does / why we need it**:

This PR is a first stab at documentation for setting up the Grafana
Cloud Loki Integration to monitor a local Loki cluster, installed using
the helm chart, using Grafana Cloud.

In addition to instructions on how to collect the necessary kubernetes
metrics, there were also some things with the Loki mixin (which provides
dashboards, alerts, and rules to the integration) that needed to be
fixed. For example, our dashboards rely on there being a cluster label
on our recording rules, yet our mixin does not include this? Also, we
are still including `cortex-gw` panels even when the mixin is compile
with `internal_components: false`.

**Special notes for your reviewer**:

The changes to the mixin will not be reflected in the current version of
the integration. We need to merge this PR first then update the
integration.

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

---------

Co-authored-by: Michel Hollands <42814411+MichelHollands@users.noreply.github.com>
Co-authored-by: J Stickler <julie.stickler@grafana.com>",68,58,1,1,"2018-04-16 10:25:39","1769.45"
"grafana/loki","ca43a6ba777e6ee88472e90c1cee00f0e66eb150","grafanabot","2023-09-14 19:52:00","true","[CI/CD] Update yaml file `./production/helm/loki/Chart.yaml` (+1 other) (#10592)

**Here is a summary of the updates contained in this PR:**
***
Update attribute `$.appVersion` in yaml file
`./production/helm/loki/Chart.yaml` to the following value: `2.9.1`
***
Bump version of Helm Chart
Add changelog entry to `./production/helm/loki/CHANGELOG.md`
Re-generate docs

Co-authored-by: Christian Haudum <christian.haudum@gmail.com>",42,65,1,0,"2018-04-16 10:25:39","1974.64"
"grafana/loki","2d8cf154ba93c1de0f74e6675719950bf090831a","jdbaldry","2020-12-07 09:22:08","true","doc: logql formatting fixes (#3039)

* doc: Remove extraneous backtick

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* doc: Fix backtick label quoting example

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>",124,32,0,0,"2018-04-16 10:25:39","961.46"
"grafana/loki","0d580e4501e7e46b46099849a1f88db05f6b7e4a","sandeepsukhani","2023-08-08 08:12:54","true","serialize empty head block as well while checkpointing to retain the head block format (#10182)

**What this PR does / why we need it**:
When the head block is empty, we do not serialize it while
checkpointing. This causes a mismatch in chunk and head block format
which ideally should be on the same version. The problem happens when we
rollback from v4 chunk and block format to v3 and the head is empty in
checkpoint which then [gets set to the default
version](https://github.com/grafana/loki/blob/ce91076dd4cb6016f1f39b7a5126c2fd88a8b18e/pkg/ingester/checkpoint.go#L106)
i.e v3 while the checkpointed chunk would be v4.

**Checklist**
- [x] Tests updated

---------

Co-authored-by: Salva Corts <salva.corts@grafana.com>",54,64,1,1,"2018-04-16 10:25:39","1938.16"
"grafana/loki","bf97aa0e31c0059a24152124c63ede09fb382d63","tomwilkie","2018-06-05 11:59:41","true","Merge pull request #12 from grafana/deploy

Continuously Deploy Logish",1,2,0,0,"2018-04-16 10:25:39","49.07"
"grafana/loki","d3111bcaa7749ca53902c45f4856e28e2980c79d","mar4uk","2022-11-21 08:19:17","true","Remove redundant replaces from go.mod (#7697)

**What this PR does / why we need it**:
Removed `replace`s that are not needed anymore.
The current version `github.com/thanos-io/thanos v0.28.0` doesn't
replace prometheus version anymore, that's why `replace`s in loki go.mod
are not needed either

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the `CONTRIBUTING.md` guide
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",94,55,1,0,"2018-04-16 10:25:39","1675.91"
"grafana/loki","61794710a720da135d8479b7c2f723c740e86404","sandeepsukhani","2022-09-12 13:43:30","true","tsdb: boltdb shipper backup store tsdb (#7130)

<!--  Thanks for sending a pull request!  Before submitting:

1. Read our CONTRIBUTING.md guide
2. Name your PR as `<Feature Area>: Describe your change`.
a. Do not end the title with punctuation. It will be added in the
changelog.
b. Start with an imperative verb. Example: Fix the latency between
System A and System B.
  c. Use sentence case, not title case.
d. Use a complete phrase or sentence. The PR title will appear in a
changelog, so help other people understand what your change will be.
3. Rebase your PR if it gets out of sync with main
-->

**What this PR does / why we need it**:
Since we are planning to start deploying `tsdb` to critical cells, we
want to have a disaster recovery without any data loss.
This PR adds support to `tsdb` store itself to configure
`boltdb-shipper` as a backup chunk writer.
When the flag is enabled, `tsdb` store would also index chunks in
`boltdb-shipper` index store with table names set to
`<configured-tsdb-table-prefix>`+`backup_`+`<table-number>`.

This is the simplest option that I can come up with without maintaining
a lot of code and we can simply drop the support before marking `tsdb`
as production ready.

The rollback/recovery plan would just be to change the schema config to
use `boltdb-shipper` as index store with
`<configured-tsdb-table-prefix>`+`backup_` as prefix like below:


**tsdb enabled:**
```
schema_config:
  configs:
    - from: 2022-01-01
      store: boltdb-shipper
      index:
        prefix: index_
    - from: 2022-09-10
      store: tsdb
      index:
        prefix: index_
```

**rollback:**
```
schema_config:
  configs:
    - from: 2022-01-01
      store: boltdb-shipper
      index:
        prefix: index_
    - from: 2022-09-10
      store: boltdb-shipper
      index:
        prefix: index_backup_
```

<!--
Note about CHANGELOG entries, if a change adds:
* an important feature
* fixes an issue present in a previous release, 
* causes a change in operation that would be useful for an operator of
Loki to know
then please add a CHANGELOG entry.

For documentation changes, build changes, simple fixes etc please skip
this step. We are attempting to curate a changelog of the most relevant
and important changes to be easier to ingest by end users of Loki.

Note about the upgrade guide, if this changes:
* default configuration values
* metric names or label names
* changes existing log lines such as the metrics.go query output line
* configuration parameters 
* anything to do with any API
* any other change that would require special attention or extra steps
to upgrade
Please document clearly what changed AND what needs to be done in the
upgrade guide.
-->
**Checklist**
- [x] Tests updated",85,53,1,1,"2018-04-16 10:25:39","1607.14"
"grafana/loki","8721e41c6c36910d60cdc2c1253bded0058fd493","kavirajk","2023-09-21 08:24:04","true","drone(docker-driver): Fetch tags before pushing image during release (#10664)

**What this PR does / why we need it**:
We realized, loki-docker-driver image was not being pushed after 2.8.2.
And looking into it's drone pipeline and comparing it with other steps,
docker-driver step is not fetching the tags,[ thus the final hash
calculated to push is some HEAD
branch.](https://github.com/grafana/loki/blob/main/tools/image-tag#L13-L14)

e.g: even if we have tag 2.9.1, it pushes only with latest HEAD commit
hash.

This PR fixes it.
![Screenshot 2023-09-21 at 08 14
09](https://github.com/grafana/loki/assets/3735252/31e4d031-d22f-4bed-8aa7-3e6136a6f10c)
![Screenshot 2023-09-21 at 08 14
24](https://github.com/grafana/loki/assets/3735252/1742b821-58a3-4ef5-96ae-80304126b8cb)
![Screenshot 2023-09-21 at 08 14
42](https://github.com/grafana/loki/assets/3735252/5e060eeb-e57a-4124-b29b-bc8ce73cc6d9)

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:
I would prefer this instead of
https://github.com/grafana/loki/pull/10663. Because that would make
fetching tags more repetitive in all the drone tasks (can also be
expensive in terms of running time if we put all together)

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)

---------

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",32,65,1,1,"2018-04-16 10:25:39","1981.17"
"grafana/loki","ceb09efdf8aab7ebddbdb285b6f5e7d8fac2c951","kavirajk","2022-11-01 08:50:46","true","fix(loki-canary): Send to Loki after updating `totalEntries`. (#7211)

**What this PR does / why we need it**:
Fixes: #7142 (take a look for more details about the problem there)

After trying few things to avoid this race and discussin it with Ed,
This small changes seems to be more accurate and seems to fix the issue.

This is unblocking rolling out new canary in our internal cells

Update: For some reason I thought the fix didn't fix the original issue
when I tested it with internal loki dev cell, almost a month ago. But
after testing it for more than 2hr on same cell. I realized it is
working fine (will leave it for a day like this just to confirm)

Verified following:
```
{.... container=""loki-canary""} |= ""websocket missing""
```
and noticed it's happening no longer after the fix.

Also verified the metrics
```
sum(increase(loki_canary_websocket_missing_entries_total{...}[$__range]))
```
It dropped to zero.


![Screenshot_2022-10-30_21-08-43](https://user-images.githubusercontent.com/3735252/198899443-e1f9ee08-3f6a-41f8-8817-0da64b423343.png)

![Screenshot_2022-10-30_21-08-29](https://user-images.githubusercontent.com/3735252/198899444-62f23a5e-b505-4b92-a717-cf8c5220e6ed.png)

Update 2: After running it for whole day, looks there was two log
entries missed on the websocket. My guess is since websocket is
long-live connection and something can interrupt the connection loosing
this message.


![Screenshot_2022-10-31_10-32-20](https://user-images.githubusercontent.com/3735252/198976826-261af2bd-291e-40d9-aee4-01fdc0122ed3.png)

I also quickly checked how often this happens on other bigger envs (say
ops) and looks like it's not that uncommon.


![Screenshot_2022-10-31_10-30-56](https://user-images.githubusercontent.com/3735252/198976486-2458e31f-cb0b-4389-a098-0a828d96f2c4.png)

**Which issue(s) this PR fixes**:
Fixes https://github.com/grafana/loki/issues/7142

**Special notes for your reviewer**:
Tested it on internal loki dev cells

**Checklist**
- [x] Reviewed the `CONTRIBUTING.md` guide
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",89,54,1,1,"2018-04-16 10:25:39","1655.93"
"grafana/loki","eb5643be2679283c59b73022efffa420b6fd100f","owen-d","2021-08-18 13:51:45","true","initiate grpc health check always (#4181)",132,40,0,1,"2018-04-16 10:25:39","1217.89"
"grafana/loki","56256bfd5b2369f206a06a571d4ae8d8497977ac","owen-d","2021-07-27 13:01:18","true","Unordered chunks (#4001)

* merge feature/unordered-replay

* interoperable head chunks

* memchunk block interop

* retain ordered memchunk optimizations when possible

* tests+bench for unordered chunk reads

* reorder on chunk close

* [wip] ingester stream unorderd

* unordered writes default in testware config, fixes OOO bug & removes unused lastChunkTimestamp var

* validity window is 1/2 of max age & fixes old transfer test

* more consistent headblock checking/creation

* more cohesive encoding tests

* unordered stream test with validity bounds

* compat - unordered

* reinstates memchunk defaults when rebounding & updates storage test compatibility

* lint

* reorder across blocks doesnt overflow

* respect chunk configs during rebounding when possible

* only sync checks on ordered writes",106,39,0,1,"2018-04-16 10:25:39","1196.86"
"grafana/loki","387d64298247cd7330b887cf6058a512515a56b8","xperimental","2022-07-12 16:42:48","true","operator: Set minimum TLS version to 1.2 to support FIPS (#6669)",71,51,0,1,"2018-04-16 10:25:39","1547.26"
"grafana/loki","bf4fa6613a2befc11d32096c76e26742608f6ac6","adityacs","2021-03-16 07:27:32","true","support max_message_length configuration for syslog parser (#3400)

* support max_message_length configuration for syslog parser

* address review comments",158,35,0,1,"2018-04-16 10:25:39","1060.38"
"grafana/loki","7cf05c5dfcde9983633883ab58bdd3bdd73c7263","slim-bean","2019-06-13 13:29:31","false","adding a list of received entries (acknowledged) to use for comparison against entries which were not expected so that we can report them as duplicates.",108,14,0,1,"2018-04-16 10:25:39","422.38"
"grafana/loki","8742599be165f700e56d5ceab799673d04b373e0","jeschkies","2023-10-31 10:42:18","true","Instrument querier inflight requests. (#11085)

**What this PR does / why we need it**:
#10858 removed the HTTP and gRPC server from the querier workers. That
means inflight requests are not instrumented anymore. This change adds a
middleware that does that.

This will add metrics such as 
```
# HELP cortex_inflight_requests Current number of inflight requests.
# TYPE cortex_inflight_requests gauge
cortex_inflight_requests{method=""gRPC"",route=""*logproto.IndexStatsRequest""} 0
cortex_inflight_requests{method=""gRPC"",route=""*queryrange.LabelRequest""} 0
cortex_inflight_requests{method=""gRPC"",route=""*queryrange.LokiRequest""} 0
cortex_inflight_requests{method=""gRPC"",route=""*queryrange.LokiSeriesRequest""} 0
```

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)
- [ ] If the change is deprecating or removing a configuration option,
update the `deprecated-config.yaml` and `deleted-config.yaml` files
respectively in the `tools/deprecated-config-checker` directory.
[Example
PR](https://github.com/grafana/loki/pull/10840/commits/0d4416a4b03739583349934b96f272fb4f685d15)",17,66,1,1,"2018-04-16 10:25:39","2021.26"
"grafana/loki","26f36d07f4bfbc1cc51bc6d4e44d9140fa7b4be1","ashwanthgoli","2023-07-04 06:37:47","true","ksonnet: refer to tsdb_shipper_shared_store only if using_tsdb_shipper is true (#9852)

**What this PR does / why we need it**:
https://github.com/grafana/loki/pull/9790 introduced a new config
`tsdb_shipper_shared_store`, but it's being referred to even if tsdb
index is not enabled. This fixes it by accessing the value only if
using_tsdb_shipper is set to true

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [X] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",60,63,1,0,"2018-04-16 10:25:39","1904.09"
"grafana/loki","220cbdd4f1725a0a1ac53711e1d2d478f32b4b0c","cstyan","2023-04-14 22:36:51","true","Revert ""Use centralized make-docs script from Writers' Toolkit (#9126)"" (#9146)

This reverts commit df1b34898bea812b197ca7404b29094f740df26c.


Sorry @jdbaldry but something in your PR made the helm-docs check fail,
and only fail in CI, I tried a few things to figure out what was
happening locally but the same make target always passed locally.

cc @trevorwhitney",81,60,1,1,"2018-04-16 10:25:39","1819.51"
"grafana/loki","431534f0a3b05127afe20a88af741096bc7a1cc5","saurabhsadhale","2023-01-12 16:38:24","true","operator: Fix docs minio storage uses bucketnames instead of bucketname (#8116)

Fixes a typo in the documentation for the operator docs. for a
successful installation using bucketname will fail. Configuring the
secret with the key bucketnames should work.",100,57,1,0,"2018-04-16 10:25:39","1727.26"
"grafana/loki","abf08e2411c752caca81beb94bd0e65c4b9bac50","periklis","2022-11-03 19:12:07","true","operator: Add support for built-in-cert-rotation for all internal lokistack encryption (#7064)",90,54,1,1,"2018-04-16 10:25:39","1658.37"
"grafana/loki","e725a21b1aa566e3e4537e411642a3da57051460","KMiller-Grafana","2022-06-08 18:29:43","true","Docs: Add changelog entry for configuration parameter name change (#6340)

* Docs: Add changelog entry for configuration parameter name change

* Update changelog message, per review request",72,50,0,0,"2018-04-16 10:25:39","1513.34"
"grafana/loki","ec809e665f079638566120c40c3bcf9406305d43","owen-d","2022-03-15 19:39:43","true","Tsdb/sharding-benchmarks (#5628)

* adds shard to tsdb/index pkg

* add sharded tsdb benchmark",303,47,0,1,"2018-04-16 10:25:39","1425.13"
"grafana/loki","45d5f28e67b156c84d412c36c2ffd2f082303dfe","kavirajk","2022-03-01 09:11:38","true","metrics: Add `user` label to `worker_inflight_queries` (#5485)

* metrics: Add `user` label to `loki_querier_worker_inflight_queries`

* Add also `querier` label to it.

* Remove `querier`",301,46,0,1,"2018-04-16 10:25:39","1410.7"
"grafana/loki","91d66014734b356944ed327a40e8703e2edc0d9f","Red-GV","2021-12-07 06:16:19","true","LOG-1894: Update Loki Operand to 2.4.1 (#106)",214,44,0,1,"2018-04-16 10:25:39","1326.58"
"grafana/loki","2d7930e6d8b042f22f4dedecc9433c88fac5f183","chaudum","2023-09-22 13:39:56","true","Revise documentation about Loki architecture (#10672)

Also split out legacy storage into separate page.

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",35,65,1,1,"2018-04-16 10:25:39","1982.38"
"grafana/loki","7a60efc100bd3f49bd34c89cb0c2418f419d3991","slim-bean","2020-07-30 16:58:46","true","Reduce querier parallelism to a more sane default value and add comments explaining how to set it. (#2452)

Remove the default setting for storage_backend which was very misleading for anyone not using the defaults.",129,27,0,1,"2018-04-16 10:25:39","834.77"
"grafana/loki","42e5bf1af8f56fdbdf261e877a464f4556f8e41b","slim-bean","2019-05-02 17:04:55","false","need to remove this return statement or positions will never be cleaned up",98,13,0,1,"2018-04-16 10:25:39","381.53"
"grafana/loki","3b69cf127d18b3ff1c06c54caaea439fc40fcd31","tomwilkie","2018-11-20 14:13:36","false","Don't repeat client config.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",5,7,0,0,"2018-04-16 10:25:39","214.16"
"grafana/loki","b29bc19d7cf20285231a98ae0ec15b1421e7daa6","Duologic","2020-08-20 13:11:55","true","fix(ksonnet): don't depend on specific k8s version (#2525)

* fix(ksonnet): don't depend on specific k8s version

* docs(tanka): remove k8s-alpha refs

* fix(ksonnet): backwards compatibility with ksonnet",118,28,0,0,"2018-04-16 10:25:39","854.62"
"grafana/loki","309592a8cf98d279e969aa3f92795fd7fc29436a","owen-d","2022-05-02 06:36:51","true","ignores reporting cancellations as errors in the usage-reporter module (#6058)",81,49,0,1,"2018-04-16 10:25:39","1476.84"
"grafana/loki","9c21460da5507cf6bb856d14947b79cebb7fdaa1","cyriltovena","2019-05-15 20:03:31","false","fix linter",100,13,0,1,"2018-04-16 10:25:39","394.65"
"grafana/loki","934a0b8dc6d1509b400edcdefffc8c217928c622","slim-bean","2020-03-05 20:24:19","true","loki: Allow setting a 'step' when querying logs. (#1773)

* Setting a step on log queries will result in similar behavior as metrics, only returning logs at multiples of the step

Signed-off-by: Edward Welch <edward.welch@grafana.com>

* clear up logic a little to make it easier to follow

Signed-off-by: Edward Welch <edward.welch@grafana.com>

* try to protect future us from future us

Signed-off-by: Edward Welch <edward.welch@grafana.com>",114,22,0,1,"2018-04-16 10:25:39","684.67"
"grafana/loki","e050d5c494a6fcf761dd1d23f98e9b4070657750","darxriggs","2023-04-14 13:52:55","true","Docs: Update Loki GitHub URLs (#9080)

* use `main` instead of `master` branch
* fix outdated URLs",80,60,1,0,"2018-04-16 10:25:39","1819.14"
"grafana/loki","1c7df620c4634dbf797d87d3d9965255545e1a98","garrettlish","2021-11-02 10:49:36","true","add date time sprig template functions in logql label/line formatter (#4603)

* add date time sprig template functions in logql label/line formatter

With date time sprig template functions, we will be able to filter test jobs which create time is 1 day before as the following:
```
{job=""test""} | label_format nowEpoch=`{{(unixEpoch now)}}`,createDateEpoch=`{{unixEpoch (toDate ""2006-01-02"" .createDate)}}` | label_format dateTimeDiff=""{{sub .nowEpoch .createDateEpoch}}"" | dateTimeDiff > 86400
```

* add documents for date time sprig template functions

* resolve comments

* add golang datetime layout doc reference
* update CHANGELOG.md accordingly to include this PR",169,42,0,0,"2018-04-16 10:25:39","1291.77"
"grafana/loki","51bdd152374a2c2c9414181c118cc82f3dec6c1d","slim-bean","2019-05-31 20:58:10","false","renaming `metric` stage to `metrics` as it defines multiple metrics, similar to labels stage which is also plural.
Adding a couple unit tests to regex and json stage to act as examples",109,13,0,1,"2018-04-16 10:25:39","410.69"
"grafana/loki","1ce00ea6811ff86972ec1e295808ebbea4f8c260","JoaoBraveCoding","2023-09-29 15:39:03","true","operator: Change default replication factor of 1x.medium to 2 (#10720)",30,65,1,0,"2018-04-16 10:25:39","1989.47"
"grafana/loki","a8c71d27a82924f4d19ccc53bfe3405bccbe3813","MiggL","2022-11-22 18:19:26","true","[helm] Fix read-only /tmp in single-binary mode (#7695)

**What this PR does / why we need it**:
When running in single-binary mode, these warnings may appear:
`level=warn ts=2022-11-15T08:01:39.777179378Z caller=marker.go:214
msg=""failed to process marks""
path=/var/loki/compactor/retention/markers/1668476560013344947 err=""open
/tmp/marker-view-912253853: read-only file system""`

This was previously fixed in the old chart: grafana/helm-charts#967

**Which issue(s) this PR fixes**:
Fixes grafana/helm-charts#609, again.

**Checklist**
- [x] Reviewed the `CONTRIBUTING.md` guide",94,55,1,0,"2018-04-16 10:25:39","1677.33"
"grafana/loki","c170364c2fa2135c27f002ff157afd4620805fd7","ssncferreira","2022-07-12 16:56:33","true","Add README file to loki-mixin (#6083)

* Add README file to loki-mixin

* Apply suggestions from code review

Co-authored-by: Kaviraj Kanagaraj <kavirajkanagaraj@gmail.com>

* Address comments

* Add JSONNET_PATH variable

Co-authored-by: Kaviraj Kanagaraj <kavirajkanagaraj@gmail.com>",71,51,0,0,"2018-04-16 10:25:39","1547.27"
"grafana/loki","1e2079eb5fdd93b3294c7cacca4b37ec02e47def","thepalbi","2022-11-02 19:40:29","true","Fix Hugo build for docs (#7580)",90,54,1,0,"2018-04-16 10:25:39","1657.39"
"grafana/loki","811172b7a60f70fcc55c0dba11beb4a4fe7f6631","blockloop","2021-03-19 21:15:09","true","add README.md",169,35,0,0,"2018-04-16 10:25:39","1063.95"
"grafana/loki","bc18d8f138c998cc3ecfb0467f372de1e1700625","Red-GV","2022-10-14 06:02:16","true","operator: Update golang and dependencies (#7418)",94,54,1,1,"2018-04-16 10:25:39","1638.82"
"grafana/loki","3642face571cabd775fd9c27acf6b10f97d71c07","dannykopping","2021-06-07 07:32:04","true","Allowing for multiple defined targets (#3807)

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",201,38,0,1,"2018-04-16 10:25:39","1146.63"
"grafana/loki","6f7ae89b2145d16a289eea2fa3aab7e635d57437","paul1r","2023-10-16 20:15:53","true","Bloom library performance updates (#10920)

**What this PR does / why we need it**:
added benchmarking and tests for tokenizers
Streamlined code for overall performance gains, notably in the Tokenizer
library, reusing a buffer of Token objects

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",23,66,1,0,"2018-04-16 10:25:39","2006.66"
"grafana/loki","6928aac776ff6612464908c9c7d452966d70773a","bboreham","2023-06-23 20:48:55","true","loser tree: allow sequences to contain maxVal (#9057)

**What this PR does / why we need it**:

The tree stores the loser in each node, or maxVal if the sequence has
ended. If sequences can contain maxVal, we need to take care not to let
an ended sequence overtake an active one.

Some test cases from Charles who pointed out the issue in #9053.

Note this situation cannot happen for real in Loki, since we don't
expect log lines with a timestamp that far into the future,
but this is supposed to be a re-usable library.

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- NA Documentation added
- [x] Tests updated
- NA `CHANGELOG.md` updated
- NA Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

Co-authored-by: Charles Korn <charles.korn@grafana.com>",60,62,1,0,"2018-04-16 10:25:39","1893.68"
"grafana/loki","95b885691d4ea1d94aa2f9ea1d426bc90b3b4759","chaudum","2022-03-17 12:27:12","true","Preserve interval parameter when splitting queries by time (#5622)

* Preserve interval parameter when splitting queries by time

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* Add tests for interval param on Loki downstream requests

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* Add changelog entry for #5622

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",308,47,0,1,"2018-04-16 10:25:39","1426.83"
"grafana/loki","769979c9f667c47025a32b69499dea10882022e7","chaudum","2023-09-18 09:58:15","true","chore(storage): Refactor store factory (#10518)

**What this PR does / why we need it**:

This PR makes a clearer distinction between supported and deprecated index/chunk storage types.

There are individual commits for the different factory functions:

* Refactor table client factory
* Refactor index client factory
* Refactor chunk client factory
* Split initStore function

---------

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",39,65,1,1,"2018-04-16 10:25:39","1978.23"
"grafana/loki","9f0834793b24d9324a6948c11dba2147f6541d09","slim-bean","2023-02-09 21:16:50","true","Loki: set a maximum number of shards for ""limited"" queries instead of fixed number (#8487)

Signed-off-by: Edward Welch <edward.welch@grafana.com>",79,58,1,1,"2018-04-16 10:25:39","1754.45"
"grafana/loki","fe53924ff8ce46ed85d8b815d7e0da4ae4e9e3a9","slim-bean","2019-05-05 11:18:19","false","using the timestamp from the log file might lead to undesired behavior as it could be way in the past or future depending on the clock for the source system generating the logs.  Given that it's compared to the servers time.Now() when looking for idle chunks it's probably best to use the server time when setting the value. (#546)",98,13,0,1,"2018-04-16 10:25:39","384.29"
"grafana/loki","494259379cf7d6921f329e866fff99a30c519f57","slim-bean","2020-04-02 21:21:50","true","docs: cleaning up the comments for the cache_config, default_validity option (#1888)

* cleaning up the comments for the config

Signed-off-by: Edward Welch <edward.welch@grafana.com>",118,23,0,1,"2018-04-16 10:25:39","711.71"
"grafana/loki","4fc51ccdd793171a05521f45e76ea772f1d4a4dd","jeschkies","2023-04-04 19:10:58","true","Remove unnecessary build image step. (#9019)

**What this PR does / why we need it**:
> Repeat step 1.3, which will use the new image

is the same as calling `make drone`. So it is not required.

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",81,59,1,1,"2018-04-16 10:25:39","1809.36"
"grafana/loki","11e215d79f508c44ad5b7ce08f82aed4fbd5f3a9","slim-bean","2021-10-01 18:13:44","true","Loki: Common Config (#4347)

* refactor the pkg/util/cfg package to simplify and make it accessable outside of this package.
create a pkg/cfg which handles building the Loki config, this is created separately from pkg/util (which is Apache 2 licensed) to maintain proper separations of AGPL and Apache 2 code
Update the main.go for several of the apps with the refactoring

* refactor how dynamic/common config is loaded

Signed-off-by: Trevor Whitney <trevorjwhitney@gmail.com>

* Add common config logic for path prefix

Signed-off-by: Trevor Whitney <trevorjwhitney@gmail.com>

* Missed a file, update common config with prefix property

Signed-off-by: Trevor Whitney <trevorjwhitney@gmail.com>

* fix test, remove loki from args

Signed-off-by: Trevor Whitney <trevorjwhitney@gmail.com>

* Clean up test names

Signed-off-by: Trevor Whitney <trevorjwhitney@gmail.com>

* fix typo in filename, make linter happy

Signed-off-by: Trevor Whitney <trevorjwhitney@gmail.com>

* Update pkg/loki/config_wrapper.go

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>

* Update pkg/loki/config_wrapper.go

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>

* Update pkg/loki/config_wrapper_test.go

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>

* remove temp files in test

Signed-off-by: Trevor Whitney <trevorjwhitney@gmail.com>

Co-authored-by: Trevor Whitney <trevorjwhitney@gmail.com>
Co-authored-by: Owen Diehl <ow.diehl@gmail.com>",138,41,0,1,"2018-04-16 10:25:39","1261.08"
"grafana/loki","3dfe89369fce129c57d75dc0656f9e7082ba5d05","slim-bean","2020-04-30 19:43:21","true","Loki: refactor validation and improve error messages (#2021)

* copies some of the validation logic from cortex and modifies it to appropriate for Loki, this gives us a single metric we can use for detetecting validation errors (previously we had to check cortex_ and loki_ metrics) as well as lets us use error messages more appropriate for logs than metrics.

Signed-off-by: Ed Welch <edward.welch@grafana.com>

* fixing tests and lint

Signed-off-by: Ed Welch <edward.welch@grafana.com>

* updating cause to string type

Signed-off-by: Ed Welch <edward.welch@grafana.com>

* extracting a function for rate limited

Signed-off-by: Ed Welch <edward.welch@grafana.com>

* extracting functions for the rest of the error strings

Signed-off-by: Ed Welch <edward.welch@grafana.com>",120,24,0,1,"2018-04-16 10:25:39","744.89"
"grafana/loki","eadb9d2c007040dd70233c644f61ae23ca464058","slim-bean","2023-03-10 16:16:23","true","Loki: Change the behavior of the 0 value for retention_period to disable retention. (#8753)

**What this PR does / why we need it**:

Issue #8359 exposed a very unfortunate inconsistency in a Loki config
where the zero value did not disable a feature.

By convention in Loki the zero value for a config typically ""disables""
it.

This PR changes the retention_period to honor the zero value of `0` or
`0s` to disable retention.

**Which issue(s) this PR fixes**:
Fixes #8359

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [x] Tests updated
- [x] `CHANGELOG.md` updated
- [x] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

---------

Signed-off-by: Edward Welch <edward.welch@grafana.com>
Co-authored-by: J Stickler <julie.stickler@grafana.com>",88,59,1,1,"2018-04-16 10:25:39","1785.24"
"grafana/loki","0107a117691f936459032a52eb035d2f235dbce9","cyriltovena","2021-04-06 00:17:48","true","Fixes a race when using specific tenant and multi-client. (#3573)

* Fixes a race when using specific tenant and multi-client.

This was because each client would try to mutate the original set of labels.
Instead of cloning the map which can be expensive, I created a little helper that generate the string
from the labelset without a set of label name.

Fixes #3571

I also added a test to see if this was reproducible and it was indeed:

```
~/go/src/github.com/grafana/loki master*
❯ go test -timeout 30s -tags dev,gofuzz -race -run ^TestMultiClient_Handle_Race$ github.com/grafana/loki/pkg/promtail/client -v -count=1 -timeout=0s
=== RUN   TestMultiClient_Handle_Race
==================
WARNING: DATA RACE
Read at 0x00c0000b77d0 by goroutine 22:
  runtime.mapaccess2_faststr()
      /usr/local/Cellar/go/1.16.2/libexec/src/runtime/map_faststr.go:107 +0x0
  github.com/grafana/loki/pkg/promtail/client.(*client).getTenantID()
      /Users/ctovena/go/src/github.com/grafana/loki/pkg/promtail/client/client.go:376 +0xcb
  github.com/grafana/loki/pkg/promtail/client.(*client).processEntry()
      /Users/ctovena/go/src/github.com/grafana/loki/pkg/promtail/client/client.go:407 +0x9a
  github.com/grafana/loki/pkg/promtail/client.(*client).run()
      /Users/ctovena/go/src/github.com/grafana/loki/pkg/promtail/client/client.go:235 +0x36a

Previous write at 0x00c0000b77d0 by goroutine 21:
  runtime.mapdelete_faststr()
      /usr/local/Cellar/go/1.16.2/libexec/src/runtime/map_faststr.go:297 +0x0
  github.com/grafana/loki/pkg/promtail/client.(*client).processEntry()
      /Users/ctovena/go/src/github.com/grafana/loki/pkg/promtail/client/client.go:408 +0x144
  github.com/grafana/loki/pkg/promtail/client.(*client).run()
      /Users/ctovena/go/src/github.com/grafana/loki/pkg/promtail/client/client.go:235 +0x36a

Goroutine 22 (running) created at:
  github.com/grafana/loki/pkg/promtail/client.New()
      /Users/ctovena/go/src/github.com/grafana/loki/pkg/promtail/client/client.go:198 +0x7dc
  github.com/grafana/loki/pkg/promtail/client.TestMultiClient_Handle_Race()
      /Users/ctovena/go/src/github.com/grafana/loki/pkg/promtail/client/multi_test.go:126 +0x2c7
  testing.tRunner()
      /usr/local/Cellar/go/1.16.2/libexec/src/testing/testing.go:1194 +0x202

Goroutine 21 (running) created at:
  github.com/grafana/loki/pkg/promtail/client.New()
      /Users/ctovena/go/src/github.com/grafana/loki/pkg/promtail/client/client.go:198 +0x7dc
  github.com/grafana/loki/pkg/promtail/client.TestMultiClient_Handle_Race()
      /Users/ctovena/go/src/github.com/grafana/loki/pkg/promtail/client/multi_test.go:124 +0x187
  testing.tRunner()
      /usr/local/Cellar/go/1.16.2/libexec/src/testing/testing.go:1194 +0x202
==================
    testing.go:1093: race detected during execution of test
--- FAIL: TestMultiClient_Handle_Race (0.00s)
=== CONT
    testing.go:1093: race detected during execution of test
FAIL
FAIL	github.com/grafana/loki/pkg/promtail/client	0.022s
FAIL
```

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* don't overload variable name

Co-authored-by: Edward Welch <edward.welch@grafana.com>",147,35,0,1,"2018-04-16 10:25:39","1080.08"
"grafana/loki","35ebe967ea360464567b7d18ccc28c69aa1cd88e","KMiller-Grafana","2021-11-17 18:58:08","true","Docs: fix broken links (#4770)

* Docs: fix broken links

* Docs: fix another link name",202,43,0,0,"2018-04-16 10:25:39","1307.11"
"grafana/loki","f2394355d81f33d7a5cec6490cc4523619e596e8","CCOLLOT","2023-06-09 13:00:31","true","feat(lambda-promtail): add cloudfront log file ingestion support (#9573)

**What this PR does / why we need it**:

This PR enables ingesting logs from Cloudfront log files stored in s3
(batch).
The current setup only supports streaming Cloudfront logs through AWS
Kinesis, whereas this PR implements the same flow as for VPC Flow logs,
Load Balancer logs, and Cloudtrail logs (s3 --> SQS (optional) -->
Lambda Promtail --> Loki)

**Special notes for your reviewer**:
+ The Cloudfront log file format is different from the already
implemented services, meaning we had to build yet another regex. AWS
never bothered making all services follow the same log file naming
convention but the ""good"" thing is that it's now very unlikely they will
change it in the future.
+ The Cloudfront file name does not have any mention of the AWS account
or the time of log it contains, it means we have to infer the log type
from the filename format instead of finding the exact string
""cloudfront"" in the filename. This is why in `getLabels`, if no `type`
parameter is found in the regex, we use the key corresponding to the
name of the matching parser.
+ I introduced a new `parser` struct to group together several
parameters specific to a type of log (and avoid relying too much on map
key string matching and / or if statements for specific use cases)
+ I've been successfully running this code in several AWS environments
for days.
+ I corrected a typo from my previous PR #9497 (wrong PR number in
Changelog.md)
**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [x] Tests updated
- [x] `CHANGELOG.md` updated
- [x] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [x] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

---------

Co-authored-by: Michel Hollands <42814411+MichelHollands@users.noreply.github.com>",67,62,1,0,"2018-04-16 10:25:39","1879.36"
"grafana/loki","f7bc8d39c064ab2a38b0609b7dddd637ea9e3179","JStickler","2023-09-13 15:33:01","true","[Docs] Add upgrade link to Manage page. (#10566)

The new information architecture moved the Upgrade docs under ""Setup.""  

Based on feedback received via Slack, adding a link to the Upgrade docs
to the Manage/Operations landing page to help users find the Upgrade
docs.

**Special notes for your reviewer:**
Note that because how the page is structured (the list is a Hugo
""section"") this is a bit of a workaround. The link to the Upgrade docs
is at the bottom, not in alphabetical order.",39,65,1,0,"2018-04-16 10:25:39","1973.46"
"grafana/loki","39be4b5e6b72572c7b1b152e584d80a787213d52","trevorwhitney","2023-07-27 17:02:59","true","Only aggregate labels or series based on requested (#10076)

This improves the logic when calculating volumes by only aggregating
series or labels based on which was requested. Previously we aggregated
both, and then picked the correct set for the response, causing
unnecessary additional memory consumption.",50,63,1,1,"2018-04-16 10:25:39","1927.53"
"grafana/loki","23a189990cf0a09a46e8616e65d0bc28039a21a3","slim-bean","2023-07-26 00:48:14","true","Loki: Tweak how we handle X-Query-Tags header (#10058)

**What this PR does / why we need it**:

Adjust the regex for X-Query-Tags to allow @ and . so that email
addresses can be displayed properly.
Also changed the ToLower to only apply to the key not the value


**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

Signed-off-by: Edward Welch <edward.welch@grafana.com>",53,63,1,1,"2018-04-16 10:25:39","1925.85"
"grafana/loki","c0d9a2b4bad71d42fdbd2eeacab0a6e928a64f9f","DylanGuedes","2023-06-19 16:16:53","true","Log push failures per-entry instead of in batches  (#9720)

**What this PR does / why we need it**:
Modify how we log push errors to do it per-entry instead of accumulating
all errors and then logging them all in a single pass.

**Which issue(s) this PR fixes**:
N/A",59,62,1,1,"2018-04-16 10:25:39","1889.49"
"grafana/loki","8ee9a2c3c7aaf8d2823737989b092a60ea0fb3f3","JStickler","2023-05-10 14:16:41","true","TOC Sync: Move API docs under Reference. (#9203)

**Which issue(s) this PR fixes**:
Fixes #8719

**Special notes for your reviewer**:
Part of the Database products table of contents alignment project.
Moves API doc under Reference heading in TOC.
Updates front matter for the topic.
Fixes links broken by the move.
Adds aliases for redirects.",80,61,1,0,"2018-04-16 10:25:39","1850.41"
"grafana/loki","673bfd603bbfaf551c384b43acc2dd0a8c14fcae","JStickler","2023-03-07 13:19:02","true","Fixing broken link (404) (#8688)

This was reported to the docs team via Slack. Fixing broken link from Promtail Scraping file to Promtail Configuration file.",83,59,1,0,"2018-04-16 10:25:39","1782.12"
"grafana/loki","68a4d3271a006f0b057000ebf5dad0115d4ae26f","ssncferreira","2022-12-14 12:20:57","true","Fix documentation typos from #7916 (#7934)

**What this PR does / why we need it**:

Fix documentation typos from
https://github.com/grafana/loki/pull/7916#pullrequestreview-1217192817

**Which issue(s) this PR fixes**:
Fixes
https://github.com/grafana/loki/pull/7916#pullrequestreview-1217192817

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the `CONTRIBUTING.md` guide
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",101,56,1,0,"2018-04-16 10:25:39","1699.08"
"grafana/loki","1765d7fe4b294b4cadc2fdc36ea83d9002f1a111","sandeepsukhani","2020-09-17 11:20:06","true","jsonnet for running loki using boltdb-shipper (#2547)",121,29,0,1,"2018-04-16 10:25:39","881.54"
"grafana/loki","5f665651d52e60a817b05f9c98f7d673c22d7a89","thepalbi","2022-10-18 13:32:23","true","Promtail: Add basic tracing support (#7414)

We've been using Promtail's HTTP/gRPC server-based targets with real
workloads for some weeks now. The server that these spin out is based on
[weaveworks commons](https://github.com/weaveworks/common) HTTP/gRPC
servers. These include by default some middlewares that if enabled,
inject tracing support.

We found this useful when tracking down request handling time, or even
more, if the caller also support Jaeger tracing support,
cross-correlated requests between the upstream server and Promtail's.

This PR adds support for enabling tracing the same way Loki does. At the
moment, this will just generate traces for the before-mentioned targets.

In the future, the quality and completeness of tracing support can grow
organically to enrich spans.",89,54,1,0,"2018-04-16 10:25:39","1643.13"
"grafana/loki","7b671348a9be3c9eb610f9abb588e5723d3d057c","JStickler","2023-07-24 21:19:27","true","Delete incomplete comment. (#10046)

**Which issue(s) this PR fixes**:
Fixes #9960

Deletes incomplete comment in code that was introduced from Prometheus
as part of
https://github.com/grafana/loki/commit/fb26baa5b1bd58b33a34e9c946c81b253d7610bc",54,63,1,0,"2018-04-16 10:25:39","1924.7"
"grafana/loki","0c5900e407b1b943a3a1004c434c0f29a6611a9d","salvacorts","2022-03-18 14:31:43","true","Fix debug image by updating Delve version (#5673)",307,47,0,1,"2018-04-16 10:25:39","1427.92"
"grafana/loki","413ffab235f1da02f1f609b675b5472b4cab378a","slim-bean","2021-11-08 13:28:23","true","update everything for 2.4.1 (#4701)",182,43,0,1,"2018-04-16 10:25:39","1297.88"
"grafana/loki","723f524e3be23e73292c995d57e7452c73e292fd","dimitarvdimitrov","2023-01-16 10:28:09","true","Fix link to CONTRIUTING.md in PR template (#8156)

The previous link lead to
https://github.com/grafana/loki/CONTRIBUTING.md which doesn't exist.",95,57,1,0,"2018-04-16 10:25:39","1731"
"grafana/loki","d42de7ee2b57cec84be774030a29718773d0ece7","owen-d","2021-08-20 21:34:38","true","fixes typo (#4199)",133,40,0,1,"2018-04-16 10:25:39","1220.21"
"grafana/loki","c0ba42ed3413fd18d2b69f74a68fa28fcfa26b64","Red-GV","2021-05-07 19:34:36","true","Log 1318: Adding scorecard ci test (#46)",186,37,0,1,"2018-04-16 10:25:39","1117.13"
"grafana/loki","a8a143b578d811664b50abefb18649cb229a300e","slim-bean","2019-12-04 18:35:20","false","Updating version numbers for 1.1.0 release",91,20,0,1,"2018-04-16 10:25:39","593.59"
"grafana/loki","00ca1aa99f50e67f15f06eff4a84cb9becacf151","sandeepsukhani","2022-02-22 17:06:26","true","do not send grpc responses concurrently from index-gateway (#5445)

See https://github.com/grpc/grpc-go/blob/master/stream.go#L120-L123",297,46,0,1,"2018-04-16 10:25:39","1402.03"
"grafana/loki","61e3e52d4f655132bbad1b834f5aa20da1fd86a8","MichelHollands","2022-06-23 08:42:38","true","Handle duplicate registration of deletion metrics (#6446)

* Handle duplicate registration of deletion metrics

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Create metrics struct at Loki level

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Fix test

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",69,50,0,1,"2018-04-16 10:25:39","1527.93"
"grafana/loki","c271f7923a31de403c6fb7c12912a7de5987bdbf","MichelHollands","2022-09-07 14:52:49","true","Fix setting name in documentation (#7086)

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

**What this PR does / why we need it**:

The delete_max_interval was previously named delete_max_query_range.
This rename was not done in the documentation,

**Checklist**
- [X] Documentation added
- [ ] Tests updated
- [ ] Is this an important fix or new feature? Add an entry in the
`CHANGELOG.md`.
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",85,53,1,1,"2018-04-16 10:25:39","1602.19"
"grafana/loki","05b45259e85a64bf609b76af4a1e5c28ce373ee6","StevenReitsma","2020-07-17 13:54:42","true","Add projected and downwardAPI volume types to PodSecurityPolicy (#2355) (#2366)",122,27,0,0,"2018-04-16 10:25:39","821.65"
"grafana/loki","7b834c5ce169f642624819b748a71dd8c9919027","rfratto","2019-12-09 20:36:44","true","Update release instructions and release script (#1391)

* fix tools/release_prepare.sh so sed works on Linux

* docs: expand release instructions

* docs: add line describing releasing instructions",92,20,0,1,"2018-04-16 10:25:39","598.67"
"grafana/loki","a2e2272653d78576cafbc8168c3249970ac2cbe5","slim-bean","2019-09-05 21:57:17","false","use a global variable to wrap debug log statments in the pipeline to prevent unnecessary allocations when debug logging is not enabled",118,17,0,1,"2018-04-16 10:25:39","504.73"
"grafana/loki","08b3b459899c67b6c865bcde452a22c62704ce7e","slim-bean","2020-04-01 13:22:39","true","docs: update promtail docs for backoff (#1879)

Signed-off-by: Edward Welch <edward.welch@grafana.com>",121,23,0,1,"2018-04-16 10:25:39","710.37"
"grafana/loki","022488180c3ef8ee1bb0befb78db6272f1cff31a","slim-bean","2020-12-24 15:06:20","true","updating jsonnet for Loki 2.1.0 (#3101)",124,32,0,1,"2018-04-16 10:25:39","978.69"
"grafana/loki","b8a61357bb9da631b417db616d701c21de88dfc8","slim-bean","2020-08-10 20:02:15","true","Loki: fix batch iterator error when all chunks overlap and chunk time ranges are greater than query time range (#2484)

* Fixes a bug where if all chunks are fetched before finding a non-overlapping chunk, and the chunk from/through times are outside of the query request times, we would incorrectly set the iterator from/to bounds leading to missing logs in the query.

* uncomment `includesOverlap` which was commented during testing and not fixed by mistake.",120,28,0,1,"2018-04-16 10:25:39","844.9"
"grafana/loki","71889dcb19a7c7ff46f936cbdabe85d1d66b05b4","dannykopping","2021-07-01 11:44:55","true","Querier/Ingester: Fixing json expression parser bug (#3928)

* Fixing json expression parser bug

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* UNRELATED CHANGE: pulling main to fix linter issue

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",116,38,0,1,"2018-04-16 10:25:39","1170.81"
"grafana/loki","1249e92ef315e88c6384dd7120ec05a233e5ce9f","slim-bean","2019-07-10 01:25:45","false","use strconf.FormatFloat instead of fmt.Sprintf for converting floats to strings, this way we can eliminate non significant trailing zeros such that the float value 1 would be ""1"" as a string instead of ""1.000000""",100,15,0,1,"2018-04-16 10:25:39","448.88"
"grafana/loki","5939d5e9d8639b1d1898e8fa70ecb473a3ab22f7","MasslessParticle","2022-04-18 15:01:45","true","Query filtering in the ingester and storage (#5629)

* Add timestamp to pipeline and extractor interfaces

* implement filter extractor and pipeline

* implement storage filtering

* implement ingester filtering

* test cleanup

* Refactor pipeline setup to util

* linter

* enable filtering based on mode

* review feedback

* review comments

* review feedback

* no need to include label filters in the test pipeline

* review feedpack",322,48,0,1,"2018-04-16 10:25:39","1463.19"
"grafana/loki","1b0e3f82cae6ed6f9f597e47e5a39c6d4d99d99b","dannykopping","2021-10-08 09:55:24","true","Adding ""logs"" into regex since enterprise-logs might be in use (#4438)

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",138,42,0,1,"2018-04-16 10:25:39","1267.73"
"grafana/loki","64999ffdf96000f7d5406dd4818ffdbf8c5626bc","DylanGuedes","2021-12-14 08:03:58","true","Skip middleware for unsupported type (#4924)

* Skip computing statistics for unsupported types.

* Add tests for skipping statistics middleware.

* Add missing CHANGELOG entry.

* Implement wrapper for labelNames request and don't skip it.

* Remove infinite-loop implementation for unsupported funcs.

Co-authored-by: Cyril Tovena <cyril.tovena@gmail.com>",230,44,0,1,"2018-04-16 10:25:39","1333.65"
"grafana/loki","d0545bff2d1ffdb370cf55440889d639d276a7fa","JStickler","2023-08-17 14:10:35","true","[docs] Create top level Send data section, part 2 (#10247)

Part of the database information architecture Epic # 8710

Which issue(s) this PR fixes:
Second half of work for issue # 8741 that was started in PR #10192 
When closed, fixes #8741

Move the following files under Send data:
./sources/clients/promtail/_index.md
./sources/clients/promtail/configuration.md
./sources/clients/promtail/gcplog-cloud.md
./sources/clients/promtail/installation.md
./sources/clients/promtail/logrotation/_index.md
./sources/clients/promtail/pipelines.md
./sources/clients/promtail/scraping.md
./sources/clients/promtail/stages/_index.md
./sources/clients/promtail/stages/cri.md
./sources/clients/promtail/stages/decolorize.md
./sources/clients/promtail/stages/docker.md
./sources/clients/promtail/stages/drop.md
./sources/clients/promtail/stages/json.md
./sources/clients/promtail/stages/labelallow.md
./sources/clients/promtail/stages/labeldrop.md
./sources/clients/promtail/stages/labels.md
./sources/clients/promtail/stages/limit.md
./sources/clients/promtail/stages/logfmt.md
./sources/clients/promtail/stages/match.md
./sources/clients/promtail/stages/metrics.md
./sources/clients/promtail/stages/multiline.md
./sources/clients/promtail/stages/output.md
./sources/clients/promtail/stages/pack.md
./sources/clients/promtail/stages/regex.md
./sources/clients/promtail/stages/replace.md
./sources/clients/promtail/stages/static_labels.md
./sources/clients/promtail/stages/template.md
./sources/clients/promtail/stages/tenant.md
./sources/clients/promtail/stages/timestamp.md
./sources/clients/promtail/troubleshooting/_index.md

This PR also 

- Revises the Clients landing page to clarify supported clients.
- Updates the metadata (descriptions, weights)
- Adds aliases to redirect from the old URLs.
- Updates cross-references broken by the move/renaming.
- A few other small fixes (headings, typos, etc.)


**Special notes for your reviewer**:

Please review the updates to the Clients landing page (now called Send
Data) as I've made some extensive edits to try to clarify
recommended/supported clients.
The file is docs/sources/send-data/_index.md

---------

Co-authored-by: Michel Hollands <42814411+MichelHollands@users.noreply.github.com>",52,64,1,0,"2018-04-16 10:25:39","1947.41"
"grafana/loki","bbfb13c3e4ddec80eee70bef042a55d8b9d12c3e","kavirajk","2023-08-24 07:52:50","true","Pin `chunk` and `index` format to `schema` version. (#10213)

We pin all three `Chunk`, `HeadBlock` and `TSDB` Version to `schema`
version in period config.


This is the following mapping (after being discussed with @owen-d and
@sandeepsukhani )

`v12` (current existing schema) - ChunkFormatV3 (UnorderedHeadBlock) +
TSDBv2
`v13` (introducing new schema) - ChunkFormatV4
(UnorderedWithNonIndexedLabelsHeadBlockFmt) + TSDBv3

Note the new schema `v13` supports the latest chunk and index format.

**NOTES for Reviewer**

1. General approach is we removed the idea of `index.LiveFormat`,
`chunkenc.DefaultChunkFormat` and `chunkenc.DefaultHeadBlockFmt` and
made following two changes. These variables were used before to tie
chunk and tsdb formats specific to Loki versions. This PR remove that
coupling and pin these formats to `schema` version instead.

1. These variables were replaced with explicit chunk and index formats
within those packages (and it's tests)
2. If these variables were used outside it's own packages say by
ingester, compactor, etc. Then we extract correct chunk and index
versions from the `schema` config.

2. Add two methods to `periodConfig`. (1) `ChunkFormat()` returning
chunk and head format tied to schema (2) `TSDBFormat()` returning tsdb
format tied to schema.

2. Other ideas I thought of doing but didn't end up doing is make
`ChunkFormat` and `IndexFormat` as separate type (rather than `byte` and
`int` currently. Similar to `HeadBlockFmt` type). But didnt' do it
eventually to keep the PR small and don't want to complicate with lots
of changes.

4. Moved couple of test cases from `chunkenc` to `config` package,
because the test case was actually testing methods on `schemaconfig` and
it was creating cycling dependencies.

---------

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",50,64,1,1,"2018-04-16 10:25:39","1954.14"
"grafana/loki","77c10da81d54e22013dc5d0b7ed2cc2ab611dfe1","MichelHollands","2022-09-28 12:29:41","true","Remove deletion filter debug log messages (#7277)

These debug messages are a slightly misleading and appear too frequent.

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",90,53,1,1,"2018-04-16 10:25:39","1623.09"
"grafana/loki","cf5f69022f3a208389f0c1331d716f495c276b5c","owen-d","2021-10-08 18:59:09","true","Revert ""loki-mixin: use centralized configuration for dashboard matchers / selectors (#4279)"" (#4441)

This reverts commit 1a4be0923ea9d36ca37bb4b3aa896503d8944208.",139,42,0,1,"2018-04-16 10:25:39","1268.11"
"grafana/loki","576e479090f548bf4931ddda8da6b4a29686c543","rfratto","2020-01-29 13:11:57","true","docs: clarify rules around escaping backslashes in YAML (#1601)

YAML treats backslashes in double-quoted strings differently than
backslashes in non-double-quoted strings. This commit clarifies the
behavior for the regex stage.

Closes #1597",106,21,0,1,"2018-04-16 10:25:39","648.37"
"grafana/loki","693f9d7070e21c6b4d30738523b534e853b847c0","kavirajk","2022-08-12 15:53:15","true","fix(stats_collector): Do not collect stats for failed requests. (#6878)

* fix(stats_collector): Do not collect stats for failed requests.

When any type of query fails, do not collect statistics.
Rationale being when core http handler returns error, it's reponse will be nil and there won't be any statistics
to collect and log.

Fixes: 6231

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* fix comment

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",84,52,0,1,"2018-04-16 10:25:39","1577.23"
"grafana/loki","43f2ef33b37e9c09fd50d0ace621b4ba8e7a57a1","adityacs","2020-07-24 15:39:27","true","logstash code refactor and doc improvements (#2410)

* logstash code refactor and doc improvements

* added back gradlew assemble",122,27,0,1,"2018-04-16 10:25:39","828.72"
"grafana/loki","b2cd49a13e7eafc8dcc0ee167e8b6a7381481fd8","polar3130","2019-09-19 15:36:09","false","fix typo in error messages (#1030)",67,17,0,0,"2018-04-16 10:25:39","518.47"
"grafana/loki","ea8376d0cd0035c50b0b29396da4ed1bef8780e0","jeschkies","2023-04-05 10:53:21","true","Check that code has been formatted. (#9012)",82,59,1,1,"2018-04-16 10:25:39","1810.02"
"grafana/loki","60bf23d588405a62011c92e937983d930bd8f4b1","slim-bean","2020-06-23 12:36:36","true","Loki: remove redundant log line on stream limit, the GRPC error logger already logs this. (#2250)",138,26,0,1,"2018-04-16 10:25:39","797.59"
"grafana/loki","0de80fc30697fefdd6f66e7e3c6864282ce1dc38","grafanabot","2023-08-14 07:31:44","true","[CI/CD] Update yaml file `./production/helm/loki/Chart.yaml` (+1 other) (#10236)

**Here is a summary of the updates contained in this PR:**
***
Update attribute `$.appVersion` in yaml file
`./production/helm/loki/Chart.yaml` to the following value: `2.8.4`
***
Bump version of Helm Chart
Add changelog entry to `./production/helm/loki/CHANGELOG.md`
Re-generate docs

Co-authored-by: Trevor Whitney <trevorjwhitney@gmail.com>",53,64,1,0,"2018-04-16 10:25:39","1944.13"
"grafana/loki","bc10123698d18a447bd0e0b65072c3e93d329fc2","fionaliao","2021-05-25 11:48:28","true","Remove unnecessary backtick from example (#3757)",203,37,0,0,"2018-04-16 10:25:39","1134.81"
"grafana/loki","a3ae2f08f980964e2d6999c0dbd30ac64b834230","AdamKorcz","2020-12-04 10:44:12","true","Added fuzzer (#3031)",126,31,0,0,"2018-04-16 10:25:39","958.51"
"grafana/loki","c3084dbdc7e63f69d5a1edbeeb6e6ac000ae520d","slim-bean","2019-06-17 14:18:50","false","Removing the pre-allocation of a buffer when serializing blocks, in most of my empirical testing we were using 9-10k out of the 32k allocated leaving about 2/3 of the buffer allocated and unused times the number of blocks per chunk, times the number of chunks kept in memory.  This was adding up to a fair amount of allocated but unused space.",96,14,0,1,"2018-04-16 10:25:39","426.41"
"grafana/loki","f408e05ad426f9206a405d479161fc26caf3d72d","cyriltovena","2021-05-10 13:27:41","true","Add the ability to wrap the roundtripper of the logcli client. (#3678)

I actually did that on promtail on the previous PR, but logcli was required.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",190,37,0,1,"2018-04-16 10:25:39","1119.88"
"grafana/loki","be3ca9caf50b8c9804e521020e75e47294e62fc6","salvacorts","2023-10-11 08:02:32","true","Remove -ingester.max-transfer-retries (#10850)

**What this PR does / why we need it**:

In https://github.com/grafana/loki/pull/10709, we removed
`-ingester.max-transfer-retries` in favor of the WAL. Then, in
https://github.com/grafana/loki/pull/10844 we removed it from the config
file but we did not remove it from the ingester args. This PR solves
this by removing it.",25,66,1,1,"2018-04-16 10:25:39","2001.15"
"grafana/loki","2eb7fb2edd6169e48605dec3ab748cd30e194b49","JStickler","2023-10-04 17:42:26","true","Update README file for docs (#10762)

**What this PR does / why we need it**:
Adds additional content to the README in the docs directory.

**Which issue(s) this PR fixes**:
Fixes #10760",27,66,1,0,"2018-04-16 10:25:39","1994.55"
"grafana/loki","c9016f4b2a3b0ff40a22cc8c331884522793f507","JensErat","2020-01-06 14:53:01","false","fluent-bit-plugin: re-enable JSON marshal tests (#1455)

My upstream bugfix to `json-iterator/go` was accepted. This commit
updates to the newest upstream release, adds checks for the returned
error message and reenables the commented-out JSON marshaller tests.

Re-enabling the JSON marshaller tests that should return an error
message, I realized `sendMessage` logged and ignored marshalling errors
instead of passing them to the caller.

Signed-off-by: Jens Erat <email@jenserat.de>",106,21,0,0,"2018-04-16 10:25:39","625.44"
"grafana/loki","2e775f3f440d927fe37b4fc14e70d0daf9adffc1","chaudum","2023-09-28 07:43:58","true","chore(storage): Restructure shipper packages (#10729)

**What this PR does / why we need it**:

This PR restructures the code for the shipper component of the Loki storage layer.

New package layout:

```console
$ tree -d pkg/storage/stores/shipper 
pkg/storage/stores/shipper
└── indexshipper
    ├── boltdb
    │   └── compactor
    ├── compactor
    │   ├── client
    │   │   └── grpc
    │   ├── deletion
    │   ├── deletionmode
    │   ├── generationnumber
    │   └── retention
    ├── downloads
    ├── gatewayclient
    ├── index
    ├── indexgateway
    ├── storage
    ├── testutil
    ├── tsdb
    │   ├── index
    │   ├── testdata
    │   └── testutil
    ├── uploads
    └── util

23 directories
```

* TSDB and BoltDB specific code is under `./pkg/storage/stores/shipper/indexshipper/tsdb` and `./pkg/storage/stores/shipper/indexshipper/boltdb` respectively.
* Common code for both TSDB and BoltDB is directly under `./pkg/storage/stores/shipper/indexshipper` and subdirectories, such as `uploads/`, `downloads/`, `compactor/`, ...

**Special notes for your reviewer**:

This PR is identical to https://github.com/grafana/loki/pull/10724 except of the package `pkg/storage/stores/indexshipper` the package is `pkg/storage/stores/shipper/indexshipper` (one level deeper).


Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",29,65,1,1,"2018-04-16 10:25:39","1988.14"
"grafana/loki","94f059744677639cf099739bc127c90d9a530cb2","geowatson","2023-07-26 08:35:06","true","helm: add custom labels for loki ingress (#10009)

**What this PR does / why we need it**:

Custom labels for ingresses are usually addressed from values files, so
we need this feature.

**Which issue(s) this PR fixes**:

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [x] Tests updated
- [x] `CHANGELOG.md` updated
- [x] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [x] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [x] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",53,63,1,0,"2018-04-16 10:25:39","1926.17"
"grafana/loki","6cc581bd26cc00c4912d3ddf50db68839349a378","salvacorts","2023-06-28 18:13:52","true","Add back cache stats for index stats requests (#9816)

**What this PR does / why we need it**:

In https://github.com/grafana/loki/pull/9536, we added cache stats for
index stats requests. That PR had a bug that inflated the query stats
due to reusing the stats context in the query engine. Therefore, we had
to revert the PR at https://github.com/grafana/loki/pull/9721.

This PR brings back the changes from
https://github.com/grafana/loki/pull/9536 but fixes the inflated starts
by no longer reusing the same context in the query engine, but rather
creating a new one for the shard resolver.

I tested it on a dev cluster and seems to be working fine. here's the
output for the same query:

**Stats with the bug from #9536**:
```
...
Cache.StatsResult.Requests               980
Cache.StatsResult.EntriesRequested       490
Cache.StatsResult.EntriesFound   0
Cache.StatsResult.EntriesStored          490
Cache.StatsResult.BytesSent              0 B
Cache.StatsResult.BytesReceived          0 B
...
Summary.BytesProcessedPerSecond          43 GB
Summary.LinesProcessedPerSecond          93305142
Summary.TotalBytesProcessed              945 GB
Summary.TotalLinesProcessed              2059694183
```

**Stats from _main_**
```
...
Summary.BytesProcessedPerSecond          1.6 GB
Summary.LinesProcessedPerSecond          3403718
Summary.TotalBytesProcessed              95 GB
Summary.TotalLinesProcessed              207971404
```

**Stats with fix in this PR**
```
..
Cache.StatsResult.Requests               132
Cache.StatsResult.EntriesRequested       66
Cache.StatsResult.EntriesFound   0
Cache.StatsResult.EntriesStored          66
Cache.StatsResult.BytesSent              0 B
Cache.StatsResult.BytesReceived          0 B
...
Summary.BytesProcessedPerSecond          4.3 GB
Summary.LinesProcessedPerSecond          9468900
Summary.TotalBytesProcessed              95 GB
Summary.TotalLinesProcessed              207793816
```

As can be seen, with the changes in this PR, the summary stats are no
longer inflated.


**Which issue(s) this PR fixes**:
Fixes https://github.com/grafana/loki/pull/9536

**Special notes for your reviewer**:

I think it's ok to skip reviewing the changes from the commit
cherry-picking the changes from
https://github.com/grafana/loki/pull/9536

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",60,62,1,1,"2018-04-16 10:25:39","1898.58"
"grafana/loki","8e8dcdf7d2d5953acf46b9c98b5265599a50ab51","DylanGuedes","2023-05-17 12:01:38","true","Gateway: Log file size (#9465)

**What this PR does / why we need it**:
Modifies gateway log message to report the file size.

**Which issue(s) this PR fixes**:
N/A",72,61,1,1,"2018-04-16 10:25:39","1857.32"
"grafana/loki","b1e4e968453bc359e9452620214f95304c32df9e","f-mer","2018-12-12 16:05:43","false","Use image tagged with master in docker-compose.yaml (#77)

This pull request makes the image used in the `docker-compose.yaml` the same as the one used in the `README.md`. The currently used loki image in the `docker-compose.yaml` makes the service crash.

Signed-off-by: Fabian Mersch <fm@deltacity.net>",18,8,0,0,"2018-04-16 10:25:39","236.24"
"grafana/loki","1837c9e0b23d410e5b4972e203b314abb4d69e5d","owen-d","2022-02-15 23:34:00","true","Experimental TSDB index (#5376)

* moves encoding to own pkg

* decwrap impl

* forks tsdb index

* renames tsdb_enc

* wraps all tsdb decbufs

* use loki encbuf

* custom chunk meta replacing ref-id for uint32 checksum

* handle overlapping chunks in tsdb encoding

* tsdb builder impl

* tsdb querier beginnings to use modified tsdb

* fixes nonexistent reference

* lint/remove unused

* adds tsdb testware

* lint",289,46,0,1,"2018-04-16 10:25:39","1395.3"
"grafana/loki","2d31d0768092a4ee537ef1913eb5ffcb8de4bb09","owen-d","2020-05-01 13:34:27","true","Revert ""Update go from 1.13 to 1.14. (#2013)"" (#2028)

This reverts commit 8d6dc2c4ca3c696e18dc37ccba51d1671a152e4c.",121,24,0,1,"2018-04-16 10:25:39","745.63"
"grafana/loki","2561605ae9de5b2da827d79abe9fcf01fa2bdb32","cyriltovena","2020-07-13 14:47:47","true","Tutorial to run Promtail on AWS EC2 (#2321)

* Starting the work with spining out an ec2 instance.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Adds a tutorial on how to run Promtail on AWS EC2.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Improve gist link.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* More adjustements.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Update docs/clients/aws/ec2/ec2.md

* Update docs/clients/aws/ec2/ec2.md

Co-authored-by: Ed Welch <ed@oqqer.com>

* Move off curl gist to grafana/loki repo.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add systemd as most user will need it.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* yupo

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

Co-authored-by: Ed Welch <ed@oqqer.com>",119,27,0,1,"2018-04-16 10:25:39","817.68"
"grafana/loki","4d00e91cafee2626464d240086d39f21af2b6210","salvacorts","2023-06-02 08:07:48","true","Fix cacheGen for index stats reqs (#9529)

**What this PR does / why we need it**:

When deletes are enabled, we track the cache generation number to know
when to invalidate the cache. The queriers add this cache generation
number to the response, and in the frontend, we check if we should cache
the response or not based on such generation number.

Before this PR, the queriers didn't add the cache generation number to
the index stats responses, therefore, when deletes were enabled, we
could see the following error message in the frontend when checking if
we should store a new response in the cache:
```
we found results cache gen number %s set in store but none in headers
```

This PR fixes this by adding the middleware to add the generation number
to the index stats handler in the querier.

As seen in the following screenshot, once we rolled out the fixes in
this PR (at 10:12), the number of failed cache generation comparisons
decreased to 0. At the same time, the number of version comparisons also
decreased since we could store results in the cache and therefore the
cache effectiveness improved.

([source][1])

![image](https://github.com/grafana/loki/assets/8354290/752fbc66-0005-437a-9469-bc25405198b9)


**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)


[1]:
https://admin-dev-us-central-0.grafana-dev.net/grafana/explore?orgId=1&left=%7B%22datasource%22:%22P09658BD21492D183%22,%22queries%22:%5B%7B%22refId%22:%22G%22,%22expr%22:%22sum%28%5Cn%20%20%20%20rate%28%5Cn%20%20%20%20%20%20%20%20loki_results_cache_version_comparisons_failed%7Bcluster%3D%5C%22dev-us-central-0%5C%22,%20namespace%3D%5C%22loki-dev-005%5C%22%7D%5Cn%20%20%20%20%20%20%20%20%5B1m%5D%5Cn%20%20%20%20%29%5Cn%29%22,%22range%22:true,%22datasource%22:%7B%22type%22:%22prometheus%22,%22uid%22:%22P09658BD21492D183%22%7D,%22editorMode%22:%22code%22,%22legendFormat%22:%22Gen%20cmp%20fail%22%7D,%7B%22refId%22:%22A%22,%22expr%22:%22sum%28%5Cn%20%20%20%20rate%28%5Cn%20%20%20%20%20%20%20%20loki_results_cache_version_comparisons_total%7Bcluster%3D%5C%22dev-us-central-0%5C%22,%20namespace%3D%5C%22loki-dev-005%5C%22%7D%5Cn%20%20%20%20%20%20%20%20%5B1m%5D%5Cn%20%20%20%20%29%5Cn%29%22,%22range%22:true,%22instant%22:true,%22datasource%22:%7B%22type%22:%22prometheus%22,%22uid%22:%22P09658BD21492D183%22%7D,%22editorMode%22:%22code%22,%22legendFormat%22:%22Gen%20cpm%20total%22%7D%5D,%22range%22:%7B%22from%22:%221685094941101%22,%22to%22:%221685096865685%22%7D%7D",68,62,1,1,"2018-04-16 10:25:39","1872.15"
"grafana/loki","5034b1b337dde43b55242ca171a1d9a27637ecf8","thepalbi","2023-09-09 19:35:57","true","Add support for EventBridge s3 events in lambda-promtail (#10449)

**What this PR does / why we need it**:
Lambda promtail supports s3 events, which are used for scraping several
log sources such as ALB access logs. This works by configuring at the S3
bucket level ""s3 event notification"", that are configured to target the
lambda deployment of lambda-promtail.

However, if one is configuring this through CloudFormation, there's a
known issue with AWS that doesn't allow to configure both the lambda,
the bucket, and the notifications in the same stack. See [this
issue](https://github.com/aws-cloudformation/cloudformation-coverage-roadmap/issues/79)
for details.

For that, AWS introduced EventBridge notifications, which can be used to
ship s3 events to a lambda deployment as well. This flow looks like:
s3 -> eventbridge bus -> eventbridge rule -> lambda

EventBridge has it's own message structure for s3 notifications. This PR
adds a translation layer, just for `Object created` events (since they
are the only ones we should take into account), so that EventBridge
events can be received, and trigger the lambda as if they were from s3.

**Which issue(s) this PR fixes**:
Fixes https://github.com/grafana/loki/issues/10209

**Special notes for your reviewer**:

- [x] Pending testing this with an actual deployment of the s3 -> event
bridge -> lambda flow
- [x] ~~Add CF template for the `s3 -> event bridge -> lambda`
deployment~~ Follow up PR

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [x] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",44,65,1,0,"2018-04-16 10:25:39","1969.63"
"grafana/loki","cbe60c618076c6fc14968c580e36962646678d53","Red-GV","2021-11-24 09:05:55","true","LOG 1838: Adding Promtail, Fluentd, and Openshift Logging docs (#104)",215,43,0,1,"2018-04-16 10:25:39","1313.69"
"grafana/loki","ee045312a9cb5078c4c5663d0ffdf730cc6c1525","MasslessParticle","2023-03-29 14:05:51","true","Automatically Reorder Pipeline Filters (#8914)

This PR moves Line Filters to be as early in a log pipeline as possible.

For example:
`{app=""foo""} | logfmt |=""some stuff""` becomes `{app=""foo""} |=""some
stuff"" | logfmt`

Any LineFilter after a `LineFormat` stage will be moved to directly
after the nearest `LineFormat` stage

benchmarks:
```
goos: linux
goarch: amd64
pkg: github.com/grafana/loki/pkg/logql/syntax
cpu: 11th Gen Intel(R) Core(TM) i7-1165G7 @ 2.80GHz
                    │ reorder_old.txt │           reorder_new.txt           │
                    │     sec/op      │   sec/op     vs base                │
ReorderedPipeline-8      2104.5n ± 3%   173.9n ± 2%  -91.74% (p=0.000 n=10)

                    │ reorder_old.txt │          reorder_new.txt          │
                    │      B/op       │   B/op    vs base                 │
ReorderedPipeline-8        336.0 ± 0%   0.0 ± 0%  -100.00% (p=0.000 n=10)

                    │ reorder_old.txt │          reorder_new.txt           │
                    │    allocs/op    │ allocs/op  vs base                 │
ReorderedPipeline-8        16.00 ± 0%   0.00 ± 0%  -100.00% (p=0.000 n=10)
```",85,59,1,1,"2018-04-16 10:25:39","1804.15"
"grafana/loki","47637852fbf5a00eddadf0c3a2df2f0915af0494","joe-elliott","2019-09-12 16:02:04","false","Logcli: Add Support for New Query Path (#987)

Signed-off-by: Joe Elliott <number101010@gmail.com>",71,17,0,0,"2018-04-16 10:25:39","511.48"
"grafana/loki","c883f02eb0e1db9e3c45c43d12298c73ff503a45","slim-bean","2021-01-15 17:32:18","true","changes ingester default from 5Gi to 10Gi, prior to PR 3079 correctly fixed the ingester deployment to use this value, however the hard coded value was 10Gi and this default was 5Gi. This is a dissalowed change in kubernetes and causes deployment failures. (#3156)

Changing this back to 10Gi isn't ideal however because anyone who also deployed with the 5Gi is now in the same situation. I think however more people are going to find themselves impacted by this change as it existed for a lot longer as 10Gi than 5Gi.",119,33,0,1,"2018-04-16 10:25:39","999.8"
"grafana/loki","4439828d854ca56cd83e9e25950ca3bfdcc8c492","slim-bean","2019-06-03 20:47:33","false","updating versions for loki v0.1.0",109,14,0,1,"2018-04-16 10:25:39","412.68"
"grafana/loki","62da8bb8584e582e3d9dd52deccc5bc30118f26c","slim-bean","2020-08-21 15:13:07","true","restart the tailer if we fail to read and upate current position (#2532)

(cherry picked from commit b6d9fd5a00d27a597a278c0be442462f9390e57a)",121,28,0,1,"2018-04-16 10:25:39","855.7"
"grafana/loki","7c63dbf7b0e061f5a8e2d8fe3a38e2323be0da72","daniellee","2018-12-12 14:55:35","false","readme: remove unnecessary flag in docker run

Signed-off-by: Daniel Lee <dan.limerick@gmail.com>",17,8,0,0,"2018-04-16 10:25:39","236.19"
"grafana/loki","815c47533e0659fb749923b8c975d151054da513","periklis","2020-06-18 20:47:20","true","Replace memberlist service in favor of cortex provided service (#2224)

* Bump cortex deps to include non-experimental memberlist service

* Replace memberlist service in favor of cortex provided service

* Fix route method param for querytee tool

* Register memberlist flags

* Add documentation and example for memberlist",145,26,0,1,"2018-04-16 10:25:39","792.93"
"grafana/loki","907839ecf5bc3f44b3edbc163d071b98a68bd721","slim-bean","2020-02-25 16:38:30","false","add darwin and freebsd binaries to release output

Signed-off-by: Edward Welch <edward.welch@grafana.com>",117,22,0,1,"2018-04-16 10:25:39","674.51"
"grafana/loki","0bba510d192c50cca6ea84939eb97d063ff1b43e","trevorwhitney","2023-04-28 11:59:54","true","Bump helm and jsonnet to latest version (#9327)",80,60,1,1,"2018-04-16 10:25:39","1838.32"
"grafana/loki","cf23194d05d33105958f9e1ef70da3ed9717a81c","adityacs","2023-01-18 11:52:32","true","fix(logql): remove __error_details__ label on drop __error__ or other way around (#8150)",94,57,1,1,"2018-04-16 10:25:39","1733.06"
"grafana/loki","4e16ea6b4d0a60618965aa1489338a5ccd185753","dannykopping","2023-01-17 07:31:22","true","Minor LID fixes (#8167)

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",93,57,1,1,"2018-04-16 10:25:39","1731.88"
"grafana/loki","feaf9c32325668a1b01f81d813daac33a39d1b05","chaudum","2022-12-02 12:25:23","true","Log query string on retry alongside the error (#7834)

**What this PR does / why we need it**:

For better observability of query retries.

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",93,55,1,1,"2018-04-16 10:25:39","1687.08"
"grafana/loki","49c331aa6d9ec6d349f8f0d6770048fff2917e17","liguozhong","2022-04-07 05:58:21","true","fix boltdb-shipper doc (#5796)",321,48,0,1,"2018-04-16 10:25:39","1446.56"
"grafana/loki","52f9df415d5554a8d326ce51316c71039dcbf572","JordanRushing","2022-03-31 15:52:13","true","Update MultiTenantQuerier `Series()` and `Label()` to use `user.InjectOrgID()` instead of `user.InjectUserID()` (#5735)",311,47,0,0,"2018-04-16 10:25:39","1440.98"
"grafana/loki","29c7fd2b24a6eea73b60d9d18ea8b22236b09a5e","cstyan","2021-10-25 18:27:57","true","Pass repo as registry+repo as temporary workaround for drone ECR publish issues. (#4541)

Signed-off-by: Callum Styan <callumstyan@gmail.com>",162,42,0,1,"2018-04-16 10:25:39","1285.08"
"grafana/loki","502750decad0b662d90ceafe9aa005519601bcf9","taisho6339","2021-09-28 19:35:24","true","Add 'loki_ingester_memory_chunks' when recovery from wal (#4272)",142,41,0,0,"2018-04-16 10:25:39","1258.13"
"grafana/loki","e769d2dd3ed59fc03879115f3939336f0b7d0803","periklis","2021-08-26 12:12:27","true","Add profiler support (#74)",127,40,0,1,"2018-04-16 10:25:39","1225.82"
"grafana/loki","71aa8a631adcc4bd1af139ab0399373097fa911c","cyriltovena","2021-03-26 08:55:30","true","Add sprig text/template functions to template stage. (#3515)

* Add sprig text/template function to template stage.

Fixes #3129

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* nit.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* reset vendor file.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",144,35,0,1,"2018-04-16 10:25:39","1070.44"
"grafana/loki","bc3cba4112abaa5c428938806ff6055ff00c0278","cyriltovena","2020-07-07 16:23:16","true","Test again arm32 on internal ci. (#2309)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",122,27,0,1,"2018-04-16 10:25:39","811.75"
"grafana/loki","3defe3a5bdc1494babedf877adf76a9751d93f60","cyriltovena","2020-07-06 13:17:30","true","Default to 3100 port for Loki without requiring NET_BIND_SERVICE capability. (#2294)

Mistakes were made.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",125,27,0,1,"2018-04-16 10:25:39","810.62"
"grafana/loki","577d8eb1688691fee5baaabfb0fd737bb9637fdd","cyriltovena","2020-04-27 16:00:17","true","Ensure trace propagation in our logs. (#1977)

* Ensure trace propagation in our logs.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add missing import.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes a test.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fix function usage.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",116,24,0,1,"2018-04-16 10:25:39","741.73"
"grafana/loki","630a491580da45c5f5980958c55c205ea60c08ef","periklis","2022-09-12 13:43:05","true","loki: Attach the panic recovery handler on all HTTP handlers (#6780)",85,53,1,1,"2018-04-16 10:25:39","1607.14"
"grafana/loki","ac63ea85003a0eee88ad16ff97a12918e6a6cef0","dannykopping","2021-07-21 15:51:23","true","Promtail: adding pipeline stage inspector (#4011)

* Adding promtail pipeline stage inspector

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Adding library

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Adding docs

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Appeasing the linter

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Further appeasing the linter

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Removing old version of go-cmp to pass check-mod step

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Making screenshot narrower and correcting link

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Apply suggestions from code review

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* Copy changes

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Copy changes

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>",98,39,0,1,"2018-04-16 10:25:39","1190.98"
"grafana/loki","d7de3b459f2e19a55f815f9a98f90aaeffc3cde0","hedss","2020-11-18 09:20:41","true","Docs: Corrects Fluent Bit documentation link to build the plugin. (#2942)

* Corrects Fluent Bit documentation link to build the plugin.

Signed-off-by: Heds Simons <heds@whaleway.net>

* Update docs/sources/clients/fluentbit/_index.md

Co-authored-by: achatterjee-grafana <70489351+achatterjee-grafana@users.noreply.github.com>

Co-authored-by: Cyril Tovena <cyril.tovena@gmail.com>
Co-authored-by: achatterjee-grafana <70489351+achatterjee-grafana@users.noreply.github.com>",123,31,0,0,"2018-04-16 10:25:39","942.45"
"grafana/loki","7e372cbc56e1871393bde593b5f5fb2246548de5","09jvilla","2022-01-31 15:33:32","true","Adding a docs page that helps users understand memberlist a bit more (#5186)

* Added some new docs on memberlist.

* Added a page with more memberlist info.",278,45,0,0,"2018-04-16 10:25:39","1380.96"
"grafana/loki","78b073e022c6829316e0744b2c4c4cff14e3f5c5","MichelHollands","2021-07-12 10:16:05","true","Add a chunk filterer field to the config (#3979)

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",107,39,0,1,"2018-04-16 10:25:39","1181.74"
"grafana/loki","95bf7592e0661956328559253186e12ab1e5fb4e","chaudum","2022-03-25 13:55:52","true","Build querytee image as part of CI pipeline (#5700)

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",309,47,0,1,"2018-04-16 10:25:39","1434.9"
"grafana/loki","4f87db7f38c40cc6af7cf7e2abd88a66327e041a","owen-d","2022-05-18 13:14:47","true","strips out tenant label from LabelNames queries (#6181)

* strips out tenant label from LabelNames queries

* prevent tenant labelvalues query",73,49,0,1,"2018-04-16 10:25:39","1493.12"
"grafana/loki","4687b416dbc732d91260bb4e7db85c2a6d9c2bf4","chaudum","2021-12-14 20:07:49","true","Update logstash dependency in logstash-output-loki plugin (#4930)

Use `logstash:7.16.1` as base image for the
`grafana/logstash-output-loki` Docker image.
This logstash version uses `log4j` 2.15.0 which mitigates CVE-2021-44228.

- https://www.elastic.co/guide/en/logstash/current/logstash-7-16-1.html
- https://nvd.nist.gov/vuln/detail/CVE-2021-44228

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",229,44,0,1,"2018-04-16 10:25:39","1334.15"
"grafana/loki","be8b4eece30df592bd8843d3f0f271a8387a4695","chaudum","2023-03-21 08:34:30","true","Scheduler: Add query fairness control across multiple actors within a tenant (#8752)

**What this PR does / why we need it**:

This PR wires up the scheduler with the hierarchical queues. It is the last PR to implement https://github.com/grafana/loki/pull/8585.

When these changes are in place, the client performing query requests can control their QoS (query fairness) using the `X-Actor-Path` HTTP header. This header controls in which sub-queue of the tenant's scheduler queue the query request is enqueued. The place within the hierarchy where it is enqueued defines the probability with which the request gets dequeued.

A common use-case for this QoS control is giving each Grafana user within a tenant their fair share of query execution time.

Any documentation is still missing and will be provided by follow-up PRs.

**Special notes for your reviewer**:

```console
$ gotest -count=1 -v ./pkg/scheduler/queue/... -test.run=TestQueryFairness
=== RUN   TestQueryFairness
=== RUN   TestQueryFairness/use_hierarchical_queues_=_false
    dequeue_qos_test.go:109: duration actor a 2.007765568s
    dequeue_qos_test.go:109: duration actor b 2.209088331s
    dequeue_qos_test.go:112: total duration 2.209280772s
=== RUN   TestQueryFairness/use_hierarchical_queues_=_true
    dequeue_qos_test.go:109: duration actor b 605.283144ms
    dequeue_qos_test.go:109: duration actor a 2.270931324s
    dequeue_qos_test.go:112: total duration 2.271108551s
--- PASS: TestQueryFairness (4.48s)
    --- PASS: TestQueryFairness/use_hierarchical_queues_=_false (2.21s)
    --- PASS: TestQueryFairness/use_hierarchical_queues_=_true (2.27s)
PASS
ok  	github.com/grafana/loki/pkg/scheduler/queue	4.491s
```

```console
$ gotest -count=5 -v ./pkg/scheduler/queue/... -bench=Benchmark -test.run=^$ -benchtime=10000x -benchmem
goos: linux
goarch: amd64
pkg: github.com/grafana/loki/pkg/scheduler/queue
cpu: 11th Gen Intel(R) Core(TM) i7-1185G7 @ 3.00GHz
BenchmarkGetNextRequest
BenchmarkGetNextRequest/without_sub-queues
BenchmarkGetNextRequest/without_sub-queues-8         	   10000	     29337 ns/op	    1600 B/op	     100 allocs/op
BenchmarkGetNextRequest/without_sub-queues-8         	   10000	     21348 ns/op	    1600 B/op	     100 allocs/op
BenchmarkGetNextRequest/without_sub-queues-8         	   10000	     21595 ns/op	    1600 B/op	     100 allocs/op
BenchmarkGetNextRequest/without_sub-queues-8         	   10000	     21189 ns/op	    1600 B/op	     100 allocs/op
BenchmarkGetNextRequest/without_sub-queues-8         	   10000	     21602 ns/op	    1600 B/op	     100 allocs/op
BenchmarkGetNextRequest/with_1_level_of_sub-queues
BenchmarkGetNextRequest/with_1_level_of_sub-queues-8 	   10000	     33770 ns/op	    2400 B/op	     200 allocs/op
BenchmarkGetNextRequest/with_1_level_of_sub-queues-8 	   10000	     33596 ns/op	    2400 B/op	     200 allocs/op
BenchmarkGetNextRequest/with_1_level_of_sub-queues-8 	   10000	     34432 ns/op	    2400 B/op	     200 allocs/op
BenchmarkGetNextRequest/with_1_level_of_sub-queues-8 	   10000	     33760 ns/op	    2400 B/op	     200 allocs/op
BenchmarkGetNextRequest/with_1_level_of_sub-queues-8 	   10000	     33664 ns/op	    2400 B/op	     200 allocs/op
BenchmarkGetNextRequest/with_2_levels_of_sub-queues
BenchmarkGetNextRequest/with_2_levels_of_sub-queues-8         	   10000	     71405 ns/op	    3200 B/op	     300 allocs/op
BenchmarkGetNextRequest/with_2_levels_of_sub-queues-8         	   10000	     59472 ns/op	    3200 B/op	     300 allocs/op
BenchmarkGetNextRequest/with_2_levels_of_sub-queues-8         	   10000	    117163 ns/op	    3200 B/op	     300 allocs/op
BenchmarkGetNextRequest/with_2_levels_of_sub-queues-8         	   10000	    106505 ns/op	    3200 B/op	     300 allocs/op
BenchmarkGetNextRequest/with_2_levels_of_sub-queues-8         	   10000	     64374 ns/op	    3200 B/op	     300 allocs/op
BenchmarkQueueRequest
BenchmarkQueueRequest-8                                       	   10000	    168391 ns/op	  320588 B/op	    1156 allocs/op
BenchmarkQueueRequest-8                                       	   10000	    166203 ns/op	  320587 B/op	    1156 allocs/op
BenchmarkQueueRequest-8                                       	   10000	    149518 ns/op	  320584 B/op	    1156 allocs/op
BenchmarkQueueRequest-8                                       	   10000	    219776 ns/op	  320583 B/op	    1156 allocs/op
BenchmarkQueueRequest-8                                       	   10000	    185198 ns/op	  320597 B/op	    1156 allocs/op
PASS
ok  	github.com/grafana/loki/pkg/scheduler/queue	64.648s
```

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",84,59,1,1,"2018-04-16 10:25:39","1795.92"
"grafana/loki","5073b48b62d92a8f11b9dd192eae13ec22bfaeaa","trevorwhitney","2022-07-07 16:05:48","true","Add integration for SSD (read & write targets) (#6585)

* Add integration for SSD (read & write targets)

* Hardcode randStringRunes to fix linter",70,51,0,1,"2018-04-16 10:25:39","1542.24"
"grafana/loki","7f61f111ae1adf863a6b4c0626eddeddfe2c63d6","adityacs","2020-03-23 15:13:37","true","Log error message when source does not exist in extracted values (#1815)",120,23,0,1,"2018-04-16 10:25:39","702.45"
"grafana/loki","23704bdd563af7a48c6c7486aaaeb23b8909c648","periklis","2023-07-25 14:25:47","true","Add drone support for loki operator/v* tags (#10053)",53,63,1,1,"2018-04-16 10:25:39","1925.42"
"grafana/loki","7e248e1e905e1b307e661205979ea46733c04460","salvacorts","2023-07-21 12:31:45","true","Support non-indexed labels in WAL (#10011)

**What this PR does / why we need it**:
In https://github.com/grafana/loki/pull/9700, we support encoding and
decoding non-indexed labels for each entry into the chunks. This PR adds
support for writing/reading the non-indexed labels to/from the WAL.

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [x] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",55,63,1,1,"2018-04-16 10:25:39","1921.34"
"grafana/loki","7a11a1642beb4c872f1b074df51d7efe5f773e79","pixiono","2023-06-23 21:06:25","true","loki chart: fix service/ingress mapping (#8708)

**What this PR does / why we need it**:
If you currently deploy the Loki chart under a release name other than
""loki"" errors occur which is why loki is not accessible via Ingress.

The problem looks like this:

> $ k describe ingress xyz-loki-app
> Name:             xyz-loki-app
> Labels:           app.kubernetes.io/instance=xyz-loki-app
>                   app.kubernetes.io/managed-by=Helm
>                   app.kubernetes.io/name=loki
> [...]
> Rules:
>   Host                                      Path  Backends
>   ----                                      ----  --------
>   loki.example.com
> /api/prom/tail xyz-loki-app-read:3100 (<error: endpoints
""xyz-loki-app-read"" not found>)
> /loki/api/v1/tail xyz-loki-app-read:3100 (<error: endpoints
""xyz-loki-app-read"" not found>)
> /loki/api xyz-loki-app-read:3100 (<error: endpoints
""xyz-loki-app-read"" not found>)
> /api/prom/rules xyz-loki-app-read:3100 (<error: endpoints
""xyz-loki-app-read"" not found>)
> /loki/api/v1/rules xyz-loki-app-read:3100 (<error: endpoints
""xyz-loki-app-read"" not found>)
> /prometheus/api/v1/rules xyz-loki-app-read:3100 (<error: endpoints
""xyz-loki-app-read"" not found>)
> /prometheus/api/v1/alerts xyz-loki-app-read:3100 (<error: endpoints
""xyz-loki-app-read"" not found>)
> /api/prom/push xyz-loki-app-write:3100 (<error: endpoints
""xyz-loki-app-write"" not found>)
> /loki/api/v1/push xyz-loki-app-write:3100 (<error: endpoints
""xyz-loki-app-write"" not found>)

The name of the services is: loki-read & loki-write.

I found [another PR with the same
problem](https://github.com/grafana/loki/pull/8234) but with a different
approach, so I would suggest here to solve the name problem without the
question if .name or .fullname should be used.

**Which issue(s) this PR fixes**:
Fixes # 

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",60,62,1,0,"2018-04-16 10:25:39","1893.69"
"grafana/loki","ac1c1fdf037cd5c6284190a0c73ea13e05c3770e","alanconway","2023-04-13 18:55:39","true","operator: Revert 1x.extra-small changes, add 1x.tiny-test (#9049)",84,60,1,0,"2018-04-16 10:25:39","1818.35"
"grafana/loki","4c3e276679af97baf76fe8d87b36d31d37c3ee09","periklis","2022-06-02 16:37:41","true","operator: Add ruler config support (#6195)",72,50,0,1,"2018-04-16 10:25:39","1507.26"
"grafana/loki","8518560cf2d67d13ebfe1a78d5d192e39fe151c6","chaudum","2022-05-18 18:43:36","true","Fix flaky gRPC server shutdown in tests (#6191)

* Use `t.Cleanup(cleanup)` instead of `defer cleanup()`

Which seems to reduce the likelyhood of the flaky gRPC server shutdown

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* Do not fail test if gRPC server graceful shutdown fails

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",73,49,0,1,"2018-04-16 10:25:39","1493.35"
"grafana/loki","93507a00ed470c3eef5e7aebcee4c6a2dff14c48","JordanRushing","2021-10-22 18:41:56","true","Add quick nil check in TenantLimits for runtime_config (#4531)",164,42,0,0,"2018-04-16 10:25:39","1282.09"
"grafana/loki","ea71e0dec391096310178df685e3f31b2668e734","periklis","2021-10-18 14:59:21","true","Fix olm-based deployments on openshift (#96)",160,42,0,1,"2018-04-16 10:25:39","1277.94"
"grafana/loki","6ec29ef74885b835248e84ff120a2c2908dda8ef","periklis","2021-04-27 13:40:14","true","Add missing manifests tests (#36)",174,36,0,1,"2018-04-16 10:25:39","1106.89"
"grafana/loki","29790ea19b0547ce66235c915c0f6cea94687a94","sandeepsukhani","2020-09-18 12:26:23","true","fix an issue with building loki (#2642)",120,29,0,1,"2018-04-16 10:25:39","882.58"
"grafana/loki","1729592f38c087d1c7c9a3c3405adc823fca798b","adityacs","2020-06-18 20:49:20","true","Add Error method for step evaluators (#2223)",145,26,0,1,"2018-04-16 10:25:39","792.93"
"grafana/loki","33478711543c41844c4860cf57d376e18449a00f","owen-d","2020-04-08 15:01:28","true","only fetches one chunk per series in /series (#1914)

* only fetches one chunk per series in /series

* Update pkg/storage/store.go

* chunksBySeries naming

* sorts series response, adds tests for chunks < batchsize",116,24,0,1,"2018-04-16 10:25:39","717.44"
"grafana/loki","97ac9da43085689200aee28bbd4c5b2abf9d8b58","cyriltovena","2019-12-02 14:00:52","true","Update gem version. (#1339)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",91,19,0,1,"2018-04-16 10:25:39","591.4"
"grafana/loki","ecbba601267a83dc1b1dfc53ec16d08b1397c34e","daixiang0","2019-04-15 01:37:33","true","Merge branch 'master' into reduce-config-option",101,12,0,0,"2018-04-16 10:25:39","358.63"
"grafana/loki","2031845e7a7958290678c10d888877a089157075","tomwilkie","2018-05-16 15:13:13","false","Correctly with up query api.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",0,1,0,0,"2018-04-16 10:25:39","30.2"
"grafana/loki","24347e7ca1779af88b12bf6fcf5e8458bedacd09","periklis","2022-07-11 12:22:17","true","operator: Update Loki operand to v2.6.0 (#6646)",71,51,0,1,"2018-04-16 10:25:39","1546.08"
"grafana/loki","c6d0dc0af506b83aad0f0d7de693bddfcf601b55","daixiang0","2019-02-02 02:32:35","false","Add k8s part in docs

Signed-off-by: Xiang Dai <764524258@qq.com>",79,9,0,0,"2018-04-16 10:25:39","285.67"
"grafana/loki","f0f3557ce277e4f45362ef08a0ae264008639616","JStickler","2023-10-02 14:30:59","true","Update headings in deployment modes topic (#10745)

I realized when I was looking at this topic, that the headings were not
parallel.


![Headings](https://github.com/grafana/loki/assets/4106682/d8847f91-06a7-4929-8d63-d704ffa6ebda)

Fixed the headings, and also updated the first paragraphs to include the
words ""deployment mode"" since I took it out of the headings.",32,65,1,0,"2018-04-16 10:25:39","1992.42"
"grafana/loki","b3b4317861679d584bfa4d2c02dd2f9ec5b5f4cf","JStickler","2023-07-12 18:23:00","true","Fix image links in moved files. (#9910)

Noticed the other day that images in files that have been moved as part
of #8710 were not displaying in `/next/`. This PR updates the image
references.",59,63,1,0,"2018-04-16 10:25:39","1912.58"
"grafana/loki","54bc1468b402dc5d16ac194d817ea0e4ee268aa7","Whyeasy","2021-03-26 08:54:25","true","Added docs for GCP internal labels. (#3529)

Signed-off-by: Whyeasy <Whyeasy@users.noreply.github.com>",145,35,0,0,"2018-04-16 10:25:39","1070.44"
"grafana/loki","9cab63d921019557326bf105bd91da000ec092a8","dannykopping","2023-01-12 19:52:57","true","Loki Improvement Documents (LIDs) (#8056)

**What this PR does / why we need it**:
This PR adds a _Loki Improvement Document_ process to engage
contributors and the community on major changes to Loki, _before_ large
amounts of work is done.

The aim here is to have a **lightweight documented history of our
decisions** which the community can view in perpetuity.

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",100,57,1,1,"2018-04-16 10:25:39","1727.39"
"grafana/loki","7a69ed295fb7283b4757c5a19eb3cd6eaff1beab","rissson","2023-10-18 15:18:22","true","helm: fix singleBinary missing anotations (#10605)

**Which issue(s) this PR fixes**:
Fixes #10528

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] N/A: Documentation added
- [x] N/A: Tests updated
- [x] `CHANGELOG.md` updated
- [x] N/A: If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [x] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [x] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

Signed-off-by: Marc 'risson' Schmitt <marc.schmitt@risson.space>",21,66,1,0,"2018-04-16 10:25:39","2008.45"
"grafana/loki","55bad57ed9e6287ae350eed31d765dd8ce9bc035","tomwilkie","2019-03-20 17:52:20","true","Use __meta_kubernetes_pod_controller_name to ensure we scrape all pods. (#154)

* Add a scrape config for pods without name or app labels.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>

* rebase with master and update to prefer name label but fallback to controller name

* Update scrape_config to use pod controller_name in the job

If a pod has a ""name"" label we use that in the job name. Otherwise,
- If the pod was created directly by a controller (statefulset,
  daemonset, job) then we use that controller_name.
- if the pod was created by controller created by a controller
  (deployment, cronJob) then we use the parent controller name.

- add a scrape_config.sh tool that generates the scrap_configs
  for promtail.sh and helm chart from the ksonnet lib.

* Reduce duplication in jsonnet.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>

* Fix rebase

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>

* Tidy up promtail config imports.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",91,11,0,0,"2018-04-16 10:25:39","334.31"
"grafana/loki","3e4448aa573cf1b9d6d5d7a87e967693e780d71c","gouthamve","2018-12-06 13:05:47","false","The version linked is quite old. master is much better (#45)

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>",9,8,0,0,"2018-04-16 10:25:39","230.11"
"grafana/loki","1329ea165ca357a481b9bf9a25352dd2caafcbef","bboreham","2022-04-08 13:20:14","true","TestPromtail: avoid hanging when test fails midway (#5837)

* Allow Promtail.Shutdown to be called again

I want to do this in a test

* TestPromtail: avoid hanging when test fails midway

Also call Shutdown via defer so we clean up those resources when the test fails",322,48,0,0,"2018-04-16 10:25:39","1447.87"
"grafana/loki","6948c4a179a0b7763aab76d5fd34e67d9fffbf3a","jeschkies","2023-10-23 11:24:51","true","Turn frontend Tripperware into a Middleware. (#10688)

**What this PR does / why we need it**:
Currently, a request to Loki's frontend API goes through these
conversions:
```
        http.Request 
            ↓ limitedRoundTripper
        queryrangebase.Request
            ↓ queryrangebase.Middlware
        … 
            ↓
        queryrangebase.Request
            ↓ limitedRoundTripper  
        http.Request
            ↓ grpcRoundTripperAdapter
        httpgrpc
            ↓ grpcRoundTripperAdapter
        http.Response
            ↓ limitedRoundTripper
        queryrangebase.Response
            ↓ limitedRoundtripper
        http.Response
```

Since `httgrpc` and `queryrangebase.Request` are Protobufs there's no
good reason to encode and decode them to HTTP responses/requests.
Furthermore, the encoding to HTTP makes it harder for us to encode query
plans.

Thus the conversions are changed to the following:
```
        http.Request 
            ↓
        queryrangebase.Request
            ↓ queryrangebase.Middlware
        … 
            ↓
        queryrangebase.Request
            ↓
        httpgrpc
            ↓
        queryrangebase.Response
            ↓
        http.Response
```

In order to achieve this the `http.RoundTripper` is pushed to the
outside. Only the serialization layer from `http.Request` to
`queryrangebase.Request` and `http.Response` to
`queryrangebase.Response` will be an `http.RoundTripper`. Everything
else is either a `queryrangebase.Handler` or
`queryrangebase.Middleware`.

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [x] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",25,66,1,1,"2018-04-16 10:25:39","2013.29"
"grafana/loki","9c19b0f5482f23c121780eb84d81cc451dba82f4","wtchangdm","2022-05-02 13:51:28","true","Fix broken link on deployment-modes.md (#6068)

The configuration link should go another parent level further in order to get `docs/loki/latest/configuration/`, currently it points to `docs/loki/latest/fundamentals/configuration/`.",74,49,0,0,"2018-04-16 10:25:39","1477.14"
"grafana/loki","5b5d469038ef95a34ae4513020166f416abfd6b0","kavirajk","2022-01-19 16:11:42","true","Support `X-Query-Tags` in LogCLI (#5145)

* Add support for `--query-tags` LogCLI

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Split it into helper func

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Cleanup the tests

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Fix linter

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* PR remarks

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Fix `getHTTPRequestHeader()` in test assert

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",266,45,0,1,"2018-04-16 10:25:39","1368.99"
"grafana/loki","81b36768d5142580fcfdd16cd9a7e8e5f988a6a8","rfratto","2020-04-23 14:16:14","true","fix available stores for chunk and index in documentation for period config (#1974)",117,24,0,1,"2018-04-16 10:25:39","737.66"
"grafana/loki","b5d8c77b99cd84ba38c69e1fecadc92b3eaf6cb8","adityacs","2019-08-06 15:28:44","false","Readiness probe for querier (#854)",99,16,0,1,"2018-04-16 10:25:39","475.46"
"grafana/loki","636ed15c6550ed6b2c12c8af419079e70dee4465","adityacs","2020-02-13 13:52:43","true","Fix logcli --quiet parameter parsing issue (#1682)",114,22,0,1,"2018-04-16 10:25:39","662.39"
"grafana/loki","7c6cbc21aaae411eb593cddc0a7edf84edc0dc89","pracucci","2020-03-16 13:33:08","true","Enable global limits by default in production mixin (#1807)

Signed-off-by: Marco Pracucci <marco@pracucci.com>",116,23,0,0,"2018-04-16 10:25:39","695.38"
"grafana/loki","15817eb14bd1b89c8dfd16edb44ea83747cb2af2","vlad-diachenko","2022-11-07 16:00:09","true","updated chart version to 3.3.2 to release merged changes (#7618)

changes for 3.3.2 were merged today but the chart was not released
because chart version was not bumped and docs were not re-generated
fixes: https://github.com/grafana/loki/pull/7266",88,55,1,0,"2018-04-16 10:25:39","1662.23"
"grafana/loki","cc39334391d3700ddb424d251145394168820638","trevorwhitney","2023-01-26 17:36:51","true","[helm] Fix helm dashboards (#8261)

Fix the dashboards shipped with the helm chart.

Co-authored-by: Karsten Jeschkies <k@jeschkies.xyz>
Co-authored-by: J Stickler <julie.stickler@grafana.com>",83,57,1,1,"2018-04-16 10:25:39","1741.3"
"grafana/loki","1875a1d6d851da0a68758789dfb2d614e2351166","jeschkies","2023-02-16 08:45:45","true","Fetch all entries with logcli if limit==0. (#8537)",74,58,1,1,"2018-04-16 10:25:39","1760.93"
"grafana/loki","fe8bc9144fe5082b7c117f98f6b6a437aed22a9c","slim-bean","2021-11-02 19:03:46","true","Loki: query scheduler should send shutdown to frontends when ReplicationSet changes (#4614)

* make sure we send a shutdown message to frontends from the scheduler when the ReplicationSet changes so that inflight queries are canceled and retried in the frontends.

* use Write so we find an instance incase one is unhealthy",167,42,0,1,"2018-04-16 10:25:39","1292.11"
"grafana/loki","56af725a08f866c7dfbb12ea05f926ff9d345cc0","MichelHollands","2021-04-13 08:51:34","true","Make the store field public (#3602)

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",155,36,0,1,"2018-04-16 10:25:39","1087.43"
"grafana/loki","bec014dd8649afc7e820d8ebbe7b1a1605411413","vlad-diachenko","2022-08-12 13:04:52","true","Logql analyzer page cherry picks (#6889)

* added Logql Analyzer page into loki docs

* changed template to support changes in API and supported the case when query is run against empty line

* added more json examples, changed some labels and changes css for line numbers

* fixed last comments from Karen and pointed to production API",83,52,0,0,"2018-04-16 10:25:39","1577.11"
"grafana/loki","314531cb0476829765a3e9a6fcc26d06fd113876","cyriltovena","2020-06-19 21:32:51","true","Improve point allocations for each steps in the logql engine. (#2216)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",143,26,0,1,"2018-04-16 10:25:39","793.96"
"grafana/loki","de9cc69de3391440e133c0d103964cd7cc18d0fd","salvacorts","2023-10-04 14:05:34","true","Update configuration examples (#10781)

**What this PR does / why we need it**:

This PR updates the set of configuration examples.

There are snippets for some deprecated configs. We are considering
moving those deprecated examples to a separate section with a follow-up
PR.

---------

Co-authored-by: Ashwanth <iamashwanth@gmail.com>",28,66,1,1,"2018-04-16 10:25:39","1994.4"
"grafana/loki","6148794b9bcd18b67b26254703ce9f75fd0d070d","cyriltovena","2021-03-17 14:19:42","true","Fixes a bug where unpack would mutate log line. (#3502)

* Fixes a bug where unpack would mutate log line.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* add reset.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",160,35,0,1,"2018-04-16 10:25:39","1061.66"
"grafana/loki","f9d9b471f8efff2b8789d49ee2a37764b9fb848f","salvacorts","2023-04-13 13:47:31","true","Fix comment in `buildChunkMetas ` test function (#9124)

wrt https://github.com/grafana/loki/pull/9096#discussion_r1164555980",82,60,1,1,"2018-04-16 10:25:39","1818.14"
"grafana/loki","ee2fe6514d54fda3ff0cfb355a965414197a63ce","simonswine","2022-08-15 09:27:01","true","Propagate error detail properly in all cases (#6890)

The error handling was missing appending the error detail properly in all cases.

Fixes #6265",83,52,0,0,"2018-04-16 10:25:39","1579.96"
"grafana/loki","29c7ead5ed6289ec436543030ed370289fcffd62","JStickler","2023-09-11 15:03:42","true","[Docs] Revise Loki Overview topic (#10457)

**What this PR does / why we need it**:

Revising/Refreshing the Loki overview as first phase of addressing
#9228.",43,65,1,0,"2018-04-16 10:25:39","1971.44"
"grafana/loki","e089b4b60dc7ac73263883dbf63f8ca7ea05b16a","sandeepsukhani","2023-07-02 10:40:00","true","address feedback on pr 9798 (#9842)

**What this PR does / why we need it**:
PR #9798 got merged by mistake without me addressing the feedback. There
is some critical feedback which needs to be addressed, particularly
https://github.com/grafana/loki/pull/9798#discussion_r1243526743.",60,62,1,1,"2018-04-16 10:25:39","1902.26"
"grafana/loki","babed450c7a997a296184c66f5f0f620f68964c9","dannykopping","2021-06-02 19:28:17","true","Ruler: Recording Rules (#3766)

* WIP: hack to get recording rules working and pushing to Cortex/Prometheus

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Refactoring

Adding remote_write config for ruler

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Minor refactorings

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Moving manager subpackage into ruler package to avoid dependency cycles

This also mirrors Cortex's package structure

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Minor refactorings

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Skipping commit if remote-write client is not defined

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Updating use of cortex client

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Memoizing appenders, using queue for samples & labels

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Adding buffer size configurability

Refactoring

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Adding metric to show current buffer size

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Refactoring for better responsibility separation & testability

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Adding per-tenant overrides of remote-write queue capacity

Renaming ""buffer size"" to ""queue capacity"" to be more accurate

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Adding tests for evicting queue

Minor refactoring

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Adding more tests and refactoring

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Adding queue benchmark

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Reducing redundancy in metric names

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Testing that only metric queries can be run

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Minor fixes pre-review

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Appeasing the linter

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Guarding against unprotected nil pointer dereference in Prometheus remote.Client

Adding remote-write client validation

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Appeasing the linter

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Setting tenant ID header on remote-write client

Adding User-Agent string

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Updating benchmark to use complex struct rather than int to be more reflective of usage

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Registering flags

Removing extraneous checks

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Adding metric to track remote-write commit errors

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Refactoring based on review

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Performance improvements based on review

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Return error on invalid queue capacity

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Removing global queue capacity config - using limits

Minor refactoring

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Reusing memory in request preparation

Refactoring for testability

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Moving remote-write metrics into struct

Refactoring

Unexporting and refactoring memstore metrics to match

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Applying review suggestions

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Allowing for runtime changing of per-tenant remote-write queue capacity

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Appeasing the linter

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",208,38,0,1,"2018-04-16 10:25:39","1142.13"
"grafana/loki","cb7c8f6233533841ff2676bf9ba4ca9e28c7924c","cyriltovena","2019-07-19 19:35:43","true","Use prometheus pool for line buffer. (#790)

* Use prometheus pool for line buffer.",105,15,0,1,"2018-04-16 10:25:39","458.63"
"grafana/loki","c63928e20f74d5a15bac9952058d569376952211","dannykopping","2022-08-03 16:53:41","true","Support building against Go 1.19 (#6833)

* Support building against Go 1.19

Fixes https://github.com/grafana/loki/issues/6831

Hat-tip to @rfratto in https://github.com/grafana/agent/pull/1985

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* go mod tidy

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",77,52,0,1,"2018-04-16 10:25:39","1568.27"
"grafana/loki","75328872dc41a23172411911a33cd6305f8c9af8","dannykopping","2022-03-14 09:28:00","true","Print stacktrace to stderr for easier readability (#5616)

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",304,47,0,1,"2018-04-16 10:25:39","1423.71"
"grafana/loki","7446f2498fa4e8a5b8ee3e12608737aa25f88a52","dannykopping","2022-07-18 09:09:53","true","Add configurable groupcache capacity (#6678)

* Add configurable groupcache capacity

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Improving the verbiage for clarity - thanks Travis!

Changed the default size to 100MB

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Adding config docs

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Removed test - it was pretty redundant, plus groupcache panics if you try init its http server more than once

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",69,51,0,1,"2018-04-16 10:25:39","1552.95"
"grafana/loki","0e518967a736994af9295fb0b2a54fbf66d671e1","vlad-diachenko","2022-02-11 10:46:44","true","updated documentation for xk6-loki extension (#5321)

* documented custom k6 metrics that xk6-loki extension reports for instant and range queries

* Update docs/sources/clients/k6/query-scenario.md

Co-authored-by: Christian Haudum <christian.haudum@gmail.com>

* changed description

* documented new metrics

Co-authored-by: Christian Haudum <christian.haudum@gmail.com>",281,46,0,0,"2018-04-16 10:25:39","1390.76"
"grafana/loki","760c255431bec88173112a4d69eb935602dab6c1","kavirajk","2023-08-25 16:27:17","true","doc(schema): Start recommending `v12` schema instead of `v11` (#10355)

**What this PR does / why we need it**:
`v12` is stable schema with more efficient/stable chunks and index
formats. Start recommending it instead of old `v11`.

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added

---------

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",49,64,1,1,"2018-04-16 10:25:39","1955.5"
"grafana/loki","8b924a52cb243a06286dd37a715b97529a32e385","owen-d","2020-04-17 18:15:41","true","chunk lifespan histogram (#1958)

* chunk lifespan histogram

* renames to bounds for clarity",119,24,0,1,"2018-04-16 10:25:39","731.83"
"grafana/loki","b2ad709225dbc6d5aaa9777ae2206c5e00f1a901","owen-d","2021-10-25 16:28:03","true","brings storage architecture up to date (#4521)

* brings storage architecture up to date

* pr feedback",165,42,0,1,"2018-04-16 10:25:39","1285"
"grafana/loki","dda945b3e4ef8e98ec9ff0f9624936db465180ae","owen-d","2020-10-27 16:37:23","true","fixes promtail libsonnet tag. closes #2818 (#2820)",122,30,0,1,"2018-04-16 10:25:39","921.76"
"grafana/loki","f6a3300f872f8dfdebc131c73b43bbd8d49d0f03","grafanabot","2023-03-29 08:05:13","true","[CI/CD] Update yaml file `./production/helm/loki/Chart.yaml` (+1 other) (#8923)

**Here is a summary of the updates contained in this PR:**
***
Update attribute `$.appVersion` in yaml file
`./production/helm/loki/Chart.yaml` to the following value: `2.7.5`
***
Bump version of Helm Chart
Add changelog entry to `./production/helm/loki/CHANGELOG.md`
Re-generate docs

Co-authored-by: Michel Hollands <42814411+MichelHollands@users.noreply.github.com>",84,59,1,0,"2018-04-16 10:25:39","1803.9"
"grafana/loki","64465035936f44e0521070a8fcd38d8b63807c6c","slim-bean","2019-05-08 14:11:36","false","Close all chunks before flushing.
Moved the check for already closed to make sure we honor this check when `immediate` flushing is requested",99,13,0,1,"2018-04-16 10:25:39","387.41"
"grafana/loki","2b145da7d798a1bbd1490e36a9c9fc1f845afeb6","slim-bean","2020-07-15 11:56:27","true","Canary tweaks (#2350)

* tweak the canary a bit, add a metric for websocket pings, fix some logging, improve the mutex locking a bit, add a read timeout on the websocket, add a lastmessage time checker to restart websocket

* fix constructor

* fix counter name
change metric count reporting to two separate metrics, expected vs actual

* add note to upgrade guide for metric name changes

* fixed tests....

* Update docs/operations/upgrade.md

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>",120,27,0,1,"2018-04-16 10:25:39","819.56"
"grafana/loki","0f10a549da4a8b1c379956ad6f63889a90aabe2a","owen-d","2021-09-30 13:30:26","true","Removes docker driver empty log line message (#4396)

Closes https://github.com/grafana/loki/issues/3384",139,41,0,1,"2018-04-16 10:25:39","1259.88"
"grafana/loki","254461ce8bb3875f9b7549d152301907b52746b7","owen-d","2022-07-12 11:43:35","true","[TSDB] store uncompressed chunk size in index (#6665)

* store uncompressed chunk size in index
Signed-off-by: Owen Diehl <ow.diehl@gmail.com>

* chunk data UncompressedSize for old metric compat
Signed-off-by: Owen Diehl <ow.diehl@gmail.com>",70,51,0,1,"2018-04-16 10:25:39","1547.05"
"grafana/loki","03aab3decac56e80fd7d3b0ff1890a7c592ca215","owen-d","2021-05-06 20:32:22","true","better operational dashboard annotations via diff logger (#3697)",185,37,0,1,"2018-04-16 10:25:39","1116.17"
"grafana/loki","607ccc4d776a97eb75795a858f62ed6c34da6afa","owen-d","2020-10-15 21:01:29","true","Service discovery refactor (#2761)

* promtail sd loading refactor + tests

* flippin bools like flipper

* adds back base scrapeconfig test

* passes all service discovery variants",115,30,0,1,"2018-04-16 10:25:39","909.94"
"grafana/loki","eeb1524c8c08703ff4bba51a18cb9c920bc26c9e","carehart","2021-09-22 20:14:22","true","Correct typo (#4357)",128,41,0,0,"2018-04-16 10:25:39","1252.16"
"grafana/loki","f72d2fba1054a67d7ccd955b584d36a36285f424","adityacs","2019-08-05 07:52:09","false","Readiness probe for Distributor",104,16,0,1,"2018-04-16 10:25:39","474.14"
"grafana/loki","38586f5b19cf1aec35a50741628f52de701f8468","slim-bean","2019-10-24 16:20:49","false","update versions to new release",68,18,0,1,"2018-04-16 10:25:39","553.5"
"grafana/loki","0ccd69c0edb91d70852c68fbf240679fc5f676dc","jeschkies","2023-01-31 13:41:25","true","Sizing tool: Display units. (#8333)",80,57,1,1,"2018-04-16 10:25:39","1746.14"
"grafana/loki","0fdbf24b792f8d3c4245dcd5a7eb1355249a9e2a","slim-bean","2019-02-14 20:39:12","true","adding third party lib for Glob pattern matching which supports /**/ style subdirectory matching (#331)

* adding third party lib for Glob pattern matching which supports **
refactor promtail_test to be easier to read and include more tests",87,10,0,1,"2018-04-16 10:25:39","298.43"
"grafana/loki","947428d77ea084c4989dd64e7e84fbeea40d021a","slim-bean","2019-04-01 18:45:57","false","Adding a check to make sure we don't set tailer offset past the end of the file.
Fixing lagging alert to also catch when the read_bytes is past the end of the file.
Adding an alert to let us know if we are missing tailing of any files.",96,11,0,1,"2018-04-16 10:25:39","345.35"
"grafana/loki","2dfac72835daa7ec7706bdb1828db4e16ae33eb9","jeschkies","2023-07-13 07:48:15","true","Clarify that label filter expressions are not supported in promtail. (#9894)

**What this PR does / why we need it**:
Some users of Promtail seem to be confused that certain types of filter
expressions are not supported in Promtail's `match` stage.

This change clarifies what kind of filter expressions are supported.

**Which issue(s) this PR fixes**:
Fixes #5209

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

---------

Co-authored-by: J Stickler <julie.stickler@grafana.com>",60,63,1,1,"2018-04-16 10:25:39","1913.14"
"grafana/loki","c1ca782dbd4fa3515ad7dcc107d1306224c64f33","periklis","2023-04-04 14:57:02","true","operator: Remove static placeholder suffix for openshift bundle (#8998)",81,59,1,1,"2018-04-16 10:25:39","1809.19"
"grafana/loki","66fdb3c5722f790ae6ee6f6e1544bbbb5fb99323","dannykopping","2022-08-02 10:00:15","true","Log stream flushes to see how many chunks we flush at a time (#6819)

* Log stream flushes to see how many chunks we flush at a time

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Smuggling in an error wrapping which aides debugging

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Update docs/sources/upgrading/_index.md

Co-authored-by: Ed Welch <ed@oqqer.com>

* Removing unnecessary label

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

Co-authored-by: Ed Welch <ed@oqqer.com>",76,51,0,1,"2018-04-16 10:25:39","1566.98"
"grafana/loki","6bf5b5d8c17c3f25413ea3df380edf8bc1965470","dannykopping","2022-10-04 11:47:10","true","Use a line-buffered logger to deamplify write syscalls (#6954)

We initialise a global logger in `pkg/util/log/log.go` and use it
extensively throughout the Loki codebase. Every time we write a log
message, a `write` syscall is invoked. Syscalls are problematic because
they transition the process from userspace to kernelspace, which means:

- a context-switch is incurred, which is inherently expensive ([1-2
microseconds](https://eli.thegreenplace.net/2018/measuring-context-switching-and-memory-overheads-for-linux-threads/))
- the goroutine executing the code is **blocked**
- the underlying OS thread (_M_ in the go scheduler model) is **also
blocked**
- the goroutine has to be rescheduled once the syscall exits
- the go scheduler may need to spawn additional OS threads if all are
blocked in syscalls - which can also be expensive

This change introduces the use of a line-buffered logger. It has a
buffer of
[256](https://gist.github.com/dannykopping/0704db32c0b08751d1d2494efaa734c2)
entries, and once that buffer is filled it will flush to disk. However,
a situation will arise in which that buffer remains somewhat empty for a
period of time, so there is a periodic flush mechanism, configured to
flush every 100ms. There is also a preallocated bytes slice of 10MB
which is reused, to avoid excessive slice resizing & garbage collection.

This does mean that we could lose up to 256 log messages in case of an
ungraceful termination of the process, but this would need to be
precisely timed within the 100ms flushes - in other words, the
likelihood is low, and generally we shouldn't `kill -9` any Loki
process.",92,54,1,1,"2018-04-16 10:25:39","1629.06"
"grafana/loki","b9e8ddbb1bb0af7b48bf42a65dae8e12cf212b7c","huikang","2020-10-05 17:53:45","true","Doc: fixing parameter name in configuration (#2716)

- http_path_prefix should be http_prefix

Signed-off-by: Hui Kang <kangh@us.ibm.com>",117,30,0,0,"2018-04-16 10:25:39","899.81"
"grafana/loki","d1a996afceb5cec91e616963f761028f804f36a3","mar4uk","2022-10-03 16:08:07","true","Added mapstructure tag to promtail configs structs (#7320)

Added mapstructure tags to configs structs to promtail client. It is
needed for
[opentelemetry-collector-contrib](https://github.com/open-telemetry/opentelemetry-collector-contrib).
I working on adding promtail receiver component there. Opentelemetry
collector decodes configs with mapstructure",92,53,1,0,"2018-04-16 10:25:39","1628.24"
"grafana/loki","b8221dc68fb9b4a6a4f8689dedb8ed4e76a5d10d","JStickler","2023-03-22 18:47:01","true","Correcting typos merged in #8870. (#8873)

**Which issue(s) this PR fixes**:
Fixes typos introduced in #8870",83,59,1,0,"2018-04-16 10:25:39","1797.35"
"grafana/loki","33a81528ec43d5c3e0a262a884467bb14266c304","Skeen","2020-05-01 16:12:49","true","fluent-plugin-loki: Restructuring and CI (#2006)

* Move fluentd/fluent-plugin-grafana-loki to cmd/fluentd

* Integrate fluentd with Makefile

* Added drone-ci job for fluentd

* Fix typo fluent-bit --> fluentd in .drone/drone.jsonnet

Co-authored-by: Cyril Tovena <cyril.tovena@gmail.com>

* Change default LOKI_URL in FluentD Dockerfile

Co-authored-by: Cyril Tovena <cyril.tovena@gmail.com>

* Utilize upstream configuration file

* Test setup, adapt default configuration

* Regen drone.yml

* Change default label to job=fluentd, rather than env=dev

Co-authored-by: Cyril Tovena <cyril.tovena@gmail.com>",121,25,0,0,"2018-04-16 10:25:39","745.74"
"grafana/loki","3b57ad2a5432f2d13a97b009762e91e8eadd0d2c","bboreham","2023-03-23 20:39:14","true","WAL: remove ePool that is unused (#8669)

**What this PR does / why we need it**:

Nothing is ever fetched from the pool - `GetEntries()` is never called.
And the loop to call `PutEntries()` follows a call where the slice it
ranges over is reset to empty, so that loop never added anything to the
pool.

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- NA Documentation added
- NA Tests updated
- NA `CHANGELOG.md` updated
- NA Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",82,59,1,0,"2018-04-16 10:25:39","1798.43"
"grafana/loki","543ea78b7ae38b6586f6c47a669bc888f36a8d42","MasslessParticle","2022-10-11 16:21:10","true","Add metrics to the distributor about stream sharding (#7390)

This PR adds some more metrics to the steam sharding interactions from
the Distributor.
1. `rate_store_stream_count`: The total number of streams
2. `rate_store_max_stream_shard_count`: The stream with the largest
number of shards
3. `rate_store_max_stream_rate_bytes`: The largest stream seen by a
distributor
4. `rate_store_refresh_duration_seconds`: A histogram of the latency to
query all the ingesters and process their rates",90,54,1,1,"2018-04-16 10:25:39","1636.25"
"grafana/loki","0db15efd50cbb4b6e29da4dbc121260d8f5949cb","MasslessParticle","2023-01-10 21:35:06","true","Add stream sharding docs (#7901)

This PR adds documentation for the new stream sharding feature.

Co-authored-by: Steven Dungan <114922977+stevendungan@users.noreply.github.com>",99,57,1,1,"2018-04-16 10:25:39","1725.46"
"grafana/loki","52bc0c64ae03e35d8e77569c7da82539398f6346","slim-bean","2022-04-07 20:20:46","true","2.5 changelog, release notes, and upgrade guide (#5819)

* update changelog

Signed-off-by: Ed Welch <edward.welch@grafana.com>

* update the upgrade guide

Signed-off-by: Ed Welch <edward.welch@grafana.com>

Update docs/sources/upgrading/_index.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* add release notes

Signed-off-by: Ed Welch <edward.welch@grafana.com>

Update docs/sources/release-notes/v2-5.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* udpate things to 2.5.0

Signed-off-by: Ed Welch <edward.welch@grafana.com>

* Update docs/sources/release-notes/v2-5.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* Update docs/sources/release-notes/v2-5.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* cleanout wierd changelog union stuff

Signed-off-by: Ed Welch <edward.welch@grafana.com>

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>",320,48,0,1,"2018-04-16 10:25:39","1447.16"
"grafana/loki","bf5a25dd5bf4be45ea47f7b286a195a0bffddc39","slim-bean","2022-08-26 19:36:01","true","Docs: update `split_queries_by_interval` documentation to have the correct explanation for how to disable. (#6715)

<!--  Thanks for sending a pull request!  Before submitting:

1. Read our CONTRIBUTING.md guide
2. Name your PR as `<Feature Area>: Describe your change`.
  a. Do not end the title with punctuation. It will be added in the changelog.
  b. Start with an imperative verb. Example: Fix the latency between System A and System B.
  c. Use sentence case, not title case.
  d. Use a complete phrase or sentence. The PR title will appear in a changelog, so help other people understand what your change will be.
3. Rebase your PR if it gets out of sync with main
-->

**What this PR does / why we need it**:
I noticed when responding to #5123 the docs did not correctly explain how to disable splitting queries by time. I searched through the code and confirmed `0` is the correct value to disable this feature

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

<!--
Note about CHANGELOG entries, if a change adds:
* an important feature
* fixes an issue present in a previous release, 
* causes a change in operation that would be useful for an operator of Loki to know
then please add a CHANGELOG entry.

For documentation changes, build changes, simple fixes etc please skip this step. We are attempting to curate a changelog of the most relevant and important changes to be easier to ingest by end users of Loki.

Note about the upgrade guide, if this changes:
* default configuration values
* metric names or label names
* changes existing log lines such as the metrics.go query output line
* configuration parameters 
* anything to do with any API
* any other change that would require special attention or extra steps to upgrade
Please document clearly what changed AND what needs to be done in the upgrade guide.
-->
**Checklist**
- [ ] Documentation added
- [ ] Tests updated
- [ ] Is this an important fix or new feature? Add an entry in the `CHANGELOG.md`.
- [ ] Changes that require user attention or interaction to upgrade are documented in `docs/sources/upgrading/_index.md`

Signed-off-by: Edward Welch <edward.welch@grafana.com>
Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>",81,52,0,1,"2018-04-16 10:25:39","1591.38"
"grafana/loki","623858df0df92e7b704c1f734e7b781983a41551","slim-bean","2020-08-24 18:55:08","true","creating release notes for 1.6.1",122,28,0,1,"2018-04-16 10:25:39","858.85"
"grafana/loki","591905ed646c73e2f60b076d0f6f30997e185aa6","slim-bean","2019-12-12 20:37:06","false","forgot to register the new metric

Signed-off-by: Edward Welch <edward.welch@grafana.com>",98,20,0,1,"2018-04-16 10:25:39","601.67"
"grafana/loki","fbcaa1d5d8d6018601a50122dbd436169325e7cb","jeschkies","2023-08-01 16:00:53","true","Lazily decode series protobuf. (#10071)

**What this PR does / why we need it**:
The protobuf decoding for series responses runs into a memory issue for
many series. The response is only merged and passed through the front
end. It is more efficient to decode the protobuf encoded series lazily.
And `decode`, `merge`, `encode` benchmark shows the benefit of
transcoding the protobuf series message into a JSON response directly.

This change will not impact production code since it only applies to
protobuf encoding messaging between the querier and query frontend that
must be explicitly enabled.

```
› go test -v -run=^$ -bench ""Benchmark_DecodeMergeEncodeCycle"" -memprofile memory_base.prof -count=10 ./pkg/querier/queryrange > before.txt
› go test -v -run=^$ -bench ""Benchmark_DecodeMergeEncodeCycle"" -memprofile memory_base.prof -count=10 ./pkg/querier/queryrange > before.txt
› benchstat before.txt after.txt
before.txt:5: missing iteration count
after.txt:5: missing iteration count
goos: linux
goarch: amd64
pkg: github.com/grafana/loki/pkg/querier/queryrange
cpu: AMD Ryzen 7 3700X 8-Core Processor             
                           │  before.txt  │              after.txt              │
                           │    sec/op    │   sec/op     vs base                │
_DecodeMergeEncodeCycle-16   2537.7m ± 2%   934.2m ± 1%  -63.19% (p=0.000 n=10)

                           │  before.txt   │              after.txt               │
                           │     B/op      │     B/op      vs base                │
_DecodeMergeEncodeCycle-16   1723.4Mi ± 0%   641.1Mi ± 0%  -62.80% (p=0.000 n=10)

                           │  before.txt   │              after.txt              │
                           │   allocs/op   │  allocs/op   vs base                │
_DecodeMergeEncodeCycle-16   20240.6k ± 0%   203.0k ± 0%  -99.00% (p=0.000 n=10)

```

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [x] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",53,63,1,1,"2018-04-16 10:25:39","1931.48"
"grafana/loki","b2f30ccd4a34e310074b73d9547f27a3bfc6bfc9","ashwanthgoli","2023-09-26 11:17:13","true","doc: log retention page improvements (#10665)

**What this PR does / why we need it**:
- Marks table manager as deprecated
- Use admonition shortcode for block quotes
- Adds description to stream_retention fields
- minor restructure

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",33,65,1,0,"2018-04-16 10:25:39","1986.29"
"grafana/loki","f52fc9d907a93853fb312233b916c1d305652f21","slim-bean","2022-06-01 15:35:37","true","Loki: add a run-once flag to the compactor (#6281)

* add a run once flag to the compactor to allow it to cleanup index files with a single manual invocation. Useful when using migrate tool.

Signed-off-by: Edward Welch <edward.welch@grafana.com>

* fix lint

Signed-off-by: Edward Welch <edward.welch@grafana.com>",72,49,0,1,"2018-04-16 10:25:39","1506.22"
"grafana/loki","45caba44591cf808639f0914b70328283fadbf7d","slim-bean","2022-10-25 18:41:46","true","Loki: Remove the bypass for ""limited"" queries  (#7510)

**What this PR does / why we need it**:

Limited queries are queries which don't have a filter expression. 

Now all log queries will be handled by the LogFilterTripperware which
will result in them being split by time (they previously were not)

Signed-off-by: Edward Welch <edward.welch@grafana.com>


**Which issue(s) this PR fixes**:

We've found that very large timeframe `limited` queries will be sent to
queriers and then ingesters and can stall out the read path because of
the large time ranges.

Splitting these by time avoids this problem by keeping any subquery
limited in length to the `split_by_interval`.

It's important to note that this will likely increase some extra work
done by limited queries as more work for these will be parallelized and
can result in extra data being processed. This will be the same as how
filter queries are handled now, so it will be no worse than that.

In fact this was an optimization based on the premise that it's
advantageous not to split/shard limited queries but we are seeing this
not be the case when limited queries are run over very large time ranges
matching streams with huge volumes and combined with parsers like `|
json`

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the `CONTRIBUTING.md` guide
- [ ] Documentation added
- [x] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

Signed-off-by: Edward Welch <edward.welch@grafana.com>",89,54,1,1,"2018-04-16 10:25:39","1650.34"
"grafana/loki","1d172a7eeb851f9939ad1d6e40c54e1686ace8c2","slim-bean","2023-10-18 09:25:09","true","Jsonnet: fix jsonnet from previous change (#10933)

**What this PR does / why we need it**:

I screwed up in a previous change #10894 , this should hopefully fix it.

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

Signed-off-by: Edward Welch <edward.welch@grafana.com>
Co-authored-by: Michel Hollands <42814411+MichelHollands@users.noreply.github.com>",21,66,1,1,"2018-04-16 10:25:39","2008.21"
"grafana/loki","8a95972f730c0133e19dccffdcba2e31a3e0117a","slim-bean","2019-10-09 17:02:11","true","Add some additional logging to the canary on queries (#1137)

* log what was missing from the websocket connection and what we received from a query to Loki to troubleshoot missing logs

* removing unnecessary unused return variables from print statements

* update test to handle the new debug output",68,18,0,1,"2018-04-16 10:25:39","538.53"
"grafana/loki","43ef2d85afac1e211fd7ccb9b0fa0a4a12a4cab9","slim-bean","2020-04-01 17:34:26","false","updating helm and ksonnet for 1.4.0 release

Signed-off-by: Edward Welch <edward.welch@grafana.com>",121,23,0,1,"2018-04-16 10:25:39","710.55"
"grafana/loki","b3af2dbeef2212b7ce0156ad28ff3354b8dd2f70","slim-bean","2022-02-15 13:08:32","true","Loki: include the component in metrics.go log line (#5379)

* add a component key to our metrics.go line

Signed-off-by: Edward Welch <edward.welch@grafana.com>

* new computer... who dis

Signed-off-by: Edward Welch <edward.welch@grafana.com>

* one more lint

Signed-off-by: Edward Welch <edward.welch@grafana.com>",288,46,0,1,"2018-04-16 10:25:39","1394.86"
"grafana/loki","726e4608d1022cef547a21808595091f2732f5e3","agologan","2022-11-08 23:05:12","true","[Helm] Create metricsInstance only if available (#7535)

**What this PR does / why we need it**:
If you're using prometheus operator and not Grafana Agent a
metricsInstance shouldn't be auto-created.

**Which issue(s) this PR fixes**:
#7529",85,55,1,0,"2018-04-16 10:25:39","1663.53"
"grafana/loki","ec35db458beae3db3c3568cdf5999df0d588102b","JStickler","2023-08-17 13:59:56","true","Update broken links (#10276)",52,64,1,0,"2018-04-16 10:25:39","1947.4"
"grafana/loki","1d04cd5e317dc6696f61ffa62119f201129f33fa","salvacorts","2023-07-24 08:31:11","true","Metadata to labels result and filtering support (#9702)

**What this PR does / why we need it**:
In #9700, we support encoding and decoding metadata for each entry into
the chunks. This PR adds support for returning metadata labels for
matching entries in a query to the returned LabelResults. It also
supports filtering out logs by metadata labels.

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [x] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

---------

Co-authored-by: Sandeep Sukhani <sandeep.d.sukhani@gmail.com>",54,63,1,1,"2018-04-16 10:25:39","1924.17"
"grafana/loki","520e434446e4c646ecc2678f3c3b57fff69643cc","cuishuang","2023-05-06 14:25:47","true","fix function names in comments (#9415)",81,61,1,0,"2018-04-16 10:25:39","1846.42"
"grafana/loki","c3c9ac7740277c30179118ffac2a0a5bbeda7ce1","bboreham","2023-02-01 09:25:44","true","Cosmetic lint warning fixes (#8363)",79,57,1,0,"2018-04-16 10:25:39","1745.96"
"grafana/loki","68ef8f4dabe9ce4bc6bd8c44781c5074cc82c553","KMiller-Grafana","2021-09-22 13:06:45","true","Docs: Remove wording like ""As of version 1.6, you can..."" (#4363)

- We give readers versioned documentation (now), so they don't need to know what version a feature appeared in.
- I couldn't resist fixing some grammar formatting and phrasing in the sections that needed changes.",127,41,0,0,"2018-04-16 10:25:39","1251.86"
"grafana/loki","cd919f70eb2a17eda2f738538273686f2094eb76","thepalbi","2022-10-06 06:56:54","true","Adding Promtail and Heroku blogpost files to `examples/` (#7347)",92,54,1,0,"2018-04-16 10:25:39","1630.86"
"grafana/loki","0afd113c966d8750c32a072fb94b861b294cbc7f","sandeepsukhani","2022-02-09 13:08:14","true","fix rounding of time to milliseconds (#5352)

Current implementation of RoundToMilliseconds is broken due to improper handling of floating point operation in go.
Fixing it by using simple division and modulo operators",282,46,0,1,"2018-04-16 10:25:39","1388.86"
"grafana/loki","9658f3dbd8fb19f42a9d826915cbc434cafdb906","tomwilkie","2018-11-19 18:21:52","false","Don't commit generated files.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",5,7,0,0,"2018-04-16 10:25:39","213.33"
"grafana/loki","a5fbc7cff418b06c62c6df2dd90d969e30498c41","JStickler","2023-02-09 11:38:52","true","Updated CONTRIBUTING file for docs. (#8431)",78,58,1,0,"2018-04-16 10:25:39","1754.05"
"grafana/loki","34915c7bd745e11d0327cca33aec7ed0db233a7d","JStickler","2023-10-17 15:54:59","true","Spell out Kubernetes in docs (#10922)

Developers tend to abbreviate ""Kubernetes"" to just K8, but as a best
practice it should be spelled out in the documentation.",21,66,1,0,"2018-04-16 10:25:39","2007.48"
"grafana/loki","e372383f0de00ab0393308aa8c79037990611206","cstyan","2022-08-09 21:54:31","true","don't deploy consul if we're using memberlist and not actively migrating (#6836)

from consul to memberlist

Signed-off-by: Callum Styan <callumstyan@gmail.com>",74,52,0,1,"2018-04-16 10:25:39","1574.48"
"grafana/loki","272ebdec3cfab2c73628264714b1ece217af9177","MichelHollands","2023-02-22 08:51:21","true","Update build image to go 1 20 1 and alpine 3 16 4 (#8575)

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>
Signed-off-by: Christian Haudum <christian.haudum@gmail.com>
Co-authored-by: Christian Haudum <christian.haudum@gmail.com>",68,58,1,1,"2018-04-16 10:25:39","1766.93"
"grafana/loki","8e79c3a1a9280ab91b832df1d7506008bddffdc6","owen-d","2023-09-22 18:50:19","true","[sharding] [bugfix] Correctly account for child groupings in count/min/max sharding (#10687)

Previously, we didn't always consider that some label reductions from
downstream vector|range-vector aggregations come from groupings. This is
particularly useful in the min/max/count sharding mapper.

edit: also fixes an issue with the range extractor mishandling `without
()` as `by ()`",34,65,1,1,"2018-04-16 10:25:39","1982.6"
"grafana/loki","9e9252825a499a51e486ae49147bd7777a7d15e9","owen-d","2021-10-22 18:41:48","true","Jsonnet/overrides exporter (#4530)

* adds overrides-exporter jsonnet

* default overrides exporter to disabled

* fixes exporter name for k8s compat

* add exporter svc for http metrics",164,42,0,1,"2018-04-16 10:25:39","1282.09"
"grafana/loki","a5652c80272069a567c7e5d2e6b903c9a19fcdd4","chaudum","2023-03-01 06:57:55","true","Clean up scheduler code to prepare upcoming changes (#8643)

In preparation of https://github.com/grafana/loki/pull/8585 this PR contains some cleanups.

Changes in this PR do not change the implementation, but only rename functions and data structures to make them more generic and/or suitable for extending.

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",70,58,1,1,"2018-04-16 10:25:39","1775.86"
"grafana/loki","3054d643774f1dc805770de8e4cfddbacbec3794","kavirajk","2021-01-19 13:11:58","true","doc(gcplog): Fix titles for Cloud provisioning for GCP logs (#3190)",110,33,0,1,"2018-04-16 10:25:39","1003.62"
"grafana/loki","0ab1b28812ec44a9ece076c5144992f2bc69a8a6","slim-bean","2020-04-29 20:50:40","true","Loki: Improve logging and add metrics to streams dropped by stream limit (#2012)

* Improve the log message when we drop streams because a user is hitting a stream limit.
Increment the dropped samples metrics when this happens also.

Signed-off-by: Ed Welch <edward.welch@grafana.com>

* improving comments

Signed-off-by: Ed Welch <edward.welch@grafana.com>",116,24,0,1,"2018-04-16 10:25:39","743.93"
"grafana/loki","a9ac01bd0f22ab4e27d39964a0a86f9d47ae93b0","slim-bean","2022-04-04 13:16:42","true","use an empty registry when setting up the logger for the push server (#5761)

Signed-off-by: Ed Welch <edward.welch@grafana.com>",319,47,0,1,"2018-04-16 10:25:39","1443.87"
"grafana/loki","34a4b242bf1de7eae3f8f6594253adccf8de05cd","slim-bean","2022-01-12 18:05:52","true","Update to 2.4.2 release (#5121)

* update project to 2.4.2 release

Signed-off-by: Edward Welch <edward.welch@grafana.com>

* go.mod cleanup

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

Co-authored-by: Kaviraj <kavirajkanagaraj@gmail.com>",262,45,0,1,"2018-04-16 10:25:39","1362.07"
"grafana/loki","ce407d3276292fb5b225867a66617903f1a808f8","pracucci","2020-01-09 22:15:32","false","Add ingestion rate global limit support (#1486)

* Added ingestion rate global limit support

Signed-off-by: Marco Pracucci <marco@pracucci.com>

* Fixed code comments

Signed-off-by: Marco Pracucci <marco@pracucci.com>

* Updated config doc

Signed-off-by: Marco Pracucci <marco@pracucci.com>

* Updated changelog

Signed-off-by: Marco Pracucci <marco@pracucci.com>

* Updated doc

Signed-off-by: Marco Pracucci <marco@pracucci.com>",101,21,0,0,"2018-04-16 10:25:39","628.74"
"grafana/loki","9137ef921bf97acdf1beb7e15506dd5a2bbc4331","MichelHollands","2021-04-22 12:36:06","true","Update cortex to 1.8 (#3627)

* Update Cortex to 1.8.1

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Tidy up

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Update changelog

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",167,36,0,1,"2018-04-16 10:25:39","1101.84"
"grafana/loki","61fc17536120bcbc201d16a0032aad0375cbfca2","owen-d","2020-06-05 20:20:24","true","Fix vector-scalar comparisons (#2189)

* fmts shards in instance logger

* vector-scalar comparisons now filter by default

* gofmt",131,26,0,1,"2018-04-16 10:25:39","779.91"
"grafana/loki","e14463b2a308d2cd527160e407faf3be71854e46","beorn7","2020-11-24 08:51:34","true","Improve promtail alerts to retain the namespace label (#2976)

The `PromtailFileMissing` should actually work in this simplified
form. Please let me know if I'm missing something.",113,31,0,0,"2018-04-16 10:25:39","948.43"
"grafana/loki","133121493991b2f3e1bf8857e4499539594e0488","cyriltovena","2022-04-13 19:21:33","true","Fixes a panic when response is nil in the index-gw (#5910)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",321,48,0,1,"2018-04-16 10:25:39","1453.12"
"grafana/loki","bac3afe34c5db3ea504fd75b8b191ae3536e5099","cyriltovena","2020-02-24 20:03:03","true","Add overrides file for our jsonnet library. (#1705)

* Add overrides files for our jsonnet library.

This will now automatically load up overrides for tenants if any for each component.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add quotes on the tenant example.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Mount overrides with a different path than the config.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",117,22,0,1,"2018-04-16 10:25:39","673.65"
"grafana/loki","72b3acb925c2d21f3a18314e160ff601789b866c","cyriltovena","2021-02-02 12:37:51","true","Windows events (#3246)

* First commit for windows event targets.

I had to add couple of new go modules and hook the windows log in.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add the ability to save where we are.

* Finished setup tests and comments.

* nits

* adding documentation

* go tidy

* lint windows

* nope

* add manager for non windows

* don't lint forked package

* mod check

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Update pkg/promtail/targets/windows/bookmark.go

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>

* Use passed-in Prometheus registerer.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Apply suggestions from code review

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>

* testing out windows drone.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* type exec.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* docker image.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* go/go.exe

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* build windows on container.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* trying another image.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* typo in image

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixed local timezone issue.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fix tests with timezone.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes timezone tests.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Update logstash since the last image is not working anymore :shrug:

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>",123,33,0,1,"2018-04-16 10:25:39","1016.59"
"grafana/loki","b58e9cdee2d1e02c57cddab9b2ffccb5907a3d40","owen-d","2021-07-19 07:20:38","true","fixes a badly referenced variable name in StepEvaluator code (#3996)",106,39,0,1,"2018-04-16 10:25:39","1188.62"
"grafana/loki","ff39654a9996388349c72fcaeed20309acda316e","chaudum","2023-02-16 14:59:12","true","Fix regression in lambda-promtail tool that yields incorrect label names (#8547)

Commit https://github.com/grafana/loki/commit/4d5678aa17feb3c9a4f503c171fa115eafe4e182#diff-c898e72f3b15b46b32f9405b243b7d5b56b68db7bf03541fefd587dc9e49af8eL70-R90 introduced a regression that caused labels to have duplicate `_lb` parts in the label names, as described in https://github.com/grafana/loki/issues/8470

Fixes #8470

Also updated Loki to the latest commit on `main`. Previously the dependency pointed to a Git commit that was out of the tree of this repository.",73,58,1,1,"2018-04-16 10:25:39","1761.19"
"grafana/loki","0116aa61c86fa983ddcbbd5e30a2141d2e89081a","owen-d","2021-11-11 20:43:28","true","ensures components with required SRV lookups use the correct port  (#4737)

* ensures components with required SRV lookups use the correct port naming (_grpclb prefix)

* Update production/ksonnet/loki/query-frontend.libsonnet

Co-authored-by: Ed Welch <ed@oqqer.com>

Co-authored-by: Ed Welch <ed@oqqer.com>",194,43,0,1,"2018-04-16 10:25:39","1301.18"
"grafana/loki","e52e8051447726f69d426df3f79fac3cb1384524","owen-d","2021-11-07 23:54:13","true","Adds replication_factor doc to common config (#4683)

Oops, looks like we missed adding this to the configuration docs.",178,43,0,1,"2018-04-16 10:25:39","1297.31"
"grafana/loki","8b15632dd8e584c04facd48a1cbe26aa807516e3","kavirajk","2022-05-03 09:17:58","true","Fix(query-frontend): LokiCodec encode/decode works correctly with label values endpoint (#6084)

When encode/decode `http.Request` into `querybase.Request` we re-create request.Path.

Before this PR, both `/labels/` and `/labels/{name}/values` endpoint was decoding into same URL path `/labels/` before
forwarding to the querier. So it always returns label names as response.

This bug became visible after enabling all the middleware for `/labels/{name}/values` endpoint as well via #6072

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",74,49,0,1,"2018-04-16 10:25:39","1477.95"
"grafana/loki","797d4bce4590e1df78e4670526647072b0e03efe","DylanGuedes","2023-01-23 17:50:55","true","Loki: Log hashed queries emitted by `metrics.go` (#8244)

- What this PR does / why we need it:
* Adds a new `query_hash` label pair to queries logged by `metrics.go` and our query engine. As the name suggests, `query_hash` is just the hashed version of the query being logged.
    * Especially useful when grouping results/behavior of different queries. Ex, you can easily find specific query patterns with `sum by(query_hash) (...)` .",83,57,1,1,"2018-04-16 10:25:39","1738.31"
"grafana/loki","f41273182c148e330ec549871b0f10915b2e801a","adityacs","2020-03-26 19:36:35","true","Support configurable maximum of the limits parameter (#1798)",122,23,0,1,"2018-04-16 10:25:39","705.63"
"grafana/loki","3bcc7ccd5a5d6c94bb85b90b153c46a3ba130f7e","lxwzy","2022-11-07 11:22:35","true","use fifocache.duration instead of fifocache.interval in warn deprecated (#7609)

**What this PR does / why we need it**:
I configured fifo cache with `validity` option (which is
[deprecated](https://github.com/grafana/loki/blob/b92f113cb0961b628b643f4f3f9fddc1c18ed921/docs/sources/configuration/_index.md?plain=1#L2004)
in v2.6.0, `fifocache.duration` as an flag) and loki print that:

```
level=warn ts=2022-07-08T17:01:30.134251284Z caller=fifo_cache.go:125 msg=""running with DEPRECATED flag fifocache.interval, use fifocache.ttl instead"" cache=frontend.fifocache
```

However, there is no flag `fifocache.interval`.
As #5148 changed, the deprecated flag should be `fifocache.duration`,
not `fifocache.interval`.",88,55,1,0,"2018-04-16 10:25:39","1662.04"
"grafana/loki","9f7f8211946a5f76c8b7addaa3b8e0346222c3f5","paul1r","2023-09-13 15:31:45","true","Update version of loki referenced in docker files to 2.9.0 (#10564)

This PR updates the version of Loki used by our sample Dockerfiles to
the most recent version of 2.9.0.",39,65,1,0,"2018-04-16 10:25:39","1973.46"
"grafana/loki","11f490622399a4995a4822d218bb8c5f085bc55e","paul1r","2023-08-29 21:10:27","true","Publish tagged images of loki-canary-boringcrypto (#10386)

**What this PR does / why we need it**:
Examining the images contained in the loki-canary repo (
https://hub.docker.com/repository/docker/grafana/loki-canary/tags?page=1&ordering=last_updated
) compared to the loki-canary-boringcrypto repo (
https://hub.docker.com/repository/docker/grafana/loki-canary-boringcrypto/tags?page=1&ordering=last_updated
), it appears that the explicitly tagged images (such as 'main') are not
being sent to the boringcrypto repo.

This PR is to adjust that behavior so that both repos receive the same
number of builds (one will be boringcrypto enabled, the other will not
be)

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",48,64,1,0,"2018-04-16 10:25:39","1959.7"
"grafana/loki","a1745c7b47d07c562a208e1273f629d5cc449ed4","chaudum","2022-06-30 13:50:02","true","Do not fail queries if compactor returns unexpected status code (#6552)

To avoid showing deleted data, the querier originally failed when
deletes were unavailable. If the compactor becomes unavailable this can
cause Loki to stop responding to queries altogether. This PR changes the
querier to log an error but continue servicing the request when it fails
to get deletes.

Extends PR #6368

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",73,50,0,1,"2018-04-16 10:25:39","1535.14"
"grafana/loki","e6fb32b214740cf56da1a697c671e21b0b788eeb","trevorwhitney","2023-02-08 15:42:04","true","[helm] Bump to Loki 2.7.3 (#8445)",76,58,1,1,"2018-04-16 10:25:39","1753.22"
"grafana/loki","f755c5901169721d9fd0451704b46c241b1b4c8b","flouthoc","2019-09-25 15:07:53","false","Fix Docs: Change Imagepull policy to IfNotpresent / Add loki-canary base manifests (#1053)",69,17,0,1,"2018-04-16 10:25:39","524.45"
"grafana/loki","dca8a4fb1753ccbe2f885e57fba3a21eb7c74054","ctrox","2019-09-05 12:41:37","false","Use ticker instead of timer for batch wait

Fixes #280",123,17,0,0,"2018-04-16 10:25:39","504.34"
"grafana/loki","ba95f80e5a7c5f23d721f702f2cbde90432b6619","JStickler","2023-10-03 14:13:16","true","Fix graphic link in Deployment Modes topic (#10778)

Linked to the same graphic twice by accident. Fixing the link to point
to the correct graphic file.",28,65,1,0,"2018-04-16 10:25:39","1993.41"
"grafana/loki","58219ff464623a9f48929f7005c55eeb4b22342e","eamonryan","2021-09-07 18:53:20","true","Updated license path argument name (#4259)",123,41,0,0,"2018-04-16 10:25:39","1237.1"
"grafana/loki","61daaaa49818fcd6f551d205c7613516283ac03b","ronensc","2022-03-07 12:40:41","true","operator: Add flag to create Prometheus rules (#5345)",299,47,0,0,"2018-04-16 10:25:39","1416.84"
"grafana/loki","b5563cee08aad61d95b19595393fcca6f3dd67dc","AndersBennedsgaard","2022-11-30 11:36:29","true","[Helm] Remove unused value and set default values explicitly (#7576)

**What this PR does / why we need it**:
`monitoring.alerts` are not used in the Loki Helm chart. This removes
it.
Furthermore, some values are referenced in the templates, but not used
in the values file. This adds the default values.

**Which issue(s) this PR fixes**:
Fixes #7575

**Special notes for your reviewer**:

https://github.com/AndersBennedsgaard/loki/blob/main/production/helm/loki/templates/single-binary/pdb.yaml#L15
should probably also be updated since `podDisruptionBudget` is not
referenced in the values file. However, I am unsure what default values
should be used.

https://github.com/AndersBennedsgaard/loki/blob/main/production/helm/loki/templates/networkpolicy.yaml#L124
should probably also be updated since the `loki.rulerSelectorLabels` is
not a valid helper function. However, I am unsure which selector labels
to use. Especially since it seems like `ruler` is not used. Perhaps any
reference to `ruler` should be removed?

**Checklist**
- [x] Reviewed the `CONTRIBUTING.md` guide
- [x] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",93,55,1,0,"2018-04-16 10:25:39","1685.05"
"grafana/loki","0da462558fa4789bddd9df48ef62fd76576f9c5f","paul1r","2023-06-23 19:49:12","true","Migrate individual chunks as opposed to all chunks.   (#9780)

This way, if an error occurs, we get as much as we can.

**What this PR does / why we need it**:
In some situations, not all blob data may be accessible. For instance,
in the case where we have started migration between object storage
buckets, some data may be in the old bucket. If we wanted to migrate
data from the new bucket, those chunks will error with a 404, as they
are in the old bucket.

This PR is so that we continue on and get all of the chunks that we can,
rather than stopping with whatever error may arise.


**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",61,62,1,0,"2018-04-16 10:25:39","1893.64"
"grafana/loki","1f1dd81555847134a5e923a29a44032eb1f296e0","MarNicGit","2022-11-10 10:46:21","true","Promtail: Exclude event message (#7462)

**What this PR does / why we need it**:
Windows Event Logs have an Event Message field that is intended for
human eyes, and often contains data that already present in the event
data XML. Omitting this field the same way we can already omit
`user_data` and `event_data` can easily save a lot of bytes of data per
event - Event ID 4264 alone has ~2KB of just text that is already
present in `event_data`.

**Which issue(s) this PR fixes**:
Fixes #7395 

**Special notes for your reviewer**:
I also took the liberty to improve upon the existing test
'`Test_renderEntries` by using unique values for each field rather than
10's everywhere. I expect this to conflict with my other PR, #7461.",84,55,1,0,"2018-04-16 10:25:39","1665.01"
"grafana/loki","88e2705034ac97fd15017d5dbffe374999ccdef9","simonswine","2022-08-12 16:43:23","true","Update alpine and golang base images (#6897)

* Upgrade base images to alpine 3.15.6 everywhere

https://alpinelinux.org/posts/Alpine-3.13.12-3.14.8-3.15.6-3.16.2-released.html

* Update golang images to 1.18.5",83,52,0,0,"2018-04-16 10:25:39","1577.26"
"grafana/loki","62f5e598ddcf99544aa97abcc483ff7db7fda6f5","sandeepsukhani","2022-05-18 14:04:27","true","tsdb index gateway (#6158)

* enable new grpc calls on index gateway and add GetSeries call

* use index gateway for tsdb index store queries

* add missing file

* lint

* disable IndexGatewayClientStore for stores other than tsdb until we are ready to enable it again",73,49,0,1,"2018-04-16 10:25:39","1493.15"
"grafana/loki","fa25e54e26f9f0c308ccf172561cfbd71afa32d1","cyriltovena","2022-01-25 12:19:16","true","Bump logstash plugin gem (#5230)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",272,45,0,1,"2018-04-16 10:25:39","1374.83"
"grafana/loki","fc49a87d99d1678e8ed59295f9b332f4a96569bb","cyriltovena","2022-01-12 08:49:03","true","Fixes HTTP2 removal for GCS (#5103)

* Fixes metric name for hedging object store requests

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Only allow to disable http2 for GETs

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes http2 removal

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Address review feedback

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Address review feedback

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",257,45,0,1,"2018-04-16 10:25:39","1361.68"
"grafana/loki","c33a6516457de8c231b49b92286c22cad3f43dc1","cyriltovena","2021-12-03 09:32:59","true","Add rate limiting and metrics to hedging (#4860)

* Add rate limiting and metrics to hedging

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add changelog entry

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Allow to pass a custom registerer

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",214,43,0,1,"2018-04-16 10:25:39","1322.71"
"grafana/loki","922f1daf5d1780c3b96b0cb7b150f1fe65379262","cyriltovena","2019-06-04 12:28:47","true","Remove label __name__ from store querier (#648)",109,14,0,1,"2018-04-16 10:25:39","413.34"
"grafana/loki","2d24e2ea64076755339275aa952fb8320fa2863e","ssncferreira","2021-11-04 14:29:52","true","Migration to dskit/ring (#4641)",170,43,0,0,"2018-04-16 10:25:39","1293.92"
"grafana/loki","0706b537ffd8aa1cfdcf803f6a8066b3aff85f0e","periklis","2021-10-19 14:17:36","true","Fix upstream calls to Loki using server-side TLS when provided (#97)",159,42,0,1,"2018-04-16 10:25:39","1278.91"
"grafana/loki","8bd9f752aa8ee53129d3f5cd68c3e3fec1e32855","cyriltovena","2019-07-25 19:45:49","false","Adds more tests for range queries",103,15,0,1,"2018-04-16 10:25:39","464.64"
"grafana/loki","96947765375417d38a78069973c457c1a846f2c0","andretadeu","2022-08-19 14:10:07","true","docs:Add documentation for TLS configuration parameters for HTTP and gRPC (#6933)

* Add documentation for TLS configuration parameters for HTTP and gRPC.

* Removed possible values from client-auth parameters.",82,52,0,0,"2018-04-16 10:25:39","1584.16"
"grafana/loki","2b5f3000b621a78937b9f89f79e091f7e49e1403","slim-bean","2021-10-21 20:46:33","true","Loki: Add a ring to the query scheduler to allow discovery via the ring as an alternative to DNS (#4424)

* Fork the frontend and scheduler so we can add support for discovery via the ring.

* Add a ring to the query scheduler which is then used by the frontend worker and querier workers to find the scheduler address as an alternative to using DNS

* update some of the forked code to use dskit grpcclient and grpcutil since #4312 was merged after the original fork was created.

* remove query scheduler dependency from querier

Signed-off-by: Trevor Whitney <trevorjwhitney@gmail.com>

* migrate logging package and make linter happy

Signed-off-by: Trevor Whitney <trevorjwhitney@gmail.com>

* add SafeReadRing for instances when scheduler is not enabled on same instance

* Doc changes from code review

A few doc fixes

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* go mod tidy on go-kit dep

* update changelog

* remove ReadRing in favor of SafeReadRing

Co-authored-by: Trevor Whitney <trevorjwhitney@gmail.com>
Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>",165,42,0,1,"2018-04-16 10:25:39","1281.18"
"grafana/loki","00f494e536654b9c16bb2a27f7d43b1ca9752217","slim-bean","2020-08-13 18:09:31","true","updating images to 1.6.0 (#2504)",119,28,0,1,"2018-04-16 10:25:39","847.82"
"grafana/loki","4e421206f08db6d59f513f8a85fe72d70ef05d29","slim-bean","2022-04-11 17:30:57","true","Docs: Add usage reporting section to 2.5 release notes (#5865)",322,48,0,1,"2018-04-16 10:25:39","1451.05"
"grafana/loki","17419c69cad74ae83ab409210adfa8c8cd482172","slim-bean","2019-05-15 17:19:17","false","adding diagram",100,13,0,1,"2018-04-16 10:25:39","394.54"
"grafana/loki","fa56f00517fc8079e95acb864c5b18221d2c9518","trevorwhitney","2023-04-05 17:16:14","true","These features did not make the release (#9025)

**What this PR does / why we need it**:

These features did not actually make it into this release.",82,59,1,1,"2018-04-16 10:25:39","1810.29"
"grafana/loki","40f56c629134e8f29e6617320432247bd15a5865","AndreZiviani","2022-01-12 12:37:22","true","Docs: Fix documentation with correct default values and add missing options (#4792)

* update docs with correct default values and add missing options

Signed-off-by: Andre Ziviani <andrepziviani@gmail.com>

* fix typo

Signed-off-by: Andre Ziviani <andrepziviani@gmail.com>

* fix typo

Signed-off-by: Andre Ziviani <andrepziviani@gmail.com>

* add another missing option

Signed-off-by: Andre Ziviani <andrepziviani@gmail.com>

* Update docs/sources/configuration/_index.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* Update docs/sources/configuration/_index.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* Update docs/sources/configuration/_index.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* rephrase querier_forget_delay option

* remove duplicated option

* rephrase max_streams_per_user option

* fix typo

* Update docs/sources/configuration/_index.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* Update docs/sources/configuration/_index.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* fix wrong values

* standardize boolean naming

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>",259,45,0,0,"2018-04-16 10:25:39","1361.84"
"grafana/loki","bb0ca00923c3ead046cbf38791751103e1e78d3a","tomwilkie","2018-04-17 15:45:04","true","Merge pull request #3 from grafana/iterator-tests

Add some unit tests for the iterators.",0,0,0,0,"2018-04-16 10:25:39","1.22"
"grafana/loki","54edb2143f9dbf8280e1cfa1c8efbfef1bb3e5bb","salvacorts","2023-11-10 15:50:07","true","Followups #11154 (#11204)

Addressing comments from #11154 after it was merged",0,67,1,1,"2018-04-16 10:25:39","2030.48"
"grafana/loki","00cf3133e3a513102d13c92276e3f891ffc6b57d","vlad-diachenko","2023-06-27 13:00:29","true","disabled indexGateway client for boltdbShipper in migration tool. (#9809)

**What this PR does / why we need it**:
Without this fix, the migration tool tries to initialize the
ingexGateway client, which is unreachable.
This leads to the error:
`Failed to create source store: error creating index client: index
gateway grpc dial: failed to build resolver: passthrough: received empty
target in Build()`",61,62,1,0,"2018-04-16 10:25:39","1897.36"
"grafana/loki","a1c20093b523599d23df15fa053c288393f04655","MattiasSegerdahl","2023-05-01 08:24:12","true","Update automatic-stream-sharding.md (#9323)

**What this PR does / why we need it**:

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",79,60,1,0,"2018-04-16 10:25:39","1841.17"
"grafana/loki","e18b4fca6f78c63020b7831b5986fb7d123366fa","kavirajk","2023-01-20 13:40:25","true","ingester: Add `ingester_memory_streams_labels_bytes` metric (#8212)

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

This is to give visibility on `labels` size of in-memory streams on the
ingesters.

It caculate the size of labels via `len(labels.String())`. Meaning if
you have
```go
	lbs := labels.Labels{
		{Name: ""foo"", Value: ""bar""},
		{Name: ""instance"", Value: ""loki""},
	}
```
size would be number of bytes in `{foo=""bar"", instance=""loki""}` which is
`28`. NOTE: `len(string)` gives [bytes length in
Go](https://pkg.go.dev/builtin#len)",83,57,1,1,"2018-04-16 10:25:39","1735.14"
"grafana/loki","fc8c4f05923150c7e68d35b873af5e9f1191ac03","slim-bean","2022-04-28 11:58:49","true","Loki: Add a configurable ability to fudge incoming timestamps for guaranteed query sort order when receiving entries for the same stream that have duplicate timestamps. (#6042)

* Add a per tenant ability to fudge duplicate timestamps in the distributor

Signed-off-by: Edward Welch <edward.welch@grafana.com>

* update docs

Signed-off-by: Edward Welch <edward.welch@grafana.com>

* lint

Signed-off-by: Edward Welch <edward.welch@grafana.com>

* update changelog

Signed-off-by: Edward Welch <edward.welch@grafana.com>",120,48,0,1,"2018-04-16 10:25:39","1473.06"
"grafana/loki","f9a2c436aca705792c4e04483313614897042cfd","cyriltovena","2020-05-19 19:44:23","true","Adds backtick for the quoted string token lexer. (#2095)

* Fixes unit in stats request log. (#2093)

* Fix unit conversion in stats log.

🤦

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fix the tests because you know ! you know ?

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

wip

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add backtick for the quoted  string token lexer.

This allows to pass unescaped string to Loki.

For example we now support this :

`` {name=""cassandra""} |~  `error=\w+` ``
`` {name!~`mysql-\d+`} ``

As you can see no escape is required when using ` quoted strings.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes newlines.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add back missing test.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",119,25,0,1,"2018-04-16 10:25:39","763.89"
"grafana/loki","21e61315df606fc75af75e00638eea70c011c256","cyriltovena","2022-01-10 18:53:25","true","LogQL: add __line__ function to | line_format template (#4879)

* LogQL: add __line__ function to | line_format template

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* add changelog entry

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Update docs/sources/logql/template_functions.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* Clone the function map to avoid a race between multiple expr

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>
Co-authored-by: Owen Diehl <ow.diehl@gmail.com>",253,45,0,1,"2018-04-16 10:25:39","1360.1"
"grafana/loki","b9c9394dc1f8f7fa885306948393750b08bb10d2","jeschkies","2023-09-21 15:50:06","true","Define sketches for quantiles. (#10659)",33,65,1,1,"2018-04-16 10:25:39","1981.48"
"grafana/loki","cc1b0dbc24a10c4746f9095b6529c77c543337d9","MasslessParticle","2023-09-07 15:26:04","true","Don't use unsafe string for label names in the UnpackParser (#10487)

We've had [some reports](https://github.com/grafana/loki/issues/8936)
that `unpack` is mangling label names. We're using `unsafeGetString` to
generate these so, when the underlying byte slice changes, the label
name is also changed. This change incurs an alloc to make sure the
generated string wont change when the underlying bytes do.

fixes #8936",44,65,1,1,"2018-04-16 10:25:39","1967.46"
"grafana/loki","c4eb8c87ed312119015963f960dc29926c6a697c","jeschkies","2022-12-12 20:59:27","true","Remove duplicate sizing tool (#7917)

**What this PR does / why we need it**:
The sizing tool was checked in twice. Also, there was a function error
in fetching the nodes.

**Checklist**
- [ ] Reviewed the `CONTRIBUTING.md` guide
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",99,56,1,1,"2018-04-16 10:25:39","1697.44"
"grafana/loki","3990b13a25d4cad92437b43c6dc2fadaa837cc35","trevorwhitney","2022-09-07 20:01:00","true","Only release helm for helm paths (#7093)

**What this PR does / why we need it**:

Only need to run the helm release action when helm paths were changed",85,53,1,1,"2018-04-16 10:25:39","1602.4"
"grafana/loki","3c5fdb749a9c0a49883f843d3dd98c7bf0284f81","sandeepsukhani","2022-08-12 09:53:20","true","add metric for measuring overall index query latency (#6880)",82,52,0,1,"2018-04-16 10:25:39","1576.98"
"grafana/loki","dc185f6ac20b05fffe1e6c20a4eb8a3d5135affe","bboreham","2022-05-31 07:50:02","true","Fix wording about pattern parser (#6264)

The last sentence was saying the opposite of what it meant.
Also fix 'start' to match singluar 'expression'.",73,49,0,0,"2018-04-16 10:25:39","1505.89"
"grafana/loki","66b1d2c82295bc6b36edc3d0fc0b83f77a8e15f3","dannykopping","2021-09-10 10:14:52","true","Reimplementing change from @jacobsakran (#4310)

I merged their change before the CLA was signed. We reverted that in #4299 and now I'm reopening

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",131,41,0,1,"2018-04-16 10:25:39","1239.74"
"grafana/loki","bdfa240647dd5016545d8a032905cbd79b130a7d","JStickler","2023-09-14 17:30:01","true","[Docs] Fix 404s/broken links in main branch (#10556)

Cleaning up broken links reported against the main branch.

---------

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>",41,65,1,0,"2018-04-16 10:25:39","1974.54"
"grafana/loki","d1dee9150b0e69941b2bd3ce4b23afead174ea29","hainenber","2023-10-12 08:20:01","true","feat(helm): configurable API version for PodLog CRD (#10812)

**What this PR does / why we need it**:

**Which issue(s) this PR fixes**:
Fixes #10757 

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [ ] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [x] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

---------

Signed-off-by: hainenber <dotronghai96@gmail.com>
Co-authored-by: Michel Hollands <42814411+MichelHollands@users.noreply.github.com>",26,66,1,0,"2018-04-16 10:25:39","2002.16"
"grafana/loki","a15e6610c1e075f822477cdd93464837e9092300","daixiang0","2019-07-22 02:16:05","false","Document centos dep

- document centos dep
- add `-y` option

Signed-off-by: Xiang Dai <764524258@qq.com>",104,15,0,0,"2018-04-16 10:25:39","460.91"
"grafana/loki","e75f61c4a8283cb0e0100288308f78ab7bace875","slim-bean","2019-09-10 16:44:17","false","prefix all the new api paths with `/loki` to make routing/use a little easier and be more similar to cortex.
also included the `tail` path with the new api such that we can eventually deprecate all the old paths",100,17,0,1,"2018-04-16 10:25:39","509.51"
"grafana/loki","1f6453fb819e4b8c0bd40b05d03cf35dd5fcf699","owen-d","2021-05-24 16:46:48","true","exposes loki codec (#3758)",200,37,0,1,"2018-04-16 10:25:39","1134.01"
"grafana/loki","3243676f4cff332edc69335a912d4e59ff8e9cc8","vlad-diachenko","2023-07-12 15:13:59","true","updated to the latest version of dskit (#9920)

**What this PR does / why we need it**:
Updated Loki with the latest version of dskit

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

---------

Signed-off-by: Vladyslav Diachenko <vlad.diachenko@grafana.com>",59,63,1,0,"2018-04-16 10:25:39","1912.45"
"grafana/loki","94c252b91fabdafff2e833bf09eaa57766fbafa7","pracucci","2019-07-11 19:57:08","false","Parallelly run regex and json stages pipeline tests",101,15,0,0,"2018-04-16 10:25:39","450.65"
"grafana/loki","b27894fbf4ddb3ae914a9df828f1c643d96137a0","cyriltovena","2021-11-30 15:42:11","true","Adds the ability to hedge storage requests. (#4826)

* Adds the ability to hedge request for all backends

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Remove race from tests

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Remove the race

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Remove the race

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Testing

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* More testing

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Setup credentials to avoid auth

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* gomod

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* improve tests

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* gomod

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* changelog

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Group the configuration

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",214,43,0,1,"2018-04-16 10:25:39","1319.97"
"grafana/loki","e823a5037f90237e3497da6ec34b25fe70a2c86e","owen-d","2022-01-11 13:42:16","true","better defaults for flush queue parallelism (#5091)

* better defaults for flush queue length

* changelog",258,45,0,1,"2018-04-16 10:25:39","1360.89"
"grafana/loki","2c0cc01fa1ea46d9cc36f96864f0cb6c21bb89c8","dannykopping","2023-01-12 20:54:28","true","Minor fixups to LIDs (#8124)

Including spelling my own surname right! :see_no_evil:

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",100,57,1,1,"2018-04-16 10:25:39","1727.44"
"grafana/loki","87d51bd8e7475cda0855f0a68a0b44c94165358a","ssncferreira","2022-08-16 13:55:07","true","Update documentation deletion_mode and allow_deleted configuration values (#6921)",83,52,0,0,"2018-04-16 10:25:39","1581.15"
"grafana/loki","fb457e5fc6f886f004afd569a304f16c4be72b52","DylanGuedes","2022-01-13 15:26:08","true","Copy `cortex/pkg/querier` package dependency into Loki (#5122)

* Fork cortex querier and its dependencies.

* Use forked querier instead of cortex implementation.

* Fix files wrongly using cortex spanlogger.

* Fix file wrongly using cortex gateway.

* Remove storegateway from vendor.

* Fix test.

* Use seriesFunc const to fix lint.

* Fix linting issues.",262,45,0,1,"2018-04-16 10:25:39","1362.96"
"grafana/loki","ac07fc06ee20bc1dee904b571958d3aaa6e7b829","periklis","2021-10-06 04:59:12","true","Add support for openshift-logging tenant mode (#93)",137,42,0,1,"2018-04-16 10:25:39","1265.52"
"grafana/loki","7a5fe3dd1cecbd7582551108f98892adb00a52ca","cyriltovena","2021-05-17 07:33:55","true","Fixes docker driver that would panic when closed. (#3709)

This is happening because it can still received log, but the client might be already closed.

Fixes #3705

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",195,37,0,1,"2018-04-16 10:25:39","1126.63"
"grafana/loki","d1b99126026aff8e2eac411bbdfa5c9d8976daad","cyriltovena","2021-02-16 13:54:14","true","Add pprof endpoint to docker-driver. (#3331)

* Add pprof endpoint to docker-driver.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Improve lint.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",132,34,0,1,"2018-04-16 10:25:39","1030.64"
"grafana/loki","1bb4301f2ee943a51b42ce3f52b6740594fa9225","unguiculus","2020-12-04 09:28:38","true","Fix multiline docs (#3035)

Signed-off-by: Reinhard Nägele <unguiculus@gmail.com>",126,31,0,0,"2018-04-16 10:25:39","958.46"
"grafana/loki","31fc400032d5d4012d67b6963089202c2c358136","davkal","2019-03-26 08:51:51","true","Merge pull request #418 from steven-sheehy/promtail-config

Helm: Custom promtail configuration",92,11,0,0,"2018-04-16 10:25:39","339.93"
"grafana/loki","0d4131c5359f16a8ae0d9935d4b247cd8a41f8d4","davkal","2019-03-25 10:00:32","true","Merge pull request #415 from daixiang0/add-backoff

Add backoff_config in helm",93,11,0,0,"2018-04-16 10:25:39","338.98"
"grafana/loki","7527487f315c65c1507d8baaebea3ec09ca5d4ee","tomwilkie","2019-02-08 10:59:27","false","Track the right number of streams, and cancel the push when the request is cancelled.

This was broken in a422f394bb4660c98f7d692e16c3cc28747b7abd.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",79,10,0,0,"2018-04-16 10:25:39","292.02"
"grafana/loki","db36b3c74ebb074ed03c91f4ed2ef0ac13d48909","tomwilkie","2019-02-05 17:00:26","false","Update heap iterator to allow for entries with duplicate timestamps.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",80,10,0,0,"2018-04-16 10:25:39","289.27"
"grafana/loki","5d8414fcd6b5e2ee55643fac555eaf0b9764dc67","cyriltovena","2021-07-14 13:24:37","true","Intern label keys for LogQL parser. (#3990)

* Intern label keys for LogQL parser.

They often will see the same key over and over and instead of allocating/sanitizing we can re-use the previous value.
This mostly speeds up parser that were using a dynamic list of keys like json and logfmt.

We could intern values too specially for metrics queries.

```
❯ benchcmp  before.txt after.txt
benchmark                                                   old ns/op     new ns/op     delta
Benchmark_Parser/json/no_labels_hints-16                    3894          2885          -25.91%
Benchmark_Parser/json/labels_hints-16                       2084          2163          +3.79%
Benchmark_Parser/unpack/no_labels_hints-16                  915           890           -2.72%
Benchmark_Parser/unpack/labels_hints-16                     848           846           -0.32%
Benchmark_Parser/logfmt/no_labels_hints-16                  2229          1146          -48.59%
Benchmark_Parser/logfmt/labels_hints-16                     1230          1150          -6.50%
Benchmark_Parser/regex_greedy/no_labels_hints-16            3881          3754          -3.27%
Benchmark_Parser/regex_greedy/labels_hints-16               5443          3737          -31.34%
Benchmark_Parser/regex_status_digits/no_labels_hints-16     318           290           -8.89%
Benchmark_Parser/regex_status_digits/labels_hints-16        335           289           -13.85%
Benchmark_Parser/pattern/no_labels_hints-16                 151           151           -0.20%
Benchmark_Parser/pattern/labels_hints-16                    129           131           +1.24%

benchmark                                                   old allocs     new allocs     delta
Benchmark_Parser/json/no_labels_hints-16                    69             43             -37.68%
Benchmark_Parser/json/labels_hints-16                       32             36             +12.50%
Benchmark_Parser/unpack/no_labels_hints-16                  19             17             -10.53%
Benchmark_Parser/unpack/labels_hints-16                     16             17             +6.25%
Benchmark_Parser/logfmt/no_labels_hints-16                  46             16             -65.22%
Benchmark_Parser/logfmt/labels_hints-16                     20             16             -20.00%
Benchmark_Parser/regex_greedy/no_labels_hints-16            2              2              +0.00%
Benchmark_Parser/regex_greedy/labels_hints-16               2              2              +0.00%
Benchmark_Parser/regex_status_digits/no_labels_hints-16     2              2              +0.00%
Benchmark_Parser/regex_status_digits/labels_hints-16        2              2              +0.00%
Benchmark_Parser/pattern/no_labels_hints-16                 2              2              +0.00%
Benchmark_Parser/pattern/labels_hints-16                    1              1              +0.00%

benchmark                                                   old bytes     new bytes     delta
Benchmark_Parser/json/no_labels_hints-16                    1089          624           -42.70%
Benchmark_Parser/json/labels_hints-16                       456           480           +5.26%
Benchmark_Parser/unpack/no_labels_hints-16                  569           537           -5.62%
Benchmark_Parser/unpack/labels_hints-16                     553           537           -2.89%
Benchmark_Parser/logfmt/no_labels_hints-16                  576           336           -41.67%
Benchmark_Parser/logfmt/labels_hints-16                     256           336           +31.25%
Benchmark_Parser/regex_greedy/no_labels_hints-16            194           194           +0.00%
Benchmark_Parser/regex_greedy/labels_hints-16               194           194           +0.00%
Benchmark_Parser/regex_status_digits/no_labels_hints-16     52            52            +0.00%
Benchmark_Parser/regex_status_digits/labels_hints-16        52            52            +0.00%
Benchmark_Parser/pattern/no_labels_hints-16                 35            35            +0.00%
Benchmark_Parser/pattern/labels_hints-16                    32            32            +0.00%
```

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Move to labels.go and cap the amount of keys that can be interned to 1024.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",105,39,0,1,"2018-04-16 10:25:39","1183.87"
"grafana/loki","d8780da454edac43ae141b69aaee928a7a7a368c","MasslessParticle","2022-02-16 17:40:25","true","Revert to working version of Azure client (#5413)

* Revert ""storage: update azure blobstore client to use new sdk (#5302)""

This reverts commit 89b04a97b38fb7dcdec286ae5ab712e8b1d70f07.

* Fix Azure SDK Issue

- Revert SDK to working version
- Introduce patches to prevent deadlocks

* make metrics global",292,46,0,1,"2018-04-16 10:25:39","1396.05"
"grafana/loki","6aba7098b308f38924fbe5babb220e6ce0b6b263","dannykopping","2021-03-03 13:29:38","true","Adding upgrade documentation related to #3404 (#3418)

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",139,34,0,1,"2018-04-16 10:25:39","1047.63"
"grafana/loki","3cb15d62d5ba4f2db92807305cffa5a2f64c9b4c","jdbaldry","2023-01-19 09:55:12","true","Docs: Add doc-validator tool to lint technical documentation (#6569)

Source code:

https://github.com/grafana/technical-documentation/tree/main/tools/doc-validator

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

**What this PR does / why we need it**:

Adds a CI step for pull requests that validates links in technical
documentation and performs linting of technical documentation source
files.

**Special notes for your reviewer**:

- Lots of issues will need to be fixed before we can merge this.
- The tool is still in early development so each error should be
scrutinized for validity.

**Checklist**
- [ ] Documentation added
- [na] Tests updated
- [na] Is this an important fix or new feature? Add an entry in the
`CHANGELOG.md`.
- [na] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>",84,57,1,0,"2018-04-16 10:25:39","1733.98"
"grafana/loki","7dcc2eae6fe3311908315d2b4280154e3f7fc4d9","cyriltovena","2021-05-05 12:43:06","true","Fixes a panic with the frontend when use with downstream URL. (#3686)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",186,37,0,1,"2018-04-16 10:25:39","1114.85"
"grafana/loki","bc88f298cbe93602a190922bb0fa408678c2370b","rsteneteg","2022-01-27 06:29:54","true","skip glob search if path is an existing file and not a directory (#5246)

Signed-off-by: Roger Steneteg <rsteneteg@ea.com>",275,45,0,0,"2018-04-16 10:25:39","1376.59"
"grafana/loki","c820103581b4c83d389efadeb0652a3368f61622","cstyan","2021-10-07 00:25:55","true","Add tag/link fix to operational dashboard and promtail mixin dashboard. (#4423)

Signed-off-by: Callum Styan <callumstyan@gmail.com>",137,42,0,1,"2018-04-16 10:25:39","1266.33"
"grafana/loki","b7830dd42ddf053c0ba6fa9e7f63445a085fb0b7","periklis","2021-12-07 10:22:43","false","Merge loki-operator into top-level dir operator",214,44,0,1,"2018-04-16 10:25:39","1326.75"
"grafana/loki","5415b11468c7f22be52eed4a282b37e6a45557f0","periklis","2023-09-15 12:14:02","true","operator: Update Loki operand to v2.9.1 (#10600)",40,65,1,1,"2018-04-16 10:25:39","1975.33"
"grafana/loki","60601628aae69f8e045879f8e491f82f037de86b","daixiang0","2019-05-31 07:44:06","true","Merge branch 'master' into reduce-config-option",108,13,0,0,"2018-04-16 10:25:39","410.14"
"grafana/loki","1c5e094e161cbc77dd6b579ccafbec6e820e4e7b","MasslessParticle","2022-06-02 17:59:39","true","Only delete data when WholeStreamDeletion or FilterAndDelete (#6286)

* Only delete data when WholeStreamDeletion or FilterAndDelete

* remove broken snyn workflow",71,50,0,1,"2018-04-16 10:25:39","1507.32"
"grafana/loki","cc33749b73043735e6031d779dfc0f0cf7702958","MasslessParticle","2023-06-23 17:48:50","true","fix integration test for multiple periods (#9782)

The integration test is writing logs across two index periods but
there's a chance that the log `lineB` is written after the beginning of
the second period after it's added. This means we never get `lineB` in
the results.

This change pushes back the write time of the first logs so they're
always stay in the first index period.",61,62,1,1,"2018-04-16 10:25:39","1893.56"
"grafana/loki","0885f64e604c2bee8f668fc0b2ef64a51d4ef39c","CyrilPeponnet","2019-05-15 14:27:40","false","impr/logcli: Added label output filters + tests (#563)

* impr/logcli: Added label filters + tests

* Address review

* udpate readme",100,13,0,0,"2018-04-16 10:25:39","394.42"
"grafana/loki","b8c9672de6678e2d7f53bdb921aa94ef37ab9dd5","simonswine","2022-06-24 07:25:23","true","Update loki's default port to 3100 (#6349)

* Update loki's default port to 3100

I was suprised this was not already the case. I think it would be a good
change to make, but I am also contious of the breaking nature of this.

* Add note to the changelong

* Add upgrade note

* Apply suggestions from code review

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>",69,50,0,0,"2018-04-16 10:25:39","1528.87"
"grafana/loki","ecf4e92ef673a5fd965237e49bf53c909f2cf70a","periklis","2021-04-07 14:35:28","true","Add support to install the operator via OLM in OCP clusters (#17)

Co-authored-by: Periklis Tsirakidis <periklis@redhat.com>",147,36,0,1,"2018-04-16 10:25:39","1081.67"
"grafana/loki","17c89f478fa9cfeed2b9d9a0691c1af60bc2e803","periklis","2021-10-25 10:34:46","true","Add gh pages (#98)

* Set theme jekyll-theme-slate

* Update index.md",165,42,0,1,"2018-04-16 10:25:39","1284.76"
"grafana/loki","b611641fea42c29d4dc5849c0ea34e63868d70d6","ssncferreira","2023-06-22 10:30:32","true","Add comments to clarify Grouping struct in Aggregation expressions (#9761)

**What this PR does / why we need it**:
Add comments to clarify the Grouping struct in Vector Aggregation and
Range Vector Aggregations expressions.

Related with PR: https://github.com/grafana/loki/pull/9515

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",63,62,1,0,"2018-04-16 10:25:39","1892.25"
"grafana/loki","489ca25babf39b27f9d86e88905b55dba0bdc7e5","aknuds1","2023-10-10 14:14:17","true","Upgrade to Prometheus@4b9c19fe5510 (#10843)

**What this PR does / why we need it**:
Upgrade to Prometheus@4b9c19fe5510. Since also golang.org/x/exp gets
upgraded, calls to e.g. `slices.SortFunc` need updating (due to changed
comparison function signature). I'm not aware of any functional changes
from Prometheus (or otherwise), but please review carefully.

**Special notes for your reviewer**:
The Mimir team needs for Loki to be compatible with the latest
Prometheus, so we can vendor mimir-prometheus@main into GEM.

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [na] Documentation added
- [x] Tests updated
- [na] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [na] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [na] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

Signed-off-by: Arve Knudsen <arve.knudsen@gmail.com>",25,66,1,0,"2018-04-16 10:25:39","2000.41"
"grafana/loki","0e718c2275a2fe0e95bf8f264049297e3fc67108","pracucci","2019-10-09 19:40:49","false","logcli: introduced QueryStringBuilder utility to clean up query string encoding (#1115)",68,18,0,0,"2018-04-16 10:25:39","538.64"
"grafana/loki","87d25fac796a77993dbaae589c3b7911d9fab50f","slim-bean","2019-05-09 19:15:08","false","Clean up the metric for pipeline duration to keep it within the pipeline file, also changing unit to seconds and namespace to logentry",97,13,0,1,"2018-04-16 10:25:39","388.62"
"grafana/loki","92cd8165afed95eed690f0b0fb9bb8fc8e147cce","Red-GV","2022-06-30 13:56:12","true","operator: Making all pods and containers compliant with restricted policy (#6514)",73,50,0,1,"2018-04-16 10:25:39","1535.15"
"grafana/loki","909adf62f141f54840822c43263ba3e9c1f5974b","dawidmalina","2019-07-08 14:11:26","false","ability to specify keys to remove (#669)",98,15,0,0,"2018-04-16 10:25:39","447.41"
"grafana/loki","7889e01cd0b59e4ad8d475735f74ae8cd47308ad","slim-bean","2020-07-11 21:56:32","true","looks like yamale 3.0.0 was released with a breaking change in a method parameter, pinning to 2.2.0 (#2341)",121,27,0,1,"2018-04-16 10:25:39","815.98"
"grafana/loki","6210dae9b2d4964d60e0756e841ef6245f6a481e","slim-bean","2020-04-01 16:19:56","false","clear out some changelog entries to fix a merge conflict from the release branch

Signed-off-by: Edward Welch <edward.welch@grafana.com>",121,23,0,1,"2018-04-16 10:25:39","710.5"
"grafana/loki","89ee022c21c7c9ec660aa3fdab21a4ec0090471c","slim-bean","2021-11-04 16:13:27","true","Loki: fix handling of tail requests when using target `all` or `read` (#4642)

* better handling of tail requests when the frontend and querier are running in the same process

* adding function to determine if a module is enable based on the target supplied to Loki

* fix tests and incorrect registering of tail routes

* renamed function and made check for active recursive",171,43,0,1,"2018-04-16 10:25:39","1293.99"
"grafana/loki","904bf2fcc9a0357c961893b72c2e28f3aa2146a9","chancez","2019-12-13 01:06:21","false","Fix example AWS storage configuration (#1394)

`store` must be `aws`, not `dynamo`. 

Without this change, the previous example configuration causes Loki to error at startup:

```
level=error ts=2019-12-10T00:27:54.489032373Z caller=main.go:66 msg=""error initialising loki"" err=""error initialising module: table-manager: Unrecognized storage client dynamo, choose one of: aws, cassandra, inmemory, gcp, bigtable, bigtable-hashed""
```",98,20,0,0,"2018-04-16 10:25:39","601.86"
"grafana/loki","4bd5e617c3af2b60310e35795b5ac9f88b6a3a8e","kavirajk","2023-08-24 15:00:10","true","chore(schema-v13): Fix `periodConfig.Validate` for `v13` schema (#10336)

**What this PR does / why we need it**:
Fix periodConfigs `Validate()` for new schema `v13`.

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:
Found when testing archiver with latest loki
**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",50,64,1,1,"2018-04-16 10:25:39","1954.44"
"grafana/loki","49d0d0f0da0f53c5ee7ee1a638b9afb225f493e4","pstibrany","2019-11-29 21:18:40","false","Makefile changes to allow easy builds with or without vendoring. Also fixes version bug for both cases. (#1095)

* Extracted -mod=vendor into a variable

* Use ?= to set variable only if not set yet.

This enables ""MOD_VENDOR=  make all"" use from command line

* Enable/disable vendoring with VENDOR=true or false. Enabled by default

* Make go generate use -mod=vendor depending on VENDOR flag

* Use GOMOD to specify module version to use.

GOMOD can be set to empty string, ""vendor"", ""readonly"" and in
Go 1.14 to ""mod"".  If not defined, defaults to ""vendor"".

Non empty values are passed to -mod parameter to Go tools, and
--modules-download-mode parameter for golangci-cli linting tool.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Fix versioning info when not using vendoring.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Updated build image to use Golintci-cli v1.21.0 and Go 1.13.4.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Updated build image to version 0.8.0. Changs: Golintci-cli v1.21.0, Go 1.13.4.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Renamed MOD_VENDOR to MOD_FLAG to better describe its function.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Fix version info in all command line tools.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Use loki-build-image:0.8.0

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>",90,19,0,0,"2018-04-16 10:25:39","588.7"
"grafana/loki","1728d09cba18b53db915e9bbf006fd9a129847cf","chaudum","2023-01-25 19:30:36","true","Use Loki build image 0.27.1 in CI (#8279)

Second part of updating the Loki build image

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",81,57,1,1,"2018-04-16 10:25:39","1740.38"
"grafana/loki","d5c337c4d3599c31903c95cf2cedde00279cc36f","chaudum","2022-05-20 11:05:37","true","docs: Fix broken link from unpack parser to pack stage (#6207)

and make hyperlinks more obvious

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",72,49,0,1,"2018-04-16 10:25:39","1495.03"
"grafana/loki","3940f059f0f2838d93af67ae21fb6c656345f6cb","KMiller-Grafana","2021-06-03 08:49:19","true","Docs: remove unnecessary lists of sections (#3790)

Links to the sections are in the right side navigation panel.",208,38,0,0,"2018-04-16 10:25:39","1142.68"
"grafana/loki","c0a28cbf30f342b68766c104403fa3bfe5cd56ee","adityacs","2020-04-24 13:48:08","true","Log error message for invalid checksum (#1713)",116,24,0,1,"2018-04-16 10:25:39","738.64"
"grafana/loki","fecdd852106576d49982d3545ee471103b0ef858","periklis","2023-11-07 13:17:30","true","operator: Update deps to secure webhooks for CVE-2023-44487 (#11129)",9,67,1,1,"2018-04-16 10:25:39","2027.37"
"grafana/loki","3a50d5d1a67d0e3f8330e149846bcd822d164ff3","periklis","2021-10-18 06:12:38","true","Add OpenShift Auth native support (#94)",159,42,0,1,"2018-04-16 10:25:39","1277.57"
"grafana/loki","7763e8f3dd01f4093842c262587345ddfc300cd1","gouthamve","2019-02-01 13:27:10","false","Flush idle chunks properly (#209)

* Flush idle chunks properly

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>

* Review feedback

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>

* Review feedback.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>

* Check the correct chunk is full before appending a new chunk.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>

* Add the config to helm and ksonnet too.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",79,9,0,0,"2018-04-16 10:25:39","285.13"
"grafana/loki","59f312545cb69ca206afa699b1ae39fb09b74d58","takanabe","2020-06-15 19:12:51","true","Improve fluentd plugin development experience (#2179)

* Add Gemfile.lock and .rspec_status to .gitignore

* Converge gem definition in gemspec file

* Add missing `bundle exec` to README

* s/FluentD/Fluentd/g",136,26,0,0,"2018-04-16 10:25:39","789.87"
"grafana/loki","5dc27e8064a3c30e216d7b79244f812221f8e5a7","MasslessParticle","2022-10-11 15:54:08","true","Fix Flaky Distributor Test (#7391)

Use eventually for async tests",90,54,1,1,"2018-04-16 10:25:39","1636.23"
"grafana/loki","56b70462e831fe2243de34d7d13e20c2ea26060f","slim-bean","2021-12-17 14:50:08","true","Merge pull request #4945 from grafana/upstream-operator

Add loki operator subproject",237,44,0,1,"2018-04-16 10:25:39","1336.93"
"grafana/loki","061c5e5ecadd800f8c7507213165aac513204134","jeschkies","2021-10-27 13:25:25","true","Use different metrics for `PromtailFileLagging`. (#4496)",166,42,0,1,"2018-04-16 10:25:39","1286.87"
"grafana/loki","54937784f989bdf3117596a61fd7d60bc9d4b05f","JStickler","2023-10-19 19:10:51","true","Revert scalable monolithic to SSD (#10958)

After consultation with @stevendungan, reverting the terminology
""Scalable monolithic deployment"" back to ""Simple scalable deployment.""

Decided to add a note about the confusion that SSD causes to clarify
that we don't mean solid state drives.

FYI @monodot

---------

Co-authored-by: Michel Hollands <42814411+MichelHollands@users.noreply.github.com>",20,66,1,0,"2018-04-16 10:25:39","2009.61"
"grafana/loki","7af0c2bdf3eaf1c2bffda0d18937540267fb7634","pracucci","2019-10-10 14:39:37","false","promtail: added action_on_failure support to timestamp stage (#1123)",66,18,0,0,"2018-04-16 10:25:39","539.43"
"grafana/loki","57f8159c933ebec7b7648de4871e84a368c8c889","czunker","2020-11-23 07:37:11","true","[Helm Chart Loki] Add needed k8s objects for alerting config: (#2965)

- ConfigMap containing the rules
- VolumeMount for rules
- scratch mount for rule parsing

Fixes #2964

Signed-off-by: Christian Zunker <christian.zunker@codecentric.cloud>",111,31,0,0,"2018-04-16 10:25:39","947.38"
"grafana/loki","cd80bc5e7ecf824787b391911a66ab912efa60db","owen-d","2021-10-29 14:53:57","true","introduces ""entry too far behind"" instrumentation for unordered writes (#4592)",170,42,0,1,"2018-04-16 10:25:39","1288.94"
"grafana/loki","17577b4d47f8f944cafd0357acea14b64984e66b","chaudum","2023-01-03 07:10:52","true","Shut down query frontend gracefully (#7978)

**What this PR does / why we need it**:

This PR fixes a bug in the shutdown process of the query frontend. In
order to shut down the frontend gracefully without cancelling any
in-flight operations/sub-requests, the frontend service has to wait
until all in-flight operations are finished. Only then its sub-services
may be stopped.

In order to control the deterministic order of the shutdown of the
service and its child services, child services need to be started with
their own context (not with their parent context). Otherwise, if the
context of the frontend is cancelled, also the contexts of the child
services are cancelled, leading to a parallel stopping of the parent and
its child services.

During the time of the shutdown, the `RoundTripGRCP` function still
needs to accept any round-tripping requests. This is, because the
frontend round tripper is wrapped into a query range tripper ware, which
splits incoming (HTTP) query requests into multiple (gRPC) query
requests if needed.

**Which issue(s) this PR fixes**:

This fixes a race condition where queries fail, because the query
frontend shut down before the queriers that processed in-flight request
could send the query response to the frontend. This manifested in an
increased error rate of queries during restarts (rollouts) of the query
frontend.

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the `CONTRIBUTING.md` guide
- [x] Documentation added
- [x] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>
Signed-off-by: Christian Haudum <christian.haudum@gmail.com>
Co-authored-by: Danny Kopping <danny.kopping@grafana.com>",98,56,1,1,"2018-04-16 10:25:39","1717.86"
"grafana/loki","f9d78e1748bc62cdb1a887c33ef6075eeec34e66","owen-d","2022-08-08 13:21:05","true","[TSDB] Indexgateway Protobuf refactor  (#6841)

* queryrangebase definitions protos & aliases
Signed-off-by: Owen Diehl <ow.diehl@gmail.com>

* indexgatewaypb to logproto
Signed-off-by: Owen Diehl <ow.diehl@gmail.com>

* updates queryrange.proto for new definitions file
Signed-off-by: Owen Diehl <ow.diehl@gmail.com>

* s/indexgatewaypb/logproto/g
Signed-off-by: Owen Diehl <ow.diehl@gmail.com>

* renames to indexseries for clobbering reasons
Signed-off-by: Owen Diehl <ow.diehl@gmail.com>

* more indexgatewaypb removal compatibility work
Signed-off-by: Owen Diehl <ow.diehl@gmail.com>

* proto fmt
Signed-off-by: Owen Diehl <ow.diehl@gmail.com>

* rebuild imports
Signed-off-by: Owen Diehl <ow.diehl@gmail.com>

* goimports -s
Signed-off-by: Owen Diehl <ow.diehl@gmail.com>",75,52,0,1,"2018-04-16 10:25:39","1573.12"
"grafana/loki","cf419d1cb83f4664c2298abe1ee41bfbfab98710","DylanGuedes","2022-02-02 21:11:11","true","Implement `LegacySample`, `LegacyLabelPair` proto messages (#5301)

* Add LegacySample and modify protos to use it.

* [Skip this commit] Regenerate protos.

* Modify codebase to use LegacySample instead of Sample.

For reference, take a look at PR https://github.com/grafana/loki/pull/5151.

* Implement LegacyLabelPair.

* Use new Legacy implementations accordingly.

* Use LegacySample in compat tests.

- Since `compat.go` was forked from Cortex, we can reliably change all
  mentions from  `Sample` to `LegacySample` there.",278,45,0,1,"2018-04-16 10:25:39","1382.2"
"grafana/loki","7a9804bce755607c208ff6033bc14c7f3e934ec3","kavirajk","2021-03-03 13:10:41","true","doc(gcplog): Advanced log export filter example (#3421)

* doc(gcplog): Advanced log export filter example

* Update docs/sources/clients/promtail/gcplog-cloud.md

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>",140,34,0,1,"2018-04-16 10:25:39","1047.61"
"grafana/loki","233e52546ed2956da2eb8b65d1c95a5f66289a04","MattiasSegerdahl","2023-05-03 16:22:51","true","Update _index.md (#9331)

**What this PR does / why we need it**:

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",81,61,1,0,"2018-04-16 10:25:39","1843.5"
"grafana/loki","a1defa77b889f9d10d84397f9dda521519fed6d9","MichelHollands","2023-10-06 18:01:21","true","Update build image to go 1.21.2 and alpine 3.18.4 (#10804)

**What this PR does / why we need it**:

Update to latest Go and Alpine version

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

Signed-off-by: Michel Hollands <michel.hollands@gmail.com>",25,66,1,1,"2018-04-16 10:25:39","1996.57"
"grafana/loki","2f061f3a8a2729cfbcf739c7aee1b2ff743a60d5","cyriltovena","2020-02-13 15:44:29","true","Ensure status codes are set correctly in the frontend. (#1684)

* Returns httpgrpc error in roundtriper.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Ensure error codes are set correctly in the frontend.

Previously we had cases where 400 would endup as 500. We should use httpgrpc.Errorf when possible.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",114,22,0,1,"2018-04-16 10:25:39","662.47"
"grafana/loki","9d0b584c5ba1a2d82a5a735537f1c80a35097575","woodsaj","2019-01-21 14:32:13","true","Merge pull request #233 from grafana/2019-01-21-promtail-ksonnet

add external_labels support to promtail ksonnet",62,9,0,0,"2018-04-16 10:25:39","275.17"
"grafana/loki","9f8aa4b98a0048c658f49a6f9c3ad76e115efc84","ssncferreira","2023-02-24 14:07:47","true","Helm: fix enterprise-logs license secret name (#8498)

**What this PR does / why we need it**:

Rename `gel-license.jwt` property of secret `gel-secrets` to
`license.jwt` on enterprise-logs chart to make it consistent betwen
`gel-secrets` and `gel-license` kubectl secrets.

* Fix the `stringData` property of the GEL secret, to contain
`license.jwt` property when importing:
* `gel-secrets`: containing both the `gcp_service_account.json` and
`license.jwt` properties
https://github.com/grafana/loki/blob/6ece17a82f15319b58befaef9aefcd9059ad266d/production/helm/loki/docs/examples/enterprise/enterprise-secrets.yaml#L1-L12
* `gel-license`: containing only the `license.jwt` property
https://github.com/grafana/loki/blob/6a7403c4f5cd0a01dea13954fe6f51631f485ad1/tools/dev/k3d/environments/helm-cluster/main.jsonnet#L213-L217
* Minor fixes in the README documentation.

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",63,58,1,0,"2018-04-16 10:25:39","1769.15"
"grafana/loki","528ed22dc2dd4f4e54f0a8cb5ca6fea7b9ff0962","dannykopping","2023-03-22 08:10:58","true","Ruler: remote rule evaluation hardening (#8785)

**What this PR does / why we need it**:
This PR is part 2 of 2 implementing remote rule evaluation.
See [part 1](https://github.com/grafana/loki/pull/8744) for more
context.",84,59,1,1,"2018-04-16 10:25:39","1796.91"
"grafana/loki","385f111593f01f2495c7a9b6881af44ad5e2563f","daixiang0","2019-04-04 10:35:13","false","Fix service account error

Signed-off-by: Xiang Dai <764524258@qq.com>",95,11,0,0,"2018-04-16 10:25:39","348.01"
"grafana/loki","544eed1b95a57d3e735f57664c8f4931923a5059","tomwilkie","2018-05-29 18:25:10","false","Add some unit tests for the iterators.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",1,1,0,0,"2018-04-16 10:25:39","43.33"
"grafana/loki","cac2a131c9a8746866736879ce4301b36ed2a32d","MichelHollands","2023-01-18 11:47:04","true","Do not run release stage when check stage fails (#8175)",94,57,1,1,"2018-04-16 10:25:39","1733.06"
"grafana/loki","20515a2402fe6941353bbeec5efd04c1d56ce841","owen-d","2021-09-01 15:31:52","true","better per stream rate limits configuration options (#4236)

* better per stream rate limits configuration options

* clean up test config

* pr feedback",130,40,0,1,"2018-04-16 10:25:39","1230.96"
"grafana/loki","b4eeddc710d375d4655dda41c448ef2087860149","slim-bean","2021-01-29 15:48:50","true","Loki migrate-tool (#3151)

* basics working, needs some more cleanup and more flags for config and a Dockerfile

Signed-off-by: Edward Welch <edward.welch@grafana.com>

* add label matchers
start end time params
and ability to remap the chunk to a different user

Signed-off-by: Edward Welch <edward.welch@grafana.com>

* adding dockerfile and makefile instructions

Signed-off-by: Edward Welch <edward.welch@grafana.com>

* push out some of the limits
show errors from index query

* for testing have docker container not run migrate command but instead stay running by tailing /dev/null

* big overhaul to add parallelization

* adding better stats

* adding retry logic

* tweaking retry logic

* tweaking retry logic

* work around changes in latest cortex

Signed-off-by: Ed Welch <edward.welch@grafana.com>

* fix up imports and changes since the last time this was merged
added a readme
fixed up the makefile
added some comments

* fixing some of my garbage

* fixing more of my garbage

* Update cmd/migrate/README.md

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>

* Update cmd/migrate/README.md

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>

* Update cmd/migrate/README.md

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>

* Update cmd/migrate/README.md

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>

* Update cmd/migrate/README.md

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>

* tabs not spaces

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>",128,33,0,1,"2018-04-16 10:25:39","1013.72"
"grafana/loki","36ec92ce5c55583d3afb2e14218a2fcf61f35e93","slim-bean","2021-03-17 13:15:15","true","Update Go and Alpine versions (#3481)

* Upgrade go to 1.16 and alpine to 3.13

* update drone to use new build image version

* gomod

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

Co-authored-by: Cyril Tovena <cyril.tovena@gmail.com>",160,35,0,1,"2018-04-16 10:25:39","1061.62"
"grafana/loki","44e8422dc468e8071f6e68b7cd651f45abaf30e9","jeschkies","2023-01-23 21:12:01","true","Enalbe multi tenant queries on Helm test chart. (#8228)

Co-authored-by: Christian Haudum <christian.haudum@gmail.com>",83,57,1,1,"2018-04-16 10:25:39","1738.45"
"grafana/loki","4c0d279e11b267d4da52a1107f09a984e72d597a","jeschkies","2022-10-14 15:07:58","true","Add helm-docs to build image. (#7424)",93,54,1,1,"2018-04-16 10:25:39","1639.2"
"grafana/loki","0520a0ac1c74578ae6fc5d21c24e375e253854af","slim-bean","2020-05-18 21:41:13","true","allow no encoding/compression on chunks (#2088)

Signed-off-by: Ed Welch <edward.welch@grafana.com>",118,25,0,1,"2018-04-16 10:25:39","762.97"
"grafana/loki","fd99dbc926ce0b353fa2768ec29d7db5696ff449","slim-bean","2020-05-05 17:51:37","true","Dashboard: Loki Operational improvements (#2041)

* fixing indentation so I can see diffs better

Signed-off-by: Ed Welch <edward.welch@grafana.com>

* add rows for chunks, streams, dropped samples.
success rate graphs now only look at 5xx errors (4xx are considered ""successful"")
Limited the mouseover to only show the active line for a bunch of graphs.

Signed-off-by: Ed Welch <edward.welch@grafana.com>",117,25,0,1,"2018-04-16 10:25:39","749.81"
"grafana/loki","1fc278623e39d653ddb2079da9570fb8c02b72e7","slim-bean","2019-08-01 18:23:39","false","fix(promtail): Improving promtail asset generation makefile targets

* Primarily this stop deletion of the generated file on a `make clean` which keeps the working directory diff free
* The generated file now checks all the input files to see if there are changes to determine if the target needs to be run
* Updated check-generated-files to include the promtail generated ui file",106,15,0,1,"2018-04-16 10:25:39","470.58"
"grafana/loki","fb9a1989d856c78c5aaa43c56ece6f215669e066","kavirajk","2022-07-21 15:57:43","true","chore(groupcache): Disable hotcache during set (#6740)

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",72,51,0,1,"2018-04-16 10:25:39","1556.23"
"grafana/loki","47b17b590c354049f380ac7f5a4b9a80bdfff4f4","owen-d","2022-07-12 11:31:16","true","dont skip writing to TSDB index when chunk exists in cache (#6664)

Signed-off-by: Owen Diehl <ow.diehl@gmail.com>",70,51,0,1,"2018-04-16 10:25:39","1547.05"
"grafana/loki","8d74b8ccae4af0ed9a63756a659edad49da5e5fa","xperimental","2023-07-05 05:32:31","true","operator: Regenerate bundles after docs change (#9859)",59,63,1,1,"2018-04-16 10:25:39","1905.05"
"grafana/loki","477a0e71dfc8b42770f6b36d2e684a232652051b","MichelHollands","2022-04-29 11:55:05","true","Add filter parameter to rebound so lines can be deleted by the compactor (#5879)

* Add filter parameter to rebound

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Fix linting issues

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Add filter function to delete request

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Fix linting issues

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Enable api for filter and delete mode

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Add settings for retention

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Use labels to check and add test

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Simplify filter function

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Also enable filter mode

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Remove test settings in config file for docker

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Add extra (unused) param for ProcessString in filter

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Empty commit to trigger CI again

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Update changelog

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Fix flapping test

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Remove commented out unit tests and add some more

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Add extra test case for delete request without line filter

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Use chunk bounds

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* check if the log selector has a filter if the whole chunk is selected

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* fix lint issue: use correct go-kit import

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",93,48,0,1,"2018-04-16 10:25:39","1474.06"
"grafana/loki","5cff63dd021b9b562873198e9c749674187a8251","Dariusch","2023-01-12 22:11:13","true","helm: fix autoscaling/v2 template (#8043)

**What this PR does / why we need it**:

Upon installing the new 3.8.1 version of the loki helm chart my
HelmRelease (flux) threw this error:

```
HelmRelease reconciliation failed: Helm upgrade failed: error validating """": 
error validating data: [ValidationError(HorizontalPodAutoscaler.spec.metrics[0].resource):
unknown field ""targetAverageUtilization"" in io.k8s.api.autoscaling.v2.ResourceMetricSource, ValidationError(HorizontalPodAutoscaler.spec.metrics[0].resource):
missing required field ""target"" in io.k8s.api.autoscaling.v2.ResourceMetricSource]
```

The error was introduced in https://github.com/grafana/loki/pull/7416",98,57,1,0,"2018-04-16 10:25:39","1727.49"
"grafana/loki","5b432e3d99f6facbe7d9b008bd9eb119b5824a65","KMiller-Grafana","2022-07-15 08:34:01","true","Docs: Fix bad links in the API section (#6688)

* Docs: Fix a bad link in the API section

* Fix 2 more of the same bad link",71,51,0,0,"2018-04-16 10:25:39","1549.92"
"grafana/loki","aa4684ee52279daf5fd549c73fa122503f9645b9","daixiang0","2019-04-29 13:01:44","false","support config chunk size (#464)

* support config chunk size

Signed-off-by: Xiang Dai <764524258@qq.com>

* fix lint

Signed-off-by: Xiang Dai <764524258@qq.com>

* review feedback",98,12,0,0,"2018-04-16 10:25:39","378.36"
"grafana/loki","1289ef43f6cb75141b596ef9ff3526d70ae447d6","jdbaldry","2021-10-06 20:45:04","true","fix: Correct grafana-token creation command (#4405)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>",137,42,0,0,"2018-04-16 10:25:39","1266.18"
"grafana/loki","cfb4c60813cb6763b38e2adc8543f3f5e736b310","gouthamve","2019-04-25 15:13:31","true","Add stats about chunk sizes and ages (#513)

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>",96,12,0,0,"2018-04-16 10:25:39","374.45"
"grafana/loki","4e661cde0e1ab1d4dc418600eb961111a8db081f","jgehrcke","2020-10-16 08:35:19","true","FluentD loki plugin: add support for bearer_token_file parameter (#2739)

* fluentd plugin: improve param descriptions

* fluentd plugin: make code comments more correct

* fluentd plugin: rename things for clarity

* fluentd plugin: add bearer_token_file parameter

* fluentd plugin: read and set bearer token

* fluentd plugin: improve error message

* fluentd-plugin: bump version

* fluentd plugin: fix header, log success

* fluentd plugin: improve log messages",115,30,0,0,"2018-04-16 10:25:39","910.42"
"grafana/loki","4fafc9c234bc4fe87584f507d9239ce455111a9d","cyriltovena","2022-02-15 08:21:26","true","Fixes a flaky hedging test. (#5389)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",287,46,0,1,"2018-04-16 10:25:39","1394.66"
"grafana/loki","64decdbcb6411fe86c120d3ea17755fbe4cf297d","cyriltovena","2021-03-12 12:30:32","true","Set a max size for the logql parser to 5k. (#3471)

* Set a max size for the logql parser to 5k.

The API anyway receives the query via querystring which is normally max out by 2k based on RFC2616.
This will improve fuzzing too.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* better error.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",155,35,0,1,"2018-04-16 10:25:39","1056.59"
"grafana/loki","5c4ba10fb9c254e2d4469fcf5dc88b341d0fbe0e","cyriltovena","2021-05-05 13:40:33","true","Use model.Duration for easy yaml/json marshalling. (#3687)

* Use model.Duration for easy yaml/json marshalling.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* test fixes.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",183,37,0,1,"2018-04-16 10:25:39","1114.89"
"grafana/loki","0a66b897ecd24f02304320e0228a72f4463b0e7c","ldb","2021-09-29 06:53:27","true","clients/promtail: Add ndjson and plaintext formats to loki_push (#4336)

* feat(clients/promtail): add ndjson,plaintext formats to loki_push

* feat(clients/promtail): add ndjson,plaintext formats to loki_push

* feat(clients/promtail): documentation

* Address review comments

* fmt

* fix missing port",140,41,0,0,"2018-04-16 10:25:39","1258.6"
"grafana/loki","2a51fb42bf19eab028793bf7aaa6ec8ab5a86687","ukolovda","2021-02-05 15:21:53","true","Distributor: Loki API can receive gzipped JSON (#3291)

* Push API recognize HTTP header ""Content-Encoding: gzip"" and upload gzipped JSON

* Fix documentation mistake",127,34,0,0,"2018-04-16 10:25:39","1019.71"
"grafana/loki","accb5e1ca2f293496ba3a497aaade6aeb1bba708","MichelHollands","2022-09-09 14:39:38","true","Log the interval of a delete request (#7120)

**What this PR does / why we need it**:

An interval is generated automatically for a delete request: this is the
max size of a shard of a deletion request. This value is now logged.

Additionally a setting name that should have been renamed was fixed.

**Checklist**
- [ ] Documentation added
- [ ] Tests updated
- [ ] Is this an important fix or new feature? Add an entry in the
`CHANGELOG.md`.
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",85,53,1,1,"2018-04-16 10:25:39","1604.18"
"grafana/loki","2c57d2e2b91a5fe8efe852350b9ca5971b73ebf3","anosulchik","2023-05-24 07:25:04","true","Helm: Support of extraVolumeClaimTemplates for writer statefulset (#9485)

**What this PR does / why we need it**:

This PR adds `extraVolumeClaimTemplates` value for write loki component,
it allows to have more than one volume claims for persistent statefulset
configuration. For example, when it's needed to have ingester's and
shipper's WAL files on different persistent volumes.

**Special notes for your reviewer**:

**Checklist**
- [X] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [X] Documentation added
- [x] Tests updated
- [x] `CHANGELOG.md` updated
- [x] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

---------

Co-authored-by: J Stickler <julie.stickler@grafana.com>",67,61,1,0,"2018-04-16 10:25:39","1864.12"
"grafana/loki","da7acb49e56d5b053da3a54b0c3263679e45c6f1","DylanGuedes","2022-10-05 15:02:20","true","Loki: Add sharding support for negative/zeroed desired rate (#7342)

**What this PR does / why we need it**:
Adds the handling of negative/zeroed desired rate to our distributor
stream sharding. Without this, invalid desired rates results in a -Inf
number of shards. This also adds a log line to report that such a thing
happened.

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>
Co-authored-by: Danny Kopping <danny.kopping@grafana.com>",94,54,1,1,"2018-04-16 10:25:39","1630.19"
"grafana/loki","7f02ef3fa7ad57d2d4532247fca1b5151ca6bb33","owen-d","2023-10-11 14:34:41","true","helpers for tar+gz over bloom blocks (#10849)

Simple start, but helpful for building & extracting tar+gz archives over
bloom block directories.",25,66,1,1,"2018-04-16 10:25:39","2001.42"
"grafana/loki","57023e00cb2ef574e3c57c95c993359c5288c2a9","chrischdi","2020-03-26 15:02:37","true","logcli client: use OrgID in LiveTail (#1850)

Signed-off-by: Schlotter, Christian <christi.schlotter@gmail.com>",120,23,0,0,"2018-04-16 10:25:39","705.44"
"grafana/loki","7ff8463def8cb398e4a1e0a821205a211b1b50bd","MasslessParticle","2023-05-23 17:19:53","true","Fix query behavior in Single Binary and SSD deployments (#9476)

To keep ingesters from calling themselves, the AsyncStore was only being
used when the module was `Querier`, `Ruler`, or `Read`. This means that,
for some operations, ingesters were never queries when the deployment
mode was single-binary or `Backend` (where the ruler now lives).

This change scopes the async store to just the querier rather than all
storage access and always includes in it queriers.

Because the `AsyncStore` isn't automatically instantiated, now, I've
also moved `IngesterQuerier` to be a dependency to the store. That way
anything that wants to make an `AsyncStore` is guaranteed to have what
it needs.",67,61,1,1,"2018-04-16 10:25:39","1863.54"
"grafana/loki","45ac385946553ca3e197245361b67150a85c7ee8","MattiasSegerdahl","2023-05-01 08:31:55","true","Update 2020-02-Promtail-Push-API.md (#9306)

**What this PR does / why we need it**:

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",79,60,1,0,"2018-04-16 10:25:39","1841.17"
"grafana/loki","206be5422b5396a6989c5fd79630b323ec4ca860","tomwilkie","2018-04-23 19:10:53","false","Add readiness handler.",0,0,0,0,"2018-04-16 10:25:39","7.36"
"grafana/loki","15844432169a6c776db4822830c3ee2190db6bb9","trevorwhitney","2023-07-26 22:20:37","true","logcli: fix volume routes, add targetLabels and aggregateByLabels (#10059)

This PR fixes `logcli` to use the new endpoints for volume, which are
now `volume` and `volume_range` instead of `series_volume` and
`series_volume_range`. This PR also adds support for the additional
parameters `targetLabels` and `aggregateBy`.",53,63,1,1,"2018-04-16 10:25:39","1926.75"
"grafana/loki","5bd8c7dd5707db41e2e6e0a43c83d31fd550a8ce","shwetaap","2023-07-14 16:22:58","true","operator: Add Pod annotations with node topology labels to support zone aware scheduling (#9503)

Signed-off-by: Shweta Padubidri <spadubid@redhat.com>
Co-authored-by: Robert Jacob <rojacob@redhat.com>
Co-authored-by: Periklis Tsirakidis <periklis@redhat.com>",58,63,1,0,"2018-04-16 10:25:39","1914.5"
"grafana/loki","42522d794af11cdb0dfced4fe2f577b4839767a3","angaz","2023-02-16 13:56:05","true","logcli: Add parallel flags (#8518)",74,58,1,0,"2018-04-16 10:25:39","1761.15"
"grafana/loki","6f4526c3bc71515c26c06278868b31b7694a5830","JStickler","2023-02-07 10:10:24","true","Fix broken cross-reference in Helm installation. (#8430)",79,58,1,0,"2018-04-16 10:25:39","1751.99"
"grafana/loki","19451663631d1c4d06195e4f02669556f43c521f","nervo","2023-01-24 23:27:29","true","Helm: Generalize enableStatefulSetAutoDeletePVC (#8193)",86,57,1,0,"2018-04-16 10:25:39","1739.54"
"grafana/loki","489898f5292835bff86eaa1f4184823cd6a1a9a5","BenoitKnecht","2022-11-08 23:15:14","true","promtail/server: Disable profiling by default (#5400)

**What this PR does / why we need it**:

Add a `server.debug` option (that defaults to `false`) to enable the
`/debug/fgprof` endpoint in Promtail.

**Which issue(s) this PR fixes**:
Fixes #5005

Co-authored-by: Trevor Whitney <trevorjwhitney@gmail.com>",85,55,1,0,"2018-04-16 10:25:39","1663.53"
"grafana/loki","f5501469ab1c45a624613a1f9e81d4bfaedd3f48","periklis","2022-10-05 18:04:59","true","Upgrade operator gh workflows to go1.19 (#7341)",92,54,1,1,"2018-04-16 10:25:39","1630.32"
"grafana/loki","f22dbc2190921e70d38e8b915aa64964879b6b78","nvanheuverzwijn","2022-04-12 16:56:57","true","Update _index.md (#5871)

The new default for :
- `chunk_retain_period` is `0s`, not `30s`
- `chunk_idle_period` is `30m`, not `1h`
- `chunk_target_size ` is `1572864`, not `1048576`

According to https://grafana.com/docs/loki/v2.4/configuration/#ingester_config",319,48,0,0,"2018-04-16 10:25:39","1452.02"
"grafana/loki","2a0d510d3bc46c1eb10420e41a601c3ad5f1ae77","blockloop","2021-05-11 18:47:07","true","LOG-1289: set pvc quotas per size (#51)",192,37,0,0,"2018-04-16 10:25:39","1121.1"
"grafana/loki","2e1fd42540ef0648906771558442c6bdf2e2843a","tivvit","2020-07-24 11:11:49","true","Added support for tail to query frontend (#2032)

* Added support for tail to query frontend

* cleanup WsTailProxy

* used httputil.NewSingleHostReverseProxy insted of custom implementation, added tailproxy config

* proxy all unknown requests

* rename proxy to tailProxy

* default handler, if tailproxy url is set up default proxy is tailproxy

* embedded lokifrontend conf which adds tail_proxy_url

* fixed tail_proxy_url flag",122,27,0,0,"2018-04-16 10:25:39","828.53"
"grafana/loki","439e7bb7d66fac44f5c85d5937df057348101824","davkal","2019-04-17 13:46:44","true","Merge pull request #470 from daixiang0/add-update

Update helm docs",102,12,0,0,"2018-04-16 10:25:39","366.39"
"grafana/loki","adc42ccfad2b807b6d502a82fdc70897fa59bd44","daixiang0","2019-03-20 12:22:17","false","Tag with lastest (#236)

* Tag with latest


Signed-off-by: Xiang Dai <764524258@qq.com>",93,11,0,0,"2018-04-16 10:25:39","334.08"
"grafana/loki","ff244009bf701747e17fe188e6bee9de3447e553","daixiang0","2018-12-17 12:56:11","false","fix deploy issue (#142)

* fix deploy issue

Signed-off-by: Xiang Dai <764524258@qq.com>

* whitespace

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",37,8,0,0,"2018-04-16 10:25:39","241.1"
"grafana/loki","1f119e1356032e6a85785c4d11ce8eb972b5123a","MasslessParticle","2023-06-02 14:45:28","true","Prevent GetFactorOfTime from returning NaN (#9602)

`GetFactorOfTime` is used to calculate overlaps with chunk time ranges
-- particularly calls to `stats`. When a chunk has only one entry, it's
`start time == end time` and this `GetFactorOfTime` returns `NaN`.

The stats calculation is `uint64(total chunk bytes * factor)`. When
`factor` is `NaN`:

`uint64(total chunk bytes * factor) == uint64(math.Nan()) ==
9223372036854775808`

`uint64(math.Nan()) == 9223372036854775808` is an implementation detail
of golang.",69,62,1,1,"2018-04-16 10:25:39","1872.43"
"grafana/loki","066f0bf3c1d5737a5e35a1699799f12c02ffd6bd","owen-d","2021-08-10 18:46:24","true","Tenant/unordered (#4130)

* makes unordered writes a tenant config

* json tag annotation",114,40,0,1,"2018-04-16 10:25:39","1210.1"
"grafana/loki","d1f6a1968e324dcbf74bd14816598d4b180e2bd9","slim-bean","2022-04-15 00:20:10","true","Loki: Fix issue with recent change to flush code (#5932)

* fix flush chunks to pass a reference so we can mutate the chunk contents

Signed-off-by: Edward Welch <edward.welch@grafana.com>

* update the rest of the helper methods to take a reference of the chunk

Signed-off-by: Edward Welch <edward.welch@grafana.com>",320,48,0,1,"2018-04-16 10:25:39","1454.33"
"grafana/loki","3c479c8f9c747dd6abb8f3cbcdb430f6a74b4900","slim-bean","2020-03-23 15:58:53","true","promtail retry 429 rate limit errors, clarifying risks in the docs of configuring multiple client sections in promtail, also increased the backoff and retry settings in promtail.

Signed-off-by: Edward Welch <edward.welch@grafana.com>
(cherry picked from commit 6841c418ef70e37f87cc263bc5a2c6211c895ed4)",119,23,0,1,"2018-04-16 10:25:39","702.48"
"grafana/loki","5047079420f9b46ad8cb1a65c0a453bfb53d77b6","slim-bean","2021-03-11 12:58:30","true","2.2 release notes, changelog and upgrade notes

add upgrade note about fix to query_frontend queueing.",154,35,0,1,"2018-04-16 10:25:39","1055.61"
"grafana/loki","993044e28b43da97d653fc33f03ee41b05792741","rfratto","2019-09-09 22:40:40","false","ci/drone: fix deploy command by escaping double quotes in JSON body",118,17,0,1,"2018-04-16 10:25:39","508.76"
"grafana/loki","220770c6933f498f65d383ca59df72644242cca3","TeddyAndrieux","2022-11-22 14:02:27","true","helm/loki: Allow to provide selector for Loki persistence volume (#7743)",96,55,1,0,"2018-04-16 10:25:39","1677.15"
"grafana/loki","ea4a764143f43bb75e33096818d3e24b84def6fd","trevorwhitney","2022-11-24 09:19:38","true","[helm] Fix incorrect ingress paths when using single binary deployment (#7530)

**What this PR does / why we need it**:
The helm ingress template was copied over from the simple scalable chart
and does not work when deploying the chart in single binary
configuration. This fixes that by adding a set of single binary routes,
and conditionally configuring the ingress resource based on deployment
type.

**Which issue(s) this PR fixes**:
Fixes #7080

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the `CONTRIBUTING.md` guide
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",95,55,1,1,"2018-04-16 10:25:39","1678.95"
"grafana/loki","f4dfce413652b80363fba06a5cdbbfc9ba219bca","wapmorgan","2021-02-11 12:53:54","true","Patch 2 - fix link to another documentation files (#3292)

* Update configuration.md

* Update configuration.md",134,34,0,0,"2018-04-16 10:25:39","1025.6"
"grafana/loki","f14ddb8bb3f7ffac9e8a74a5de2f7adea25708e2","adityacs","2021-02-26 15:49:56","true","fix nested captured groups indexing in replace stage (#3381)

* fixes nested captured groups indexing in replace stage

* fix typo in test

* use lowercase names

* fix lint error

* fix lint error",135,34,0,1,"2018-04-16 10:25:39","1040.73"
"grafana/loki","44814cc274c22d2473049eb12fba30c4aba589ae","tomwilkie","2019-02-06 19:51:40","false","Compare lines directly.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",76,10,0,0,"2018-04-16 10:25:39","290.39"
"grafana/loki","d343c09aa9095c78b1b02fbf9053b00702356834","beorn7","2020-05-18 12:57:15","true","Accept suffixes to pod name in instance labels (#2080)

Currently, the instance label is just the pod name, but that's
insufficient,
cf. https://github.com/grafana/deployment_tools/issues/3441 .

In the near future, we'll suffix the pod name in the instance label
with container name and/or port name. To make this mixin still work,
adjust the `instance` label matcher.

Signed-off-by: beorn7 <beorn@grafana.com>",118,25,0,0,"2018-04-16 10:25:39","762.61"
"grafana/loki","c1490999556e31d6db2952e4788dc82c3850f09a","cyriltovena","2020-07-08 12:36:07","true","Fixes buffered iterator skipping very long lines. (#2306)

Funny enough this was triggered only with gzip and only with a certain size. But thanks for investigation here #2272 I was able to reproduce this with a test and indeed this was incorrect.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",125,27,0,1,"2018-04-16 10:25:39","812.59"
"grafana/loki","77225e8a7cb0a62c317ccb87a688966a74f2428f","jkroepke","2022-10-25 16:46:48","true","Remove prometheus CRDs (#7499)

**What this PR does / why we need it**:

Remove Prometheus CRDs from loki chart.

Signed-off-by: Jan-Otto Kröpke <jok@cloudeteer.de>
Signed-off-by: Jan-Otto Kröpke <mail@jkroepke.de>",89,54,1,0,"2018-04-16 10:25:39","1650.26"
"grafana/loki","2508dc16c4c9bb567eb687efebe0f07618b6321c","SmilingNavern","2019-09-11 12:55:05","false","Fix links to correct doc (#1005)


Co-authored-by: Alexander Danilov <smilingnavern@joom.com>",70,17,0,0,"2018-04-16 10:25:39","510.35"
"grafana/loki","8c98ee267ca9262b75278951c675d5019aaaca92","fpob","2021-03-03 13:56:23","true","Fix fluentd plugin when kubernetes labels were missing (#3358)

When kubernetes labels were missing in the received data, plugin failed
with error ""undefined method `each_key' for nil:NilClass"".",139,34,0,0,"2018-04-16 10:25:39","1047.65"
"grafana/loki","ca311c4d52a69c0dad57abff3ee758b0e14a7599","rfratto","2020-11-10 13:28:32","true","expose underlying promtail client (#2910)",124,31,0,1,"2018-04-16 10:25:39","934.63"
"grafana/loki","354427242bb135aec7d14b4b7ab76727bf3478b2","slim-bean","2019-04-16 21:28:46","false","updating the forked hpcloud/tail library to the fork maintained at github.com/grafana/tail",103,12,0,1,"2018-04-16 10:25:39","365.71"
"grafana/loki","c6ddd7044a7910addb2fb947cda43e9b3d5a070b","xperimental","2023-11-03 11:53:06","true","operator: Disable update of repo-internal dependencies (#11023)",11,66,1,1,"2018-04-16 10:25:39","2023.31"
"grafana/loki","6532f5d6683014fcdecf6cf7b2e521fde0971f66","alanconway","2023-04-04 04:29:02","true","operator: Restore minimum PVC sizes for 1x.extra-small (#9005)",80,59,1,0,"2018-04-16 10:25:39","1808.75"
"grafana/loki","98a2daa292cd1126df8f5a94837e310783b00634","bzeba","2023-02-03 16:49:11","true","docs(monitor-and-alert): Fix typo in ServiceMonitor spelling (#7693)

Co-authored-by: Karsten Jeschkies <karsten.jeschkies@grafana.com>",78,57,1,0,"2018-04-16 10:25:39","1748.27"
"grafana/loki","5447541e2ea25c57f4f27d0fb3054873ffcd90bc","Etran-H","2023-02-06 12:57:17","true","Fix open ""/tmp/*"" the system cannot find the path specified on windows (#8170)

Instead of hard-coding `/tmp` directory, use the OS default directory for temporary files",81,58,1,0,"2018-04-16 10:25:39","1751.11"
"grafana/loki","265aae86f508233dbd80766091353bdcb0c3fb04","jdbaldry","2023-01-30 12:14:20","true","Use organization ISSUE_COMMANDS_TOKEN with reduced scope (#8325)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>",83,57,1,0,"2018-04-16 10:25:39","1745.08"
"grafana/loki","9a516ce8135c23ab77022b2bb31e904ac5ef34af","longtomjr","2023-01-18 16:01:16","true","[docs] fix dead link in the docker client documentation (#8196)

**What this PR does / why we need it**:

Just fixes a dead link in the docker client docs.",85,57,1,0,"2018-04-16 10:25:39","1733.23"
"grafana/loki","fb6231bd6bea25afac3f3adf7d7e1f8738b83b85","dannykopping","2022-10-05 07:01:58","true","Add compactor_address to fix startup (#7332)

The `production/docker` docker-compose setup was broken because of a
missing configuration.",93,54,1,1,"2018-04-16 10:25:39","1629.86"
"grafana/loki","9d8d91c0451b75cc6a05846d45cd7e216d3ffaf9","ronensc","2022-01-05 07:20:32","true","Update hack_operator_make_run.md (#5025)

Due to the migration of loki-operator to this repo, the crd was renamed
`lokistacks.loki.grafana.com` -> `lokistacks.loki.openshift.io`",252,45,0,0,"2018-04-16 10:25:39","1354.62"
"grafana/loki","4d853b36e5e8c5f7b6b362f71928075d265079f4","cyriltovena","2020-01-14 22:45:08","true","Adds support for the old query string regexp in the frontend. (#1522)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",101,21,0,1,"2018-04-16 10:25:39","633.76"
"grafana/loki","ff2c5670f7d4928314d762acb5d6023744106d69","briangann","2019-06-14 09:02:03","false","rename fluent plugin and update docs",108,14,0,0,"2018-04-16 10:25:39","423.19"
"grafana/loki","b4dafac4885a5c347aaa72e555e066d636e49d4e","sandeepsukhani","2019-05-24 13:15:52","false","Changes for running Table Manager with loki in single binary (#600)",107,13,0,1,"2018-04-16 10:25:39","403.37"
"grafana/loki","8b8945de9499adbda12cad5a50dd0536001cc821","davkal","2019-04-08 16:50:21","true","Merge pull request #433 from daixiang0/fix-logcli

remove logcli config part",101,12,0,0,"2018-04-16 10:25:39","352.27"
"grafana/loki","889a729f4ddf1b55e960b33fe09a34a14d73e80c","daixiang0","2019-02-11 23:31:27","false","Fix helm install error (#305)

* update helm values yaml

- set persistence.enabled as 'false' as default since there is no pv as
default

- set persistence.storageClassName as 'default' since even if pv exists, pvc
still need storageClassName:

```
  Normal  FailedBinding  8s (x4 over 35s)  persistentvolume-controller  no persistent volumes available for this claim and no storage class is set
```

Signed-off-by: Xiang Dai <764524258@qq.com>

* helm: delete duplicate empty blank

Signed-off-by: Xiang Dai <764524258@qq.com>",80,10,0,0,"2018-04-16 10:25:39","295.55"
"grafana/loki","4b6df863338909b6a7e9f70fc90b4ba3b29f2a4b","trevorwhitney","2022-09-15 16:38:07","true","Add local k3d environment for enterprise-logs (#7146)

**What this PR does / why we need it**:

This adds a local k3d based development cluster for testing out the
enterprise logs side of the helm chart, which can be enabled by setting:

```
enterprise:
  enabled: true
```

It requires both the `gex-plugins` and `enterprise-logs` repos to be
checked out locally (though the latter soon will not be needed once the provisioner
is published). We need this environment when developing enterprise
features for the helm chart.",88,53,1,1,"2018-04-16 10:25:39","1610.26"
"grafana/loki","2766e0a8c7a0b292e3d5ad86d2611d7aa1d61c33","owen-d","2022-09-15 19:24:04","true","fixes nil interface value with non-nil type in cache construction (#7175)

Fixes a bug introduced in https://github.com/grafana/loki/pull/7013

This will panic when the interface's _value_ is nil because it's been
assigned a concrete type already and then passed as an interface.
Instead, we treat it as a nil interface with no type bound to it:

```
panic: runtime error: invalid memory address or nil pointer dereference
goroutine 40570 [running]:
github.com/grafana/loki/pkg/util/server.onPanic({0x2209320, 0x3dfae20})
	/src/enterprise-logs/vendor/github.com/grafana/loki/pkg/util/server/recovery.go:41 +0x53
github.com/grafana/loki/pkg/util/server.glob..func1.1.1()
	/src/enterprise-logs/vendor/github.com/grafana/loki/pkg/util/server/recovery.go:29 +0x3a
panic({0x2209320, 0x3dfae20})
	/usr/local/go/src/runtime/panic.go:838 +0x207
github.com/grafana/loki/pkg/storage/stores/indexshipper/compactor/generationnumber.(*GenNumberLoader).getCacheGenNumber(0x0, {0xc0081e14d7, 0x2})
	/src/enterprise-logs/vendor/github.com/grafana/loki/pkg/storage/stores/indexshipper/compactor/generationnumber/gennumber_loader.go:120 +0x60
github.com/grafana/loki/pkg/storage/stores/indexshipper/compactor/generationnumber.(*GenNumberLoader).getCacheGenNumbersPerTenants(0x2?, {0xc000e8c4d0?, 0x1, 0x0?})
	/src/enterprise-logs/vendor/github.com/grafana/loki/pkg/storage/stores/indexshipper/compactor/generationnumber/gennumber_loader.go:98 +0xe7
github.com/grafana/loki/pkg/storage/stores/indexshipper/compactor/generationnumber.(*GenNumberLoader).GetResultsCacheGenNumber(0x2b26298?, {0xc000e8c4d0?, 0xc0050ad080?, 0x2dcdeeb9bcc040e4?})
```",88,53,1,1,"2018-04-16 10:25:39","1610.37"
"grafana/loki","08cf2153d5f5aedeb06f853dfe620e1b976f2572","MichelHollands","2022-09-07 13:15:39","true","Add sequence num to log output for delete requests (#7087)

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

**What this PR does / why we need it**:

Print the sequence number of the delete request so the messages are not
all the same.

**Checklist**
- [ ] Documentation added
- [ ] Tests updated
- [ ] Is this an important fix or new feature? Add an entry in the
`CHANGELOG.md`.
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",82,53,1,1,"2018-04-16 10:25:39","1602.12"
"grafana/loki","3ff088173f292fc5c46016e655f0f925a7740803","sandeepsukhani","2021-02-16 16:19:38","true","dedupe index on all the queries for a table instead of query batches (#3338)

* dedupe index on all the queries for a table instead query batches

* convert sync.Mutex to sync.RWMutex in deduper to allow concurrent checks for isSeen",130,34,0,1,"2018-04-16 10:25:39","1030.75"
"grafana/loki","4f6a4c2a9331216144c0763b800d2c6f0b9c9cc0","sandeepsukhani","2020-08-27 11:33:05","true","cleanup boltdb files in queriers during startup/shutdown (#2558)",127,28,0,1,"2018-04-16 10:25:39","861.55"
"grafana/loki","1410808ee9f20917476fabaa78aa8849ba7c7d20","sandeepsukhani","2022-11-30 10:34:40","true","use grpc for communicating with compactor for query time filtering of data requested for deletion (#7804)

**What this PR does / why we need it**:
Add grpc support to compactor for getting delete requests and gen number
for query time filtering.
Since these requests are internal to Loki, it would be good to use grpc
instead of HTTP same as all the internal requests we do in Loki.

I have added a new config for accepting the grpc address of the
compactor. I tried having just the existing config and detecting if it
is a grpc server, but it was hard to do it reliably, considering the
different deployment modes we support. I think it is safe to keep it the
same and eventually deprecate the existing config.

**Checklist**
- [x] Documentation added
- [x] Tests updated
- [x] `CHANGELOG.md` updated",93,55,1,1,"2018-04-16 10:25:39","1685.01"
"grafana/loki","476c3961c2d7521d10a6fe92e3893324d3c605cf","pracucci","2019-07-25 21:17:57","false","Added -querier.query_timeout support (#788)",103,15,0,0,"2018-04-16 10:25:39","464.7"
"grafana/loki","b6004050a6b65b707be5d8b0dc7a1c60c3934b24","trevorwhitney","2023-01-18 17:24:07","true","[helm] Fix self-monitoring tenant secret (#8198)

**What this PR does / why we need it**:

https://github.com/grafana/loki/pull/8081 introduced a bug that caused
the `provisioner` job to create an incorrect secret for the
self-monitoring tenant used by the canary. This fixes that bug, as well
as adding a readme on how to use the `helm-cluster` k3d env.

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",84,57,1,1,"2018-04-16 10:25:39","1733.29"
"grafana/loki","2c2b42f885a1436d5da7a9d410e1d1e71c301169","daixiang0","2019-03-27 01:42:45","false","Add comment about external_labels

Signed-off-by: Xiang Dai <764524258@qq.com>",91,11,0,0,"2018-04-16 10:25:39","340.64"
"grafana/loki","6b277cd9dea7d15a38ef91d6443c7d6eba452c05","chaudum","2021-12-16 07:44:51","true","Make `go test` command replaceable in Makefile (#4934)

There are multiple drop-in replacements for the `go test` command, such
as [gotest](https://github.com/rakyll/gotest) or
[gotestsum](https://github.com/gotestyourself/gotestsum).

Setting the `GOTEST` environment variable allows for replacing the `go
test` command in the `test` make target to use the specified test
runner.

Usage:

```bash
GOTEST=gotest make test
```

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",230,44,0,1,"2018-04-16 10:25:39","1335.64"
"grafana/loki","3a0be4897512ec16a0e43cd5e0a49774cda87aed","kavirajk","2022-11-23 16:50:56","true","config: Improve error message loading config with ENV variables. (#7759)

**What this PR does / why we need it**:
Before:
```
Unable to parse config: ./clients/cmd/promtail/promtail-local-config.yaml: parse ""http://${LOKI_URL}localhost:3100/loki/api/v1/push"":
invalid character ""{"" in host name
```

After:
```
Unable to parse config: ./clients/cmd/promtail/promtail-local-config.yaml: parse ""http://${LOKI_URL}localhost:3100/loki/api/v1/push"":
invalid character ""{"" in host name. Use `-config.expand-env=true` flag if you want to expand environment variables in your config file
```
**Which issue(s) this PR fixes**:
Fixes #NA

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the `CONTRIBUTING.md` guide
- [x] `CHANGELOG.md` updated",93,55,1,1,"2018-04-16 10:25:39","1678.27"
"grafana/loki","e3a43c69721dd4ab2bd0cf4cca0371e61fd2ed49","kavirajk","2022-05-17 10:00:16","true","query-scheduler: Now proper support for `querier_forget_delay` (#6174)

* query-scheduler: Now proper support for `querier_forget_delay`

Since now shuffle sharding is supported on the `query-path` in Loki,
it makes sense to enable this config.

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Update pkg/scheduler/scheduler.go

Co-authored-by: Christian Simon <simon@swine.de>

* Update docs/sources/configuration/_index.md

Co-authored-by: Christian Simon <simon@swine.de>

Co-authored-by: Christian Simon <simon@swine.de>",75,49,0,1,"2018-04-16 10:25:39","1491.98"
"grafana/loki","bb2e952d6fcf1d1b79f393b8b8cf959af3f89bd8","kavirajk","2022-05-02 15:00:00","true","Fix(query-frontend): `/label/<name>/values` endpoint to use right set of middlewares (#6072)

* Fix(query-frontend): `/label/<name>/values` endpoint to use right middleware

Previously, only `/label/` and `/labels` endpoint were using correct tripperware middleware
on the query frontend(e.g: stats collector middleware)

This PR fixes it for `/label/<name>/values` endpoint as well.

This is useful to support `metrics.go` stats middleware for `label/{name}/values` endpoint as well.

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Remove `unhandledpath` test

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Remove unused test helper

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",74,49,0,1,"2018-04-16 10:25:39","1477.19"
"grafana/loki","1c4dd6ad40c987b71acfd9d924a42a630403f63b","MichelHollands","2023-03-09 09:42:00","true","Use changed metric in operational dashboard (#8749)

**What this PR does / why we need it**:

The metric `job_route` was changed to `cluster_job_route` in
https://github.com/grafana/loki/pull/8247. This PR updates this metric
in the operational dashboard.

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

---------

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",88,59,1,1,"2018-04-16 10:25:39","1783.97"
"grafana/loki","edc6b0bff76714ff584c20d7ff0235461a4f4a88","slim-bean","2023-03-31 12:27:23","true","Loki: Add a limit for the [range] value on range queries (#8343)

Signed-off-by: Edward Welch <edward.welch@grafana.com>

**What this PR does / why we need it**:

Loki does not currently split queries by time to a value smaller than
what's in the [range] of a range query.

Example

```
sum(rate({job=""foo""}[2d]))
```

Imagine now this query being executed over a longer window of a few days
with a step of something like 30m.

Every step evaluation would query the last [2d] of data.

There are use cases where this is desired, specifically if you force the
step to match the value in the range, however what is more common is
someone accidentally uses `[$__range]` in here instead of
`[$__interval]` within Grafana and then sets the query time selector to
a large value like 7 days.

This PR adds a limit which will fail queries that set the [range] value
higher than the configured limit.

It's disabled by default.

In the future it may be possible for Loki to perform splits within the
[range] and remove the need for this limit, but until then this can be
an important safeguard in clusters with a lot of data.


**Which issue(s) this PR fixes**:
Fixes #8746

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

---------

Signed-off-by: Edward Welch <edward.welch@grafana.com>
Co-authored-by: Karsten Jeschkies <karsten.jeschkies@grafana.com>
Co-authored-by: Vladyslav Diachenko <82767850+vlad-diachenko@users.noreply.github.com>",83,59,1,1,"2018-04-16 10:25:39","1806.08"
"grafana/loki","5722696703bda5bdb63c9605de5dd53aa3d770c8","ivanahuckova","2023-08-23 15:43:57","true","Update CODEOWNERS to include logs team for grammar file (#10325)

**What this PR does / why we need it**:
To keep LogQL grammar in sync with
https://github.com/grafana/lezer-logql, we would like to add
@grafana/observability-logs as a co-codeowner for grammar file
`/pkg/logql/syntax/expr.y` to get notification when this file change.",49,64,1,0,"2018-04-16 10:25:39","1953.47"
"grafana/loki","8e9dbac6f937779c7bebf92d253ccca59dabf047","slim-bean","2020-04-01 17:28:26","true","Merge branch 'release-1.4.x'

# Conflicts:
#	CHANGELOG.md",121,23,0,1,"2018-04-16 10:25:39","710.54"
"grafana/loki","cd7ebf2ae007531eebb7a200d0d82849476959ff","owen-d","2022-06-03 15:08:30","true","exposes line length hist on distributors  (#6309)

* exposes line length hist on distributors + fixes some metric instantiation

* adjusts buckets",72,50,0,1,"2018-04-16 10:25:39","1508.2"
"grafana/loki","3e7e44400a0c8c36d5a4a2da77590ceaa42fcb0e","vlad-diachenko","2022-09-26 12:08:48","true","bumped GEL version in Loki helm chart to v1.5.2 (#7241)

GEL release 1.5.2",86,53,1,0,"2018-04-16 10:25:39","1621.07"
"grafana/loki","e6f431ad460b5e75edeff61596551991501549c6","slim-bean","2019-07-17 20:11:12","false","finishing up loki-canary move into loki repo",101,15,0,1,"2018-04-16 10:25:39","456.66"
"grafana/loki","de4993f9216431942cca0b3f09ea21a851b2907e","slim-bean","2021-11-03 12:51:54","true","explicitly define allowed HTTP methods on HTTP endpoints (#4627)",170,42,0,1,"2018-04-16 10:25:39","1292.85"
"grafana/loki","1deeecef690eb3e96d7be8164792fc6e68cb59f2","mattmendick","2020-01-17 19:35:46","false","Removing third-party link (#1546)

Removing the third-party link. Google is good for finding references or other discussion outside the maintainer's architectural presentations and discussion and directly related projects such as Grafana.",104,21,0,0,"2018-04-16 10:25:39","636.63"
"grafana/loki","86d33a4e4a87eaeb0d9016bdff10ff7259525968","ssncferreira","2022-12-14 16:46:16","true","Add CI step to check generated documentation to check pipeline (#7938)

**What this PR does / why we need it**:

Follow up from PR: https://github.com/grafana/loki/pull/7916 to add a CI
step to check if the configuration flag documentation file
`doc/sources/configuration/_index.md` was generated successfully.

Requirements:
* CI `check` pipeline should fail if the documentation file is updated
manually
* CI `check` pipeline should fail if registration flags are changed in
the code, but the documentation file is not generated.

**Which issue(s) this PR fixes**:
Fixes https://github.com/grafana/loki-private/issues/83

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the `CONTRIBUTING.md` guide
- [ ] Documentation added
- [ ] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",101,56,1,0,"2018-04-16 10:25:39","1699.26"
"grafana/loki","a0eb507fead4fab828330ab6ac54bc9f48f8a209","cstyan","2021-12-01 19:41:07","true","Simplify chunks dashboard label selectors + port some more internal (#4850)

chunks related panels.

Signed-off-by: Callum Styan <callumstyan@gmail.com>",212,43,0,1,"2018-04-16 10:25:39","1321.14"
"grafana/loki","86d196ef21c20409f2bff3398a72dfe08bbacf41","periklis","2022-03-14 10:42:15","true","operator: Use lokistack name as prefix for owned resources (#5607)",304,47,0,1,"2018-04-16 10:25:39","1423.76"
"grafana/loki","99bfd1cc5e6b34c4cefd8290562418c9aec3ec4b","owen-d","2021-02-25 14:08:54","true","design doc/ordering constraint removal (#3268)

* [wip] ordering design doc

* moves variance budget to afterthoughts section

* chunk sync

* followups

* edits & chunk diagram

* edits

* edits

* corrects date",137,34,0,1,"2018-04-16 10:25:39","1039.66"
"grafana/loki","f905e77259f2eb9bf35c34807cc5ea4ef2886c6e","owen-d","2020-08-31 21:37:51","true","exports grouploader (#2578)",119,28,0,1,"2018-04-16 10:25:39","865.97"
"grafana/loki","6eab7be5b413229784ab597b4fad23ccd0ef722b","owen-d","2021-10-29 17:44:52","true","a few doc fixes in preparation for 2.4 (#4597)",167,42,0,1,"2018-04-16 10:25:39","1289.06"
"grafana/loki","70900be57dd2e18a8c5e7d94dec5268fc607ccc7","owen-d","2020-06-23 15:59:02","true","avoids further time splitting in querysharding mware (#2252)

* avoids further time splitting in querysharding mware

* removes duplicate utility fns

* linting",137,26,0,1,"2018-04-16 10:25:39","797.73"
"grafana/loki","3344d59fb5256907429a89f4f9f77613767c2353","chaudum","2023-03-23 12:54:15","false","Extract scheduler queue metrics into separate field

This allows for easier passing of the metrics to the scheduler
instantiation.

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",82,59,1,1,"2018-04-16 10:25:39","1798.1"
"grafana/loki","f00a235942539d69e815c26d183fe601ca9ce9a1","kavirajk","2021-06-28 08:35:18","true","Update steps to release versioned docs (#3897)

* Update steps to release versioned docs.

This makes versioned docs in consistent with Grafana.
More details:
https://github.com/grafana/website/pull/4970
https://github.com/grafana/website/pull/4970

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Add step to update `latest_version`

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",111,38,0,1,"2018-04-16 10:25:39","1167.67"
"grafana/loki","294fd33a38b46699143708376184496c080fa2e7","kavirajk","2022-03-09 09:17:19","true","Make Loki adopters visible in README (#5586)

* Make Loki adopters visible in README

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Update README.md

Co-authored-by: Christian Haudum <christian.haudum@gmail.com>

Co-authored-by: Christian Haudum <christian.haudum@gmail.com>",305,47,0,1,"2018-04-16 10:25:39","1418.7"
"grafana/loki","331fa6d7b09277eb14ea47d490396fb7b30087f7","DylanGuedes","2021-10-27 16:31:16","true","Docs: Add virtual targets docs (#4565)

* Add CHANGELOG entry and updated modes diagram.

* Update documentation with the new hybrid mode.

- Update targets with new 'read' and 'write' options
- Add new docker-compose yaml that exemplifies how to use new 'read' and
  'write' targets

* Add missing targets to configuration docs.

- Missing ones: index-gateway, ingester-querier, query-scheduler",166,42,0,1,"2018-04-16 10:25:39","1287"
"grafana/loki","e81dd8aed245cba6c93c370ae229e79bfe353cec","DylanGuedes","2023-05-23 10:15:05","true","Loki: Bump `dskit` to inherit new backoff configs (#9484)

**What this PR does / why we need it**:
Bump `dskit` to inherit https://github.com/grafana/dskit/pull/296.
It will allow us to configure custom backoff timeouts.

**Which issue(s) this PR fixes**:
N/A",67,61,1,1,"2018-04-16 10:25:39","1863.24"
"grafana/loki","2911a74175444294b94496a8645acdbffdf6329a","xperimental","2022-08-17 15:31:48","true","operator: Reconcile owner reference for existing objects (#6923)",84,52,0,1,"2018-04-16 10:25:39","1582.21"
"grafana/loki","1a970c54ac1dc79c617db2af11fa1c1432c0a90b","slim-bean","2021-08-10 21:19:13","true","fix build info which was not updated after build package changed (#4135)",115,40,0,1,"2018-04-16 10:25:39","1210.2"
"grafana/loki","1c56aa91eff912a8b4db9faaaebdd18824ba1d63","jeschkies","2023-11-02 10:53:54","true","Check switches on syntax.Expr for exhaustiveness. (#11113)

**What this PR does / why we need it**:
In preparation to serlialize the LogQL AST as JSON we are declaring the
`syntax.Expr` as a ""sum type"" and test all switch statements on it to be
exhaustive.

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)
- [ ] If the change is deprecating or removing a configuration option,
update the `deprecated-config.yaml` and `deleted-config.yaml` files
respectively in the `tools/deprecated-config-checker` directory.
[Example
PR](https://github.com/grafana/loki/pull/10840/commits/0d4416a4b03739583349934b96f272fb4f685d15)",14,66,1,1,"2018-04-16 10:25:39","2022.27"
"grafana/loki","f313a9ff4f6b10bcbc9124707b3767e0189fc1a9","slim-bean","2022-04-06 07:49:21","true","Build: update package for fuzzer after refactoring (#5776)

* Update the package name to reflect the moved package after refactoring

Signed-off-by: Ed Welch <edward.welch@grafana.com>

* also include makefile

Signed-off-by: Ed Welch <edward.welch@grafana.com>",322,47,0,1,"2018-04-16 10:25:39","1445.64"
"grafana/loki","4ed3b117d2a3eacd8b0328fef6d66850b3e77117","jeschkies","2023-11-02 10:06:29","true","Use newest build image 0.31.2 with golangci-lint update. (#11118)

**What this PR does / why we need it**:
This just updates the Loki build imaage changed in #11114.

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)
- [ ] If the change is deprecating or removing a configuration option,
update the `deprecated-config.yaml` and `deleted-config.yaml` files
respectively in the `tools/deprecated-config-checker` directory.
[Example
PR](https://github.com/grafana/loki/pull/10840/commits/0d4416a4b03739583349934b96f272fb4f685d15)",14,66,1,1,"2018-04-16 10:25:39","2022.24"
"grafana/loki","26c7af7923bcec03ec25dbd8a993fa0661d5e992","dannykopping","2023-08-17 13:52:53","true","Add PR #10281 to release notes for next release (#10283)

Co-authored-by: grafanabot <bot@grafana.com>",52,64,1,1,"2018-04-16 10:25:39","1947.39"
"grafana/loki","5c3e2a5cf87c87898ebb0f0b611c3dcb214d0689","bboreham","2023-06-30 17:39:55","true","Fix link to blog in readme (#9838)

I noticed this link was 404-ing.",60,62,1,0,"2018-04-16 10:25:39","1900.55"
"grafana/loki","56593efa568984a3f941432d33fb8f7322dabb43","MattiasSegerdahl","2023-05-12 21:30:09","true","Update geoip.md (#9334)

- Corrected spelling mistake, databse
- Added link to Maxmind's website
- Added link to Grafana blog post

**What this PR does / why we need it**:

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

---------

Co-authored-by: Travis Patterson <travis.patterson@grafana.com>",72,61,1,0,"2018-04-16 10:25:39","1852.71"
"grafana/loki","24d426ce4400d3197eef6698c1c058e12db652bb","DylanGuedes","2023-04-24 10:42:27","true","Distributor: Add AutoForget support (#8067)

**What this PR does / why we need it**:
- Add auto-forget capabilities to distributors
- Change the distributor's ring implementation from Lifecycler to BasicLifecycler. That AutoForget delegate requires it.",80,60,1,1,"2018-04-16 10:25:39","1834.26"
"grafana/loki","dd098bbd6d0a011c9bf74e63bbcf20782ae0b1b7","jeschkies","2022-11-24 09:14:52","true","Return error on JSON serialization error. (#7745)

Clean up of https://github.com/grafana/loki/pull/7721",95,55,1,1,"2018-04-16 10:25:39","1678.95"
"grafana/loki","7d750ea564a63090a1c3382ee492d7c92ebf1c88","trevorwhitney","2022-09-08 17:18:11","true","Add chart-tools and chart-releaser for helm (#7095)

**What this PR does / why we need it**:

Adds the `chart-tools` and `chart-releaser` binaries to the nix shell
for doing helm releases/testing.",86,53,1,1,"2018-04-16 10:25:39","1603.29"
"grafana/loki","ead8c345e6ffebd09916e261cb8a58ed7fdbf723","sandeepsukhani","2022-05-17 13:18:01","true","skip empty object key returned by some s3 compatible storage while listing boltdb-shipper index (#6123)",75,49,0,1,"2018-04-16 10:25:39","1492.12"
"grafana/loki","03153e89bffafb6551667ce00e20046089b3a4cc","MasslessParticle","2022-05-04 21:38:58","true","clean up the pr diff message (#6098)

* clean up the pr diff message

* add dependency to clone-main to avoid possible race

* don't start tests before everything is cloned

* formatting change",75,49,0,1,"2018-04-16 10:25:39","1479.47"
"grafana/loki","361ba12c2d4405ab3e96772d69e1ef3ee6ac79f0","periklis","2021-10-18 06:42:05","false","Move image tag v0.0.1",159,42,0,1,"2018-04-16 10:25:39","1277.59"
"grafana/loki","88c25965dad6cae557b63b29c83996a389704a3f","cyriltovena","2021-07-29 06:51:43","true","Inject the org-id if possible from the start. (#4068)

This allows the http logger to include the org-id.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",100,39,0,1,"2018-04-16 10:25:39","1198.6"
"grafana/loki","7b7b1844ca83c5a3a4cf6457595ae3da5dddeae3","sandeepsukhani","2020-10-22 09:38:26","true","add a metric in compactor to record timestamp of last successful run (#2788)",117,30,0,1,"2018-04-16 10:25:39","916.47"
"grafana/loki","2d5b6b54a0965f0296643d2bd9be73448fdddd4e","cyriltovena","2020-07-29 13:25:00","true","Add more precisions on the docker driver installed on the daemon. (#2435)

It will work only for new containers, as explained by one of our users in the mailing list.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",125,27,0,1,"2018-04-16 10:25:39","833.62"
"grafana/loki","43ef52e89d745d59ee82fdef312ac31c512e8df2","daixiang0","2020-01-16 03:14:15","false","Add docker install doc (#1227)

* Add docker install doc

Signed-off-by: Xiang Dai <764524258@qq.com>

* feedback

Signed-off-by: Xiang Dai <764524258@qq.com>",101,21,0,0,"2018-04-16 10:25:39","634.95"
"grafana/loki","63f93520af8938df46046aacb0b2b2f3c7a441cc","daixiang0","2018-12-18 13:40:42","false","update consul version (#148)

Signed-off-by: Xiang Dai <764524258@qq.com>",37,8,0,0,"2018-04-16 10:25:39","242.14"
"grafana/loki","62707bf5178aa5e88b45854690a38767787d7b20","jeschkies","2022-10-14 08:59:26","true","Loki mixin: Correct Loki datasource variable name. (#7422)",93,54,1,1,"2018-04-16 10:25:39","1638.94"
"grafana/loki","c3aaebe509c451c9359f7b16f68a1351f2b3c123","jeschkies","2021-08-06 07:20:11","true","Support frontend V2 with query scheduler. (#4071)

* Support Cortex Frontend V2.

* Format code.

* Start query scheduler in Docker compose.

* Model query flow in sequence diagram.

* Model calls to downstreamer.

* Move diagram to docs.

* Embed generated SVG.

* Descripe calls.

* Launch Cortex query scheduler.

* Disable sharding for now.

* Log which framework is used.

* Configure querier to use scheduler.

* Remove unwanted docs.

* Enable query splitting again.

* Document scheduler address.

* Document new scheduler options for frontend as well.

* Remove unused querier option.

* Use new query-scheduler module in Loki.

* Remove unused option.

* Document `max_queriers_per_tenant`.",103,40,0,1,"2018-04-16 10:25:39","1205.62"
"grafana/loki","5fe4ccbe1d9f106fa132bc0b4ab0a555a66ba054","slim-bean","2019-05-14 16:37:07","false","adding namespace to ksonnet config, moved images into a config file",100,13,0,1,"2018-04-16 10:25:39","393.51"
"grafana/loki","d9a522e5e6f93965324410d4b75a4cabd9ea1ac6","jeschkies","2022-06-24 10:01:49","true","Disable index gateway client on read target. (#6490)",69,50,0,1,"2018-04-16 10:25:39","1528.98"
"grafana/loki","e3cd312c376082dfcb9960aba22c58cb50391d6f","liguozhong","2022-08-26 10:38:12","true","[fix panic] s3: fix object nil point (#6970)

**What this PR does / why we need it**:
fix a s3 panic.
```go
panic: runtime error: invalid memory address or nil pointer dereference
[signal SIGSEGV: segmentation violation code=0x1 addr=0x0 pc=0x14fec7b]

goroutine 6271245 [running]:
github.com/grafana/loki/pkg/storage/chunk/client.(*client).getChunk(_, {_, _}, _, {{0xb130cf997b272f99, {0xc05077e6a0, 0x1b}, 0x182d1aefb2d, 0x182d1b47984, 0x9fab6388}, ...})
/loki@v1.6.2-0.20220816085209-65ed7b60fbd4/pkg/storage/chunk/client/object_client.go:171 +0x2fb
```",82,52,0,1,"2018-04-16 10:25:39","1591.01"
"grafana/loki","37169ca444494f41213a7852c3d226736a1b4b4d","slim-bean","2023-02-09 16:42:23","true","Loki: Process ""Limited"" queries sequentially and not in parallel (#8482)

Signed-off-by: Edward Welch <edward.welch@grafana.com>",79,58,1,1,"2018-04-16 10:25:39","1754.26"
"grafana/loki","12253ecf1bfcdbfacef4c88ab0716c47696e08df","trevorwhitney","2021-09-17 20:29:30","true","allow ingester and distributor to run on same instance (#4348)

* allow ingester and distributor to run on same instance

Signed-off-by: Trevor Whitney <trevorjwhitney@gmail.com>

* add comment around conditional distributor Push registration

Co-authored-by: Ed Welch <edward.welch@grafana.com>

* lint

Co-authored-by: Ed Welch <edward.welch@grafana.com>",140,41,0,1,"2018-04-16 10:25:39","1247.17"
"grafana/loki","407afce0e3391cebe1e77b5db617efa6fb22a5ff","slim-bean","2021-02-11 12:52:38","true","Loki: fix validation error and metrics (#3307)

* Remove the helper functions for creating errors as they cause unintended value manipulation if the value contains any valid golang printf substitute characters, e.g. %s

* Improve error message for invalid labels, increment metrics for lines dropped for invalid labels.",134,34,0,1,"2018-04-16 10:25:39","1025.6"
"grafana/loki","e4a53605862c7c7fac7507b1eeaa7f1b5361b54f","pstibrany","2020-06-01 16:45:24","true","Update vendored Cortex to master (1.1+) (#2149)

* Updated Cortex to master (post 1.1)

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Use new modules system from Cortex.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Treat query errors reported by chunk store as client errors.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Removed obsolete tests.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Fix race for ct variable.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Fix test.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>",127,25,0,0,"2018-04-16 10:25:39","775.76"
"grafana/loki","3c47735deabab6fcdc7fad9bb15016dcefa0d692","MichelHollands","2021-06-03 08:53:30","true","Add a QueryFrontendTripperware module (#3792)

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",208,38,0,1,"2018-04-16 10:25:39","1142.69"
"grafana/loki","72e6fcc9d223cd8951b0b0937647b109bf234950","xperimental","2022-11-23 10:14:43","true","operator: Move Loki TLS configuration into ConfigMap (#7738)",93,55,1,1,"2018-04-16 10:25:39","1677.99"
"grafana/loki","db31d96425dd764263ade54aa5b0259b1646785e","slim-bean","2019-04-16 02:27:01","false","Cleaning up metrics when files are deleted, adding tests to verify the metrics.",100,12,0,1,"2018-04-16 10:25:39","359.67"
"grafana/loki","b16ad8cb38370b6acd17b22f699b002f983ca247","jeschkies","2022-10-27 15:28:33","true","Document new Helm Charts (#7034)

**What this PR does / why we need it**:
This change describes various Helm related tasks such as installing Loki
and configuring meta monitoring. It also explains different concepts
related to the new Helm chart and provides a reference of the new Helm
values file.

**Which issue(s) this PR fixes**:
Fixes #7035",89,54,1,1,"2018-04-16 10:25:39","1652.21"
"grafana/loki","0f3eecd2091f7ec50b987dbfa4a2c024ad1844ca","jeschkies","2022-12-15 12:53:40","true","Show help tooltip on hover in sizing tool. (#7919)",100,56,1,1,"2018-04-16 10:25:39","1700.1"
"grafana/loki","03b734c573aed53d856835ba2395fc9cb348e526","ssncferreira","2022-03-08 08:20:02","true","Fix frontend-worker error message (#5567)",304,47,0,0,"2018-04-16 10:25:39","1417.66"
"grafana/loki","f5f17538517ce1b8e93eab6cc06cd6d8171857a3","jeschkies","2023-03-21 10:24:01","true","Print duration in error messages with more readable. (#8816)

**What this PR does / why we need it**:
The old error messages would print only up to hours. E.g. `169h30s`.
This change will print it as `7d1h30s`. See
[model.Duration](https://github.com/prometheus/common/blob/66b493f42b757378fbad83e42b0ed441d425a17b/model/time.go#L259-L290)
for details.

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [x] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",84,59,1,1,"2018-04-16 10:25:39","1796"
"grafana/loki","c6d783cc33d839cbc2bdc2240d6038551bf6c1e6","xperimental","2022-03-02 13:54:23","true","Fix port name used for GRPC service (#5489)",298,46,0,1,"2018-04-16 10:25:39","1411.89"
"grafana/loki","420798df65fc5e0ec357c7ad45fbe336260a3725","KMiller-Grafana","2021-08-09 21:45:25","true","Update Loki README with better links and descriptions (#4088)

* Update Loki README with better links and descriptions

* Update README.md

Co-authored-by: Danny Kopping <dannykopping@gmail.com>

* Docs: Address review comments; add explanatory msg

Co-authored-by: Danny Kopping <dannykopping@gmail.com>",112,40,0,0,"2018-04-16 10:25:39","1209.22"
"grafana/loki","2c84959901bccf831de2d5eb0d405363f4977e98","dannykopping","2023-09-05 12:40:27","true","Distributor: add ingester append timeouts error (#10456)

**What this PR does / why we need it**:
Failing to send samples to ingesters because the request exceeded its
timeout is a very clear signal that ingesters are unable to keep up with
demand. In an incident today we saw that ingesters' push latencies were
increased sharply by an expensive regex query which was starving other
goroutines of time on CPU.

This new alert `loki_distributor_ingester_append_timeouts_total` will
give us a high-signal metric which we can use for alerting.",46,65,1,1,"2018-04-16 10:25:39","1965.34"
"grafana/loki","0f2f42de01b1ece5406083bab2e4b42f5884bb33","dannykopping","2021-09-22 09:41:59","true","Runtime config: do not validate nil limits (#4251)

* Do not validate nil limits

If an overrides file has an entry for a tenant without any limits, this will cause a panic

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Warn when an empty limit is skipped

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",127,41,0,1,"2018-04-16 10:25:39","1251.72"
"grafana/loki","2b4ebbd578442d9a025c6651046b7fd4861302c2","periklis","2022-04-16 07:01:16","true","Add SIG operator team to governance doc (#4977)

* Add SIG operator team to governance doc

* Update docs/sources/community/governance.md

Co-authored-by: Richard Hartmann <RichiH@users.noreply.github.com>

* Update docs/sources/community/governance.md

Co-authored-by: Richard Hartmann <RichiH@users.noreply.github.com>

Co-authored-by: Richard Hartmann <RichiH@users.noreply.github.com>",321,48,0,1,"2018-04-16 10:25:39","1455.61"
"grafana/loki","b1ae906517852c0b4a249fe55901fc8096eecbbe","bboreham","2021-12-09 18:59:42","true","ingester: use consistent set of instances (#4904)",219,44,0,0,"2018-04-16 10:25:39","1329.11"
"grafana/loki","6a4ba250a658f5a99428a347a4e03bc56a915f62","paul1r","2023-05-02 20:02:11","true","Bump grafana and grafana-enterprise versions used for GEL Helm env (#9368)

**What this PR does / why we need it**:
Bumps the version of Grafana/Grafana-Enterprise being used to what is
currently current.

**Which issue(s) this PR fixes**:
This gets rid of a warning displayed about ""The current Grafana version
is not supported"" in relation to the GEL plugin.",80,61,1,0,"2018-04-16 10:25:39","1842.65"
"grafana/loki","ba0261f9f93e7efce56d96bf9418c7d97722ce6e","pracucci","2019-07-11 06:55:03","false","Fixed RFC3339Nano examples in doc",100,15,0,0,"2018-04-16 10:25:39","450.1"
"grafana/loki","ca19683511aebc16a61ef49e251d4df01e3e68fe","pstibrany","2020-03-17 18:36:49","true","loki: update Cortex to master (#1799)

* Update Cortex to master

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Integrate latest Cortex master changes into loki

- Frontend worker now needs to be started explicitly
- Lifecycler no longer exits on error. Distributor and Ingester do that now

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Lint

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* go mod tidy

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Update Cortex to master. After 0.7 release, it is now showing as v0.7.1-...

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>",115,23,0,0,"2018-04-16 10:25:39","696.59"
"grafana/loki","99ac2e0c305214d3947ce3fabdbabe76a6c899b6","umamialex","2021-03-03 13:30:08","true","docs: promtail: Fix typo w/ windows_events hyperlink. (#3419)",139,34,0,0,"2018-04-16 10:25:39","1047.63"
"grafana/loki","b909be3c9546a77cc8327b1590eaa29dd5465116","tomwilkie","2018-11-22 16:03:24","false","Add instructions for enable explore.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",5,7,0,0,"2018-04-16 10:25:39","216.23"
"grafana/loki","9b2786bde3781510925b747cb553d54a8030789c","MasslessParticle","2022-05-30 11:20:11","true","Fix delete updates (#6194)

* Fix delete updates

* Update pkg/storage/stores/shipper/compactor/deletion/delete_requests_client.go

Co-authored-by: Michel Hollands <42814411+MichelHollands@users.noreply.github.com>

* Add compactor address to the storage config

* review comments

* Review feedback

Co-authored-by: Michel Hollands <42814411+MichelHollands@users.noreply.github.com>",72,49,0,1,"2018-04-16 10:25:39","1505.04"
"grafana/loki","02e0b3ae89fb5b0dc8849448a1cd2911e0efa1a2","jmherbst","2023-01-13 09:33:26","true","Fix logentry drop to more intuitively match numeric fields (fixes #7011) (#7292)

**What this PR does / why we need it**:

1. Makes the `drop` stage matching for numeric fields more intuitive. 
2. Adds tests scenarios to confirm fix

**Which issue(s) this PR fixes**:
Fixes #7011",97,57,1,0,"2018-04-16 10:25:39","1727.96"
"grafana/loki","23e59fa4a95b64d2a77ac6377f287938ed363872","MasslessParticle","2023-07-14 20:58:34","true","reset pipeline caches when tailing rather than making a new pipeline (#9949)

Recent query optimizations made pipeline creation more expensive with
the assumption that it occurred relatively infrequently. To avoid
growing pipline caches without bound, integers recreate pipelines on
every push. The combination of these things means that tailing
high-volume streams can cause ingester failure.

This fix adds the ability to clear pipeline caches so we don't need to
create a new one each time.",58,63,1,1,"2018-04-16 10:25:39","1914.69"
"grafana/loki","3d2c643bba25596b2593d76959921e9befa2e561","joe-elliott","2019-11-06 19:09:43","false","Rolled back to v0.8.0 (#1237)

Signed-off-by: Joe Elliott <number101010@gmail.com>",67,19,0,0,"2018-04-16 10:25:39","565.61"
"grafana/loki","1f8fc658266d763a18e75e2e4fbbb3cf8cbd9406","liguozhong","2022-04-08 10:25:30","true","[Optimization] boltdb: reduce the code block affected by the lock tablesMtx in the TableManager.query() function. (#5829)",320,48,0,1,"2018-04-16 10:25:39","1447.75"
"grafana/loki","322783e3d8e1940900c944de94f112db51ecd7de","liguozhong","2023-02-06 14:40:43","true","LogQL: [optimization] syntax: Replace ""panic"" in ""/pkg/logql/syntax"" with ""error"" (#7208)",81,58,1,1,"2018-04-16 10:25:39","1751.18"
"grafana/loki","098b5a2d37d51d2e9c01adac6a4abd46a80fbc95","liguozhong","2022-04-01 19:52:39","true","[new] promtail pipeline:  Promtail Rate Limit stage #5048 (#5051)

* [new] promtail pipeline:  Promtail Rate Limit stage #5048

* [new] promtail pipeline: Promtail Rate Limit stage #5048 #5051

* [new] promtail pipeline: Promtail Rate Limit stage #5048 #5051

* [new] promtail pipeline: Promtail Rate Limit stage #5048 #5051

* Update clients/pkg/logentry/stages/limit.go

Co-authored-by: Karsten Jeschkies <k@jeschkies.xyz>

* [new] promtail pipeline: Promtail Rate Limit stage #5048 #5051

* [new] promtail pipeline: Promtail Rate Limit stage #5048 #5051

* [new] promtail pipeline: Promtail Rate Limit stage #5048 #5051

* Update docs/sources/clients/promtail/pipelines.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* Update docs/sources/clients/promtail/stages/limit.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* Update docs/sources/clients/promtail/stages/limit.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* [new] promtail pipeline: Promtail Rate Limit stage #5048 #5051

* [new] promtail pipeline: Promtail Rate Limit stage #5048 #5051

* [new] promtail pipeline: Promtail Rate Limit stage #5048 #5051

* [new] promtail pipeline: Promtail Rate Limit stage #5048 #5051

* Update docs/sources/clients/promtail/stages/limit.md

* Update docs/sources/clients/promtail/stages/limit.md

* fix import package

* Update docs/sources/clients/promtail/stages/limit.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* Update docs/sources/clients/promtail/stages/limit.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* Update docs/sources/clients/promtail/pipelines.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

Co-authored-by: Karsten Jeschkies <k@jeschkies.xyz>
Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>
Co-authored-by: Cyril Tovena <cyril.tovena@gmail.com>",319,47,0,1,"2018-04-16 10:25:39","1441.14"
"grafana/loki","6c3f66ba84c9481088120d875166ade78022ea9b","tomwilkie","2018-05-16 10:42:32","false","Fixup.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",0,1,0,0,"2018-04-16 10:25:39","30.01"
"grafana/loki","656c10dfbb793ddea86163e9ed815c1a8ead1e1a","tomwilkie","2018-05-16 10:38:08","false","Update vendor.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",0,1,0,0,"2018-04-16 10:25:39","30.01"
"grafana/loki","cc7d4e5aa9c53cc0e64b25d8f650a6906fdd5877","tomwilkie","2018-05-16 09:31:54","false","Fix NPE.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",0,1,0,0,"2018-04-16 10:25:39","29.96"
"grafana/loki","a96161243632cb9ac6aa3f804dfe9599508a4a02","dannykopping","2021-10-07 14:25:03","true","Ruler: Refactoring remote-write config overrides (#4429)

* Refactoring remote-write config overrides

Replacing mergo.Merge because it cannot distinguish between a nil and an empty slice, which is needed to overwrite relabel configs

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Simplifying condition

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Merging headers instead of overwriting blindly

Adding extra check for header smuggling

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Unexporting OverwriteMarshalingStringMap field, preferring constructor

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",140,42,0,1,"2018-04-16 10:25:39","1266.92"
"grafana/loki","50ca4d51868cdddc4889f808bfb614fcda5db20d","ssncferreira","2022-01-24 15:56:01","true","Addition of cortex' queryrange tests (#5183)",273,45,0,0,"2018-04-16 10:25:39","1373.98"
"grafana/loki","942d65935cc3537d98f963f21b95e0433e67fcbc","periklis","2022-06-29 16:48:41","true","Fix operator forwarding logs docs (#6545)",73,50,0,1,"2018-04-16 10:25:39","1534.27"
"grafana/loki","14aaa21c63065ded2a99d8449ce6c6e7d4108a10","periklis","2023-07-24 12:03:09","true","operator: Update Loki operand to v2.8.3 (#10019)",54,63,1,1,"2018-04-16 10:25:39","1924.32"
"grafana/loki","df843647883a57872c3041d6ff3b730424d38626","woodsaj","2019-02-01 17:48:19","false","handle symbolic links correctly (#275)

* handle symbolic links correctly

When tailing a file that is rotated we expect that a fsnotify.Rename
event will be sent when the old file is renamed and a fsnotif.Create
event will be sent when the replacement file is created. This allows
us to close and re-open the file.  However if the file we are
tailing is a symbolic link (and the target is in another directory)
we wont get these events.  To address this we need to tail the target
file directly.

fixes #274

* handle symlinks being re-linked

When a symbolic link is re-linked we will only get a fsnotify.Create
event. No rename or delete event will have been sent to trigger
the tailer to be stoped.  When this happens we should stop the current
tailer for the path and start a new one. This will allow us to perform
a new Readink on the path to get the updated target filename.",80,9,0,0,"2018-04-16 10:25:39","285.31"
"grafana/loki","1e22b14430c0c24917a7ca257a1a9b879d19cbe5","MiggL","2022-09-16 15:54:28","true","Helm: Bump helm chart patch version (#7184)

What this PR does / why we need it:

Bumps the helm chart version to trigger a release for #7182",88,53,1,0,"2018-04-16 10:25:39","1611.23"
"grafana/loki","e8b44172d80ca70b128dc173aba1add45ffeac9e","kavirajk","2022-08-10 07:56:20","true","test(promtail): Fix flaky test with promtail bind port. (#6859)

* test(promtail): Fix flaky test with promtail bind port.

You cannot run promtail tests if there is already running promtail in your local.
e.g:
```
$ go test -run TestPromtail ./clients/pkg/promtail/
```

It gives you error
```
--- FAIL: TestPromtail (0.02s)
    promtail_test.go:112: error creating promtail listen tcp 127.0.0.1:9080: bind: address already in use
FAIL
FAIL	github.com/grafana/loki/clients/pkg/promtail	0.043s
```
Cause for the error is, test uses static default port (the same we use for promtail normally) in tests.

This is not **too** annonying if seen in isolation. But mainly annoying in two cases particularly
1. Hard to run tests parallely in general with these kind of static ports
2. These are causing some real problems in some integeration tests on GEL which starts docker-compose to run some test suites and
even stopping containers won't release ports soon enough making CI fail randomly.

This PR takes advantage of Go idiom of passing `port=0` to http (and also grpc) servers enforce Go's `net` package to bind some unused random ports. Making each test run choose random ports
enabling easy running theses tests in parallel.

NOTE: This PR also contains upgrade in `common/server` package that made this fix possible.
https://github.com/weaveworks/common/pull/249

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* go mod tidy

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",76,52,0,1,"2018-04-16 10:25:39","1574.9"
"grafana/loki","ba5d218e3e010e5e2902c85acdd8b8522c6587e0","owen-d","2022-08-15 16:14:58","true","detects issuer via useragent in querytee reqs (#6914)

Signed-off-by: Owen Diehl <ow.diehl@gmail.com>",83,52,0,1,"2018-04-16 10:25:39","1580.24"
"grafana/loki","262e9d02e103515be3b48a4ad97ff9073c02cb2f","sapslaj","2023-06-16 19:35:18","true","helm: make ServiceMonitor cluster label respect clusterLabelOverride (#9690)

**What this PR does / why we need it**:

As of #9218 `clusterLabelOverride` can be used to set the `cluster`
label, however the ServiceMonitor still uses `loki.fullname`. This fixes
that so it will use `loki.clusterLabel` to be consistent with other
components.

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",58,62,1,0,"2018-04-16 10:25:39","1886.63"
"grafana/loki","9eca39601df5619499dabce95317cc48b3936649","jimgus","2023-06-23 20:53:12","true","Helm: Add PDB when gateway autoscaling is enabled (#8439)

**What this PR does / why we need it**:

The logic for adding PDB (PodDisruptionBudget) for gateway is not taking
autoscaling into account. It is only added when `replicas` > 1. Instead,
use the following logic:

- When autoscaling is disabled, PDB shall be added when `replicas` > 1
- When autoscaling is enabled, PDB shall be adedd when
`autoscaling.minReplicas` > 1

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

Co-authored-by: Travis Patterson <travis.patterson@grafana.com>",60,62,1,0,"2018-04-16 10:25:39","1893.69"
"grafana/loki","806674fdaa6d68157019b00534edf3f04f0755d3","MasslessParticle","2023-06-21 15:48:17","true","Add log-volume feature flag (#9762)

Adds a feature flag for use with the new log-volume endpoints so
associated features can be rolled out incrementally.",62,62,1,1,"2018-04-16 10:25:39","1891.47"
"grafana/loki","ea96fa62a3c751993c39ea595fcfea2119609382","VeeeneX","2023-01-25 07:16:43","true","Corrected typo (#8237)",86,57,1,0,"2018-04-16 10:25:39","1739.87"
"grafana/loki","fd3d362e0c4097e9554413faac106b72f671cb57","dannykopping","2023-01-19 13:36:50","true","Removing duplicated limits file and refactored references (#8210)",83,57,1,1,"2018-04-16 10:25:39","1734.13"
"grafana/loki","6fcc4a2712a114d429075cb9f3717f09a0391292","bt909","2023-01-11 13:56:59","true","Lambda-promtail: Add skip tls verify option (#8059)

**What this PR does / why we need it**:
This PR sets a possibility to use lambda-promtail with self signed
certificates sometimes used in development systems. This setting is
configurable via environment variable.

**Which issue(s) this PR fixes**:
Fixes #8013

Signed-off-by: Thomas Belian <thomas.belian@bt909.de>",101,57,1,0,"2018-04-16 10:25:39","1726.15"
"grafana/loki","fe49e6642ef75a05517e495f85f9bee9b563d1cb","liguozhong","2022-11-08 10:57:05","true","[bugfix] add Promtail cloudflare close  (#7394)

**What this PR does / why we need it**:
If the http server closes the connection, the client may also return a
non-empty reader io.ReadCloser.

**Which issue(s) this PR fixes**:
Fixes #6150

Co-authored-by: Christian Haudum <christian.haudum@gmail.com>",87,55,1,1,"2018-04-16 10:25:39","1663.02"
"grafana/loki","a7e7a8e013db882f0e6194ae11ce177029e79ce1","cstyan","2022-10-06 21:10:50","true","[dashboards] update dashboards for zone aware ingesters (#7313)

Mostly related to the job selector; I deployed these against a local
grafana instance along the way and I think I got everything correct but
we might still need to update some of these again.

Signed-off-by: Callum Styan <callumstyan@gmail.com>

Signed-off-by: Callum Styan <callumstyan@gmail.com>",92,54,1,1,"2018-04-16 10:25:39","1631.45"
"grafana/loki","bb92837afedf2a5730635586669ca7b92d03954b","JStickler","2023-09-27 18:59:10","true","[docs] Update deployment modes topic and graphics (#10589)

**What this PR does / why we need it**:
Revising/Refreshing the Deployment modes as second phase of addressing
#9228.

Updates the three graphics:
Monolithic mode diagram simplified to emphasize that this mode is for
smaller deployments.
Scalable Monolithic mode diagram now includes backend target.
Microservices mode diagram now includes Compactor, Index Gateway, and
Query Scheduler.

**Which issue(s) this PR fixes**:
Also fixes #9765  (missing backend target) and fixes #8754.",33,65,1,0,"2018-04-16 10:25:39","1987.61"
"grafana/loki","6cbcd6aa764164d02018367f4a03319fdd5ecdfc","chodges15","2022-06-09 14:41:29","true","loki-canary: Add support for client-side TLS certs for Loki connection (#6310)

* Add support for client-side TLS certs to loki-canary

* fix lint errors, make the case of using TLS but not client certs more clear, check that -tls is set if client certs are used

* move changelog to canary section instead of main

* wrap httpClient errors and simplify dialer creation for websocket",71,50,0,0,"2018-04-16 10:25:39","1514.18"
"grafana/loki","9583c49bb8df3caf9e7f5d21ebcbeaa1d6f10607","blockloop","2021-03-18 20:15:12","true","maintenance",166,35,0,0,"2018-04-16 10:25:39","1062.91"
"grafana/loki","08af8849eeec7863f9dbec6d61f1b16bec357de6","owen-d","2023-04-25 06:18:17","true","tsdb migrate versions (#9275)

Update of https://github.com/grafana/loki/pull/9198 while
@sandeepsukhani is on holiday :)

---------

Co-authored-by: Sandeep Sukhani <sandeep.d.sukhani@gmail.com>",78,60,1,1,"2018-04-16 10:25:39","1835.08"
"grafana/loki","e0a77656fde52bfcdb4958d050de8a98654b0e82","owen-d","2020-02-06 19:59:26","true","removes duplicate logRangeExprExt grammar (#1651)

* removes duplicate logRangeExprExt grammar

* linting errors",111,22,0,1,"2018-04-16 10:25:39","655.65"
"grafana/loki","738ccbb372ad8d25d1638249226182db55072f75","chaudum","2023-08-30 19:38:38","true","Add deprecation notes to Storage documentation (#10383)

**What this PR does / why we need it**:

Legacy storage backends (that are not single store aka ""shipper"") have been deprecated with https://github.com/grafana/loki/pull/10341 The docs should reflect this change.

**Special notes for your reviewer**:

The structure of the page changed _slightly_:
* Made object storage a separate section under ""Chunk storage""
* Refer to this section in the ""Single Store"" section for supported backends
* Moved Azure example underneath the rest of the single store examples

While it is not yet perfect, I tried to change as little as possible and keep the big change for when the legacy storage backends are removed.

---------

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",45,64,1,1,"2018-04-16 10:25:39","1960.63"
"grafana/loki","4d9dc8ab96dfeffa7600edb53656fd1dba33ae22","hairyhenderson","2021-01-29 15:48:24","true","Remove invalid hostname from default promtail configuration (#3254)

Signed-off-by: Dave Henderson <dave.henderson@grafana.com>",128,33,0,0,"2018-04-16 10:25:39","1013.72"
"grafana/loki","af899dcc002e5854e25cfdd837d26d335232e368","MasslessParticle","2022-11-02 17:44:46","true","Retry pr (#7579)

This is the same PR as https://github.com/grafana/loki/pull/7152 but I
botched the merge when updating the code. This one works

Co-authored-by: Arseniy Antonov <arseny.antonov@gmail.com>
Co-authored-by: Karsten Jeschkies <k@jeschkies.xyz>",90,54,1,1,"2018-04-16 10:25:39","1657.3"
"grafana/loki","29c2213d1a0fbd64c548cf19bf2573ad08aa9721","tomwilkie","2019-01-31 12:34:47","false","Add more metrics to promtail.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",73,9,0,0,"2018-04-16 10:25:39","285.09"
"grafana/loki","e65bc69e96af4428a84e9ee0696454829b44fd9b","blockloop","2021-03-23 13:11:52","true","better ci and fix make (#7)

* linting, cleaning up

* CI: update golangci-lint version, remove go test -v flag

* linting, add gofumpt and golangci-lint to makefile",142,35,0,0,"2018-04-16 10:25:39","1067.62"
"grafana/loki","409d6bed9dfcbd4db9adfe2b2dc4cf37d6cda456","jkroepke","2023-08-18 07:51:53","true","[helm] Make table_manager configuration toggle. (#10288)

**What this PR does / why we need it**:

table_manager is deprecated. It would be nice the add the possibility to
remove the key from the config.

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [ ] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

---------

Signed-off-by: Jan-Otto Kröpke <mail@jkroepke.de>",50,64,1,0,"2018-04-16 10:25:39","1948.14"
"grafana/loki","9495b6cc5650b29d18621542d3235b5f039fc5d0","dannykopping","2023-05-03 08:40:43","true","Update loki-build-image with go1.20.4 (#9372)

Continuation of #9370

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",80,61,1,1,"2018-04-16 10:25:39","1843.18"
"grafana/loki","a649e0d7c4989b0e012d9b252a31686a68ba7b9c","dannykopping","2022-06-13 13:06:12","true","Naïve fix for optimize bug with `line_format` and `json` expression parser (#6375)

* Naïve fix

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* CHANGELOG

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Update CHANGELOG.md

Co-authored-by: Christian Haudum <christian.haudum@gmail.com>

Co-authored-by: Christian Haudum <christian.haudum@gmail.com>",69,50,0,1,"2018-04-16 10:25:39","1518.11"
"grafana/loki","d04dc31f928cb87f0d90f8d51638eda7f7536581","frittentheke","2023-07-12 14:34:04","true","Bump tail dependency to address issue in retry logic (#9915)

**What this PR does / why we need it**:
This bumps the grafana/tail version used, mostly to address an issue
with the retry logic (https://github.com/grafana/tail/pull/16)

**Which issue(s) this PR fixes**:
Fixes #9864 #9877 #9869, maybe others

**Special notes for your reviewer**:
I did NOT add a note about this dependency bump in the changelog. Let me
know if you want me to add that ... or kindly add that line yourself.

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",59,63,1,0,"2018-04-16 10:25:39","1912.42"
"grafana/loki","a6047e977014c154c0006ca1dd62c0e8aaf27bfa","jdbaldry","2023-01-19 18:26:54","true","Remove template alias from Helm chart reference (#8213)

With its inclusion, the page tries to redirect

https://grafana.com/docs/writers-toolkit/latest/templates/reference-template/
to https://grafana.com/docs/loki/latest/installation/helm/reference/

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>",82,57,1,0,"2018-04-16 10:25:39","1734.33"
"grafana/loki","96fc2abfff27210f05f730cd21410e7f30c0a3ea","MasslessParticle","2022-12-02 17:38:36","true","Make some stream shard metrics per-tenant (#7838)

This PR just adds tenant information so some of our
per-stream-rate-limit metrics.",93,55,1,1,"2018-04-16 10:25:39","1687.3"
"grafana/loki","5acee97b8d15b979cb7a644069667ccdd99d23ce","periklis","2022-11-04 11:44:27","true","operator: Fix lookup CA Bundle options on fresh install (#7596)",89,55,1,1,"2018-04-16 10:25:39","1659.05"
"grafana/loki","d8eb8b2a9f62f4d78b4fb7475058f202248838cd","rgarcia6520","2022-09-20 22:44:24","true","Helm: Adding tolerations value support for tokengen job (#7122)

**What this PR does / why we need it**:
Adding toleration support for the enterprise tokengen job template.

**Which issue(s) this PR fixes**:
Fixes #7091 

Signed-off-by: garcia.ryan <garcia.ryan@solute.us>",87,53,1,0,"2018-04-16 10:25:39","1615.51"
"grafana/loki","7f50a266560add019e47500ca29d87b7d8848938","simonswine","2022-06-01 11:25:38","true","Move ingester metrics around (#6275)",72,49,0,0,"2018-04-16 10:25:39","1506.04"
"grafana/loki","593b510f0ef01155ccb206bed6d2e852d3a41626","sandeepsukhani","2022-03-03 07:16:00","true","fix broken index gateway benchmark due to missing limits (#5520)",294,46,0,1,"2018-04-16 10:25:39","1412.62"
"grafana/loki","fe0393d38f4908a5fc5da7fc031beb1cd15dfca3","KMiller-Grafana","2021-12-22 18:30:02","true","Docs: fix callouts for images in the Deployment modes section (#4992)",245,44,0,0,"2018-04-16 10:25:39","1342.09"
"grafana/loki","c4fb17f16e2a2235d4312005a75bb869db008364","Duologic","2020-08-07 00:47:51","true","refactor: use $.core.v1.envVar (#2460)",124,28,0,0,"2018-04-16 10:25:39","841.1"
"grafana/loki","9420fb10fdf35ba36cfdb4ae70a1fb890241b801","terjesannum","2019-12-13 01:13:17","false","helm: support adding init containers to the loki pod (#1336)",98,20,0,0,"2018-04-16 10:25:39","601.87"
"grafana/loki","071ea042408be562bb8755f41411f73701d73a30","alphapseudo","2019-01-31 10:01:42","false","Fixed inline YAML indentation for promtail (#255)",72,9,0,0,"2018-04-16 10:25:39","284.98"
"grafana/loki","807193d37335f80d24d27ea8065b4d4d7a3cd026","sandeepsukhani","2020-07-27 06:12:57","true","disable index dedupe when rf > 1 and current or upcoming index type is boltdb-shipper (#2206)",123,27,0,1,"2018-04-16 10:25:39","831.32"
"grafana/loki","ab46d576aa5daf4069b462c14d511a08d0d6990b","daniellee","2018-12-10 22:48:59","false","adds grafana to docker-compose example

Signed-off-by: Daniel Lee <dan.limerick@gmail.com>",11,8,0,0,"2018-04-16 10:25:39","234.52"
"grafana/loki","e49e318b4252c21f291a1280d11241767078a1f1","cstyan","2021-10-26 19:05:28","true","Improve lambda-promtail docs based on Owens review. (#4548)

* Improve lambda-promtail docs based on Owens review.

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* One last lambda-promtail docs improvement.

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* Fix bolding in lambda-promtail docs + include link to drop filter
promtail pipeline stage.",166,42,0,1,"2018-04-16 10:25:39","1286.11"
"grafana/loki","1b87aeab4ef976b37e18d7225203c10f8b13fcbe","periklis","2023-05-22 19:31:30","true","operator: Add support for configuring HTTP server timeouts (#9405)

Co-authored-by: Robert Jacob <rojacob@redhat.com>",67,61,1,1,"2018-04-16 10:25:39","1862.63"
"grafana/loki","7fca88debdbc5ca72c534d849ada775759ed9e2f","liguozhong","2022-01-20 10:44:54","true","[enhancement] querier : Add ""query_memory_only"" to make loki have option to rely only on memory availability like google monarch. (#5093)

* [enhancement] querier : Add ""query_memory_only"" to make loki have option to rely only on memory availability like google monarch.

* Update pkg/querier/querier.go

Co-authored-by: Sandeep Sukhani <sandeep.d.sukhani@gmail.com>

* [enhancement] querier : Add ""query_memory_only"" to make loki have option to rely only on memory availability like google monarch. #5093

Co-authored-by: Sandeep Sukhani <sandeep.d.sukhani@gmail.com>",267,45,0,1,"2018-04-16 10:25:39","1369.76"
"grafana/loki","926a0b2a4e88bcb5f0243ce1c7b4d611e4b083e1","trevorwhitney","2022-01-31 08:31:17","true","Update local configs to fix issues with incorrect addresses (#5207)

* Update local configs to fix issues with incorrect addresses

* Add back instance_addr for local config",277,45,0,1,"2018-04-16 10:25:39","1380.67"
"grafana/loki","c79878d2ee995f7fcdd0a26aafd2a48a1a673d2a","andir","2020-10-29 00:41:21","true","fix quoting issues in test output when building with Go 1.15 (#2836)",123,30,0,0,"2018-04-16 10:25:39","923.09"
"grafana/loki","91974e0cfe82664f2e59fa336aa1e2064403e073","chancez","2021-02-01 10:45:27","true","logcli: Fix handling of logcli query using --since/--from and --tail (#3270)

* pkg/logcli/client: Correctly set ""start"" query param for tail API instead of ""from""

* pkg/logcli/client: Change Client method variable names to match API query parameters

Instead of using from/through, use start/end like the Loki API does.",125,33,0,0,"2018-04-16 10:25:39","1015.51"
"grafana/loki","04edce4614c8176d6d013c52524f743db8d0787e","bergquist","2018-12-06 13:14:46","false","change default port for loki (#46)

* changes default port for loki

80 is a privileged port on linux which requires root access.
Which makes it harder to get started locally.

closes #40

* use grafana/grafana:master since it contains more fixes",9,8,0,0,"2018-04-16 10:25:39","230.12"
"grafana/loki","6d95a86ae2065f827ff1ce1b3451dfa92760a0f2","jeschkies","2023-11-07 13:43:44","true","Extract query tags from HTTP requests. (#11147)

**What this PR does / why we need it**:
https://github.com/grafana/loki/pull/10858 removed the code that would
inject query tags into the context of the querier. This change adds an
extraction in the decode method.",9,67,1,1,"2018-04-16 10:25:39","2027.39"
"grafana/loki","612933b23be7f52c8dba6c345283060408f59066","slim-bean","2021-03-11 14:16:22","true","Merge branch 'release-2.2'

# Conflicts:
#	CHANGELOG.md",154,35,0,1,"2018-04-16 10:25:39","1055.66"
"grafana/loki","12c7eab8bb94fd82b184c1c222200e37f2ca050a","slim-bean","2020-05-20 15:38:32","true","Prep 1.5.0 release (#2098)

* Updating the Changelog and Upgrade guide for 1.5.0 release.

Signed-off-by: Ed Welch <edward.welch@grafana.com>

* Changing release number in all the docs

Signed-off-by: Ed Welch <edward.welch@grafana.com>",116,25,0,1,"2018-04-16 10:25:39","764.72"
"grafana/loki","4504ed27010efe68be76710f7eeaaa9c010c2503","jeschkies","2023-01-13 15:22:19","true","Cross build Promtail for ARM with journald support. (#8131)

This is the follow up to #8111 and adds journald support for Promatil
ARM and ARM64 builds.

I've tested it locally with my Raspberry Pi and it works.

Fixes #1459",97,57,1,1,"2018-04-16 10:25:39","1728.21"
"grafana/loki","1b6465d940f0dc58df71733ed9d2c837764063e6","owen-d","2020-11-18 15:51:26","true","bumps rules-action ref to logqlv2+ version (#2951)",118,31,0,1,"2018-04-16 10:25:39","942.73"
"grafana/loki","0c97afadbc9e69f1f27229498f9d4962a7f18198","owen-d","2021-10-29 16:41:11","true","cleans up redundant setting of stream.unorderedWrites=true when replaying wal (#4595)",168,42,0,1,"2018-04-16 10:25:39","1289.01"
"grafana/loki","0f5dd2bceb28ddd44f1202205e0e450c9581c3b3","chaudum","2022-10-21 11:49:28","true","Revert ""fluentd: Add un-escaping of control characters in JSON"" (#7468)

Reverts grafana/loki#7396 according to discussing on PR",93,54,1,1,"2018-04-16 10:25:39","1646.06"
"grafana/loki","965d48222bc3b5a10096029e298b74bfc5ea084e","owen-d","2021-04-13 12:12:00","true","adds distributor replication factor metric (#3594)",155,36,0,1,"2018-04-16 10:25:39","1087.57"
"grafana/loki","dc0bd01e354fa653c78ba15d33370e053be5fdd3","owen-d","2020-11-04 14:04:31","true","WAL/marshalable chunks (#2764)

* marshalable chunks

* wal record types custom serialization

* proto types for wal checkpoints

* byteswith output unaffected by buffer",128,31,0,1,"2018-04-16 10:25:39","928.65"
"grafana/loki","4013c1f8b5824fc34258fa49cd17256e16a248ea","akhilanarayanan","2023-08-18 17:55:19","true","Stopped String() from doubly escaping regex characters (#10277)

**What this PR does / why we need it**:
When queries have regex, characters that needed escaping were escaped
twice. Now they're only singly escaped. This is good because it reduces
the character count so users can submit queries closer to the 5120 byte
limit.

**Which issue(s) this PR fixes**:
Sort of addresses #10153

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [x] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

Co-authored-by: Akhila Narayanan <akhilanarayanan@Akhilas-MacBook-Air.local>",50,64,1,0,"2018-04-16 10:25:39","1948.56"
"grafana/loki","a5765b57bfb19ef65a0cad404545f34111e94c58","rfratto","2019-11-20 14:12:01","true","pkg/distributor: fix metric loki_discarded_samples_total (#1279)

loki_discarded_samples_total is supposed to be the count of samples that
were discarded, but was instead being reported as the total bytes
discarded. The metric has been fixed and a new metric,
loki_discarded_bytes_total, has been added to report the total discarded
bytes.

Fixes #1255.",74,19,0,1,"2018-04-16 10:25:39","579.41"
"grafana/loki","289190ee26692ed07b82a9a53167dc8e6fda2ee1","owen-d","2022-10-06 15:17:32","true","removes unused tsdb files (#7353)

These were introduced in an earlier revision of the TSDB work, but are
unused now.",93,54,1,1,"2018-04-16 10:25:39","1631.2"
"grafana/loki","c654910f7077364ed54367551d79661721d311b6","MasslessParticle","2022-03-03 08:26:48","true","Fix orphaned metrics in the file tailer (#5497)",294,46,0,1,"2018-04-16 10:25:39","1412.67"
"grafana/loki","79c027550c66099c25d77530267f40c81a4f78c8","sandeepsukhani","2020-09-25 06:14:58","true","run multiple queries per table at once with boltdb-shipper (#2656)",118,29,0,1,"2018-04-16 10:25:39","889.33"
"grafana/loki","0679e50d6a82c68a4cbba9dd6a58fc83fe9a1c6b","rsteneteg","2021-05-18 08:06:08","true","correct logcli instant query timestamp param name (#3739)

Signed-off-by: Roger Steneteg <rsteneteg@ea.com>",199,37,0,0,"2018-04-16 10:25:39","1127.65"
"grafana/loki","0cfa33d90d3f5e5ce204453b8ec94c51f5b46a23","cosmo0920","2019-09-26 21:10:10","false","fluent-bit shared object go plugin (#847)

* Import fluent-bit-go-loki plugin sources

* Add fluent-bit-go package constraint

* Ensure dependencies with dep

```
$ dep ensure
```

* Update .gitignore

* Move fluent-bit-go-loki to fluent-bit/fluent-bit-go-loki directory

* Add documentation for fluent-bit-go-loki

* Fix for lint

* Fix for goimports errors

* Display fluent-bit-go-loki plugin version

* Use more descriptive description for fluent-bit Loki plugin

* Remove needless newlines

* Rectify fluent-bit-go-loki makefile

Remove needless parts and rename meaningless target

* Use more descriptive description in README

* refactor(fluent-bit): move make targets into root Makefile

* Organize imports

* Reorder imports with goimports

$ goimports -w out_loki.go

* Remove needless LICENSE file

Because it is the same for Loki repository.

* Rely on Loki client retry mechanism

* Make descriptions more clearly

* Change default unit

* BatchWait: msec -> sec
* BatchSize: KiB -> Byte

* Use logql to parse Loki native labels format

* Use logger instead of fmt.Printf

* Update documentation to reflect recent changes

* Use prometheus version module to print version

* Dump error message with logger

* Use DYN_GO_FLAGS instead of custom FLAGS for fluent-bit-plugin

* Support RemoveKeys parameter

* use logql.ParseMatchers()

* refactor fluent-bit go plugin

* add ci step for docker image

* fix lint issues

* fix a failing url test

* fix a failing url test

* add build images for drone ci

* Adding labelmap file to complex record to labels

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add helm chart and fix a bug with labelmap

* New push path

* dep sync

* Move fluent-bit folder and use jsonnet for drone

* fix build

* Adds more documentation and include a basic config in the container

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* remove binaries

* Some readme grammar fixes

* docs: really nitpicky grammar change in clients README

* Add helm documentation

* fixes bad config

* bump chart

* fixes .gitignore",70,17,0,0,"2018-04-16 10:25:39","525.7"
"grafana/loki","808c808714c91b3e594cea54896c8ce86b2e25ac","KMiller-Grafana","2021-07-27 15:03:39","true","Clarify prose about querier frontend min-sharding-lookback (#4050)

* Clarify prose about querier frontend min-sharding-lookback

Docs edit of prose from https://github.com/grafana/loki/pull/4047.

* Update docs/sources/configuration/_index.md

Co-authored-by: Danny Kopping <dannykopping@gmail.com>

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>
Co-authored-by: Danny Kopping <dannykopping@gmail.com>",106,39,0,0,"2018-04-16 10:25:39","1196.94"
"grafana/loki","34433343e8c6e0af878f9ca97be7f17c031fb42b","KMiller-Grafana","2022-03-29 16:24:31","true","Docs: add an empty v2.5 release notes section (#5533)",310,47,0,0,"2018-04-16 10:25:39","1439"
"grafana/loki","6c85cda61acafb77230342643b66ee8d67cfdf4b","liguozhong","2022-01-19 09:27:10","true","Handle `context` cancellation in some of the `querier` downstream requests (#5178)",267,45,0,1,"2018-04-16 10:25:39","1368.71"
"grafana/loki","213bb86802559a0e57c34275a814747240fa77d2","simonswine","2022-05-03 08:06:54","true","Add integration tests which test happy path (#5968)

* Add integration tests which test happy path

This PR adds simple go based integration tests, which can run Loki
in two modes:

- single-binary
- micro-services with index-gateway

After standing up it performs the most basic duties like:
- ingest logs
- run a range query
- query label names and label values

This is meant to catch more significant problem as early as possible in
the PR.

We should aim to keep this as simple as possible.

* Replace config generation with template

Makes configuration much more readable and avoids easy mistakes

* Apply suggestions from code review

Co-authored-by: Michel Hollands <42814411+MichelHollands@users.noreply.github.com>

Co-authored-by: Michel Hollands <42814411+MichelHollands@users.noreply.github.com>",74,49,0,0,"2018-04-16 10:25:39","1477.9"
"grafana/loki","800b7c6345ca6e0a2613406b86dac0a6307168c4","cstyan","2022-04-12 06:49:12","true","[promtail] Mark promtail single client config flags and config file block as deprecated (#5842)

* Mark promtail single client config flags and config file block as
deprecated.

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* Update some promtail docs examples that still use `client` instead of
`clients`.

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* Fix imports.

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* properly format url as an array item since we changed to clients from
client

Signed-off-by: Callum Styan <callumstyan@gmail.com>",322,48,0,1,"2018-04-16 10:25:39","1451.6"
"grafana/loki","4354f8031e44c01e64a6c6c8800d727863c8e9b8","slim-bean","2019-08-07 17:59:59","false","Removing the loki-frontend dashboard as it only has one panel which is duplicated in the loki-reads panel, we can bring it back when add more to the loki frontend.",98,16,0,1,"2018-04-16 10:25:39","476.57"
"grafana/loki","ffb605fa85f018d55b10b8ab7de9215333320172","jeschkies","2023-03-15 19:13:26","true","Fix: Ensure query limits tripperware wraps frontend. (#8789)

**What this PR does / why we need it**:
The query frontend would not enforce the per-request query limits
because the injected tripperware was wrapped *after* the frontend has
been created. That is a bug. The order must be changed so that the
`queryrange.LimitsMiddleware` runs *after* the
`querylimits.limitsMiddleware`.

**Which issue(s) this PR fixes**:
Fixes #8790

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [x] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",88,59,1,1,"2018-04-16 10:25:39","1790.37"
"grafana/loki","05d21106817438f523c6161d0a1312812d6db44c","trevorwhitney","2022-12-14 18:21:35","true","[helm] control order provisioner and tokengen jobs run in (#7939)

**What this PR does / why we need it**:

This adds `hook-weight` annotations to the tokengen and provisioner jobs
to make sure tokengen always runs first. The fixes a race condition
where provisioner attempts to go first but locks and fails the
deployment because no token is available.

**Which issue(s) this PR fixes**:
Fixes #7251

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the `CONTRIBUTING.md` guide
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",100,56,1,1,"2018-04-16 10:25:39","1699.33"
"grafana/loki","1cc678da5ec8cf80e355b4bee32376461b9dbd9b","periklis","2021-12-07 10:55:14","false","Fix shellcheck issues",214,44,0,1,"2018-04-16 10:25:39","1326.77"
"grafana/loki","7b1ca8df6ce367863759e2d6b52e9c8eac29e9c3","periklis","2022-06-21 17:05:07","true","operator: Move cli flags to component config (#6433)",69,50,0,1,"2018-04-16 10:25:39","1526.28"
"grafana/loki","141ee25c0e3a9af901f623b183b67dce7ee93b04","ssncferreira","2023-02-24 10:47:47","true","Helm: update changelog CI comment (#8603)

**What this PR does / why we need it**:

Update the helm changelog CI comment to clarify that the pipeline is
only used for new Loki releases.

Related to PR: https://github.com/grafana/loki/pull/8323

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",63,58,1,0,"2018-04-16 10:25:39","1769.02"
"grafana/loki","2c4e30f2ff52e9b6ef968cb3a758eedc82902255","slim-bean","2019-05-08 15:26:21","false","Updating helm/ksonnet to use new pipeline config
Updating docs
Rebase fixes",99,13,0,1,"2018-04-16 10:25:39","387.46"
"grafana/loki","3aa09c59b53ef710c8c1eec6d867bdfd5eef6d39","jeschkies","2023-10-10 05:06:29","true","Install docker buildx on build image. (#10833)

**What this PR does / why we need it**:
This is a prerequisite to cross build our build image for Apple Silicon.

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",25,66,1,1,"2018-04-16 10:25:39","2000.03"
"grafana/loki","dccbe51799d1888b18ebe3b8b893f7b70c7c9d81","slim-bean","2021-12-06 07:21:58","true","stats were logged without a log level making them not correctly filterable. (#4872)",215,44,0,1,"2018-04-16 10:25:39","1325.62"
"grafana/loki","f8658fdc38ae39d88b016fd0dda2bd2274a65ffd","jeschkies","2023-08-29 10:32:36","true","Enable sharding for avg_over_time. (#10373)

**What this PR does / why we need it**:
The range aggregation `avg_over_time` is simply shardable if there's no
label reduction.

If there is one it can be express as
```
sum by (method) (
    sum_over_time(
        {container=""app""} | json | unwrap bytes [$__interval])
) 
/
sum by (method) (
    count_over_time(
        {container=""app""} | json [$__interval]
    )
) 
```

Note that `sum by`, `sum_over_time` and `count_over_time` are shardable
once more.

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [x] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

---------

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>",48,64,1,1,"2018-04-16 10:25:39","1959.25"
"grafana/loki","180a93e430f8a06769447cea0b5bac2d540ff426","drehelis","2022-09-15 13:31:36","true","Helm: Make server configuration configurable (#7137)

**What this PR does / why we need it**:
Expose server configuration to be configurable with Helm values

**Checklist**
- [x] Documentation added
- [ ] Tests updated
- [ ] Is this an important fix or new feature? Add an entry in the
`CHANGELOG.md`.
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

Co-authored-by: Karsten Jeschkies <k@jeschkies.xyz>",88,53,1,0,"2018-04-16 10:25:39","1610.13"
"grafana/loki","8d561f6caff4c4dee07414a01c17a4a35f6192e1","chaudum","2021-09-08 17:39:28","true","Chore: Update Cortex and use kv package from grafana/dskit (#4282)",127,41,0,1,"2018-04-16 10:25:39","1238.05"
"grafana/loki","fd31840d3cdeac43b429fce0dbe91c5771e042cd","MichelHollands","2023-07-12 14:01:47","true","Build gotestum, helm-docs and others on bullseye (#9919)

helm-docs and gotestsum use a different libc version when built on the
normal golang image so they have to be built on the bullseye image as
well. Otherwise errors like these occur:

```
gotestsum: /lib/x86_64-linux-gnu/libc.so.6: version `GLIBC_2.32' not found (required by gotestsum)
gotestsum: /lib/x86_64-linux-gnu/libc.so.6: version `GLIBC_2.34' not found (required by gotestsum)

helm-docs: /lib/x86_64-linux-gnu/libc.so.6: version `GLIBC_2.32' not found (required by helm-docs)
helm-docs: /lib/x86_64-linux-gnu/libc.so.6: version `GLIBC_2.34' not found (required by helm-docs)
```

Tested by running them manually in the new build image.

---------

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",59,63,1,1,"2018-04-16 10:25:39","1912.4"
"grafana/loki","c530f404d656c11fd095a33ea66492fc4c5d2734","MichelHollands","2023-07-12 12:09:31","true","Use Debian Bullseye (#9918)

Debian Bookworm has a later version of the protobuf compiler which
somehow causes the generated protobuf code to substitute `empty.Empty`
with `emptypb.Empty` among others. Below is an example of the changes:

```
-	WriteIndex(ctx context.Context, in *WriteIndexRequest, opts ...grpc.CallOption) (*empty.Empty, error)
+	WriteIndex(ctx context.Context, in *WriteIndexRequest, opts ...grpc.CallOption) (*emptypb.Empty, error)
```

These [changes](https://protobuf.dev/reference/go/faq/#modules) will
happen at some time due to new google.golang.org/protobuf library. To
avoid this for now we can use Debian Bullseye instead. Note that Debian
Buster is no longer available for Go 1.20.6.

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",59,63,1,1,"2018-04-16 10:25:39","1912.32"
"grafana/loki","411f384ae1252043cf054423d1e28b8fa8b4d406","MichelHollands","2023-04-28 13:04:46","true","Pin manifests plugin version (#9342)

Pin manifests plugin to unblock CI.

Example failed step: https://drone.grafana.net/grafana/loki/23046/26/3 .
The tempo team had the same issue some time ago:
https://github.com/grafana/tempo/pull/2371/files.

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",80,60,1,1,"2018-04-16 10:25:39","1838.36"
"grafana/loki","78c2063e0bfe4619e2d367f4bdee68ba5d14dae1","marcusteixeira","2023-01-13 16:02:27","true","Docs: fix helm ssd typo (#7959)

Fix docs about helm ssd installation. 

Co-authored-by: Travis Patterson <travis.patterson@grafana.com>",96,57,1,0,"2018-04-16 10:25:39","1728.23"
"grafana/loki","020631ebac4e35f6db37f5b7d12dc30577a7005c","sandeepsukhani","2022-11-03 09:35:05","true","add user-id transformer for logs results cache (#7581)

**What this PR does / why we need it**:
Adding transformer to results cache same as metrics cache done in PR
#7542",90,54,1,1,"2018-04-16 10:25:39","1657.96"
"grafana/loki","4e7105d018fc85dbd3417d5bbb950969879880c1","sandeepsukhani","2022-09-21 12:39:07","true","add index requests panel to reads/writes dashboard (#7163)

**What this PR does / why we need it**:
In PR #7154, I refactored the code also to measure the latency on index
write requests.
This PR adds the index requests panel to the Loki Reads/Writes
dashboard.",86,53,1,1,"2018-04-16 10:25:39","1616.09"
"grafana/loki","6319af1ac6ab18207e49efb7869e538ce63064cc","cyriltovena","2021-11-03 17:45:25","true","Fixes the operational dashboard using an old metric. (#4634)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",171,42,0,1,"2018-04-16 10:25:39","1293.06"
"grafana/loki","0ae0d4da122d0cb043a2eb64b7365a48290683de","rsteneteg","2021-10-21 11:49:19","true","fix filetarget to not be stuck if no files was detected on startup (#4461)

Signed-off-by: Roger Steneteg <rsteneteg@ea.com>

Co-authored-by: Cyril Tovena <cyril.tovena@gmail.com>",168,42,0,0,"2018-04-16 10:25:39","1280.81"
"grafana/loki","0cd8f318311d658e7203e8cf344363665fbe34ba","sandeepsukhani","2021-07-08 13:54:05","true","log name of the file failed to open during startup by ingester (#3970)",121,39,0,1,"2018-04-16 10:25:39","1177.89"
"grafana/loki","58987553a1da705b90c7d2562bfb1fb081f2c10a","owen-d","2021-01-05 10:50:07","true","Disables the stream limiter until wal has recovered (#3114)

* disables the stream limiter until wal has recovered

* limiter disable/enable methods",113,33,0,1,"2018-04-16 10:25:39","989.52"
"grafana/loki","b757753e3bfd90c921d90e99e549e4241ab7c758","vlad-diachenko","2022-06-03 15:24:02","true","fixed type of the property in memberlist config (#6307)",72,50,0,0,"2018-04-16 10:25:39","1508.21"
"grafana/loki","30caf142b2e9d2e0b63339b66c92a4f528ec884e","jeschkies","2022-10-10 08:25:55","true","Provision alerts for Loki Canary in Helm Chart. (#7286)

**What this PR does / why we need it**:
The Helm Charts install the Loki canary. It should also install the
alerts for the canary so the users get the full value.

**Which issue(s) this PR fixes**:
Fixes #7284

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the `CONTRIBUTING.md` guide
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",95,54,1,1,"2018-04-16 10:25:39","1634.92"
"grafana/loki","b179bd338186cae1129d8d1577ff029a19d5edbc","jeschkies","2023-01-31 10:57:57","true","Sizing Tool: Set the minimum replias to 3. (#8329)",81,57,1,1,"2018-04-16 10:25:39","1746.02"
"grafana/loki","772b7ff087f41eecfa49fad370c38862151561c3","adityacs","2020-10-12 10:30:01","true","Logstash cpu usage fix (#2607)

* Replace concurrent-ruby-edge with agent lib

* Fix logstash cpu consumption

* increment gemspec version

* increment gemspec version

* fix tests",114,30,0,1,"2018-04-16 10:25:39","906.5"
"grafana/loki","82a7eae2bc774e8ee32ba547900592bba373be7d","pracucci","2019-08-06 21:35:58","false","Removed unused (and skipped) TestGZIPCompression (#858)",99,16,0,0,"2018-04-16 10:25:39","475.72"
"grafana/loki","f8155a1109fd6196ee7e362cdf8408b6abcb947a","rfratto","2019-07-22 20:52:55","false","ingester: Add test for chunk transfers",103,15,0,1,"2018-04-16 10:25:39","461.69"
"grafana/loki","d08b87f799c36cbbd51e60d24436bed4994148b1","ashwanthgoli","2023-03-20 12:53:24","true","json parser: fix panic when processing empty line (#8835)

**What this PR does / why we need it**:
Fixes panic when an empty line is processed by `JSONExpressionParser`

```
    /src/enterprise-logs/vendor/github.com/grafana/loki/pkg/logql/log/parser.go:537
github.com/grafana/loki/pkg/logql/log.isValidJSONStart(...)
...
panic: runtime error: index out of range [0] with length 0
```

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [x] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

---------

Signed-off-by: Ashwanth Goli <iamashwanth@gmail.com>",83,59,1,0,"2018-04-16 10:25:39","1795.1"
"grafana/loki","5ba154a6deee529c3eca5386d0c490821a62af55","jeschkies","2023-08-24 10:59:47","true","Report missing metrics in querytee. (#10304)

**What this PR does / why we need it**:
Sometimes we want to not just fail a querytee but also report results on
the comparison between expected and actual results. That's why querytee
is extended with special metrics to give more insights into the
differences.

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [x] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",50,64,1,1,"2018-04-16 10:25:39","1954.27"
"grafana/loki","d75212d6170798af3574a3671d2054fb0d279eda","slim-bean","2019-04-03 11:45:53","false","Adding a specific ssh key fingerprint to use for pushing back to loki repo",95,11,0,1,"2018-04-16 10:25:39","347.06"
"grafana/loki","7d818099a026d1bf120c1127751f73ab2e0805b8","btaani","2023-08-07 10:43:09","true","operator: Use a condition to warn when there are no nodes with matching labels for zone-awareness (#9942)

Co-authored-by: Robert Jacob <rojacob@redhat.com>",53,64,1,0,"2018-04-16 10:25:39","1937.26"
"grafana/loki","50c4216d00cf5a0350bd8f389fd9d68c15708c46","JoaoBraveCoding","2023-07-18 16:57:29","true","operator: add mTLS authentication to tenants (#9906)",57,63,1,0,"2018-04-16 10:25:39","1918.52"
"grafana/loki","c5725e4cae0017abecb0f8741a264b0f155b0e93","jdbaldry","2023-02-06 12:26:28","true","Use portable output redirection (#8417)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>",81,58,1,0,"2018-04-16 10:25:39","1751.08"
"grafana/loki","54e6c19fc69be7f1b7d755361c3cf2a28aaa2b55","periklis","2022-11-30 13:23:04","true","operator: Apply delete client changes for compat with release-2.7.x (#7815)",92,55,1,1,"2018-04-16 10:25:39","1685.12"
"grafana/loki","5dc60567da1faa1d7c1d1d61fd9e80f51f331c2b","jkroepke","2022-11-30 10:41:09","true","[Helm] Add support for azure blob storage (#7500)

**What this PR does / why we need it**:
Support Azure Blob Storage in helm chart. See
https://grafana.com/docs/loki/latest/storage/#azure-storage-account-1

**Which issue(s) this PR fixes**:


**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the `CONTRIBUTING.md` guide
- [x] Documentation added
- [ ] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

Signed-off-by: Jan-Otto Kröpke <jok@cloudeteer.de>",93,55,1,0,"2018-04-16 10:25:39","1685.01"
"grafana/loki","bc7f2f5adb3891f67a8c057a9b15845213cce769","Red-GV","2022-10-07 12:51:16","true","operator: Add TLS profile support for Loki server and client HTTP and GRPC TLS options (#7322)",93,54,1,1,"2018-04-16 10:25:39","1632.1"
"grafana/loki","87b7dfae870a301ec1d57e1373d2d6cc433c345d","sandeepsukhani","2022-02-25 13:50:44","true","Stream query responses from boltdb index client (#5468)

* stream query response from boltdb index client instead of sending one row per batch

* add benchmark for testing index gateway query performance

* lint and fix broken test

* wrap error message while failing to send back response

* sort imports",300,46,0,1,"2018-04-16 10:25:39","1404.89"
"grafana/loki","ffc87055b8d4bda594bf7c5b077a5fe6bd5eb8c9","nate-walters-grafana","2022-02-07 19:41:02","true","Delete docs/sources/copyright directory (#5325)

Removing copyright notice per https://raintank-corp.slack.com/archives/CH34H23HD/p1643999482151029",278,46,0,0,"2018-04-16 10:25:39","1387.14"
"grafana/loki","a4d671b1113585ff3f64b3c91833bbd36895e7e5","adityacs","2020-02-21 16:17:16","true","Fix panic error when AutoKubernetesLabels is true (#1717)",119,22,0,1,"2018-04-16 10:25:39","670.49"
"grafana/loki","f3332272ed590f576dd3ec45af322117352ab380","cyriltovena","2020-01-10 13:09:10","true","Update Loki mixin to include frontend QPS and latency. (#1497)

Also rework frontend route registration to name metrics and spans correctly.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",102,21,0,1,"2018-04-16 10:25:39","629.36"
"grafana/loki","158ca9d3dc3c3f1a578763db6d37d54ae43f5447","sandeepsukhani","2019-09-23 10:19:43","true","use latest bigtable backup docker image with fix for list backups (#1043)",68,17,0,1,"2018-04-16 10:25:39","522.25"
"grafana/loki","b577cf5ea5901393a37427f8503b5f647ace288d","kavirajk","2023-10-10 08:46:44","true","chore(renovate): Move the config to `.github` directory (#10816)

Follow up to #10763 

**What this PR does / why we need it**:
1. Move `renovate.json` to `.github` for consistency
2. Remove old `dependabot.yml` from the root of the repo.

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",25,66,1,1,"2018-04-16 10:25:39","2000.18"
"grafana/loki","ea62af58e9732bce5b2c4dd10c02102bf8c0a203","simonswine","2022-03-17 12:19:00","true","Introduce a ChunkRef type as part of logproto  (#5643)

* Change protobuf definitions

* Adapt to an embedded ChunkRef struct

* Move the Checksum to the ChunkRef",308,47,0,0,"2018-04-16 10:25:39","1426.83"
"grafana/loki","ae39676cceb703030bcf75812e053e32b4f7f641","jeschkies","2022-03-01 13:19:26","true","Stub multi tenant querier. (#5490)

**What this PR does / why we need it**:
- Introduce Queries interface and Querier API.
- Configure a multi-tenant querier that just passes requests through.

**Which issue(s) this PR fixes**:
Closes #231

**Special notes for your reviewer**:

**Checklist**
- [x] Documentation added
- [ ] Tests updated
- [ ] Add an entry in the `CHANGELOG.md` about the changes.",300,46,0,1,"2018-04-16 10:25:39","1410.87"
"grafana/loki","f89a51fde872aece651ff493fcfeb3ce05173fb8","bboreham","2023-08-23 08:14:37","true","Tracing: elide small traces for Stats call (#10308)

**What this PR does / why we need it**:

At work I see a lot of traces getting data dropped due to being tens of
megabytes in size.
Looking at what was captured, I see many many repeats of these four
spans:
<img width=""1070"" alt=""image""
src=""https://github.com/grafana/loki/assets/8125524/4268e664-6910-49bb-8f68-69b139a5a66b"">

Events on the parent trace are cheaper and, for small operations like
this, just as useful.
Where there was an event line I added a `function` field matching the
previous span name.
For `storeEntry.Stats()` I didn't add an event line as it doesn't seem
to do very much.
But please correct me; I'm not hugely familiar with the Loki codebase.

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- NA Documentation added
- NA Tests updated
- [x] `CHANGELOG.md` updated
- NA If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- NA Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- NA For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",50,64,1,0,"2018-04-16 10:25:39","1953.16"
"grafana/loki","91f41f3aba67c2b14e7da3c7f3d557e6fac3b976","gouthamve","2018-12-10 22:56:17","false","Push branch as a tag (#57)

* Push master images

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>

* Push master automatically.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",11,8,0,0,"2018-04-16 10:25:39","234.52"
"grafana/loki","47f8d8bd5b4b65c6c5fcab3cbae6dfe92b458610","rissson","2023-10-19 08:48:34","true","helm: add support for configuring distributor (#10531)

**What this PR does / why we need it**:

Add support for configuring distributor with Helm. Needed to be able to
enable IPv6 on that component.

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [x] N/A: Tests updated
- [x] `CHANGELOG.md` updated
- [x] N/A: If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [x] N/A: Changes that require user attention or interaction to upgrade
are documented in `docs/sources/setup/upgrade/_index.md`
- [x] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

Signed-off-by: Marc 'risson' Schmitt <marc.schmitt@risson.space>",20,66,1,0,"2018-04-16 10:25:39","2009.18"
"grafana/loki","6f883b330e20a3c12a5285396b3a28c4b45f565b","tomwilkie","2018-07-03 08:17:00","false","Add metric for number of bytes read from each log.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",4,3,0,0,"2018-04-16 10:25:39","76.91"
"grafana/loki","a65da7d78e3a536f8c069df3d0526623f45028c3","MasslessParticle","2022-10-31 21:31:27","true","Shard streams round-robin rather in batches.  (#7560)

To avoid hot spots, keep track of shard numbers across pushes. When
tracking shard numbers across pushes, it's no longer necessary to
randomize shards, in the case where the desired number of shards is
greater than the number of entries. Instead, we just partition the
entries among the shards in round robin fashion. Over time, this should
give us a more even distribution of logs in shards, particularly for
large streams that are made of small individual pushes.",89,54,1,1,"2018-04-16 10:25:39","1656.46"
"grafana/loki","ff3e4564ddc874d25a272b06e0c46d9a885d303d","tomwilkie","2019-05-08 12:57:49","false","Add two more links to readme (#560)",99,13,0,0,"2018-04-16 10:25:39","387.36"
"grafana/loki","d81c9d38f2b004c998c7d9b604da7f1cb5347eb0","vlad-diachenko","2022-07-17 17:32:43","true","added changelog for 2.6.1 release (#6697)

* added changelog for 2.6.1 release

* Apply suggestions from code review

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>",70,51,0,0,"2018-04-16 10:25:39","1552.3"
"grafana/loki","09a5a2cee31de2a973c00a7840dad3f5a24ced10","slim-bean","2022-01-28 14:12:11","true","Logstash: Add config option which allows seting up an allowlist for labels to be mapped to Loki (#5244)

* add a config called `include_fields` which lets you allowlist a specific set of fields which will be mapped to labels and sent to Loki.

Signed-off-by: Edward Welch <edward.welch@grafana.com>

* update docs

Signed-off-by: Edward Welch <edward.welch@grafana.com>

* restore path for Dockerfile so it works in CI

Signed-off-by: Edward Welch <edward.welch@grafana.com>",276,45,0,1,"2018-04-16 10:25:39","1377.91"
"grafana/loki","5aa82ba199f571c8697986537a007738d985104a","slim-bean","2019-12-12 19:17:09","true","allow configuring a target chunk size in compressed bytes (#1406)

* allow configuring a target chunk size in compressed bytes

Signed-off-by: Edward Welch <edward.welch@grafana.com>

* addressing feedback

Signed-off-by: Edward Welch <edward.welch@grafana.com>",97,20,0,1,"2018-04-16 10:25:39","601.62"
"grafana/loki","29d23949624039055348a42e59df9c00b6295d8b","jeschkies","2021-08-24 23:11:52","true","Link Kubernetes service discovery configuration. (#4206)

* Link Kubernetes service discovery configuration.

* Use `configuration`.",126,40,0,1,"2018-04-16 10:25:39","1224.28"
"grafana/loki","cdde2cf0504a2eebc8ad45dc403abdae1f8aa21d","aknuds1","2021-10-11 07:12:07","true","Chore: Use dskit/grpcclient (#4312)",142,42,0,0,"2018-04-16 10:25:39","1270.62"
"grafana/loki","1b63331e3dcb7f6f2b65c4281710458239910021","kavirajk","2021-11-26 10:21:41","true","Add support for `X-Query-Tags` (#4814)

* Add support for `X-Query-Tags`

1. Now client can send any metadata about query via `X-Query-Tags` HTTP header
2. Also record `X-Query-Tags` in `metrics.go` for instant and range queries.

* PR remarks

* Make linter happy

* Fix middleware next

* Make safe parsing of the header

* Add bit more test cases

* Minor suggestions

* Add middleware chain to querier handlers

* Repopulate the HTTP headers before while Encoding",216,43,0,1,"2018-04-16 10:25:39","1315.75"
"grafana/loki","c34078719cf73a0874a2dab03039fbb10b15c0c2","chaudum","2022-09-29 10:35:56","false","[docs] Fix docs for `rate_counter()`

`rate_counter` behaves like `rate` and therefore does not support
grouping.

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",91,53,1,1,"2018-04-16 10:25:39","1624.01"
"grafana/loki","6e3e2fa39fab27c330ec8eadfd84911a559e95c0","owen-d","2020-08-13 17:32:01","true","Ksonnet docs (#2503)

* adds jsonnet-libs/k8s-alpha, redirects tanka install docs

* removes vendor dir from loki ksonnet

* docs for non-GA tanka requirement

* Update docs/sources/installation/tanka.md

Co-authored-by: Ed Welch <ed@oqqer.com>

Co-authored-by: Ed Welch <ed@oqqer.com>",119,28,0,1,"2018-04-16 10:25:39","847.8"
"grafana/loki","2139dbf55f6857a7c53947ad31566bbb2f6a506f","chaudum","2023-02-06 14:07:59","true","[LogCLI] Load tenant-specific schema config file when using `--remote-schema` (#8413)

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",81,58,1,1,"2018-04-16 10:25:39","1751.15"
"grafana/loki","0222e0ecd3b004d808009293321877e3d327bc22","chaudum","2023-09-05 14:39:43","true","Add LID for improving Index Gateway sharding (#8420)

This document tries to come up with a proposal on how to do a better sharding of data on the index gateways so we are able to scale the service horizontally to fulfill the increased need for metadata queries of big tenants.

### Update (2023-09-05)

I gave the LID an ordinal number (0004) and marked it as Rejected / Not Implemented so this PR can be merged.

---------

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",46,65,1,1,"2018-04-16 10:25:39","1965.43"
"grafana/loki","17739006596843dae7455069ee645190150273dd","owen-d","2020-02-04 15:31:00","true","compiler guarantees for logql exprs (#1626)",108,21,0,1,"2018-04-16 10:25:39","653.46"
"grafana/loki","05997ae7b9c815282bef77bb3aa2791464d9a2c5","shih-chris","2023-08-22 22:19:35","true","Fixes typo: removes extra ""a"" (#10312)

**What this PR does / why we need it**:

**Which issue(s) this PR fixes**:
Fixes https://github.com/grafana/loki/issues/10311

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

Co-authored-by: J Stickler <julie.stickler@grafana.com>",50,64,1,0,"2018-04-16 10:25:39","1952.75"
"grafana/loki","9a62deb82972fe399f3301795c93ef9476f08c07","yeya24","2020-03-31 19:25:44","true","Support series API in logcli (#1861)

* support series API in logcli

Signed-off-by: yeya24 <yb532204897@gmail.com>

add changelog

Signed-off-by: yeya24 <yb532204897@gmail.com>

* update logcli docs

Signed-off-by: yeya24 <yb532204897@gmail.com>",120,23,0,0,"2018-04-16 10:25:39","710.63"
"grafana/loki","0470e4e7d38e7b364acfd230b20f4237c8ef05d0","taharah","2022-06-02 19:03:47","true","feat(fluentd): allow fluentd_thread label to be configurable (#6240)

Signed-off-by: Trevor Wood <Trevor.G.Wood@gmail.com>",72,50,0,0,"2018-04-16 10:25:39","1507.36"
"grafana/loki","3fb8f3d3c6ccae8161488daa23a767c3927ce151","owen-d","2021-10-14 21:44:26","true","restores for state at seconds(now-forDuration) (#4479)

* restores for state at seconds(now-forDuration)

* bump ci",157,42,0,1,"2018-04-16 10:25:39","1274.22"
"grafana/loki","891285777aa0fa009109b642804a95182c2f201d","JStickler","2023-09-28 15:06:12","true","Add note - LogQL syntax required (#10740)

Addresses feedback from #10414.",29,65,1,0,"2018-04-16 10:25:39","1988.44"
"grafana/loki","22a4b7868626279815ab8c57f3ef0f7c24c66ee0","owen-d","2020-10-06 15:00:06","true","removes wrong capitalizations (#2733)",119,30,0,1,"2018-04-16 10:25:39","900.69"
"grafana/loki","7832783b1caa0602a85c9df9071287c6be3e4f7b","owen-d","2021-10-15 00:20:20","true","always expoe loki_build_info (#4482)",157,42,0,1,"2018-04-16 10:25:39","1274.33"
"grafana/loki","5c70901c02e5aa04916e1776a454f6ba5375e784","Red-GV","2022-06-15 16:09:16","true","operator: Storage schema update (#5952)",68,50,0,1,"2018-04-16 10:25:39","1520.24"
"grafana/loki","de05515248c404299ddcdba9168a66cea285a72e","tomwilkie","2018-11-20 14:41:13","false","Init pool config correctly.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",5,7,0,0,"2018-04-16 10:25:39","214.18"
"grafana/loki","1bb489c438bde969e125269d484c98600339a63d","JStickler","2023-05-10 18:39:21","true","TOC Sync: Move LogQL and LogCLI files under Query. (#9200)",79,61,1,0,"2018-04-16 10:25:39","1850.59"
"grafana/loki","d643cb2f4b927eb4d2d7610e0174731a0998bb05","blockloop","2021-05-17 05:00:57","true","add CONTRIBUTING.md (#54)",195,37,0,0,"2018-04-16 10:25:39","1126.52"
"grafana/loki","9c52ff8704a41792c5714dbd4370437508e4f445","periklis","2023-02-07 05:19:00","true","operator: Add missing release section into the changelog (#8412)",80,58,1,1,"2018-04-16 10:25:39","1751.79"
"grafana/loki","c6b2294bbf0c0545674bc91db916e5e09f223795","dannykopping","2022-10-17 14:41:06","true","Add Li Guozhong as a maintainer (#7440)

A formal vote has taken place and `liguozhong` has been accepted! :tada:",89,54,1,1,"2018-04-16 10:25:39","1642.18"
"grafana/loki","369fa8a585052499071236c13e70031639d77cf9","daixiang0","2019-02-24 02:39:53","false","fix small language issue

Signed-off-by: Xiang Dai <764524258@qq.com>",81,10,0,0,"2018-04-16 10:25:39","307.68"
"grafana/loki","2cccc1bc6893c0b129bf2c81dbcd449ff837a53d","eriksjolund","2023-03-31 17:15:54","true","Docs: Fix typos and grammar (#8966)

**What this PR does / why we need it**:

Fixes typos and grammar. Most of them were occurrences of `it's` that
should be `its`.

**Which issue(s) this PR fixes**:

None

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

Signed-off-by: Erik Sjölund <erik.sjolund@gmail.com>",81,59,1,0,"2018-04-16 10:25:39","1806.28"
"grafana/loki","81f97867a163e468495991a1b6f045b2382c666b","daixiang0","2019-10-15 02:36:34","false","doc(fluent-bit): add missing namespace (#1077)

* doc(fluent-bit): add missing namespace

Signed-off-by: Xiang Dai <764524258@qq.com>

* fix a nit

Signed-off-by: Xiang Dai <764524258@qq.com>",66,18,0,0,"2018-04-16 10:25:39","543.92"
"grafana/loki","89ffbf7c21b45ec3244d43550b9d29e2488b37d7","daixiang0","2019-04-30 07:40:16","false","Add option (#528)

* Add chunk_block_size option

Introduce by #464.

Signed-off-by: Xiang Dai <764524258@qq.com>

* fix white noise

Signed-off-by: Xiang Dai <764524258@qq.com>

* Bump up helm version

Signed-off-by: Xiang Dai <764524258@qq.com>",97,12,0,0,"2018-04-16 10:25:39","379.14"
"grafana/loki","7e3610bee8ba46c2386243825da706f89dec7489","owen-d","2021-02-26 16:36:25","true","Distributor overview docs (#3371)

* distributor overview

* edge case edits

* Update docs/sources/architecture/distributor.md

Co-authored-by: Ed Welch <ed@oqqer.com>

* suggestions

* further pr feedback

* typo

Co-authored-by: Ed Welch <ed@oqqer.com>",133,34,0,1,"2018-04-16 10:25:39","1040.76"
"grafana/loki","b861757b346fced7de2a258dd8ad89aad7e24b7b","owen-d","2021-01-20 20:16:18","true","Ignore flushed chunks during checkpointing (#3195)

* dont checkpoint flushed chunks

* commenting",113,33,0,1,"2018-04-16 10:25:39","1004.91"
"grafana/loki","4d61d0a90124688d0bd66937acdabc1dfd8f7080","JStickler","2023-11-02 17:42:14","true","[Style] Data source as two words. (#11124)

**What this PR does / why we need it**:
Updating ""datasource"" to be ""data source"" per recent decision by Style
Council.",14,66,1,0,"2018-04-16 10:25:39","2022.55"
"grafana/loki","7f24b0f6ab242205430950f847b8faeea9fa43bb","MasslessParticle","2022-07-06 22:40:26","true","Remove ourdated comment (#6597)",71,51,0,1,"2018-04-16 10:25:39","1541.51"
"grafana/loki","d7c35951c348a70b8ed00f4e9d9be77c26a3e491","taisho6339","2021-11-29 13:38:52","true","Use http prefix path correctly in promtail (#4832)

* Use http prefix path correctly in promtail

* Update changelog entry",215,43,0,0,"2018-04-16 10:25:39","1318.88"
"grafana/loki","63e25c9c15386e1675ba4c0a2089c15493c804fa","periklis","2021-04-22 15:35:36","true","Add Red Hat to adopters (#3644)

* Add Red Hat to adopters

* Update ADOPTERS.md",165,36,0,1,"2018-04-16 10:25:39","1101.97"
"grafana/loki","2c20ce6857962810d4d5f67d3af853cbed15ed8d","liguozhong","2022-01-14 18:20:20","true","[optimization] cache prometheus : fix ""loki_cache_request_duration_seconds_bucket"" ‘status_code’ label always equals ""200"" (#4891)

* [optimization] cache prometheus : fix ""loki_cache_request_duration_seconds_bucket"" ‘status_code’ label always equals ""200""

* [optimization] cache prometheus : fix ""loki_cache_request_duration_seconds_bucket"" ‘status_code’ label always equals ""200"" #4891

* [optimization] cache prometheus : fix ""loki_cache_request_duration_seconds_bucket"" ‘status_code’ label always equals ""200"" #4891

* [optimization] cache prometheus : fix ""loki_cache_request_duration_seconds_bucket"" ‘status_code’ label always equals ""200"" #4891

* [optimization] cache prometheus : fix ""loki_cache_request_duration_seconds_bucket"" ‘status_code’ label always equals ""200"" #4891

* Update pkg/storage/chunk/cache/instrumented.go

Co-authored-by: Karsten Jeschkies <k@jeschkies.xyz>

* [optimization] cache prometheus : fix ""loki_cache_request_duration_seconds_bucket"" ‘status_code’ label always equals ""200"" #4891

* [optimization] cache prometheus : fix ""loki_cache_request_duration_seconds_bucket"" ‘status_code’ label always equals ""200"" #4891

* Update pkg/querier/queryrange/roundtrip.go

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>

* Update roundtrip.go

Co-authored-by: Karsten Jeschkies <k@jeschkies.xyz>
Co-authored-by: Owen Diehl <ow.diehl@gmail.com>",263,45,0,1,"2018-04-16 10:25:39","1364.08"
"grafana/loki","c158b2c5f5107dc710575c05f5db1889e151114d","slim-bean","2022-04-05 16:44:23","true","Loki: Revert #4845 which changed the format of errors from the API (#5772)

* This reverts the changes from #4845, unfortunately changing the content type from plain text to JSON is a breaking change of the API and we should wait to do this at a major release.

Signed-off-by: Ed Welch <edward.welch@grafana.com>

* fix tests which were updated after initial change.

Signed-off-by: Ed Welch <edward.welch@grafana.com>",321,47,0,1,"2018-04-16 10:25:39","1445.01"
"grafana/loki","2ac409c23e834474b89f7f0974a859c271219e7d","slim-bean","2021-11-04 13:54:08","true","Build: simplify how protos are built (#4639)

* we always seem to be chasing our tails with how protos are generated and Makes use of timestamps to determine if files should be recompiled. Instead of touching files and altering timestamps always delete the compiled proto files when calling `protos` to make sure they are compiled every time.

Removed targets to build protos, yaccs, and ragel files when trying to build loki or the canary. This isn't necesary, if you are changing these files you would know you need to build them and the `check-generated-files` should catch any changes to them not committed.

* rm -rf

* we have a race between check-generated-files and our other steps, so let that run first.

also removing `check-generated-files` from the `all` target because its redundant with a separate step and could also race with the parallel lint

* remove TOUCH_PROTOS

* more cleanup of TOUCH_PROTOS",170,43,0,1,"2018-04-16 10:25:39","1293.89"
"grafana/loki","af452047d32bd88971307146814e5e82b2bbabda","jeschkies","2021-07-09 14:00:47","true","Return build info under `/loki/api/v1/status/buildinfo`. (#3972)

* Return build info under `/version`.

Closes #3221

* Update documentation.

* Correct docs.

* Format version handler code.

* Ignore write error.

* Sort imports.

* Use `PrometheusVersion` struct.

* Set Go version.",107,39,0,1,"2018-04-16 10:25:39","1178.9"
"grafana/loki","8feadf7924ae78f18f1187f4cacef539842d163c","pracucci","2019-07-23 13:30:09","false","fix: Speed up Loki shutdown when using the sample local config (#784)",103,15,0,0,"2018-04-16 10:25:39","462.38"
"grafana/loki","ccef3da2b61324bc0f8ae9e7ec6456110cf1ae05","rfratto","2019-12-09 16:01:14","true","Update changelog for 1.2.0 release (#1388)

* Update changelog for 1.2.0 release

* Update CHANGELOG.md

Co-Authored-By: Ed Welch <ed@oqqer.com>

* docs: update reference to release tag to v1.2.0",92,20,0,1,"2018-04-16 10:25:39","598.48"
"grafana/loki","567ccde0b6e06dbf7533c5277d28dbc58a0d1c5f","cyriltovena","2021-01-26 08:35:29","true","Re-introduce https://github.com/grafana/loki/pull/3178. (#3233)

Lost during a merge/rebase of https://github.com/grafana/loki/commit/6cc41f92f8adfabe3df4fab7780f56830b408eec :shrug:

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",121,33,0,1,"2018-04-16 10:25:39","1010.42"
"grafana/loki","474adc082027b2f54bb28e829239c35b6adafeac","chaudum","2022-03-04 14:30:09","true","Fix path to binary in Dockerfile for querytee (#5537)

* Fix path to binary in Dockerfile for querytee

The Dockerfile referenced an incorrect path of the querytee binary
causing the build of the querytee image to fail.

```
$ make loki-querytee-image
docker build -t grafana/loki-querytee:main-84c97ce -f cmd/querytee/Dockerfile .
Sending build context to Docker daemon  650.6MB
...
Step 7/8 : COPY --from=build /src/loki/cmd/querytee/loki-querytee /usr/bin/querytee
COPY failed: stat src/loki/cmd/querytee/loki-querytee: file does not exist
make: *** [Makefile:526: loki-querytee-image] Error 1
```

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* Add querytee binary to Docker ignore file

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",297,46,0,1,"2018-04-16 10:25:39","1413.92"
"grafana/loki","bac52165d3389b157b1b3ae1cb7bd7372cfdec24","owen-d","2022-09-21 12:39:18","true","highly sharded subqueries are ellided in expr.String (#7203)

This is mostly a quality of life improvement. Highly sharded subqueries
can be burdensome to view and they're logged on every request. This PR
will only display the first four subqueries in a
`Concat{Log,Sample}Expr`, which is easier on the eyes when viewing logs
and is more efficient.",86,53,1,1,"2018-04-16 10:25:39","1616.09"
"grafana/loki","b3bc8d3063f7f67a5e25e0b9c971327de33b6bc0","chaudum","2022-04-19 09:52:18","true","Other: Improve check-drone-drift script (#5925)

* Improve check-drone-drift script

Instead of checking the line count of the current branch an main, run
`make drone` and check if there are changes to the target
`.drone/drone.yml` file.

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* Generate .drone/drone.yml using `make drone`

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* fixup! Generate .drone/drone.yml using `make drone`

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",173,48,0,1,"2018-04-16 10:25:39","1463.98"
"grafana/loki","cbd6ec15ce5616cc7ff31b3d41f54156d0e99ff7","kavirajk","2022-12-14 15:19:56","true","feat(logql): Supporting prettifying LogQL expressions (#7906)

**What this PR does / why we need it**:

Changes
1. Added `Pretty()` method to `Expr` interface. So that every expression
would know how to render themselfs as pretty :)
2. Implemented `Pretty()` for every single LogQL expressions
3. Exposed `/api/v1/format_query` endpoint that takes `query` argument
and returns formatted version.
4. Integerated into `logcli`. echo `'<query>' | logcli fmt` would format
the query.

Why?
1. Readability, helpful in debugging and **more importantly, to
understand the execution flow**

example

**before**
```
quantile_over_time(0.99,{container=""ingress-nginx"",service=""hosted-grafana""}| json| unwrap response_latency_seconds| __error__=""""[1m]) by (cluster)
```

```
sum(rate({job=""loki"", namespace=""loki"", cluster=""loki-dev-us""} |= ""err"" [5m])) + sum(rate({job=""loki-dev"", namespace=""loki"", cluster=""loki-dev-eu""}|logfmt | level != ""info"" [5m])) / sum(rate({job=""loki-prod"", namespace=""loki"", cluster=""loki-prod-us""} |logfmt | level=""error""[5m]))
```

```
label_replace(rate({job=""api-server"",service=""a:c""}|= ""err"" [5m]), ""foo"", ""$1"", ""service"", ""(.*):.*"")
```

**after**
```
quantile_over_time(
  0.99,
  {container=""ingress-nginx"", service=""hosted-grafana""} | json
    | unwrap response_latency_seconds
    | __error__="""" [1m]
) by (cluster)

```

```
  sum(
    rate(
      {job=""loki"", namespace=""loki"", cluster=""loki-dev-us""} |= ""err"" [5m]
    )
  )
+
    sum(
      rate(
        {job=""loki-dev"", namespace=""loki"", cluster=""loki-dev-eu""}
          | logfmt
          | level!=""info"" [5m]
      )
    )
  /
    sum(
      rate(
        {job=""loki-prod"", namespace=""loki"", cluster=""loki-prod-us""}
          | logfmt
          | level=""error"" [5m]
      )
    )

```

```
label_replace(
  rate({job=""api-server"", service=""a:c""} |= ""err""[5m]),
  ""foo"",
  ""$1"",
  ""service"",
  ""(.*):.*""
)

```

You can find more examples in the `prettier_test.go`



Future plans
* Integerate into LogQL analyzer
* Integrate into Grafana UI.

**Which issue(s) this PR fixes**:
Fixes # NA

**Special notes for your reviewer**:
This whole idea was inspired from last [PromCon lighting
talk](https://youtu.be/pjkWzDVxWk4?t=24469)

**Checklist**
- [x] Reviewed the `CONTRIBUTING.md` guide
- [x] Documentation added
- [x] Tests updated
- [x] `CHANGELOG.md` updated

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>
Co-authored-by: Christian Haudum <christian.haudum@gmail.com>
Co-authored-by: Christian Simon <simon@swine.de>",101,56,1,1,"2018-04-16 10:25:39","1699.2"
"grafana/loki","9a61ba5229f36fc7a20b8186ab749b52fb3a9141","xperimental","2023-04-26 13:36:06","true","operator: Update skipRange for 5.8 release (#9298)",81,60,1,1,"2018-04-16 10:25:39","1836.38"
"grafana/loki","b865b81ba0654aaf18d1967bf7388551efd53528","MichelHollands","2022-04-06 10:08:23","true","Add a DeletionMode config variable (#5481)

* Add deletionEnabled setting and remove delete request manager

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Rebase

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Remove deletion handling from delete requests manager

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* change store so it stores a logql statement

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Add validation code for logql statement

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Run deleteRequestsManager when deletion is enabled

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Remove unused variables

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Revert ""Remove deletion handling from delete requests manager""

This reverts commit ce4f774497aa590caff86b0745ec81588592a9e1.

* Re-add IsDeleted method

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Re-add tests for IsDeleted

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Fix delete request store test

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Fix linting issue

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Revert compactor changes

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Add deletion mode

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Add v1 mode

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Rename LogQLRequest to Query

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Fix linting issues

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Use DeleteMode in compactor module

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Rename logql to query

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Put cancel under delete verb

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Update documentation

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Update changelog

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Revert only the API surface area while keeping everything else

* Use moved code in syntax package

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Remove duplicte import

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Use renamed field in tests

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Remove duplicates and empty lines in changelog

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Update changelog description

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Update pkg/storage/stores/shipper/compactor/deletion/delete_request.go

Co-authored-by: Christian Simon <simon@swine.de>

* Update pkg/storage/stores/shipper/compactor/deletion/delete_requests_manager_test.go

Co-authored-by: Christian Simon <simon@swine.de>

* Update pkg/storage/stores/shipper/compactor/deletion/delete_requests_store.go

Co-authored-by: Christian Simon <simon@swine.de>

* Update pkg/storage/stores/shipper/compactor/deletion/delete_requests_store.go

Co-authored-by: Christian Simon <simon@swine.de>

* Update CHANGELOG.md

Co-authored-by: Christian Simon <simon@swine.de>

* Update pkg/storage/stores/shipper/compactor/deletion/delete_requests_store.go

Co-authored-by: Christian Simon <simon@swine.de>

* Make DeletionMode struct member non public

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Revert change to docs re cancellation

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Use same variable names

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Add parameter validation to changelog

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Rename v1 to WholeStreamDeletion

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Fix default value of deletion mode config setting

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* reimplement new api

* Add delete request handler when delete mode is set

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Remove unused variable

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Add comment to change the code when other deletion modes are available

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* create expirationChecker if deletionMode is set

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Address review comments

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Update pkg/storage/stores/shipper/compactor/compactor.go

Co-authored-by: Sandeep Sukhani <sandeep.d.sukhani@gmail.com>

* Rename AddQuery to SetQuery

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

Co-authored-by: Travis Patterson <travis.patterson@grafana.com>
Co-authored-by: Christian Simon <simon@swine.de>
Co-authored-by: Sandeep Sukhani <sandeep.d.sukhani@gmail.com>",322,47,0,1,"2018-04-16 10:25:39","1445.74"
"grafana/loki","10e3d80731b9dd1b9ef91d7ba841ede5ebb6ee67","MichelHollands","2023-03-09 14:56:30","true","Fix distributor latency panel (#8760)

**What this PR does / why we need it**:

https://github.com/grafana/loki/pull/8247 changes a metric generated by
a recording rule. This fixes the ""Distributor Panel"" to use this
different metric. Tested by changing the ""Distributor Panel"" manually to
see it showed results.

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

---------

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",88,59,1,1,"2018-04-16 10:25:39","1784.19"
"grafana/loki","85f8a6df62e369463f3d14cc45ea7e0ed341a76d","tomwilkie","2018-06-05 12:14:20","false","We'll need to the code to figure out what images to push.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",1,2,0,0,"2018-04-16 10:25:39","49.08"
"grafana/loki","a6bbe8a298645fc5578f372b4c99a6b2ebfba2e3","kavirajk","2022-08-09 10:49:52","true","chore(makefile): Remove `NETGO` check after building loki binaries. (#6856)

Encountered after upgrade to go1.19 in local breaks this assumption. Meaning, even if your loki binary built with `-tags netgo` that file `cgo_stub.go` doesn't exist in the binary. And any make <binary> keep failing.

```
 \nYour go standard library was built without the 'netgo' build tag.
To fix that, run
    sudo go clean -i net
    sudo go install -tags netgo std
make: *** [Makefile:149: cmd/loki/loki] Error 1
```

But even those commands not helping. Looks like this check was added by Tom at 2018.
tbh, checking for filename inside the binary is too much internal details that is subjected to change (which is what happened here I think).

NOTE: Had some internal discussions and confirmed that we don't need this check in recent Go versions anymore.

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",74,52,0,1,"2018-04-16 10:25:39","1574.02"
"grafana/loki","7bcdf0e0b1ae136cc2ffebf72dc9a9997552549f","gouthamve","2018-12-18 11:55:26","true","Tenant metrics (#135)

* Fix stream tracking metric

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>

* Track lines and bytes received per user

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>

* Use instance instead of org

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>

* Nuke dead code

Usage has been removed as part of perf-optimisation:
https://github.com/cortexproject/cortex/commit/3006e3901d607f25fa2e213ae05d00380e80a8bc#diff-180f56d9aaf5a9aa079e6fc9cfcf1bc8L365

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>",38,8,0,0,"2018-04-16 10:25:39","242.06"
"grafana/loki","9fe1a8f152cf0aa31595453a13e80e2a07c5cd3f","adityacs","2019-07-31 14:26:09","false","docs(logcli): clarify usage of GRAFANA_ADDR (#822)

Adds an example of how to setup the `GRAFANA_ADDR` environment variable when not using Grafana Cloud but rather a local or otherwise hosted instance of Loki",106,15,0,1,"2018-04-16 10:25:39","470.42"
"grafana/loki","94169a0e6b5bf96426ad21e40f9583b721f35d6c","hainenber","2023-11-06 12:31:15","true","fix(tools/lambda-promtail): Do not evaluate empty string for drop_labels (#11074)

Fixes #11005 

Signed-off-by: hainenber <dotronghai96@gmail.com>",11,67,1,0,"2018-04-16 10:25:39","2026.34"
"grafana/loki","50126731f8cdc1d50b329f57d9eef85b8aed9dd9","deepansh96","2023-06-13 10:28:36","true","Update README.md (#9698)

Backticks were missing for a code block

**What this PR does / why we need it**:

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",66,62,1,0,"2018-04-16 10:25:39","1883.25"
"grafana/loki","2cec818a794d4e4daad9d462f4cd248f74ca2e76","JoaoBraveCoding","2023-04-27 19:10:09","true","operator: Add PodDisruptionBudget to lokistack-ingestion path (#9260)",80,60,1,0,"2018-04-16 10:25:39","1837.61"
"grafana/loki","6cf3a9015e50a6a92a03dcd5bced1e67f3d31012","tomwilkie","2018-05-16 10:38:32","false","Fix type error in distributor.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",0,1,0,0,"2018-04-16 10:25:39","30.01"
"grafana/loki","ab1c38ad993af22b1565e0d1349b7e36de249304","09jvilla","2021-08-04 21:49:59","true","Update the docs to install Loki with Tanka (#4083)

* Update to the Loki tanka install docs to reflect changes made in tanka.

Also pulled up the docs piece about the bolt-db-shipper-shared-store so users know they must modify it, rather than seeing it as a note further down.

I think we're probably still missing one more update to the yaml to add the `schema_config` override, but that can come as a separate pr.

* Adding the schema config block. Think we should update here because we otherwise default to gcs, which will throw an error if the user wants to use aws s3.

* Updated the value we recommend for 'from'

* Update docs/sources/installation/tanka.md

Co-authored-by: Sandeep Sukhani <sandeep.d.sukhani@gmail.com>

* Apply suggestions from code review

Thank you Karen!

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* Tried to get more clarify around how I""m describing the object storage type.

* Update docs/sources/installation/tanka.md

Typos begone!

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

Co-authored-by: Sandeep Sukhani <sandeep.d.sukhani@gmail.com>
Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>",102,40,0,0,"2018-04-16 10:25:39","1204.23"
"grafana/loki","5eef13449be8a7698c16d4cf3e3cce8b2caf11b0","periklis","2023-04-05 15:49:21","true","operator: Update Loki operand to v2.8.0 (#9036)",82,59,1,1,"2018-04-16 10:25:39","1810.22"
"grafana/loki","181f4b698da628c6426f3e822a105872ac5aea55","cyriltovena","2022-01-11 10:02:41","true","Fixes metric name for hedging object store requests (#5098)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",258,45,0,1,"2018-04-16 10:25:39","1360.73"
"grafana/loki","ca8a7accf008f87bec7d95b8fa7e27f626fb9f75","salvacorts","2023-05-02 14:48:38","true","Add query info to query.Exec span (#9320)

**What this PR does / why we need it**:
It's kinda difficult to see the query that is being run on a trace.

The only place where I can see the query is in the `url` attribute of
the `loki_api_v1_query_range` handler, but since it’s encoded it’s kinda
difficult to read. If it's elsewhere it's not quite obvious.

It’d make sense to have the query in the `query.Exec` span along with
the stats of the query.

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",80,61,1,1,"2018-04-16 10:25:39","1842.43"
"grafana/loki","bab049ca6f7975c5e11e3843825fa2e088f2da46","MasslessParticle","2022-08-08 19:17:03","true","Only process deletes in batches (#6851)

* Only process deletes in batches

* better logging",75,52,0,1,"2018-04-16 10:25:39","1573.37"
"grafana/loki","bdb0aa0bf45ba57eb37c53c8243797d61d5762f6","mar4uk","2022-11-09 10:03:44","true","Promtail: Add go build tag promtail_journal_enabled (#7587)

**What this PR does / why we need it**:
This PR introduces the new go build tag `promtail_journal_enabled`. This
tag is passed to go build if the environment variable
`PROMTAIL_JOURNAL_ENABLED=true` is present.
It is useful for users with Linux OS and CGO enabled. Currently, if the
user has Linux and CGO enabled he has to install `libsystemd-dev`
library (`sudo apt install -y libsystemd-dev`) even when he doesn't need
journald support.",84,55,1,0,"2018-04-16 10:25:39","1663.98"
"grafana/loki","38b298c3fe68004336f078338a548aa6cabb290d","liguozhong","2023-04-28 14:09:33","true","LogQL: Introduce `distinct` (#8662)

**What this PR does / why we need it**:
Introduces `distinct` to LogQL.
Usage:
`{job=""varlogs""} | distinct filename`
It is similar to `distinct` in SQL and especially useful for sampling.
Similar syntax exists in other log query languages.

**Example**
For the following log lines:
```json
{""event"": ""access"", ""id"": ""1"", ""time"": ""2023-02-28 15:12:11""}
{""event"": ""access"", ""id"": ""1"", ""time"": ""2023-02-28 15:13:11""}
{""event"": ""access"", ""id"": ""2"", ""time"": ""2023-02-28 15:14:11""}
{""event"": ""access"", ""id"": ""2"", ""time"": ""2023-02-28 15:15:11""}
```

The query below:
```logql
{app=""order""} | json | distinct id
```

Will return:
```json
{""event"": ""access"", `""id"": ""1"",` ""time"": ""2023-02-28 15:13:11""}
{""event"": ""access"", `""id"": ""2"", `""time"": ""2023-02-28 15:15:11""}
```

**Example with multiple labels**
```logql
{app=""order""} | json | distinct id,time
```

**Which issue(s) this PR fixes**:
Fixes #8649 

---------

Co-authored-by: J Stickler <julie.stickler@grafana.com>
Co-authored-by: Dylan Guedes <djmgguedes@gmail.com>
Co-authored-by: Karsten Jeschkies <karsten.jeschkies@grafana.com>",80,60,1,1,"2018-04-16 10:25:39","1838.41"
"grafana/loki","acde1799b6d4334efb07b04e10ea805e48f50dac","KMiller-Grafana","2021-09-29 12:31:50","true","Docs: clarify distinction between single binary and microservices. (#4374)

* Docs: clarify distinction between single binary and microservices.

* Update clarification of mode per review suggestions",139,41,0,0,"2018-04-16 10:25:39","1258.84"
"grafana/loki","2b92aeeab81180a8b1e302a9d2e96b32fe8c4f7b","jdbaldry","2023-05-01 08:41:10","true","Update centralized make-docs procedure (#9287)

**What this PR does / why we need it**:
Supports Ubuntu Snap based Docker installations by using TMPDIR instead
of an explicit tempfile.

Because Ubuntu Snap packages have access to only the user's home
directory, users must specify something like `TMPDIR=""$(mktemp -d -q
~/.make-docs.XXXXX)""` in order to be able to run `make docs`.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>",79,60,1,0,"2018-04-16 10:25:39","1841.18"
"grafana/loki","b1b82a6000364e78e7f49b20843d7ff359598414","taisho6339","2021-11-23 16:02:44","true","[Hot Fix] Merge improving case sensitive search correctly (#4804)

* Improve case sensitive search to avoid allocations.

```
❯ benchcmp  before.txt after.txt
benchmark                                            old ns/op     new ns/op     delta
Benchmark_LineFilter/default_true_(?i)foo-16         2400          2233          -6.96%
Benchmark_LineFilter/simplified_true_(?i)foo-16      201           228           +13.13%
Benchmark_LineFilter/default_false_(?i)foo-16        2443          2376          -2.74%
Benchmark_LineFilter/simplified_false_(?i)foo-16     185           231           +24.96%

benchmark                                            old allocs     new allocs     delta
Benchmark_LineFilter/default_true_(?i)foo-16         0              0              +0.00%
Benchmark_LineFilter/simplified_true_(?i)foo-16      1              0              -100.00%
Benchmark_LineFilter/default_false_(?i)foo-16        0              0              +0.00%
Benchmark_LineFilter/simplified_false_(?i)foo-16     1              0              -100.00%

benchmark                                            old bytes     new bytes     delta
Benchmark_LineFilter/default_true_(?i)foo-16         0             0             +0.00%
Benchmark_LineFilter/simplified_true_(?i)foo-16      128           0             -100.00%
Benchmark_LineFilter/default_false_(?i)foo-16        0             0             +0.00%
Benchmark_LineFilter/simplified_false_(?i)foo-16     128           0             -100.00%
```

It's not much but for a billions line it makes a big difference.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Simplified version

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Cleanup

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

Co-authored-by: Cyril Tovena <cyril.tovena@gmail.com>",211,43,0,0,"2018-04-16 10:25:39","1312.98"
"grafana/loki","3e77423f9144f22d62f35cb1190925b9530a303b","slim-bean","2022-05-26 09:02:09","true","Migrate Tool: Update to work with boltdb-shipper, improve logging output. (#6237)

* update migrate tool

Signed-off-by: Edward Welch <edward.welch@grafana.com>

* improve logging
don't use any caches

Signed-off-by: Edward Welch <edward.welch@grafana.com>

* comment out some more log lines

Signed-off-by: Edward Welch <edward.welch@grafana.com>

* change stat types

Signed-off-by: Edward Welch <edward.welch@grafana.com>

* update docs and comments as well as set some lower times on a few boltdb-shipper timers

Signed-off-by: Edward Welch <edward.welch@grafana.com>

* remove changes to the Makefile which weren't meant to make it to the PR

Signed-off-by: Edward Welch <edward.welch@grafana.com>

* remove some commented code

Signed-off-by: Edward Welch <edward.welch@grafana.com>

* fix tests

Signed-off-by: Edward Welch <edward.welch@grafana.com>

* lint

Signed-off-by: Edward Welch <edward.welch@grafana.com>",73,49,0,1,"2018-04-16 10:25:39","1500.94"
"grafana/loki","5ece938f3ce128c4772e459a0ff79d5c8d187616","jeschkies","2021-11-17 15:07:07","true","Run all benchmarks. (#4742)

* Run all benchmarks.

* Start debugging memchunk benchmark.

* Do not iterate when closed.

* Pass default tenant config.

* Set default limits.

* Fix two more benchmarks.

* Enable cron trigger again.",201,43,0,1,"2018-04-16 10:25:39","1306.95"
"grafana/loki","8cd276d4ace9a89ba11946ff598f4f5d3bcfc0be","slim-bean","2020-12-10 20:33:04","true","v3 of chunk encoding serializes all block data (#2934)

(cherry picked from commit 663c872a4cda11e02bbbbc201a3d503c63d7be15)",122,32,0,1,"2018-04-16 10:25:39","964.92"
"grafana/loki","ec1be4904a8789deb181341d8d8479279077d421","slim-bean","2019-09-09 22:10:53","true","adding git to alpine image for drone deploy step",118,17,0,1,"2018-04-16 10:25:39","508.74"
"grafana/loki","db1873ea1dbbfc8278b1f196d1002e24ea0010a8","ivanahuckova","2021-06-22 13:07:44","true","Update _index.md (#3876)

We are using the word `backtick` at couple of places and `back-tick` is used just once.",104,38,0,0,"2018-04-16 10:25:39","1161.86"
"grafana/loki","2d1d5d29e4ddda1b15783b79b3101a7f353beafc","ashwanthgoli","2023-09-05 09:12:30","true","docs: append logfmt parser improvements to release notes (#10431)

**What this PR does / why we need it**:
append logfmt parser improvements to release notes

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",47,65,1,0,"2018-04-16 10:25:39","1965.2"
"grafana/loki","88721889f5a8facb4d0314bc3f564102aa9ffe9d","SeriousM","2021-09-09 00:27:43","true","Correct the indention for azure configuration (#4283)

The snippet part for storage_config was indented into schema_config which is wrong.",127,41,0,0,"2018-04-16 10:25:39","1238.33"
"grafana/loki","35feea5a58cfd4f39d4fb768eafff39618feafff","tarokkk","2020-07-23 13:56:10","true","make fluentd verson more flexible for updatess (#2399)",119,27,0,0,"2018-04-16 10:25:39","827.65"
"grafana/loki","44f1d8d7f6b1fb9b7fac32e913bd6517d15bad3f","abaguas","2023-03-27 16:01:19","true","azure: respect retry config before cancelling the context (#8732)

**What this PR does / why we need it**:

On GET blob operations a context timeout is set to `RequestTimeout`,
however this value is not the full timeout. This is only the first
timeout and afterwards there are retries. As a result, the retry
configuration is never used because the context is immediately
cancelled.

To fix we should set the context timeout to a value larger than the
Azure timeout after retries. Since the backoff is exponential and
randomized we need to take the value of `MaxRetryDelay` to set an upper
bound.",82,59,1,0,"2018-04-16 10:25:39","1802.23"
"grafana/loki","389eee4cc78e24e604d8ee35221a61f02aa59d05","DylanGuedes","2022-07-04 18:07:49","true","Stop compaction interval timer to avoid leak. (#6570)",72,51,0,1,"2018-04-16 10:25:39","1539.32"
"grafana/loki","609bc229335895924759410d7ec9f05eff1c2423","DylanGuedes","2023-06-08 12:04:45","true","Distributor: Make  key configurable when logging failures (#9659)

**What this PR does / why we need it**:
Make appending `insight=true` key-value pair to log failures
configurable.

**Which issue(s) this PR fixes**:
N/A",68,62,1,1,"2018-04-16 10:25:39","1878.32"
"grafana/loki","ffbabc5715f14fbfddbd4bbe4c91bcbd554deea5","MichelHollands","2021-03-30 09:58:38","true","LBAC changes (#3549)

* Add querier override and tripperware

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Use new queryable in engine

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Removed unused Queryable

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Only use QueryFrontEndTripperware if set

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",142,35,0,1,"2018-04-16 10:25:39","1074.48"
"grafana/loki","900f714e9d2bbfda6da7e22c32a91d593be15f75","yeya24","2020-09-03 14:51:07","true","add _total suffix to ruler counter metrics (#2582)

Signed-off-by: Ben Ye <yb532204897@gmail.com>",121,29,0,0,"2018-04-16 10:25:39","867.68"
"grafana/loki","6d5408c100e464e807cc3b1ad48be512c96167e3","pstibrany","2020-04-14 14:19:56","true","Update Cortex to latest master (#1869)

* Update Cortex to master

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Fix compilation errors after Cortex update.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Update to Cortex v1.0.0-rc.0

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Added missing vendored file.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Vendor Cortex 1.0.0

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Configuration changes.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Mention Cortex 1.0 changes and link to docs.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Fix jsonnet files, and mention fields that were removed.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>",121,24,0,0,"2018-04-16 10:25:39","723.41"
"grafana/loki","4fea713b1ef3a571f7949fb28a4c1c1fca43ac4d","pstibrany","2019-12-13 14:48:08","false","pkg/promtail/client: missing URL in client returns error (#1416)

Previously it would just panic, because URL.Host is used to construct logger.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>",95,20,0,0,"2018-04-16 10:25:39","602.43"
"grafana/loki","e3b35df5bc764dbffd7bc45a00f8988abd6692eb","Birdi7","2021-09-09 14:26:30","true","docs: fix link to Promtail documentation (#4293)

* chore: fix link to Promtail documentation

The current link to Promtail installation documentation in the file leads to 404 error. I observed that the `../docs/clients/` folder was refactored into `../docs/sources/clients` at same time in past. However, the `loki/docs/sources/clients/promtail/installation.md` file is not very convenient if we talk about UX. So, I've replaced the wrong link with the one to rendered beautiful documentation

* chore: make link relative",129,41,0,0,"2018-04-16 10:25:39","1238.92"
"grafana/loki","cce3d3bed986fd1bd6aad023d3143f2a60a6c7f0","kavirajk","2023-04-04 17:42:17","true","chore(format_query): Change response type to `application/json` (#9016)",81,59,1,1,"2018-04-16 10:25:39","1809.3"
"grafana/loki","60f57607b78654be141fd3298986aeea8af3f336","trevorwhitney","2023-08-31 14:36:01","true","helm: omit annotation section when empty (#10388)

This is a small, nit-picky stylistic change to the helm chart. When
there are no annotations for a template, this omits the `annotations`
key, rather than having an empty `annotations` section in the rendered
template.",45,64,1,1,"2018-04-16 10:25:39","1961.42"
"grafana/loki","7014e5ce7f884fec07874a67f5aef1f22d1d56cf","aknuds1","2023-07-31 09:22:12","true","log: Use dskit/log.BufferedLogger instead of LineBufferedLogger (#10005)

**What this PR does / why we need it**:
`pkg/util/log.LineBufferedLogger` was ported to
`dskit/log.BufferedLogger` in https://github.com/grafana/dskit/pull/338,
so this utility can be shared among projects. This PR modifies Loki to
use the dskit implementation.",52,63,1,0,"2018-04-16 10:25:39","1931.21"
"grafana/loki","3ed54048a540b209c84c48b1c1eb9c646ee5624d","chaudum","2023-04-21 06:30:25","true","Docs: Add operational docs for query fairness within tenants (#8879)

**What this PR does / why we need it**:

This PR contains documentation how to make use of the newly added hierarchical scheduler queues.

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",80,60,1,1,"2018-04-16 10:25:39","1831.09"
"grafana/loki","371455770f26cee27df71f3a35f25aaf90396513","kavirajk","2023-03-02 21:42:16","true","doc(best-practices): Update default value of `max_chunk_age`. (#8685)",72,58,1,1,"2018-04-16 10:25:39","1777.47"
"grafana/loki","560440a58dd873b219993d832081ca1669493efd","bboreham","2023-01-26 11:50:10","true","Update Prometheus to v2.41, plus dependencies (#8290)",79,57,1,0,"2018-04-16 10:25:39","1741.06"
"grafana/loki","f14f9dd8c4c699bf29eb756a2f05886ab70b4c63","owen-d","2022-05-20 11:53:19","true","prevents sharding avg and avg_over_time when their children arent shardable. (#6204)",72,49,0,1,"2018-04-16 10:25:39","1495.06"
"grafana/loki","8cd4694adbc7b3236e8908e14f51283e027a078d","sandeepsukhani","2022-05-02 12:01:57","true","allow more time for boltdb-shipper index syncs to finish (#6071)

* retains index files with ingester for 20 mins instead of 12 mins after uploading
* sets GetChunkIDs lookback to 2h41m instead of 2h28m",74,49,0,1,"2018-04-16 10:25:39","1477.07"
"grafana/loki","a7795e57b00c6e266e49bc75d0fd0095c3a2f59b","cyriltovena","2022-01-10 08:15:28","true","Fixes a possible cancellation issue (#5075)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",254,45,0,1,"2018-04-16 10:25:39","1359.66"
"grafana/loki","1e998899b0bd406a600d3b11f64a09ce13aa65a0","cstyan","2021-08-24 23:09:59","true","Update tanka installation docs to refer to tanka section about `jb` (#4208)

installation instead of providing a cli command that may not work.

Signed-off-by: Callum Styan <callumstyan@gmail.com>",127,40,0,1,"2018-04-16 10:25:39","1224.28"
"grafana/loki","6ab832b2ca158cc2a2681c66043f51f180495684","cyriltovena","2020-06-22 12:58:57","true","Cache overlapping blocks (#2239)

* Caches block iteration that are overlapping together to avoid reprocessing.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* lint.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Moar tests.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Final touch.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* lint.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",138,26,0,1,"2018-04-16 10:25:39","796.61"
"grafana/loki","422a40b958c11cd2659dd461c5a29d1c0b708666","mattmendick","2020-02-06 20:04:08","true","Attempting to add `informational` only feedback for codecov (#1647)

An attempt to try to add the `informational` flag (to not fail build steps) for the `codecov/patch` portion of the build steps. This is _not_ in their documentation, but there are lots of other things not correct in their documentation as noted on their community site, so I'm going to try this. Otherwise, I will submit another PR to turn the codecov/patch off and we'll just have stats for the whole project.",111,22,0,0,"2018-04-16 10:25:39","655.65"
"grafana/loki","bfb34e4070f8832a908ceac8368353029859bd84","tomwilkie","2019-04-18 08:33:24","false","Wire up LogQL filters in the ingester.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",96,12,0,0,"2018-04-16 10:25:39","367.17"
"grafana/loki","f45bdf498548f05716a156e80bc2aa256317fc16","davkal","2019-02-15 15:31:20","true","Merge pull request #335 from hasonhai/master

Loki pod needs secret mounting privileges",88,10,0,0,"2018-04-16 10:25:39","299.21"
"grafana/loki","e2d7a4fec3e39172edadb573d89d957b3687bb27","davkal","2019-02-15 11:51:51","true","Added question template",87,10,0,0,"2018-04-16 10:25:39","299.06"
"grafana/loki","9e22a89bcb3bf5c8503f7de36d9ee715a8fc7d5c","trevorwhitney","2023-07-14 18:50:20","true","Call FetchChunks in parallel from series index store (#9935)

This PR changes the invocation of `FetchChunks` in the series index
store to happen in parallel. It seems like this was the original
intention due to the `// bound concurrency` comment when allocating the
`groups` slice. This came out of an investigation of some slow queries,
and the traces showed many serial calls to `FetchChunks`.",58,63,1,1,"2018-04-16 10:25:39","1914.6"
"grafana/loki","64fe0af9dd86a76c28fdfd663c9671161795c193","thepalbi","2022-09-27 16:05:21","true","Expose tenant ID through relabel in push promtail targets (#7250)

**What this PR does / why we need it**:

Some Promtail targets that support pushing logs through HTTP, allow
using a specific header for writing logs for multiple tenants. This log
is propagated through a Promtail internal label, that is then consumed
by the remote write client.

If Promtail is used in a multi-tenant manner, it'd be nice to somehow be
able to track how much is each tenant's share from the logs received.
This PR exposes the received tenant id value through relabeling.

This allows for example, keeping it as a label and exposing a metric
though the `metrics` pipeline stage, which can be segregated by tenant.

**Which issue(s) this PR fixes**:
Related to https://github.com/grafana/cloud-onboarding/issues/2067",89,53,1,0,"2018-04-16 10:25:39","1622.24"
"grafana/loki","91cae03fe1a7c302f2075dd928f5fe7033c15d95","ashwanthgoli","2023-10-04 04:33:19","true","chore: restructure compactor package (#10775)

**What this PR does / why we need it**:
This pr moves the compactor pkg from
`pkg/storage/stores/shipper/indexshipper/compactor` to `pkg/compactor` -
same level as other high level components (querier, distributor...)

table compaction code however resides in the respective store pkg closer
to other store specific code.

`pkg/storage/stores/shipper/indexshipper/boltdb/compactor/table_compactor.go`
`pkg/storage/stores/shipper/indexshipper/tsdb/compactor.go`

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",28,66,1,0,"2018-04-16 10:25:39","1994.01"
"grafana/loki","2d59f890fef8c28c480ba41d940f6a981cb1df48","vishesh92","2020-10-07 10:05:09","true","Update docs for redis (#2728)",119,30,0,0,"2018-04-16 10:25:39","901.49"
"grafana/loki","e2ae4bea1fa0fd670b8e6f6cef572392c970fb19","daixiang0","2019-03-21 03:08:19","false","Add backoff_config in helm

Signed-off-by: Xiang Dai <764524258@qq.com>",92,11,0,0,"2018-04-16 10:25:39","334.7"
"grafana/loki","776c37e93f5626d14cbc244d2394d1d0f2c63dca","tomwilkie","2019-02-04 11:21:13","false","Add FOSDEM video.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",80,9,0,0,"2018-04-16 10:25:39","288.04"
"grafana/loki","b08ddc5f931a5f7b22a19856d061183cdecff636","adeverteuil","2022-04-12 06:45:05","true","Minor fix in docs/sources/logql/log_queries.md (#5868)",322,48,0,0,"2018-04-16 10:25:39","1451.6"
"grafana/loki","c0b153e4a4f2f7ee2bf28f1ab9877678c5c8bf48","tomwilkie","2018-07-04 10:48:16","true","Add tailing to CLI. (#21)

* Add tailing to CLI.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>

* Review feedback.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",5,3,0,0,"2018-04-16 10:25:39","78.02"
"grafana/loki","aed39c89ee5bc1dfd3b0b4de7d893ecaee8db36e","JStickler","2023-09-20 19:23:47","true","[docs] Replace ampersand with the word ""and"" (#10637)

Replacing the ampersand character (&) with the word `and` to conform to
the Style Guide


https://grafana.com/docs/writers-toolkit/write/style-guide/capitalization-punctuation/#punctuation-guidelines
Do not abbreviate and with an ampersand (&).",33,65,1,0,"2018-04-16 10:25:39","1980.62"
"grafana/loki","4768b6d997dfdf611aac290589c1c88c5b50fcd8","kavirajk","2022-12-13 21:16:22","true","doc(api): Default value for `delete_ring_tokens` on `/ingester/shutdown` endpoint (#7921)

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

**What this PR does / why we need it**:
PR documents the default value for `delete_ring_tokens` params on
`/ingester/shutdown` endpoint.

**Which issue(s) this PR fixes**:
Fixes #NA

**Special notes for your reviewer**:

**Checklist**
- [x] Documentation added

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",100,56,1,1,"2018-04-16 10:25:39","1698.45"
"grafana/loki","a550b767d3c8c132362165d6544a09907e613854","kavirajk","2023-10-26 13:59:16","true","config: Remove already deprecated `store.max-look-back-period`. (#11038)

This is already been deprecated longback. Decided to remove in next
versions of Loki

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",19,66,1,1,"2018-04-16 10:25:39","2016.4"
"grafana/loki","e1a3ab841ccca8f8249026615164094be0fd99db","cyriltovena","2021-05-18 07:59:03","true","Improve retention mark files. (#3706)

* Improve retention mark files.

This PR is two fold:

1) Rotate mark files when they reached 100k marks, this is to ensure we max out marks file
and don't create file that may be too big.

2) Instead of inserting marks using the chunk id as the key, we insert using a natural sequence.
This has two benefits:
- Keys are ordered, and so insertion are faster.
- Allows us to use boltdb fill percent to 100%, this means boltdb won't over allocate for inserting key in between unordered data.

Why ?

I realize that when inserting huge amount of marks, this operation can take up to hours since boltdb has to re-allocate pages over and over.
This is mainly because chunkid arrive without  specific order.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Improve key buf sizing.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* lint

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Update pkg/storage/stores/shipper/compactor/retention/marker.go

Co-authored-by: Sandeep Sukhani <sandeep.d.sukhani@gmail.com>

* Copy the value so that it still available for the whole boltdb tx.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* typo

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

Co-authored-by: Sandeep Sukhani <sandeep.d.sukhani@gmail.com>",199,37,0,1,"2018-04-16 10:25:39","1127.65"
"grafana/loki","a894c3ccf06526b82779668abeaca03691c56879","ssncferreira","2023-06-22 10:30:46","true","Bugfix: Fix logic of offset operator in instant query splitting (#9763)

**What this PR does / why we need it**:
Fix the logic of the `offset` operator for downstream queries on instant
query splitting of (range) vector aggregation expressions already
containing an offset.

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [x] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",63,62,1,0,"2018-04-16 10:25:39","1892.25"
"grafana/loki","2c2578e84c60c74c9756986279135169c11add06","cstyan","2022-03-21 10:33:33","true","Fix bug with new promtail stream lag metric where labels might not be (#5675)

applied if they don't exist on the source stream

Signed-off-by: Callum Styan <callumstyan@gmail.com>",309,47,0,1,"2018-04-16 10:25:39","1430.76"
"grafana/loki","e1bc7ea6bb0ed9236b5925d7a7255f452318be36","base698","2019-02-12 19:00:24","false","typo in EntryParser comment",84,10,0,0,"2018-04-16 10:25:39","296.36"
"grafana/loki","db2016a0f5a59dcf20fb804c4707749792d3977e","vlad-diachenko","2022-07-08 12:15:10","true","backport changelog from 2.6.0 (#6615)

* backported release 2.6.0 changelog and manually removed lines from unreleased section that are part of release 2.5.0 and 2.6.0

* resolved discussions in PR and resolved merge conflict

* Update CHANGELOG.md

Co-authored-by: Susana Ferreira <susana.ferreira@grafana.com>

Co-authored-by: Susana Ferreira <susana.ferreira@grafana.com>",69,51,0,0,"2018-04-16 10:25:39","1543.08"
"grafana/loki","c74f0802efc6e8c7f79ed0ac8c2c54d8d8ceae93","yubozhao","2019-02-20 21:10:03","false","Add documentation for different way to setup promtails",79,10,0,0,"2018-04-16 10:25:39","304.45"
"grafana/loki","c53661f45ebe0b04f2713e9ab0aa904be21dc509","JoaoBraveCoding","2023-04-28 12:18:46","true","Add default PodAntiAffinity to Ruler (#9339)

Signed-off-by: Joao Marcal <jmarcal@redhat.com>",80,60,1,0,"2018-04-16 10:25:39","1838.33"
"grafana/loki","4c8967c3223e38edd6c3f9ebdf792eca59183110","kavirajk","2021-02-22 13:02:29","true","Remove extra space between broken link (#3352)",132,34,0,1,"2018-04-16 10:25:39","1036.61"
"grafana/loki","91d837e79c08648e4533200bbe9307c2729843cc","owen-d","2022-01-27 17:13:49","true","Refactor/remove global splitby (#5243)

* cleans up internal limits struct, removes unnecessary logic

* moves querier.split-queries-by-interval to limits, simplifies resulting code.

* docs, changelog

* flag supports model.duration instead of time.duration

* lint and adds new error for deprecated field

* reregisters queryrange flags

* comment lint

* ensures we validate queryrange config and simplifies embedded struct validate()

* 0 still disables

* simplify cache key generation and protect against divide by zero",276,45,0,1,"2018-04-16 10:25:39","1377.03"
"grafana/loki","663c872a4cda11e02bbbbc201a3d503c63d7be15","owen-d","2020-11-17 13:56:46","true","v3 of chunk encoding serializes all block data (#2934)",121,31,0,1,"2018-04-16 10:25:39","941.65"
"grafana/loki","03036f13355743258404e720b8ff626dae34ecd0","chaudum","2022-04-06 07:50:05","true","golangci-lint: Check for pointers to enclosing loop variables (#5775)

* Checks for pointers to enclosing loop variables

Using the pointer to the enclosing loop variable in a range loop likely
leads to unwanted behaviour. Introducing the check `exportloopref` helps
to prevent the usage of such pointers.

> The iteration variables may be declared by the ""range"" clause using a
> form of short variable declaration (:=). In this case their types are
> set to the types of the respective iteration values and their scope is
> the block of the ""for"" statement; they are re-used in each iteration.

https://go.dev/ref/spec#For_statements

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* fixup! Checks for pointers to enclosing loop variables

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",322,47,0,1,"2018-04-16 10:25:39","1445.64"
"grafana/loki","4906fb206520770f04fb20bdb1dd5534df46b89f","pstibrany","2020-05-01 12:02:47","true","logcli: Query needs to be stored into url.RawQuery, and not url.Path (#2027)

* Query needs to be stored into url.RawQuery, and not url.Path

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* QueryStringBuilder deals with queries, not paths. Removed unused method.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Fixed test.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>",121,24,0,0,"2018-04-16 10:25:39","745.57"
"grafana/loki","0d542af45f005099a4cab2010264cd37659729c5","kavirajk","2023-09-07 10:08:49","true","changelog: move promtail specific entries to it's own section (#10498)

**What this PR does / why we need it**:
Follow up to #10497

Move promtail changelog to it's own section.

**Which issue(s) this PR fixes**:
Fixes #NA

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)

- [x] `CHANGELOG.md` updated

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",43,65,1,1,"2018-04-16 10:25:39","1967.24"
"grafana/loki","10b93cebe54af5b3af65308d5e0724e5aec2bb50","chaudum","2022-02-04 11:01:09","true","Simplify code for write path in distributor (#5248)

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",277,45,0,1,"2018-04-16 10:25:39","1383.77"
"grafana/loki","478510a1bbb73ca930622401e910138327aeae3d","MichelHollands","2023-05-25 10:18:03","true","Fix Grouping String function and usage so it prints ""without ()"" (#9515)

**What this PR does / why we need it**:

The changes rangemapper made to LogQL expressions created invalid LogQL.
It added a `without` clause instead of `without ()`. This PR changes the
String function of the Grouping struct. This is then used in the
rangemapper.

This caused the following panic:

```
panic: error cloning query: count without (rate({namespace=""apps""}[15s])): parse error at line 1, col 16: syntax error: unexpected RATE, expecting IDENTIFIER or )
```

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [x] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

---------

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",68,61,1,1,"2018-04-16 10:25:39","1865.24"
"grafana/loki","e156d3ba0c329ad8ef33d5f568ed211993fafee8","genebean","2019-07-05 13:45:56","false","Add selector as required by k8s 1.8 and higher. (#716)

Fixes #715",100,15,0,0,"2018-04-16 10:25:39","444.39"
"grafana/loki","86b4869f1aa02cfbf2c82dd48f2b83a253f5cbf4","jeschkies","2022-03-16 12:54:40","true","Remove benchmark cron job. (#5641)

Summary
- The benchmarks were not stable enough.
- They did not yield much value as we did not give much attention to
  them.",304,47,0,1,"2018-04-16 10:25:39","1425.85"
"grafana/loki","75a3e61a701e4c9314228d5631861c951037b352","pracucci","2019-08-20 15:37:05","false","Documented promtail known failure modes",114,16,0,0,"2018-04-16 10:25:39","489.47"
"grafana/loki","27ca58e79f18f98dea8f51352a939b976ca936a6","gouthamve","2019-04-25 06:11:11","true","Lazy load chunks (#435)

* Lazy load chunks for queries.

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>

* Add context to the lazy chunk calls

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>

* Make sure labels are plumbed through

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>

* Pre-load non-overlapping chunk iterators

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>

* Review feedback

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>",96,12,0,0,"2018-04-16 10:25:39","374.07"
"grafana/loki","87ddaa0982ed404585f2a52ef205c9e7aaeb4b62","periklis","2022-03-07 15:00:47","true","Fix service monitor's server name for operaror metrics (#5560)",302,47,0,1,"2018-04-16 10:25:39","1416.94"
"grafana/loki","0f881fbf7876ed53286c310866c51df3eff3c4e2","jgehrcke","2021-03-01 14:34:24","true","distributor: fix snappy pb POST request handling (#3407) (#3408)

Signed-off-by: Dr. Jan-Philip Gehrcke <jp@opstrace.com>",141,34,0,0,"2018-04-16 10:25:39","1045.67"
"grafana/loki","fbf17904f7b3c047fe69c07829e1411c6f2d36b0","cyriltovena","2020-11-18 08:40:50","true","Fixes iota unexpected behaviour with bytes for chunk encoding. (#2945)

* Fixes iota unexpected behaviour with bytes for chunk encoding.

This was introducing incompatibilities since iota with bytes starts at 2.
Seems like a weird conversion between iota int and byte.

This can currenlty corrupt chunks, and previous chunks are not decodable.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* With iota correclty this time.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>
(cherry picked from commit fa7ea9cc2d8bf5fa59c75b6a36236802c5650ac7)",122,31,0,1,"2018-04-16 10:25:39","942.43"
"grafana/loki","8f8cb80a117b92886f75e2eaa02d5defdc055b35","takanabe","2020-02-06 14:29:39","true","Fix rubocop violation for fluentd/fluent-plugin-loki (#1646)

* Don't use sudo to install bundler

Follow [the official installation docs](https://github.com/rubygems/bundler#installation-and-usage).

* Fix rubocop viloation: kind_of? -> is_a?

```
lib/fluent/plugin/out_loki.rb:76:21: C: Style/ClassCheck: Prefer
Object#is_a? over Object#kind_of?.
        unless @uri.kind_of?(URI::HTTP) or @uri.kind_of?(URI::HTTPS)
                    ^^^^^^^^
```

* Fix rubocop violation

```
lib/fluent/plugin/out_loki.rb:78:9: C: Layout/EmptyLineAfterGuardClause:
Add empty line after guard clause.
        end
```

* Fix rubocup violation: or -> ||

```
lib/fluent/plugin/out_loki.rb:76:38: C: Style/AndOr: Use || instead of
or.
        unless @uri.is_a?(URI::HTTP) or @uri.is_a?(URI::HTTPS)
                                     ^^
```

* Fix rubocop violation: use single quoate

```
lib/fluent/plugin/out_loki.rb:77:38: C: Style/StringLiterals: Prefer
single-quoted strings when you don't need string interpolation or
special symbols.
          raise Fluent::ConfigError, ""url parameter must be valid HTTP""
                                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
```

* Ignore rubocop violation: configure method is still not complex

Both rubocop and rspec fail with the current codes. Except for this
rubocop violation, they were fixed. this cyclomatic complexity violation
occurrs in configure method. However, it's still simple and the
implementation could be changed during spec fixation. So, this violation
should be ignored at this moment.

```
lib/fluent/plugin/out_loki.rb:72:7: C: Metrics/CyclomaticComplexity:
Cyclomatic complexity for configure is too high. [7/6]
      def configure(conf) ...
      ^^^^^^^^^^^^^^^^^^^
```",110,22,0,0,"2018-04-16 10:25:39","655.42"
"grafana/loki","1f676adf063869c6491f4b1e21eeac4c5cb3af1e","KMiller-Grafana","2022-07-14 21:00:20","true","Add API delete curl examples (#6680)

* Add API delete curl examples

* Update docs/sources/api/_index.md

Co-authored-by: Jennifer Villa <jvilla2013@gmail.com>

* Update docs/sources/api/_index.md

Co-authored-by: Jennifer Villa <jvilla2013@gmail.com>

* Update docs/sources/api/_index.md

Co-authored-by: Jennifer Villa <jvilla2013@gmail.com>

* Update docs/sources/api/_index.md

Co-authored-by: Jennifer Villa <jvilla2013@gmail.com>

Co-authored-by: Jennifer Villa <jvilla2013@gmail.com>",71,51,0,0,"2018-04-16 10:25:39","1549.44"
"grafana/loki","d155276cd1ae811f387c7220a70a6bad46a46752","yubozhao","2019-02-07 21:46:14","false","Roll s3/dynamo storage config doc into operation doc",78,10,0,0,"2018-04-16 10:25:39","291.47"
"grafana/loki","5ff0641c4e11d1e892980f4be56789510aa63774","MasslessParticle","2022-10-13 20:37:15","true","Bump tail dependency to address windows locking issues (#7417)

Tail PR: https://github.com/grafana/tail/pull/14",94,54,1,1,"2018-04-16 10:25:39","1638.42"
"grafana/loki","983ab80e7cc6b99de5cf2fb62c71f0c24d6d7328","MasslessParticle","2022-08-10 17:09:02","true","Add delete api validations (#6860)

* break out the middleware

* Add validation to the API

- Time must be in RFC3339 or a 10-digit-unix-seconds timestamp
- Start time must always exist

* lint

* docs

* improve tests

* cleanup

* cleanup

* access runtime config via function on validation",77,52,0,1,"2018-04-16 10:25:39","1575.28"
"grafana/loki","a60e0167a80a10ebceef18f63c2f3e7ff5777132","aknuds1","2023-08-21 12:04:59","true","Upgrade to latest dskit main (#10300)

**What this PR does / why we need it**:
Upgrade to latest dskit main branch, which mainly has changes to its
`log` package, which requires corresponding fixing up in Loki.",50,64,1,0,"2018-04-16 10:25:39","1951.32"
"grafana/loki","f4478490db461ef734f5848a63726557682a59f2","trevorwhitney","2022-08-10 15:01:50","true","Existing limits were low for large envs (#6846)

* Existing limits were low for large envs

* fix distributor libsonnet syntax",77,52,0,1,"2018-04-16 10:25:39","1575.19"
"grafana/loki","2c0afdfce36aebe45e107e843d507e67018d4488","blockloop","2021-03-12 15:51:24","true","working stack with promtail for testing",156,35,0,0,"2018-04-16 10:25:39","1056.73"
"grafana/loki","325c332f3e4d4e9fa7ade188c74481d5fcf73d27","shantanualsi","2023-08-29 13:38:39","true","Remove deprecated s3 sse toggle (#10377)

This PR removes a legacy and already deprecated boolean setting `-s3.sse-encryption` in favor of the more fine-grain `-s3.sse.*` settings.",48,64,1,0,"2018-04-16 10:25:39","1959.38"
"grafana/loki","a1e9e4cdd03ee5637994e48068344c80acb2e1fe","MasslessParticle","2022-12-02 23:05:56","true","Revert ""Make some stream shard metrics per-tenant (#7838)"" (#7842)

Because these metrics will be coming from each distributor, this is
going to have an adverse impact on cardinality. Consider doing this with
logging",94,55,1,1,"2018-04-16 10:25:39","1687.53"
"grafana/loki","aff1f7e5117481f59a4b6fb6964346b849fa7cd2","WhiteDiamondz","2023-05-12 21:18:04","true","Update troubleshooting.md (#9112)

**What this PR does / why we need it**:
Fixes a small sentence in the documentation to document Loki tracing.

**Which issue(s) this PR fixes**:
None

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [x] Tests updated
- [x] `CHANGELOG.md` updated
- [x] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",72,61,1,0,"2018-04-16 10:25:39","1852.7"
"grafana/loki","fe904c5aee28902a1d89487e919bcc3e9682961e","slim-bean","2023-01-26 23:58:41","true","Loki: add apache2 license to newly refactored push module (#8305)

Signed-off-by: Edward Welch <edward.welch@grafana.com>",83,57,1,1,"2018-04-16 10:25:39","1741.56"
"grafana/loki","8df5803d9a088995e2f8280bab951b3b31d80e28","adityacs","2023-01-12 21:56:01","true","feat(logql): Support drop labels in logql pipeline (#7975)

This PR introduces `drop` stage in logql pipeline. 

Fixes #7870, Fixes #7368",100,57,1,1,"2018-04-16 10:25:39","1727.48"
"grafana/loki","85e8f0095852fae38826f0324465dd0e0ca48a7d","owen-d","2022-09-16 12:54:38","true","fixes azure client secret duplicate CLI registration (#7185)

Fixes duplicate key registration from
https://github.com/grafana/loki/pull/7179/files#diff-665c7ce7ef736bdf9f9da76a8e389d5b6fcdc90099db913ce36b4c0da2a97ef2R121-R122",88,53,1,1,"2018-04-16 10:25:39","1611.1"
"grafana/loki","33244278142463671315033e6a8f7adf72ea5e4a","rgarcia6520","2022-09-07 10:40:39","true","Helm: Adding template-able image value for tokengen job container (#7075)

**What this PR does / why we need it**:
Currently the image for the `create-secret` container within the
tokengen job is not configurable, this adds a value to make the image
template-able.

**Which issue(s) this PR fixes**:
Fixes #7074

**Special notes for your reviewer**:

**Checklist**
- [ ] Documentation added
- [ ] Tests updated
- [ ] Is this an important fix or new feature? Add an entry in the
`CHANGELOG.md`.
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

Signed-off-by: garcia.ryan <garcia.ryan@solute.us>",83,53,1,0,"2018-04-16 10:25:39","1602.01"
"grafana/loki","4a219239134b7a4144439a57ec21a4841dee961a","cstyan","2022-08-26 17:53:48","true","update to alpine:3.6.2 (#6979)

Updates the alpine image version we use to 3.16.2 and will also build/publish a new loki build image

Signed-off-by: Callum Styan <callumstyan@gmail.com>

Signed-off-by: Callum Styan <callumstyan@gmail.com>",82,52,0,1,"2018-04-16 10:25:39","1591.31"
"grafana/loki","6b6521f791dec60b371009c1412d4dd8a2462eb7","ssncferreira","2022-04-29 14:55:37","true","Add metrics to range mapper (#6030)

* Refactor ShardingMetrics to MapperMetrics

* Add mapper metrics to range mapper",93,48,0,0,"2018-04-16 10:25:39","1474.19"
"grafana/loki","dac64c4d474093f7689adae4564f6e805973f2fb","periklis","2022-03-30 18:11:45","true","operator: Add missing label matcher for openshift logging tenant mode (#5729)",309,47,0,1,"2018-04-16 10:25:39","1440.07"
"grafana/loki","57a8a878c19f371db211989f0b9a40e07ba7a85c","cyriltovena","2022-01-05 09:19:07","true","Remove unnecessary ticker in the tail loop (#5039)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",252,45,0,1,"2018-04-16 10:25:39","1354.7"
"grafana/loki","9deffa71e97f162017766f3bc022a47874dc32ee","periklis","2021-12-16 16:12:49","false","Switch provider from Red Hat to Grafana Loki SIG operator",232,44,0,1,"2018-04-16 10:25:39","1335.99"
"grafana/loki","343e39f67baf5bf9b22f0b01936aae7864324d16","MasslessParticle","2022-11-28 21:46:21","true","Update Ingester Rate Calculations (#7652)

- Use weighted moving average for rates
- Keep Streams around until they are removed

Previously, the rate calculator only kept the most recent second. This
led to issues where bursty streams that didn't get pushes every second
resulted in undersharding those streams",98,55,1,1,"2018-04-16 10:25:39","1683.47"
"grafana/loki","0a654e23573db0acf7a4e4115c45516249a99641","MasslessParticle","2022-10-31 16:28:33","true","Ensure labels on sharded streams are sorted before they're sent anywhere (#7556)

Pushing streams with unsorted labels to ingesters results in a bug where
ingesters duplicate chunks for streams. This causes a memory leak and
eventual OOM crash when ingesters recover from the WAL because one of
the duplicate streams is orphaned.

This PR ensures that sharded streams have sorted labels to avoid this
bug.",89,54,1,1,"2018-04-16 10:25:39","1656.25"
"grafana/loki","cc2aeac860a6f00e17429550db89edc56ed5f0c1","JStickler","2023-07-20 18:43:45","true","Break up and move Best Practices topic. (#9912)

I realized that I should have moved the Best Practices topic as part of
#8711, since most of the content is best practices for using labels.
This PR:
* Splits the file into two parts (Best practices for labels and best
practices for configuration)
* Moves the two files to Get Started and Configure, respectively.
* Updates page weights for both sections as needed.",58,63,1,0,"2018-04-16 10:25:39","1920.6"
"grafana/loki","bc62e4b3411f5d1c29d27ba566bf4fe31af9e247","blockloop","2021-03-18 16:13:49","true","add hack/addons.yaml for promtail and logcli",164,35,0,0,"2018-04-16 10:25:39","1062.74"
"grafana/loki","3fc4873b08601cc0739a5c37af763b1168228bf3","daixiang0","2019-03-16 02:28:23","false","Support only deploy loki or promtail and fix helm lint issue

Signed-off-by: Xiang Dai <764524258@qq.com>",93,11,0,0,"2018-04-16 10:25:39","329.67"
"grafana/loki","e510889d157b6a1de4344139ec6020a78b37e7cb","daixiang0","2019-02-23 03:04:41","false","Update logcli doc

Signed-off-by: Xiang Dai <764524258@qq.com>",81,10,0,0,"2018-04-16 10:25:39","306.69"
"grafana/loki","54d644e6a85f3a2d8f14f60f6b7ace8374146b39","daixiang0","2019-03-08 02:29:27","false","Add link to logcli doc

Signed-off-by: Xiang Dai <764524258@qq.com>",87,11,0,0,"2018-04-16 10:25:39","321.67"
"grafana/loki","04ab08dc89c0523a0e7c515b6ef53700eccfcfe7","KMiller-Grafana","2021-10-05 22:30:40","true","Docs: remove empty section ""Generic placeholders"" (#4417)",137,42,0,0,"2018-04-16 10:25:39","1265.25"
"grafana/loki","6b377b40d5d2078c832bc7a9aaaab29fa2a99b88","liguozhong","2022-01-06 14:03:41","true","[new] promtail: add readline rate limit (#5031)

* [new] promtail: add readline rate limit

* [new] promtail: add readline rate limit #5031

* [new] promtail: add readline rate limit #5031

* [new] promtail: add readline rate limit #5031

* [new] promtail: add readline rate limit #5031

* Update clients/pkg/promtail/limit/config.go

Co-authored-by: Cyril Tovena <cyril.tovena@gmail.com>

* Update clients/pkg/promtail/limit/config.go

Co-authored-by: Cyril Tovena <cyril.tovena@gmail.com>

Co-authored-by: Cyril Tovena <cyril.tovena@gmail.com>",253,45,0,1,"2018-04-16 10:25:39","1355.9"
"grafana/loki","05ccf7dad21d3d52543695d7af802fc32a1a054d","MichelHollands","2023-01-11 23:39:01","true","Add dependabot.yml to ignore ieproxy dependency version (#7643)

**What this PR does / why we need it**:

Dependabot tries to update https://github.com/mattn/go-ieproxy to
v0.0.9. This doesn't work as it seems to redeclare a function, probably
due to missing build tags. This dependabot config file excludes this
version.

**Checklist**
- [ ] Reviewed the `CONTRIBUTING.md` guide
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",99,57,1,1,"2018-04-16 10:25:39","1726.55"
"grafana/loki","87e20d9399b2a33a89fac16700efafcd7eca4e44","dannykopping","2022-08-19 19:53:32","true","Setting sane defaults for ruler in SSD ""read"" mode (#6551)

Also removing support for configdb, since this is not supported but was the default storage type

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",82,52,0,1,"2018-04-16 10:25:39","1584.39"
"grafana/loki","76ceec45d9dbbae8012755d23285a11ed993d6c0","slim-bean","2020-07-17 15:30:52","true","If an entry is missing on the websocket, start checking after `wait` but continue checking until `max-wait` (#2369)

Refactored out a useful pruneList function",119,27,0,1,"2018-04-16 10:25:39","821.71"
"grafana/loki","41861bdacbb485ee7ccbd5b8a342c907de5fb324","j4rj4r","2022-09-15 15:12:49","true","Helm: Allows loki s3 http_config block to be configured (#7041)

**What this PR does / why we need it**:

This will allow users of the chart to configure the s3 http_config block
as documented here
[https://grafana.com/docs/loki/latest/configuration/#s3_storage_config](https://grafana.com/docs/loki/latest/configuration/#s3_storage_config)
through values.

**Which issue(s) this PR fixes**:
Fixes grafana/helm-charts#1762

**Checklist**
- [x] Documentation added
- [x] Tests updated
- [ ] Is this an important fix or new feature? Add an entry in the
`CHANGELOG.md`.
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

Signed-off-by: CAJNA Jarod <contact@jarodcajna.fr>",88,53,1,0,"2018-04-16 10:25:39","1610.2"
"grafana/loki","8df56cea6e3830a505d7f455894cd72c474f4c50","slim-bean","2020-02-26 21:34:27","false","Increasing the threshold for a file lag and reducing the severity to warning

Signed-off-by: Edward Welch <edward.welch@grafana.com>",118,22,0,1,"2018-04-16 10:25:39","675.71"
"grafana/loki","4716eea0db244948ea3e4596a240d681cd2602dc","jeschkies","2022-01-25 10:05:29","true","Provide Docker target and discovery in Promtail. (#4911)

**What this PR does / why we need it**:
This patch adds support to fetch Docker container logs through the Docker daemon API. This should be more robust than the Loki Docker driver or scraping the logs files.

The new Docker target will also collect meta information of the scraped containers.

**Which issue(s) this PR fixes**:
Addresses #2361
Closes #4703

**Special notes for your reviewer**:

**Checklist**
- [x] Documentation added
- [x] Tests updated
- [x] Add an entry in the `CHANGELOG.md` about the changes.",273,45,0,1,"2018-04-16 10:25:39","1374.74"
"grafana/loki","fa247353edef6daf25208bccf3e159f6a376cfbd","slim-bean","2021-05-17 14:59:37","true","Add a flag which allows the queriers to run completely standalone and only query stored data. (#3700)",195,37,0,1,"2018-04-16 10:25:39","1126.94"
"grafana/loki","1ea0512d609abc23482e866ce1f9814f8ce3d140","slim-bean","2020-02-25 18:30:03","false","I believe a full clone is required to allow the deploy step to work when running against a tag, else the tag name resolves improperly

Signed-off-by: Edward Welch <edward.welch@grafana.com>",117,22,0,1,"2018-04-16 10:25:39","674.59"
"grafana/loki","c994823369d65785e72c4247fd50c656801e429a","slim-bean","2019-03-26 20:04:46","false","Change hpcloud tailer library to poll mode to workaround bugs in the event driven code within the library
Had to rework tests with some waits for messages because polling is slower
There are several longer sleeps in the promtail_test which are not ideal and have been marked with FIXME to remove once we have a better solution",91,11,0,1,"2018-04-16 10:25:39","340.4"
"grafana/loki","da2c5dfc56790a9937655089438601efbb4048ed","jdbaldry","2023-02-06 15:24:46","true","Skip image validation (#8425)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>",81,58,1,0,"2018-04-16 10:25:39","1751.21"
"grafana/loki","3f3152427a7573687c28611b5b4a9f2eef3404a9","cyriltovena","2020-03-09 14:49:00","true","Update cortex vendoring to include frontend status code improvement. (#1746)

* Update cortex vendoring to include frontend status code improvement.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes signature changes in runtimeconfig.NewRuntimeConfigManager.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Forgot to git add . :facelpalm:

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",117,23,0,1,"2018-04-16 10:25:39","688.43"
"grafana/loki","dfd2e2090e9ef135fe08c57593d6a224bff03a56","cyriltovena","2020-11-09 14:07:59","true","Fixes metric query issue with no grouping. (#2902)

This would remove all labels for metrics queries that does not have grouping, instead of adding all labels.
It was introduced by https://github.com/grafana/loki/pull/2875

I added a regression test.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",120,31,0,1,"2018-04-16 10:25:39","933.65"
"grafana/loki","460bb5b8579b03065087a6f9bcc674f9ff622c61","adityacs","2020-02-14 16:03:16","true","Support entire extracted value map in template pipeline stage (#1666)

Refactor template stage processing.

This sets all extracted key available, plus if the source is available adds the extra key `Value` for
backward compatibility.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>
Signed-off-by: Aditya C S <aditya.gnu@gmail.com>

Co-authored-by: Cyril Tovena <cyril.tovena@gmail.com>",122,22,0,1,"2018-04-16 10:25:39","663.48"
"grafana/loki","fa4f936fcbbad1568209864c0756b249769caa63","cyriltovena","2019-05-06 22:31:31","false","improves memory usage of golangci-linter",98,13,0,1,"2018-04-16 10:25:39","385.75"
"grafana/loki","15b6235cae8d282afa71e8a0e9dec7d67de8299f","cyriltovena","2021-02-16 13:54:25","true","Fixes step encoding in logcli. (#3325)

Fixes #3318

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",132,34,0,1,"2018-04-16 10:25:39","1030.64"
"grafana/loki","028c12f624011b0693d8c7f74df39bc6a63ae5a4","rgarcia6520","2023-05-26 16:19:20","true","[Helm] configStorageType value support (#8526)

**What this PR does / why we need it**:
Adds `loki.configStorageType` & `loki.externalConfigSecretName` values
and associated helpers and templates to support choosing either
`ConfigMap` or `Secret` as config medium types.

**Which issue(s) this PR fixes**:
Fixes #8268 

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [ ] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

---------

Signed-off-by: garcia.ryan <garcia.ryan@solute.us>
Co-authored-by: Stefan Büringer <4662360+sbueringer@users.noreply.github.com>
Co-authored-by: Sandeep Sukhani <sandeep.d.sukhani@gmail.com>",68,61,1,0,"2018-04-16 10:25:39","1866.5"
"grafana/loki","b8866b2ff2896a2db7bb2a833b80faf32b570cb6","Dieterbe","2019-07-01 08:40:08","true","fix logcli code src path",95,14,0,0,"2018-04-16 10:25:39","440.18"
"grafana/loki","0832256d7bd7216422e65b4f97920a1781361689","poyzannur","2023-10-17 09:33:03","true","Add basic structure of bloom compactor (#10748)

This pull request adds the basic structure for the new bloom compactor component.

- Adds new `bloom-compactor` target that runs with with multiple instances joined by a ring
- Adds boilerplate functions to index blooms and compact blocks

The main goal of this PR is to provide a basic functionality on which future smaller PRs can build upon. Since the code path is completely separate in a new component, it is not used anywhere at the moment.",23,66,1,0,"2018-04-16 10:25:39","2007.21"
"grafana/loki","80fdece14512527101f066e94931a0512edd30a0","daixiang0","2019-04-26 13:32:38","false","Enable tracing loki in helm chart (#496)

* Enable tracing loki in helm chart

Tracing support from #328, need to support config in helm chart

Signed-off-by: Xiang Dai <764524258@qq.com>

* Use camel case for variables

Signed-off-by: Xiang Dai <764524258@qq.com>

* update condition

Signed-off-by: Xiang Dai <764524258@qq.com>",97,12,0,0,"2018-04-16 10:25:39","375.38"
"grafana/loki","faa1eab6201eedae76432209758e432385dcc6ea","dannykopping","2021-03-01 14:35:28","true","Remove default docker pipeline stage - this is undocumented and unexpected behaviour (#3404)

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",140,34,0,1,"2018-04-16 10:25:39","1045.67"
"grafana/loki","c5700e59a89aa71a2c16ae6502c6466cf58f4768","periklis","2021-04-15 13:24:53","true","Remove legacy manifests generation (#23)",162,36,0,1,"2018-04-16 10:25:39","1089.62"
"grafana/loki","99acb9b34553bbbaaab00b9a7a21126ece53380f","periklis","2023-03-24 05:01:23","true","operator: Provide community bundle for openshift community hub (#8881)",81,59,1,1,"2018-04-16 10:25:39","1798.77"
"grafana/loki","21556efa879891d36f4c0db40ae034b18fb98de6","james-callahan","2021-11-15 10:09:55","true","Promtail: improve GCP labels (#4628)

* Promtail: GCP resource label prefix is now '__gcp_resource_labels_'

* Promtail: turn GCP 'resource_type' into the internal label '__gcp_resource_type'

* Promtail: add internal label with logName

* Add upgrade notes for gcplog changes",194,43,0,0,"2018-04-16 10:25:39","1304.74"
"grafana/loki","dc222dc98de218dd7710fd27a89a9d84bf2b7d84","cyriltovena","2021-11-23 14:17:32","true","Improve case insensitive search to avoid allocations. (#4394)

* Improve case sensitive search to avoid allocations.

```
❯ benchcmp  before.txt after.txt
benchmark                                            old ns/op     new ns/op     delta
Benchmark_LineFilter/default_true_(?i)foo-16         2400          2233          -6.96%
Benchmark_LineFilter/simplified_true_(?i)foo-16      201           228           +13.13%
Benchmark_LineFilter/default_false_(?i)foo-16        2443          2376          -2.74%
Benchmark_LineFilter/simplified_false_(?i)foo-16     185           231           +24.96%

benchmark                                            old allocs     new allocs     delta
Benchmark_LineFilter/default_true_(?i)foo-16         0              0              +0.00%
Benchmark_LineFilter/simplified_true_(?i)foo-16      1              0              -100.00%
Benchmark_LineFilter/default_false_(?i)foo-16        0              0              +0.00%
Benchmark_LineFilter/simplified_false_(?i)foo-16     1              0              -100.00%

benchmark                                            old bytes     new bytes     delta
Benchmark_LineFilter/default_true_(?i)foo-16         0             0             +0.00%
Benchmark_LineFilter/simplified_true_(?i)foo-16      128           0             -100.00%
Benchmark_LineFilter/default_false_(?i)foo-16        0             0             +0.00%
Benchmark_LineFilter/simplified_false_(?i)foo-16     128           0             -100.00%
```

It's not much but for a billions line it makes a big difference.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* typo

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Simplified version

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Cleanup

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",211,43,0,1,"2018-04-16 10:25:39","1312.91"
"grafana/loki","13908540c040bac423adb6ef0b1e55013ee0cf92","daixiang0","2019-04-28 01:41:40","true","Merge branch 'master' into reduce-config-option",96,12,0,0,"2018-04-16 10:25:39","376.89"
"grafana/loki","7794e210d1939036f6fba322198923714c43aad5","daixiang0","2019-04-12 01:56:21","false","Update chart version

Signed-off-by: Xiang Dai <764524258@qq.com>",100,12,0,0,"2018-04-16 10:25:39","355.65"
"grafana/loki","de84737368914fa240108c0a3ef843eb5b5e4d3b","dannykopping","2023-03-31 08:36:34","true","Fix fetched chunk from store size in metric (#8971)

**What this PR does / why we need it**:
The `Size()` function on `chunk.Chunk` calls out to `func (ChunkRef)
Size() int` in the proto, which doesn't actually include the size of the
chunk data! We need to call `chunk.Data.Size()` for that.",82,59,1,1,"2018-04-16 10:25:39","1805.92"
"grafana/loki","61c02d78f2f54c00c6aa47943c4944dc7b0619a7","dannykopping","2023-01-24 12:56:37","true","Setting Julie Stickler as codeowner for docs (#8257)

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",83,57,1,1,"2018-04-16 10:25:39","1739.1"
"grafana/loki","db26fd3691ee4c5003efd947ddca0f04e6ccab45","tomwilkie","2019-02-06 19:53:04","false","Update comment.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",76,10,0,0,"2018-04-16 10:25:39","290.39"
"grafana/loki","c44fb2e88286b291fa92d809ecce724bc782d568","kavirajk","2022-11-24 14:59:41","true","chore(tools): Update promtail image version (#7770)

**What this PR does / why we need it**:
update promtail version on `tools/promtail.sh` which generates promtail
config for kubernetes

**Which issue(s) this PR fixes**:
Fixes #NA

**Special notes for your reviewer**:
This image is part of latest loki 2.7.0 release and[ it does exists
](https://hub.docker.com/layers/grafana/promtail/2.7.0/images/sha256-d54b599ea154df295486068f1545731bd5ab9790602d8518816c9285eec3df5e?context=repo)


**Checklist**",95,55,1,1,"2018-04-16 10:25:39","1679.19"
"grafana/loki","ab10bc69d70847a24778bb933bc246e2cf0a7e39","DylanGuedes","2021-10-11 06:57:04","true","Loki: Change how push API checks for contentType (#4443)

* Change how push API checks for contentType

- Currently, the ContentType is expected to be exactly
  ""application/json"". That's a problem because although a
""application/json; charset=utf-8"" is considered a valid JSON content
type, it will be seen as an error.

* Use mime.ParseMediaType to parse contentType.

- mime.ParseMediaType is more reliable than strings.Contains because if
  a wrong contentType (such as ""application/jsonnn"") is given, we still
accept it
- mime.ParseMediaType has support for contentType parameters. This way,
  valid contentTypes such as ""application/json; charset=utf-8"" will not
be rejected

* Add changelog entry.

* Change body in test to avoid lint issues.

- Without this change, the lint fails because gzipString would be called
  with always the same input. Full error:
```
`gzipString` - `source` always receives ``{""streams"": [{ ""stream"": {
""foo"": ""bar2"" }, ""values"": [ [ ""1570818238000000000"", ""fizzbuzz"" ] ]
}]}` (""{\""streams\"": [{ \""stream\"": { \""foo\"": \""bar2\"" }, \""values\"": [
[ ...)
` (unparam)
```",143,42,0,1,"2018-04-16 10:25:39","1270.61"
"grafana/loki","c9165fb768125f511412d4204eb4ccb7ca539b64","vlad-diachenko","2022-10-05 16:12:08","true","[loki helm chart] fixed to pass CI (#7345)

Bumped version of the chart and added changelog. 
These changes were missed in https://github.com/grafana/loki/pull/7301",93,54,1,0,"2018-04-16 10:25:39","1630.24"
"grafana/loki","e7fb2058276aec5cb9c8f77fb32fcba10f878e63","pracucci","2019-07-31 17:18:46","false","fix(logcli): timestamp timezone handling (#821)

Logcli used to inconsistently handle timezones in timestamps.

This addresses this by adding a new `--timezone` / `-z` flag, to explicitly set the timezone the timestamps shall be formatted in.

Furthermore it refactors the output framework inside of logcli to test it easier.

Fixes #798",105,15,0,0,"2018-04-16 10:25:39","470.54"
"grafana/loki","b5817127a53b1edebaeafaacb539e9098735bd33","czunker","2020-11-23 07:34:57","true","Remove `helm init` (#2967)

As helm v2 is EOF, I removed the commands only present in helm v2.

Fixes #2966

Signed-off-by: Christian Zunker <christian.zunker@codecentric.cloud>",112,31,0,0,"2018-04-16 10:25:39","947.38"
"grafana/loki","8e9635f41a4c32c79d5779b8d719473ea413542e","shantanualsi","2023-10-12 05:34:22","true","Support case insensetive logql keywords (#10733)

**What this PR does / why we need it**:
Adds support for case-insensetive logql queries that fixes #10638.

**Which issue(s) this PR fixes**:
https://github.com/grafana/loki/issues/10638

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",26,66,1,0,"2018-04-16 10:25:39","2002.05"
"grafana/loki","66a4692423582ed17cce9bd86b69d55663dc7721","irizzant","2022-04-21 07:26:06","true","fix: remove typo in gateway config (#5981)

Signed-off-by: irizzant <i.rizzante@gmail.com>",171,48,0,0,"2018-04-16 10:25:39","1465.88"
"grafana/loki","e0528b6f0019f2670b4c95a3332e0ee9c272498a","JordanRushing","2022-06-07 21:40:04","true","Add multi_kv_config block to overrides configmap when multi kv is enabled (#6323)

Signed-off-by: JordanRushing <rushing.jordan@gmail.com>",72,50,0,0,"2018-04-16 10:25:39","1512.47"
"grafana/loki","c29a6702c255815a7517ca48e3f0acba76835c67","dannykopping","2023-01-23 14:53:35","true","Match version flag using regex (#8241)",83,57,1,1,"2018-04-16 10:25:39","1738.19"
"grafana/loki","6c8d04fe781328be56dda9dced1362a218098925","dannykopping","2022-11-28 16:34:24","true","Completing step 2 of updating loki-build-image (#7796)",98,55,1,1,"2018-04-16 10:25:39","1683.26"
"grafana/loki","fcabfec470f2ea940c25994e05f7ec7e7f5be0ba","dannykopping","2021-01-07 13:07:10","true","Implementing line comments (#3126)

* Implementing line comments

Adding tests

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Appeasing the linter

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Further appeasement

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Adding tests to ensure that a # within a string is not incorrectly lexed as a comment

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Adding documentation

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",115,33,0,1,"2018-04-16 10:25:39","991.61"
"grafana/loki","cb8a7440d4539a23ab5137758190f729656a8829","JoaoBraveCoding","2023-03-21 15:36:48","true","ksonnet/loki: Add gRPC port to compactor mixin (#8855)

**What this PR does / why we need it**:

Problem: in https://github.com/grafana/loki/pull/7804 the possibility to use gRPC for communicating with the compactor for query time filtering of data requested for deletion was added, however, the Loki mixin still generates the compactor service without a gRPC port.

Solution: make the compactor service/deployment expose both an HTTP and gRPC port.

Signed-off-by: JoaoBraveCoding <jmarcal@redhat.com>",84,59,1,0,"2018-04-16 10:25:39","1796.22"
"grafana/loki","726b8cd6d4e09a4421c2053a7057143c37771360","owen-d","2020-03-31 17:20:11","true","support `match[]` encoding (#1875)",121,23,0,1,"2018-04-16 10:25:39","710.54"
"grafana/loki","5e020dbdba26031764f13375eeaaf1f50d609ba5","kavirajk","2021-06-28 14:59:32","true","Sync `main` branch docs to `next` folder (#3909)

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",109,38,0,1,"2018-04-16 10:25:39","1167.94"
"grafana/loki","45113cb3757367509d6bb930ce474b7c288d81bd","owen-d","2021-10-29 16:28:46","true","Enable unordered_writes by default (#4594)

* enable unordered_writes by default

* removes out_of_orders from transfer test

* update changelog",169,42,0,1,"2018-04-16 10:25:39","1289"
"grafana/loki","ee4ab1b3946f04922a0ea8941b07581c9ccf5935","chaudum","2022-05-12 06:25:05","true","Fix certain binary expression queries by optimizing through push down (#6132)

* Add test cases that fail

Instant queries of the following type fail and return an `unimplemented`
error:

```
sum(count_over_time({foo=""bar""} | logfmt | duration > 2s [3s]))
/
sum(count_over_time({foo=""bar""} [3s]))
```

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* Fix certain binary expressions for instant queries

If either the left hand side or the right hand side of a binary
expression is a noop, we need to return the original expression so the
whole expression is a noop as well, and thus not executed using the downstream
engine.
Otherwise, a binary expression that has a noop on either side, results
in an `unimplemented` error when executed using the downstream engine.

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* Optimize instant vector aggregations with log extraction stage

This change optimizes queries that use a vector aggregation without
grouping around a range aggregation with a label extraction stage such
as `json` or `logfmt`.

Since the vector aggregation can be pushed down to the downstream query,
the downstream query does not create a massive amount of streams, even
though it contains a generic label extraction stage.

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* fixup! Add test cases that fail

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* fixup! fixup! Add test cases that fail

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",76,49,0,1,"2018-04-16 10:25:39","1486.83"
"grafana/loki","d484d31856926b9694d6d2d162ade10de3de247c","MichelHollands","2023-07-27 14:52:43","true","Add support for cross arch for fluent-bit-plugin-loki image (#10081)

Copied from https://github.com/grafana/loki/pull/9991 which has problems
running CI.

**What this PR does / why we need it**:
Currently the `fluent-bit-plugin-loki` image is only build and published
for amd64. With more use of arm-based processors, it would be good to
add support for those as well.

I've build the image using `docker buildx` on my M1 Mac and pushed it to
Dockerhub, should you wish to try it first:
https://hub.docker.com/r/ebosveld/fluent-bit-plugin-loki/

On AWS ECS Graviton based images it works well with the above mentioned
image.

I've also fixed #9932 as it needed the full bullseye support.

**Which issue(s) this PR fixes**:
Fixes #6738
Fixes #9932

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

---------

Signed-off-by: Michel Hollands <michel.hollands@gmail.com>
Co-authored-by: Edwin Bosveld <edwin.bosveld@persgroep.net>
Co-authored-by: Travis Patterson <travis.patterson@grafana.com>
Co-authored-by: Edwin Bosveld <ebosveld@users.noreply.github.com>",52,63,1,1,"2018-04-16 10:25:39","1927.44"
"grafana/loki","03e4db46eb5005e664a38fc967eb7b3f88df2f3e","MichelHollands","2022-08-01 07:46:02","true","Fix log messages for deletion requests (#6727)

* Fix log messages for deletion requests

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Store deleted lines in log message instead of as a metric

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Fix linting issue

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Test for equal values

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Config for running with deletion mode

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Add back per user counter of deleted lines

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Revert example config changes

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Change test name

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",76,51,0,1,"2018-04-16 10:25:39","1565.89"
"grafana/loki","02316bccd24769aa2709c4e121abda43923983a1","xperimental","2022-07-06 04:28:22","true","operator: Update to operator-sdk 1.22.0 (#6581)",72,51,0,1,"2018-04-16 10:25:39","1540.75"
"grafana/loki","fa781e04880e7153f38638d15bd1c32d2e79e0de","DanCech","2022-11-07 09:50:22","true","Improve CRI format documentation (#7582)

The documentation doesn't mention the flags/tags component in a CRI log
line. I went with flags since that's the name it's given in our regex.",89,55,1,0,"2018-04-16 10:25:39","1661.98"
"grafana/loki","e4cbe502797a23f4c91b68c7c8167d04f4180aa2","owen-d","2023-01-18 17:12:11","true","support single & double hyphen arguments in version printing (#8199)

Small fix for an annoyance due special case parsing for the `version`
flag. Previously we looked for `-version`, now we use the the flag
library to support both `--version|-version`",84,57,1,1,"2018-04-16 10:25:39","1733.28"
"grafana/loki","285143d4330cce6818d5adad6be109b1487d493f","MichelHollands","2023-10-06 18:48:45","true","Force new build of build image (#10808)

**What this PR does / why we need it**:

Once more with a change to the dockerfile to force a new build of the
build image.

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

Signed-off-by: Michel Hollands <michel.hollands@gmail.com>",25,66,1,1,"2018-04-16 10:25:39","1996.6"
"grafana/loki","9e0941b4080d8cacc5288e041468663dbe0ef51b","MichelHollands","2022-03-04 10:24:02","true","Change usagestats expvars so they can be set twice (#5515)

* Change Edition so it can be set twice

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Change Target so it can be set twice

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Test Target can be set twice

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Mention Target can be set multiple times

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Add existence checks to other stats types and add tests

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Remove from target and edition

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",297,46,0,1,"2018-04-16 10:25:39","1413.75"
"grafana/loki","b27f7b946feefa23de028289182bf2211f1cd36a","rfratto","2019-09-03 15:25:58","true","Change label used to keep issues from being marked as stale to keepalive (#965)

The label used previously, important, implied precedence rather than
just a desire to keep an issue alive.",125,17,0,1,"2018-04-16 10:25:39","502.46"
"grafana/loki","00185f8bbb018bd58e9b37b75bca6b669cd39b0a","rfratto","2019-10-18 15:20:42","true","docs: add exmaple and documentation about using JMESPath literals (#1176)",68,18,0,1,"2018-04-16 10:25:39","547.45"
"grafana/loki","b07920cb16511ff1fa8ca89a413c464e9271f252","trevorwhitney","2021-10-07 22:06:50","true","auto-apply memberlist ring config when join_members provided (#4400)

* auto-apply memberlist ring config when join_members provided

Signed-off-by: Trevor Whitney <trevorjwhitney@gmail.com>

* move ""memberlist"" to a const

Signed-off-by: Trevor Whitney <trevorjwhitney@gmail.com>

* add comment for memberlist config auto-apply, update changelog

Signed-off-by: Trevor Whitney <trevorjwhitney@gmail.com>

* add docs

Signed-off-by: Trevor Whitney <trevorjwhitney@gmail.com>",138,42,0,1,"2018-04-16 10:25:39","1267.24"
"grafana/loki","04c7fbb531581b9ee4856a17394d5593243030c4","trevorwhitney","2022-11-10 23:30:11","true","Add config changes to upgrade guide (#7662)

**What this PR does / why we need it**:

This add config differences I noticed when running the config diff tool
between 2.6 and 2.7

Co-authored-by: JordanRushing <rushing.jordan@gmail.com>",83,55,1,1,"2018-04-16 10:25:39","1665.54"
"grafana/loki","c673380bb37007a3029f15f6bf5aa25771c075d0","slim-bean","2019-08-18 01:10:10","true","Updating changelog for v0.3.0 (#906)

* Updating changelog for v0.3.0

* Fixing consecutive list problem by putting an empty html comment between lists",106,16,0,1,"2018-04-16 10:25:39","486.86"
"grafana/loki","4eddcc1c8c16dccb437447b337f48c9b4e921f3a","slim-bean","2019-08-12 20:36:37","false","chore(packaging): avoid running containers from Dockerfile",103,16,0,1,"2018-04-16 10:25:39","481.67"
"grafana/loki","97e4a122cac011bb6153a199163faeb04b1b7daa","slim-bean","2019-05-06 15:54:51","false","adding a pipeline processing histogram",97,13,0,1,"2018-04-16 10:25:39","385.48"
"grafana/loki","b89a1f81dd7db5be4c08331e8da3174f09725dae","slim-bean","2020-04-23 20:47:56","true","Update cortex vendoring to latest master (#1975)

* Update cortex vendoring to latest master checksum `36496a074bc4530fb1d7c74136cab1566fbd9583`

Signed-off-by: Ed Welch <edward.welch@grafana.com>

* handle all the breaking changes from cortes

Signed-off-by: Sandeep Sukhani <sandeep.d.sukhani@gmail.com>

* rebasing on master, re-runing go mod vendor seemed to bring in some more changes...

Signed-off-by: Ed Welch <edward.welch@grafana.com>

Co-authored-by: Sandeep Sukhani <sandeep.d.sukhani@gmail.com>",115,24,0,1,"2018-04-16 10:25:39","737.93"
"grafana/loki","80693cae6f6064cb55c7f640a8483129f4e7d4a0","slim-bean","2020-08-10 20:38:21","true","Logcli: automatically batch requests (#2482)

* first stab at batching logcli requests

* fix other calls to printResult

* working batching code

* refactor the logcli Client into an interface so that it can be mocked for testing.

* fixing some bugs

* refactoring the output interface to make testing easier

* starting to add tests

* adding a bunch of tests
fixing up how the MockQuerier works.

* updating docs

* Update docs/sources/getting-started/logcli.md

Co-authored-by: Diana Payton <52059945+oddlittlebird@users.noreply.github.com>

* Update docs/sources/getting-started/logcli.md

Co-authored-by: Diana Payton <52059945+oddlittlebird@users.noreply.github.com>

* Update docs/sources/getting-started/logcli.md

Co-authored-by: Diana Payton <52059945+oddlittlebird@users.noreply.github.com>

* Update docs/sources/getting-started/logcli.md

Co-authored-by: Diana Payton <52059945+oddlittlebird@users.noreply.github.com>

* Update docs/sources/getting-started/logcli.md

Co-authored-by: Diana Payton <52059945+oddlittlebird@users.noreply.github.com>

* Update docs/sources/getting-started/logcli.md

Co-authored-by: Diana Payton <52059945+oddlittlebird@users.noreply.github.com>

* Update docs/sources/getting-started/logcli.md

Co-authored-by: Diana Payton <52059945+oddlittlebird@users.noreply.github.com>

* Update docs/sources/getting-started/logcli.md

Co-authored-by: Diana Payton <52059945+oddlittlebird@users.noreply.github.com>

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>
Co-authored-by: Diana Payton <52059945+oddlittlebird@users.noreply.github.com>",120,28,0,1,"2018-04-16 10:25:39","844.93"
"grafana/loki","9c6e509a6a656cd222b92461464f4e17cd2ecd5d","MasslessParticle","2023-03-08 15:53:34","true","Reimplement JsonExpressionParser in terms of jsonparser  (#8734)

This PR reimplements the functionality of `JSONExpressionParser` using
the `jsonparser` library rather than `jsoniter`

Benchmarks:
```
benchstat json_expression_old.txt json_expression_new.txt 
name                                    old time/op    new time/op    delta
JsonExpressionParser/json-expression-8    4.15µs ± 4%    0.82µs ± 3%  -80.17%  (p=0.000 n=10+10)

name                                    old alloc/op   new alloc/op   delta
JsonExpressionParser/json-expression-8    1.07kB ± 0%    0.02kB ± 0%  -97.76%  (p=0.000 n=10+10)

name                                    old allocs/op  new allocs/op  delta
JsonExpressionParser/json-expression-8      72.0 ± 0%       2.0 ± 0%  -97.22%  (p=0.000 n=10+10)
```",86,59,1,1,"2018-04-16 10:25:39","1783.23"
"grafana/loki","d602c1331a7b1877349fd37064ac19f36ef59989","MasslessParticle","2022-08-10 20:53:19","true","Clarify delete upgrade path (#6871)

* Clarify delete upgrade path

* more specificity",81,52,0,1,"2018-04-16 10:25:39","1575.44"
"grafana/loki","3ee8ed3b1d1d7b41563134589a4662b5f412d7ad","cstyan","2021-08-20 12:14:09","true","Allow for loki-canary to generate a percentage of out of order log lines (#4126)

* Allow for loki-canary to generate a percentage of log lines with out of
order timestamps, percentage and out of order time range is all
configurable.

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* Switch OoO min/max flags to time duration and properly calculate OoO
percentage check.

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* Change some variable names + add comments to make it more obvious what
various parts of the canary code are actually doing.

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* Update pkg/canary/writer/writer.go

* Add notes about usage of the out-of-order-percentage flag and the requirement to use pipeline stages.

Signed-off-by: Callum Styan <callumstyan@gmail.com>

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>",133,40,0,1,"2018-04-16 10:25:39","1219.83"
"grafana/loki","3ec0bd3756a98c368fc177dd76f24f311e69ce99","JordanRushing","2022-02-23 18:15:12","true","Update loki-mixin/dashboard-loki-operational queries to correctly display Loki metrics for Memcache and Consul (#5462)

Signed-off-by: Jordan Rushing <jordan.rushing@grafana.com>",301,46,0,0,"2018-04-16 10:25:39","1403.08"
"grafana/loki","38d803a512b19128c55d5ca3de00560f2f28c065","slim-bean","2019-10-30 13:29:36","false","for multi-arch docker images use the manifest to tag latest and master images (#1213)

for single arch images allow passing additional tags into the image-tag step and into .tags file",68,18,0,1,"2018-04-16 10:25:39","559.38"
"grafana/loki","0b84ef8868b74913d8beedc2eac91a3cbcedd99a","slim-bean","2020-11-24 15:55:43","true","Promtail: Update debian image and use a newer libsystemd  (#2957)

* use a newer libsystemd which understands compression needed in some of the newer OS distros

* add comments",114,31,0,1,"2018-04-16 10:25:39","948.73"
"grafana/loki","e28ffdafcb860c0d4a6e747a2684524e5d27fbca","slim-bean","2019-10-24 15:15:51","true","Updating Changelog for 0.4.0 (#1196)

* Updating Changelog for 0.4.0

* Fix Joe's name
Update release versions in docs

* adding a few last minute PR's",68,18,0,1,"2018-04-16 10:25:39","553.45"
"grafana/loki","26a4c53cbd1e172ce8441574f6f3fc32fd290ed1","slim-bean","2020-05-20 16:49:34","true","updating all the images to 1.5.0 release (#2100)

* updating all the images to 1.5.0 release

Signed-off-by: Ed Welch <edward.welch@grafana.com>

* duration must have a unit

Signed-off-by: Ed Welch <edward.welch@grafana.com>",116,25,0,1,"2018-04-16 10:25:39","764.77"
"grafana/loki","e71cb454cabe9fc1a109c487ed72317042590293","owen-d","2021-04-22 14:34:15","true","removes naming collision (#3641)",166,36,0,1,"2018-04-16 10:25:39","1101.92"
"grafana/loki","dab6a245414c18d85634778d6aeeb7c671b3a6f3","owen-d","2022-09-26 17:40:58","true","correct heartbeat timeout to distributor lifecycler for ring page (#7253)

Passes the correct `heartbeat_timeout` to the created lifecycler config
in distributor ring construction. When we didn't include this, it would
create a visual bug incorrectly marking many distributors as unhealthy
when in fact they were in fine condition. Including

The _lifecycler_ `heartbeat_timeout` is _only_ referenced in the status
page
[here](https://github.com/grafana/loki/blob/74c8cf03ba4fb2abd979a9af05bb945813a4505c/vendor/github.com/grafana/dskit/ring/lifecycler.go#L892-L894).
The _ring_ `heartbeat_timeout` continues to be updated correctly.",87,53,1,1,"2018-04-16 10:25:39","1621.3"
"grafana/loki","6bcd9807d686ffd74d1b738d3a2d9d5749b50878","kavirajk","2021-04-21 11:59:03","true","replace `time.Duration` -> `model.Duration` for `Limits`. (#3632)

Rationale
1. support user-friendly duration format (e.g: ""1h30m45s"") in JSON value.
2. In consistent with Cortex and tempo.",165,36,0,1,"2018-04-16 10:25:39","1100.81"
"grafana/loki","eb7dae4583b28ace35e5faa314738f7e011a7251","ivanahuckova","2023-06-07 15:32:36","true","Loki: Improve error message when step too low (#9641)

**What this PR does / why we need it**:

In https://github.com/grafana/grafana/pull/69648 we are in Grafana
introducing a step editor in Loki. Unfortunately, the error message when
user sets too low step parameter is hard to understand, so I am
proposing following change to make it more understandable and
actionable.

Let me know what do you think.

---------

Co-authored-by: J Stickler <julie.stickler@grafana.com>",68,62,1,0,"2018-04-16 10:25:39","1877.46"
"grafana/loki","303e3530cb869207264f4c56f762fed81ac8610e","kandrew5","2023-11-01 11:21:27","true","Helm: Allow topologySpreadConstraints (#11086)

**What this PR does / why we need it**:
Allow topologySpreadConstraints for read, write, backend and gateway
statefulsets/deployments.

**Which issue(s) this PR fixes**:
Fixes #11081 

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [ ] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [x] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)
- [x] If the change is deprecating or removing a configuration option,
update the `deprecated-config.yaml` and `deleted-config.yaml` files
respectively in the `tools/deprecated-config-checker` directory.
[Example
PR](https://github.com/grafana/loki/pull/10840/commits/0d4416a4b03739583349934b96f272fb4f685d15)

---------

Co-authored-by: Michel Hollands <42814411+MichelHollands@users.noreply.github.com>",16,66,1,0,"2018-04-16 10:25:39","2021.29"
"grafana/loki","b7057f51287ae8dfac33cef2c2487a8fd53f8866","trevorwhitney","2023-04-17 20:27:43","true","Fix comment in helm values.yaml (#9088)

**What this PR does / why we need it**:

Fix comment in the `values.yaml` and re-generate the reference docs.",83,60,1,1,"2018-04-16 10:25:39","1827.67"
"grafana/loki","d7e1813ff3c04884b5afd1a03db69cf8ba3d0155","tomwilkie","2018-04-16 19:32:19","false","Don't push build image.",0,0,0,0,"2018-04-16 10:25:39","0.38"
"grafana/loki","749894b1618b8659cde878480e01eab811a4cf36","ishanjain28","2023-08-30 06:39:21","true","bugfix/promtail.sh: Updated script to work better by default in k8s environment (#10390)

**What this PR does / why we need it**:

This PR fixes a bug in
[promtail.sh](https://github.com/grafana/loki/blob/94a5f94cf408e2da3e4293e8163e18c47c74e4d6/tools/promtail.sh).

promtail.sh is a script to deploy promtail in kubernetes clusters as a
daemonset. The defaults should make sense in that environment.

Currently, The default log parser in pipeline stages is, `- docker: `.
Kubernetes uses CRI format so it makes more sense to default to CRI
parser and this PR does exactly that.


This PR does not affect any existing users of loki and it'll improve it
for people who decide to use this script with the default arguments in
the future because kubernetes uses cri format and grafana can't parse
JSON logs properly if they were fed to loki with docker parser instead
of the more appropriate cri parser.",46,64,1,0,"2018-04-16 10:25:39","1960.09"
"grafana/loki","e3b25fb36c11f5c3ecdc9b81af38ddd79db912f1","chaudum","2023-08-23 15:48:30","true","Deprecate ruler setting with misleading name (#10322)

The setting defaults to `0s` and is not supposed to be changed, therefore it should be removed in a future version (e.g. 3.0) of Loki.

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",49,64,1,1,"2018-04-16 10:25:39","1953.47"
"grafana/loki","d1ae91cea72ba80de744f6ba315cfea525c6924f","rfratto","2020-02-05 14:52:37","true","ci: pin plugins/manifest image tag (#1637)",109,22,0,1,"2018-04-16 10:25:39","654.44"
"grafana/loki","c20c489cf6d29adfc6fa7d0165ad6f6660c9cd92","rfratto","2019-09-03 18:18:53","false","docs: add README.md to every folder",124,17,0,1,"2018-04-16 10:25:39","502.58"
"grafana/loki","132989031fd3dcdf0cc55670ad32391b7ff2295c","adityacs","2019-08-07 10:06:35","false","Fix Nolabels parse metrics",98,16,0,1,"2018-04-16 10:25:39","476.24"
"grafana/loki","a12311c5c8c37d3ff1096613fcc0aa91c7314a8d","trevorwhitney","2023-07-21 20:57:12","true","Allow volume to be aggregated by label (#9988)

Add a `aggregateBy` query parameter to the `series_volume` endpoint, and
rename that endpoint to just `volume`. This allows users to get volumes
aggregated into top level labels, rather label+value pairs.

---------

Co-authored-by: Travis Patterson <travis.patterson@grafana.com>",55,63,1,1,"2018-04-16 10:25:39","1921.69"
"grafana/loki","cfc4f0e84adc80570bbea4fc14b7104caee71f1e","itay-grudev","2023-10-17 17:26:54","true","Helm: Removed extra check preventing Grafana dashboards from getting created (#10902)

**What this PR does / why we need it**:

Fixes a bug in the Loki Helm chart that prevents Grafana dashboards from
getting created when external storage (`s3/gcs/azure`) isn't used or
when in `singleBinary` mode.

With this change dashboard creation is controlled solely by the
`.Values.monitoring.dashboards.enabled` flag.

**Which issue(s) this PR fixes**:
Fixes #10885

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [x] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

---------

Signed-off-by: Itay Grudev <itay.grudev@essentim.com>
Co-authored-by: J Stickler <julie.stickler@grafana.com>
Co-authored-by: Michel Hollands <42814411+MichelHollands@users.noreply.github.com>",22,66,1,0,"2018-04-16 10:25:39","2007.54"
"grafana/loki","06bcecfebe9b49c83a953f581951e28ab5d2dc1b","osg-grafana","2022-11-01 08:36:02","true","Remove CTA per @grafanawriter. (#7557)",89,54,1,0,"2018-04-16 10:25:39","1655.92"
"grafana/loki","5f50e0f04c021972e5bf911545eca02839772eab","Red-GV","2023-04-05 15:50:31","true","operator: Update Loki dependency to v2.8.0 (#9040)",82,59,1,1,"2018-04-16 10:25:39","1810.23"
"grafana/loki","c44c12b9304751744fb7c5005ee2f5277d78eed2","MichelHollands","2021-07-14 09:44:44","true","Update Cortex version (#3992)

* Update Cortex version

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Changed code due to new Cortex version

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Run go mod tidy

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",105,39,0,1,"2018-04-16 10:25:39","1183.72"
"grafana/loki","25f4dda811279382d96354d0e2522e90b01c9430","kavirajk","2022-12-02 10:12:53","true","fix(memcached): use `default` branch avoid writing to closed chan (#7833)

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

**What this PR does / why we need it**:
Follow up to https://github.com/grafana/loki/pull/7817

This PR uses `default` branch instead of `inputCh <- work` to make sure
we are writing to closed `inputCh`.

Gist is, `default` run [only when none of the branch is
ready](https://go.dev/tour/concurrency/6). which makes more sense rather
than to have `inputCh <- work` (writing to closed channel on the branch
condition)

These can be explained by these two tiny snippets.
* [with `default`](https://go.dev/play/p/-FspbTZd20I)
* [without `default`](https://go.dev/play/p/Ag4WznOaEq0)

**Which issue(s) this PR fixes**:
Fixes #NA

**Special notes for your reviewer**:
We already have test `TestMemcached_fetchKeysBatched` to catch this
behaviour. In fact this test caught this probabilistic behaviour in some
CI failures. [here ](https://drone.grafana.net/grafana/loki/17853/3/4)
and[ here](https://drone.grafana.net/grafana/loki/17854/3/4)

Thanks @DylanGuedes for catching this CI failures.

**Checklist**

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",92,55,1,1,"2018-04-16 10:25:39","1686.99"
"grafana/loki","1415a97296fff293d54d1320d6c061707421e936","trevorwhitney","2023-09-22 21:37:59","true","remove queryrange.VolumeRequest as it is not used (#10685)

This does not appear to be used anywhere, so removing it. I think we
only need the `VolumeResponse` wrapper here.",34,65,1,1,"2018-04-16 10:25:39","1982.72"
"grafana/loki","a3fde2365123de35c3559a2b8c914b9e8fdad7e4","rfratto","2019-09-25 20:56:44","true","docs: fix deprecated warning in api.md (#1063)",70,17,0,1,"2018-04-16 10:25:39","524.69"
"grafana/loki","812aecc795387432db653682ba67c37ffbf829ac","pracucci","2019-07-10 12:00:44","false","Added source support to regex and json stages",101,15,0,0,"2018-04-16 10:25:39","449.32"
"grafana/loki","361e7f7f8af36244a3c6fcd938eb56ad45b663d9","ashwanthgoli","2023-01-12 16:19:14","true","scheduler: fix panic on hitting /scheduler/ring when ring is disabled (#8120)

Fixes nil pointer dereference that occurs on calling `/scheduler/ring`
endpoint when `use_scheduler_ring` is set to false.

```
/usr/local/go/src/runtime/panic.go:884 +0x212
github.com/grafana/dskit/ring.(*Ring).ServeHTTP(...)
/src/enterprise-logs/vendor/github.com/grafana/dskit/ring/ring.go:858
github.com/grafana/loki/pkg/scheduler.(*Scheduler).ServeHTTP(0xc00056ba00?, {0x2ca0068?, 0xc001d95140?}, 0xc0005752a8?)
/src/enterprise-logs/vendor/github.com/grafana/loki/pkg/scheduler/scheduler.go:765 +0x25
```

Signed-off-by: Ashwanth Goli <iamashwanth@gmail.com>",100,57,1,0,"2018-04-16 10:25:39","1727.25"
"grafana/loki","dd96fa146c1fc0a7ef3327e495a1754c8bf9da0b","pstibrany","2019-12-06 14:30:32","false","pkg/ingester: check that ingester is in LEAVING state when transferring chunks and claiming tokens. Required when using memberlist client. (#1300)

* On chunks transfer, verify that source ingester is LEAVING

This is important when using gossiping ring. If source ingester is not
leaving yet, than claiming its tokens will fail (merge function
will not move ownership to the target ingester), and target ingester
will end up with no tokens in the ring.

* Register ring to prometheus.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Update check using latest version from Cortex.

There is no direct usage of logging, which is consistent
with the rest of this method.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Move import to group of imports with third-party packages.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>",93,20,0,0,"2018-04-16 10:25:39","595.42"
"grafana/loki","7592265c521ca923e03141d7e96248809a49c659","Red-GV","2021-05-05 16:01:23","true","Allowing controller to access secrets (#44)",183,37,0,1,"2018-04-16 10:25:39","1114.98"
"grafana/loki","005745d5445e026116b57a35df180bc7ca2890cf","whothey","2019-11-30 16:35:56","false","chore(packaging): add debug symbols to loki and promtail debug builds (#1342)

`-s` and `-w` build flags were removing the debug symbols from the binary, even on debug only builds, making debugging impossible",90,19,0,0,"2018-04-16 10:25:39","589.51"
"grafana/loki","1c8dd3e11afdcd4c90f99b954a6616fa3d1aa047","tomwilkie","2020-11-18 10:36:32","true","Add a few more instructions to logcli --help. (#2948)

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",122,31,0,0,"2018-04-16 10:25:39","942.51"
"grafana/loki","3e7adb2c34b0c798de7863965040a549039d316d","MasslessParticle","2022-10-11 14:41:19","true","Measure Per-Stream rates (#7370)

This PR implements the ability for ingesters to measure per-stream rates
at 1/s resolution.

It also fixes bugs in the kind of Limits used in the RateStore and the
Ingester API",91,54,1,1,"2018-04-16 10:25:39","1636.18"
"grafana/loki","7f298ff72f7fe1c9f6cf85baf5d4a6df0902b073","sandeepsukhani","2022-09-21 13:07:09","true","avoid using bloomfilters for chunks in stats calls by avoiding duplicates (#7209)

**What this PR does / why we need it**:
Avoid using bloomfilters for chunks deduplication in tsdb `Stats` calls
by avoiding fetching duplicate entries.
The idea is to split and align queries by
[ObjectStorageIndexRequiredPeriod](https://github.com/grafana/loki/blob/61794710a720da135d8479b7c2f723c740e86404/pkg/storage/config/schema_config.go#L47)
and make each split process chunks with a start time >= start time of
the table interval.
In other terms, table interval that contains start time of the chunk,
owns it.
For e.g. if the table interval is 10s, and we have chunks 5-7, 8-12,
11-13.
Query with range 6-15 would be split into 6-10, 10-15.
query1 would process chunks 5-7, 8-12 and query2 would process chunks
11-13.

This check is not applied for the first split so that we do not
eliminate any chunks that overlaps the original query intervals but
starts at the previous table.
For e.g. if the table interval is 10s, and we have chunks 5-7, 8-13,
14-13.
Query with range 11-12 should process chunk 8-13 even though its start
time <= start time of table we will query for index.

The caveat here is that we will overestimate the data we will be
processing if the index is not compacted yet since it could have
duplicate chunks when RF > 1. I think it is okay since the Stats call is
just an estimation and need not be accurate.

Removing all the extra processing saves us quite a bit of CPU and
memory, as seen from the benchmark comparison between the two
implementations:
```
name                  old time/op    new time/op    delta
IndexClient_Stats-10     187µs ± 0%      34µs ± 1%  -82.00%  (p=0.008 n=5+5)

name                  old alloc/op   new alloc/op   delta
IndexClient_Stats-10    61.5kB ± 4%    12.5kB ± 2%  -79.69%  (p=0.008 n=5+5)

name                  old allocs/op  new allocs/op  delta
IndexClient_Stats-10     1.46k ± 0%     0.48k ± 0%  -67.28%  (p=0.008 n=5+5)
```

**Checklist**
- [x] Tests updated",86,53,1,1,"2018-04-16 10:25:39","1616.11"
"grafana/loki","6145da1f3c7419b6e6065e3761c67cef59f5c3d6","gouthamve","2018-12-14 21:41:09","false","Add table manager and refer to master (#63)

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>",28,8,0,0,"2018-04-16 10:25:39","238.47"
"grafana/loki","92490a7865e908375e114136d7d17fc1ec4cd380","periklis","2023-08-02 11:31:25","true","operator: Drop OCP 4.10 & 4.11 support in community-openshift bundle (#10108)",52,63,1,1,"2018-04-16 10:25:39","1932.3"
"grafana/loki","89b8ae4b4981881aaf636d94de59d0f802c6656d","owen-d","2020-09-23 20:31:02","true","improves numeric literal stringer impl (#2663)",114,29,0,1,"2018-04-16 10:25:39","887.92"
"grafana/loki","363a85226e3d0c040fa872368fbeed430fe17d6b","owen-d","2023-04-06 23:31:23","true","makes test pass for 0 sharding factor (equivalent to no sharding) (#9065)

Saw validation tests failing due to this on `main`; not sure how this
hasn't borked our builds but this ensures we don't error on
shard-factors of zero (equivalent to not sharding). This doesn't
actually hit our code paths because we explicitly shortcut factor=0 in
the shardmapper.",85,60,1,1,"2018-04-16 10:25:39","1811.55"
"grafana/loki","2b66c6b12601ea58cef02e24f3aef3568b87d814","slim-bean","2023-01-05 17:32:45","true","Loki: add a 'since' query parameter for easier querying using relative time (#7964)

Signed-off-by: Edward Welch <edward.welch@grafana.com>

**What this PR does / why we need it**:

logcli has a command line parameter called `since` which makes it easy
to query logs relative to the current time, however this is some
syntactic sugar used in logcli to calculate `start` and `end` query
parameters for the query sent to Loki.

This PR adds native support for a `since` query parameter to make it a
little easier to consume the Loki query API without having to calculate
precise start/end times with every request.

This is useful if you are polling the Loki API from a third party app
which doesn't let you easily build dynamic URL's and all you want to do
is poll for say the last 3 hours of logs.

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the `CONTRIBUTING.md` guide
- [x] Documentation added
- [x] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

Signed-off-by: Edward Welch <edward.welch@grafana.com>
Co-authored-by: Owen Diehl <ow.diehl@gmail.com>",95,57,1,1,"2018-04-16 10:25:39","1720.3"
"grafana/loki","757b4e1417054d8a554d54765ad43b70ceaea0aa","bboreham","2022-03-04 10:45:26","true","Update grafana/regexp package to reject very deeply nested regexps (#5541)

This is a cherry-pick of https://github.com/golang/go/commit/ac071634c487eb6ac5422652de3c7c18fba7c522
with the following description:

regexp/syntax: reject very deeply nested regexps in Parse

The regexp code assumes it can recurse over the structure of
a regexp safely. Go's growable stacks make that reasonable
for all plausible regexps, but implausible ones can reach the
“infinite recursion?” stack limit.

This CL limits the depth of any parsed regexp to 1000.
That is, the depth of the parse tree is required to be ≤ 1000.
Regexps that require deeper parse trees will return ErrInternalError.",297,46,0,0,"2018-04-16 10:25:39","1413.76"
"grafana/loki","fed9f14970664ff3aadfaa21721149f333f37526","isimluk","2023-10-19 19:10:30","true","clients: update fluentd base container (#10966)

1.14.0 is over 2 years old and the latest 1.16 continues to work just
fine with loki

Co-authored-by: Vladyslav Diachenko <82767850+vlad-diachenko@users.noreply.github.com>",20,66,1,0,"2018-04-16 10:25:39","2009.61"
"grafana/loki","8ba5c6e135155f8289a312bc0c583db7f09afa3c","periklis","2023-01-09 13:34:56","true","operator: Use lokistack-gateway replicas from size table (#8068)

**What this PR does / why we need it**:
Fix using the replica count defined in the LokiStack size table for the
lokistack-gateway deployment instead of defaulting to a one replica.

**Which issue(s) this PR fixes**:
[LOG-3478](https://issues.redhat.com/browse/LOG-3478)

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the `CONTRIBUTING.md` guide
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",98,57,1,1,"2018-04-16 10:25:39","1724.13"
"grafana/loki","d7dd2e9f74f901215cec0e22a6b92291a8d64108","JoaoBraveCoding","2023-05-10 09:07:14","true","Moves all unit tests under operator/manifests to the manifests package (#9433)

Signed-off-by: Joao Marcal <jmarcal@redhat.com>",82,61,1,0,"2018-04-16 10:25:39","1850.2"
"grafana/loki","6c7a4dcdbd066953c63be049c0675a3d1e9a07e6","chaudum","2022-11-23 15:13:55","true","[loki-mixin] Make ""Success Rate"" panels in operational dashboard more accurate (#7756)",93,55,1,1,"2018-04-16 10:25:39","1678.2"
"grafana/loki","0f131fe8519500a784bf5e870c3882019a0db32c","marcusteixeira","2022-11-07 15:43:13","true","Docs: troubleshooting generation cache errors (#7600)

Adds troubleshooting to generation cache(gennumber) errors. Ref:
https://github.com/grafana/loki/pull/5661

Co-authored-by: Michel Hollands <42814411+MichelHollands@users.noreply.github.com>",88,55,1,0,"2018-04-16 10:25:39","1662.22"
"grafana/loki","b3c0670f3ad46ca262cede8d442097a1c8bb40e5","SadFaceSmith","2022-10-12 20:20:22","true","Create automated SBOM reports on Release (#7397)",91,54,1,0,"2018-04-16 10:25:39","1637.41"
"grafana/loki","18da26e668cfe9feed45fc141392662e49222c93","sandeepsukhani","2022-10-11 06:34:22","true","use a channel to signal completion of index read operation for tsdb and boltdb shipper (#7381)

**What this PR does / why we need it**:
In PR #7367, I was relying on cancellation of context to detect if the
index read operation has finished or not, but it is error prone since a
cancelled or timed-out query could cancel the context while we are still
reading the index. Since `tsdb` doesn't can't check the context for each
read operation, we could still panic in this scenario. I am adding a
channel where the consumer of the index would explicitly signal the
completion of the read operation to the `indexshipper`

**Checklist**
- [x] Tests updated",93,54,1,1,"2018-04-16 10:25:39","1635.84"
"grafana/loki","9d0fd3a7e3a498d7a8dbbb1b5b9720ced28b34da","simonswine","2022-04-13 09:10:43","true","Upgrade golang version to v1.17.9 (#5899)

```
git ls-files  '*[Dd]ockerfile*' | grep -v ^vendor/ | xargs sed -i ""s/golang:[0-9\\.]*/golang:1.17.9/g"" | ag 'golang:'
```",320,48,0,0,"2018-04-16 10:25:39","1452.7"
"grafana/loki","2c5ce2ce635b44bb29cb19067905ffc5bad915e3","sandeepsukhani","2021-06-22 08:44:05","true","feat: index-gateway for boltdb-shipper index store (#3865)

* feat: index-gateway for boltdb-shipper index store

* jsonnet for deploying index-gateway

* do not start a goroutine when query count is less than maxQueriesPerGoroutine

* changes suggested from PR review",103,38,0,1,"2018-04-16 10:25:39","1161.68"
"grafana/loki","ccb5cc0a9e165d2c4cb49e282da578cb8e12ca0b","3Xpl0it3r","2021-05-18 08:06:39","true","remove duplicated code (#3727)

* fix the promtail-default-config download link in doc

* remove duplicated code",198,37,0,0,"2018-04-16 10:25:39","1127.65"
"grafana/loki","27693841a438769be16417c554a5f584c78fd3a2","PabloCastellano","2020-10-15 17:27:58","true","fix: typo in upgrade.md (#2762)",114,30,0,0,"2018-04-16 10:25:39","909.79"
"grafana/loki","a0546a3bc33b0c6bf0a1b2eef1091b21cf6b2f82","nileshcs","2020-05-25 19:33:46","true","Documentation: Outdated fluentd image name, UID details, link update (#2112)

* documentation update: Fluentd docker image name, UID for docker image, and link to installing as container

* Reverted to fix the name of the Ruby gem while keeping name change for Docker image",121,25,0,0,"2018-04-16 10:25:39","769.88"
"grafana/loki","4d744f76b80c185f2b59960987482a8127042d9b","slim-bean","2020-04-06 20:41:07","true","Merge branch 'release-1.4.1'

# Conflicts:
#	CHANGELOG.md",114,24,0,1,"2018-04-16 10:25:39","715.68"
"grafana/loki","bc571c54c9c1ce7e6da755c438611e5679420991","sandeepsukhani","2019-04-10 15:23:17","false","Fix failing test `TestGlobWithMultipleFiles` in pkg/promtail/targets (#466)

TestClient used for watching log file events appends logs to a list
Due to race condition some of the logs added to it goes missing
Adding a Mutex to it to lock messages before adding logs to it",98,12,0,1,"2018-04-16 10:25:39","354.21"
"grafana/loki","2504492fed3c9fb47eff3a816a1d17e194701f04","gouthamve","2018-12-11 14:13:37","false","WIP: Persistence config (#61)

* WIP: Persistence config

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>

* properly update vendor.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",12,8,0,0,"2018-04-16 10:25:39","235.16"
"grafana/loki","db9dbe8e1da212d318a5949344fa7646d6d3b3b3","jesusvazquez","2022-06-15 16:16:23","true","Bump prometheus dependency (#6403)

* Bump prometheus dependency

We had to add a replace of prometheus in go mod because thanos is
importing an older version and then replacing it.

* Undo textparser.New variable mismatch

* modtimevfs path update

* Fix labels withlabels and withoutlabels usages

WithoutLabels and WithLabels methods have dissappeared. Now
labels.NewBuilder has to be used.

* Fix RuleManager interface for Update()

Update now accepts a new param called ruleGroupPostProcessFunc which is
an optional function to be executed after rule group processing.

In this case I've set it to nil in the usages i've found.

* NewQueryRange now accepts QueryOpts

The NewQueryRange function now accepts QueryOptions so I had to update
all the calls.

I've set the opts to nil since we're not using them.

* gofmt",68,50,0,0,"2018-04-16 10:25:39","1520.24"
"grafana/loki","8d7efddde244211777da401c75c719ff7e358d9f","cyriltovena","2019-05-06 12:38:13","true","switch to golangci-lint linter (#539)

* switch to golangci-lint linter

* fixes for review comments",98,13,0,1,"2018-04-16 10:25:39","385.34"
"grafana/loki","328ad2363454eb519f3fdede2b4958e84647d7ad","dgzlopes","2019-12-02 14:02:14","false","Fix duration format (#1343)

Signed-off-by: Daniel González Lopes <danielgonzalezlopes@gmail.com>",91,19,0,0,"2018-04-16 10:25:39","591.4"
"grafana/loki","0458dc8cbb30a4f81d6e435ddcdf8040558cbf47","liguozhong","2022-11-09 10:11:40","true","fix: Hide this error message when ctx timeout occurs in s3.getObject (#6360)

**What this PR does / why we need it**:
```
level=error ts=2022-01-24T10:57:05.273404635Z caller=batch.go:699 msg=""error fetching chunks"" err=""failed to get s3 object: context canceled""
level=error ts=2022-01-24T10:57:05.273434964Z caller=batch.go:699 msg=""error fetching chunks"" err=""failed to get s3 object: context canceled""
level=warn ts=2022-01-24T10:57:05.273457211Z caller=grpc_logging.go:55 method=/logproto.Querier/Query duration=16.524312361s err=""failed to get s3 object: RequestCanceled: request context canceled\ncaused by: context canceled"" msg=""gRPC\n""
level=error ts=2022-01-24T10:57:05.273486368Z caller=batch.go:699 msg=""error fetching chunks"" err=""failed to get s3 object: context canceled""
level=error ts=2022-01-24T10:57:05.273786914Z caller=batch.go:699 msg=""error fetching chunks"" err=""failed to get s3 object: RequestCanceled: request context canceled\ncaused by: context canceled""
level=error ts=2022-01-24T10:57:05.274246531Z caller=batch.go:699 msg=""error fetching chunks"" err=""failed to get s3 object: RequestCanceled: request context canceled\ncaused by: context canceled""
level=warn ts=2022-01-24T10:57:05.274385302Z caller=grpc_logging.go:55 method=/logproto.Querier/Query duration=29.542213769s err=""failed to get s3 object: RequestCanceled: request context canceled\ncaused by: context canceled"" msg=""gRPC\n""
```
When logql timeout, do not print these logs. Since we retry, we don't want to show intermittent timeouts, and we only care about the last error.

**Which issue(s) this PR fixes**:
Fixes [<5221>](https://github.com/grafana/loki/issues/5221)",84,55,1,1,"2018-04-16 10:25:39","1663.99"
"grafana/loki","fafa8d1e874848b390d1dad9c5a1fb7dfcaa7499","srstsavage","2022-01-19 09:28:03","true","Move VerifyConfig after PrintConfig and LogConfig (#5149)

Move VerifyConfig after PrintConfig and LogConfig so that config can be dumped and the program can exit instead of starting loki.",267,45,0,0,"2018-04-16 10:25:39","1368.71"
"grafana/loki","d0fd4e8ad132aa0e116471d3e6ff0f7d8b8450f8","dannykopping","2023-01-23 15:09:51","true","Do not exit when using `stream_lag_labels` setting (#8243)",83,57,1,1,"2018-04-16 10:25:39","1738.2"
"grafana/loki","7d2eeddfb8a6d99a124b57b109df3abb82a761c2","ashwanthgoli","2023-03-21 14:09:50","true","LogQL: Fix panic when using `unpack` with empty line (#8853)

**What this PR does / why we need it**:

Fixes panic in unpack parser when processing empty lines

```
    /src/enterprise-logs/vendor/github.com/grafana/loki/pkg/logql/log/parser.go:583
github.com/grafana/loki/pkg/logql/log.(*UnpackParser).unpack(...)
panic: runtime error: index out of range [0] with length 0
```

Signed-off-by: Ashwanth Goli <iamashwanth@gmail.com>",84,59,1,0,"2018-04-16 10:25:39","1796.16"
"grafana/loki","3c23ca6e18de6e3891305b9f3f1b18856af1b6ad","KMiller-Grafana","2021-06-28 08:07:42","true","Correct “ and ” with "" and same with single quote mark. (#3899)",111,38,0,0,"2018-04-16 10:25:39","1167.65"
"grafana/loki","fb26baa5b1bd58b33a34e9c946c81b253d7610bc","liguozhong","2022-10-11 07:34:04","true","[new feature] promtail: Add config reload endoint / signal to promtail (#7247)",93,54,1,1,"2018-04-16 10:25:39","1635.88"
"grafana/loki","88681a9974b4b2eb486200371aa47add0052c6a9","beornf","2020-01-10 13:16:07","false","Read websocket close in tail handler (#1383)

* Read websocket close in tail handler

* Send close message to websocket on quit signals",101,21,0,0,"2018-04-16 10:25:39","629.37"
"grafana/loki","ea0a5246cc1b3ea7e31006954a9218aec26f37ab","MasslessParticle","2022-06-03 15:20:57","true","Only consider an interval to have possible expired chunks if it overlaps a delete. (#6297)",72,50,0,1,"2018-04-16 10:25:39","1508.21"
"grafana/loki","5a08a6bcb9ecc816328cb7859bbdcc7cf9d004c5","MasslessParticle","2023-03-21 17:28:36","true","Label selector optimizations (#8763)

This PR introduces the following label selector optimizations:
- any selector that is `=~<literal>` is converted to an
`Equals/NotEquals` matcher
- Use the greedy->non-greedy regex improvements that exist in line and
label filters
- Never run `.*` label matchers.

Prometheus regex matchers anchor the match to the beginning and end of
the line. That means matchers of the form `=~<literal_value>` are just
testing equality.

Benchmarks -- this is just a quick bench to demonstrate equality
matchers are faster than their equivalent regex matchers:
```
BenchmarkMatcherTypes/regex-8           27694834                53.74 ns/op            0 B/op          0 allocs/op
BenchmarkMatcherTypes/equals-8          627045850                2.153 ns/op           0 B/op          0 allocs/op
```",84,59,1,1,"2018-04-16 10:25:39","1796.29"
"grafana/loki","56437fa0c44efae3727f05972ab1d7e54ef59f64","jeschkies","2023-10-12 08:51:03","true","Replace `LokiLabelNamesRequest` with `logproto.LabelRequest`. (#10801)

**What this PR does / why we need it**:
This is an attempt to unify our API models and use the definitions in
`logproto` which is helpful for #10688.

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",25,66,1,1,"2018-04-16 10:25:39","2002.18"
"grafana/loki","2162a0c1b1844b20aaecf2a2859dbb0c58c30936","slim-bean","2020-09-29 09:06:37","true","Do not mark the position if the file is removed, doing so only results in an error because you can't get the file size of a removed file. (#2658)",122,29,0,1,"2018-04-16 10:25:39","893.45"
"grafana/loki","da6a13383a5af518be84dc4cfd53b83ab6059904","slim-bean","2019-07-18 19:00:36","false","better job of fixing url parsing and host name extraction for logcli",102,15,0,1,"2018-04-16 10:25:39","457.61"
"grafana/loki","ac4a442291cceab54c4abd5962f4f57b66121b84","thampiotr","2023-05-22 15:34:00","true","Promtail: Fix goroutine leak in file tailer (#9495)

**What this PR does / why we need it**:

There's a goroutine leak in promtail file tailer, which has been
encountered in https://github.com/grafana/agent/issues/3885.

The issue is the following:
- There are two goroutines that tailer manages: one for reading lines,
the other for updating positions:
https://github.com/grafana/loki/blob/main/clients/pkg/promtail/targets/file/tailer.go#L103
- The tailer can be cleanly stopped & drained via `.Stop()`
https://github.com/grafana/loki/blob/main/clients/pkg/promtail/targets/file/tailer.go#L221
- But if the goroutine reading lines encounters an error from the
underlying `tail`, the tailer is stopped without draining using the
defer statement here:
https://github.com/grafana/loki/blob/main/clients/pkg/promtail/targets/file/tailer.go#L151
- The above defer statement does not shut down the position updating
goroutine and the `.Stop()` won't be called, so we end up with a leaked
goroutine.

**Which issue(s) this PR fixes**:
Fixes https://github.com/grafana/agent/issues/3885 

As can be seen in the [goroutine dump attached to the
issue](https://gist.github.com/amseager/e37f31984facd9cbc51ce0f2153d6864),
there were 933 update position goroutines, while we only had 21 files
being tailed.

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Tests updated
- [x] `CHANGELOG.md` updated",67,61,1,0,"2018-04-16 10:25:39","1862.46"
"grafana/loki","7f3db9d7f05ce859cd630cf279cd3b3d3cc23a6c","cyriltovena","2019-05-21 21:35:46","false","LogQL: Vector and Range Vector Aggregation.
- adds avg,min,max,top,bottomk,stddev,stdvar,count
- updates api documentation
- adds tests

Improve yacc & go lexer to understand duration
Remove support for regexp in all queries
Clean up querier and logselector",106,13,0,1,"2018-04-16 10:25:39","400.72"
"grafana/loki","33f70b70ce8e6059d76ef07cc70358141ab11c61","cyriltovena","2020-01-09 22:06:55","true","Add duplicates info and remove timing informations. (#1496)

* Add duplicates info and remove timing informations.

Timing information in the chunkenc iterator are too eating too much resources.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* lint

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",101,21,0,1,"2018-04-16 10:25:39","628.74"
"grafana/loki","eef4bd18bad4181cdc076b96892e3bc71e7b8ffa","blockloop","2021-03-19 22:04:25","true","CI: split coverage and lint and try to fix coverage (#4)",169,35,0,0,"2018-04-16 10:25:39","1063.99"
"grafana/loki","65a8268f5ffd301bdc87f57465e24b91b6c9ec11","blockloop","2021-04-27 17:53:40","true","LOG-1247: add node selectors support (#39)",175,36,0,0,"2018-04-16 10:25:39","1107.06"
"grafana/loki","b94a4361f2ac8fc9b0b3867c0fb9a5013882951a","pracucci","2019-10-10 13:00:47","false","promtail: initialize extracted map with initial labels (#1122)",68,18,0,0,"2018-04-16 10:25:39","539.36"
"grafana/loki","b835e2082addae321fc1bd2e1b79f17537d07007","joe-elliott","2019-10-08 20:37:29","false","Fix Loki Chunks Dashboard (#1126)

This commit cleans up the Loki Chunks dashboard either by renaming incorrectly 
named series or adding needed metrics.

Added new metrics:

  - loki_ingester_memory_chunks
  - loki_ingester_memory_streams 
  - loki_ingester_chunk_utilization
  - loki_ingester_chunk_compression_ratio

The following metrics were already being published with a different name. 
Fixed in the dashboard:

  - cortex_chunk_store_index_entries_per_chunk
  - cortex_ingester_flush_queue_length
  - loki_ingester_chunk_entries",70,18,0,0,"2018-04-16 10:25:39","537.67"
"grafana/loki","c0f96a34eb24ba6f22acfa9a0e5141f7df1f2081","acolombier","2023-09-07 15:45:02","true","Loki Helm: add sidecar to find loki rules in configmaps and secrets (#9399)

**Disclaimer: this work has been done by @Jeinhaus in the [legacy
repo](https://github.com/grafana/helm-charts/pull/1625), I have simply
migrated here and tested it in our own infrastructure**

--- 

**What this PR does / why we need it**:

This PR adds a sidecar to the loki chart that queries the Kubernetes API
to find Configmaps and/or Secrets that contain loki rules, similar to
the way the grafana chart does it for dashboards, plugins or sources.


**Special notes for your reviewer**:

**Checklist**
- [X] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [X] Documentation added
- [ ] ~Tests updated~
- [x] `CHANGELOG.md` updated
- [ ] ~Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`~

*`CHANGELOG.md` updated*: I have not update the CHANGELOG as I can see
that it hasn't been updated since the start of version 5. As this been
automated now? Or should I had the change logs somewhere else? Or
perhaps simply format my commit in a certain way so it gets generated?
Apologies if this was documented somewhere and I missed it.

---------

Co-authored-by: Julian Einhaus <julianeinhaus@gmx.de>
Co-authored-by: bwlkr <billynwalker@gmail.com>
Co-authored-by: Michel Hollands <42814411+MichelHollands@users.noreply.github.com>",43,65,1,0,"2018-04-16 10:25:39","1967.47"
"grafana/loki","8788ddb8d6bcc00aada2a8c4231bd04e2d890111","dannykopping","2021-06-17 14:48:44","true","Ruler: documentation for recording rules (#3851)

* Documenting recording rules

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Minor tweaks

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Apply suggestions from code review

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* Correcting text

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Update docs/sources/rules/_index.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>",101,38,0,1,"2018-04-16 10:25:39","1156.93"
"grafana/loki","0adad827a9928da5ccfb5c2c9e86e5a0eb9174bb","mattmendick","2020-01-28 22:36:46","true","Codecov circleci test [WIP] (#1600)

* Trying to get circle to run some tests/coverage

* Trying again

* Misspelling

* Adding codecov.yml

Adding codecov.yml with defaults, and adding in ignoring protobuf generated files

* Adding yacc generated files to codecov ignore

Adding yacc generated files to codecov ignore

* Newline?

Newline?",105,21,0,0,"2018-04-16 10:25:39","647.76"
"grafana/loki","179d741c5fec86d1f1e70de02a8d20dedc862a93","tpaschalis","2022-05-02 10:57:42","true","promtail: Add support for exclusion patterns in `static_config` (#5943)

* PR base

Signed-off-by: Paschalis Tsilias <paschalis.tsilias@grafana.com>

* Add CHANGELOG entry; updated documentation for new label

Signed-off-by: Paschalis Tsilias <paschalis.tsilias@grafana.com>

* Follow logic from t.path in exlusion case; always handle matching

Signed-off-by: Paschalis Tsilias <paschalis.tsilias@grafana.com>

* Make error message unique

Signed-off-by: Paschalis Tsilias <paschalis.tsilias@grafana.com>

* Only run if t.pathExclude is set

Signed-off-by: Paschalis Tsilias <paschalis.tsilias@grafana.com>

* Revert ""Only run if t.pathExclude is set""

This reverts commit 17abb006ce141071c4bca4b7d133bea2aa314594.",75,49,0,0,"2018-04-16 10:25:39","1477.02"
"grafana/loki","a15365202d159d38d3cf1bbe9be278ad61a08c45","thepalbi","2023-02-28 22:55:55","true","Optimize Promtail wal writer to batch both series and entries record (#8489)",70,58,1,0,"2018-04-16 10:25:39","1773.52"
"grafana/loki","985e965796c7c95c5c2999bc5a212313fc2a673a","chaudum","2022-01-17 13:50:19","true","Fix encoding error in fluentd client (#5163)

* Fix encoding error in fluentd client

This change fixes a bug that is caused by incorrectly trying to encode
any values other than string.
This bug was a regression introduced with #5107 and caused
`NoMethodError` errors.

Fixes #5099

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* Bump fluent-plugin-grafana-loki to version 1.2.18

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",266,45,0,1,"2018-04-16 10:25:39","1366.89"
"grafana/loki","f6f83fe5fde753d5bc21c77f5b415f72a1d7c628","owen-d","2020-08-27 15:46:55","true","Jsonnet/ruler (#2560)

* ruler jsonnet

* jsonnet fixes",123,28,0,1,"2018-04-16 10:25:39","861.72"
"grafana/loki","0c72c8ce7a66ccec2a0915aedf75597c413ef61b","chaudum","2022-04-20 03:09:19","true","Other: trigger build of loki-build-image:0.20.3 (#5924)

* Trigger build for Loki build image version 0.20.3

In commit 435391661f4e0f03eb378f77c07aaad5009cd6e9 the version was
increased from 0.20.2 to 0.20.3 in the `.drone/drone.jsonnet` file, but
not in the `.drone/drone.yml`, which caused the image not to be built.

In order to trigger the build of 0.20.3, contents of the
`loki-build-image/` folder need to change, therefore the comment in the
Dockerfile.

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* Update documentation how to build and use the loki-build-image

The existing documentation was not clear about the two-step process for
building and using the image. This PR tries to improve that.

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* fixup! Update documentation how to build and use the loki-build-image

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",174,48,0,1,"2018-04-16 10:25:39","1464.7"
"grafana/loki","e573a4d1a2d6f6ba627773cd8a24eacdd5a1b73e","chaudum","2021-12-02 14:52:18","true","Change error responses from plain text to JSON (#4845)

* Return HTTP errors consistently as JSON response

The API returned errors in plain text where the error message was the
response body. However, the content type header was set to
`application/json`.

To make the API responses consistent, errors are now returned as JSON as
well.

```
{
  ""message"": string,
  ""status"": string,
  ""code"": int
}
```

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* fixup! Return HTTP errors consistently as JSON response

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* Return 404 Not Found responses as JSON

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* fixup! Return 404 Not Found responses as JSON

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",213,43,0,1,"2018-04-16 10:25:39","1321.94"
"grafana/loki","3a0009b86c0f0d58129c274c086382ec89714249","kavirajk","2023-07-24 12:02:13","true","chore(loki): `dependabot` enhancements (#10025)

**What this PR does / why we need it**:
This introduces following changes
1. change open-pull-requests-limit from 2 -> 5 for root level go.mod
dependencies
2. Add dependabot also other go.mod files in `/operator`.
3. Add dependabot tracking for docker images under `/cmd/loki/`


**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:
NOTES:
1. [There is go.mod cleanup PR open
](https://github.com/grafana/loki/pull/10023) that make most some
internal tools to use just one `go.mod` at the root level.
2. Will add tracking to other docker images in other directories in
follow up PR

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",54,63,1,1,"2018-04-16 10:25:39","1924.32"
"grafana/loki","ac78129e664d95ce5b90bdebb8cd9f658da8a3b4","adityacs","2020-02-24 13:20:24","true","Fix nil pointer dereference in ingester client (#1730)",117,22,0,1,"2018-04-16 10:25:39","673.37"
"grafana/loki","2f46a3c96490a931c61c1a328f11f7048f70006e","Dieterbe","2019-07-01 08:54:33","true","Merge pull request #706 from grafana/Dieterbe-fix-logcli-src-path

fix logcli code src path",95,14,0,0,"2018-04-16 10:25:39","440.19"
"grafana/loki","521999c41951bcab61472ebbfa1e4f9adedc4a4b","etashsingh","2020-04-30 18:06:47","true","Change image tag from 1.4.1 to 1.4.0 in Helm chart (#2015)

* Change image tag from 1.4.1 to 1.4.0

Change image tag from 1.4.1 to 1.4.0 to make the chart work as the image with 1.4.1 runs into errors while deploying

* Update chart version value

* update loki stack chert version

* Changed image tag value from 1.4.1 to 1.4.0

* Update values.yaml

* Update Chart.yaml

* Update Chart.yaml

* Update Chart.yaml

* Update loki-stack chart version",120,24,0,0,"2018-04-16 10:25:39","744.82"
"grafana/loki","9ad98dfa7ccc3f1652e5087dbaf59bec0d09488d","cyriltovena","2020-07-29 01:00:02","true","Split label names queries in the frontend. (#2441)

* Split the Series API by 24h.

We currently split too much by using the same split duration for query range.
Let's start with 24h, just tested in ops-tools and it works better.
We could later introduce a config.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Split label name queries in the frontend.

Build on top of #2436 and adds the ability to split label names queries.
Those queries are heavy to run for long period and so splitting by day should improve query performance.

The frontend also support the old legacy label names API which has a different response.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",127,27,0,1,"2018-04-16 10:25:39","833.11"
"grafana/loki","be6664892fa6b485b300a5106cea43d65563a8ef","cyriltovena","2019-06-13 15:38:46","true","fix docker plugin ci (#664)

* fix docker plugin ci

* use binary cache",107,14,0,1,"2018-04-16 10:25:39","422.47"
"grafana/loki","f6ba37099bf8791e819881821e6c4309a27bd6cb","periklis","2022-07-05 16:05:00","true","operator: Add docs for object storage (#6561)",73,51,0,1,"2018-04-16 10:25:39","1540.24"
"grafana/loki","d08ceef16b8c52b4fdc4ff90fb4a7785eb4e1d02","cyriltovena","2020-06-08 17:40:31","true","Fixes iterators boundaries. (#2136)

The start should be inclusive and the end is supposed to be exclusive.
If start and end are equal, then only one entry can be returned which need to also be equal to start.

Fixes #2124

Those issues were edge cases where the boundaries of a block or iterator would be equal to the start.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",135,26,0,1,"2018-04-16 10:25:39","782.8"
"grafana/loki","1e1c2470b51a0deda62cdc86559afe2e3f20b6bd","afayngelerindbx","2022-08-25 03:49:49","true","compactor: prioritize newer tables when compacting. add operator flags to compac… (#6804)

* prioritize newer tables when compacting. add operator flags to compact time ranges of tables

Co-authored-by: Sandeep Sukhani <sandeep.d.sukhani@gmail.com>

* reroll doc and PR changes after rebase

Co-authored-by: Sandeep Sukhani <sandeep.d.sukhani@gmail.com>",82,52,0,0,"2018-04-16 10:25:39","1589.73"
"grafana/loki","ff57f7249cb4ced6bd231153d547dca62192d373","MichelHollands","2023-01-11 23:35:31","true","Fix json stage fields in example (#7654)

**What this PR does / why we need it**:
Fix the json section of a scrape config used in a unit test. The unit
test doesn't fail as the unmarshaling is very generic. The json stage is
unit tested in a different place.
This was mentioned as a comment on another PR:
https://github.com/grafana/loki/pull/7653.

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",99,57,1,1,"2018-04-16 10:25:39","1726.55"
"grafana/loki","6b5180535ff147e248fc2ade518e0185d6fd3100","ctrox","2019-09-05 15:20:43","false","Set default value for BatchWait as ticker does not accept 0",120,17,0,0,"2018-04-16 10:25:39","504.45"
"grafana/loki","06007c0ad188ae523d0944d2da00b9028e1f19f1","pstibrany","2019-12-17 07:42:42","false","Renamed LZ4 -> Lz4 to make lint happy.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>",94,20,0,0,"2018-04-16 10:25:39","606.14"
"grafana/loki","a1901e274a1e004d27dbfa05f8dfe5d35b2894b2","rfratto","2019-11-13 17:03:36","true","pkg/loki: unmarshal module name from YAML (#1260)

The module name field in the config could not be unmarshalled from a
string, causing parsing the config to crash.

This commit also changes the error message when the config could not be
parsed to print directly to stderr, as the logger won't be initialized
at the point where parsing the config fails, leading to no output in the
console.

Fixes #1259.",73,19,0,1,"2018-04-16 10:25:39","572.53"
"grafana/loki","9484632d3d749fa6394ba75762a2cb7d60e187a7","rfratto","2019-08-28 07:50:41","false","pkg/querier: fix concurrent access to querier tail clients (#944)",121,16,0,1,"2018-04-16 10:25:39","497.14"
"grafana/loki","1d3b0be15bb0a388c0249b7be49a77f4667f2c3d","rfratto","2019-11-13 14:56:27","true","helm: update default terminationGracePeriodSeconds to 4800 (#1257)

Users that run Loki using the Helm chart may not modify the value for
terminationGracePeriodSeconds that allows Loki enough time to flush all
of its data. If Loki is forcefully terminated by Kubernetes during a
flush, missing data or an unhealthy ingester in the ring in
microservices mode can occur.

This commit changes the grace period to 4800 seconds, the value used in
the Jsonnet code.",71,19,0,1,"2018-04-16 10:25:39","572.44"
"grafana/loki","0635172a9cc57f9aaba6c74660653b24e45a3025","tomwilkie","2018-05-29 19:06:17","false","Shutdown ingester properly.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",1,1,0,0,"2018-04-16 10:25:39","43.36"
"grafana/loki","fd0efe07997d12c046dd599b8f20e5c7499508c8","MasslessParticle","2023-05-31 16:46:06","true","Regex line/label filters return original regex when `String` is called (#9584)

To optimize regex line and label filters, Loki rewrites them to be
non-greedy. This can cause extra characters to appear in the regex when
`String()` is called. In addition to confusing logging, this can also
cause internal panics when a previously-parsable query becomes too long.

This PR stores the original regex in the label/line filter and uses that
in calls to `String`.

This PR also removes regex optimizations from label selectors. Making
the optimization at parse time caused the original regex to be lost.",69,61,1,1,"2018-04-16 10:25:39","1871.51"
"grafana/loki","d7b86ba9407558f458a5cbeed7462815478d3dab","ArkadiuszSpiewak","2022-09-07 14:38:13","true","Helm: Fix s3 region in ruler storage config (#7077)

**What this PR does / why we need it**:
Currently helm chart helper does not pass region or any other
information if s3 storage is configured. This causes issues with
connecting to S3 on AWS. This Pr fixes it, by passing all revelant
configs to ruler storage config.

**Which issue(s) this PR fixes**:
Fixes #7060

**Special notes for your reviewer**:

**Checklist**
- [ ] Documentation added
- [ ] Tests updated
- [ ] Is this an important fix or new feature? Add an entry in the
`CHANGELOG.md`.
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",86,53,1,0,"2018-04-16 10:25:39","1602.18"
"grafana/loki","c1bccac1418ff8abc1b0ad8136c113a9b095cd31","MasslessParticle","2022-10-17 22:24:23","true","Results cache fix improvements (#7444)

Move middleware to someplace more sensible and incorporate feedback
missed in the review for this.",89,54,1,1,"2018-04-16 10:25:39","1642.5"
"grafana/loki","a92e048ec31148fa709e85dfd700f4cf5f58b8b0","MasslessParticle","2022-07-06 15:25:43","true","avoid making delete requests if deletes are disabled for a user (#6583)",72,51,0,1,"2018-04-16 10:25:39","1541.21"
"grafana/loki","e6e8cbfa13e56bf6cf6f451bd6d9b9e79260ebbd","KMiller-Grafana","2021-10-05 16:42:05","true","Docs: introduce a fundamentals section (#4403)",136,42,0,0,"2018-04-16 10:25:39","1265.01"
"grafana/loki","d6d7de4edcab6c3119750d1cf2423ee3fbc88e13","MichelHollands","2022-03-02 11:49:44","true","Remove extra param in call for inflightRequests metric (#5507)

* Remove extra param

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Add CHANGELOG.md entry

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Remove periods at end of line for older CHANGELOG.md entries

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",298,46,0,1,"2018-04-16 10:25:39","1411.81"
"grafana/loki","e61f8dccdd3c8a834a39c094901e751da485a305","xperimental","2022-05-30 17:52:52","true","operator: Document how to connect Grafana to gateway (#6250)",73,49,0,1,"2018-04-16 10:25:39","1505.31"
"grafana/loki","68562090938d6bb5b92b19e5c4ea55eea86e978e","kavirajk","2021-01-26 14:12:56","true","Terraform script to automate GCP provisioning for gcplog (#3206)

* Terraform script to automate GCP provisioning for gcplog

* PR remarks",121,33,0,1,"2018-04-16 10:25:39","1010.66"
"grafana/loki","8a9b94a8bc8b0ec6d9fd8a408b9d6d7e62b7a04f","owen-d","2021-02-11 19:54:41","true","removes recover flag (#3326)",128,34,0,1,"2018-04-16 10:25:39","1025.9"
"grafana/loki","001a627f67a3a11dfd9b36e3c442c6ae25d4bc42","owen-d","2022-08-09 03:16:23","true","fix context propagation for child spans in shard resolver (#6853)

Signed-off-by: Owen Diehl <ow.diehl@gmail.com>",75,52,0,1,"2018-04-16 10:25:39","1573.7"
"grafana/loki","05b2a2a892a21248c62dfd35168daa77ea15f2f1","grafanabot","2023-09-06 15:33:25","true","[CI/CD] Update yaml file `./production/helm/loki/Chart.yaml` (+1 other) (#10479)

**Here is a summary of the updates contained in this PR:**
***
Update attribute `$.appVersion` in yaml file
`./production/helm/loki/Chart.yaml` to the following value: `2.9.0`
***
Bump version of Helm Chart
Add changelog entry to `./production/helm/loki/CHANGELOG.md`
Re-generate docs

---------

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>
Co-authored-by: Kaviraj Kanagaraj <kavirajkanagaraj@gmail.com>",46,65,1,0,"2018-04-16 10:25:39","1966.46"
"grafana/loki","3839522eb7c590805649f35c9d973987848736be","MichelHollands","2022-08-25 09:50:12","true","Add deletion metrics to the documentation (#6971)

* Add deletion metrics

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Fix metric types for some entries

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Add missing dot at end of line

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",82,52,0,1,"2018-04-16 10:25:39","1589.98"
"grafana/loki","93c35a7a13b39942cc6e77574d39f289345b7005","xperimental","2023-02-23 06:20:54","true","operator: Refactor status update to reduce API calls (#8578)",64,58,1,1,"2018-04-16 10:25:39","1767.83"
"grafana/loki","7be9deacf35524ea11844ba6f8b1a930ea689b10","MichelHollands","2023-07-12 08:44:13","true","Update go version to 1.20.6 (#9913)

Update the go version. Another PR will follow that uses the new build
image

---------

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",58,63,1,1,"2018-04-16 10:25:39","1912.18"
"grafana/loki","01481cca0cc16c4b745a59ab74116d5fc7025f5b","kavirajk","2022-06-13 13:44:49","true","Promtail: Support all `cri-o` tags (multiline tags). (#6177)

* Promtail: Support `cri-o` tags.

Hacked something together that works during flight to Grafanafest.

* Fix newCri test cases

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Add test for real ""panic"" stacktrace

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Add bounded size for partial lines slice

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Leave the promtail config alone

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* PR remarks

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* PR remarks: Avoid discarding lines when partial lines reaches upper bound.

Instead merge into single full line and print warning.

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",68,50,0,1,"2018-04-16 10:25:39","1518.14"
"grafana/loki","abb70456e6c17c2c0fdd27d506de760e2f689a73","wtchangdm","2023-06-05 07:58:55","true","Fix comment and indentation in gateway config of SSD helm chart (#9622)

**What this PR does / why we need it**:
The gateway config (nginx config file) incorrectly states 10 minutes (as
in 600 seconds) as 6 minutes.
This small PR corrects that.

**Which issue(s) this PR fixes**:
N/A

**Special notes for your reviewer**:
Although this indeed modifies the chart, I don't think it's worth a
version bump. Please let me know if you have other ideas.

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",69,62,1,0,"2018-04-16 10:25:39","1875.15"
"grafana/loki","f4e2cf19935cf67fd9d6a7de22824fd1ae122373","owen-d","2022-10-07 15:58:00","true","TSDB explicit fingerprint (#7362)

This PR does two things:
* Includes the series fingerprint in TSDB WALs. Doing this ensures we
recover fingerprint used in chunk addresses after restart even if loki
is upgraded and the label hashing algorithm changes.
* Removes much of the extra hashing in the TSDB write path + manager.
Occasionally, the fingerprint may be different than the hash of labels.
Historically this has happened in a few places:
* When the `__name__=""logs""` label was injected for non-tsdb indices
(not applicable to TSDB)
* When building a multitenant tsdb index and adding a synthetic
`__loki_tenant__` label
* In a previous bug(https://github.com/grafana/loki/pull/7355) when
empty label values altered calculated fingerprints.

Explicitly storing/retrieving the desired fingerprint throughout helps
avoid calculating it in error.",94,54,1,1,"2018-04-16 10:25:39","1632.23"
"grafana/loki","dee6a56df11042f82ae6243dd8412406bce72246","owen-d","2022-03-08 20:40:18","true","Tsdb/index interface (#5577)

* begins speccing out index ifc, impl

* block level labelnames/values

* single file index test + bugfix

* goimports

* LabelNames and LabelValues support matchers

* s/Interface/Index/",303,47,0,1,"2018-04-16 10:25:39","1418.18"
"grafana/loki","27411cff087e6fa2c660c6bfa577c31945ab5232","chaudum","2023-10-20 13:27:55","true","Introduce worker queue in bloom gateway (#10976)

Instead of calling the bloom store directly on each and every request to filter chunk refs based on the given filters, we want to queue requests in per-tenant queues and process batches of requests that can be multiplexed to avoid excessive seeking in the bloom block queriers when checking chunk matches.

This PR re-uses the request queue implementation used in the query scheduler. To do so, it moves the queue related code from the scheduler into a separate package `pkg/queue` and renames occurrences of ""querier"" to ""consumer"" to be more generic.

The bloom gateway instantiates the request queue when starting the service. The gRPC method `FilterChunkRefs` then enqueues incoming requests to that queue.

**Special notes for your reviewer**:

For testing purposes, this PR also contains a dummy implementation of the workers. The worker implementation - which includes multiplexing of multiple tasks - is subject to a separate PR.

---------

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",22,66,1,1,"2018-04-16 10:25:39","2010.38"
"grafana/loki","25d266e1f43a7d1ed0b7e526b874a109662bc412","chaudum","2023-02-23 07:50:18","true","Clean up CHANGELOG (#8595)

Keep the changelog clean so it's easier for the release shepherd to compile the changelog and release notes for the next release.

* Add newline underneath section heading
* Move promtail related changelog entries into promtail section
* Remove changelog entry from already released enhancement
* Move changelog entry into correct position",64,58,1,1,"2018-04-16 10:25:39","1767.89"
"grafana/loki","3f9d067e079998d7beb6bc7871aa32a10e725bd3","trevorwhitney","2021-11-04 16:14:31","true","compactor depends on memberlist for memberlist ring option (#4643)",171,43,0,1,"2018-04-16 10:25:39","1293.99"
"grafana/loki","cc3a8e44158b43728caa5779719c1f8764d26bfe","slim-bean","2022-04-07 21:19:59","true","try fixing drone again (#5826)

Signed-off-by: Ed Welch <edward.welch@grafana.com>",320,48,0,1,"2018-04-16 10:25:39","1447.2"
"grafana/loki","28c0b310c75b1de44f0489199af604f6a48b9d48","cyriltovena","2021-01-15 17:48:06","true","Logs PushRequest data. (#3178)

* Logs PushRequest data.

This will allows to find information about received size and total entries per tenant.

Example of a log from my dev testing:

```
level=debug ts=2021-01-15T11:16:21.735663076Z caller=http.go:67 org_id=3927 traceID=11c4774c6ec4bbf4 msg=""push request parsed"" path=/loki/api/v1/push content-type=application/x-protobuf body-size=""11 kB"" streams=5 entries=298 streamLabelsSize=""1.9 kB"" entriesSize=""45 kB"" totalSize=""47 kB""
```

Of course this means we can use LogQL on this.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Move metrics to avoid request traversal twice.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes tests.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",119,33,0,1,"2018-04-16 10:25:39","999.81"
"grafana/loki","15af77ba83705b35e67f2aa6031402d78258475f","salvacorts","2023-07-17 06:43:28","true","Remove Prometheus dependency for push pkg (#9937)

**What this PR does / why we need it**:

In https://github.com/grafana/loki/pull/9694, we modified the `push` pkg
to import Prometheus as a dependency to use the `labels.Labels` type for
the entries' non-indexed labels.

Having Prometheus as a dependency is problematic since any project
importing the `push` pkg will need to import Prometheus as a result. In
fact, this is one of the reasons why the `push` pkg was extracted from
Loki in the first place (https://github.com/grafana/loki/pull/8259).

This PR removes the dependency of Prometheus from the `push` pkg by
copying some bits of the implementation for Prometheus' `labels.Labels`.
We copy:
- The Labels struct definition
- The JSON Marshaling and Unmarshaling methods for the labels. We need
this so labels are encoded as maps instead of an array of objects.

---

**Notes for reviewers:**

- To implement the JSON Marshaling and Unmarshaling methods the `push`
pkg now depends on `golang.org/x/exp`. I think it should be fine for
projects importing the `push` pkg to also depend on `golang.org/x/exp`,
right?",59,63,1,1,"2018-04-16 10:25:39","1917.1"
"grafana/loki","ea78cde65967ca97b1507f0db9ba48789fc14d2c","cstyan","2021-10-25 16:02:05","true","Add drone build job for lambda-promtail images. (#4480)

* Add drone build job for lambda-promtail images.

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* Fix image tag portion of drone job for lambda-promtail build

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* Address some review feedback.

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* Regenerate drone yaml file after some changes.

Signed-off-by: Callum Styan <callumstyan@gmail.com>",165,42,0,1,"2018-04-16 10:25:39","1284.98"
"grafana/loki","d338732f01c1c4339c2ca7bcfda714e8ea7b1240","daixiang0","2019-05-27 03:37:30","true","Merge branch 'master' into reduce-config-option",108,13,0,0,"2018-04-16 10:25:39","405.97"
"grafana/loki","b23bd48c54f6be55ead79b326e938e0168ff457e","daniellee","2018-12-11 18:34:38","false","adds Grafana provisioning example to the readme

Signed-off-by: Daniel Lee <dan.limerick@gmail.com>",12,8,0,0,"2018-04-16 10:25:39","235.34"
"grafana/loki","527caa9f7abe2c1c4529b1a994fc45abdd75710b","slim-bean","2019-09-09 21:58:43","false","looks like we also need bash for the deploy step",118,17,0,1,"2018-04-16 10:25:39","508.73"
"grafana/loki","54320f27e3a046fa6e952c26174a37b9d31fd080","steve-caron-grafana","2023-10-26 16:31:40","true","Update _index.md (#11052)

Changed the title from ""Prometheus pipeline stages"" to ""Promtail
pipeline stages""

**What this PR does / why we need it**:

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)
- [ ] If the change is deprecating or removing a configuration option,
update the `deprecated-config.yaml` and `deleted-config.yaml` files
respectively in the `tools/deprecated-config-checker` directory. <!--
TODO(salvacorts): Add example PR -->

---------

Co-authored-by: J Stickler <julie.stickler@grafana.com>",19,66,1,0,"2018-04-16 10:25:39","2016.5"
"grafana/loki","a5ddbf2e1f8b8781ea17bf89c7f2efda3cde19b2","jeschkies","2023-02-07 17:27:16","true","Correct sizing tool unit in help text. (#8441)",79,58,1,1,"2018-04-16 10:25:39","1752.29"
"grafana/loki","a7ea9c142233808c07b7157b8ac95442bf4a4bb2","owen-d","2023-01-18 19:01:32","false","Revert ""fix(logql): remove __error_details__ label on drop __error__ or other way around"" (#8200)

Reverts grafana/loki#8150

I was talking with @adityacs about reverting this PR and found the
following:

Looking at why tests don’t keep `__error_details__` when `__error__` is
dropped and I found this line of code:
```go
// LabelsResult returns the LabelsResult from the builder.
// No grouping is applied and the cache is used when possible.
func (b *LabelsBuilder) LabelsResult() LabelsResult {
	// unchanged path.
	if len(b.del) == 0 && len(b.add) == 0 && b.err == """" {
		return b.currentResult
	}
	return b.toResult(b.labels())
}```

https://github.com/grafana/loki/blob/main/pkg/logql/log/labels.go#L314
We only add err details when err isn’t empty anyway, so I guess we’ll revert for simplicity but just keep the same functionality",84,57,1,1,"2018-04-16 10:25:39","1733.36"
"grafana/loki","399eb097fd8b99359de1c96c7e79137755d20a7a","cstyan","2023-01-18 21:13:30","true","Remove the stream lag metric. (#6324)

Removes the stream lag metric since it's not possible to get a correct
value and also not cause issues with metrics registration or collection
until we have the WAL

Signed-off-by: Callum Styan <callumstyan@gmail.com>

Signed-off-by: Callum Styan <callumstyan@gmail.com>
Co-authored-by: Travis Patterson <travis.patterson@grafana.com>",85,57,1,1,"2018-04-16 10:25:39","1733.45"
"grafana/loki","54d3e0e64ece4439d843685470d012365a0fd811","periklis","2022-11-29 13:01:43","true","operator: Check for mandatory CA configmap name in ObjectStorageTLS spec (#7753)",95,55,1,1,"2018-04-16 10:25:39","1684.11"
"grafana/loki","ab2d50a2b2a1ea75d013bc1f35f42e10cac1dd46","andrew-demb","2022-07-26 20:45:10","true","Typo in 'trimPrefix' function signature (#6733)",75,51,0,0,"2018-04-16 10:25:39","1561.43"
"grafana/loki","2f0c2e675ca824a5bdf32a36c458352a109fe458","JordanRushing","2022-07-26 16:04:10","true","Update Memberlist dependency version; tidy and re-vendor (#6717)

Signed-off-by: JordanRushing <rushing.jordan@gmail.com>",75,51,0,0,"2018-04-16 10:25:39","1561.24"
"grafana/loki","c6af640798cbac19ebd3226e8fcd266115d6cd78","adityacs","2022-05-16 14:30:27","true","feat: support simple selection of labels in json expr parser (#6151)",78,49,0,1,"2018-04-16 10:25:39","1491.17"
"grafana/loki","25bd0a4a55d84594df74a5c27e02ecab90130cd1","MasslessParticle","2022-07-14 21:01:33","true","Fix TIME_WAIT connection leak from queriers to compactor (#6681)

* Fix TIME_WAIT connection leak from queriers to compactor

* lint",71,51,0,1,"2018-04-16 10:25:39","1549.44"
"grafana/loki","f49df1363f2ee0e6edfde9eb3229eee0683a5a4e","tomwilkie","2018-04-23 14:59:13","false","Update vendor",0,0,0,0,"2018-04-16 10:25:39","7.19"
"grafana/loki","93cd29f26145e44243de5e7e7ca7e272fd093a34","grubint","2023-10-04 19:38:18","true","docs: fix promtail configuration sample for compressed files (#10784)

**What this PR does / why we need it**:
Fixes a typo which references an unknown field in
[scrapeconfig.DecompressionConfig](https://github.com/grafana/loki/blob/main/clients/pkg/promtail/scrapeconfig/scrapeconfig.go#L56)


[Search](https://github.com/search?q=repo%3Agrafana%2Floki+initial_sleep&type=code
) for `initial_sleep` yields only this line in the docs, while
[search](https://github.com/search?q=repo%3Agrafana%2Floki+initial_delay&type=code)
for `initial_deplay` yields code matches.

Co-authored-by: J Stickler <julie.stickler@grafana.com>",26,66,1,0,"2018-04-16 10:25:39","1994.63"
"grafana/loki","8fa4134ef9504a82c10acd402ff13597ab98ac88","dannykopping","2023-07-28 12:08:20","true","Update dskit (#10091)",51,63,1,1,"2018-04-16 10:25:39","1928.32"
"grafana/loki","40d0536e4580165ce989b7870191c9595e5cd7ad","paul1r","2023-07-06 12:48:37","true","Migrate tool: Fetch chunks as big batch, only go one by one in case of an error (#9867)

**What this PR does / why we need it**:

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",57,63,1,0,"2018-04-16 10:25:39","1906.35"
"grafana/loki","f9a1f2d94ee3da7fb8289907f346063f6b6bc29a","DylanGuedes","2023-03-03 17:23:13","true","Loki: Stop running tickers on deletes (#8697)

**What this PR does / why we need it**:
Calls `ticker.Stop()` to avoid leaking ticker resources for
`GenNumberLoader` and `deleteRequestsClient`.",73,58,1,1,"2018-04-16 10:25:39","1778.29"
"grafana/loki","59eff5ca58622a9a1aa620bb6b1985804e15d449","MichelHollands","2022-12-26 14:48:24","true","Add count to template functions (#7951)

**What this PR does / why we need it**:

Add a `count` template function to count occurrences of a substring. For
example if `label=""abc abd abc""`

```
{{ .label | count ""abc"" }}
``` 

would return 2.

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>
Co-authored-by: Danny Kopping <dannykopping@gmail.com>",97,56,1,1,"2018-04-16 10:25:39","1711.18"
"grafana/loki","ef4bc8f1ede6f3d19e23cfccf71e824aa5e8b07e","sandeepsukhani","2022-05-19 14:06:47","true","copy all the fixes/improvements that went into boltdb-shipper that are missing from generic index-shipper (#6200)",71,49,0,1,"2018-04-16 10:25:39","1494.15"
"grafana/loki","69e38a3b5ee4c9b09c6d713e6952d129b2744cbc","julienduchesne","2021-06-10 07:09:44","true","Add step to identify windows Drone runner (#3832)

I'm migrating our agents to GCP, I want to make sure it's working",164,38,0,0,"2018-04-16 10:25:39","1149.61"
"grafana/loki","003cf32b9cbb0f49fdd927fdd169f1acfa22f582","pracucci","2019-10-19 05:13:19","false","promtail: fix error message displaying on invalid config file",66,18,0,0,"2018-04-16 10:25:39","548.03"
"grafana/loki","6f4671a5728e7a99de1751f08fa68d345b659599","liguozhong","2022-09-01 07:40:59","true","[new feature] syntax: support ""vector"" grama (#7007)

<!--  Thanks for sending a pull request!  Before submitting:

1. Read our CONTRIBUTING.md guide
2. Name your PR as `<Feature Area>: Describe your change`.
  a. Do not end the title with punctuation. It will be added in the changelog.
  b. Start with an imperative verb. Example: Fix the latency between System A and System B.
  c. Use sentence case, not title case.
  d. Use a complete phrase or sentence. The PR title will appear in a changelog, so help other people understand what your change will be.
3. Rebase your PR if it gets out of sync with main
-->

**What this PR does / why we need it**:
Implement vector() function.

The ""vector function"" feature is divided into multiple PRs to avoid excessively large PRs resulting in too long review time.

**Which issue(s) this PR fixes**:
Fixes #6946

**Special notes for your reviewer**:
The test for syntax has passed
![image](https://user-images.githubusercontent.com/9583245/187588436-7c2c401f-1d88-4bff-a41a-965d36454ebe.png)

<!--
Note about CHANGELOG entries, if a change adds:
* an important feature
* fixes an issue present in a previous release, 
* causes a change in operation that would be useful for an operator of Loki to know
then please add a CHANGELOG entry.

For documentation changes, build changes, simple fixes etc please skip this step. We are attempting to curate a changelog of the most relevant and important changes to be easier to ingest by end users of Loki.

Note about the upgrade guide, if this changes:
* default configuration values
* metric names or label names
* changes existing log lines such as the metrics.go query output line
* configuration parameters 
* anything to do with any API
* any other change that would require special attention or extra steps to upgrade
Please document clearly what changed AND what needs to be done in the upgrade guide.
-->
**Checklist**
- [ ] Documentation added
- [ ] Tests updated
- [ ] Is this an important fix or new feature? Add an entry in the `CHANGELOG.md`.
- [ ] Changes that require user attention or interaction to upgrade are documented in `docs/sources/upgrading/_index.md`",81,52,1,1,"2018-04-16 10:25:39","1595.89"
"grafana/loki","cb6f7a1a7775a35f1a5e48a0264a377d64efe7ce","periklis","2023-03-15 17:44:43","true","operator: Add alerting style guide validation (#8743)

Co-authored-by: Robert Jacob <xperimental@solidproject.de>",88,59,1,1,"2018-04-16 10:25:39","1790.3"
"grafana/loki","138ca71dd527104688b27eb8b171cdc0987de0ee","sandeepsukhani","2021-08-02 08:00:50","true","add a method to check whether error is due to a missing object in storage while reading or deleting the object (#4081)",103,39,0,1,"2018-04-16 10:25:39","1201.65"
"grafana/loki","5237a348fd56bfc9a4e9cd1fd3f5e20f7761b6bc","salvacorts","2022-03-02 12:28:17","true","Fix test (#5509)",299,46,0,1,"2018-04-16 10:25:39","1411.84"
"grafana/loki","4f034422b42eacc39c80b793d00b8d05fae286c1","roidelapluie","2020-06-15 13:09:22","true","Remove unhelpful/problematic term in circleci.yml (#2212)

The word was redundant with the sentence where it is used.

Signed-off-by: Julien Pivotto <roidelapluie@inuits.eu>",137,26,0,0,"2018-04-16 10:25:39","789.61"
"grafana/loki","feb7fb470b20c17c4d76ac5c13a73b1a948e2fcd","dannykopping","2021-02-09 13:41:26","true","LogQL: Simple JSON expressions (#3280)

* New approach, still rough

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Adding benchmark

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Adding tests

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Minor refactoring

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Appeasing the linter

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Further appeasing the linter

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Adding more tests

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Adding documentation

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Docs fixup

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Removing unnecessary condition

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Adding extra tests from suggestion in review

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Adding JSONParseErr

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Adding test to cover invalid JSON line

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Adding equivalent benchmarks for JSON and JSONExpression parsing

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Adding suffix if label would be overridden

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Reparenting jsonexpr directory to more appropriate location

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Setting empty label on non-matching expression, to retain parity with label_format

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Adding statement about returned complex JSON types

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Added check for valid label name

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Making json expressions shardable

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",125,34,0,1,"2018-04-16 10:25:39","1023.64"
"grafana/loki","e001086ac00fb8790380b751b9de0a1226ec9b98","dannykopping","2023-04-05 22:56:05","true","Fix CHANGELOG link (#9048)

Previous was pointing to ""main"" which will cause confusion

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",83,59,1,1,"2018-04-16 10:25:39","1810.52"
"grafana/loki","210b9ec4610f49fdf417c3cd7a26bc1272639788","adambro","2022-07-26 20:57:45","true","Fix YAML syntax and ConfigMap reference (#6735)",75,51,0,0,"2018-04-16 10:25:39","1561.44"
"grafana/loki","ffc6b7f9d36af3cc704b453ed7a5e9779b615b54","daixiang0","2019-04-04 03:47:38","false","Add dashboard example

Signed-off-by: Xiang Dai <764524258@qq.com>",95,11,0,0,"2018-04-16 10:25:39","347.72"
"grafana/loki","a9d85de4aa5290cf2f8b2dca5d08645bbd0dc66c","slim-bean","2021-04-20 17:02:50","true","Re-license to AGPLv3 (#3630)

For a rationale as to why this was done, please see

* https://grafana.com/blog/2021/04/20/grafana-loki-tempo-relicensing-to-agplv3/
* https://grafana.com/blog/2021/04/20/qa-with-our-ceo-on-relicensing/

Signed-off-by: Richard Hartmann <richih@richih.org>
Signed-off-by: Edward Welch <edward.welch@grafana.com>",162,36,0,1,"2018-04-16 10:25:39","1100.03"
"grafana/loki","85e524788e9892c4413157ce07b516f88109c935","jeschkies","2022-10-13 08:30:36","true","Provide example policy for S3 storage. (#7407)

**What this PR does / why we need it**:
This should make it easier for users to set the proper policies for
their S3 storage.

**Which issue(s) this PR fixes**:
Relates to #7403

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the `CONTRIBUTING.md` guide
- [x] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",92,54,1,1,"2018-04-16 10:25:39","1637.92"
"grafana/loki","7193f540c221635316741db8bd1a7e5f0b51fa3a","jeschkies","2022-04-07 07:53:11","true","Return bad request for multi-tenant tail. (#5792)

Closes #5753",321,48,0,1,"2018-04-16 10:25:39","1446.64"
"grafana/loki","3db664c07ee85b2d61d48279914ca2aad6c66ef1","periklis","2021-10-01 09:26:50","true","Fix go mod sum (#82)",138,41,0,1,"2018-04-16 10:25:39","1260.71"
"grafana/loki","caf7dde32be8b085549273fc6c238e3b6b656a3a","periklis","2022-06-09 12:03:26","true","operator: Add missing rbac to get/list/watch namespaces (#6303)",72,50,0,1,"2018-04-16 10:25:39","1514.07"
"grafana/loki","adfd339d654cca2d8b5a10d1a2ef2d235b50477c","daixiang0","2019-03-21 03:26:36","false","remove white noise

Signed-off-by: Xiang Dai <764524258@qq.com>",92,11,0,0,"2018-04-16 10:25:39","334.71"
"grafana/loki","d0a96b20b0db08e76355905efd659e54cde9de7c","jcantrill","2022-09-29 18:38:08","true","operator: Prepare bundle for openshift-logging release 5.6 (#7297)",92,53,1,0,"2018-04-16 10:25:39","1624.34"
"grafana/loki","d67306b657c10c6c6d19fec6855ef7babfc48755","franzwong","2022-03-24 12:45:15","true","Promtail: Rename config name limit_config to limits_config (#5707)

* Rename promtail config name 'limit_config' to 'limits_config'

* Add changelog entry

* Fix formatting",310,47,0,0,"2018-04-16 10:25:39","1433.85"
"grafana/loki","806d6a503e1746a158f332d055f5d9fbd8b28d1a","cyriltovena","2021-04-28 11:26:14","true","Custom Retention (#3642)

* Playing around with a POC based on the design doc.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Getting series ID for label matchers is now working.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes tests.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* wip/

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* We're parsing the index label now.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Starting to extract interfaces to make the code testable.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Work in progress will try to add labels to chunk ref iterator

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Iterator for chunks ref with all labels !!!.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Optimize code away.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* with delete into the mix

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Cleaner but not yet working for v10 and v11.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes series cleaner.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* hooking into the compactor.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Hooking limit retention config.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Finishing off the marker processor.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Working on sweeper and fixing tests.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Adding more tests and founding more bugs along the way.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Bug with path once boltdb is closed.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixing more bug and more robust test.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* More test and cleanup getting close.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes moar bugs with regards to period schema

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fix a flaky tests because of boltdb still open.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add more metrics.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Adding metrics.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Improve benchmark.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes issue.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* lint code.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* more logs.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Save files without using table key

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Improve logging and ability to use more goroutines.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Removes duplicate metrics since histogram contains total too.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add more logs.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes a deadlock bug when too many workers are trying to update the mark file.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes a deadlock when reading and updating db at the same time.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes default config test  of boltdb.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* PR Review feedbacks.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Remove the user of assert to not fail a test if it's incorrect on the first shot.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add experimental notice to the flag documentation

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes empty index detection and table deletion.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Do not delete folder it's not necessary with object store.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Better working path cleanup

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* got linted.
Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",175,36,0,1,"2018-04-16 10:25:39","1107.79"
"grafana/loki","dbc693be8613cbf738e5047458ddbda46caa5168","periklis","2022-07-22 17:30:11","true","operator: Update go4.org/unsafe/assume-no-moving-gc to latest (#6748)",73,51,0,1,"2018-04-16 10:25:39","1557.29"
"grafana/loki","20041b74d644042766e864fefe96cd30079d08dc","dannykopping","2022-02-07 15:19:52","true","Revert ""Simplify code for write path in distributor (#5248)"" (#5337)

This reverts commit 10b93cebe54af5b3af65308d5e0724e5aec2bb50.

We discovered that these changes can lead to log deduplication issues.

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",278,46,0,1,"2018-04-16 10:25:39","1386.95"
"grafana/loki","ec33a891df9c1c923f16c3e7b2ba62de67c1ec93","CCOLLOT","2023-01-13 16:45:17","true","lambda-promtail: remove duplicate key in terraform config sample (#8137)

**What this PR does / why we need it**:
This PR removes a duplicate key in the terraform configuration sample

**Which issue(s) this PR fixes**:
None

**Special notes for your reviewer**:
This is a trivial PR",94,57,1,0,"2018-04-16 10:25:39","1728.26"
"grafana/loki","635e469e9a8018ff6d47431605be77de62038af3","slim-bean","2020-07-09 19:56:08","true","Loki: Use a new context to update the ring state after a failed chunk transfer (#2330)

* Loki: Use a new context to update the ring state after a failed chunk transfer

* Update pkg/ingester/transfer.go

Co-authored-by: Cyril Tovena <cyril.tovena@gmail.com>

* Update pkg/ingester/transfer.go

Co-authored-by: Cyril Tovena <cyril.tovena@gmail.com>

Co-authored-by: Cyril Tovena <cyril.tovena@gmail.com>",126,27,0,1,"2018-04-16 10:25:39","813.9"
"grafana/loki","6b16d547acc096dfabe962448ac343911ddc2799","periklis","2023-10-12 18:26:43","true","operator: Bump deps to address CVE-2023-39325 and CVE-2023-44487 (#10874)",24,66,1,1,"2018-04-16 10:25:39","2002.58"
"grafana/loki","3346ce1b40e750b016782b378fe0cbc1ef79a22a","cyriltovena","2019-07-16 15:43:52","true","Storage memory improvement (#713)

* add benchmark for storage queries
* improve iterator to load only on next
* fix memory retained by lazy chunks
* reverse backward lazy iterator",98,15,0,1,"2018-04-16 10:25:39","455.47"
"grafana/loki","6930fb2a5ce94bcf36963d69cec0973e8cb95721","owen-d","2020-02-04 21:00:16","true","adds stringer methods for all ast expr types (#1630)

* adds stringer methods for all ast expr types

* Update pkg/logql/ast.go

Co-Authored-By: Cyril Tovena <cyril.tovena@gmail.com>

Co-authored-by: Cyril Tovena <cyril.tovena@gmail.com>",108,21,0,1,"2018-04-16 10:25:39","653.69"
"grafana/loki","dd6865180fbf99684cbe629469205895c08c34d6","steven-sheehy","2020-07-24 15:38:24","true","Fix regression in chart name (#2406)

Signed-off-by: Steven Sheehy <steven.sheehy@hedera.com>",122,27,0,0,"2018-04-16 10:25:39","828.72"
"grafana/loki","bd879498addd3da21fe68ea1a269286b8708cb22","jeschkies","2022-11-18 14:15:27","true","Serialize query JSON response in a stream. (#7721)

**What this PR does / why we need it**:
Previously the query response was converted to `loghttp.ResultValue`.
This requires a lot of allocations. Furthermore, the JSON response
string was allocated before it was written to the response writer. This
changes replaces the conversion from `parser.Value` to
`loghttp.ResultValue` with a hand written JSON stream. This redueces the
allocation overhead quite a bit:

```
› benchstat before.txt after.txt
name        old time/op    new time/op    delta
_Encode-16    51.5µs ± 1%    24.1µs ± 5%  -53.25%  (p=0.008 n=5+5)

name        old alloc/op   new alloc/op   delta
_Encode-16    7.68kB ± 0%    1.66kB ± 0%  -78.34%  (p=0.008 n=5+5)

name        old allocs/op  new allocs/op  delta
_Encode-16       129 ± 0%        28 ± 0%  -78.29%  (p=0.008 n=5+5)
```

The correctness is validate with quick check.

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the `CONTRIBUTING.md` guide
- [ ] Documentation added
- [x] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",94,55,1,1,"2018-04-16 10:25:39","1673.16"
"grafana/loki","e57af51c37d0100c844ab7435a194890a9d3f349","slim-bean","2021-03-01 20:47:34","true","Promtail: Add pack stage (#3401)

* Creating a ""wrap"" stage which can take labels and embed them into a log line by wrapping the log line in JSON

* improve tests, deterministic ordering of json

* add test for quotes

* add test for ingest timestamp

* update docs

* update docs

* update docs

* lint

* test flake

* rename wrap to pack

* fix docs

* rename files

* typo",140,34,0,1,"2018-04-16 10:25:39","1045.93"
"grafana/loki","2dbdbee5e67999b255ec25f510b993792b8d46ee","slim-bean","2021-03-02 01:39:44","true","Loki: fix alignment of atomic 64 bit to work with 32 bit OS (#3411)

* fix alignment of atomic 64 bit to work with 32 bit OS

* add comment",140,34,0,1,"2018-04-16 10:25:39","1046.13"
"grafana/loki","f0ef4662fe1f569ac49209d4f2817a745780fe2f","vlad-diachenko","2022-02-04 11:10:57","true","Documentation for load testing Loki with xk6-loki (#5182)

* Add initial page for xk6-loki docs

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* added documentation for xk6-loki query scenario

* Add simple installation and usage instructions

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* Add page about log generation with xk6-loki

* Add documentation for k6 write scenario

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* fixup: incorporate feedback from Karen

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>
Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* fixup! fixup: incorporate feedback from Karen

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* fixup: @ppcano's suggestions

* fixup: @cyriltovena's suggestions

* fixup: make read scenario more generic

* Apply suggestions from code review

Co-authored-by: Pepe Cano <pepe@loadimpact.com>
Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* Apply suggestions from code review

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* Use correct URL for git clone command

Co-authored-by: Kaviraj Kanagaraj <kavirajkanagaraj@gmail.com>

Co-authored-by: Christian Haudum <christian.haudum@gmail.com>
Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>
Co-authored-by: Pepe Cano <pepe@loadimpact.com>
Co-authored-by: Kaviraj Kanagaraj <kavirajkanagaraj@gmail.com>",277,45,0,0,"2018-04-16 10:25:39","1383.78"
"grafana/loki","b3cce9e84b46ec93a1fa36ec7651dc94e965eb2f","MichelHollands","2023-03-28 14:36:06","true","Update changelog for 2.7.5 release (#8919)

**What this PR does / why we need it**:
Update changelog. The changes related to the 2.7.s will be backported to
the release-2.7.x branch in another PR.

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [X] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",82,59,1,1,"2018-04-16 10:25:39","1803.17"
"grafana/loki","eb3cff4625556440b0ec82f75454a129d230c4f9","MichelHollands","2023-10-06 19:11:28","true","Update Go version to 1.21.2 in Dockerfiles (#10805)

**What this PR does / why we need it**:

Update the go version in the Dockerfiles to 1.21.2

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

---------

Signed-off-by: Michel Hollands <michel.hollands@gmail.com>",25,66,1,1,"2018-04-16 10:25:39","1996.62"
"grafana/loki","dd9f30fcb0a58731ed8a70c531e14c5e05cf3b8d","sapslaj","2023-07-26 22:36:21","true","lambda-promtail: Support SNS events (#9964)

**What this PR does / why we need it**:

Some use cases (such as S3 bucket notifications) are better suited for
SNS rather than SQS when you need to send events to multiple
destinations. Adding a little bit of extra parsing logic for SNS events
allows directly connecting an SNS topic to the Lambda Promtail function
and bypasses the extra complexity of the SQS queue. This lower
complexity is very helpful in cross-AWS-account use cases like
CloudTrail event forwarding.

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

- I just updated the SQS section of the docs to also reference SNS,
since the functionality is basically identical. Happy to take
suggestions on improvements there. Not sure if `CHANGELOG.md` needs to
be updated as well or not.
- This is semi-difficult to unit test since there isn't an existing test
harness for event matching. Testing in situ on our own infrastructure
seems to work.

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [x] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",53,63,1,0,"2018-04-16 10:25:39","1926.76"
"grafana/loki","0426870f3ffc412980332a442f4c57d0bef079a2","sandeepsukhani","2022-01-24 12:49:58","true","fix broken boltdb-shipper test (#5222)",273,45,0,1,"2018-04-16 10:25:39","1373.85"
"grafana/loki","0a944670efca0dd1cce5b1900433f59bfb9b5f07","cyriltovena","2021-11-26 14:20:28","true","Improve LogQL format stages requireLabel (#4769)

* Improve LogQL format stages.

This only includes required labels.

```
➜ go test -benchmem -run=^$  -bench ^Benchmark_Pipeline ./pkg/logql/log -v -count 5  > after.txt && benchstat before.txt after.txt
name                                 old time/op    new time/op    delta
_Pipeline/pipeline_bytes-16            13.8µs ± 6%    11.5µs ± 1%  -16.42%  (p=0.008 n=5+5)
_Pipeline/pipeline_string-16           13.9µs ± 2%    11.5µs ± 2%  -17.27%  (p=0.008 n=5+5)
_Pipeline/line_extractor_bytes-16      14.0µs ± 4%    11.6µs ± 0%  -17.45%  (p=0.016 n=5+4)
_Pipeline/line_extractor_string-16     13.5µs ± 0%    11.5µs ± 0%  -14.67%  (p=0.008 n=5+5)
_Pipeline/label_extractor_bytes-16     13.7µs ± 1%    11.7µs ± 1%  -14.69%  (p=0.008 n=5+5)
_Pipeline/label_extractor_string-16    14.1µs ±11%    11.6µs ± 0%  -17.89%  (p=0.008 n=5+5)

name                                 old alloc/op   new alloc/op   delta
_Pipeline/pipeline_bytes-16            9.51kB ± 0%    7.50kB ± 0%  -21.19%  (p=0.008 n=5+5)
_Pipeline/pipeline_string-16           9.51kB ± 0%    7.50kB ± 0%  -21.19%  (p=0.008 n=5+5)
_Pipeline/line_extractor_bytes-16      9.51kB ± 0%    7.50kB ± 0%  -21.19%  (p=0.008 n=5+5)
_Pipeline/line_extractor_string-16     9.51kB ± 0%    7.50kB ± 0%     ~     (p=0.079 n=4+5)
_Pipeline/label_extractor_bytes-16     9.51kB ± 0%    7.50kB ± 0%  -21.18%  (p=0.008 n=5+5)
_Pipeline/label_extractor_string-16    9.51kB ± 0%    7.50kB ± 0%  -21.18%  (p=0.008 n=5+5)

name                                 old allocs/op  new allocs/op  delta
_Pipeline/pipeline_bytes-16              46.0 ± 0%      45.0 ± 0%   -2.17%  (p=0.008 n=5+5)
_Pipeline/pipeline_string-16             46.0 ± 0%      45.0 ± 0%   -2.17%  (p=0.008 n=5+5)
_Pipeline/line_extractor_bytes-16        46.0 ± 0%      45.0 ± 0%   -2.17%  (p=0.008 n=5+5)
_Pipeline/line_extractor_string-16       46.0 ± 0%      45.0 ± 0%   -2.17%  (p=0.008 n=5+5)
_Pipeline/label_extractor_bytes-16       46.0 ± 0%      45.0 ± 0%   -2.17%  (p=0.008 n=5+5)
_Pipeline/label_extractor_string-16      46.0 ± 0%      45.0 ± 0%   -2.17%  (p=0.008 n=5+5)
```

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* rollback model change

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* remove unused variable

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",216,43,0,1,"2018-04-16 10:25:39","1315.91"
"grafana/loki","f7f09e2226d042f8978f3e9b2b2e62eeb6c289f0","sandeepsukhani","2019-05-30 12:01:34","true","Limits: Reject entries based on age set in limits (#631)

* Reject entries based on age set in limits",109,13,0,1,"2018-04-16 10:25:39","409.32"
"grafana/loki","ae424deac128f183c39e071462611993d19dfb7c","aknuds1","2021-09-10 15:54:29","true","Upgrade dskit (#4295)

Signed-off-by: Arve Knudsen <arve.knudsen@gmail.com>",131,41,0,0,"2018-04-16 10:25:39","1239.98"
"grafana/loki","ce9e5353d34ed26e5762bb1033222636cc139da0","JStickler","2023-05-10 14:17:25","true","TOC Sync: Move design docs, LIDs and maintaining under Community. (#9202)

**What this PR does / why we need it**:

**Which issue(s) this PR fixes**:
Fixes #8720

**Special notes for your reviewer**:
Part of the Database products table of contents alignment project.
Moves Maintaining, Design Documents, and LID files under Community
heading in TOC.
Updates front matter for the topics.
Adds aliases for redirects.",79,61,1,0,"2018-04-16 10:25:39","1850.41"
"grafana/loki","2e3dfc38f292d14f99734e350f8b359dabed1538","Red-GV","2022-07-12 11:14:15","true","Defining Loki dockerfile user as numeric value (#6659)",70,51,0,1,"2018-04-16 10:25:39","1547.03"
"grafana/loki","e0d9be19e7f7131e487ce83d1960c0bfcf4d8bf3","joe-elliott","2020-03-02 21:28:14","true","Move dashboards out into their own json files (#1766)

Signed-off-by: Joe Elliott <number101010@gmail.com>",116,22,0,0,"2018-04-16 10:25:39","681.71"
"grafana/loki","4f488e7dea83c3ed0ea756c59db67db6593062ce","joe-elliott","2019-12-16 20:50:04","true","Removed unsupported encodings from docs (#1432)

* Removed unsupported encodings from docs

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Also removed none

Signed-off-by: Joe Elliott <number101010@gmail.com>",93,20,0,0,"2018-04-16 10:25:39","605.68"
"grafana/loki","68141444f88ccf99bbd5cb55d50d2573112046e9","MasslessParticle","2022-07-11 08:29:09","true","Introduce Groupcache (#6644)

* implement groupcache

* use mailgun groupcache

* use memberlist

* implement peer discovery with the ring

* implement retrieval and storage

* use a ticker

* Correctly configuring chunk cache

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Enabling results cache

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Fixing groupcache ring page

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* groupcache-poc: Add support for index cache. (#6535)

* Hacked in prometheus metrics (#6544)

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* add http to addresses

* always make a group for each cache

* fix peer discovery

* Fix groupcache config

- Allow it to be enabled/disabled
- Move all config to 'common' config
- Always write to hot cache

* Add http/2 support for groupcache (#6596)

* Add groupcache latency metrics (#6619)

* Add groupcache latency metrics

* lint

* lint

* lint

* Add groupcache test (#6620)

* Add groupcache test

* lint

* Improve 'Fetch' allocs 11 -> 8 (#6623)

* Move constants to the file where they're used

* remove irrelevant comments

Co-authored-by: Danny Kopping <danny.kopping@grafana.com>
Co-authored-by: Kaviraj Kanagaraj <kavirajkanagaraj@gmail.com>",70,51,0,1,"2018-04-16 10:25:39","1545.92"
"grafana/loki","236500468325c71b2c795fca4c31158329360786","tomwilkie","2019-02-05 19:27:03","false","Explicty encode the chunk.

I broke this when I updated the vendored Cortex, which includes https://github.com/cortexproject/cortex/commit/ac653065193fc9f9b91d0a3da38886cd20b816e5#diff-42196489d8c6339357699ab3656cb2e1R315.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",78,10,0,0,"2018-04-16 10:25:39","289.38"
"grafana/loki","5511de88b512c86d611f7dc9980337e2c3c4dd55","rfratto","2020-01-13 22:22:56","true","Link to release docs in README.md, not master docs (#1516)

Co-authored-by: Ed Welch <ed@oqqer.com>",101,21,0,1,"2018-04-16 10:25:39","632.75"
"grafana/loki","4d96393935d3e2176a910e794877d406ab5aafde","chaudum","2023-09-11 11:21:30","true","Reflect 2.9 upgrade notes on main (#10536)

Cleanup upgrade notes from 2.9 release on main branch.

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",45,65,1,1,"2018-04-16 10:25:39","1971.29"
"grafana/loki","3e0ee04e7fe15c24d6294dddb9ac41174e23ae79","owen-d","2020-01-31 19:39:22","true","loki frontend docs additions (#1611)

* loki frontend docs additions

* s/cortex/loki/

Co-Authored-By: Cyril Tovena <cyril.tovena@gmail.com>

* Update docs/configuration/query-frontend.md

Co-Authored-By: Cyril Tovena <cyril.tovena@gmail.com>

* addresses pr comments

* query frontend docs downstream via http, use 9091 as http port

* removes grpc references in frontend yaml snippet

* more comprehensive query frontend example description

* makes query frontend example deployable alongside existing loki

Co-authored-by: Cyril Tovena <cyril.tovena@gmail.com>",102,21,0,1,"2018-04-16 10:25:39","650.63"
"grafana/loki","b494713106f8ac5a7af50a7aeadc01fc24d5f058","vlad-diachenko","2022-08-12 13:30:15","true","fixed typo in API host (#6892)",83,52,0,0,"2018-04-16 10:25:39","1577.13"
"grafana/loki","bc29c6109e80e2e79b2a988cd3542cd3dcd0984b","nop33","2020-12-03 18:20:40","true","Fix docs header inconsistency (#3027)",124,31,0,0,"2018-04-16 10:25:39","957.83"
"grafana/loki","763025845fe3aaf3f2137fc013a77ea48904f5c0","granular-ryanbonham","2019-03-25 17:34:04","false","Fix liveness/readyness probes, they can not be empty {}",92,11,0,0,"2018-04-16 10:25:39","339.3"
"grafana/loki","987067cbfaa780653a0f8828fc928047dccb2cb0","slim-bean","2020-08-24 19:25:56","true","Merge branch 'release-1.6.1'",122,28,0,1,"2018-04-16 10:25:39","858.88"
"grafana/loki","79c5fdd9c0e1bd27462619c1d5479ac3ca917da3","slim-bean","2023-06-07 19:53:33","true","Canary: Refactor how the direct Canary push works (#9569)

**What this PR does / why we need it**:

When doing some testing a while back I ran into several cases were we
didn't handle errors/retries properly in the code we added for the
canaries to send directly to Loki. The changes here effectively
duplicate the way promtail's client does sends to Loki which is code
we've been using/relying on for years now.

I also had a hard time following the previous implementation which used
the io.Writer interface for swapping out writing to stdout vs pushing to
Loki and refactored this to use a new interface `EntryWriter` which has
implementations that write to stdout and to Loki

Unfortunately the changes in the diff don't read super well with this
refactoring so hopefully the explanation helps.

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

---------

Signed-off-by: Edward Welch <edward.welch@grafana.com>
Co-authored-by: Paul Rogers <129207811+paul1r@users.noreply.github.com>",68,62,1,1,"2018-04-16 10:25:39","1877.64"
"grafana/loki","2e098c81b81b7635a7060951791a6d5328f16c07","slim-bean","2019-04-12 11:53:31","false","starting to add label extraction, super rough but need to do some work in a different branch",101,12,0,1,"2018-04-16 10:25:39","356.06"
"grafana/loki","d52d2cc10ac0cc30038a9b05fd60578fc74a64fe","polar3130","2019-11-26 19:38:09","false","add description about tenant stage (#1266)",82,19,0,0,"2018-04-16 10:25:39","585.63"
"grafana/loki","717e49e3f859c1e3e2a0ef84aed5dc24e1d6253d","oddlittlebird","2019-09-18 15:06:15","false","Update README.md (#1024)

Minor grammar and consistency edits.

Note: There is inconsistent capitalization of Promtail/promtail. If you let me know which is correct, then I will update this topic as well as the Grafana Style Guide (in progress).",67,17,0,0,"2018-04-16 10:25:39","517.44"
"grafana/loki","f331a24906d01fe08e7ce9aa34e826cbd11d137a","daniellee","2018-12-11 13:04:48","true","Merge pull request #58 from grafana/readme-update

readme: adds docker instructions",12,8,0,0,"2018-04-16 10:25:39","235.11"
"grafana/loki","bd110d2b9270714cc1f41dcb0a8a1d9dde2728a0","dannykopping","2022-11-28 15:19:54","true","Improvements to loki-build-image build & release process (#7795)",98,55,1,1,"2018-04-16 10:25:39","1683.2"
"grafana/loki","c97dc1b9ebe4825d3fb56e491db8ada8a5fe3739","KMiller-Grafana","2021-08-31 18:54:18","true","Docs: revise max_query_lookback knob definition (#4245)",130,40,0,0,"2018-04-16 10:25:39","1231.1"
"grafana/loki","b3e038c7a8c72ee72aaad201efd17af3ec4ba9e7","ashwanthgoli","2023-01-10 14:17:25","true","config_wrapper: Add support for named stores (#7946)

Signed-off-by: Ashwanth Goli <iamashwanth@gmail.com>

**What this PR does / why we need it**:
This PR adds support for named stores which allows users to define
multiple object store configurations for a storage type. Named stores
can be referred to from other sections of the config similar to how
provider type is being used `i.e aws, gcs...`. Named store reference
should be of the format: `<store_type>.<key_name>`

Below is an example configuration with two named stores defined for aws
`store-1, store-2`. Schema config is referring to one of them as
`aws.store-1`
```
storage_config:
  aws:
    endpoint: s3://common-bucket
    region: us-east1
    access_key_id: abc123
    secret_access_key: def789
  named_stores:
    aws:
      store-1:
        endpoint: s3://foo-bucket
        region: us-west1
        access_key_id: 123abc
        secret_access_key: 789def
      store-2:
        endpoint: s3://bar-bucket
        region: us-west2
        access_key_id: 456def
        secret_access_key: 789abc
schema_config:
    configs:
        - from: ""2020-07-31""
            index:
              period: 24h
              prefix: loki_prod_index_
            object_store: aws.store-1
            schema: v11
            store: boltdb-shipper
```
**Which issue(s) this PR fixes**:
Fixes #7276

**Special notes for your reviewer**:
Configuration defined in common storage config has no effect on the
named stores. Common storage config only overrides storageConfig if it's
not explicitly set - same behavior as before. This should be a
non-intrusive change.

Signed-off-by: Ashwanth Goli <iamashwanth@gmail.com>",99,57,1,0,"2018-04-16 10:25:39","1725.16"
"grafana/loki","a5c5f1693857594adb4f59e3176fe941d5939bd9","jeschkies","2021-12-20 13:06:00","true","Provide optional matchers to `LabelValuesForMetricName`. (#4933)

* Provide optional matchers to `LabelValuesForMetricName`.

* Pass all tests.

* Clarify that we are using series IDs.

* Use a set for filtering series ids.

* Move matcher support to series.

* Write changelog line.

* Revert renaming.

* Validate time range.

* Reset base time.

* Update pkg/storage/chunk/series_store.go

Co-authored-by: Cyril Tovena <cyril.tovena@gmail.com>

* Pre-allocate unique strings.

Co-authored-by: Cyril Tovena <cyril.tovena@gmail.com>",242,44,0,1,"2018-04-16 10:25:39","1339.86"
"grafana/loki","a135652e690f4da92bd18dcd3467d9a35becc851","slim-bean","2020-02-04 18:41:27","false","ignore markdown in codecoverage

Signed-off-by: Edward Welch <edward.welch@grafana.com>",108,21,0,1,"2018-04-16 10:25:39","653.59"
"grafana/loki","5d1fec514c368f589f3ae160a1b5b530a52caa9d","roidelapluie","2019-11-25 21:24:14","false","Expose discarded bytes metric (#1317)

Signed-off-by: Julien Pivotto <roidelapluie@inuits.eu>",83,19,0,0,"2018-04-16 10:25:39","584.71"
"grafana/loki","4a2dc5e97d938e045d63348cce4dbe9805622f3d","roidelapluie","2019-11-26 18:57:08","false","Update README.md (#1276)",82,19,0,0,"2018-04-16 10:25:39","585.61"
"grafana/loki","164f5cd0ae9241bc436d22729ca98fc4877ede4d","owen-d","2020-09-01 19:03:06","true","Ruler/loki rule validator (#2589)

* revendors cortex

* loki multitenantmanager

* vendoring compat

* go mod",118,28,0,1,"2018-04-16 10:25:39","865.86"
"grafana/loki","7b11de86c940e222d4ad539191a713b377b448c2","aknuds1","2021-07-23 13:48:14","true","loki-build-image: Fix (#4034)

Signed-off-by: Arve Knudsen <arve.knudsen@gmail.com>",97,39,0,0,"2018-04-16 10:25:39","1192.89"
"grafana/loki","2da8d6f4b8a6952690aefba6fbeb9270c5899edb","pstibrany","2019-12-06 14:50:00","false","docs: Fix grpc_listen_host and http_listen_host. (#1353)

They should be grpc_listen_address and http_listen_address respectively.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>",93,20,0,0,"2018-04-16 10:25:39","595.43"
"grafana/loki","3451dd7c3994906f3b630e1db9631c530697ac7c","rfratto","2020-07-27 12:43:19","true","add RegisterFlagsWithPrefix to config structs (#2414)

All config structs now have a RegisterFlagsWithPrefix function that
allows specifying a prefixed string to append to all flag names. This
may be used by clients to namespace support for Promtail in a larger
application (e.g., grafana/agent).

When implementing this PR, I noticed a few config structs were
incorrectly registering to the global flagset rather than the flagset
passed to RegisterFlags. This PR also includes a fix for that and
ensures every option is registered to the flagset in the parameter.

Related to #2405.",123,27,0,1,"2018-04-16 10:25:39","831.6"
"grafana/loki","d25f8abff91516a76f50272caeabe47692956b5a","kariya-mitsuru","2023-05-01 11:45:06","true","Helm: Fix gateway proxy_pass settings (#9215)

**What this PR does / why we need it**:
1. Rewrite the regular expressions for exact or prefix matches because
they are matching in places where they shouldn't be (due to a missing
anchor (`^`)), which is also causing inefficiency. Exact and prefix
matches are also easy to understand because they are the longest matches
regardless of the order in which they are listed.

2. Change the destination of the following Ruler API from `$readUrl` to
`$backendUrl` because setting `LegacyReadTarget=false` cause it to stop
functioning. (Fix #9214)
   - `/api/prom/rules`
   - `/api/prom/rules/*`
   - `/loki/api/v1/rules`
   - `/loki/api/v1/rules/*`

3. Add the following APIs settings.  
   - Ingester  
     - `/flush`
   - MeberListKV  
     - `/memberlist`
   - Compactor  
     - `/loki/api/v1/delete`
     - `/loki/api/v1/cache/generation_numbers`
   - IndexGateway  
     - `/indexgateway/ring`

4. Remove following APIs settings because they are unused.
   - `/store-gateway/*`
   - `/query-scheduler/*`

5. Change Admin API to be set only if enabled.

6. Re-arrange the APIs settings by component to make it easier to check.

**Which issue(s) this PR fixes**:
Fixes #9214

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

Signed-off-by: Mitsuru Kariya <mitsuru.kariya@nttdata.com>",79,60,1,0,"2018-04-16 10:25:39","1841.31"
"grafana/loki","37fc1ed15d8ffb615b222354e2ba986e81469207","periklis","2021-12-20 14:13:17","true","Fix operator entrypoint markdown files (#4976)",243,44,0,1,"2018-04-16 10:25:39","1339.91"
"grafana/loki","f25e42b0581240cf974b6eb192cd5b420890250b","cyriltovena","2020-02-10 14:30:24","true","Query frontend service should be headless. (#1665)

Queriers need to connect to Pod IP discovered via headless service not a load balanced one.

my bad, found by @pracucci @pstibrany.",113,22,0,1,"2018-04-16 10:25:39","659.42"
"grafana/loki","cde9a711f3f253cea78dd40d1cf978ab4a41a1f5","cyriltovena","2022-01-28 09:43:29","true","fluent-bit: Attempt to unmarshal nested json. (#5223)

* fluent-bit: Attempt to unmarshal nested json.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Also support nested json array.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",276,45,0,1,"2018-04-16 10:25:39","1377.72"
"grafana/loki","0bce8d95a2f42708d7ce8148e64cd0173067df05","ssncferreira","2022-04-07 22:18:54","true","Split by range of instant queries (#5662)

* Split by range on Instant queries POC v3

Co-authored-by: Christian Haudum <christian.haudum@gmail.com>

* Handle uneven split by duration

* Register SplitByRangeMiddleware in roundtripper

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* fixup! Register SplitByRangeMiddleware in roundtripper

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* fixup! fixup! Register SplitByRangeMiddleware in roundtripper

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* Remove rewrite if range aggr has label extraction stage

In case a range aggregation has a generic label extraction stage, such
as `| json` or `| logfmt` and no group by, we cannot split it, because
otherwise the downstream queries would result in too many series.

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* Fix linting

* Implement range splitting for rate() and bytes_rate()

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* Fix linting

* Calculate offset of downstream queries correctly

if the outer query range contains an offset as well.

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* Fix linting

* Add optimization by moving the outer label grouping downstream

* Add label grouping downstream optimization to rate and bytes_rate expressions

* Add changelog entry

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* Simplify types in rangemapper

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* fixup! Simplify types in rangemapper

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* Check in Map function if query is splittable by range

Since this is the main function of the mapper, we can ensure here that
only supported vector/range aggregations are handled.

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* Some code cleanups and variable renaming

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* Extract duplicate code in range aggr mapping into function

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* Add topk to supported splittable vector aggregations

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* Check if query is splittable by range before calling Map()

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* Add more function comments

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* Rename RangeVectorMapper to RangeMapper

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* Fix incorrect import due to rebase

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* Add equivalence test cases with `logfmt` pipeline stage

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* Remove limitation of pushing down vector aggr only if grouping is present

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* Remove TestRangeMappingEquivalenceMockMapper test

This test is essentially the same as the test
Test_SplitRangeVectorMapping, just using a different representation of
the result.

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* fixup! Remove limitation of pushing down vector aggr only if grouping is present

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* fixup! fixup! Remove limitation of pushing down vector aggr only if grouping is present

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* Fix linter errors

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* Better naming of variable

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* Split SplitRangeVectorMapping test into two

to have the test for noop queries separated

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

Co-authored-by: Christian Haudum <christian.haudum@gmail.com>
Co-authored-by: Owen Diehl <ow.diehl@gmail.com>",320,48,0,0,"2018-04-16 10:25:39","1447.25"
"grafana/loki","1dcf3d371bcebae41e5d31bfa59d105a8b95a4f4","daixiang0","2019-12-03 07:08:51","false","chore(/release): distribute binaries as .zip (#1160)

Switches from `.gz` to `.zip` for the compressed binaries, as this format is more common across operating systems (works out of the box on probably all of them, including tooling such as Puppet, Ansible, etc.)",90,19,0,0,"2018-04-16 10:25:39","592.11"
"grafana/loki","9920a27f06b9a808bcd0d7323a55041bc343a8bc","trevorwhitney","2023-02-01 21:45:30","true","Update GEL plugin in k3d env to latest (#8378)",77,57,1,1,"2018-04-16 10:25:39","1746.47"
"grafana/loki","1b80a2f54d069d52536c9b925030695bea30c954","periklis","2023-08-02 11:32:06","true","operator: Fix local development deps (#10111)",52,63,1,1,"2018-04-16 10:25:39","1932.3"
"grafana/loki","c40993bf44e4a4aecdcb18ddd1dd8c4cac2499cc","periklis","2023-07-27 17:34:23","true","drone: Fix manifest-operator pipeline waiting for deps (#10086)",50,63,1,1,"2018-04-16 10:25:39","1927.55"
"grafana/loki","1e143ace11ed042eff7433df481ee3d96b855f4a","MichelHollands","2023-01-10 16:34:40","true","Use new build image everywhere (#8063)

Use the latest build image everywhere.

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",100,57,1,1,"2018-04-16 10:25:39","1725.26"
"grafana/loki","a0dc10a03a0a82fef7e4783ceeac0fecd65a0c58","cyriltovena","2020-03-19 15:01:40","true","Use 8080 for Loki http port  binding in tanka. (#1823)

* Use 8080 for Loki http port  binding.

Previously we were using 80 but now that we run a rootless Loki for security reason.
 We can't bind below 1000.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Update also docker file and default config.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",115,23,0,1,"2018-04-16 10:25:39","698.44"
"grafana/loki","98b2e0e28e70cf3659f18990fe986ae08b7b14bb","daixiang0","2019-04-18 06:10:12","false","Bump chart version

Signed-off-by: Xiang Dai <764524258@qq.com>",96,12,0,0,"2018-04-16 10:25:39","367.07"
"grafana/loki","18e828c705a6bd01e7f31a4ca5acd0e6c1c88f99","rfratto","2020-03-23 21:43:09","true","Proposal: Promtail Push API (#1627)

Co-Authored-By: Owen Diehl <ow.diehl@gmail.com>",120,23,0,1,"2018-04-16 10:25:39","702.72"
"grafana/loki","bcbffb1988476867f5d1c6846a210cca831b5556","kavirajk","2021-03-25 18:41:19","true","Remove memberlist config from ring config. (#3542)",145,35,0,1,"2018-04-16 10:25:39","1069.84"
"grafana/loki","8d6dc2c4ca3c696e18dc37ccba51d1671a152e4c","cyriltovena","2020-05-01 12:54:50","true","Update go from 1.13 to 1.14. (#2013)

* Update go from 1.13 to 1.14.

See https://golang.org/doc/go1.14

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* modules.txt.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",121,24,0,1,"2018-04-16 10:25:39","745.6"
"grafana/loki","6e3b62bf3ec640b24a218665d874b0b247e5f5ba","ludydoo","2023-01-13 17:34:54","true","Documentation: Add installation instructions for Istio (#4812)

**What this PR does / why we need it**:
Because there is very little information on how to install loki in the
istio service mesh, and I spent a good deal of time figuring it out.


Co-authored-by: Owen Diehl <ow.diehl@gmail.com>",94,57,1,0,"2018-04-16 10:25:39","1728.3"
"grafana/loki","2f29e8e5830eaa603ff4b38a9afdec48b47b8aea","trevorwhitney","2021-04-26 17:06:26","true","add note about wildcard log patterns and log rotation (#3655)

Signed-off-by: Trevor Whitney <trevorjwhitney@gmail.com>",171,36,0,1,"2018-04-16 10:25:39","1106.03"
"grafana/loki","9418fb71251dcc3fcd97ca49ebce068a06d12f0e","slim-bean","2023-11-07 19:18:06","true","Loki: fix mapping of non-retryable error codes (#11164)

**What this PR does / why we need it**:

Fallout of a recent change to reduce complexity in our
tripperware/middleware in #10688 lead to non-retryable errors being
retried by the retry middleware in the frontend.

This PR is a solution to that problem, I'm not sure it's the best
solution, but it's a solution....

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)
- [ ] If the change is deprecating or removing a configuration option,
update the `deprecated-config.yaml` and `deleted-config.yaml` files
respectively in the `tools/deprecated-config-checker` directory.
[Example
PR](https://github.com/grafana/loki/pull/10840/commits/0d4416a4b03739583349934b96f272fb4f685d15)

Signed-off-by: Edward Welch <edward.welch@grafana.com>",9,67,1,1,"2018-04-16 10:25:39","2027.62"
"grafana/loki","28ebf8ec12e7ce68a79d1826b0a8832d3e4c6e24","jeschkies","2023-03-12 11:40:20","true","Impose per-request limit on label queries. (#8777)

**What this PR does / why we need it**:
#8727 introduced per-request limits. These should be enforce for label
queries as well. This change adds the required middleware to all label
query endpoints.

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [x] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",87,59,1,1,"2018-04-16 10:25:39","1787.05"
"grafana/loki","f653a93d4291805381e7fb3a856e44d60cb5ddfe","KMiller-Grafana","2021-07-08 14:02:55","true","Docs: added new target (docs-next) to the docs' Makefile. (#3962)

This target builds local docs as they should look for commits that are
placed into the main branch, showing the next up, but not yet released
Loki docs.",121,39,0,0,"2018-04-16 10:25:39","1177.9"
"grafana/loki","350c16362c5556ec99b29fbd7a2dae9eb0ab2e65","daixiang0","2018-12-14 05:58:53","false","update logcli doc (#99)

Signed-off-by: Xiang Dai <xiang.dai@iluvatar.ai>",25,8,0,0,"2018-04-16 10:25:39","237.81"
"grafana/loki","794c324e64c4eb2f984b0f9b1a2ac3471d4d6faa","jdbaldry","2020-12-02 13:53:34","true","doc: Cleanup formatting (#3017)

* doc: Add missing backticks

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* doc: Use absolute path to positions.yaml file

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* doc: Remove .. from URL paths

I'm not sure what the `..` means exactly.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>",124,31,0,0,"2018-04-16 10:25:39","956.64"
"grafana/loki","3bf2efa371e55511ab467fcda22cfd03e2a9f507","atomic77","2022-03-29 08:40:24","true","logcli: Remove port from TLS server name when provided in --addr (#5477)

If connecting to a TLS secured endpoint with an explicit port,
ensure that ServerName contains only the host and not the port to avoid
a cert validation failure",310,47,0,0,"2018-04-16 10:25:39","1438.68"
"grafana/loki","243b0a6564c9b7954cc4dc7cb38e212410b5a906","cstyan","2022-06-22 22:47:21","true","Remove file lag alert (#6452)

Signed-off-by: Callum Styan <callumstyan@gmail.com>",69,50,0,1,"2018-04-16 10:25:39","1527.52"
"grafana/loki","0ca425d47100ccd489f043cf84e53e86bd926e81","periklis","2022-03-15 12:02:47","true","operator: Use recommended labels for LokiStack components (#5621)",304,47,0,1,"2018-04-16 10:25:39","1424.82"
"grafana/loki","bd4cc5d168a6fb831100f4a2bdc1799dde6cb69c","daniellee","2018-12-12 19:32:20","true","Merge pull request #84 from grafana/readme-slack

readme: adds section about search",19,8,0,0,"2018-04-16 10:25:39","236.38"
"grafana/loki","a0b7b3dfb020d1c87e71cd0f45228918e5d68203","owen-d","2021-10-29 13:58:47","true","improves grouping docs examples (#4590)",169,42,0,1,"2018-04-16 10:25:39","1288.9"
"grafana/loki","614912181e6f3988b2b22791053278cfb64e169c","owen-d","2022-03-07 06:05:54","true","updates clusterrole and clusterrolebinding apiVersions in promtail.sh (#5547)",300,47,0,1,"2018-04-16 10:25:39","1416.57"
"grafana/loki","572bbe15ec7284f768194fc8840ab22832f0dd76","owen-d","2021-08-06 15:00:33","true","Discard/ooo (#4104)

* stream includes tenant id

* expose out_of_order discarded metrics",103,40,0,1,"2018-04-16 10:25:39","1205.94"
"grafana/loki","929c8e4923258679e934991eec344629cafa36a4","chaudum","2021-11-03 13:15:31","true","Allow HTTP POST requests on ring pages (#4630)

The ring pages offer the ability to ""forget"" instances of the ring and
this is implemented by a HTTP `form` element, which does a `POST`
request on itself.

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",170,42,0,1,"2018-04-16 10:25:39","1292.87"
"grafana/loki","fbd5bbb09dcbc2294a25ac8734b1b461f416abe3","chaudum","2022-11-23 09:20:22","false","Improve error logs query in operational dashboard

Instead of parsing all lines and filtering on `level` label, just filter
by `level=error` string.

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",93,55,1,1,"2018-04-16 10:25:39","1677.95"
"grafana/loki","b4ac996b871555a2e314a53b8ac4f913225df95f","ronensc","2022-03-08 17:27:23","true","operator: Reorder changelog in descending order (#5572)",303,47,0,0,"2018-04-16 10:25:39","1418.04"
"grafana/loki","35465d0297d68f61c968505c587a637680db95bb","ssncferreira","2023-06-23 09:14:44","true","Fix instant query summary split stats (#9773)

**What this PR does / why we need it**:

Fix instant query summary statistic's `splits` corresponding to the
number of subqueries a query is split into based on
`split_queries_by_interval`.

* Update rangemapper with a statistics structure to include the number
of split queries a query is mapped into.
* In the `split_by_range` middleware once the mapped query is returned
update the middleware statistics with the number of split queries. This
value will then be merged with the statistics of the Loki response.

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [x] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",62,62,1,0,"2018-04-16 10:25:39","1893.2"
"grafana/loki","2ef5e6faf9f6e86660d7452dfe712e1260d98f5a","DylanGuedes","2021-12-29 17:43:33","true","Move `min_sharding_lookback` to the right place. (#5007)

- This configuration is actually inside the limits section
- We shouldn't change the CLI flag to something different to not break
  existing deployments",253,44,0,1,"2018-04-16 10:25:39","1349.05"
"grafana/loki","321ee92fd249e4d60080a1e5dfa5a1d471f13c70","bboreham","2023-01-23 20:55:34","true","stores/series: always return entries to pool (#8245)",83,57,1,0,"2018-04-16 10:25:39","1738.44"
"grafana/loki","cea2e0ed58465872af96a316186392e4d622c181","xperimental","2023-11-07 12:44:37","true","operator: Update skipRange for next OpenShift release (#11106)",9,67,1,1,"2018-04-16 10:25:39","2027.35"
"grafana/loki","1deacceca909cb16db89fcda74dd8b8bfe83fecf","jeschkies","2022-03-15 12:18:26","true","Test multi-tenant context propagation. (#5620)

**What this PR does / why we need it**:
The original change injected the user id when the org id was required to fetch all data.

**Which issue(s) this PR fixes**:
Fixes grafana/loki-private#230

**Special notes for your reviewer**:
The changes can be tested as follows
1. Change working directory to `tools/dev/loki-boltdb-storage-s3`.
2. Call `./compose-up.sh` to boot the cluster.
3. Query the logs with
    ```
   curl -v -X GET -G ""http://localhost:8007/loki/api/v1/query_range"" -H ""X-Scope-OrgID: 1|2""   --data-urlencode 'query={compose_service=~""log-gen.*""}' | jq '.data.result[].stream'
    ```
    It will should two streams with `__tenant_id: 1` and `__tenant_id_: 2` as part of the labels.


**Checklist**
- [ ] Documentation added
- [ ] Tests updated
- [ ] Add an entry in the `CHANGELOG.md` about the changes.",304,47,0,1,"2018-04-16 10:25:39","1424.83"
"grafana/loki","35a929c239612b37e48962dd1f6eabf7b0cf75ac","sh0rez","2019-08-06 08:53:50","false","doc: loki + canary",99,16,0,0,"2018-04-16 10:25:39","475.19"
"grafana/loki","6447d7c9bbb3ca27f3fe5280a0b8f9fde45c45f4","davkal","2018-11-23 11:35:45","true","Update README.md",5,7,0,0,"2018-04-16 10:25:39","217.05"
"grafana/loki","c76544baf9baf90e6b9fff703e5c6d04b5d62154","sandeepsukhani","2022-03-08 20:48:40","true","build a new batch while starting to process a bucket (#5580)",303,47,0,1,"2018-04-16 10:25:39","1418.18"
"grafana/loki","8ca035ffbf6c22c1c5c867343eb421a2383d9188","MasslessParticle","2023-06-26 14:53:59","true","Log Volume: Do the prometheus-format conversion in dedicated middleware (#9776)

This PR moves the Prometheus-format conversion to it's own middleware.
This keeps it all in one place and consolidates logic that was in many
places. It also sets us up to make range queries as a next step.",59,62,1,1,"2018-04-16 10:25:39","1896.44"
"grafana/loki","00906d206637febe738c1d4b0a622c51da29707f","daixiang0","2019-03-06 11:24:54","false","promtail: fix wrong config path (#375)

Signed-off-by: Xiang Dai <764524258@qq.com>",88,11,0,0,"2018-04-16 10:25:39","320.04"
"grafana/loki","f1c4ba2f59310242a7ad20b2861e386bed5abe7f","cyriltovena","2021-01-07 17:02:36","true","Add zstd and flate compressions algorithms. (#3064)

* Add zstd and flate compressions algorithms.

zstd has the highest ratio of all while flate is very simalar to gzip. I'm adding those mainly for posterity and to keep them benchmarked.

This also update gzip and lz4 library which both have been improved.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add missing vendor change.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* update go.mod.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",115,33,0,1,"2018-04-16 10:25:39","991.78"
"grafana/loki","8f9cd97880bff5e92ce8716f4219f5382637fa85","cyriltovena","2019-09-04 15:45:56","false","Improve API compatibility.
- keep supporting regex for old endpoint.
- use reserved keyword for removed property in grpc",123,17,0,1,"2018-04-16 10:25:39","503.47"
"grafana/loki","9e300baf89c7ee5d828202841088f80a9c1c13f0","jkroepke","2022-11-01 10:58:59","true","[Helm] Add toggle for MetricsInstance (#7525)

Signed-off-by: Jan-Otto Kröpke <jok@cloudeteer.de>

**What this PR does / why we need it**:

Chart version 3.3.0 introduced a new MetricsInstance CR. The only way to
disable the MetricsInstance is `--set
loki.monitoring.serviceMonitor.metricsInstance=null`, but this raises
helm warning...

```
coalesce.go:220: warning: cannot overwrite table with non table for loki.monitoring.serviceMonitor.metricsInstance (map[annotations:map[] labels:map[] remoteWrite:<nil>])
coalesce.go:220: warning: cannot overwrite table with non table for loki.monitoring.serviceMonitor.metricsInstance (map[annotations:map[] labels:map[] remoteWrite:<nil>])
coalesce.go:220: warning: cannot overwrite table with non table for loki.monitoring.serviceMonitor.metricsInstance (map[annotations:map[] labels:map[] remoteWrite:<nil>])
```

**Checklist**
- [ ] Reviewed the `CONTRIBUTING.md` guide
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

Signed-off-by: Jan-Otto Kröpke <jok@cloudeteer.de>",88,54,1,0,"2018-04-16 10:25:39","1656.02"
"grafana/loki","63be9c24c5c2a10f8d3f6fb751221fc7fba2c021","davkal","2019-04-10 12:33:14","true","Merge pull request #462 from daixiang0/add-format

Add link to chunk format doc",99,12,0,0,"2018-04-16 10:25:39","354.09"
"grafana/loki","3a2e5d4bbc94fb83e97a035e51df0e5997ccfa09","chancez","2020-01-13 17:39:44","false","pkg/promtail: Initialize counters to 0 when creating client (#1453)

This ensures metrics are not missing before they're incremented the first
time, as recommended by the upstream Prometheus instrumentation guidelines:
https://prometheus.io/docs/practices/instrumentation/#avoid-missing-metrics.

Currently, in the case of dropped_entries_total and dropped_bytes_total,
the metric is simply missing until the first occurrence of an entry
being dropped.",99,21,0,0,"2018-04-16 10:25:39","632.55"
"grafana/loki","1b8f609b863dba168a9d5fadb83fae471cf7e89c","periklis","2022-07-07 08:09:05","true","Fix drone CI builds for loki operator (#6599)",71,51,0,1,"2018-04-16 10:25:39","1541.91"
"grafana/loki","8dd9d253fef798e7d3ab284afcaca2392c094689","periklis","2021-05-04 00:56:13","true","Use pointers for optional API fields (#41)",181,37,0,1,"2018-04-16 10:25:39","1113.35"
"grafana/loki","096cf0cfaf3fe62cb1bcc86945229e64dfa326ed","cstyan","2021-10-15 14:40:09","true","Update golang and loki-build-image image versions. (#4481)

Signed-off-by: Callum Styan <callumstyan@gmail.com>",158,42,0,1,"2018-04-16 10:25:39","1274.93"
"grafana/loki","8f024954539b5eb706ab3ef967c4b1696ad04fd6","cyriltovena","2022-04-08 17:20:49","true","Refactoring of the Loki storage (#5833)

* Extract index interface from the series store

* moving package around

* Moving more things around

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Moving more things around

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* moving package around

* Moving more things around again

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Moving more things around again

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* improve composite store for more generics index store

* fixes first round of tests and ensure coverage is still good

* implement series method

* Fixes storage tests

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add test for GetSeries

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Make Loki compile

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* lint the whole project

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes tests

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* tsdb util package usage

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add more information of why SetChunkFilterer exists for the index

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes ruler/base package

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes o2

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",319,48,0,1,"2018-04-16 10:25:39","1448.04"
"grafana/loki","a1e0298a5743398e60a588e10371d0cc5817bed3","jkroepke","2022-06-03 15:23:49","true","Support tenant id from value (#6290)

Signed-off-by: Jan-Otto Kröpke <mail@jkroepke.de>",72,50,0,0,"2018-04-16 10:25:39","1508.21"
"grafana/loki","79a90dc4f644780ecd0682b5965d29b7fb577739","cyriltovena","2020-06-19 21:30:56","true","Docker driver relabeling (#2199)

* Add relabeling to docker driver using `loki-relabel-config` log option.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add docs.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",144,26,0,1,"2018-04-16 10:25:39","793.96"
"grafana/loki","10b5bcab729c9ada926a5a7cfd7aab199d057b31","cyriltovena","2020-01-06 14:46:47","true","Validates limit parameter. (#1470)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",106,21,0,1,"2018-04-16 10:25:39","625.43"
"grafana/loki","a22bce728626ca346cf1c5d734719d4340084c60","cyriltovena","2021-04-02 08:23:13","true","Add a chunk filter hook in the store. (#3569)

* Add a chunk filter hook in the store.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* doc.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* fixes the test.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* got linted.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",148,35,0,1,"2018-04-16 10:25:39","1076.41"
"grafana/loki","7f98b09148bbc30a05a65a89191f267b231855d1","irizzant","2023-04-19 17:08:58","true","Loki microservices tanka: add some ingester replicas (#9160)

**What this PR does / why we need it**:

This PR makes Ingester pods available in multi zone mode which, based on
the previous defaults, were not created.

**Which issue(s) this PR fixes**:
Fixes #9139",78,60,1,0,"2018-04-16 10:25:39","1829.53"
"grafana/loki","794471b1eb132e18093f0e5b7f52d06d4ef74e92","paul1r","2023-08-30 12:08:07","true","Fix fluentbit plugin for manifest step (#10399)

**What this PR does / why we need it**:
It appears that this commit
(https://github.com/grafana/loki/commit/d484d31856926b9694d6d2d162ade10de3de247c)
is causing a failure when on the manifest.manifest-fluent-bit step
(2023/08/28 09:53:47 pushing by spec
time=""2023-08-28T09:53:47Z"" level=fatal msg=""Inspect of image
\""grafana/fluent-bit:main-586b904-amd64\"" failed with error:
errors:\ndenied: requested access to the resource is
denied\nunauthorized: authentication required\n""
exit status 1).

Subsequent investigation has shown that the grafana/fluent-bit docker
repo does not exist.

This PR is to change the manifest step to reference
'fluent-bit-plugin-loki' instead of 'fluent-bit'. The former is
referenced for other steps in the Make process.

I have also moved the boringcrypto canary ahead of the fluent-bit step
to put the canaries next to each other, and to further help debug this
step, should this change not be correct.

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",45,64,1,0,"2018-04-16 10:25:39","1960.32"
"grafana/loki","199746a130bdc5d21e50612ef49b60e37251548f","gouthamve","2019-04-26 12:22:46","true","Make sure the default for EnforceMetricName is ✅ (#518)

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>",96,12,0,0,"2018-04-16 10:25:39","375.33"
"grafana/loki","81e48e795f404d0b206a4e8868ceff968e1f810a","gouthamve","2018-12-20 13:33:57","true","Add cloning instructions to be inside GOPATH (#176)

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>",48,8,0,0,"2018-04-16 10:25:39","244.13"
"grafana/loki","19030e6dc109ee13cd8568e1ef0452a07da74183","cyriltovena","2020-09-10 13:20:43","true","More template stage examples. (#2606)

Add an example for the `Entry` key that can be used to reference the log line.",116,29,0,1,"2018-04-16 10:25:39","874.62"
"grafana/loki","cdf4a73238c4fa2f12bcdd693d1e9011fec5b5a2","cyriltovena","2021-01-07 08:23:48","true","Improve tailer matching by using the index. (#3090)

* Improve tailer matching by using the index.

```
❯ benchcmp  before.txt after
benchmark                              old ns/op     new ns/op     delta
Benchmark_instance_addNewTailer-16     537731        1479          -99.72%

benchmark                              old allocs     new allocs     delta
Benchmark_instance_addNewTailer-16     244            3              -98.77%

benchmark                              old bytes     new bytes     delta
Benchmark_instance_addNewTailer-16     22098         121           -99.45%
```

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Review feedback.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",116,33,0,1,"2018-04-16 10:25:39","991.42"
"grafana/loki","6aa85e318cf3d210e461833e75cc1c5b127cd58e","cyriltovena","2022-11-04 06:16:13","true","Improves performance of json responses (#7522)

**What this PR does / why we need it**:

This allows to reuse stream memory allocations between responses.
Related https://github.com/grafana/loki/pull/3163 but this time this is
for the encoding.

```
❯ benchstat before.txt after.txt                                                                                                              
name        old time/op    new time/op    delta
_Encode-16    29.2µs ±12%    25.2µs ± 1%  -13.85%  (p=0.016 n=5+4)

name        old alloc/op   new alloc/op   delta
_Encode-16    24.9kB ± 6%    16.4kB ± 8%  -34.20%  (p=0.008 n=5+5)

name        old allocs/op  new allocs/op  delta
_Encode-16       145 ± 0%       129 ± 0%  -11.03%  (p=0.008 n=5+5)
```",90,55,1,1,"2018-04-16 10:25:39","1658.83"
"grafana/loki","8cec7aa914759c7f1b146205bf10e04fd9dd44d9","cyriltovena","2019-08-06 12:21:38","false","improve documentation",99,16,0,1,"2018-04-16 10:25:39","475.33"
"grafana/loki","7b706eea8c7f11b05abb704be8543047b007fb8e","Red-GV","2023-06-01 15:05:08","true","operator: Set seccomp profile to runtime default for all variants (#9457)",68,61,1,1,"2018-04-16 10:25:39","1871.44"
"grafana/loki","92fca94bb58c73ebacecfe228a0cd789e485c2ec","MasslessParticle","2022-12-22 15:21:18","true","Revert ""Update Ingester Rate Calculations (#7652)"" (#7991)

This change was supposed to smooth out the per-second rate of streams so
distributors could react more uniformly to streams with variable rates.
In practice, it resulted in drastically more resource usage on
distributors because `GetStreamRates` now responds with all streams on
an ingester rather than only the streams seen in the last second. This
change also didn't seem to affect sharding precision one way or another.

If we'd still like to implement exponential smoothing for stream rates,
it should be implemented in distributors to keep communication overhead
to a minimum.",98,56,1,1,"2018-04-16 10:25:39","1707.21"
"grafana/loki","97a87f5af0f423af3e8be704c8561df605a0b3e6","tomwilkie","2019-01-29 11:22:54","true","Fixup Loki monitoring mixin (#248)

* Fix the mixin to reference the mixin-utils pkg.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>

* s/g.selector/utils.selector/

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>

* Actually import utils.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>

* Don't cut corners with replacing.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",68,9,0,0,"2018-04-16 10:25:39","283.04"
"grafana/loki","de471fdb6056ffabce43a12db807f14fff6e7c46","paul1r","2023-08-16 21:52:13","true","loki-canary boringcrypto version (#10246)

**What this PR does / why we need it**:
This creates a 'BoringCrypto' version of the Loki canary code, and
publishes it to a loki-canary-boringcrypto repo

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",51,64,1,0,"2018-04-16 10:25:39","1946.73"
"grafana/loki","e0db03cf9f9644cd1cc60dcd875e4d0920cedc52","yubozhao","2019-02-07 21:48:40","false","delete s3 storage doc",78,10,0,0,"2018-04-16 10:25:39","291.47"
"grafana/loki","c24bf76c34e4743484055021ecbe11c81882ee57","periklis","2021-12-17 15:01:40","true","Fix operator actions branch protection from master to main (#4964)",237,44,0,1,"2018-04-16 10:25:39","1336.94"
"grafana/loki","f8604ba0a78445d90b872e2fa24822d4d6468660","periklis","2022-10-18 14:00:14","true","operator: Upgrade operator-sdk to v1.24.1 (#7449)",89,54,1,1,"2018-04-16 10:25:39","1643.15"
"grafana/loki","6d35588cd8b97a800386b3ba59a55c86dacae57a","ashwanthgoli","2023-01-09 15:11:46","true","chore: fix drone drift (#8072)

**What this PR does / why we need it**:
fixing drone drift introduced
[here](https://github.com/grafana/loki/commit/2bad98dc8e1f9c4ddfb415a91f93fe0ea32b4c71#diff-bdb48f4b4fc2de6480bba395b25edd195a38b948ebd998d0fa78cc15cd8acbcfR4)

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the `CONTRIBUTING.md` guide
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

Signed-off-by: Ashwanth Goli <iamashwanth@gmail.com>",97,57,1,0,"2018-04-16 10:25:39","1724.2"
"grafana/loki","3370ccfd7d385aefa01099b23c8c895f39317045","daixiang0","2019-09-09 10:27:46","false","fix positions.yaml location reference

Signed-off-by: Xiang Dai <764524258@qq.com>",118,17,0,0,"2018-04-16 10:25:39","508.25"
"grafana/loki","7b48422b6fc3bece71d644723a466ebde0a83344","keyolk","2020-12-01 10:14:45","true","Fix typo (#3002)

Signed-off-by: keyolk <chanhun.jeong@navercorp.com>",120,31,0,0,"2018-04-16 10:25:39","955.49"
"grafana/loki","c58224c87d13b0214b0b52c3ee42697b2698a822","blockloop","2021-04-30 04:30:19","true","remove parallel testing of internal/management/state/state_test.go (#40)",180,36,0,0,"2018-04-16 10:25:39","1109.5"
"grafana/loki","b43f88aa432fc9199facea26d58d3363f28950bf","tomwilkie","2018-06-05 11:51:48","false","Update circle config, deploy master branch automatically

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",1,2,0,0,"2018-04-16 10:25:39","49.06"
"grafana/loki","cbc0df32413f917960115c0bfd40ee57adb01155","poyzannur","2023-10-19 08:26:19","true","Add NewBlockOptions constructor (#10955)

Adds a `NewBlockOptions()` constructor plus a quick fix for a missed err check.",20,66,1,0,"2018-04-16 10:25:39","2009.17"
"grafana/loki","f7aaf6ef55d8c97dbe02311805a1711d33f1d68f","slim-bean","2019-11-01 11:49:16","false","use regex label matcher to not alert on any tail route latencies (#1221)

* use regex label matcher to not alert on any tail route latencies

* simplify regex",68,18,0,1,"2018-04-16 10:25:39","560.31"
"grafana/loki","b43039ed5a905baa267f9550eed9b8374a60373d","slim-bean","2020-01-13 22:11:10","false","update the position and size metrics at the same time to try to end the race between these two metrics and the two timers that care about position and size

Signed-off-by: Edward Welch <edward.welch@grafana.com>",101,21,0,1,"2018-04-16 10:25:39","632.74"
"grafana/loki","82a84a5e1d542c691fe9edd06828c8c12261df34","slim-bean","2019-09-09 21:46:39","false","add make to the alpine image used by drone to call the circle job for deployments (we use make to enumerate the image names)",118,17,0,1,"2018-04-16 10:25:39","508.72"
"grafana/loki","48087e0e1af855b67c0ce1285bf3b8acbed245a5","periklis","2023-10-12 12:01:55","true","operator: Add missing marker/sweeper panels in retention dashboard (#10854)

Co-authored-by: Joao Marcal <joao.marcal12@gmail.com>",26,66,1,1,"2018-04-16 10:25:39","2002.32"
"grafana/loki","791262dc258e74a5457dedc82879d383cce2e66e","rfratto","2019-09-26 13:09:37","false","Add Drone CI badge to README.md (#1060)",70,17,0,1,"2018-04-16 10:25:39","525.36"
"grafana/loki","98fda9b0a063f5a4160802ccd8490f1aa18d3d54","slim-bean","2022-05-02 18:34:19","true","Loki: Change live tailing to only allow mutating the log line not the number of streams. (#6063)

* don't create more streams when live tailing logs, process the log line with the pipeline to allow mutating the content of the line but don't split it into new streams.

Signed-off-by: Edward Welch <edward.welch@grafana.com>

* update changelog

Signed-off-by: Edward Welch <edward.welch@grafana.com>

* don't mutate the incoming streams

Signed-off-by: Edward Welch <edward.welch@grafana.com>

* do not reuse the pipeline because it caches labels

Signed-off-by: Edward Welch <edward.welch@grafana.com>

* add note to upgrade guide

Signed-off-by: Edward Welch <edward.welch@grafana.com>",74,49,0,1,"2018-04-16 10:25:39","1477.34"
"grafana/loki","450d91555b63f4b9d1073855b38c9ae808d78587","kavirajk","2021-06-14 08:46:33","true","Add explicit `main` to pull loki and promtail to install it via Tanka (#3848)

Rationale is, by default `jb` command, assumes `master` branch, but Loki repo renamed
the `master` to `main` branch.",121,38,0,1,"2018-04-16 10:25:39","1153.68"
"grafana/loki","a70d092df646ec1fcd5d8cd6b71c85d3692ea8d9","MichelHollands","2023-05-26 11:51:20","true","Add help target to Makefile (#9531)

**What this PR does / why we need it**:

Add a help target to the Makefile. Only the main targets were added.

```
% make help

Usage:
  make <target>

Targets:
  help                                           Display this help and any documented user-facing targets. Other undocumented targets may be present in the Makefile.
  all                                            build all executables (loki, logcli, promtail, loki-canary)
  logcli                                         build logcli executable
  logcli-debug                                   build debug logcli executable
  logcli-image                                   build logcli docker image
  loki                                           build loki executable
  loki-debug                                     build loki debug executable
  loki-canary                                    build loki-canary executable
  helm-test                                      run helm tests
  helm-lint                                      run helm linter
  loki-querytee                                  build loki-querytee executable
  promtail                                       build promtail executable
  promtail-debug                                 build debug promtail executable
  loki-mixin                                     compile the loki mixin
  loki-mixin-check                               check the loki mixin is up to date
  lint                                           run linters
  test                                           run the unit tests
  clean                                          clean the generated files
  docker-driver                                  build the docker-driver executable
  fluent-bit-plugin                              build the fluent-bit plugin
  fluent-bit-image                               build the fluent-bit plugin docker image
  fluent-bit-push                                push the fluent-bit plugin docker image
  fluentd-plugin                                 build the fluentd plugin
  fluentd-plugin-push                            push the fluentd plugin
  fluentd-image                                  build the fluentd docker image
  fluentd-image-push                             push the fluentd docker image
  logstash-image                                 build the logstash image
  logstash-push                                  push the logstash image
  promtail-image                                 build the promtail docker image
  promtail-debug-image                           build the promtail debug docker image
  loki-image                                     build the loki docker image
  loki-debug-image                               build the debug loki docker image
  loki-canary-image                              build the loki canary docker image
  helm-test-image                                build the helm test image
  helm-test-push                                 push the helm test image
  logql-analyzer-image                           build the LogQL Analyzer image
  logql-analyzer-push                            push the LogQL Analyzer image
  build-image                                    build the docker build image
  build-image-push                               push the docker build image
  doc                                            Generates the config file documentation
  check-doc                                      Check the documentation files are up to date
```

**Checklist**
- [X] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",68,61,1,1,"2018-04-16 10:25:39","1866.31"
"grafana/loki","68a9fd6c0a939e0e2879ceb59cf3d0f68366546d","btaani","2023-02-22 22:39:55","true","Add logfmt selective label extraction (#6675)

<!--  Thanks for sending a pull request!  Before submitting:

1. Read our CONTRIBUTING.md guide
2. Name your PR as `<Feature Area>: Describe your change`.
a. Do not end the title with punctuation. It will be added in the
changelog.
b. Start with an imperative verb. Example: Fix the latency between
System A and System B.
  c. Use sentence case, not title case.
d. Use a complete phrase or sentence. The PR title will appear in a
changelog, so help other people understand what your change will be.
3. Rebase your PR if it gets out of sync with main
-->

**What this PR does / why we need it**:
This PR introduces extracting labels from a log line in `logfmt`, with
an extra option to rename them.

For example, this query:
```
{app=”foo”} | logfmt msg,status
```

will extract the labels `msg` and `status` from the following logfmt
line:
```
level=error ts=2021-02-12T19:18:10.037940878Z caller=client.go:294 component=client host=observability-loki-gateway msg=""final error sending batch"" status=400 error=""server returned HTTP status 400 Bad Request (400): entry with timestamp 2021-02-12 19:18:08.917452 +0000 UTC ignored, reason: 'entry out of order' for stream...""
```
With the following results:
```
msg=""final error sending batch""
status=”400”
```
--------------
Another possible scenario with label renaming:
```
{app=”foo”} | logfmt message=""msg"", status
```
That produces the following results:
```
message=""final error sending batch""
status=”400”
```


**Which issue(s) this PR fixes**:
Fixes #3355 

**Special notes for your reviewer**:

<!--
Note about CHANGELOG entries, if a change adds:
* an important feature
* fixes an issue present in a previous release, 
* causes a change in operation that would be useful for an operator of
Loki to know
then please add a CHANGELOG entry.

For documentation changes, build changes, simple fixes etc please skip
this step. We are attempting to curate a changelog of the most relevant
and important changes to be easier to ingest by end users of Loki.

Note about the upgrade guide, if this changes:
* default configuration values
* metric names or label names
* changes existing log lines such as the metrics.go query output line
* configuration parameters 
* anything to do with any API
* any other change that would require special attention or extra steps
to upgrade
Please document clearly what changed AND what needs to be done in the
upgrade guide.
-->
**Checklist**
- [x] Documentation added
- [x] Tests updated
- [x] Is this an important fix or new feature? Add an entry in the
`CHANGELOG.md`.
- [x] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

---------

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>
Co-authored-by: Christian Haudum <christian.haudum@gmail.com>",66,58,1,0,"2018-04-16 10:25:39","1767.51"
"grafana/loki","b70f691cd4e3e16dd2cffb11543997590e20d3a0","adityacs","2020-02-10 14:11:27","true","Support custom prefix name in metrics stage (#1664)",114,22,0,1,"2018-04-16 10:25:39","659.41"
"grafana/loki","7eaaab608a49a8936b391cb9df17a252e808a061","adityacs","2020-07-30 09:14:19","true","fix runtime_config panic (#2450)",130,27,0,1,"2018-04-16 10:25:39","834.45"
"grafana/loki","29e4ad8cf86dddaa4589ccf81422cba2d114285d","owen-d","2020-01-08 00:36:46","false","TOUCH_PROTOS build arg for dockerfile (#1479)

* TOUCH_PROTOS build arg for dockerfile

* echos touch protos in dockerfile

* touch protos correct var

* make touch-protos options in all dockerfiles, run for amd builds",103,21,0,1,"2018-04-16 10:25:39","626.84"
"grafana/loki","4ca1fd0adb3246094485f7fd4573d972cdc5541e","slim-bean","2022-02-21 21:42:27","true","set match_max_concurrent true by default (#5435)

* set match_max_concurrent true by default

Signed-off-by: Edward Welch <edward.welch@grafana.com>

* add note to upgrade guide, fix up some of the existing notes

Signed-off-by: Edward Welch <edward.welch@grafana.com>",296,46,0,1,"2018-04-16 10:25:39","1401.22"
"grafana/loki","8bb615c2cce383890cbe94502c52c5a5d7ec5095","ashwanthgoli","2023-10-11 04:30:31","true","config: loki better defaults (#10793)

**What this PR does / why we need it**:
Updates some of the configuration defaults to provide a better
experience for users out of the box.
I tried to add notes for non-trivial changes explaining the reason.

| configuration | new default | old default | notes |
| ------------------------------------------------------ | ----------- |
----------- | --------
| `compactor.delete-max-interval` | 24h | 0 | splits the delete requests
into intervals no longer than `delete_max_interval` |
| `distributor.max-line-size` | 256KB | 0 | - |
| `ingester.sync-period` | 1h | 0 | ensures that the chunk cuts for a
given stream are synchronized across the ingesters in the replication
set. Helps with deduplicating chunks. |
| `ingester.sync-min-utilization` | 0.1 | 0 | ^ |
| `frontend.max-querier-bytes-read` | 150GB | 0 | - |
| `frontend.max-cache-freshness` | 10m | 1m | avoid caching results for
data that is still in churn |
| `frontend.max-stats-cache-freshness` | 10m | 0 | avoid caching results
for data that is still in churn |
| `memcached.batchsize` | 256 | 1024 | - |
| `memcached.parallelism` | 10 | 100 | - |
| `querier.tsdb-max-query-parallelism` | 128 | 512 | avoid over
parallelising queries for smaller installations |
| `querier.split-queries-by-interval` | 1h | 30m | avoid over
parallelising queries for smaller installations |
| `querier.compress-http-responses` | true | false | compress response
if the request accepts gzip encoding |
| `query-scheduler.max-outstanding-requests-per-tenant` | 32000 | 100 |
current default is too small, opening a big dashboard could hit this
limit |
| `validation.max-label-names-per-series` | 15 | 30 | reducing this to
avoid blowing up the series count and index size. Also enforces users to
think about what labels are being added. |

**Special notes for your reviewer**:
regarding `TestQueryTSDB_WithCachedPostings`: 
removed the assert on get calls as this is hard to get right (splits,
querySize mw making stats calls)
validating additions to the cache and misses is more important here I
think.

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [x] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [x] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",25,66,1,0,"2018-04-16 10:25:39","2001"
"grafana/loki","b6faee205a92ec4550796bfa93be0d463b4bbac9","daixiang0","2019-10-15 18:24:56","false","bump up golangci to 1.20 (#1133)

* bump up golangci to 1.20

Signed-off-by: Xiang Dai <764524258@qq.com>

* Built and published 0.7.3.  Updated all references

Signed-off-by: Joe Elliott <number101010@gmail.com>
Signed-off-by: Xiang Dai <764524258@qq.com>

* Removed concurrency limitation and added 5m timeout

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Upping concurrency to try to reduce lint time

Signed-off-by: Joe Elliott <number101010@gmail.com>

Co-authored-by: Xiang Dai <764524258@qq.com>
Co-authored-by: Joe Elliott <number101010@gmail.com>",64,18,0,0,"2018-04-16 10:25:39","544.58"
"grafana/loki","3054a0ead5aa04ef1e237a88bb2bb55c2a6f70a9","MasslessParticle","2022-08-03 16:03:35","true","Add groupcache timeouts (#6808)

* Add groupcache timeouts

* Made groupcache timeouts configurable",77,52,0,1,"2018-04-16 10:25:39","1568.23"
"grafana/loki","b5930d6d9d9823fadc3d28b74fe7ad52fc7a2651","alrs","2021-03-26 08:54:58","true","single import of jsoniter in logql subpackages (#3544)",145,35,0,0,"2018-04-16 10:25:39","1070.44"
"grafana/loki","b704cf986b3c8068be85e5a79043960ba62960ab","MasslessParticle","2023-01-12 18:20:17","true","Remove flaky helm test (#8122)

This test is causing tens of timeouts across all PRs in our system.
Delete it to improve CI stability",100,57,1,1,"2018-04-16 10:25:39","1727.33"
"grafana/loki","fc8ae5ab9281e064f999d44e560dbc0228ae11a2","rfratto","2019-08-14 21:03:16","true","loki: shutdown module before shutting down HTTP server (#827)

Shutting the module down before shutting down the HTTP server enables
metrics to continue to be collected while the module terminates.

This change syncs up with how Cortex modules are shut down; the module
is always terminated before the HTTP server.

Fixes #819.",102,16,0,1,"2018-04-16 10:25:39","483.69"
"grafana/loki","5b1316ed0f2e922bb76f3bfe0c3f6d770575db1a","adityacs","2020-03-10 17:05:33","true","Fix loki exit on jaeger agent not being present (#1789)",119,23,0,1,"2018-04-16 10:25:39","689.53"
"grafana/loki","c587b538ed816bc8ac16c8ef33432dd9a5edc90f","trevorwhitney","2023-04-05 23:01:03","true","Fail through to next middleware when querySizeLimit cannot be applied (#9050)

**What this PR does / why we need it**:

When the query size limiter can't limit the query, fail through to the
next middleware instead of erroring. This can happen, for example, when
a query spans schemas, which is still a valid query case, so we want to
make sure to fall back to existing behavior.

---------

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>",83,59,1,1,"2018-04-16 10:25:39","1810.52"
"grafana/loki","76842262c745c565ad1008a8e7a33a0fa617f73a","chaudum","2023-09-27 07:07:03","true","Rename NewShipper to NewIndexClient (#10700)

The constructor function name is misleading as it suggests that the returned object is a [shipper](https://github.com/grafana/loki/blob/main/pkg/storage/stores/shipper/index/table_manager.go#L48), rather than an index client.

Also, change the return type to be a struct pointer, rather than an interface.

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",34,65,1,1,"2018-04-16 10:25:39","1987.11"
"grafana/loki","7f54641166d00fcbd16ace5415869d09070dbbe9","chaudum","2021-11-26 09:31:53","true","Set correct `Content-Type` header in query response (#4828)

* Set correct `Content-Type` header in query response

Because the internal query request handlers did not set the response
content type explicitly to `application/json`, and the external request
handler takes the response content type from the internal response to
set it for the resulting HTTP response, that response was also
incorrectly returning `Content-Type: text/plain`.

Setting the content type in the internal response correctly results in
the expected `Content-Type` header `application/json; charset=UTF-8`.

Fixes #4791

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* fixup! Set correct `Content-Type` header in query response

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* fixup! fixup! Set correct `Content-Type` header in query response

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",218,43,0,1,"2018-04-16 10:25:39","1315.71"
"grafana/loki","c9d5a91206d1b9400cb1972943ec45e6f06dcb23","dannykopping","2023-03-27 10:44:27","true","Ruler: Implement consistent rule evaluation jitter (#8896)

**What this PR does / why we need it**:
This PR replaces the previous random jitter with a consistent jitter.
While both are random, having the random jitter be applied
_consistently_ is essential for evaluating rules on a predictable
cadence.

If a rule is supposed to evaluate every minute, whether it evaluates at
(e.g.) `01:00` or `01:03.234` is irrelevant because the evaluation
_instant_ is not adjusted, so it will produce the same result whether
run at `01:00` or `01:03.234`. However, if 1000 rules are set to
evaluate at `01:00`, this will create a resource contention issue.",80,59,1,1,"2018-04-16 10:25:39","1802.01"
"grafana/loki","5f7bde74ac646b17f2934cfbbaaaac5a0d809d81","salvacorts","2023-09-12 10:48:02","true","Add limits (#10552)

**What this PR does / why we need it**:

This PR introduces two new limits for structured metadata:
- `max_structured_metadata_size`: Defaults to 64 KB. Limits the maximum
size of the structured metadata attached to a log line.
- `max_structured_metadata_entries_count`: Default to 128. Limits the
maximum number of structured metadata entries attached to a log line.

We discussed adding other limits like
`max_structured_metadata_label_name_length` and
`max_structured_metadata_label_value_length` but discarded this idea for
now.",41,65,1,1,"2018-04-16 10:25:39","1972.27"
"grafana/loki","b0334bba96221700b80e6861f07b35d859b0eec2","cyriltovena","2020-09-15 06:19:42","true","Fixes links in aws tutorials. (#2621)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",118,29,0,1,"2018-04-16 10:25:39","879.33"
"grafana/loki","37d0c6c39fd7d4334a300fcacba6cdb3386029fd","kavirajk","2022-01-13 12:19:10","true","Fix cancel issue between Query Frontend and Query Schdeduler (#5113)

* Fix cancel issue between Query Frontend -> Query Schdeduler

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* remove assert check for message type

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Handle the case where Frontend is running without Frontend workers

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Make it into `sendRequestCancel()` func

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Remove debug logs

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Fix note

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Remove workers count debug log on test

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Add bug link to test

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Fixes the case where we cancel after enqueuing

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Update pkg/lokifrontend/frontend/v2/frontend.go

Co-authored-by: Oleg Zaytsev <mail@olegzaytsev.com>

* Switch to a buffered channel instead

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add error on unknown response status from scheduler

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

Co-authored-by: Cyril Tovena <cyril.tovena@gmail.com>
Co-authored-by: Oleg Zaytsev <mail@olegzaytsev.com>",265,45,0,1,"2018-04-16 10:25:39","1362.83"
"grafana/loki","b80f37b72478304ce39d1cb508c76515641dc4e6","slim-bean","2020-10-25 21:09:01","true","log any chunk fetch failure (#2804)",119,30,0,1,"2018-04-16 10:25:39","919.95"
"grafana/loki","74a97899dd97c95674a1fdb380c96daa64b680dc","slim-bean","2021-02-25 17:10:40","true","Loki: Fix parser hint for extracted labels which collide with stream labels (#3380)

* add test for issue with hints and extracted labels

* one possible solution

* instead of replacing the label with the _extracted suffix removed, just add a new label with the suffix removed. This will avoid any cases where a legit json or logfmt key ends with _extracted.",137,34,0,1,"2018-04-16 10:25:39","1039.78"
"grafana/loki","7c78b26f80c55e095ddb2f5f1a75878ffc1d545c","jeschkies","2022-04-13 09:15:06","true","Enable tenant ID selection for multi-tenant queries. (#5821)

Closes #5820

Co-authored-by: JordanRushing <rushing.jordan@gmail.com>",320,48,0,1,"2018-04-16 10:25:39","1452.7"
"grafana/loki","5c29b7439f92eabf361d9ab8df16199e8ef5b95c","slim-bean","2023-07-28 18:11:57","true","Loki: change the prefix for the l2 chunks cache (#10097)

**What this PR does / why we need it**:

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

Signed-off-by: Edward Welch <edward.welch@grafana.com>",52,63,1,1,"2018-04-16 10:25:39","1928.57"
"grafana/loki","8726033bfa3a25bc578559fefe379c920883ada7","slim-bean","2020-03-04 16:34:04","false","remove the read lines counter when the log file stops being tailed

Signed-off-by: Edward Welch <edward.welch@grafana.com>",116,22,0,1,"2018-04-16 10:25:39","683.51"
"grafana/loki","364226108a4327d47d4b2a05a62c6a21c8e55f1a","ashwanthgoli","2023-08-28 10:03:02","true","chore: fix flaky querytee proxy test (#10367)

**What this PR does / why we need it**:
`Test_ProxyEndpoint_SummaryMetrics` does not wait for `compareResponses`
call to finish which causes the test to fail as the expected metric
response does not match

this pr updates the test to wait for `responses_compared_total` to be
set to 1 before asserting `missingMetrics`

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [X] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [x] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",49,64,1,0,"2018-04-16 10:25:39","1958.23"
"grafana/loki","fda14ca1560f0ae68d6811730d2469ddf50ebb2e","thepalbi","2023-01-30 22:18:33","true","Re-license and export `pkg/ingester` WAL code to be used in Promtail's WAL (#8315)",80,57,1,0,"2018-04-16 10:25:39","1745.5"
"grafana/loki","73b97c246deb39b685129f7ea8c85d0ea6d05c11","periklis","2021-12-21 16:32:46","true","Provide saner default for loki-operator managed chunk_target_size (#4975)",243,44,0,1,"2018-04-16 10:25:39","1341"
"grafana/loki","e95d193acf1633a6ec33a328b8a4a3d844e8e5f9","KMiller-Grafana","2021-11-04 18:20:05","true","Docs: revise modes of operation section (#4646)",172,43,0,0,"2018-04-16 10:25:39","1294.08"
"grafana/loki","54bc2dc40ec6d0cedd912f2a3acd50a959770924","jeschkies","2022-02-01 09:05:53","true","Restart Docker target if stopped. (#5280)

Summary:
The Docker target would not reconnect to a container if it restarted and
kept the same ID. This should introduces a `startIfNotRunning` method
that will be called to restart scraping the container's logs.

Fixes #5259",276,45,0,1,"2018-04-16 10:25:39","1380.69"
"grafana/loki","82897832a2219e0656dcd04cbc0084a4d6317e95","Red-GV","2022-02-15 15:13:54","true","Cleaning up deploy-example-secret.sh (#5374)",288,46,0,1,"2018-04-16 10:25:39","1394.95"
"grafana/loki","2cd3633b23a4f72d04d1a49d16490e3edd093cbf","cyriltovena","2020-07-13 18:20:18","true","Add a tutorial to forward AWS ECS logs to Loki. (#2331)

* Add a tutorial to forward AWS ECS logs to Loki.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Remove GrafanaCloud api key, it has been also completely nuke just in case.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",118,27,0,1,"2018-04-16 10:25:39","817.83"
"grafana/loki","eb242f305dc3637375c97dd5e35e844fba33eb1e","MasslessParticle","2022-05-02 06:44:54","true","Add tailing metrics (#6059)

* Add tailing metrics

* fix test

* fix test",81,49,0,1,"2018-04-16 10:25:39","1476.85"
"grafana/loki","641c9ee48a5cac7c57f081a2b73c16d5a8c1953b","MasslessParticle","2023-09-18 18:21:48","true","Don't allow unbounded parallelism when downloading indices (#10634)

Index Gateways can stall when certain queries try to download tons of
indices because. `ErrGroup` needs an explicit limit set on it. This PR
sets the limit provisionally until a more configurable solution can be
introduced.

---------

Co-authored-by: Dylan Guedes <dylan.guedes@grafana.com>",39,65,1,1,"2018-04-16 10:25:39","1978.58"
"grafana/loki","c1e84b523eee44486e0e0119d9e5fa4ffa7414af","wapmorgan","2019-11-13 13:42:35","false","Update docker-driver Dockerfile: add tzdb (#1233)

Fix error ""invalid timestamp stage config: invalid location specified: unknown time zone Europe/Moscow"" when specifying `location` in [timestamp stage](https://github.com/grafana/loki/blob/master/docs/clients/promtail/stages/timestamp.md)",70,19,0,0,"2018-04-16 10:25:39","572.39"
"grafana/loki","cd02d6a478f3d20e88be7b03ec68b2ca84304816","DylanGuedes","2022-04-28 14:03:36","true","Add better observability to queryReadiness (#5946)

* Add two metrics to the IndexGateway.

- Add a new `query_readiness_duration_seconds` metric, that reports
  query readiness duration of a tablemanager/index gateway instance. We
  should use it later to report performance against the ring mode
- Add a new `usersToBeQueryReadyForTotal` metric, that reports number of
  users involved in the query readiness operation. We should use it
  later to correlate number of users with the query readiness duration.

* Remove `usersToBeQueryReadyForTotal`.

- It will report all users always for now, so it isn't too helpful the
  way it is.

* Rename metric help text to not mislead people.

* Log queryReadiness duration.

* Fix where log message and duration and triggered.

* Join users list in a single string.

- This is necessary since go-kit doesn't support array type.

* Tweak queryReadiness log messages.

- As suggested by Ed on
  https://github.com/grafana/loki/pull/5972#discussion_r859734129 and
  https://github.com/grafana/loki/pull/5972#discussion_r859736072

* Ensure queryReadinessDuration metric.

- It is redundant with a recently added log line.

* noop",120,48,0,1,"2018-04-16 10:25:39","1473.15"
"grafana/loki","05195f2e9b1634fa95617bc3bd0675e1921f0f64","calvinbui","2023-08-29 09:59:29","true","helm: add dnsConfig (#10339)

**What this PR does / why we need it**:

Adds dnsConfig value to Helm deployments and statefulsets

**Which issue(s) this PR fixes**:

N/A

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [ ] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [x] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

---------

Co-authored-by: Michel Hollands <42814411+MichelHollands@users.noreply.github.com>",48,64,1,0,"2018-04-16 10:25:39","1959.23"
"grafana/loki","3f3f4eda1dc4d608d83e73d3248569590bc626fb","ssncferreira","2022-08-19 12:47:01","true","Fix topk and bottomk operations with int <= 0 (#6937)

* Fix topk and bottomk operations with int <= 0

* Fix VectorAggregationExpr String method

* Update rangemapper_test expression

* Add tests

* Update CHANGELOG.md",82,52,0,0,"2018-04-16 10:25:39","1584.1"
"grafana/loki","295bc96cdb7ef1bb4e61a169ef91c85fd8ddb385","cstyan","2021-10-01 17:53:58","true","Minor fix to retention dashboard plus add links + selector copying (#4401)

dropdown to other dashboards.

Signed-off-by: Callum Styan <callumstyan@gmail.com>",138,41,0,1,"2018-04-16 10:25:39","1261.06"
"grafana/loki","0cb3994859baa725fb0f1eb964b3fd721de142ff","cstyan","2022-05-30 08:00:53","true","Memberlist related jsonnet (#6253)

* Add memberlist.libsonnet and modify loki services so we can set the port
when using memberlist for the ring.

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* Missed the + for the ruler ring config here.

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* Fix linting.

Signed-off-by: Callum Styan <callumstyan@gmail.com>",72,49,0,1,"2018-04-16 10:25:39","1504.9"
"grafana/loki","8dee5b950328564d44ea39bc54863d21a4169365","periklis","2022-04-12 15:45:22","true","operator: Update Loki operand to v2.5.0 (#5884)",319,48,0,1,"2018-04-16 10:25:39","1451.97"
"grafana/loki","ac6ace8dbdd77ee799ec637265fe24e2f79462fd","cyriltovena","2021-07-29 07:18:21","true","Make `ParseExternalKey` from the chunk package alloc free. (#4075)

```
~/go/src/github.com/grafana/loki main* ⇣
❯ benchcmp  before.txt after.txt2
benchmark                         old ns/op     new ns/op     delta
Benchmark_ParseExternalKey-16     569           415           -27.03%

benchmark                         old allocs     new allocs     delta
Benchmark_ParseExternalKey-16     2              0              -100.00%

benchmark                         old bytes     new bytes     delta
Benchmark_ParseExternalKey-16     96            0             -100.00%
```

This is a very hot function in Loki being used for every chunk reference we get from the index.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",100,39,0,1,"2018-04-16 10:25:39","1198.62"
"grafana/loki","492a17def1e151eb4bcd95083482f4ead48ff444","JensErat","2019-11-26 18:54:14","false","fluent-bit: sorted JSON and properly convert []byte to string (#1310)

* fluent-bit: fix variable spelling mistake

Signed-off-by: Jens Erat <email@jenserat.de>

* fluent-bit: sort JSON map

While developing another fix, I stumbled upon #1309 as a newly written
unit test (with multiple key-value pairs in a map) was flaky.

While JSON does not [strictly define an order on records in a map][RFC8259],
but practical operations with a logging tool pretty much require it
(although of course grep for JSON is jq, not grep...). Also, the key
value output format is already sorted.

Switching to sorted output in jsoniter is pretty easy. As of today, it
still has a [bug] though, for which I already provided a [fix]. I
propose accepting that rare case where invalid types can occur from
msgpack output (can this even happen?) and re-enable the failing test
case as soon as the upstream PR is merged.

[RFC8259]: https://tools.ietf.org/html/rfc8259#section-4
[bug]:     https://github.com/json-iterator/go/issues/388
[fix]:     https://github.com/json-iterator/go/issues/422

Signed-off-by: Jens Erat <email@jenserat.de>

* fluent-bit: properly convert []byte to string

Recently, a regression was introduced that no longer ran a deep
conversion of `[]byte` to `string` unless a label map was supplied. This
commit fixes this by running the string conversion recursively, also
removing the need of applying the conversion function again during label
map stage.

This change has two minor side effects:

- Some test cases had to be moved, as string conversion happens much
  earlier now.
- Invalid characters do not result in the whole label being ignored any
  more, but are replaced by the unicode placeholder character now. I'd
  consider this an improvement, making both debugging much easier (""why
  is that value suddenly missing?"") and preserving as much information
  as possible.

Signed-off-by: Jens Erat <email@jenserat.de>",82,19,0,0,"2018-04-16 10:25:39","585.6"
"grafana/loki","7158785a89a0d79d416c1aedbfb1c12bc7dd49d8","sandeepsukhani","2022-06-03 12:23:17","true","update loki-mixin json dashboards with latest jsonnet changes (#6306)",72,50,0,1,"2018-04-16 10:25:39","1508.08"
"grafana/loki","66bf9f6474950ebc8617359a0a55c1a8ac44317f","DylanGuedes","2022-01-19 09:26:48","true","Copy `cortex/tools/querytee` package dependency into Loki (#5165)

* Fork Cortex `tools/querytee`.

* Use forked querytee instead of Cortex one.

* Add `loki/tools` to list of possible paths.

* Add opts to querytee proxy.",267,45,0,1,"2018-04-16 10:25:39","1368.71"
"grafana/loki","bfd196aa66fbac3a136f266904106ebfb46d4952","MasslessParticle","2023-07-24 18:58:40","true","sort sort log volumes by size (#10045)

To save some frontend work, this PR sorts all the log volumes by volume
rather than name. For range queries, only the first value is used.",54,63,1,1,"2018-04-16 10:25:39","1924.61"
"grafana/loki","58474191fed9fb724cb1db17ac4bd6660ad289c1","slim-bean","2020-12-24 15:29:00","true","fix indentation and add helm repo url (#3102)",124,32,0,1,"2018-04-16 10:25:39","978.71"
"grafana/loki","299ba1ff44b7235973dda4f9048b4e4d3418b690","tomwilkie","2020-04-13 10:23:07","false","And the loki mixin",123,24,0,0,"2018-04-16 10:25:39","722.25"
"grafana/loki","32d4f6c97b7a77b38b95c7bc745f4aec451cba48","pracucci","2020-02-14 12:52:39","true","Increased production distributors memory request and limit (#1699)

Signed-off-by: Marco Pracucci <marco@pracucci.com>",119,22,0,0,"2018-04-16 10:25:39","663.35"
"grafana/loki","92ace838b35b3ecbbdd0f2cb40d653ab4195a27b","huikang","2020-10-12 10:31:16","true","Doc: fix broken links in production/README.md (#2702)

- point to the grafana/loki doc website

Signed-off-by: Hui Kang <kangh@us.ibm.com>",113,30,0,0,"2018-04-16 10:25:39","906.5"
"grafana/loki","1d1461824d03b13004ed918d89f76ae38acb9a3b","ssncferreira","2022-03-23 10:53:05","true","Move promtail StreamLagLabels config to upper level config.Config (#5686)

* Move promtail StreamLagLabels config to upper level config.Config

* Fix promtail config load test

* Fix promtail configuration reference

* Add options promtail config section

* Kick GitHub CI

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

Co-authored-by: Danny Kopping <danny.kopping@grafana.com>",310,47,0,0,"2018-04-16 10:25:39","1432.77"
"grafana/loki","b19ce6230a3fc627b8ac8cce8e1f9decc3f0b621","jeschkies","2022-02-11 07:46:45","true","Build and publish build image. (#5322)",282,46,0,1,"2018-04-16 10:25:39","1390.64"
"grafana/loki","691b8be6c74da1c55d17ebf8d0b004b3072b5a76","jeschkies","2022-11-29 16:06:52","true","Provide Terraform script for setting up S3 and document role based access. (#7656)

**What this PR does / why we need it**:
Role based access to S3 on an EKS cluster via service account annotation
was not documented well and let to some confusion. This change documents
how a role based accessis achieved with providing an AWS secret access
key and access key id. Thus there is no change of accidentally leaking
credentials.

A Terraform module is provided under `production/terraform/modules/s3`
that provisions and S3 bucket and IAM role and policy.

**Which issue(s) this PR fixes**:
Fixes #7279

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the `CONTRIBUTING.md` guide
- [x] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

Co-authored-by: Pablo Angulo <pablo.angulo@grafana.com>",95,55,1,1,"2018-04-16 10:25:39","1684.24"
"grafana/loki","0202884d2770c71d9f6432b14bbace2a753f843d","slim-bean","2020-02-12 16:52:55","false","Automatically prune metrics from the /metrics output of the promtail metrics pipeline stage after an idle period.

Signed-off-by: Edward Welch <edward.welch@grafana.com>",117,22,0,1,"2018-04-16 10:25:39","661.52"
"grafana/loki","c15048b50bc11a96ac6ba393ddc9c62d8784e960","dannykopping","2023-03-15 16:05:11","true","Retention: add selector detail to docs (#8808)

**What this PR does / why we need it**:
This adds more detail around what can and cannot be used in a `selector`
for retention. It was unclear whether arbitrary LogQL could be used or
not; this makes it explicit.

Also added some additional matchers to the examples to show that it can
be combinatorial.

---------

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>
Co-authored-by: J Stickler <julie.stickler@grafana.com>",88,59,1,1,"2018-04-16 10:25:39","1790.24"
"grafana/loki","940529984bd073e4625ea721a29e870dae97ff66","cyriltovena","2020-10-20 19:53:11","true","Handle panic in the store goroutine. (#2774)

* Adds logfmt, regexp and json logql parser

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* hook the ast with parsers.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* hook parser with memchunk.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* hook parser with the storage.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* hook parser with ingesters

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* fixes all tests

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Refactor to pipeline and implement ast parsing.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes the lexer for duration and range

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes all tests and add some for label filters

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add label and line format.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add tests for fmt label and line with validations.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Polishing parsers and add some more test cases

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Finish the unwrap parser, still need to add more tests

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Indent this hell.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Moar tests and it works.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add more tests which lead me to find a bug in the lexer

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add more tests and fix all engine tests

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes match stage in promtail pipelines.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Hook Pipeline into ingester, tailer and storage.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Correctly setup sharding for logqlv2

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes precedences issue with label filters and add moar tests :v:

* Adds quantile_over_time, grouping for non associate range aggregation parsing and moar tests

* Extract with grouping

* Adds parsing duration on unwrap

* Improve the lexer to support more common identifier as functions.

Also add duration convertion for unwrap.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes the frontend logs to include org_id.

The auth middleware was happening after the stats one and so org_id was not set :facepalm:.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Support byte sizes in label filters.

This patch extends the duration label filter with support for byte sizes
such as `1kB` and `42MiB`.

* Wip on error handling.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes json parser with prometheus label name rules.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* fixup! Support byte sizes in label filters.

* Wip error handling, commit before big refactoring.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Refactoring in progress.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Work in progress.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Got something that builds and throw __error__ labels properly now.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add error handling + fixes groupins and post filtering.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* 400 on pipeline errors.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes a races in the log pipeline.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Unsure the key is parsable and valid.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Cleanup and code documentation.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Lint.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Lint.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes frontend handler.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes old test.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fix go1.15 local failing test.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes race conditions in the batch iterator.

We should never advance an iterator in parallel. Unfortunately before the code was building iterators while advancing previous one, building iterator can advance iterator and thus creates a race condition. This changeset make sure we only fetch chunks in advance and build iterator and iterate over them in sequence.

Also add support for labels in the cacheIterator which is required for logqlv2.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Handle panic in the store goroutine.

This could cause Loki to crash if a panic happens in the store since it was happening in another goroutine.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

Co-authored-by: Karsten Jeschkies <k@jeschkies.xyz>",117,30,0,1,"2018-04-16 10:25:39","914.89"
"grafana/loki","070246c0a4279db76059ee37f666c215d92cf3f7","cyriltovena","2021-01-19 15:48:50","true","Uses custom json-iter decoder for log entries. (#3163)

* Uses custom json-iter decoder for log entries.

Previously we were using json.Unmarshal for each line. However json-iter uses a Pool for each calls and I believe this can cause to increase memory usage.

For each line we would put in a pool the iterator to re-use it, once put in a pool, the last data is retained, since we handle millions of lines, this can cause problem, using a custom extensions, keep using a pool but at the root object only, not for each line.

On top of that we're going to process that json payload 50% faster.

```
❯ benchcmp  before.txt after.txt2
benchmark                          old ns/op     new ns/op     delta
Benchmark_DecodePushRequest-16     13509236      6677037       -50.57%
benchmark                          old allocs     new allocs     delta
Benchmark_DecodePushRequest-16     106149         38719          -63.52%
benchmark                          old bytes     new bytes     delta
Benchmark_DecodePushRequest-16     10350362      5222989       -49.54%
```

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes query-tee tests.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",110,33,0,1,"2018-04-16 10:25:39","1003.72"
"grafana/loki","bc01964c624372a537aa7f8d308d35a9d91846a4","periklis","2023-07-28 08:17:03","true","tools: Add support for operator/v* tags (#10089)",51,63,1,1,"2018-04-16 10:25:39","1928.16"
"grafana/loki","43d9cc951a8f2ce1cb1d207a4e26b6f3b0490d8e","minhdanh","2019-09-07 01:51:51","false","Bump chart versions",118,17,0,0,"2018-04-16 10:25:39","505.89"
"grafana/loki","a63ad0650970b24242e52942f59ab1c67db06bf8","dannykopping","2022-11-28 08:13:11","true","Querier/Ruler: query blocker (#7785)

Block malicious or expensive queries using a per-tenant runtime configuration.",96,55,1,1,"2018-04-16 10:25:39","1682.91"
"grafana/loki","34486d4ba24a473668e98b4f79bb64272a0905d9","MichelHollands","2023-03-29 09:02:49","true","Change mention of 2.7.3 to 2.7.5 in Nomad (#8934)

**What this PR does / why we need it**:

Missed this in the previous PR.

**Checklist**
- [X] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",83,59,1,1,"2018-04-16 10:25:39","1803.94"
"grafana/loki","2133702661d8ad6cc342ad34daafbe26f3fd12e2","DylanGuedes","2023-09-22 19:19:37","true","Ingester: Change log line level and make jitter potentially longer. (#10689)

**What this PR does / why we need it**:
- Change our sleep log line from `level=debug` to `level=info` to allow
visibility of it without having to change the log line level of
distributors as a whole
- Make the flush jitter to be 20% of flush check period instead of 1%.
This means that, for the default 30s flush check period, the jitter will
be at most 6s.",34,65,1,1,"2018-04-16 10:25:39","1982.62"
"grafana/loki","37875968c76c31623bce51bf88e48494ac88ac5d","tarokkk","2019-11-11 16:26:32","false","fluentd: Suppress unread configuration warning (#1242)

* suppress unread configuration warning

* make client certificate optional",67,19,0,0,"2018-04-16 10:25:39","570.5"
"grafana/loki","71d526a23a256e957b3cc5a598298954b03a49c7","JStickler","2023-09-06 18:26:45","true","[Style updates] Capitalize Loki when referring to project. (#10462)

**What this PR does / why we need it**:
Went through and looked for places where Loki should be capitalized
because we are talking about the product or project (vs. in
configuration examples, etc. where lower case is acceptable or
required).",46,65,1,0,"2018-04-16 10:25:39","1966.58"
"grafana/loki","cb2b3ca9ea96bdd2f77c5f9acb94c071e9b42fa1","MasslessParticle","2023-07-10 22:36:35","true","Add limit to the series volume endpoint (#9833)

To protect index gateways, this PR adds a per-tenant limit to the
`series_volume` endpoint so the accumulation of series can't grow
without bound.",58,63,1,1,"2018-04-16 10:25:39","1910.76"
"grafana/loki","9762b314189fc4c2067073cbe21c77758c10f7aa","jeschkies","2021-11-09 12:20:24","true","Only execute benchmarks on main. (#4710)

* Only execute benchmarks on main.

* Remove condition.

* Update .drone/drone.jsonnet

* Generate .drone.yml.",189,43,0,1,"2018-04-16 10:25:39","1298.83"
"grafana/loki","2cb3c82cc8fade278f9182df03e716d7afc87ef2","rfratto","2019-10-03 15:59:22","false","pkg/ingester: prevent shutdowns from processing during joining handoff

This commit fixes a race condition where an ingester that is shut down
during the joining handoff (i.e., receiving chunks from a leaving
ingester before claiming its tokens) hangs and can never shut down
cleanly. A shutdown mutex is implemented which is obtained at the
start of the handoff process and released after the handoff process
completes. This race condition also prevented the leaving ingester from
completing its shutdown, since it waits for the joining ingester to
claim the tokens.

This means that if a brand new ingester is shut down, it will always
have finished receiving chunks from the previous leaving ingester and
have finished obtaining the tokens from the ingester attempting to
leave.",76,17,0,1,"2018-04-16 10:25:39","532.48"
"grafana/loki","ece1fb5a34c868ff6439aac90b4337ed77edc2e3","chaudum","2022-04-06 07:53:31","true","Allow promtail to push RFC5424 formatted syslog messages (#5715)

* Allow promtail to push RFC5424 formatted syslog messages

This PR introduces a new flag `use_rfc5424_message` for syslog scrape
targets, which allows to push the full
[RFC5424](https://datatracker.ietf.org/doc/html/rfc5424) formatted
syslog message received by Promtail to be pushed to Loki, instead of
only the message content.

Storing the full message allows users to parse the message in Loki
instead of relabelling in Promtail.

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* Add changelog entry

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* Add test for pushing RFC5424 messages

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* fixup! Allow promtail to push RFC5424 formatted syslog messages

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

Co-authored-by: Cyril Tovena <cyril.tovena@gmail.com>",322,47,0,1,"2018-04-16 10:25:39","1445.64"
"grafana/loki","d42e5a2ce9fe3b685021f429b21320cbda4f91d0","owen-d","2021-03-16 16:32:03","true","reduce replay flush threshold (#3496)",156,35,0,1,"2018-04-16 10:25:39","1060.75"
"grafana/loki","ad2260aec2d4d587c50a3dfb68d2c89ed2bf3157","DylanGuedes","2022-11-24 12:14:00","true","Loki: Fix multitenant querying (#7708)

**What this PR does / why we need it**:
We recently broke multitenant querying because of recent changes to how
timeouts working across Loki. This PR fixes this by:
- Adapt the timeout wrapper to work with multitenant queries. It will
take the shortest timeout across all given tenants
- Adapt the query engine timeout assigning to work with multitenant
queries. It will take the shortest timeout between all the tenants
- Adapt query sharding to use smallest max query parallelism across
given tenants
- Add a functional test to ensure multitenant is behaving as expected

Signed-off-by: DylanGuedes <djmgguedes@gmail.com>
Signed-off-by: Mehmet Burak Devecí <mhmtbrkdvc@gmail.com>

**Which issue(s) this PR fixes**:
https://github.com/grafana/loki/issues/7696

**Special notes for your reviewer**:
The regression was probably introduced by
https://github.com/grafana/loki/pull/7555",94,55,1,1,"2018-04-16 10:25:39","1679.08"
"grafana/loki","ac6e092f3ced41d3c8642093759ea73c1adccd19","kavirajk","2022-01-05 16:03:26","true","Remove `cortex/pkg/util/extract` dependency from Loki (#5049)

Copy only `extract.MetricNameMatcherFromMatchers`.

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",253,45,0,1,"2018-04-16 10:25:39","1354.98"
"grafana/loki","446502bad061233b69be637338cb73032e68247d","kavirajk","2023-09-21 07:58:21","true","docs/scripts: Update Loki OSS release guide (#10646)

**What this PR does / why we need it**:
Update Loki OSS release guide

This is based on the learnings from recent minor version release v2.9.0

Changes:
1. Update the release docs and organise it in a way it's usable for both
stable and patch release
2. Scripts updates

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added

---------

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>
Co-authored-by: github-actions[bot] <41898282+github-actions[bot]@users.noreply.github.com>",32,65,1,1,"2018-04-16 10:25:39","1981.15"
"grafana/loki","e67dd6c91d956035845d0783fcce6ec21f665e7f","kavirajk","2022-07-28 12:13:18","true","chore(groupcache): Support per cache group capacity (#6793)

* chore(groupcache): Make per cache group capacity

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Remove unwanted handler got merged during rebase

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Fix typo on the comment

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* PR remarks

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Some standard renaming

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",78,51,0,1,"2018-04-16 10:25:39","1563.07"
"grafana/loki","ce281e8ab13d12f2bad8d5b00f2e4a2c3c717138","MichelHollands","2023-01-03 09:26:00","true","Update build image and use in drone yaml (#8029)

**What this PR does / why we need it**:

Update the build image version to 0.26.
Use this in drone.yaml.

**Special notes for your reviewer**:
This uses the new test setup from
https://github.com/grafana/loki/pull/8022

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",99,56,1,1,"2018-04-16 10:25:39","1717.96"
"grafana/loki","0c071d8a79069f0cedfb9ead3da30cc6def2c56d","xperimental","2023-03-01 13:47:35","true","operator: Fix version inconsistency in generated OpenShift bundle (#8666)",70,58,1,1,"2018-04-16 10:25:39","1776.14"
"grafana/loki","6d48fb69427271b91dad402e04e2bba6b78a8620","slim-bean","2021-03-04 21:15:46","true","change ReadStringAsSlice to ReadString so it doesn't parse quotes inside the packed _entry (#3432)",141,34,0,1,"2018-04-16 10:25:39","1048.95"
"grafana/loki","92ba055ae527add41f21edb15a9fca1fcdc7ae32","shantanualsi","2023-08-29 14:07:05","true","Remove ruler.wal-cleaer.period (#10378)

The config with typo is now replaced by `-ruler.wal-cleaner.period`",48,64,1,0,"2018-04-16 10:25:39","1959.4"
"grafana/loki","9faa8bcf1dc819179bfc29d3d5d9a7d0878717c5","joe-elliott","2019-10-01 14:10:16","false","Go 1.13 (#1089)

Updated everything to 1.13

Signed-off-by: Joe Elliott <number101010@gmail.com>",73,17,0,0,"2018-04-16 10:25:39","530.41"
"grafana/loki","77fa7343684f420c9811a0b2e31b7d49c399730e","MasslessParticle","2022-07-11 09:02:54","true","Fix inconsistent coverage in the distributor package (#6645)",70,51,0,1,"2018-04-16 10:25:39","1545.94"
"grafana/loki","8da290cd2da099caebbcfee4cddc32d13119ec1f","osg-grafana","2022-08-25 16:05:22","true","Use backticks for code syntax. (#6967)

* Use backticks for code syntax.

* Fix for real. :)",83,52,0,0,"2018-04-16 10:25:39","1590.24"
"grafana/loki","705e16fbea3671ad0e0a280d4c39f3e6c4690573","trevorwhitney","2022-10-26 20:14:43","true","[helm] Fix included rules (#7430)

**What this PR does / why we need it**:
Adds the correct cluster label to our recording rules so they work
correctly in the included dashboards.

Co-authored-by: Karsten Jeschkies <k@jeschkies.xyz>",88,54,1,1,"2018-04-16 10:25:39","1651.41"
"grafana/loki","1671751cbdb24272920e35e9e8d2a80e51f55de9","paul1r","2023-05-08 12:59:29","true","Augment statistics to note how many bytes are in duplicate lines due to replicas (#9400)

**What this PR does / why we need it**:
This PR is for counting the number of bytes of log lines that were
marked as duplicates. This will be utilized to collect better
statistics.",81,61,1,0,"2018-04-16 10:25:39","1848.36"
"grafana/loki","691d27c8c75c8602e06662cbb06d146f54f0a837","slim-bean","2020-08-04 16:31:05","true","Update Loki build image (#2467)

* updating build-image version

* updating drone config

* updating a few other references to the build image",123,28,0,1,"2018-04-16 10:25:39","838.75"
"grafana/loki","5e5e638b664858e25fb804121c06e87f3d4b098e","bt909","2021-06-22 13:34:36","true","Add memcached_client parameter option (#3799)

Parameter addresses is tested with AWS ElastiCache memcached and works, this parameter is taken from cortex documentation",104,38,0,0,"2018-04-16 10:25:39","1161.88"
"grafana/loki","ec541d70e953be5cd5c6fa5b62c8e41c67eb7099","MichelHollands","2022-10-21 08:38:21","true","Add envFrom to the tokengen job (#7479)

Add an envFrom section to the tokengen job.
Fixes https://github.com/grafana/loki/issues/7411
Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",94,54,1,1,"2018-04-16 10:25:39","1645.93"
"grafana/loki","8b9443943411b2725a19987de8135d9cc2ffb8e3","vlad-diachenko","2023-10-10 06:35:08","true","Bloom Shipper (#10806)

implemented bloom shipper that allows to iterates over all active blocks
This new component will be used by the bloom-compactor and
bloom-gateway.

#### How BloomShipper works
1. looks up all Metas
2. from metas gets list of all blocks
3. from metas gets list of tombstones
4. removes tombstoned blocks from the list of all blocks
5. passes all active blockReferences to bloomClient
6. once bloomClient returns the downloaded block, it extracts all files
from bloom block archive into working directory
7. creates `*BlockQuerier` and run a callback function with it
**Note:** `BlockQuerier` will be created using `BloomDirectoryReader`
that will be created using the past from step #6

---------

Signed-off-by: Vladyslav Diachenko <vlad.diachenko@grafana.com>",25,66,1,0,"2018-04-16 10:25:39","2000.09"
"grafana/loki","97ee1b93f342d9e9d104374e9a0f2a5ec64ca14b","cstyan","2022-06-09 06:01:57","true","[logql] don't try to execute a modified function that is not allowed by the AST (#6346)

* Panic with an actual error if clone (which calls range aggregation
expr's validate) errors, instead of swallowing the error and then
attempting to execute a nil function, which panics anyways.

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* Call the validation function on a modified expression before attempting
to execute it. If the validation fails we should return the original
expression.

Signed-off-by: Callum Styan <callumstyan@gmail.com>",73,50,0,1,"2018-04-16 10:25:39","1513.82"
"grafana/loki","42bfc22d2353e7e2feb2f5c3070c5eef3b4c921a","thepalbi","2022-09-23 18:53:35","true","Fix promtail `metric` stage causing failure when getting extracted metrics (#7216)

**What this PR does / why we need it**:
Promtail allows ingested log entries to be modified before pushing them
to Loki with the use of pipelines. One of the available pipeline
""stages"" is called `metrics`, and allows extracting metrics from
incoming logs. These metrics are labeled with the labels available in
the processed `Entry`. There's some edge cases in which if either a
entry label is invalid, or it starts with the prometheus internal label
prefix, `__`, calling the promtail `/metrics` fails.

One way to easily reproduce this is by having the following
configuration:
```yaml
pipeline_stages:
- static_labels:
    good_label: ""1""
- tenant:
    value: ""2""
- metrics:
    loki_count:
      type: Counter
      description: ""should count all entries""
      config:
        match_all: true
        action: inc
```
Which exposes a `promtail_custom_loki_count` metrics that counts
processed log entries. In this case, the step before the `metrics` one
injects an internal label `__tenant_id__` to be used by the remote write
client. Since this label starts with the prometheus reserved prefix,
this will make calling the `metrics` endpoint fail with an error like
the following:
```
An error has occurred while serving metrics:

1 error(s) occurred:
* ""__tenant_id__"" is not a valid label name for metric ""promtail_custom_loki_count""
```

This PR attempts to fix that by, before creating the corresponding
metrics, dropping invalid or internal labels. That way promtail will
just use labels that are valid.

**Which issue(s) this PR fixes**:
Related to https://github.com/grafana/cloud-onboarding/issues/2067

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the `CONTRIBUTING.md` guide
- [ ] Documentation added
- [x] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",87,53,1,0,"2018-04-16 10:25:39","1618.35"
"grafana/loki","62d91635b2dbea5551c110d665afc07d5c019d09","daixiang0","2019-04-10 07:08:36","false","Add help info for users uses high k8s version

Signed-off-by: Xiang Dai <764524258@qq.com>",99,12,0,0,"2018-04-16 10:25:39","353.86"
"grafana/loki","44f8dc3e469e40c8274343ff88cfedcb755f8acd","slim-bean","2020-08-12 00:28:00","true","enable the MustExist flag when starting a tailer on a fail, this will cause the tail to fail fast and allow promtail to attempt to re-open the file. (#2491)",120,28,0,1,"2018-04-16 10:25:39","846.08"
"grafana/loki","aae13c376d86991fb05cc1f9bbfb346b761981c8","salvacorts","2023-07-13 07:13:43","true","Add metadata to push payload (#9694)

**What this PR does / why we need it**:
We are adding support for attaching labels to each log line. This is one
of the series of the PRs broken up to make it easier to review changes.

This PR updates the push payload to send labels with each log entry
optionally. The log labels are supposed to be in the same format as the
stream labels. Just to put it out, here is how it would look for proto
and json push payload with same data:

**proto(`endpoint`: `(/loki/api/v1/push|/api/prom/push)`,
`Content-Type`: `application/x-protobuf`)**(payload built using
[push.Stream](https://github.com/grafana/loki/blob/4cd1246b8830ccc241fa4afff85d208dc6ae2129/pkg/push/types.go#L12)):
```
push.Stream{
	Entries: []logproto.Entry{
			{
				Timestamp: time.Unix(0, 1688515200000000000),
				Line:      ""log line"",
				Labels:    `{foo=""bar""}`,
			},
	},
	Labels: `{app=""test""}`,
}
```

**v1(`endpoint`: `/loki/api/v1/push`, `Content-Type`:
`application/json`)**:
```json
{
    ""streams"": [{
        ""stream"": {
            ""app"": ""test""
        },
        ""values"": [
            [""1688515200000000000"", ""log line"", {
                ""foo"": ""bar""
            }]
        ]
    }]
}
```
**legacy-json(`/api/prom/push`, `Content-Type`: `application/json`)**:
```json
{
    ""streams"": [{
        ""labels"": ""{app=\""test\""}"",
        ""entries"": [{
                ""ts"": ""2023-07-05T00:00:00.000000000Z"",
                ""line"": ""log line"",
                ""labels"": ""{foo=\""bar\""}""
            }]
    }]
}
```
**Which issue(s) this PR fixes**:

**Special notes for your reviewer**:

We may need to add more thoughtful tests.

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [x] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

---------

Co-authored-by: Sandeep Sukhani <sandeep.d.sukhani@gmail.com>",60,63,1,1,"2018-04-16 10:25:39","1913.12"
"grafana/loki","86fbdc08702a28d95d0d179e3ec504f87defbd94","daixiang0","2018-12-14 10:15:19","false","update README (#106)

- make doc more understandable
- add `-d` for `docker run` to support run in the backgroud

Signed-off-by: Xiang Dai <764524258@qq.com>",28,8,0,0,"2018-04-16 10:25:39","237.99"
"grafana/loki","17657ab06802d2c5a4269cca5b5d0bebb19ada35","ldb","2022-03-01 10:35:53","true","Changelog: Include #5409 (#5480)",300,46,0,0,"2018-04-16 10:25:39","1410.76"
"grafana/loki","f9b0ef33c068b08b83593f3809e4a07c0431ca11","KMiller-Grafana","2021-08-05 20:31:43","true","Mark recording rules as an experimental feature. (#4105)",102,40,0,0,"2018-04-16 10:25:39","1205.17"
"grafana/loki","461f844044048df3160b209b66596072fd3d3e23","liguozhong","2022-09-13 14:22:18","true","[bugfix] fix query_frontend init fail error (#7013)


Co-authored-by: Ashwanth <iamashwanth@gmail.com>",88,53,1,1,"2018-04-16 10:25:39","1608.16"
"grafana/loki","a99c73dd97bf55d912d391339a7b82acccabf915","JStickler","2023-04-18 07:01:11","true","Update weights for Helm Charts topics (#9169)",83,60,1,0,"2018-04-16 10:25:39","1828.11"
"grafana/loki","c58eacfc3695b06c8a55c5e12ae08aee46e4ce3e","pracucci","2019-07-15 12:33:26","false","Added a note about regex accepted syntax in the filter expression (#746)",100,15,0,0,"2018-04-16 10:25:39","454.34"
"grafana/loki","8868957783b7fb5aa1384d57b4584f19ee256999","MichelHollands","2022-09-30 16:02:01","true","Log delete request ID upon creation (#7307)

Log the request ID when a new delete request is created. 

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",91,53,1,1,"2018-04-16 10:25:39","1625.23"
"grafana/loki","dda698ea9dbc5db0ddc2fb063652f986ff388ba9","MichelHollands","2023-11-01 09:37:37","true","Update the helm-chart-testing action in the CI (#11101)

**What this PR does / why we need it**:

The previous version no longer installs.

**Special notes for your reviewer**:

**Checklist**
- [X] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)
- [ ] If the change is deprecating or removing a configuration option,
update the `deprecated-config.yaml` and `deleted-config.yaml` files
respectively in the `tools/deprecated-config-checker` directory.
[Example
PR](https://github.com/grafana/loki/pull/10840/commits/0d4416a4b03739583349934b96f272fb4f685d15)

Signed-off-by: Michel Hollands <michel.hollands@gmail.com>",16,66,1,1,"2018-04-16 10:25:39","2021.22"
"grafana/loki","c0bec07e0de1a23cb72e883406918fef5a65dc04","DylanGuedes","2022-01-05 13:25:34","true","Loki: Implement common net interface/instance addr (#4950)

* Implement common net interface/instance addr.

- Implement two new common configurations: instance_interface_names,
  which is a list of net interfaces used to discover addresses and
  instance_addr, used to advertise a component address.

* Add docs to new common configurations.

* Fix lint issue: missing line.

* Add missing CHANGELOG entry.

* Change default common net interface from `127.0.0.1` to `""""`.

* Add missing `InstanceAddr` docstring.",252,45,0,1,"2018-04-16 10:25:39","1354.87"
"grafana/loki","287244d110554984406d32013fc2127ab8c10f36","jeschkies","2021-02-01 11:43:31","true","Update vendored Cortex to 0976147451ee (#3267)",124,33,0,1,"2018-04-16 10:25:39","1015.55"
"grafana/loki","688056b9a7dc90abbd0579e169252dc801e06d4d","slim-bean","2019-07-17 20:52:23","true","Merge pull request #772 from grafana/loki-canary

moving loki-canary project under loki repo",101,15,0,1,"2018-04-16 10:25:39","456.69"
"grafana/loki","25c4b4ce35acbb9cf102f71324fa4ea7ec81b29a","slim-bean","2023-05-04 08:51:47","true","Update docs to make file rotation support clearer (#9391)",81,61,1,1,"2018-04-16 10:25:39","1844.18"
"grafana/loki","1124fe552d5cc4fd668eeb91b36205e37b72fc1d","slim-bean","2019-03-06 01:04:21","false","adding some docs on how to identify and connect to a promtail pod for troubleshooting",88,11,0,1,"2018-04-16 10:25:39","319.61"
"grafana/loki","de38da69bc26313132e9b59d459e240450623e94","jdbaldry","2023-01-20 11:29:15","true","Update doc-validator to latest release (#8221)",83,57,1,0,"2018-04-16 10:25:39","1735.04"
"grafana/loki","15d417efe1031fb50d985404b6d4ba7fee6a1051","cyriltovena","2021-05-20 07:24:47","true","Replace satori.uuid with gofrs/uuid (#3743)

* Replace satori.uuid with gofrs/uuid

Fixes #3742

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fix new import.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",201,37,0,1,"2018-04-16 10:25:39","1129.62"
"grafana/loki","e9f5de48bcc90c8767787c18acbb462e730db400","irizzant","2022-08-15 18:24:51","true","fix(consul): allow consul deployment (#6888)

Signed-off-by: irizzant <i.rizzante@gmail.com>

Signed-off-by: irizzant <i.rizzante@gmail.com>",83,52,0,0,"2018-04-16 10:25:39","1580.33"
"grafana/loki","4c8199ec211b97cbebce270db60f71ba4edefe84","cyriltovena","2020-06-02 11:37:12","true","Validate local storage config for the logcli (#2126)

* Allows to pass inlined pipeline stages to the docker driver.

Fixes #1296

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add validation before using storage config for the logcli.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",126,26,0,1,"2018-04-16 10:25:39","776.55"
"grafana/loki","3732814d0ef6b6f3220da485352a692008ca8ead","daixiang0","2019-03-30 03:31:14","false","fix typo

Signed-off-by: Xiang Dai <764524258@qq.com>",93,11,0,0,"2018-04-16 10:25:39","343.71"
"grafana/loki","b389e440e894544e07288de6f06db17797a751d4","daixiang0","2019-06-19 02:11:52","false","Fix helm test error

Signed-off-by: Xiang Dai <764524258@qq.com>",84,14,0,0,"2018-04-16 10:25:39","427.91"
"grafana/loki","e78941f9743d5b7b8471d83d45b1fa4ed78b9ed4","09jvilla","2023-09-28 17:49:43","true","Remove that the Ruler WAL is a coming soon feature (#10732)

Based on what we have written here:

https://grafana.com/docs/loki/latest/operations/recording-rules/#write-ahead-log-wal

A WAL for the Loki Ruler already has been implemented, so lets no longer
leave it as a ""future improvement""",29,65,1,0,"2018-04-16 10:25:39","1988.56"
"grafana/loki","92c7bb5513bf6fc7bb21ff53e29692626fbf87df","nileshcs","2021-01-04 14:48:49","true","Update docs for downstream_url (#3109)",110,32,0,0,"2018-04-16 10:25:39","988.68"
"grafana/loki","163fd9d8afe862a201fb4e3b3408ee7564b49f1d","MasslessParticle","2023-03-28 18:35:52","true","Short circuit parsing when label matchers are present (#8890)

This PR makes parsers aware of any downstream label-matcher stages at
parse time. As labels are parsed, if one has a matcher, the matcher is
checked at parse time. If the label does not match it's matcher, parsing
is halted on that log line.

**ex 1:**
consider the log:
`foo=1 bar=2 baz=3`

And the query
`{} | logfmt | bar=3`

When `bar` is parsed it is immediately checked against it's matcher. The
match fails so we the parser never spends time parsing the rest of the
line.

**ex 2:**
consider the log:
`foo=1 baz=3 bletch=4`

And the query
`{} | logfmt | bar=3`

`bar` is never seen in the log so the whole line is parsed.

**Benchmarks:**
```
                                                   │ parsers__old_2.txt │          parsers__new_3.txt          │
                                                   │       sec/op       │    sec/op     vs base                │
_Parser/json/inline_stages-8                              3413.5n ±  5%    766.4n ± 4%  -77.55% (p=0.000 n=10)
_Parser/jsonParser-not_json_line/inline_stages-8           101.5n ±  6%    103.1n ± 8%        ~ (p=0.645 n=10)
_Parser/unpack/inline_stages-8                             383.8n ±  4%    388.0n ± 9%        ~ (p=0.954 n=10)
_Parser/unpack-not_json_line/inline_stages-8               13.30n ±  2%    13.11n ± 1%        ~ (p=0.247 n=10)
_Parser/logfmt/inline_stages-8                            2105.5n ± 16%    727.7n ± 4%  -65.44% (p=0.000 n=10)
_Parser/regex_greedy/inline_stages-8                       4.220µ ±  4%    4.175µ ± 4%        ~ (p=0.739 n=10)
_Parser/regex_status_digits/inline_stages-8                319.8n ±  5%    326.4n ± 8%        ~ (p=0.481 n=10)
_Parser/pattern/inline_stages-8                            185.2n ±  7%    154.2n ± 3%  -16.74% (p=0.000 n=10)

                                                   │ parsers__old_2.txt │          parsers__new_3.txt          │
                                                   │        B/op        │    B/op     vs base                  │
_Parser/json/inline_stages-8                              280.00 ± 0%     64.00 ± 0%  -77.14% (p=0.000 n=10)
_Parser/jsonParser-not_json_line/inline_stages-8           16.00 ± 0%     16.00 ± 0%        ~ (p=1.000 n=10) 
_Parser/unpack/inline_stages-8                             80.00 ± 0%     80.00 ± 0%        ~ (p=1.000 n=10) 
_Parser/unpack-not_json_line/inline_stages-8               0.000 ± 0%     0.000 ± 0%        ~ (p=1.000 n=10) 
_Parser/logfmt/inline_stages-8                            336.00 ± 0%     74.00 ± 0%  -77.98% (p=0.000 n=10)
_Parser/regex_greedy/inline_stages-8                       193.0 ± 1%     192.0 ± 1%        ~ (p=0.656 n=10)
_Parser/regex_status_digits/inline_stages-8                51.00 ± 0%     51.00 ± 0%        ~ (p=1.000 n=10) 
_Parser/pattern/inline_stages-8                           35.000 ± 0%     3.000 ± 0%  -91.43% (p=0.000 n=10)

                                                   │ parsers__old_2.txt │          parsers__new_3.txt          │
                                                   │     allocs/op      │ allocs/op   vs base                  │

_Parser/json/inline_stages-8                              18.000 ± 0%     4.000 ± 0%  -77.78% (p=0.000 n=10)
_Parser/jsonParser-not_json_line/inline_stages-8           1.000 ± 0%     1.000 ± 0%        ~ (p=1.000 n=10) 
_Parser/unpack/inline_stages-8                             4.000 ± 0%     4.000 ± 0%        ~ (p=1.000 n=10) 
_Parser/unpack-not_json_line/inline_stages-8               0.000 ± 0%     0.000 ± 0%        ~ (p=1.000 n=10) 
_Parser/logfmt/inline_stages-8                            16.000 ± 0%     6.000 ± 0%  -62.50% (p=0.000 n=10)
_Parser/regex_greedy/inline_stages-8                       2.000 ± 0%     2.000 ± 0%        ~ (p=1.000 n=10) 
_Parser/regex_status_digits/inline_stages-8                2.000 ± 0%     2.000 ± 0%        ~ (p=1.000 n=10) 
_Parser/pattern/inline_stages-8                            2.000 ± 0%     1.000 ± 0%  -50.00% (p=0.000 n=10)
```

---------

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>",83,59,1,1,"2018-04-16 10:25:39","1803.34"
"grafana/loki","af68dbc6cf1e82afb6a09307a5d18807ade49dc6","MasslessParticle","2022-11-04 19:20:51","true","Keep rates in the ratestore for 10 minutes  (#7599)

This PR accounts for intermittent streams that might get dropped on a
per-second update interval

Co-authored-by: Dylan Guedes <djmgguedes@gmail.com>",89,55,1,1,"2018-04-16 10:25:39","1659.37"
"grafana/loki","50f838df903e44019c600582f11a62df02b42196","periklis","2023-10-05 07:46:03","true","operator: Allow SSE settings in S3 object storage secret (#10717)

Co-authored-by: Robert Jacob <xperimental@solidproject.de>",26,66,1,1,"2018-04-16 10:25:39","1995.14"
"grafana/loki","51987212484910979607b981e04b4ffd828cc829","periklis","2021-12-16 15:30:56","false","Switch API group from openshift.io to grafana.com",233,44,0,1,"2018-04-16 10:25:39","1335.96"
"grafana/loki","fcef755212407722d995e013ad689c6464b3c83b","MichelHollands","2023-10-27 14:37:14","true","Update GEL ksonnet to latest Loki version (#11068)

**What this PR does / why we need it**:

This PR updates the GEL config to use the latest Loki config so some
removed settings are no longer present. This is causing a problem in a
test environment.

**Checklist**
- [X] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)
- [ ] If the change is deprecating or removing a configuration option,
update the `deprecated-config.yaml` and `deleted-config.yaml` files
respectively in the `tools/deprecated-config-checker` directory. <!--
TODO(salvacorts): Add example PR -->

Signed-off-by: Michel Hollands <michel.hollands@gmail.com>",17,66,1,1,"2018-04-16 10:25:39","2017.42"
"grafana/loki","a1387c78c71498e9017ce508e47816d007497475","periklis","2023-10-17 08:04:52","true","operator: Update Loki operand to v2.9.2 (#10924)",23,66,1,1,"2018-04-16 10:25:39","2007.15"
"grafana/loki","e2ed1c01d484d8ba5a75a9379a075fb92b6960f2","xperimental","2023-10-05 16:49:35","true","operator: Update tools and dependencies (#10795)",26,66,1,1,"2018-04-16 10:25:39","1995.52"
"grafana/loki","9e89e8d6e24265395103e2bf7f99e7727114eebe","jeschkies","2023-09-26 10:26:01","true","Check for nil StepResult. (#10704)",33,65,1,1,"2018-04-16 10:25:39","1986.25"
"grafana/loki","cffcb468f272b1c4cdc0184316347d57553d737d","trevorwhitney","2022-08-26 20:32:24","true","Remove deprecated helm chart source code (#6978)

**What this PR does / why we need it**:

All of these helm charts have been moved out of this repo to `grafana/helm-charts`. As we are now moving `grafana/loki` back into this repo, this deprecated charts are confusing. I have opted to include `README`s with the deprecation notice, as well as a link to the current sha of `main` so that people can easily find the old source code.",81,52,0,1,"2018-04-16 10:25:39","1591.42"
"grafana/loki","8e6a5433ac2cb18706c58336174b35bcc95dcce5","charleskorn","2023-08-14 11:52:26","true","Upgrade dskit and remove dependency on weaveworks/common (#10220)

**What this PR does / why we need it**:

This PR upgrades `github.com/grafana/dskit` removes Loki's dependency on
`github.com/weaveworks/common`.

The changes in dskit, apart from the migration
(https://github.com/grafana/dskit/pull/356), are:

* https://github.com/grafana/dskit/pull/347 
* https://github.com/grafana/dskit/pull/349, which required small
changes in `pkg/canary/reader/reader.go` and `pkg/canary/writer/push.go`
* https://github.com/grafana/dskit/pull/352
* https://github.com/grafana/dskit/pull/354

**Which issue(s) this PR fixes**:

(none)

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [n/a] Documentation added
- [n/a] Tests updated
- [n/a] `CHANGELOG.md` updated
- [n/a] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [n/a] Changes that require user attention or interaction to upgrade
are documented in `docs/sources/setup/upgrade/_index.md`
- [n/a] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

---------

Co-authored-by: Michel Hollands <42814411+MichelHollands@users.noreply.github.com>",53,64,1,0,"2018-04-16 10:25:39","1944.31"
"grafana/loki","20bf7a7a8a27b74f5e3a9fd808c9dada967633c9","kavirajk","2023-08-15 10:13:19","true","dependabot: Re-enable `auto-merge`. (#10244)

**What this PR does / why we need it**:
I reverted back auto merge, because of permission issues with ""who"" can
push to the repo.

After some internal discussion, we decided to use `grafanabot` for
enabling auto-merge. This PR does that.

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",53,64,1,1,"2018-04-16 10:25:39","1945.24"
"grafana/loki","611481b6cfaff4b7454ea655e3543026778a9927","charleskorn","2023-08-15 06:19:03","true","Upgrade dskit (#10249)",53,64,1,0,"2018-04-16 10:25:39","1945.08"
"grafana/loki","8ca1d1e0a4c43b6cc22bdbee85d64d4cca8330c4","slim-bean","2023-08-08 12:14:29","true","Loki: simplify the FetchChunks method and optimize the experimental l2 cache a little more (#10160)

**What this PR does / why we need it**:

This started as a simple PR to optimize the new L2 chunks cache code
such that we don't look up chunks in L1 that we know won't be there,
however, the complexity of the FetchChunks method taking both a slice of
requested Chunks as well as a slice of requested Keys made this really
challenging.

Looking at how we use this method, I saw no reason for there to be a
requirement to pass both a list of chunks and keys, we only ever want
the Chunks and everywhere we used this we were generating the list of
keys external to this function from the list of chunks being passed in.

The second change was to the implementation of how we process the cache
results to look for found vs missing keys. The current implementation
required the chunks to be sorted by external key so that it could
iterate through them, I tested out a different version of this which
uses a map instead of sorting and iterating.

The map performance was slightly better in terms of reduced allocations,
not enough to make a meaningful difference, but I think this code is
easier to understand and reason about, and it removes any requirement
for sorting of the passed in Chunks by External key.

Benchmarks:

Previous:
```
100 chunks
❯ go test -bench=Fetch -count=5
goos: linuxbench=Fetch -count=5                                                                                                                                                                                                                                                         ─╯
goarch: amd64
pkg: github.com/grafana/loki/pkg/storage/chunk/fetcher
cpu: AMD Ryzen 9 5950X 16-Core Processor            
BenchmarkFetch-32           3445            334642 ns/op          478074 B/op       7536 allocs/op
BenchmarkFetch-32           2947            344439 ns/op          478534 B/op       7537 allocs/op
BenchmarkFetch-32           3489            339239 ns/op          478092 B/op       7536 allocs/op
BenchmarkFetch-32           3523            340550 ns/op          478003 B/op       7536 allocs/op
BenchmarkFetch-32           2935            346810 ns/op          478590 B/op       7537 allocs/op
PASS
ok      github.com/grafana/loki/pkg/storage/chunk/fetcher       23.948s

1000 chunks
❯ go test -bench=Fetch -count=5
goos: linuxbench=Fetch -count=5                                                                                                                                                                                                                                                         ─╯
goarch: amd64
pkg: github.com/grafana/loki/pkg/storage/chunk/fetcher
cpu: AMD Ryzen 9 5950X 16-Core Processor            
BenchmarkFetch-32            363           3225519 ns/op         5305481 B/op      78133 allocs/op
BenchmarkFetch-32            358           3308456 ns/op         5308299 B/op      78143 allocs/op
BenchmarkFetch-32            336           3379067 ns/op         5322534 B/op      78191 allocs/op
BenchmarkFetch-32            357           3330118 ns/op         5308854 B/op      78145 allocs/op
BenchmarkFetch-32            349           3390415 ns/op         5313813 B/op      78162 allocs/op
PASS
ok      github.com/grafana/loki/pkg/storage/chunk/fetcher       25.607s

10,000 chunks
❯ go test -bench=Fetch -count=5
goos: linuxbench=Fetch -count=5                                                                                                                                                                                                                                                         ─╯
goarch: amd64
pkg: github.com/grafana/loki/pkg/storage/chunk/fetcher
cpu: AMD Ryzen 9 5950X 16-Core Processor            
BenchmarkFetch-32              3         334471200 ns/op        639282104 B/op   2630192 allocs/op
BenchmarkFetch-32              2         503434741 ns/op        922833480 B/op   3412973 allocs/op
BenchmarkFetch-32              1        1064668769 ns/op        1771502096 B/op  5741173 allocs/op
BenchmarkFetch-32              1        1027755910 ns/op        1771419128 B/op  5749049 allocs/op
BenchmarkFetch-32              1        1027270578 ns/op        1774711872 B/op  5752726 allocs/op
PASS
ok      github.com/grafana/loki/pkg/storage/chunk/fetcher       23.251s
```

Now
```
100 chunks
❯ go test -bench=Fetch -count=5
goos: linuxbench=Fetch -count=5                                                                                                                                                                                                                                                         ─╯
goarch: amd64
pkg: github.com/grafana/loki/pkg/storage/chunk/fetcher
cpu: AMD Ryzen 9 5950X 16-Core Processor            
BenchmarkFetch-32           3856            300569 ns/op          462932 B/op       6214 allocs/op
BenchmarkFetch-32           4016            305387 ns/op          462803 B/op       6214 allocs/op
BenchmarkFetch-32           3382            303078 ns/op          463201 B/op       6215 allocs/op
BenchmarkFetch-32           3319            303367 ns/op          463308 B/op       6215 allocs/op
BenchmarkFetch-32           3289            356986 ns/op          463341 B/op       6215 allocs/op
PASS
ok      github.com/grafana/loki/pkg/storage/chunk/fetcher       22.879s

10,000 chunks
❯ go test -bench=Fetch -count=5
goos: linuxbench=Fetch -count=5                                                                                                                                                                                                                                                         ─╯
goarch: amd64
pkg: github.com/grafana/loki/pkg/storage/chunk/fetcher
cpu: AMD Ryzen 9 5950X 16-Core Processor            
BenchmarkFetch-32            393           2641470 ns/op         5193282 B/op      65956 allocs/op
BenchmarkFetch-32            433           2684287 ns/op         5174832 B/op      65894 allocs/op
BenchmarkFetch-32            427           2778092 ns/op         5177334 B/op      65902 allocs/op
BenchmarkFetch-32            418           2714370 ns/op         5181193 B/op      65915 allocs/op
BenchmarkFetch-32            415           2822163 ns/op         5183436 B/op      65920 allocs/op
PASS
ok      github.com/grafana/loki/pkg/storage/chunk/fetcher       25.053s

10,000 chunks
❯ go test -bench=Fetch -count=5
goos: linuxbench=Fetch -count=5                                                                                                                                                                                                                                                         ─╯
goarch: amd64
pkg: github.com/grafana/loki/pkg/storage/chunk/fetcher
cpu: AMD Ryzen 9 5950X 16-Core Processor            
BenchmarkFetch-32              3         362233430 ns/op        638097202 B/op   2510070 allocs/op
BenchmarkFetch-32              2         611639304 ns/op        921128060 B/op   3292828 allocs/op
BenchmarkFetch-32              1        1022180867 ns/op        1770465496 B/op  5621431 allocs/op
BenchmarkFetch-32              1        1253448115 ns/op        1771278456 B/op  5630224 allocs/op
BenchmarkFetch-32              1        1189564672 ns/op        1774053064 B/op  5628113 allocs/op
PASS
ok      github.com/grafana/loki/pkg/storage/chunk/fetcher       23.960s
```

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

---------

Signed-off-by: Edward Welch <edward.welch@grafana.com>",54,64,1,1,"2018-04-16 10:25:39","1938.33"
"grafana/loki","67002f34653bf56e4516340ee9bdbeb669eb4ae3","trevorwhitney","2023-08-09 20:09:33","true","Add per pod latency plot to reads dashboard (#10194)

This PR adds a Per Pods P99 Latency plot to each row of the Loki/Reads
dashboard.",52,64,1,1,"2018-04-16 10:25:39","1939.66"
"grafana/loki","a05744a385167e994f8d8812b0c2649c2321e5fd","trevorwhitney","2023-08-31 23:17:57","true","Enable results cache for volume queries (#10403)

This PR enables the results cache for volume queries to the
`index/volume` and `index/volume_range` endpoints",45,64,1,1,"2018-04-16 10:25:39","1961.79"
"grafana/loki","57c3a704b873cc13373fcadad31040c74b77bd18","trevorwhitney","2022-10-25 17:57:11","true","Few small changelog changes (#7460)

A few small fixes to changelog. Removed one entry that was just about
updating docs, and reorganized a few others to the correct section.",89,54,1,1,"2018-04-16 10:25:39","1650.31"
"grafana/loki","a9daddeeb9b7cd25431d56847874885aa0927c7d","jcantrill","2022-09-29 17:35:43","true","operator: Enable subscriptions on OpenShift 4.12 (#7296)",92,53,1,0,"2018-04-16 10:25:39","1624.3"
"grafana/loki","416e01ca8e8f6e606135ea7b18f9db3393345ede","vlad-diachenko","2023-07-21 12:33:33","true","[promtail] non_indexed_labels stage (#9986)

**What this PR does / why we need it**:

added non_indexed_labels stage to copy values from extracted data
tonon-indexed-labels field of the Entry.


**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

---------

Signed-off-by: Vladyslav Diachenko <vlad.diachenko@grafana.com>",55,63,1,0,"2018-04-16 10:25:39","1921.34"
"grafana/loki","85c6a436a7a7d3c4fdce67969419865e2f651997","MichelHollands","2023-07-21 07:41:38","true","New build image for release branches (#9997)

**What this PR does / why we need it**:
Loki build image with go 1.20.6 and previous version of golangci.

**Which issue(s) this PR fixes**:
See the Included README.md

---------

Signed-off-by: Michel Hollands <michel.hollands@gmail.com>",58,63,1,1,"2018-04-16 10:25:39","1921.14"
"grafana/loki","8ed5dd84aef0e1f6b9ae4c296d741747af5644d1","trevorwhitney","2023-02-07 20:02:16","true","Fix namespace rendering in provisioner job (#8449)",80,58,1,1,"2018-04-16 10:25:39","1752.4"
"grafana/loki","db38b7bccc59252533abc257e6a5d328d05678a3","chaudum","2023-07-14 08:07:52","true","Remove unused fallback in index gateway client store (#9916)

The fallback was once used by boltdb-shipper, but since boltdb-shipper changed to not use the index gateway, the fallback was also never used.

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",56,63,1,1,"2018-04-16 10:25:39","1914.15"
"grafana/loki","a09cb07e980aed8e72d0712db9a35e21ecb63e6c","jeschkies","2023-07-14 08:42:43","true","Define protobufs for topk and cms. (#9933)

**What this PR does / why we need it**:
This change introduces Protobuf models for the sketch data structures
which will be used to shard topk queries.

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [x] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

---------

Signed-off-by: Callum Styan <callumstyan@gmail.com>
Co-authored-by: Callum Styan <callumstyan@gmail.com>",56,63,1,1,"2018-04-16 10:25:39","1914.18"
"grafana/loki","4d3b15ae89e6ae6166f5d5100d8e157863cecc4d","cstyan","2023-07-13 16:39:51","true","Implement probabilistic topk via count min sketch and min heap (#9882)

This PR currently implements the following structures:
- **Count Min Sketch**:
http://dimacs.rutgers.edu/~graham/pubs/papers/cmencyc.pdf
- **sketch-bf**:
https://ietresearch.onlinelibrary.wiley.com/doi/epdf/10.1049/ell2.12482
improvements to the heap usage for Count Min Sketch
- HeavyKeeper:
https://www.usenix.org/system/files/conference/atc18/atc18-gong.pdf

I also read and evaluated the following:
- topkapi: https://www.cs.rice.edu/~as143/Papers/topkapi.pdf
- space saving algorithm:
https://www.cse.ust.hk/~raywong/comp5331/References/EfficientComputationOfFrequentAndTop-kElementsInDataStreams.pdf

**Description**:

As part of our work to ensure every query type is parallelizable we
started exploring probabilistic data structures as a way to reduce
memory consumption and allow merging of partial results after sharding
of queries. In this PR I have implemented a few sketch structures as
part of investigating structures that are applicable to topk queries.

Unfortunately while many papers made claims of improved performance over
the original count min sketch paper, topkapi and heavy keeper either
didn't behave as expected or were not mergeable while keeping the same
degree of accuracy. Count min sketch when using conservative updates
(which vastly reduces error over counting, especially for low flows),
also can't keep the same degree of accuracy, but it is still more
accurate after merging than heavy keeper. I've also applied some of the
principles outlined in the sketchbf paper related to reducing the # of
heap operations required when observing events into the sketch, which
sped up processing in my benchmark of 100k unique streams each with 1-2k
randomized # of occurrences by nearly 3x.

---------

Signed-off-by: Callum Styan <callumstyan@gmail.com>
Co-authored-by: Karsten Jeschkies <karsten.jeschkies@grafana.com>",57,63,1,1,"2018-04-16 10:25:39","1913.51"
"grafana/loki","25c26ec27d09e6d42bee42a02e22bcf9739bad7e","xperimental","2023-07-13 10:01:04","true","operator: Fix update of labels and annotations of PodTemplates (#9860)",57,63,1,1,"2018-04-16 10:25:39","1913.23"
"grafana/loki","c5fab0a33ba6983fa7a192fe4a09bcb58a2f0ce2","periklis","2021-05-04 16:26:45","true","Add owner watches for LokiStack owned resources (#42)",184,37,0,1,"2018-04-16 10:25:39","1114"
"grafana/loki","f5992274f4c41544cbe6f677dfa1f4d909b12193","jeschkies","2023-07-05 18:53:36","true","Switch on pointer `*logproto.SeriesResponse` in JSON serialization. (#9868)

**What this PR does / why we need it**:
Commit b35bbd80d65f09eb6f1e6ba1bfe05bf4af712a97 introduced a regression
in the deserialization code. It would switch on
`logproto.SeriesResponse` instead of the pointer type
`*logproto.SeriesResponse`.

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [x] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",59,63,1,1,"2018-04-16 10:25:39","1905.6"
"grafana/loki","a62318ef193837d30fbe1c0712eb080d0f1b56b7","chaudum","2023-02-01 14:45:37","true","Reflect release 2.7.3 on main branch (#8372)

Update

* CHANGELOG
* release notes
* installation docs
* version references in production/ folder",78,57,1,1,"2018-04-16 10:25:39","1746.18"
"grafana/loki","3509edd98dd166c00764834ed35b56dd3e9e3d24","JoaoBraveCoding","2023-06-20 18:26:31","true","operator: fix replica count for 1x.ExtraSmall (#9751)",61,62,1,0,"2018-04-16 10:25:39","1890.58"
"grafana/loki","ccf44f88408777d555234f1c60d3a478fcc3e09c","dannykopping","2023-06-20 09:48:42","true","Adding 3 existing maintainers, and our newest one: Ashwanth! (#9741)

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>
Co-authored-by: Susana Ferreira <ssncferreira@gmail.com>",61,62,1,1,"2018-04-16 10:25:39","1890.22"
"grafana/loki","15fda6bf39053cd95cdc1e43f4f4307585e3038a","MichelHollands","2023-03-09 10:53:12","true","Change severity of PromtailFileMissing alert to warning (#8757)

The PromtailFileMissing alert is not critical. This changes it to a
warning.

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",88,59,1,1,"2018-04-16 10:25:39","1784.02"
"grafana/loki","00a3c5b026c0c1724d822207a3d439fa4351f2b4","vlad-diachenko","2023-09-04 11:03:20","true","renamed `non indexed labels` feature to `structured metadata` (#10432)

Loki team has made a decision to rename the feature because the new name
is more precise.

---------

Signed-off-by: Vladyslav Diachenko <vlad.diachenko@grafana.com>
Co-authored-by: Salva Corts <salva.corts@grafana.com>",46,65,1,0,"2018-04-16 10:25:39","1964.28"
"grafana/loki","329c0d0d331f5a356f48c2f183930c9de0937fa2","MattiasSegerdahl","2023-05-01 08:32:45","true","Update _index.md (#9305)

**What this PR does / why we need it**:

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",79,60,1,0,"2018-04-16 10:25:39","1841.17"
"grafana/loki","6e4641653b5a85a8314789da5232c9b73450504f","splitice","2022-04-07 10:29:24","true","Add X4B as an adopter (#5795)",320,48,0,0,"2018-04-16 10:25:39","1446.75"
"grafana/loki","f5d79aee7a69bef8ae5364e3d1003715cc6abbd0","slim-bean","2020-03-06 01:54:24","true","Revert ""loki: Allow setting a 'step' when querying logs. (#1773)"" (#1777)

This reverts commit 934a0b8d

Signed-off-by: Edward Welch <edward.welch@grafana.com>",114,23,0,1,"2018-04-16 10:25:39","684.89"
"grafana/loki","3086a3bfd31f047e1bf159086b8b2224092402da","jeschkies","2023-11-06 09:12:26","true","Build loki-build-image for multiple architectures. (#11130)

**What this PR does / why we need it**:
The current `loki-build-image` is for `amd64` only. However, many are
developing Loki on Apple Silicon. That's why we should publish build
images for `arm64` as well.

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)
- [ ] If the change is deprecating or removing a configuration option,
update the `deprecated-config.yaml` and `deleted-config.yaml` files
respectively in the `tools/deprecated-config-checker` directory.
[Example
PR](https://github.com/grafana/loki/pull/10840/commits/0d4416a4b03739583349934b96f272fb4f685d15)",11,67,1,1,"2018-04-16 10:25:39","2026.2"
"grafana/loki","3beb259ea4245d3db5391e98556b2d01308feedd","davkal","2019-03-28 15:25:26","true","Update troubleshooting.md",92,11,0,0,"2018-04-16 10:25:39","342.21"
"grafana/loki","68e1a049a0cbbc7579f787eea840aa2693a85f4e","tomwilkie","2019-02-04 10:32:08","false","lint

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",80,9,0,0,"2018-04-16 10:25:39","288"
"grafana/loki","a7f16a5bbd104790e485ccf3df32eec34ab6949c","daixiang0","2019-01-17 11:31:12","false","helm: remove promtail sa setting (#160)

Signed-off-by: Xiang Dai <764524258@qq.com>",63,9,0,0,"2018-04-16 10:25:39","271.05"
"grafana/loki","5aea1fe40884920be597d585f29ac817dea25788","bergquist","2018-12-20 11:10:04","false","adds build info to loki and promtail (#172)",47,8,0,0,"2018-04-16 10:25:39","244.03"
"grafana/loki","fd58f4852325ec8af16ea05f0c990a6c964af851","tomwilkie","2018-12-17 11:10:51","true","Remove go build -i (#140)

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",39,8,0,0,"2018-04-16 10:25:39","241.03"
"grafana/loki","da27baad2ce4fe65569c8d298a92070af287a14d","tomwilkie","2018-12-18 15:30:31","true","Support for JSON, not just protos. (#152)

* Support for JSON, not just protos.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>

* s/timestamp/ts/

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",36,8,0,0,"2018-04-16 10:25:39","242.21"
"grafana/loki","0443ee7f9ec72df0f0edfb371672c401707f8dbc","tomwilkie","2018-05-20 11:27:29","false","Minor tidy ups.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",0,1,0,0,"2018-04-16 10:25:39","34.04"
"grafana/loki","3a5c4dd9f9b923c940bfc7433dd0cd76a30033b5","tomwilkie","2018-05-20 11:29:28","true","Merge pull request #8 from grafana/dev

More changes, mainly to query path.",0,1,0,0,"2018-04-16 10:25:39","34.04"
"grafana/loki","20048f547402560ea6066abb9d96dfc204485321","daixiang0","2019-09-24 11:29:23","false","doc(ksonnet): include ksonnet-lib (#1042)

As Tanka does not include the ksonnet-lib by default, we need to add it manually using jsonnet-bundler",68,17,0,0,"2018-04-16 10:25:39","523.29"
"grafana/loki","777fcfc04e3c63b6e78c6b51ef6656134649f696","daixiang0","2019-08-20 14:08:49","false","optimize image tag script (#911)

* add quota for sed

Signed-off-by: Xiang Dai <764524258@qq.com>

* add comment for head

Signed-off-by: Xiang Dai <764524258@qq.com>",113,16,0,0,"2018-04-16 10:25:39","489.4"
"grafana/loki","25aed2b88993ac633e7563aec075c18d0fa9a5df","cyriltovena","2020-04-13 16:28:24","true","Add no-file and keep-file log option for docker driver. (#1906)

* Add no-file and keep-file option.

By default no-file is false, this means the driver will create json log files that can be used to run `docker logs` command.
If no-file is true, no files are created and so `docker log` won't work. This allow the ability to run the driver without caring of space left on the host.

keep-file tells the driver to keep file even after the container has been stopped, by default this options is false. This means files are cleaned up once containers are stopped and not history is left to be used for `docker logs`.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Review feedback !

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",123,24,0,1,"2018-04-16 10:25:39","722.5"
"grafana/loki","66dc42feb51d4a09cffa7b4d4b8f8ab674ac0686","chaudum","2022-01-12 10:33:30","true","Update Docker compose example (#4996)

to work with Loki 2.4.x

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",258,45,0,1,"2018-04-16 10:25:39","1361.76"
"grafana/loki","944bbd16f569b0994b575ac10deaa869754c8eb0","owen-d","2021-08-18 13:18:15","true","fine tune grpc configs jsonnet (#4182)",131,40,0,1,"2018-04-16 10:25:39","1217.87"
"grafana/loki","1781d7c700d04ad57fbdc8cce0eb009e06d62900","ashwanthgoli","2023-10-27 06:08:26","true","ksonnet: do not deploy table manager when shipper is in-use (#11020)

**What this PR does / why we need it**:
Do not generate table manager manifests if shipper is being used.
table manager is a deprecated target and is not recommended when using
`tsdb` or `boltdb-shipper` indexes.
Compactor is already bunlded along with shipper and handles retention,
compaction for the `tsdb` and `boltb-shipper` indexes


**Which issue(s) this PR fixes**:
Fixes [#10943](https://github.com/grafana/loki/issues/10943)

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)
- [ ] If the change is deprecating or removing a configuration option,
update the `deprecated-config.yaml` and `deleted-config.yaml` files
respectively in the `tools/deprecated-config-checker` directory. <!--
TODO(salvacorts): Add example PR -->",19,66,1,0,"2018-04-16 10:25:39","2017.07"
"grafana/loki","5cf1dc51e4c8498ff579101846247d0c75345927","slim-bean","2020-02-27 22:04:43","false","Add another variable to pick the name of the promtail pod, we don't always deploy promtail with the same name and sometimes put more than one deployment in a namespace

Signed-off-by: Edward Welch <edward.welch@grafana.com>",119,22,0,1,"2018-04-16 10:25:39","676.74"
"grafana/loki","5be5b4dd8e9a1d8bd2de46803d47bc6892989f24","slim-bean","2019-10-30 23:03:41","false","sum the bad words by name and level such that there isn't a spike during rollouts (previously summing by instance meant a new instance had no old metrics to compare to causing a spike in the output)",67,18,0,1,"2018-04-16 10:25:39","559.78"
"grafana/loki","9a91d58d3af4da17a6447f409acf8ad17c1ab05c","slim-bean","2019-05-29 21:37:15","false","cleaned up most of the TODO's
refactored and improved some of the tests, each stage type should now have a test using actual YAML
A few TODO's remaining and some comment cleanup",108,13,0,1,"2018-04-16 10:25:39","408.72"
"grafana/loki","972531d3e581ac0e2ff7c54946890b7d73037a9a","slim-bean","2019-03-07 14:01:04","false","fixed one bug which was probably unrelated to the test failure and broke out the test to avoid some non-deterministic behaviors in querying the ingester",88,11,0,1,"2018-04-16 10:25:39","321.15"
"grafana/loki","6d54505485eb37a80d5cced6246ac371a6265885","slim-bean","2022-08-26 19:30:34","true","Loki: add `__line__` and `__timestamp__` to label_format (#6983)

<!--  Thanks for sending a pull request!  Before submitting:

1. Read our CONTRIBUTING.md guide
2. Name your PR as `<Feature Area>: Describe your change`.
  a. Do not end the title with punctuation. It will be added in the changelog.
  b. Start with an imperative verb. Example: Fix the latency between System A and System B.
  c. Use sentence case, not title case.
  d. Use a complete phrase or sentence. The PR title will appear in a changelog, so help other people understand what your change will be.
3. Rebase your PR if it gets out of sync with main
-->

**What this PR does / why we need it**:

We have the `__line__` and `__timestamp__` functions currently available in the `line_format` stage but not in the `label_format` stage. This PR fixes that.

Specifically `__timestamp__` can be valuable in a label because you can do things like

```
label_format hour_of_day=`{{__timestamp__ | date ""15""}}`
```

To be able to conditionaly select log lines based on the hour of the day they were created, this can be useful for conditional alerting as an example.



**Which issue(s) this PR fixes**:
Fixes #6402

**Special notes for your reviewer**:

<!--
Note about CHANGELOG entries, if a change adds:
* an important feature
* fixes an issue present in a previous release, 
* causes a change in operation that would be useful for an operator of Loki to know
then please add a CHANGELOG entry.

For documentation changes, build changes, simple fixes etc please skip this step. We are attempting to curate a changelog of the most relevant and important changes to be easier to ingest by end users of Loki.

Note about the upgrade guide, if this changes:
* default configuration values
* metric names or label names
* changes existing log lines such as the metrics.go query output line
* configuration parameters 
* anything to do with any API
* any other change that would require special attention or extra steps to upgrade
Please document clearly what changed AND what needs to be done in the upgrade guide.
-->
**Checklist**
- [x] Documentation added
- [ ] Tests updated
- [x] Is this an important fix or new feature? Add an entry in the `CHANGELOG.md`.
- [ ] Changes that require user attention or interaction to upgrade are documented in `docs/sources/upgrading/_index.md`

Signed-off-by: Edward Welch <edward.welch@grafana.com>",82,52,0,1,"2018-04-16 10:25:39","1591.38"
"grafana/loki","48ad068ce1c0231d396e0e9750e224612bf7a4ab","MasslessParticle","2023-05-05 20:04:20","true","fix json expression parser (#9410)

When the value parsed by the `JsonExpressionParser` is an escaped json
string, the result still contains escape character and may not be valid
json. This causes subsequent json parsing steps to fail. For example:

`{app=""foo""} | json message | line_format ""{{.message}}"" | json` fails
when `message` remains escaped.

This PR unescapes the results of extracted `JsonExpressions` so they can
be parsed by subsequent json parsers",81,61,1,1,"2018-04-16 10:25:39","1845.65"
"grafana/loki","ca5153070cef42f51fb53d8264e71ff3231a50ba","tomwilkie","2018-11-22 15:55:44","false","Add instructions for running Grafana.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",5,7,0,0,"2018-04-16 10:25:39","216.23"
"grafana/loki","10283d9bc16bb1f4916eb6a168c431488c161d54","KMiller-Grafana","2022-06-14 18:32:45","true","Docs: edit the CHANGELOG (#6386)

* Docs: edit the CHANGELOG

* Resolve conflicts caused by 2 new changelog entries.

* Add missing characters of new changelog entry.",67,50,0,0,"2018-04-16 10:25:39","1519.34"
"grafana/loki","b4440911e0faa625d7d187747653d3480ef4c0a3","liguozhong","2023-01-04 15:21:49","true","[new feature] logql:support sort and sort_desc (#7989)

**What this PR does / why we need it**:

sort()
sort(v instant-vector) returns vector elements sorted by their sample
values, in ascending order.

sort_desc()
Same as sort, but sorts in descending order.

ex:
`sort(rate(({app=~""foo|bar""} |~"".+bar"")[1m])) without (app) `

prometheud doc:
https://prometheus.io/docs/prometheus/latest/querying/functions/#sort

**Which issue(s) this PR fixes**:
Fixes #7933

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the `CONTRIBUTING.md` guide
- [x] Documentation added
- [x] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>",100,56,1,1,"2018-04-16 10:25:39","1719.21"
"grafana/loki","bd1fef08a8ea99e73a30c4739cfeb931353700e6","KMiller-Grafana","2021-12-22 22:21:57","true","Docs: add initial descriptions of Loki use of hash rings (#4900)

* Docs: add description of rings

* Docs: remove unintended changes",245,44,0,0,"2018-04-16 10:25:39","1342.25"
"grafana/loki","0b8d44294c1aa8dc5113e988621ece856d23507b","daixiang0","2019-04-18 06:11:54","false","Add link

Signed-off-by: Xiang Dai <764524258@qq.com>",96,12,0,0,"2018-04-16 10:25:39","367.07"
"grafana/loki","185b2b089de0d05c20375c01b689f48dc5b3777a","kariya-mitsuru","2023-05-01 12:01:25","true","Docs: Fix API document (#9210)

**What this PR does / why we need it**:

Remove /ready and /metrics from API list of the querier and the query
frontend because they are exposed by all components.

Remove /loki/api/v1/push from API list of the querier and the query
frontend because it is exposed by distributor.

Move /api/prom/push from API list of the querier and the query frontend
to API list of the distributor because it is exposed by distributor.

Add /api/prom/series to API list of the querier and the query frontend.

Change reference to /loki/api/v1/label to /loki/api/labels because
former is not documented.

**Which issue(s) this PR fixes**:

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

Signed-off-by: Mitsuru Kariya <mitsuru.kariya@nttdata.com>",78,60,1,0,"2018-04-16 10:25:39","1841.32"
"grafana/loki","45d59ba571cdb04681757878ed4898749c82c3f4","MasslessParticle","2022-10-24 16:54:38","true","Improve rate store refresh latency (#7492)

Rather than iterating streams and getting rates per stream, keep all
necessary information in the rate calculator and just hand back the
current rates when asked.

This change took p99 latencies from ~1.8s to ~400ms and p50 latences
from ~1s to 6ms.",91,54,1,1,"2018-04-16 10:25:39","1649.27"
"grafana/loki","72d8627a5561fd55423197712f64bb12a575447c","owen-d","2022-08-18 19:46:37","true","log query which causes panic in logql.clone (#6934)

Signed-off-by: Owen Diehl <ow.diehl@gmail.com>",83,52,0,1,"2018-04-16 10:25:39","1583.39"
"grafana/loki","3fb572abda31a8baf7b5424f6dcea92671ff645d","chaudum","2022-02-02 07:31:47","true","Fix Promtail watching deadlock (#5283)

* Reuse channel from fileEventWatcher map if already exists

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* Remove sync() call in FileTarget constructor

The constructor `NewFileTarget` is called from within a locked code
block by the FileTargetManager. However, the constructor also calls
`sync()` which starts and stops watching new directories. These methods
`startWatching` and `stopWatching` both send to the `targetEventHandler`
channel, causing the `FileTargetManager` to receive the event in a
goroutine (`watch()` function) running in the background.
Handling the event calls `sendFileCreateEvent` on the syncers, which
subsequently tries to write to the `fileEventWatcher` channel which is
never read because of the locked mutex.

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",275,45,0,1,"2018-04-16 10:25:39","1381.63"
"grafana/loki","4740f5f0e280d4252ed5e61ea29b50e455be1ac8","owen-d","2020-03-31 15:03:50","true","documents frontend worker (#1873)",121,23,0,1,"2018-04-16 10:25:39","710.44"
"grafana/loki","771e218b58cad637eb2687ea7eb3e10d1fb64ac9","splitice","2022-06-13 13:00:35","true","JSON label extraction field validation expression overly strict (#6372)

* Extend json label extraction test

* Add json label extraction to aggregation

* fix lexeer issue, it's value to have numbers inside the field (just not at the start)

Also simplified logic

* integrate feedback from reviews",69,50,0,0,"2018-04-16 10:25:39","1518.11"
"grafana/loki","86d628e8279d42cb39576aa051a726ad8dcdaa54","steve-caron-grafana","2023-05-01 08:11:49","true","Update _index.md (#9347)

**What this PR does / why we need it**:
Doc update: Adding Cribl and Vector plugins as unofficial clients - this
is something we are seeing more and more in the field, customer using
either Vector and Cribl as observability data pipelines to decide which
log data will be sent to which log backend (including Loki).

**Which issue(s) this PR fixes**:

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",79,60,1,0,"2018-04-16 10:25:39","1841.16"
"grafana/loki","2b6bdc2a29de8d94d78d1c735104f124436a92e5","chaudum","2023-09-12 10:00:15","true"," chore(storage): Simplify store interfaces and abstractions (pt 2) (#10454)

**What this PR does / why we need it**:

* Remove preemptive interface from indexReaderWriter and make it an exported struct
    
* Compose IngesterStore and QuerierStore
    
    The ingester and querier do not require a store that implements the full
    interface, but can accept stores that are a subset of the interfaces.
    
    Therefore we can make specific interfaces that are accepted by the
    ingester and querier constructors.
    

* Split up ChunkFetcher interface
    
    This commit splits the ChunkFetcher interface into a ChunkFetcher and a
    ChunkFetcherProvider interface.
    
    This has the advantage that methods can allow accepting smaller interfaces.
    
    This commit also renames the `GetChunkRefs()` method of the ChunkFetcher
    interface into `GetChunks()`, because it returns a `[][]chunk.Chunk`,
    not a `[]chunk.ChunkRef` type.


Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",41,65,1,1,"2018-04-16 10:25:39","1972.23"
"grafana/loki","ea14d1348e5a3ae7ed075a5fc0b0b93304bb2ebd","trevorwhitney","2023-04-06 05:39:19","true","Fix CHANGELOG to accurately reflect what's in 2.8 (#9042)

**What this PR does / why we need it**:

A few items were incorrectly listed under 2.8 on `main` that are not in
2.8. This PR brings the `CHANGELOG` on `main` in line with the one
already on `release-2.8.x` and therefore doesn't need to be backported.",84,59,1,1,"2018-04-16 10:25:39","1810.8"
"grafana/loki","c08ec795a73985cefc93d657f35e2ee38d1c359c","pracucci","2019-07-16 17:01:45","false","Documented timestamp's custom format syntax (#763)",97,15,0,0,"2018-04-16 10:25:39","455.53"
"grafana/loki","f4db6a76b811e66a98f5e67c9e2ccec448fa97b1","ahadjidj","2023-04-14 19:12:35","true","Update _index.md (#9138)

Removed the single binary from the scalability section as this is
confusing. This should be called monolithic also.

**What this PR does / why we need it**:

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",81,60,1,0,"2018-04-16 10:25:39","1819.37"
"grafana/loki","099ca230b17aa45380aa97b3259e2c506566a57c","periklis","2023-02-14 16:21:06","true","operator: Provide community operator bundle (#7308)

Co-authored-by: Robert Jacob <rojacob@redhat.com>",76,58,1,1,"2018-04-16 10:25:39","1759.25"
"grafana/loki","27d5b83c243e0af7c5f5bde75afce3ae391fe309","ssncferreira","2023-02-10 10:14:13","true","Helm: add debug option to helm command for verbose output on local development (#8479)",79,58,1,0,"2018-04-16 10:25:39","1754.99"
"grafana/loki","3472aece09cfa1f0b35a613f72b3476a98b0f0bc","jdbaldry","2023-01-25 12:39:17","true","Test docs build on PRs (#8274)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>",86,57,1,0,"2018-04-16 10:25:39","1740.09"
"grafana/loki","d97aaca08941430ec878b4a73662c9eaad2dbca1","chaudum","2023-01-18 22:58:10","true","[docs] Clarify for what version the Helm chart docs are applicable (#8172)

**What this PR does / why we need it**:

The docs and reference of the Helm chart in the documentation is only
applicable for the Loki Helm chart `>= 3.0` and therefore does not apply
to the `grafana/loki-stack` chart, which depends on the Loki Helm chart
`^2.15.2`
([requirements.yaml](https://github.com/grafana/helm-charts/blob/main/charts/loki-stack/requirements.yaml#L5)).

Also added a headline to the ""Install Loki using Helm"" index page,
because it looks awkward without, see screenshot.


![2023-01-17_20-28-52](https://user-images.githubusercontent.com/281260/212994261-f817f556-4cbf-454f-920f-875c5c085689.png)


**Which issue(s) this PR fixes**:

Fixes: #8152

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",85,57,1,1,"2018-04-16 10:25:39","1733.52"
"grafana/loki","1eb139c37c1c26088426d765713d0d9946dbe3d9","cyriltovena","2020-03-16 17:23:01","true","Add a test for duplicates count in the heap iterator and fixes it. (#1802)

* Add a tests for duplicate count in the heap iterator and fixes it.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Update pkg/iter/iterator.go",116,23,0,1,"2018-04-16 10:25:39","695.54"
"grafana/loki","c9b374dd08969713632bddc3b35553d5c2271948","JordanRushing","2022-06-07 22:01:32","true","Set `MetricsNamespace` configurable for MemberlistKV module in Loki (#6330)

Signed-off-by: JordanRushing <rushing.jordan@gmail.com>",72,50,0,0,"2018-04-16 10:25:39","1512.48"
"grafana/loki","2ff6f13c8b806a771871d763e616688e253675d1","simonswine","2022-11-30 16:23:53","true","Better error message for empty selector queries (#6936)

This improves the error when an empty label selector is given:

Before:

```sh-session
# Before
$ logcli query ""{}""
Error response from server: parse error at line 1, col 2: syntax error: unexpected }, expecting IDENTIFIER

# After
$ logcli query ""{}""
Error response from server: parse error : queries require at least one regexp or equality matcher that does not have an empty-compatible value. For instance, app=~"".*"" does not meet this requirement, but app=~"".+"" will
```

I fear that might have wider implications, so it would be great to get a
lot of eyes on this.

In theory I think we should remove the restriction on querying all log
streams, but this should maybe discussed in a follow up PR
:slightly_smiling_face:

Co-authored-by: Karsten Jeschkies <karsten.jeschkies@grafana.com>",92,55,1,0,"2018-04-16 10:25:39","1685.25"
"grafana/loki","a92541bd849456d3d58826942e19d0286defd41c","james-callahan","2021-11-03 12:28:07","true","Promtail: no need for GCP promtail_instance label now that loki supports out-of-order writes (#4556)

Closes #4474",171,42,0,0,"2018-04-16 10:25:39","1292.84"
"grafana/loki","4c985efade7dc6b593e715d45f21ff879f3ac66c","woodsaj","2019-02-04 06:57:04","true","Merge pull request #281 from grafana/issue276

tail all container log files",81,9,0,0,"2018-04-16 10:25:39","287.86"
"grafana/loki","3e1f2fc273a5c173f13dfd069b11a305e8dc36c2","sandeepsukhani","2023-06-23 19:57:06","true","caching: do not try to fill the gap in log results cache when the new query interval does not overlap the cached query interval (#9757)

**What this PR does / why we need it**:
Currently, when we find a relevant cached negative response for a logs
query, we do the following:
* If the cached query completely covers the new query:
  * return back an empty response.
* else:
  * fill the gaps on either/both sides of the cached query.

The problem with filling the gaps is that when the cached query does not
overlap at all with the new query, we have to extend the query beyond
what the query requests for. However, with the logs query, we have a
limit on the number of lines we can send back in the response. So, this
could result in the query response having logs which were not requested
by the query, which then get filtered out by the [response
extractor](https://github.com/grafana/loki/blob/b78d3f05525d8bcab13e621bc2e5851aadc8fc91/pkg/querier/queryrange/log_result_cache.go#L299),
unexpectedly resulting in an empty response. For example, if the query
was cached for start=15, end=20 and we get a `backwards` query for
start=5, end=10. To fill the gap, the query would be executed for
start=5, end=15. Now, if we have logs more than the query `limit` in the
range 10-15, we would filter out all the data in the response extractor
and send back an empty response to the user.

This PR fixes the issue by doing the following changes when handling
cache hit:
* If the cached query completely covers the new query:
  * return back an empty response[_existing_].
* else if the cached query does not overlap with the new query:
  * do the new query as requested.
* If the new query results in an empty response and has a higher
interval than the cached query:
    * update the cache
* else:
  * query the data for missing intervals on both/either side[_existing_]
* update the cache with extended intervals if the new queries resulted
in an empty response[_existing_]

**Special notes for your reviewer**:
We could do further improvements in the handling of queries not
overlapping with cached query by selectively extending the queries based
on query direction and cached query lying before/after the new query.
For example, if the new query is doing `backwards` query and the
`cachedQuery.End` < `newQuery.Start`, it should be okay to extend the
query and do `cachedQuery.End` to `newQuery.End` to fill the cache since
query would first fill the most relevant data before hitting the limits.
I did not want to complicate the fix so went without implementing this
approach. We can revisit later if we feel we need to improve our
caching.

**Checklist**
- [x] Tests updated
- [x] `CHANGELOG.md` updated

---------

Co-authored-by: Travis Patterson <travis.patterson@grafana.com>",61,62,1,1,"2018-04-16 10:25:39","1893.65"
"grafana/loki","8c06c546ab15a568f255461f10318dae37e022d3","sandeepsukhani","2022-03-16 16:07:30","true","debug log number of index entries cached and retrieved from the cache per index query (#5642)",304,47,0,1,"2018-04-16 10:25:39","1425.99"
"grafana/loki","bf4530a2211e29c9bc8bda51f4abb3eac8062f1b","joe-elliott","2019-10-09 21:40:56","false","Moved client docs and add serilog example (#1139)

Signed-off-by: Joe Elliott <number101010@gmail.com>",68,18,0,0,"2018-04-16 10:25:39","538.72"
"grafana/loki","01040c1a4dfaa00e98764bd7519ccc5e04944b90","adityacs","2020-07-09 20:08:22","true","Fix data race in ingester (#2327)",126,27,0,1,"2018-04-16 10:25:39","813.9"
"grafana/loki","7118dc3272e79f626479dbdc51b6e1f17e12cc0d","trevorwhitney","2021-10-13 06:36:46","true","Change default values for two GRPC setting we have to set so the queriers can connect to a frontend or scheduler (#4435)

* change gprc server defaults

Signed-off-by: Trevor Whitney <trevorjwhitney@gmail.com>

* add docs and changelog

Signed-off-by: Trevor Whitney <trevorjwhitney@gmail.com>",147,42,0,1,"2018-04-16 10:25:39","1272.59"
"grafana/loki","3f6f2fc717803da8436d30ee6bce97818a13ef56","owen-d","2021-08-18 15:21:28","true","remove unused code and reformat (#4155)",131,40,0,1,"2018-04-16 10:25:39","1217.96"
"grafana/loki","224e68a50b822edc9b63c834c79636b0eaf15f73","owen-d","2021-01-27 21:13:59","true","WAL backpressure (#3218)

* adds WAL replay backpressure

* backpressure fn doesnt lock during passed fn for concurrency

* replayController

* replayController supports a RemoveFlushedChunks fn

* custom wal flusher

* encoding test determinism

* standardizes recoveredBytesTotal to replayControllers ownership

* linting

* default wal memory threshold to 4gb, adds docs

* fix test after v3 chunk schema change

* more lenient expectCheckpoint function

* replayController protects against flush race condition

* adds replay_memory_ceiling to wal jsonnet

* replay ceiling help msg",123,33,0,1,"2018-04-16 10:25:39","1011.95"
"grafana/loki","f4f1239e55a82f6f29f22b1c45507516897f0a6b","cyriltovena","2021-02-18 13:39:09","true","Fixes ingester stats. (#3350)

This correclty use the stats context.

Introduced by https://github.com/grafana/loki/pull/1837/files#diff-d48cc90b5e10796f4e5256f2c7f4a7009c7c6799b514d7699676f73ae1be09c3L224

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",131,34,0,1,"2018-04-16 10:25:39","1032.63"
"grafana/loki","2445ccd287988027c1c05ef1b9c8f49cd77ee226","slim-bean","2020-04-06 19:42:34","true","updating changelog and version numbers in docs for 1.4.1 release

Signed-off-by: Edward Welch <edward.welch@grafana.com>",113,24,0,1,"2018-04-16 10:25:39","715.64"
"grafana/loki","2dc4571fc39a735ce9466f7b89aa0a8ddf6e9b90","periklis","2022-04-13 19:06:34","true","operator: Align PVC storage size requests for all lokistack t-shirt sizes (#5893)",321,48,0,1,"2018-04-16 10:25:39","1453.11"
"grafana/loki","52f6b8253cf22367d831fb7d5038de205ba9bfea","periklis","2023-03-15 17:52:57","true","operator: Add alertingrule tenant id label for all rules (#8748)",88,59,1,1,"2018-04-16 10:25:39","1790.31"
"grafana/loki","5919a298006601e1b179f14115d586214ef7eb4b","cstyan","2022-08-16 06:27:31","true","Previous PR #6888 broke some additional jsonnet, use {} instead of null (#6918)

Signed-off-by: Callum Styan <callumstyan@gmail.com>

Signed-off-by: Callum Styan <callumstyan@gmail.com>",83,52,0,1,"2018-04-16 10:25:39","1580.83"
"grafana/loki","7d5475541c66a819f6f456a45f8c143a084e6831","gonzalesraul","2023-10-16 07:36:14","true","promtail: enable structured_metadata convert labels (#10752)

**What this PR does / why we need it**:

There are several labels that can be extracted by the supports service
discovery providers, however the structured metadata wouldn't allow to
parse labels to it.

This PR allows the users to update the configuration to read from labels
discovered, down below are some of the metadata from a pod, that could
be of interested of anyone to have that pushed to Loki without creating
several streams due to either high-carnality or proliferation of idle
chunks:

```
__address__=""10.0.165.166:3100""
__meta_kubernetes_namespace=""loki""
__meta_kubernetes_pod_annotation_checksum_config=""f008ef39c4f3230c5e153c6e9fde51a678e6f0b1087b3be7d91b8142a03dbe7c""
__meta_kubernetes_pod_annotation_kubectl_kubernetes_io_default_container=""loki""
__meta_kubernetes_pod_annotationpresent_checksum_config=""true""
__meta_kubernetes_pod_annotationpresent_kubectl_kubernetes_io_default_container=""true""
__meta_kubernetes_pod_container_id=""containerd://e6aef5c39c3fe806d39ea536b198c8c39cdee01d23141fed91e8fe1573cc5e08""
__meta_kubernetes_pod_container_image=""docker.io/grafana/loki:2.9.1""
__meta_kubernetes_pod_container_init=""false""
__meta_kubernetes_pod_container_name=""loki""
__meta_kubernetes_pod_container_port_name=""http-metrics""
__meta_kubernetes_pod_container_port_number=""3100""
__meta_kubernetes_pod_container_port_protocol=""TCP""
__meta_kubernetes_pod_controller_kind=""StatefulSet""
__meta_kubernetes_pod_controller_name=""loki-write""
__meta_kubernetes_pod_host_ip=""10.249.129.191""
__meta_kubernetes_pod_ip=""10.0.165.166""
__meta_kubernetes_pod_label_app_kubernetes_io_component=""write""
__meta_kubernetes_pod_label_app_kubernetes_io_instance=""loki""
__meta_kubernetes_pod_label_app_kubernetes_io_name=""loki""
__meta_kubernetes_pod_label_app_kubernetes_io_part_of=""memberlist""
__meta_kubernetes_pod_label_controller_revision_hash=""loki-write-75847dc945""
__meta_kubernetes_pod_label_statefulset_kubernetes_io_pod_name=""loki-write-1""
__meta_kubernetes_pod_labelpresent_app_kubernetes_io_component=""true""
__meta_kubernetes_pod_labelpresent_app_kubernetes_io_instance=""true""
__meta_kubernetes_pod_labelpresent_app_kubernetes_io_name=""true""
__meta_kubernetes_pod_labelpresent_app_kubernetes_io_part_of=""true""
__meta_kubernetes_pod_labelpresent_controller_revision_hash=""true""
__meta_kubernetes_pod_labelpresent_statefulset_kubernetes_io_pod_name=""true""
__meta_kubernetes_pod_name=""loki-write-1""
__meta_kubernetes_pod_node_name=""ip-10-249-129-191.ec2.internal""
__meta_kubernetes_pod_phase=""Running""
__meta_kubernetes_pod_ready=""false""
__meta_kubernetes_pod_uid=""b3937321-fe90-4e15-ac94-495c8fdb9202""
```

**Which issue(s) this PR fixes**:
https://github.com/grafana/loki/issues/10766

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [x] Tests updated
- [x] `CHANGELOG.md` updated
- [x] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

---------

Co-authored-by: J Stickler <julie.stickler@grafana.com>",25,66,1,0,"2018-04-16 10:25:39","2006.13"
"grafana/loki","211d45436260e77cb9c7bea340b7b79888212932","tomwilkie","2018-12-20 11:30:30","true","Update ksonnet for Loki. (#177)

* Improve ksonnet to be more manageable

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>

* Compress config into a single structure.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>

* Various fixes

- s/config/$._config/

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",47,8,0,0,"2018-04-16 10:25:39","244.05"
"grafana/loki","fa42c12f4c54ecb805c19e30f772dde6d5df0d90","dannykopping","2022-07-19 09:09:32","true","Adding ""start_delta"" entry to metrics.go line (#6550)

* Adding ""start_delta"" entry to metrics.go line

This will help us determine if a 3h query (derived from ""length"") is for some random 3h period in the past, or within the last 3h

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Fixing test

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Appeasing the linter; for once it was actually useful

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Adding ""end_delta"" as well

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Removing rounding

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Fixing test

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",69,51,0,1,"2018-04-16 10:25:39","1553.95"
"grafana/loki","e3ab2c22decc32fbb4038e76cfa34f926ec5b3cd","dannykopping","2023-08-30 08:52:41","true","Fix CLI flags for congestion control (#10394)

**What this PR does / why we need it**:
Adds `congestion-control` prefixes to new flags.

Currently to enable congestion control via a flag, one must use
`-store.enabled` which is obviously misleading.

---------

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",46,64,1,1,"2018-04-16 10:25:39","1960.19"
"grafana/loki","0bf0b6b71826917d3bee4852608b99b35fbc5650","dannykopping","2023-03-09 13:00:16","true","Modify debug loki build to work on any architecture, including ARM (#8758)

**What this PR does / why we need it**:
On my M1 Pro, `make loki-debug-image` produces the following output:

```bash
qemu-x86_64: Could not open '/lib64/ld-linux-x86-64.so.2': No such file or directory
```

This is because we run `delve` as the entrypoint for the debug image,
and `delve` is being copied from `loki-build-image` which is exclusively
built as `amd64` (we should make this a multi-arch image... created
https://github.com/grafana/loki/issues/8759).

This change will work with whichever host OS is building the image and
download `delve` using that architecture instead of relying on the
`loki-build-image` version.",88,59,1,1,"2018-04-16 10:25:39","1784.11"
"grafana/loki","1e850364093a5c992d6ebd6379fa8b13193c2b35","KMiller-Grafana","2021-07-27 12:21:20","true","Revise wording of query frontend service configuration (#4052)

* Revise wording of query frontend service configuration

* Add ClusterIP and publishNotReadyAddresses to Kubernetes YAML",106,39,0,0,"2018-04-16 10:25:39","1196.83"
"grafana/loki","055c35e47abb9f1891b6775ad79d5856597d4246","KMiller-Grafana","2021-07-06 23:59:13","true","Docs: add structure for a release notes section (#3910)",119,39,0,0,"2018-04-16 10:25:39","1176.31"
"grafana/loki","e73584a3cd48e9c5fe7fe9253b0e2869b9da308f","thepalbi","2022-10-14 05:19:30","true","Promtail: Add handler timeout for GCP Logs Push target (#7401)

**What this PR does / why we need it**:
After been running the GCP Logs Push target in actual workloads, we've
noticed that GCP sends a lot of traffic, and adjusts that send rate
according to the rate at which the receiver can process. To perform that
adjustment, GCP considers as a NACK [non 2xx HTTP
responses](https://cloud.google.com/pubsub/docs/push#receive_push).

This PR adds a target handler timeout (that includes as well the
`api.Entry` channel send) to allow the user to configure this maximum
processing time, therefore giving GCP notice that the sending rate is
too high.

This new timeout is optional, and disabled by default.

**Which issue(s) this PR fixes**:
Related to https://github.com/grafana/cloud-onboarding/issues/2067

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the `CONTRIBUTING.md` guide
- [x] Documentation added
- [x] Tests updated
- [x] `CHANGELOG.md` updated
- [x] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",94,54,1,0,"2018-04-16 10:25:39","1638.79"
"grafana/loki","fad028b4c3892d97fa33d4e091b3f0a37fbf516c","MasslessParticle","2023-01-23 22:13:11","true","Change tests to bump sarama dependency (#8249)",83,57,1,1,"2018-04-16 10:25:39","1738.49"
"grafana/loki","198c81fc7bcb3325eaff5eaf5512a0145b0c13d8","MasslessParticle","2022-11-03 17:04:52","true","Reduce number of locks and partition by tenant and stream hash (#7583)

This PR reduces the number of locks in the rate calculator and allows it
to hold an arbitrary number of rates by partitioning by tenant and
stream hash

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>",90,54,1,1,"2018-04-16 10:25:39","1658.28"
"grafana/loki","2dec2d2e17f545aa1d6706fddce4a7efeccd304a","tracyde","2020-11-05 14:39:22","true","Iss2734 (#2835)

* force fluent-bit configmap BatchSize to be evaluated as an `int`

* update fluent-bit helm chart patch version",129,31,0,0,"2018-04-16 10:25:39","929.68"
"grafana/loki","1e442f7482a9249607e4f838d9c8ff767cc8f2aa","MOZGIII","2023-07-21 17:28:41","true","Drop :z from the podman mount command to make it work on macOS (#10007)

**What this PR does / why we need it**:

This fixes the `make -C docs ...` command on macOS.

**Which issue(s) this PR fixes**:
Idk, but it originates from
https://github.com/grafana/loki/pull/9945#issuecomment-1645272136

**Special notes for your reviewer**:
I have tested it. Also, shouldn't break the rest of the systems (Linux).

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",55,63,1,0,"2018-04-16 10:25:39","1921.54"
"grafana/loki","380f902c30be6341316d5b3181a21d1f606573cd","MichelHollands","2023-11-03 10:21:59","true","Change default of metrics.namespace (#11110)

**What this PR does / why we need it**:

Change the default for a subset of metrics. After this all Loki metrics
should start with ""loki_"". This changes the following metrics:

cortex_distributor_ingester_clients
cortex_dns_failures_total
cortex_dns_lookups_total
cortex_dns_provider_results
cortex_frontend_query_range_duration_seconds_bucket
cortex_frontend_query_range_duration_seconds_count
cortex_frontend_query_range_duration_seconds_sum
cortex_ingester_flush_queue_length
cortex_kv_request_duration_seconds_bucket
cortex_kv_request_duration_seconds_count
cortex_kv_request_duration_seconds_sum
cortex_member_consul_heartbeats_total
cortex_prometheus_last_evaluation_samples
cortex_prometheus_notifications_alertmanagers_discovered
cortex_prometheus_notifications_dropped_total
cortex_prometheus_notifications_errors_total
cortex_prometheus_notifications_latency_seconds
cortex_prometheus_notifications_latency_seconds_count
cortex_prometheus_notifications_latency_seconds_sum
cortex_prometheus_notifications_queue_capacity
cortex_prometheus_notifications_queue_length
cortex_prometheus_notifications_sent_total
cortex_prometheus_rule_evaluation_duration_seconds
cortex_prometheus_rule_evaluation_duration_seconds_count
cortex_prometheus_rule_evaluation_duration_seconds_sum
cortex_prometheus_rule_evaluation_failures_total
cortex_prometheus_rule_evaluations_total
cortex_prometheus_rule_group_duration_seconds
cortex_prometheus_rule_group_duration_seconds_count
cortex_prometheus_rule_group_duration_seconds_sum
cortex_prometheus_rule_group_interval_seconds
cortex_prometheus_rule_group_iterations_missed_total
cortex_prometheus_rule_group_iterations_total
cortex_prometheus_rule_group_last_duration_seconds
cortex_prometheus_rule_group_last_evaluation_timestamp_seconds
cortex_prometheus_rule_group_rules
cortex_query_frontend_connected_schedulers
cortex_query_frontend_queries_in_progress
cortex_query_frontend_retries_bucket
cortex_query_frontend_retries_count
cortex_query_frontend_retries_sum
cortex_query_scheduler_connected_frontend_clients
cortex_query_scheduler_connected_querier_clients
cortex_query_scheduler_inflight_requests
cortex_query_scheduler_inflight_requests_count
cortex_query_scheduler_inflight_requests_sum
cortex_query_scheduler_queue_duration_seconds_bucket
cortex_query_scheduler_queue_duration_seconds_count
cortex_query_scheduler_queue_duration_seconds_sum
cortex_query_scheduler_queue_length
cortex_query_scheduler_running
cortex_quota_cgroup_cpu_max
cortex_quota_cgroup_cpu_period
cortex_quota_cpu_count
cortex_quota_gomaxprocs
cortex_ring_member_heartbeats_total
cortex_ring_member_tokens_owned
cortex_ring_member_tokens_to_own
cortex_ring_members
cortex_ring_oldest_member_timestamp
cortex_ring_tokens_total
cortex_ruler_client_request_duration_seconds_bucket
cortex_ruler_client_request_duration_seconds_count
cortex_ruler_client_request_duration_seconds_sum
cortex_ruler_clients
cortex_ruler_config_last_reload_successful
cortex_ruler_config_last_reload_successful_seconds
cortex_ruler_config_updates_total
cortex_ruler_managers_total
cortex_ruler_ring_check_errors_total
cortex_ruler_sync_rules_total


**Checklist**
- [X] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [X] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)
- [ ] If the change is deprecating or removing a configuration option,
update the `deprecated-config.yaml` and `deleted-config.yaml` files
respectively in the `tools/deprecated-config-checker` directory.
[Example
PR](https://github.com/grafana/loki/pull/10840/commits/0d4416a4b03739583349934b96f272fb4f685d15)

---------

Signed-off-by: Michel Hollands <michel.hollands@gmail.com>
Co-authored-by: Ashwanth <iamashwanth@gmail.com>",11,66,1,1,"2018-04-16 10:25:39","2023.25"
"grafana/loki","5a6d09f83ea7a89c7b03d76e117d421b1ec3caf6","kavirajk","2022-08-30 15:06:10","true","doc(community): Update community call timings. (#7002)",80,52,1,1,"2018-04-16 10:25:39","1595.19"
"grafana/loki","c7cbeab8e2338b1dc39a3ff3bcde29af58317823","jeschkies","2022-04-14 08:31:58","true","Include tenant ID label in label values. (#5908)",320,48,0,1,"2018-04-16 10:25:39","1453.67"
"grafana/loki","c53c6072cfc1db2b7b59e03254463a54940ae7bd","jeschkies","2022-09-29 09:27:36","true","[Mixin] Rename `logs` template variable to `loki_datasource`. (#7278)

**What this PR does / why we need it**:
Grafana Cloud integration have the convention to name data source
variables after `<type>_datasource`. That means `$logs` should become
`loki_datasource`.",90,53,1,1,"2018-04-16 10:25:39","1623.96"
"grafana/loki","2f8d771c6b4fe5f659535c1f62df3dc6a7746e60","jeschkies","2023-02-17 16:30:18","true","Fix logcli parallel download deadlock. (#8553)",71,58,1,1,"2018-04-16 10:25:39","1762.25"
"grafana/loki","2830ec379129f3e7cdf05646885bb6cafc0aac34","jeschkies","2023-05-29 19:19:29","true","Reuse allocated buffer space in merge iterator. (#9538)

**What this PR does / why we need it**:
We saw a performance decrease when running the merge iterator with a
very small pool of ingesters. The reason was that we would allocate a
new buffer with each next call.

**Special notes for your reviewer**:
`main` is missing `merge_sort_dedupe-16` so I ran it once with a small
patch to generate the data.

```goos: linux
goarch: amd64
pkg: github.com/grafana/loki/pkg/iter
cpu: AMD Ryzen 7 3700X 8-Core Processor             
                                  │ mergeiter-old.txt │         mergeiter-new.txt          │
                                  │      sec/op       │   sec/op     vs base               │
SortIterator/merge_sort-16                1.350m ± 4%   1.368m ± 4%       ~ (p=0.579 n=10)
SortIterator/merge_sort_dedupe-16         2.566m ± 4%   2.462m ± 5%       ~ (p=0.105 n=10)
SortIterator/sort-16                      1.034m ± 6%   1.029m ± 6%       ~ (p=0.684 n=10)
SortSampleIterator/merge-16               1.877m ± 2%   1.857m ± 2%       ~ (p=0.075 n=10)
SortSampleIterator/sort-16                432.7µ ± 6%   436.0µ ± 4%       ~ (p=0.579 n=10)
geomean                                   1.238m        1.229m       -0.72%

                                  │ mergeiter-old.txt │           mergeiter-new.txt           │
                                  │       B/op        │     B/op      vs base                 │
SortIterator/merge_sort-16               21.22Ki ± 0%   21.22Ki ± 0%       ~ (p=1.000 n=10)
SortIterator/merge_sort_dedupe-16        41.47Ki ± 0%   41.47Ki ± 0%       ~ (p=1.000 n=10) ¹
SortIterator/sort-16                     13.94Ki ± 0%   13.94Ki ± 0%       ~ (p=1.000 n=10) ¹
geomean                                  23.06Ki        23.06Ki       +0.00%
¹ all samples are equal

                                  │ mergeiter-old.txt │          mergeiter-new.txt          │
                                  │     allocs/op     │ allocs/op   vs base                 │
SortIterator/merge_sort-16                 7.000 ± 0%   7.000 ± 0%       ~ (p=1.000 n=10) ¹
SortIterator/merge_sort_dedupe-16          7.000 ± 0%   7.000 ± 0%       ~ (p=1.000 n=10) ¹
SortIterator/sort-16                       5.000 ± 0%   5.000 ± 0%       ~ (p=1.000 n=10) ¹
geomean                                    6.257        6.257       +0.00%
¹ all samples are equal
```

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",70,61,1,1,"2018-04-16 10:25:39","1869.62"
"grafana/loki","fdafa10e5865adfcb8cb91b5722d209eae218b31","slim-bean","2019-08-20 19:41:57","false","feat(promtail): Make cluster role configurable",115,16,0,1,"2018-04-16 10:25:39","489.64"
"grafana/loki","fa305260c61acc9f9fb0ba10e925a7e1ecd8f6f1","dannykopping","2021-10-25 14:30:55","true","Temporarily taking over `/docs` while Karen is away (#4538)

* Temporarily taking over /docs while Karen is away

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Adding Ed and Owen

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",165,42,0,1,"2018-04-16 10:25:39","1284.92"
"grafana/loki","de7ab3fde2acffea6484e32bf62d321c0b8ec2d5","dannykopping","2021-10-29 14:06:32","true","Configuring query-frontend interface names with loopback device (#4586)

* Configuring query-frontend interface names with loopback device

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Adding test (thanks @DylanGuedes!)

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Appeasing the linter

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",169,42,0,1,"2018-04-16 10:25:39","1288.9"
"grafana/loki","3abb4a3e28e6950b96c8426a3485d6311e5891d0","daixiang0","2019-04-18 06:08:00","false","Comment how to contribute helm chart

Signed-off-by: Xiang Dai <764524258@qq.com>",96,12,0,0,"2018-04-16 10:25:39","367.07"
"grafana/loki","42fb6aed0760668cf932b4e25b062fea583e86f8","daniellee","2018-12-10 21:55:25","false","readme: adds docker instructions

and updates the intro section.

Signed-off-by: Daniel Lee <dan.limerick@gmail.com>",11,8,0,0,"2018-04-16 10:25:39","234.48"
"grafana/loki","926a4e148e20346ec7f9d8b9861a2fef64d8c2c0","kariya-mitsuru","2023-04-14 19:15:07","true","Docs: add missing configuration option (#9092)

**What this PR does / why we need it**:
Promtail can set the tenant id from a label with PR 6290 (commit
a1e0298a5).
However, while docs/sources/clients/promtail/stages/tenant.md was
appropriately updated, docs/sources/clients/promtail/configuration.md
was left untouched.

**Which issue(s) this PR fixes**:

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",81,60,1,0,"2018-04-16 10:25:39","1819.37"
"grafana/loki","7654c27c121048d9022c439779f73c44105f218d","cyriltovena","2019-12-13 21:46:44","true","Adds configurable compression algorithms for chunks (#1411)

* Adds L4Z encoding.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Adds encoding benchmarks

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Adds snappy encoding.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Adds chunk size test

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Adds snappy v2

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Improve benchmarks

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Remove chunkenc

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Update lz4 to latest master version.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Use temporary buffer in serialise method to avoid allocations when doing string -> byte conversion.
It also makes code little more readable. We pool those buffers for reuse.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Added gzip -1 for comparison.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Initialize reader and buffered reader lazily.

This helps with reader/buffered reader reuse.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Don't keep entries, extracted generateData function

(mostly to get more understandable profile)

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Improve test and benchmark to cover all encodings.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Adds support for a new chunk format with encoding info.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Ingesters now support encoding config.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add support for no compression.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add docs

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Remove default Gzip for ByteChunk.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Removes none, snappyv2 and gzip-1

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Move log test lines to testdata and add supported encoding stringer

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* got linted

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",94,20,0,1,"2018-04-16 10:25:39","602.72"
"grafana/loki","46b40a5582a31fd91bce56537f9d6c522682e36c","cstyan","2022-10-27 20:31:37","true","Hardcode ring.WriteNoExtend for distributor push operations (#7517)

With zone awareness enabled we allow restarting multiple ingesters
within a single zone at the same time, this means that for many more
write requests there's potentially only 2 of the 3 replicas for a stream
up at the time the write request is received. This lead to a large
increase in 500s during rollouts.

My suspicion is that the 500s on rollouts was always related to the
following; the replica set ring code has something referred to as
""extending the replica set"". This essentially is the adding of ingesters
in the ring that are not in an ACTIVE state (for example, are in
LEAVING) to the set of replicas considered valid for an operation.
Adding of the instance in a state other than ACTIVE can be controlled by
using a different operation type, which Mimir was using but we were not.
Here are the relevant functions,
[ring.Get](https://github.com/grafana/dskit/blob/8d6d914ef639c45eda4ab6f76448b115dfbc504c/ring/ring.go#L335-L403)
(particularly these lines
[1](https://github.com/grafana/dskit/blob/8d6d914ef639c45eda4ab6f76448b115dfbc504c/ring/ring.go#L381-L389)
and
[2](https://github.com/grafana/dskit/blob/8d6d914ef639c45eda4ab6f76448b115dfbc504c/ring/ring.go#L394-L397))
and
[replicationStrategy.Filter](https://github.com/grafana/dskit/blob/789ec0ca4a3b372335fad1c73147366a23ddc8b6/ring/replication_strategy.go#L22-L71)
(particularly these lines
[1](https://github.com/grafana/dskit/blob/789ec0ca4a3b372335fad1c73147366a23ddc8b6/ring/replication_strategy.go#L32-L36)
and
[2](https://github.com/grafana/dskit/blob/789ec0ca4a3b372335fad1c73147366a23ddc8b6/ring/replication_strategy.go#L54-L67))

The tl; dr of the above code snippets is that we seem to always have
required a minSuccess from replicationFactor/2 + 1 except we overwrite
replicationFactor to be the # of instances which is likely always going
to be more than just 3 ingester replicas because of the replica set
extension. At least for zone aware rollouts this seems to be the case.
This is because many ingesters will be in the LEAVING state. We can
avoid this by just using `WriteNoExtend` operations instead of `Write`
operations
([here](https://github.com/grafana/dskit/blob/789ec0ca4a3b372335fad1c73147366a23ddc8b6/ring/ring.go#L83-L93))

In this PR I've hardcoded our call to the ring in `distributor.Push` to
always use `ring.WriteNoExtend`. IMO this is the better option to
allowing `ring.WriteNoExtend` to be used optionally and defaulting to
`ring.Write`. Extending the replication set on writes feels like a
footgun for write outages and there's even some feelings internally that
allowing that extension is a bug.

For more background information see:
https://github.com/grafana/mimir/issues/1854

Signed-off-by: Callum Styan <callumstyan@gmail.com>

Signed-off-by: Callum Styan <callumstyan@gmail.com>",88,54,1,1,"2018-04-16 10:25:39","1652.42"
"grafana/loki","858109046f479b029449b483c051ee074b5fc4b2","JStickler","2023-03-17 20:56:13","true","TOC Sync: Move grafana file under Visualize. (#8806)

**Which issue(s) this PR fixes**:
Fixes #8716

**Special notes for your reviewer**:
Part of the Database products table of contents alignment project.
Moves topic for Grafana dashboard from Operations to new Visualize
heading in TOC.
Updates front matter for the topic.",85,59,1,0,"2018-04-16 10:25:39","1792.44"
"grafana/loki","c756113bfac208860a763b3ceed4840d5e385d54","arempter","2021-06-22 13:27:47","true","add oauth2 docs options for promtail client (#3829)",104,38,0,0,"2018-04-16 10:25:39","1161.88"
"grafana/loki","b4ed595461d595599a72b90b2ae2aa63b7fe6ebb","MasslessParticle","2022-10-24 09:14:47","true","Remove groupcache (#7126)

As discussed during the caching retro, this PR removes the experimental
distributed cache based on Mailgun's fork of groupcache.

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>
Co-authored-by: Kaviraj <kavirajkanagaraj@gmail.com>",91,54,1,1,"2018-04-16 10:25:39","1648.95"
"grafana/loki","87d04d58a0c574c377dfcf9954617331776349ff","MasslessParticle","2022-06-13 07:46:51","true","Add compactor route for the cache gen number api (#6365)",71,50,0,1,"2018-04-16 10:25:39","1517.89"
"grafana/loki","b2d0481cbeee17355a4305ba48b7517c0cdea080","sandeepsukhani","2023-01-30 15:30:05","true","deletion: fix log deletion with line filters (#8151)",83,57,1,1,"2018-04-16 10:25:39","1745.21"
"grafana/loki","4f8d3240f6ba1d203f4713fe4a7afe109bdb8ee1","MichelHollands","2023-02-23 13:02:18","true","Use 0.28.1 build image and update go and alpine versions (#8583)

**What this PR does / why we need it**:

- Use the 0.28.1 build image
- Update Go version to 1.20.1
- Use Alpine 3.16.4
- Fix linter issues due to updated govet in 1.20.1 
- Modify images to not create `/etc/nsswitch.conf` file anymore
(available by default on Alpine 3.16.4)
- Remove impossible test cases for `TestMemChunk_IteratorBounds`(see
https://github.com/grafana/loki/pull/8591#discussion_r1115020111 for
context)

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>
Signed-off-by: Christian Haudum <christian.haudum@gmail.com>
Co-authored-by: Christian Haudum <christian.haudum@gmail.com>
Co-authored-by: DylanGuedes <djmgguedes@gmail.com>",64,58,1,1,"2018-04-16 10:25:39","1768.11"
"grafana/loki","671afe62bac76df6f8fb125203b53a006f7ad614","MichelHollands","2022-06-14 14:14:59","true","Use correct counter when deleting lines (#6376)

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",67,50,0,1,"2018-04-16 10:25:39","1519.16"
"grafana/loki","c36272e31e5cd44e1316bf9b20a38c6579f60abc","owen-d","2022-02-23 15:57:07","true","Tsdb/idempotent builder (#5424)

* builder chunks uses heap

* idempotent index builder

* remove early return

* pr suggestions

* more thorough equality check on ChunkMetas.finalize",300,46,0,1,"2018-04-16 10:25:39","1402.98"
"grafana/loki","c030217e1ba7d5b6fd700105e53a6db0b02c8076","kavirajk","2023-08-25 16:42:24","true","Revert ""LogQL: Introduce `distinct` (#8662)"" (#10356)

**What this PR does / why we need it**:
This reverts commit 38b298c3fe68004336f078338a548aa6cabb290d.

We are removing this PR #8662 because [known issue tracked
here](https://github.com/grafana/loki/issues/9594) and some issues we
facing internally with query splitting and sharding work(hard to
parallelize, merging two `distinct` sets can have duplicates, hard to
make it work with metric queries, etc).

We decided best to remove it before make it to public release.

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [x] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

---------

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",49,64,1,1,"2018-04-16 10:25:39","1955.51"
"grafana/loki","153bcb05755542c345f92cd65be7b63e63c4aff5","FlorianLudwig","2020-04-15 19:05:55","true","version pin the docker image in docker-compose (#1945)

While the [documentation](https://github.com/grafana/loki/blob/master/docs/installation/docker.md) does version pin the links to specific versions of the docker-compose file, the file it docker-compose file does use the `latest` tag for loki.

For an example of issues this causes see #1941",117,24,0,0,"2018-04-16 10:25:39","724.61"
"grafana/loki","322e4bc6fc59363bbbb258b20b3cf5240563d872","owen-d","2021-01-12 22:45:54","true","updates alerting docs post 2.0 (#3164)

* updates alerting docs post 2.0

* 1s -> 10s",111,33,0,1,"2018-04-16 10:25:39","997.01"
"grafana/loki","9097f1ff42350556cd1ddd5e31cdcc1239d69e7e","owen-d","2023-08-16 15:46:18","true","Sharding optimizations (#10101)

A few bugfixes and more sharding optimizations
* fix bug on `<aggr> by|without ()` groupings which removed the grouping
while downstreaming
* shardable implementations for `max+min`, operation specific merge
strategies which enable many more types of sharded requests, even when
label-reduction is performed at edge.",53,64,1,1,"2018-04-16 10:25:39","1946.47"
"grafana/loki","f6d15fba48c5c69bd28ede308810f77db057a6e0","owen-d","2022-03-09 18:39:11","true","bounds utility for tsdb lib (#5593)",306,47,0,1,"2018-04-16 10:25:39","1419.09"
"grafana/loki","1cbedec0b629d7e761aa0daf3a16fdad547c795a","chaudum","2023-02-06 15:27:40","true","Update fluent-plugin-grafana-loki to Ruby 3.2 (#8421)

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",81,58,1,1,"2018-04-16 10:25:39","1751.21"
"grafana/loki","c032da9639226e1330b19ceb7941de5fa8277a07","owen-d","2022-05-24 14:43:47","true","Tsdb/inverted index (#6233)

* begins adding a factor-of-two dynamically sharded inverted index

* bit prefix inverted index tests

* goimports",73,49,0,1,"2018-04-16 10:25:39","1499.18"
"grafana/loki","352e74791107b273326f39d7807e9f32fc525762","kavirajk","2023-02-01 10:27:44","true","chore: Vendor `runtimeconfig` package patch (#8366)

Includes patch for runtimeconfig manager fix
grafana/dskit#262

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",79,57,1,1,"2018-04-16 10:25:39","1746"
"grafana/loki","678495a972e4371715d7f786e08ed757ee70e98e","cstyan","2021-11-04 20:46:45","true","Instrument s3 client DeleteObject requests. (#4649)

Signed-off-by: Callum Styan <callumstyan@gmail.com>",172,43,0,1,"2018-04-16 10:25:39","1294.18"
"grafana/loki","ce676de0c994bef66efd710e0f9a9bea2b50672d","periklis","2021-10-01 14:29:40","true","Fix latest tags for push to quay action (#87)",138,41,0,1,"2018-04-16 10:25:39","1260.92"
"grafana/loki","e64409540bd5ca7ac9146120ec723d3f69561fdc","bemasher","2020-10-12 12:18:30","true","Doc: Vague link text. (#2698)

* Fixes remove vague link text #2680

* Fix remaining 'docs' links.

* Accept suggestion.

Co-authored-by: Diana Payton <52059945+oddlittlebird@users.noreply.github.com>

* Change HTTP API to Ruler API.

Co-authored-by: Diana Payton <52059945+oddlittlebird@users.noreply.github.com>

* Correct typo.

Co-authored-by: Diana Payton <52059945+oddlittlebird@users.noreply.github.com>

* Capitalize Github.

Co-authored-by: Diana Payton <52059945+oddlittlebird@users.noreply.github.com>

* Capitalize Promtail.

Co-authored-by: Diana Payton <52059945+oddlittlebird@users.noreply.github.com>

* Add copy-edit suggestions from @achatterjee-grafana.

* Incorporate @owen-d's changes.

Co-authored-by: Diana Payton <52059945+oddlittlebird@users.noreply.github.com>",112,30,0,0,"2018-04-16 10:25:39","906.58"
"grafana/loki","25cc9402b7a076be2d3d33a9277233f233d376b0","liguozhong","2022-09-01 08:20:41","true","fix test increase timeout (#7022)

<!--  Thanks for sending a pull request!  Before submitting:

1. Read our CONTRIBUTING.md guide
2. Name your PR as `<Feature Area>: Describe your change`.
  a. Do not end the title with punctuation. It will be added in the changelog.
  b. Start with an imperative verb. Example: Fix the latency between System A and System B.
  c. Use sentence case, not title case.
  d. Use a complete phrase or sentence. The PR title will appear in a changelog, so help other people understand what your change will be.
3. Rebase your PR if it gets out of sync with main
-->

**What this PR does / why we need it**:
increase timeout, fix test fail.
```
--- FAIL: TestInstanceFor (0.01s)
    downstreamer_test.go:205: 
        	Error Trace:	downstreamer_test.go:205
        	            				downstreamer_test.go:256
        	Error:      	lock couldn't be acquired
        	Test:       	TestInstanceFor
FAIL
```

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

<!--
Note about CHANGELOG entries, if a change adds:
* an important feature
* fixes an issue present in a previous release, 
* causes a change in operation that would be useful for an operator of Loki to know
then please add a CHANGELOG entry.

For documentation changes, build changes, simple fixes etc please skip this step. We are attempting to curate a changelog of the most relevant and important changes to be easier to ingest by end users of Loki.

Note about the upgrade guide, if this changes:
* default configuration values
* metric names or label names
* changes existing log lines such as the metrics.go query output line
* configuration parameters 
* anything to do with any API
* any other change that would require special attention or extra steps to upgrade
Please document clearly what changed AND what needs to be done in the upgrade guide.
-->
**Checklist**
- [ ] Documentation added
- [ ] Tests updated
- [ ] Is this an important fix or new feature? Add an entry in the `CHANGELOG.md`.
- [ ] Changes that require user attention or interaction to upgrade are documented in `docs/sources/upgrading/_index.md`",81,52,1,1,"2018-04-16 10:25:39","1595.91"
"grafana/loki","f106c099bd1462a15699539e57085eef8c3a12d1","candlerb","2020-03-06 19:23:02","false","Recommended schema is now v11

Fixes #1778

Signed-off-by: Brian Candler <b.candler@pobox.com>",116,23,0,0,"2018-04-16 10:25:39","685.62"
"grafana/loki","fc60b04ab56f24fa5a6137869e8a885cc0a98997","blockloop","2021-03-19 21:18:23","true","Merge pull request #3 from ViaQ/bjones/add-license

Create LICENSE.txt",169,35,0,0,"2018-04-16 10:25:39","1063.95"
"grafana/loki","3bed7eef55dddfca49251c85844afa286d7fd3ea","darxriggs","2023-03-20 20:29:33","true","chore: Fix typo in ""tcp"" (#8842)",83,59,1,0,"2018-04-16 10:25:39","1795.42"
"grafana/loki","a53477f8e47791da39b29054a4f1f4afbe199dac","owen-d","2020-01-31 20:42:45","true","cache key cant be reused when an interval changes (#1616)",102,21,0,1,"2018-04-16 10:25:39","650.68"
"grafana/loki","ca0fd01f332d7e266e02f2da30189189aed59d8b","vlad-diachenko","2022-07-11 15:41:43","true","bumped version of grafana's memberlist fork to have the fix that allows to disable labels check that is required for the migration. (#6655)",71,51,0,0,"2018-04-16 10:25:39","1546.22"
"grafana/loki","8e38ebb2b76cb9fa6bb087ce732c17f60d2a5e8f","DylanGuedes","2022-11-08 13:12:51","true","Loki: Implement timeouts migration (#7555)

**What this PR does / why we need it**:
Improve the experience of migrating to our new timeouts behavior, which
is the unifying of the engine:timeout and querier:query_timeout into a
new configuration named limits_config:query_timeout.
This PR makes sure users won't be surprised by their timeouts being
shorter, but at the same time, it makes it easier to migrate to the new
configuration.

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>",86,55,1,1,"2018-04-16 10:25:39","1663.12"
"grafana/loki","5970ab9b1ed9f3018db52cebab9e1b1502d32633","bearice","2021-07-22 20:48:39","true","Update _index.md (#4029)

As mentioned in #3259,  permission `s3:ListObjects` is needed,  updating the document.",96,39,0,0,"2018-04-16 10:25:39","1192.18"
"grafana/loki","793a689d1ffd78333fe651d81addfaa180ae8886","bboreham","2023-03-23 20:50:59","true","Iterators: re-implement mergeEntryIterator using loser.Tree for performance (#8637)

**What this PR does / why we need it**:

Building on #8351, this re-implements `mergeEntryIterator` using
`loser.Tree`; the benchmark says it goes much faster but uses a bit more
memory (while building the tree).

```
name                       old time/op    new time/op    delta
SortIterator/merge_sort-4    10.7ms ± 4%     2.9ms ± 2%  -72.74%  (p=0.008 n=5+5)

name                       old alloc/op   new alloc/op   delta
SortIterator/merge_sort-4    11.2kB ± 0%    21.7kB ± 0%  +93.45%  (p=0.008 n=5+5)

name                       old allocs/op  new allocs/op  delta
SortIterator/merge_sort-4      6.00 ± 0%      7.00 ± 0%  +16.67%  (p=0.008 n=5+5)
```

The implementation is very different: rather than relying on iterators
supporting `Peek()`, `mergeEntryIterator` now pulls items into its
buffer until it finds one with a different timestamp or stream, and
always works off what is in the buffer.
The comment `""[we] pop the ones whose common value occurs most often.""`
did not appear to match the previous implementation, and no attempt was
made to match this comment.

A `Push()` function was added to `loser.Tree` to support live-streaming.
This works by finding or making an empty slot, then re-running the
initialize function to find the new winner. A consequence is that the
previous ""winner"" value is lost after calling
`Push()`, and users must call `Next()` to see the next item.

A couple of tests had to be amended to avoid assuming particular
behaviour of the implementation; I recommend that reviewers consider
these closely.

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- NA Documentation added
- [x] Tests updated
- NA `CHANGELOG.md` updated
- NA Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",82,59,1,0,"2018-04-16 10:25:39","1798.43"
"grafana/loki","337db2fedfab25d4c1e9a26d292df496966c92de","sandeepsukhani","2020-09-16 12:17:11","true","revendor cortex to latest master (#2627)",119,29,0,1,"2018-04-16 10:25:39","880.58"
"grafana/loki","e2b25612c825acce8a8ddbdf629a24e307d47d59","gouthamve","2019-04-26 14:25:17","true","Take 2 for fix the limit settings (#519)

* Revert ""Make sure the default for EnforceMetricName is ✅ (#518)""

This reverts commit 199746a130bdc5d21e50612ef49b60e37251548f.

* Fix overrides unmarshalling properly

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>",95,12,0,0,"2018-04-16 10:25:39","375.42"
"grafana/loki","cc9c19846fc9c517d3eec75be032c7f7922dd241","MasslessParticle","2022-07-25 14:24:40","true","Fix cache instrumentation (#6753)",73,51,0,1,"2018-04-16 10:25:39","1560.17"
"grafana/loki","53a89e2eeee8784bc757bf912321aae116ce751c","09jvilla","2022-07-07 22:17:46","true","Draft of release notes for loki 2.6. (#6546)

* Draft of release notes for loki 2.6.

* Apply suggestions from code review

Adding Karen's suggestions.

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>",70,51,0,0,"2018-04-16 10:25:39","1542.49"
"grafana/loki","778c0b68578860057fb053f53d6d847cd56dea0b","joe-elliott","2019-09-25 14:37:13","false","Update loki push path (#1049)

This commit adds a /loki/api/v1/push endpoint to mirror the new v1 API,
and updates all references to the old push endpoint to new the one.",69,17,0,0,"2018-04-16 10:25:39","524.42"
"grafana/loki","a926ae3249a2f9ae034c19328d961898b9328aa6","Red-GV","2023-03-13 14:09:24","true","operator: Update golang to 1.20; Update dependencies to latest (#8776)",87,59,1,1,"2018-04-16 10:25:39","1788.16"
"grafana/loki","bcb800967904ad627371e0067008db8f500b2cce","Red-GV","2022-04-26 04:46:13","true","operator: logerr v2 update (#5987)",170,48,0,1,"2018-04-16 10:25:39","1470.76"
"grafana/loki","bf3bca3e991bb47f8748e4a6d02d98fda9010112","joanlopez","2022-06-30 08:33:34","true","tools: add lambda-promtail missing errchecks (#6541)

* tools: lambda-promtail missing errchecks

* undo undesired changes",73,50,0,0,"2018-04-16 10:25:39","1534.92"
"grafana/loki","21d3e69790d0dcc747c50f1bfb25f2e5f799ee99","owen-d","2020-09-23 16:14:45","true","Enable local rules backend & disallow configdb. (#2661)

* revendors cortex

* vendoring compat

* disallow configdb ruler backend

* go mod tidy",115,29,0,1,"2018-04-16 10:25:39","887.74"
"grafana/loki","f49a510f38fae228c36118bf88441826809ef7bd","MichelHollands","2021-03-24 14:45:04","true","Loki: Update cortex version and fix resulting changes (#3532)

* Update cortex version and fix resulting changes

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Update changelog

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Fix scrapeconfig test

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Tidy up go.sum

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Fix go.sum

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Update pkg/promtail/scrapeconfig/scrapeconfig_test.go

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>

* Remove unused fmt import

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>",143,35,0,1,"2018-04-16 10:25:39","1068.68"
"grafana/loki","1ac7410b78416e25179b4fe589e9035793d67025","MichelHollands","2023-10-16 10:49:20","true","Add local service object (#10907)

**What this PR does / why we need it**:

Otherwise the jsonnet is invalid

**Special notes for your reviewer**:

**Checklist**
- [X] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

Signed-off-by: Michel Hollands <michel.hollands@gmail.com>",25,66,1,1,"2018-04-16 10:25:39","2006.27"
"grafana/loki","0b72ddb6a6bad019981a95055e6c6549f0c12ea2","owen-d","2020-01-06 21:34:00","false","positions.ignore-corruptions (#1472)

* positions.ignore-corruptions

* semantic change: s/ignore-corruptions/ignore-invalid-yaml/

* Update pkg/promtail/positions/positions.go

Co-Authored-By: Robert Fratto <robertfratto@gmail.com>",103,21,0,1,"2018-04-16 10:25:39","625.71"
"grafana/loki","ab3d58a265f16079b79f124b0578a31395463602","chaudum","2023-07-24 07:00:19","true","Add initial delay before starting flush loop (#9995)

**What this PR does / why we need it**:

Delay the first flush operation by up to 0.8x the flush time period.

This will ensure that multiple ingesters started at the same time do not flush at the same time. Flushing at the same time can cause concurrently writing the same chunk to object storage, which in AWS S3 leads to being rate limited.

Additionally, add a +/- 1% jitter to each flush check interval to prevent flushing at the same time for reasons mentioned above.

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",54,63,1,1,"2018-04-16 10:25:39","1924.11"
"grafana/loki","f7e13ccc770961bd2229141b0534a1eeb06d33a2","periklis","2023-05-08 13:18:55","true","operator: Enable Route by default on OpenShift clusters (#9346)",81,61,1,1,"2018-04-16 10:25:39","1848.37"
"grafana/loki","4a564456861c0ab7441b815aa49a7c0f22a05f4c","trevorwhitney","2023-06-12 18:24:29","true","Upgrade `golangci-lint` and fix linting errors (#9601)

**What this PR does / why we need it**:

Upgrade  `golangci-lint` and fixes all the errors. The upgrade includes some stricter linting.",67,62,1,1,"2018-04-16 10:25:39","1882.58"
"grafana/loki","1028a576c3fe9731c55ff14cfa40147e6c67066a","periklis","2021-10-01 14:10:20","true","Fix wrong field in push to quay action (#85)",138,41,0,1,"2018-04-16 10:25:39","1260.91"
"grafana/loki","433d5bf9137d2c2bc608dbcddaa3c018b231263e","garrettlish","2023-02-15 11:37:47","true","fix panics when cloning a special query (#8531)

Signed-off-by: garrettlish <garrett.li.sh@gmail.com>",76,58,1,0,"2018-04-16 10:25:39","1760.05"
"grafana/loki","f91f6a354b5602a686d8db7e871de47467a38f17","periklis","2022-06-15 17:08:37","true","operator: Add support for gRPC over TLS for Loki components (#6224)",68,50,0,1,"2018-04-16 10:25:39","1520.28"
"grafana/loki","71ec533741819defdc23670cb990fbe2d2fd2024","periklis","2021-04-22 16:13:33","true","Add reconciliation for the s3 object storage secret (#33)",165,36,0,1,"2018-04-16 10:25:39","1101.99"
"grafana/loki","7a07d3a9f522b2fd08b3ccc76c13eb26b9cf0923","periklis","2022-07-12 13:29:52","true","operator: Fix kind deployment for make quickstart (#6666)",71,51,0,1,"2018-04-16 10:25:39","1547.13"
"grafana/loki","edd816910d43baec19eb61de91d58c3b42c96b63","woodsaj","2020-09-02 17:05:39","true","fix links in installation docs. (#2591)",119,28,0,0,"2018-04-16 10:25:39","866.78"
"grafana/loki","3d941ccccbcc6109224dce1845f7aaead30d5ddf","simonswine","2022-04-06 14:46:05","true","Update alpine images to 3.15.4 (#5780)",322,48,0,0,"2018-04-16 10:25:39","1445.93"
"grafana/loki","6f46a8ffebf5a2ddf97c20ed1f1ab761745b2f56","KMiller-Grafana","2022-03-01 08:35:37","true","Docs: Fix links and formatting of HTTP API page (#5498)",301,46,0,0,"2018-04-16 10:25:39","1410.67"
"grafana/loki","23cc44888139b902ffdcf7e3c36f6493bad4804c","slim-bean","2022-10-24 19:35:07","true","Loki: log when a query starts in the logql engine (#7469)

Signed-off-by: Edward Welch <edward.welch@grafana.com>

**What this PR does / why we need it**:

There are cases where a query cannot finish (OOM of a querier/ruler) and
most of our logs are emitted upon completion of a query. This can help
us find queries which are OOM crashing a component.

Note: It only covers queries executed by the engine, so only instant and
range queries. Another PR will be necessary to cover labels/series
endpoints. However this approach seemed the best to be able to get this
information from ruler executed queries.

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the `CONTRIBUTING.md` guide
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

Signed-off-by: Edward Welch <edward.welch@grafana.com>",90,54,1,1,"2018-04-16 10:25:39","1649.38"
"grafana/loki","3b02474597dad961d061e34ad7e57e0f44dd3f6d","slim-bean","2019-07-02 12:28:26","false","removing entries.go as we are no longer using the custom Histogram for the log_entries_bytes histogram",97,15,0,1,"2018-04-16 10:25:39","441.34"
"grafana/loki","a369189752106e97891087fe8d00e758d1ac6b20","trevorwhitney","2022-09-06 17:04:04","true","Add nix configuration (#7020)

**What this PR does / why we need it**:

This PR adds nix configuration to the Loki repo to make it easier for people who use nix to integrate building Loki into their existing workflows. For example, I have a `direnv` hook that uses nix shell to make sure I have the correct version of all dependent binaries (ie. `go`, `golangci-lint`, etc) on my `$PATH` whenever I change into the Loki directory. I find this especially useful for building with `CGO` enabled as it requires a C compiler with systemd headers to be available on the path.

Furthermore, by having a `flake.nix` in the root of this repo, it will make it easier for users of the nix package manager to grab a specific version of Loki for their own systems / projects.

This PR does _not_ attempt to replace any existing build processes, this is merely supplemental. All these nix configurations wrap existing `Makefile` targets, and the addition of these files will have no effect on anyone not using nix.

Please see the README.md included in this PR for more information.

**Checklist**
- [X] Documentation added

Co-authored-by: Christian Simon <simon@swine.de>",81,53,1,1,"2018-04-16 10:25:39","1601.28"
"grafana/loki","9c49a0222d75ab937df048fbc4318f8292ecbd84","nahsi","2022-05-31 07:25:54","true","docs: Add Nomad deployment examples (#6258)

* Add Loki monolith example

* Commentout traefik in monolithic setup

* Typos

* Add ruler configuration

* Add loki-simple

* Fix consul prefix

* Add loki-distributed example

* Add missing README

* Add explanation why use Consul Connect and Vault PKI at the same time

* Simplify distributed setup

* Readme small fixes

* Update production/nomad/README.md

* Add Nomad mention

* Commit suggestions

* Add ability to specify Loki version from command line

* Wording fix",73,49,0,0,"2018-04-16 10:25:39","1505.88"
"grafana/loki","f2297d3d2acaa82a4401601e974586367ff345c5","MasslessParticle","2022-10-17 14:43:25","true","Fix result cache misses on sharded queries (#7429)

Headers weren't being propagated from query responses on sharded queries
causing result cache misses. This PR:
- Adds headers to `logproto.Result` so we can save response headers as
they come back from queries
- Metric-query results are turned into numbers well away from where
responses are sent to the frontend: save all headers in the context so
they can be pulled out when the final result is calculated
- Propagate headers in the final responses",89,54,1,1,"2018-04-16 10:25:39","1642.18"
"grafana/loki","96515e31166f79cf552dd9d5ef226ccedebfa562","Duologic","2020-07-20 14:34:45","true","refactor: moved jaeger-agent-mixin (#2377)

* refactor: use jaeger-agent-mixin

lib got moved: https://github.com/grafana/jsonnet-libs/pull/291

used jb-0.4.0 which updates the jsonnetfile.json format

* refactor: use jb-0.4.0 jsonnetfile.json format",116,27,0,0,"2018-04-16 10:25:39","824.67"
"grafana/loki","4558c270de42dc1505c16a2238bbb1520883e9c0","tomwilkie","2018-04-16 10:32:17","false","Add basic CirclCI config.",0,0,0,0,"2018-04-16 10:25:39","0"
"grafana/loki","ca51127592bfd34b6b579110ae4fa2f4f9f83a33","alainpham","2023-04-21 15:00:52","true","POST /loki/api/v1/push should not be on query path (#9220)

POST /loki/api/v1/push is on the write path on the distributor and
should not be the query frontend (read path)",79,60,1,0,"2018-04-16 10:25:39","1831.44"
"grafana/loki","215f37cfa3050e3ef753fe5eff482babfad79215","grafanabot","2023-02-28 19:25:57","true","[CI/CD] Update yaml file `./production/helm/loki/values.yaml` (+1 other) (#8655)

**Here is a summary of the updates contained in this PR:**
***
Update attribute `$.enterprise.version` in yaml file
`./production/helm/loki/values.yaml` to the following value: `v1.6.2`
***
Bump version of Helm Chart
Add changelog entry to `./production/helm/loki/CHANGELOG.md`
Re-generate docs

Co-authored-by: Dylan Guedes <djmgguedes@gmail.com>",70,58,1,0,"2018-04-16 10:25:39","1773.38"
"grafana/loki","4456b7561bba0dc66009e3bb2e6b7bb2169812bd","Sheikh-Abubaker","2023-09-11 21:49:24","true","Corrected typo in index.md file (#10546)

**What this PR does / why we need it**:

Hi there I was just going through some documentations to get some idea
over an issue currently I am trying to resolve, it was then when I came
across this typo and corrected it.",43,65,1,0,"2018-04-16 10:25:39","1971.72"
"grafana/loki","72aec6a38b6975443c7eeb7057938b8775c7e4fd","dannykopping","2022-09-20 20:59:36","true","Document validation & rate-limit errors (#7145)

This PR adds documentation for the various validation & rate-limit
errors that can occur when sending logs to Loki.",88,53,1,1,"2018-04-16 10:25:39","1615.44"
"grafana/loki","1bcf683513b5e11fb1dcc5625761b9760cfbd958","periklis","2023-03-30 13:26:06","true","Expose optional label matcher for label values handler (#8824)",83,59,1,1,"2018-04-16 10:25:39","1805.13"
"grafana/loki","0030cafb167fd70375399599acd8568c9290746e","jeschkies","2023-03-30 13:33:06","true","Remove dedupe cache from operations documentation. (#8957)",83,59,1,1,"2018-04-16 10:25:39","1805.13"
"grafana/loki","c81975bd9c1407459267a2c0882fcce809aee3bd","periklis","2023-03-29 09:36:19","true","operator: Fix calculator dockerfile (#8931)",85,59,1,1,"2018-04-16 10:25:39","1803.97"
"grafana/loki","907450c9c356134391ae5e9bc801e16ccbd138d0","jeschkies","2023-01-12 08:29:32","true","Enhance sizing tool documentation. (#8079)",100,57,1,1,"2018-04-16 10:25:39","1726.92"
"grafana/loki","95ec71016883e185e896e77a7fe9eda141a84165","jeschkies","2022-12-09 14:13:50","true","Introduce sizing tool to documentation page. (#7830)

**What this PR does / why we need it**:
The sizing tool should help to find a good cluster sizing when starting
out with Loki. It's a dynamic form withing the documentation.


![image](https://user-images.githubusercontent.com/2418440/205147901-1fe86403-60af-4639-8ce3-9a192549900b.png)

This pull request will be followed by help on hover.

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the `CONTRIBUTING.md` guide
- [x] Documentation added
- [x] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

Co-authored-by: Karsten Jeschkies <karste.jeschkies@grafana.com>",95,56,1,1,"2018-04-16 10:25:39","1694.16"
"grafana/loki","fee23745328cf4ff6f1cf274c15226c4f1abfd98","stevendungan","2022-12-06 15:43:52","true","Update v2-7.md (#7857)",95,56,1,0,"2018-04-16 10:25:39","1691.22"
"grafana/loki","bd58352439b9f167ada08bfea73733c62e0ca471","rfratto","2022-12-04 17:40:04","true","Update build image references to 0.25.0 (#7848)

cc @slim-bean",96,56,1,1,"2018-04-16 10:25:39","1689.3"
"grafana/loki","e537cb52d34b35c85a9dcfa445a47972179e9f29","vmax","2022-11-07 14:54:22","true","[Helm] fix typos in parameter descriptions (#7527)

**What this PR does / why we need it**:

Fixes typos in metrics-related Helm chart parameter descriptions.

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the `CONTRIBUTING.md` guide
- [x] Documentation added
- [x] Tests updated
- [x] `CHANGELOG.md` updated
- [x] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",88,55,1,0,"2018-04-16 10:25:39","1662.19"
"grafana/loki","9b1a427c5b97655ad9152b3ff2e31a2a84ba4e8b","periklis","2023-03-17 10:44:56","true","operator: Add support for memberlist bind network configuration (#8672)

Co-authored-by: Robert Jacob <xperimental@solidproject.de>",85,59,1,1,"2018-04-16 10:25:39","1792.01"
"grafana/loki","0295fd469846b138e6d44a855f6d47f72ebff1c2","liguozhong","2023-03-17 21:19:05","true","[new feature] promtail: Add a Promtail stage for probabilistic sampling (#7127)

<!--  Thanks for sending a pull request!  Before submitting:

1. Read our CONTRIBUTING.md guide
2. Name your PR as `<Feature Area>: Describe your change`.
a. Do not end the title with punctuation. It will be added in the
changelog.
b. Start with an imperative verb. Example: Fix the latency between
System A and System B.
  c. Use sentence case, not title case.
d. Use a complete phrase or sentence. The PR title will appear in a
changelog, so help other people understand what your change will be.
3. Rebase your PR if it gets out of sync with main
-->

**What this PR does / why we need it**:

The sampling stage can be directly sampled.
The implementation of sampling is to use the algorithm in jaeger go
client
```
pipeline_stages:
- sampling:
     rate: 0.1
```
or it can be used with match for precise sampling.
```
pipeline_stages:
- json:
    expressions:
      app:
- match:
    pipeline_name: ""app2""
    selector: ""{app=\""poki\""}""
    stages:
    - sampling:
        rate: 0.1
```

**Which issue(s) this PR fixes**:
Fixes #6654

**Special notes for your reviewer**:

The promtail 'rate' stage is also used with the 'match' stage for log
filtering.This design makes the code very clean.
Other log agents vector have log filtering built into the sampling
operator, which I think is too complicated
https://vector.dev/docs/reference/configuration/transforms/sample/
```
 transforms:
  my_transform_id:
    type: sample
    inputs:
      - my-source-or-transform-id
    exclude: null
    rate: 10
```

'rate' stage review suggestions .
https://github.com/grafana/loki/pull/5051

![image](https://user-images.githubusercontent.com/9583245/189461481-6ee4d835-2573-4b8e-8dec-2814620d758a.png)

<!--
Note about CHANGELOG entries, if a change adds:
* an important feature
* fixes an issue present in a previous release, 
* causes a change in operation that would be useful for an operator of
Loki to know
then please add a CHANGELOG entry.

For documentation changes, build changes, simple fixes etc please skip
this step. We are attempting to curate a changelog of the most relevant
and important changes to be easier to ingest by end users of Loki.

Note about the upgrade guide, if this changes:
* default configuration values
* metric names or label names
* changes existing log lines such as the metrics.go query output line
* configuration parameters 
* anything to do with any API
* any other change that would require special attention or extra steps
to upgrade
Please document clearly what changed AND what needs to be done in the
upgrade guide.
-->
**Checklist**
- [x] Documentation added
- [x] Tests updated
- [ ] Is this an important fix or new feature? Add an entry in the
`CHANGELOG.md`.
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

---------

Co-authored-by: J Stickler <julie.stickler@grafana.com>",84,59,1,1,"2018-04-16 10:25:39","1792.45"
"grafana/loki","254fbf72c438d22214506b9f88be67ffabe1309a","periklis","2023-03-14 12:46:38","true","operator: Expand OLM skip range for OpenShift Logging 5.7 release (#8791)",89,59,1,1,"2018-04-16 10:25:39","1789.1"
"grafana/loki","ea6abbfd079f79dcc0d019bf1691a6a3a9803a8f","DylanGuedes","2023-03-07 21:25:54","true","Loki-Mixin: Remove query-readiness panel (#8735)

**What this PR does / why we need it**:
Remove from loki-mixin the panel that shows the query_readiness metric.
The metric was removed a while ago.",84,59,1,1,"2018-04-16 10:25:39","1782.46"
"grafana/loki","d4a6b159fab621e4072a5173ce082d7f5d54ec13","chaudum","2023-02-24 07:26:55","true","chore: Cleanup label extraction expression (#8596)

The aim of this is to remove redundancy from the parser grammar and make the expression name more descriptive.

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",63,58,1,1,"2018-04-16 10:25:39","1768.88"
"grafana/loki","135f672c9178cf11eb55d8901ec41f96edd87ec5","srstsavage","2022-06-03 15:31:58","true","fix: allow promtail docker_sd_config to handle long log lines (#6256)

In promtail's docker_sd_config, parsing of a container's
logs would fail if any log line was over 64k bytes in length.
This is because bufio.Scanner uses a 64k buffer by default.
Since there doesn't appear to be a way to elegantly catch
`bufio.ErrTooLong` and carry on, the parsing approach was changed
to bufio.Reader which can handle lines of arbitrary length.",72,50,0,0,"2018-04-16 10:25:39","1508.21"
"grafana/loki","f031427bec4a4c5fc7bb0a6e77e6acd734336b36","KMiller-Grafana","2022-04-29 09:32:02","true","Docs: PR 5387 redo - Warn ECS users to avoid plain text creds (#6051)",94,48,0,0,"2018-04-16 10:25:39","1473.96"
"grafana/loki","65c6e254bd22151ab7fc84ec46e13eee2e354aa0","trevorwhitney","2022-05-25 23:05:34","true","Add upgrade guide regarding azure container name change (#6118)

* Add upgarde guide regarding azure container name change

* Add loki header to master upgrade section",74,49,0,1,"2018-04-16 10:25:39","1500.53"
"grafana/loki","fe7ced807bb32cb7de63dc77ee470c9dfb04a14a","DylanGuedes","2022-05-19 08:36:20","true","Fix CHANGELOG entries. (#6193)

- The compactor address entry wasn't part of v2.5.0, so I moved it to
  the main section instead
- Two PRs were linking to a wrong PR link",72,49,0,1,"2018-04-16 10:25:39","1493.92"
"grafana/loki","756fc19577d869c12a9c91eb00080f181539b83e","owen-d","2022-05-06 16:43:17","true","fix mutability bug with labels during tsdb flushing (#6116)",74,49,0,1,"2018-04-16 10:25:39","1481.26"
"grafana/loki","76c1198d587101a88a784ac9553a6bf7e476910e","thepalbi","2022-09-08 15:23:36","true","Improvements to Promtail GCP push target (#7057)

<!--  Thanks for sending a pull request!  Before submitting:

1. Read our CONTRIBUTING.md guide
2. Name your PR as `<Feature Area>: Describe your change`.
a. Do not end the title with punctuation. It will be added in the
changelog.
b. Start with an imperative verb. Example: Fix the latency between
System A and System B.
  c. Use sentence case, not title case.
d. Use a complete phrase or sentence. The PR title will appear in a
changelog, so help other people understand what your change will be.
3. Rebase your PR if it gets out of sync with main
-->
**What this PR does / why we need it**:
This PR includes some pending improvements to newish promtail GCP push
target:
- Pending low hanging optimization for replacing a regex that gets
evaluated on every incoming request from GCP, for a simpler solution.
[Related
comments](https://github.com/grafana/loki/pull/6777#discussion_r935804383)
- Some small refactors. See:
[this](https://github.com/grafana/loki/pull/6777#pullrequestreview-1059064564)
- Add some validations over the payload the target receives. Payload
details are [here](https://cloud.google.com/pubsub/docs/push). This PR
adds just validation over the log line, the incoming GCP message ID to
add some traceability if needed, and the subscription name because it
can be used as label.
- Add `subscription` GCP payload field as label, which includes the
PubSub subscription identifier.
- Add `cause` label to error metrics. Since there's multiple failure
point this might help debugging / notice strange behaviours.

Also, by running the push target in some dev workloads, we noticed it
has some labels different to the ones added in the pull target. This PR
also refactors the logic to re-use the same GCP log entry parsing logic
in both targets. That way the labels exposed to the user in the push
target are $Labels_{pull} \cup Labels_{push}$.

**Which issue(s) this PR fixes**:
Related to: https://github.com/grafana/cloud-onboarding/issues/2067

**Special notes for your reviewer**:
This PR is a follow up [this other
one](https://github.com/grafana/loki/pull/6777). It works on some
comments made after merge, and adds some changes we saw necessary upon
running this target in real environments.
<!--
Note about CHANGELOG entries, if a change adds:
* an important feature
* fixes an issue present in a previous release, 
* causes a change in operation that would be useful for an operator of
Loki to know
then please add a CHANGELOG entry.

For documentation changes, build changes, simple fixes etc please skip
this step. We are attempting to curate a changelog of the most relevant
and important changes to be easier to ingest by end users of Loki.

Note about the upgrade guide, if this changes:
* default configuration values
* metric names or label names
* changes existing log lines such as the metrics.go query output line
* configuration parameters 
* anything to do with any API
* any other change that would require special attention or extra steps
to upgrade
Please document clearly what changed AND what needs to be done in the
upgrade guide.
-->
**Checklist**
- [x] Documentation added
- [x] Tests updated
- [ ] Is this an important fix or new feature? Add an entry in the
`CHANGELOG.md`.
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

Co-authored-by: Kaviraj Kanagaraj <kavirajkanagaraj@gmail.com>",85,53,1,0,"2018-04-16 10:25:39","1603.21"
"grafana/loki","908692794da082a96a40c03c94d2aadeac6971b3","xperimental","2022-03-24 10:35:56","true","operator: Update operator-sdk to 1.18.1 (#5704)",310,47,0,1,"2018-04-16 10:25:39","1433.76"
"grafana/loki","65e3148bc97159a2efaefdc0bcc5e2fa88c40870","MichelHollands","2022-06-07 13:03:47","true","Update delete integration test (#6192)

* Add wait until processed

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Add query lines

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Remove Cortex reference

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Add deleted lines metric and check in test

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Set negative cancel period so default 1 minute delay is compensated for

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Reduce timeout

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Add helper function

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Comment out assertions that only work with flush

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Remove unused metric type param

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Check counter in unit test

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Rename ClientOption to Option as per the linter

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Remove redundant check

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* fill in MsgAndArgs field of test assertion

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",73,50,0,1,"2018-04-16 10:25:39","1512.11"
"grafana/loki","b6e600372423d34807cada5261a09ba931545d7d","simonswine","2022-03-16 07:39:25","true","Remove unused storage gateway references (#5627)",304,47,0,0,"2018-04-16 10:25:39","1425.63"
"grafana/loki","fef99775ea8e2b5ebd16aef5d40d261b823e8149","owen-d","2021-07-19 07:19:27","true","aligns rule path in docker img with bundled config. closes #3952 (#3997)",107,39,0,1,"2018-04-16 10:25:39","1188.62"
"grafana/loki","0d27c21dd4cfb30892a1ea758d234b1bf87f9386","KMiller-Grafana","2021-06-09 07:04:10","true","Doc updates: (#3823)

- Revise section titles
- Add weight metadata to specify ordering of subsections
- Remove TOC info from content prose, as it is already in the right side navigation panel
- Remove a redundant section about upgrading.",203,38,0,0,"2018-04-16 10:25:39","1148.61"
"grafana/loki","3bb7f52f1f92e851155188cccc9a6006c05de8c2","nvtkaszpir","2021-01-22 18:51:41","true","Fix: Update docs for logcli (#3212)

* Update docs for logcli

Fix description for logcli, use proper flag names.
Extend docs with example using timestamp.

Signed-off-by: Michał Sochoń <kaszpir@gmail.com>

* Update cmd/logcli/main.go

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>",118,33,0,0,"2018-04-16 10:25:39","1006.85"
"grafana/loki","ee9c629f51f01d04ce7b464c5579e5195fda3172","owen-d","2021-01-04 14:55:55","true","wal docs (#3026)",110,32,0,1,"2018-04-16 10:25:39","988.69"
"grafana/loki","1eb86d4b5f23f4ea6df666fe2ae92c226a25db2b","owen-d","2020-11-04 12:47:01","true","Only applies entry limits to non-SampleExprs. (#2850)

* only applies entry limits to non-SampleExprs. updates docs

* fixes some test case formatting",128,31,0,1,"2018-04-16 10:25:39","928.6"
"grafana/loki","fffcfa6e814fd3e2128cb67125bcabcdabc2df31","dvrkps","2020-10-05 20:24:27","true","fix some misspells (#2725)",116,30,0,0,"2018-04-16 10:25:39","899.92"
"grafana/loki","2f5da72877468d2b60c408b81729cf9641f33a29","owen-d","2020-02-11 21:22:27","true","maintainer links & usernames (#1675)",113,22,0,1,"2018-04-16 10:25:39","660.71"
"grafana/loki","973b96d0945c94d41f4487aeec4c97c350c4638a","takanabe","2020-02-07 15:10:13","true","Unite docs for fluentd plugin (#1634)

* Use original README.md for fluentd plugin explanations

`doc/client/fluentd.m` includes obsolete explanations and it confuses new users.
For example, label_keys option was removed at https://github.com/grafana/loki/pull/1186
but `fluentd.md` has the explanation.

It's simple to maitain `fluentd/fluent-plugin-grafana-loki/README.md` for
the explantion of the output plugin and use the link when we share how to use it.

* Remove `label_keys` option and simplify usage for `drop_single_key`

* Fix environment variable: FLUENT_CONFIG -> FLUENTD_CONFIG

`docker-compose up` fails due to the wrong environment variable
specifying the fluentd config. As a result this causes the following error

```
docker-compose up --build
WARNING: The LOKI_USERNAME variable is not set. Defaulting to a blank
string.
WARNING: The LOKI_PASSWORD variable is not set. Defaulting to a blank
string.
Building fluentd
Step 1/17 : FROM fluent/fluentd:v1.3.2-debian
 ---> 4790aaf4d1e5
Step 2/17 : USER root
 ---> Using cache
 ---> 7b54da6cec9e
Step 3/17 : WORKDIR /home/fluent
 ---> Using cache
 ---> a161d2fcf64b
Step 4/17 : ENV PATH /fluentd/vendor/bundle/ruby/2.3.0/bin:$PATH
 ---> Using cache
 ---> b67529aad0b5
Step 5/17 : ENV GEM_PATH /fluentd/vendor/bundle/ruby/2.3.0
 ---> Using cache
 ---> 3a8b05beb185
Step 6/17 : ENV GEM_HOME /fluentd/vendor/bundle/ruby/2.3.0
 ---> Using cache
 ---> d68a94345cb4
Step 7/17 : ENV FLUENTD_DISABLE_BUNDLER_INJECTION 1
 ---> Using cache
 ---> 70f9bbf646e8
Step 8/17 : COPY docker/Gemfile* /fluentd/
 ---> Using cache
 ---> 5f8b2f6ffe1a
Step 9/17 : RUN buildDeps=""sudo make gcc g++ libc-dev ruby-dev""
&& apt-get update        && apt-get install -y --no-install-recommends
$buildDeps libsystemd0 net-tools libjemalloc1        && gem install
bundler --version 1.16.2        && bundle config silence_root_warning
true        && bundle install --gemfile=/fluentd/Gemfile
--path=/fluentd/vendor/bundle        && sudo gem sources --clear-all
&& SUDO_FORCE_REMOVE=yes        apt-get purge -y --auto-remove        -o
APT::AutoRemove::RecommendsImportant=false        $buildDeps        &&
rm -rf /var/lib/apt/lists/*
/home/fluent/.gem/ruby/2.3.0/cache/*.gem        /tmp/* /var/tmp/*
/usr/lib/ruby/gems/*/cache/*.gem
 ---> Using cache
 ---> 36c960a53c2c
Step 10/17 : COPY docker/entrypoint.sh /fluentd/entrypoint.sh
 ---> Using cache
 ---> 7f8d72ae63ca
Step 11/17 : COPY lib/fluent/plugin/out_loki.rb
/fluentd/plugins/out_loki.rb
 ---> Using cache
 ---> d09473ee4f25
Step 12/17 : COPY docker/conf/ /fluentd/etc/loki/
 ---> Using cache
 ---> 00d0439ef3c8
Step 13/17 : ENV FLUENTD_CONF=""/fluentd/etc/loki/fluentd.conf""
 ---> Using cache
 ---> 2d33a002baaf
Step 14/17 : ENV FLUENTD_OPT=""""
 ---> Using cache
 ---> c314df064756
Step 15/17 : ENV LOKI_URL ""https://logs-us-west1.grafana.net""
 ---> Using cache
 ---> df78c829d416
Step 16/17 : ENV LD_PRELOAD=""/usr/lib/x86_64-linux-gnu/libjemalloc.so.1""
 ---> Using cache
 ---> 3d7d14cf37f5
Step 17/17 : ENTRYPOINT [""/fluentd/entrypoint.sh""]
 ---> Using cache
 ---> 82c70c2354ac
Successfully built 82c70c2354ac
Successfully tagged fluentd:loki
Starting docker_fluentd_1 ... done
Attaching to docker_fluentd_1
fluentd_1  |
/fluentd/vendor/bundle/ruby/2.3.0/gems/fluentd-1.6.2/lib/fluent/supervisor.rb:769:in
`initialize': No such file or directory @ rb_sysopen -
/fluentd/etc/loki/fluentd.conf (Errno::ENOENT)
fluentd_1  |    from
/fluentd/vendor/bundle/ruby/2.3.0/gems/fluentd-1.6.2/lib/fluent/supervisor.rb:769:in
`open'
fluentd_1  |    from
/fluentd/vendor/bundle/ruby/2.3.0/gems/fluentd-1.6.2/lib/fluent/supervisor.rb:769:in
`read_config'
fluentd_1  |    from
/fluentd/vendor/bundle/ruby/2.3.0/gems/fluentd-1.6.2/lib/fluent/supervisor.rb:479:in
`run_supervisor'
fluentd_1  |    from
/fluentd/vendor/bundle/ruby/2.3.0/gems/fluentd-1.6.2/lib/fluent/command/fluentd.rb:314:in
`<top (required)>'
fluentd_1  |    from
/usr/lib/ruby/2.3.0/rubygems/core_ext/kernel_require.rb:55:in `require'
fluentd_1  |    from
/usr/lib/ruby/2.3.0/rubygems/core_ext/kernel_require.rb:55:in `require'
fluentd_1  |    from
/fluentd/vendor/bundle/ruby/2.3.0/gems/fluentd-1.6.2/bin/fluentd:8:in
`<top (required)>'
fluentd_1  |    from /fluentd/vendor/bundle/ruby/2.3.0/bin/fluentd:22:in
`load'
fluentd_1  |    from /fluentd/vendor/bundle/ruby/2.3.0/bin/fluentd:22:in
`<main>'
docker_fluentd_1 exited with code 1
```

* Use docs/clients/fluentd/README.md for fluent-plugin-grafana-loki explanation

* Arrange list order based on number

* Revert ""Fix environment variable: FLUENT_CONFIG -> FLUENTD_CONFIG""

This reverts commit 8ed58ac97a82d5536321fb9a76120fed766ae506.

* Elaborate the way to use docker image

* Fix grammar: remove unnecessary with

* Add disclaimer for multi-worker usage",112,22,0,0,"2018-04-16 10:25:39","656.45"
"grafana/loki","3fb316e4dd56ef4460129ce1d30c87e5c554f7dc","slim-bean","2020-04-15 15:27:15","false","Reverting helm changes which were included in Cortex 1.0 vendor upgrade because it resulted in us pushing an unstable helm.",120,24,0,1,"2018-04-16 10:25:39","724.46"
"grafana/loki","dac8615f39d4c65f6d5b37238ffc3e07c659d683","pstibrany","2020-03-11 13:17:22","true","Convert module names to string. This allows us to remove bit of a code. (#1794)

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>",119,23,0,0,"2018-04-16 10:25:39","690.37"
"grafana/loki","f9ff2a4b02832c7495f890abd2d73f4c8d44f1af","adityacs","2020-02-18 21:19:29","true","Add goimport local-prefixes configuration to .golangci.yml (#1710)",116,22,0,1,"2018-04-16 10:25:39","667.7"
"grafana/loki","52931a1bc55b072ca00d013dd35d6f4c69951342","rfratto","2020-01-06 21:26:39","true","pkg/querier: don't query all ingesters (#1473)

This commit uses ReplicationSet.Do for communicating with the ingesters
from the queriers. This mimics the behavior of Cortex. An
extra_query_delay flag has been added to match the flag present in
Cortex's querier config.

Fixes #1447.",104,21,0,1,"2018-04-16 10:25:39","625.71"
"grafana/loki","9979321c2a9e5ff51754ef3b6b045e71ed8dee85","pstibrany","2019-12-15 09:12:53","false","Don't pool LZ4 readers that read big blocks.

Such readers must have allocated twice as many bytes as the block size,
and we don't want to pool them and keep that memory allocated.

This can happen when reading chunks that were compressed with high buffer
size.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>",91,20,0,0,"2018-04-16 10:25:39","604.2"
"grafana/loki","82caa52d396ee6b454d5f285d0425e98e34271f4","jgehrcke","2019-12-02 14:13:00","false","authentication.md: replace ""user"" with ""tenant"" (#1223)",91,19,0,0,"2018-04-16 10:25:39","591.41"
"grafana/loki","fd25e6d180009e3fc80642f81d07e470ba6546e9","pstibrany","2019-11-21 14:19:51","false","Write positions to new file first, move to target destination afterwards. (#1304)

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>",76,19,0,0,"2018-04-16 10:25:39","580.41"
"grafana/loki","3b802b2ce12543b34db22459177fb6205b34bcc3","AndersonQ","2019-10-28 21:37:49","false","AWS EKS: Update the AWS Go SDK to version v1.23.13 (#1182)

Fixes: #1019",70,18,0,0,"2018-04-16 10:25:39","557.72"
"grafana/loki","66d3e00981cd616ecd76bbe54b39c09cef3cd691","MichelHollands","2022-06-23 14:36:51","true","Changelog: Fix changelog link (#6479)

* Fix changelog link

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Add to changes section

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Remove from main section

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",69,50,0,1,"2018-04-16 10:25:39","1528.17"
"grafana/loki","7d63795350a23caa23aa2eeae446b65712011912","cyriltovena","2019-07-24 14:47:59","false","fix linter & better comments",102,15,0,1,"2018-04-16 10:25:39","463.43"
"grafana/loki","da4964dd7039c0152e779e33116738d65bc3df18","adityacs","2019-08-12 10:32:52","false","Add pipeline unit testing to promtail",102,16,0,1,"2018-04-16 10:25:39","481.26"
"grafana/loki","4db80b250585f93d9b1f3fb0ff19779ec69f037d","sh0rez","2019-08-01 16:13:18","true","chore(packaging): add muslc to build-image (#834)",107,15,0,0,"2018-04-16 10:25:39","470.49"
"grafana/loki","a22be1785933830603648b2b8ab466e7e8ecadac","pracucci","2019-08-01 14:08:21","false","Fix prefetch in HeapIterator when Len() or Peek() are called as first methods",106,15,0,0,"2018-04-16 10:25:39","470.4"
"grafana/loki","687cb0633532e7b326727cd3ec31b1e31735c8e9","tomwilkie","2018-05-18 18:35:45","false","Print common labels out fist.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",0,1,0,0,"2018-04-16 10:25:39","32.34"
"grafana/loki","18b640fa4ba3ea0b903300218a34531fdba38b75","daixiang0","2019-04-16 06:03:22","false","Update troubleshooting doc

Signed-off-by: Xiang Dai <764524258@qq.com>",101,12,0,0,"2018-04-16 10:25:39","359.82"
"grafana/loki","209b281593b2cfee0c69d4bba77c5f7375fe6e04","MasslessParticle","2022-12-16 20:27:14","true","Fix min and max aggregations when using instant queries. (#7957)

Instant queries use the new `streamRangeVectorIterator` which has a new
set of `aggregators`. Before, aggregations were based on the first point
in the range to be aggregated. With `streamRangeVectorIterator`, points
are instead treated one at a time.

The aggregations were simply checking whether the value was less than
the min or greater than the max without any initialization. This PR
fixes these aggregations by initializing `min` or `max` to `math.Nan` so
the first point is always considered.",97,56,1,1,"2018-04-16 10:25:39","1701.42"
"grafana/loki","46af2cdcf1accb55afdeebaa6ccbeae31f79915e","darxriggs","2023-04-03 11:09:33","true","Promtail: Prevent logging errors on normal shutdown (#8988)

**What this PR does / why we need it**:
Since PR #4066 two messages are logged for the errors `ErrExpired` and
`EOF`, whereas nothing has been logged beforehand.

As `ErrExpired` is returned by the `JournalReader` after sending a
message to the `until` channel to signal a normal stop, this should not
be logged as an error.",81,59,1,0,"2018-04-16 10:25:39","1808.03"
"grafana/loki","acb18b4f5d120a38d23e0144bc433260abb1a229","mattmendick","2020-01-30 20:43:56","true","Update codecov to add informational flag (#1614)

Setting the `informational` flag for the project so that we don't mark the checks as failed if the patch percentage is 0. See https://github.com/grafana/loki/pull/1612/commits for an example of a failure when it should really just tell us the information.",104,21,0,0,"2018-04-16 10:25:39","649.68"
"grafana/loki","b45efd4c2df0d54ed984a11777a5c24fc076a58c","owen-d","2022-05-05 11:03:33","true","TSDB shipper + WAL (#6049)

* begins speccing out TSDB Head

* auto incrementing series ref + mempostings

* mintime/maxtime methods

* tsdb head IndexReader impl

* head correctly populates ref lookup

* tsdb head tests

* adds prometheus license to tsdb head

* linting

* [WIP] speccing out tsdb head wal

* fix length check and adds tsdb wal encoding tests

* exposes wal structs & removes closed semantics

* logs start time in the tsdb wal

* wal interface + testing

* exports walrecord + returns ref when appending

* specs out head manager

* tsdb head manager wal initialization

* tsdb wal rotation

* wals dont use node name, but tsdb files do

* cleans up fn signature

* multi tsdb idx now just wraps Index interfaces

* no longer sorts indices when creating multi-idx

* tenantHeads & HeadManger index impls

* head mgr tests

* bugfixes & head manager tests

* tsdb dir selection now helper fns

* period utility

* pulls out more code to helpers, fixes some var races

* head recovery is more generic

* tsdb manager builds from wals

* pulls more helpers out of headmanager

* lockedIdx, Close() on idx, tsdbManager update

* removes mmap from index reader implementation

* tsdb file

* adds tsdb shipper config and refactors initStore

* removes unused tsdbManager code

* implements stores.Index and stores.ChunkWriter for tsdb

* chunk.Data now supports an Entries() method

* moves walreader to new util/wal pkg to avoid circular dep + tsdb storage alignment

* tsdb store

* passes indexWriter to chunkWriter

* build a tsdb per index bucket in according with shipper conventions

* dont open tsdb files until necessary for indexshipper

* tsdbManager Index impl

* tsdb defaults + initStore fix for invalid looping

* fixes UsingTSDB helper

* disables deleteRequestStore when using TSDB

* pass limits to tsdb store

* always start headmanager for tsdb
Signed-off-by: Owen Diehl <ow.diehl@gmail.com>

* fixes copy bug
Signed-off-by: Owen Diehl <ow.diehl@gmail.com>

* more logging
Signed-off-by: Owen Diehl <ow.diehl@gmail.com>

* fixes duplicate tenant label bug
Signed-off-by: Owen Diehl <ow.diehl@gmail.com>

* debug logs, uses label builder, removes __name__=logs for tsdb
Signed-off-by: Owen Diehl <ow.diehl@gmail.com>

* tsdb fixes labels at earlier pt
Signed-off-by: Owen Diehl <ow.diehl@gmail.com>

* account for setting tenant label in head manager test

* changing tsdb dir names

* identifier interface, builder to tsdb pkg

* tsdb version path prefix

* fixes buildfromwals identifier

* fixes tsdb shipper paths

* split buckets once per user set

* refactors combining single and multi tenant tsdb indices on shipper reads

* indexshipper ignores old gzip logic

* method name refactor

* remove unused record type

* removes v1 prefix in tsdb paths and refactores indices method

* ignores double optimization in tsdb looking for multitenant idx, shipper handles this

* removes 5-ln requirement on shipper tablename regexp

* groups identifiers, begins removing multitenant prefix in shipped files

* passses open fn to indexshipper

* exposes RealByteSlice

* TSDBFile no longer needs a file descriptor, parses gzip extensions

* method signature fixing

* stop masquerading as compressed indices post-download in indexshipper

* variable bucket regexp

* removes accidental configs committed

* label matcher handling for multitenancy and metricname in tsdb

* explicitly require fingerprint when creating tsdb index

* only add tenant label when creating multitenant tsdb

write fingerprints without synthetic tenant label

strip out tenant labels from queries

* linting + unused removal

* more linting :(

* goimports

* removes uploadername from indexshipper

* maxuint32 for arm32 builds

* tsdb chunk filterer support

* always set ingester name when using object storage index

Co-authored-by: Sandeep Sukhani <sandeep.d.sukhani@gmail.com>",75,49,0,1,"2018-04-16 10:25:39","1480.03"
"grafana/loki","3161d995b2f946859eac2f674efc42b7fa47a5db","simonswine","2022-06-09 06:04:35","true","Update gopkg.in/yaml.v3 (#6284)

This updates to a version that contains the fix to CVE-2022-28948.",73,50,0,0,"2018-04-16 10:25:39","1513.82"
"grafana/loki","eeafa067b9e40446e779ad6f1d70461d362f8753","blockloop","2021-03-12 19:54:16","true","wip",157,35,0,0,"2018-04-16 10:25:39","1056.89"
"grafana/loki","af287ac3eba46e04ad1d5cf8051262ea0f2a25de","salvacorts","2023-06-07 09:25:51","true","Add summary stats and metrics for stats cache (#9536)

**What this PR does / why we need it**:
When a query finishes, we return (and log) the following stats:
```go
Cache.Chunk.Requests             0
Cache.Chunk.EntriesRequested     0
Cache.Chunk.EntriesFound         0
Cache.Chunk.EntriesStored        0
Cache.Chunk.BytesSent            0 B
Cache.Chunk.BytesReceived        0 B
Cache.Chunk.DownloadTime         0s
Cache.Index.Requests             0
Cache.Index.EntriesRequested     0
Cache.Index.EntriesFound         0
Cache.Index.EntriesStored        0
Cache.Index.BytesSent            0 B
Cache.Index.BytesReceived        0 B
Cache.Index.DownloadTime         0s
Cache.Result.Requests            13
Cache.Result.EntriesRequested    13
Cache.Result.EntriesFound        13
Cache.Result.EntriesStored       0
Cache.Result.BytesSent   0 B
Cache.Result.BytesReceived       2.5 kB
Cache.Result.DownloadTime        4.600266ms
```

In addition to that, we log the following in metrics.go:
```
level=info ts=2023-05-29T09:17:10.93029945Z caller=metrics.go:152 component=frontend org_id=145265 traceID=52d59b78fe6b9221 sampled=true latency=fast query=""{cluster=\""dev-us-central-0\"", namespace=~\""loki.*\"", container=~\""distributor|ingester
|promtail|index-gateway|compactor\""} |= \""thislinewillnotexist\"""" query_hash=1194136170 query_type=filter range_type=range length=3h0m0s start_delta=165h37m24.930289434s end_delta=162h37m24.930289612s step=43s duration=2.473055ms status=200 lim
it=30 returned_lines=0 throughput=0B total_bytes=0B lines_per_second=0 total_lines=0 total_entries=0 store_chunks_download_time=0s queue_time=0s splits=13 shards=0 cache_chunk_req=0 cache_chunk_hit=0 cache_chunk_bytes_stored=0 cache_chunk_bytes
_fetched=0 cache_chunk_download_time=0s cache_index_req=0 cache_index_hit=0 cache_index_download_time=0s cache_result_req=13 cache_result_hit=13 cache_result_download_time=4.600266ms
```

With the goal of being able to better monitor how the stats cache is
performing; this PR adds stats for the index stats cache, similarly to
how it's done for the results cache.

Here's an example of the new stats being returned and printed:
```go
...
Cache.StatsResult.Requests               180
Cache.StatsResult.EntriesRequested       129
Cache.StatsResult.EntriesFound   129
Cache.StatsResult.EntriesStored          51
Cache.StatsResult.BytesSent              0 B
Cache.StatsResult.BytesReceived          75 kB
...
```

And the new stats from metrics.go
```
... caller=metrics.go:155 ... cache_stats_results_req=129 cache_stats_results_hit=129 cache_stats_results_download_ti
me=156.864429ms ...
```

**Special notes for your reviewer**:
- Blocked by https://github.com/grafana/loki/pull/9535
- Note the new`stats.GetOrCreateContext` func. It's used inside the
`query.Exec` method so we don't overwrite the stats added in the stats
middleware.

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [x] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",68,62,1,1,"2018-04-16 10:25:39","1877.21"
"grafana/loki","86000dd32097d7e1ba478c3fb3ac43dc016f3d00","cyriltovena","2021-07-08 14:28:59","true","Development Docker Compose Setup (#3941)

* Adds the first version of a docker compose dev stack.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add index-gateway and code source.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Better docker ignore.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* better bash comment

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Update tools/dev/loki-boltdb-storage-s3/README.md

Co-authored-by: Karsten Jeschkies <k@jeschkies.xyz>

* lint bash scripts.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

Co-authored-by: Karsten Jeschkies <k@jeschkies.xyz>",118,39,0,1,"2018-04-16 10:25:39","1177.92"
"grafana/loki","5b30589acffbe6d5e52427d76588680314678970","dannykopping","2021-11-03 13:12:52","true","Documenting recording rules per-tenant WAL (#4566)

* WIP

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Document ruler config options

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Self-review updates

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Clarifying WAL benefit in response to review

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Adding dashboard link

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Update docs/sources/configuration/_index.md

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>

* Ensuring ruler and ingester default WAL paths do not conflict

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>",170,42,0,1,"2018-04-16 10:25:39","1292.87"
"grafana/loki","8609fcab74a9d73afef4a916a91b6dc3708af0f5","gouthamve","2018-12-19 03:24:10","true","Cut new blocks once the existing ones are full (#71)

* Cut new blocks once the existing ones are full

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>

* Address PR comments

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>",39,8,0,0,"2018-04-16 10:25:39","242.71"
"grafana/loki","206956f767597b1cf7b0432a7e3e51da04012557","cyriltovena","2021-09-10 07:06:25","true","Allow to run local boltdb queries with logcli. (#4303)

Debugging local queries is life saving, but currently doesn't work for boltdb.
This fixes it. Do note that downloading index can be slow for the first time.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",129,41,0,1,"2018-04-16 10:25:39","1239.61"
"grafana/loki","fd5cb96693035d5802ac5483be20c7167ff58c6d","cyriltovena","2020-10-20 12:43:05","true","LogQL: Labels and Metrics Extraction (#2769)

* Adds logfmt, regexp and json logql parser

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* hook the ast with parsers.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* hook parser with memchunk.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* hook parser with the storage.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* hook parser with ingesters

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* fixes all tests

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Refactor to pipeline and implement ast parsing.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes the lexer for duration and range

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes all tests and add some for label filters

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add label and line format.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add tests for fmt label and line with validations.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Polishing parsers and add some more test cases

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Finish the unwrap parser, still need to add more tests

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Indent this hell.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Moar tests and it works.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add more tests which lead me to find a bug in the lexer

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add more tests and fix all engine tests

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes match stage in promtail pipelines.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Hook Pipeline into ingester, tailer and storage.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Correctly setup sharding for logqlv2

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes precedences issue with label filters and add moar tests :v:

* Adds quantile_over_time, grouping for non associate range aggregation parsing and moar tests

* Extract with grouping

* Adds parsing duration on unwrap

* Improve the lexer to support more common identifier as functions.

Also add duration convertion for unwrap.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes the frontend logs to include org_id.

The auth middleware was happening after the stats one and so org_id was not set :facepalm:.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Support byte sizes in label filters.

This patch extends the duration label filter with support for byte sizes
such as `1kB` and `42MiB`.

* Wip on error handling.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes json parser with prometheus label name rules.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* fixup! Support byte sizes in label filters.

* Wip error handling, commit before big refactoring.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Refactoring in progress.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Work in progress.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Got something that builds and throw __error__ labels properly now.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add error handling + fixes groupins and post filtering.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* 400 on pipeline errors.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes a races in the log pipeline.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Unsure the key is parsable and valid.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Cleanup and code documentation.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Lint.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Lint.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes frontend handler.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes old test.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fix go1.15 local failing test.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

Co-authored-by: Karsten Jeschkies <k@jeschkies.xyz>",114,30,0,1,"2018-04-16 10:25:39","914.6"
"grafana/loki","a4070992d99bd89c57406d6c72311eb30dab41c1","cyriltovena","2019-08-11 15:24:32","false","fix a bug where nil line buffer would be put back",101,16,0,1,"2018-04-16 10:25:39","480.46"
"grafana/loki","b23c6ff5bfdb9112a72a55a1058994f58fcb7280","garo","2019-04-09 05:40:58","false","Improve documentation based on what I learned when I did loki setup.

* Explain that api needs the start parameter set if you want to see logs older than one hour
* Explain that S3 and DynamoDB can also use instance roles in EC2
* Add couple of hints how to debug Promtail
* Add documentation how the Promtail prometheus scrape_configs work",99,12,0,0,"2018-04-16 10:25:39","352.8"
"grafana/loki","1c1dfa98d775630b65d918bf21de19296425b485","joe-elliott","2019-10-22 18:48:10","false","Adding Operational dashboards (#1188)

* First pass added dashboards

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Added dummy rows field b/c the kubernetes-mixin fails if they don't exist

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Added Dynamo and S3

Signed-off-by: Joe Elliott <number101010@gmail.com>",67,18,0,0,"2018-04-16 10:25:39","551.6"
"grafana/loki","fdc337692d682e62e4759e4c672c4270e8375a23","MasslessParticle","2023-05-08 19:52:58","true","Stream Sharding amortize push payloads across the observed rate. (#9414)

This should account for large payloads that come infrequently",81,61,1,1,"2018-04-16 10:25:39","1848.64"
"grafana/loki","65ba42a6e7dc975d6f25b15fc6f9b8d72446b3e2","rfratto","2019-09-25 17:54:21","false","Documentation Rewrite (#982)

* docs: create structure of docs overhaul

This commit removes all old docs and lays out the table of contents and
framework for how the new documentation will be intended to be read.

* docs: add design docs back in

* docs: add community documentation

* docs: add LogQL docs

* docs: port existing operations documentation

* docs: add new placeholder file for promtail configuration docs

* docs: add TOC for operations/storage

* docs: add Loki API documentation

* docs: port troubleshooting document

* docs: add docker-driver documentation

* docs: link to configuration from main docker-driver document

* docs: update API for new paths

* docs: fix broken links in api.md and remove json marker from examples

* docs: incorporate api changes from #1009

* docs: port promtail documentation

* docs: add TOC to promtail configuration reference

* docs: fix promtail spelling errors

* docs: add loki configuration reference

* docs: add TOC to configuration

* docs: add loki configuration example

* docs: add Loki overview with brief explanation about each component

* docs: add comparisons document

* docs: add info on table manager and update storage/README.md

* docs: add getting started

* docs: incorporate config yaml changes from #755

* docs: fix typo in releases url for promtail

* docs: add installation instructions

* docs: add more configuration examples

* docs: add information on fluentd client

fluent-bit has been temporarily removed until the PR for it is merged.

* docs: PR review feedback

* docs: add architecture document

* docs: add missing information from old docs

* `localy` typo

Co-Authored-By: Ed Welch <ed@oqqer.com>

* docs: s/ran/run/g

* Typo

* Typo

* Tyop

* Typo

* docs: fixed typo

* docs: PR feedback

* docs: @cyriltovena PR feedback

* docs: add more details to promtail url config option

* docs: expand promtail's pipelines document with extra detail

* docs: remove reference to Stage interface in pipelines.md

* docs: fixed some spelling

* docs: clarify promtail configuration and scraping

* docs: attempt #2 at explaining promtail's usage of machine hostname

* docs: spelling fixes

* docs: add reference to promtail custom metrics and fix silly typo

* docs: cognizant -> aware

* docs: typo

* docs: typos

* docs: add which components expose which API endpoints in microservices mode

* docs: change ksonnet installation to tanka

* docs: address most @pracucci feedback

* docs: fix all spelling errors so reviewers don't have to keep finding them :)

* docs: incorporate changes to API endpoints made in #1022

* docs: add missing loki metrics

* docs: add missing promtail metrics

* docs: @pstribrany feedback

* docs: more @pracucci feedback

* docs: move metrics into a table

* docs: update push path references to /loki/api/v1/push

* docs: add detail to further explain limitations of monolithic mode

* docs: add alternative names to modes_of_operation diagram

* docs: add log ordering requirement

* docs: add procedure for updating docs with latest version

* docs: separate out stages documentation into one document per stage

* docs: list supported stores in storage documentation

* docs: add info on duplicate log lines in pipelines

* docs: add line_format as key feature to fluentd

* docs: hopefully final commit :)",71,17,0,1,"2018-04-16 10:25:39","524.56"
"grafana/loki","b8d5868cdc30e1db74a73dc66d222a42129ecdbd","slim-bean","2019-07-29 20:27:54","false","docker-driver-push does a build of all the go files and as such needs to make called with BUILD_IN_CONTAINER=false from circleci",104,15,0,1,"2018-04-16 10:25:39","468.67"
"grafana/loki","0f98b45d8dd16ada81ba39c30f27357ddb811c18","eisandbar","2023-03-31 20:08:03","true","Loki: Add UsageStatsURL to usagestats Config (#8779)

**What this PR does / why we need it**:

Reports used to be sent to a fixed URL usageStatsURL.
Now this url can be configurable while using the old url as a default.
Updated tests to use config for custom URLs instead of changing package
variable.

**Which issue(s) this PR fixes**:
Fixes #6502

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [x] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",82,59,1,0,"2018-04-16 10:25:39","1806.4"
"grafana/loki","b30c0d31bf253d759834c0e7bd5584aa45e23089","sh0rez","2019-09-22 12:35:10","true","doc(production): replace ksonnet with Tanka (#1039)

As `ksonnet` is long deprecated and [Tanka](https://github.com/grafana/tanka) being mature enough to replace it, we should show users how to do so.",67,17,0,0,"2018-04-16 10:25:39","521.34"
"grafana/loki","24accf6a5b1ee1706e3fc6adf82b4940ba7db5e1","KMiller-Grafana","2021-10-05 22:21:47","true","Docs: correctly represent product name (#4416)

The product name is Grafana Loki.  The first use of the product name on
each web page should be the full product name.  After that, within each
page, it is fine to use just Loki.

This PR also set up some frontmatter with weights where it was missing
on a few files, and correct where ""Loki"" was not capitalized.",137,42,0,0,"2018-04-16 10:25:39","1265.25"
"grafana/loki","a248e3e97067b99e29511d9bd3285b4a789e5d20","dannykopping","2023-06-02 08:25:39","true","Querier: configurable writeback queue bytes size (#9604)

**What this PR does / why we need it**:
The background writeback process is used to write chunks that have been
fetched from the store to cache. Chunks have a target size, but not all
chunks will necessarily be this size, so it is tricky to find the
correct value for `writeback_buffer` which specifies how many chunks
will be held in the queue at any given time.

For example: setting `writeback_buffer=10000` (the default) with all
chunks being the default target size (`chunk_target_size=1.5MiB`), in
the worst case could result in 15GiB of memory being used for this
buffer. Practically speaking, the queue never grows so deep, but if the
cache Loki is writing to becomes overwhelmed this could happen.

Setting a value too low would result in many chunks not being written
back to cache, which defeats the purpose.

This PR introduces a configurable _byte size_ limit to the writeback
cache, which defaults to 1GB in size. With this setting
`writeback_size_limit` in place, we get the best of both worlds: a deep
queue which can hold many small chunks or a shallow queue which can hold
a few large ones without using too much memory so as to overwhelm the
querier.

If either the `writeback_buffer` or `writeback_size_limit` reaches
capacity, any new chunks which are attempted to be added to the queue
will be dropped.

Two new metrics are added by this PR:

- `loki_cache_background_queue_bytes`: gauge, measures the size of the
queue in bytes
- `loki_cache_dropped_background_writes_bytes_total`: counter, measures
the volume of bytes dropped",68,62,1,1,"2018-04-16 10:25:39","1872.17"
"grafana/loki","b72a470d90aa05ebc4e435023970cdedddc19471","dannykopping","2021-07-19 07:17:00","true","Output timestamp with nanosecond precision if available (#4006)

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",109,39,0,1,"2018-04-16 10:25:39","1188.62"
"grafana/loki","5408ec1c9c41f893aa4b3ba61705bc86c4df4929","jdbaldry","2023-09-07 14:59:50","true","Fix alias to redirect `/docs/loki/<LOKI_VERSION>/configuration/` to `/docs/loki/<LOKI_VERSION>/configure/` (#10503)

Tested locally with `make docs`

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>",44,65,1,0,"2018-04-16 10:25:39","1967.44"
"grafana/loki","a344fdda53ad8223fab4052a2c1b43cfc520496f","periklis","2021-04-30 18:36:49","true","Add config map hash annotation for restarting components (#35)",179,36,0,1,"2018-04-16 10:25:39","1110.09"
"grafana/loki","16aa9dd55de7789b7782fd761d3bbf2058545904","ssncferreira","2022-03-04 13:40:13","true","Update vectorAggEvaluator to fail for expressions without grouping (#5544)",297,46,0,0,"2018-04-16 10:25:39","1413.89"
"grafana/loki","e9c0687c15af8e610269832c25e338c853c7574c","cyriltovena","2021-07-12 13:26:26","true","Reject labels with invalid runes when using implicit extraction parser. (#3983)

`json` and `logfmt` parser will attempt to extract all possible keys and values as labels.
But if a values currently contains the rune error (replace when there's an invalid rune) PromQL parser will fail and the request
will be fully rejected.

This PR removes those labels values when using those two parsers.

For other parser you can just decide to not extract thoses values.( At least that's my choice for now).

Unfortunatelly this comes with a small cpu overhead prices:

```
~/go/src/github.com/grafana/loki utf8-parser*
❯ benchcmp  before.txt after.txt
benchmark                                    old ns/op     new ns/op     delta
Benchmark_Parser/json/no_labels_hints-16     3647          4210          +15.44%
Benchmark_Parser/json/labels_hints-16        2210          2247          +1.67%

benchmark                                    old allocs     new allocs     delta
Benchmark_Parser/json/no_labels_hints-16     72             72             +0.00%
Benchmark_Parser/json/labels_hints-16        35             35             +0.00%

benchmark                                    old bytes     new bytes     delta
Benchmark_Parser/json/no_labels_hints-16     1121          1121          +0.00%
Benchmark_Parser/json/labels_hints-16        472           472           +0.00%
```

Fixes #2859

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",106,39,0,1,"2018-04-16 10:25:39","1181.88"
"grafana/loki","2303f1bfa16ca47f7a9c0ea4de26731ab963a18c","cyriltovena","2020-11-13 11:29:38","true","Cache label strings in ingester to improve memory usage. (#2926)

* Add benchmark for base stats.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Cache labels string in ingester to improve memory usage.

This reduce allocations by a lot, but assume that labels comes in sorted which is not ensure in the distributors.
The distributors will take a performance hit, but that's easier to scale or improve later.(added some todos)

see benchmark:

```
❯ benchcmp before.txt after.txt
benchmark                     old ns/op     new ns/op     delta
Benchmark_PushInstance-16     43505         4950          -88.62%

benchmark                     old allocs     new allocs     delta
Benchmark_PushInstance-16     240            12             -95.00%

benchmark                     old bytes     new bytes     delta
Benchmark_PushInstance-16     42568         1787          -95.80%
```

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* :facepalm: wrong hashing.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",125,31,0,1,"2018-04-16 10:25:39","937.54"
"grafana/loki","82da01ad43896f5ca3f8e12f4ca584f3f46a656e","sandeepsukhani","2022-06-06 11:52:49","true","make index shipper read path handle range of tables by type of index (#6304)",72,50,0,1,"2018-04-16 10:25:39","1511.06"
"grafana/loki","619c2212f58c645661c7a004c084b839e91aec1b","sandeepsukhani","2022-07-08 10:00:39","true","build and hook tsdb compaction code to the generic index compactor (#6627)",71,51,0,1,"2018-04-16 10:25:39","1542.98"
"grafana/loki","f38fa2d184b9be73fcbb770ea4ed6eae6c5da034","sandeepsukhani","2019-08-05 08:26:08","false","gofmt file",104,16,0,1,"2018-04-16 10:25:39","474.17"
"grafana/loki","3e5e461efa7fd8a15ba9e2bd260e4c7a7bef4ad3","owen-d","2020-10-27 16:52:35","true","updates docs with delete permissions notice (#2819)

* updates docs with delete permissions notice

* delete ref for storage doc

* boltdb ref

* pr feedback",121,30,0,1,"2018-04-16 10:25:39","921.77"
"grafana/loki","5fe9c964dbf088e8f272ef5c043d86ae0c51cb01","MichelHollands","2022-12-15 11:56:01","true","Fix validation for pattern and rexexp parsers to they don't panic in query-frontend (#7926)

Running the query `topk(10,sum
by(namespace)(count_over_time({application=""nginx"",
site!=""eu-west-1-dev""} |= ""/artifactory/"" != ""api"" != ""binarystore"" |
regexp `` [1d])))` causes a panic.

This PR adds validation for regexp and pattern parsers at parse time. If
they don't have a (valid) parameter an error will be returned.

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>
Co-authored-by: Susana Ferreira <ssncferreira@gmail.com>",100,56,1,1,"2018-04-16 10:25:39","1700.06"
"grafana/loki","64c7012b5e55a9275ddc2897f156685c2c233629","eraac","2019-11-04 19:14:00","false","typo url (#1215)",66,19,0,0,"2018-04-16 10:25:39","563.62"
"grafana/loki","f7d30e2cbca9745c152e2ff5be26dcc2e9b280ea","amartorelli","2019-08-01 14:17:13","false","Helm chart: Added service monitor (#824)

* Helm chart: Added service monitor

* Bumped loki-stack chart version

* Bumped loki chart version",106,15,0,0,"2018-04-16 10:25:39","470.41"
"grafana/loki","c5ce98586dad50566c7135cdf78a7306c31dbfc2","jdbaldry","2019-01-17 11:03:38","false","Fix typos in API documentation (#226)",64,9,0,0,"2018-04-16 10:25:39","271.03"
"grafana/loki","d63268bf48b2f0d82436f6212a354e5923f3c14c","sleleko","2019-04-12 04:58:53","true","update promtail-examples.md

rewrite exist example, and add more examples with descriptions",100,12,0,0,"2018-04-16 10:25:39","355.77"
"grafana/loki","7369b3785cdaad3c3bcc52d6fbc240609f14e738","sandeepsukhani","2022-05-31 11:00:22","true","use tsdb config for initializing index gateway client (#6267)

* use tsdb config for initializing index gateway client

* review feedback

Co-authored-by: Kaviraj Kanagaraj <kavirajkanagaraj@gmail.com>

Co-authored-by: Kaviraj Kanagaraj <kavirajkanagaraj@gmail.com>",73,49,0,1,"2018-04-16 10:25:39","1506.02"
"grafana/loki","f18edcf9d8199619a9b63d48a217948078ba6f24","sandeepsukhani","2022-07-08 13:03:23","true","use the configured index prefixes while building table names for tsdb index (#6436)

* use the configured index prefixes while building table names for tsdb index

* do not fail compaction when schema for a table can't be found",69,51,0,1,"2018-04-16 10:25:39","1543.11"
"grafana/loki","366e06f587a5c7a0623405970c4fb5186a34a526","owen-d","2020-01-17 17:21:54","false","legacy endpoint 400s metric queries (#1541)",104,21,0,1,"2018-04-16 10:25:39","636.54"
"grafana/loki","8bd3581b9569042529f74178276220366e0db98a","owen-d","2023-04-30 17:32:17","true","Revert ""Revert ""start writing tsdb v3"""" (#9332)

Reverts grafana/loki#9301

Should be good to start writing v3 again after
https://github.com/grafana/loki/pull/9328 is merged and when we're ready
to start using tsdbv3 as the default",80,60,1,1,"2018-04-16 10:25:39","1840.55"
"grafana/loki","0b935209942d3725ecfef8804c9cf2babc2b02b8","robbymilo","2021-12-29 17:50:24","true","update promtail daemonset docs (#4946)

* Update installation.md

* Update installation.md",252,44,0,0,"2018-04-16 10:25:39","1349.06"
"grafana/loki","b795672bbae89899be024484d0f1378e6a0cdcfb","bt909","2022-10-05 11:42:48","true","feat(lambda-promtail): add bearer token support (#7333)

It adds bearer token support for lambda-promtail, as it supports only
http basic auth.

Signed-off-by: Thomas Belian <thomas.belian@bt909.de>",94,54,1,0,"2018-04-16 10:25:39","1630.05"
"grafana/loki","28d6a9799109b4ea5c1816475a83f7eaf76a4ab2","Dentrax","2022-11-08 09:17:21","true","fluent-bit: clarify docs, use 1.9.9 (#6464)

**What this PR does / why we need it**:

* Pins digests for security enhancements
* Pass `-ldflags` using `--build-args`
* Use fluent-bit image `1.9.9`
* Use golang image `1.19.2`
* Clarify fluent-bit readme

Signed-off-by: Furkan <furkan.turkal@trendyol.com>
Co-authored-by: Michel Hollands <42814411+MichelHollands@users.noreply.github.com>",89,55,1,0,"2018-04-16 10:25:39","1662.95"
"grafana/loki","b78ed9d10689cea68ff1c78980048bc065669d3e","liguozhong","2023-02-22 13:41:40","true","[RFR] fix vector() function produces wrong timestamp on instant query (#8370)",68,58,1,1,"2018-04-16 10:25:39","1767.14"
"grafana/loki","95fefa6096543a874a0645f2f2d6b094c7c09f0e","cyriltovena","2022-03-02 07:28:06","true","Align usage report config with Grafana (#5406)

* Align usage report config with Grafana

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* fixes tests

* Update pkg/usagestats/reporter.go

Co-authored-by: Christian Haudum <christian.haudum@gmail.com>

* Update docs/sources/configuration/_index.md

Co-authored-by: Christian Haudum <christian.haudum@gmail.com>

* Update docs/sources/configuration/_index.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* Update docs/sources/configuration/_index.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

Co-authored-by: Christian Haudum <christian.haudum@gmail.com>
Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>",299,46,0,1,"2018-04-16 10:25:39","1411.63"
"grafana/loki","6c7d5645c9e07310e48553b4cbda78db1968be60","cyriltovena","2019-05-10 00:32:13","false","implements json stage metrics",97,13,0,1,"2018-04-16 10:25:39","388.84"
"grafana/loki","f691e1bcc36f2bd962768b54a4b86d1758f564fa","cyriltovena","2022-04-13 12:32:46","true","Introduce a more scalable index-gateway API. (#5892)

* Introduce a more scalable index-gateway API.

Because of the storage refactoring (https://github.com/grafana/loki/pull/5833) we can now introduce a better
index-gateway API that fits more our index interface.

Such as :

```proto
    rpc GetChunkRef(GetChunkRefRequest) returns (GetChunkRefResponse) {};
    rpc LabelNamesForMetricName(LabelNamesForMetricNameRequest) returns (LabelResponse)  {};
    rpc LabelValuesForMetricName(LabelValuesForMetricNameRequest) returns (LabelResponse) {};
```

This will avoid sending thousands of index queries to the index-gateway but instead them just a single request.
The index caching, parsing and filtering is now happening all on the index-gateway side.

Loki queriers will first check if the new API exists before using it, this way update can be done transparently.
However the check happens only on startup, so if you want to start using the new API you need to restart queriers after fully rolling out index-gateways.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Attempt to use the new API on every call.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>
Co-authored-by: Christian Simon <christian.simon@grafana.com>

* Add test for the GRPC fallback.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>
Co-authored-by: Christian Simon <christian.simon@grafana.com>

* lint

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* review feedback

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes the parameters

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Review feedback

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

Co-authored-by: Christian Simon <christian.simon@grafana.com>",319,48,0,1,"2018-04-16 10:25:39","1452.84"
"grafana/loki","a5e47a50e84a86860e91ce6d575d195df309cced","cyriltovena","2019-05-13 18:39:07","false","adds matchers and metrics to regex and json",99,13,0,1,"2018-04-16 10:25:39","392.59"
"grafana/loki","06e309bae6433036a76775125bd72b16003fba7d","sandeepsukhani","2022-05-06 01:51:59","true","do not increment sync operation count metric on per index set (#6109)",76,49,0,1,"2018-04-16 10:25:39","1480.64"
"grafana/loki","2b7a6f201cd5065c1b4b9fea8b16197af2d2bc33","sandeepsukhani","2021-05-18 07:27:22","true","Logs deletion support for boltdb-shipper store (#3688)

* add support for slicing the chunks for partial chunk deletion

* add delete requests store and handler for requests

* add delete requests manager and a way to check for chunk expiry based on delete requests

* add chunk rewriter for partially deleted chunks

* hook delete requests manager into compactor and update expiration checker

* use chunk client in sweeper for deleting chunks

* upload delete requests table during shutdown and some code refactoring

* add tests and metrics

* fixes post rebase

* lint

* changes suggested from PR review

* avoid allocation when getting userid from chunkid

* use bytes.IndexByte instead",199,37,0,1,"2018-04-16 10:25:39","1127.63"
"grafana/loki","e39ea21e3cacda92661d1d77770c7d1486ec4124","trevorwhitney","2022-09-02 20:12:50","true","Do not run helm release on tags matching our version releases (#7038)

**What this PR does / why we need it**:

We don't want to run the helm release on tags matching our loki releases. We can add the helm chart to the release process later, but we're not there yet. Right now our flow is ship the updated loki binary, then circle back around and update the helm charts to use that new version is a separate PR/release.",77,52,1,1,"2018-04-16 10:25:39","1597.41"
"grafana/loki","3d135e5338ae59e8ba55cd8bad41c0d032128468","DylanGuedes","2022-01-27 16:31:34","true","Copy `cortex/pkg/configs` package dependency into Loki (#5139)

* Fork cortex `configs` into Loki.

* Use new forked `configs` package.

* Remove duplicated import.

* Fix lint issues.

* Use new forked util/logger.

* Drop support for promql rules v1.

- This allow us to remove the `legacy_promql` implementation
- If a rulesconfig is received in v1 format, we output a specific error,
  so we can differentiate between a unknown version and a v1 one.

* Modify tests to expect error for legacy rules format.

* Add changelog and upgrading guide.

- Added them as we dropped support for legacy promql rules configuration
  which might be a breaking change for some environments.

* Update vendor/modules after rebasing.",276,45,0,1,"2018-04-16 10:25:39","1377"
"grafana/loki","13424a20ce2bde13f521ba8b7608ba5a2a07e64f","owen-d","2020-05-19 20:11:53","true","updates loki config examples (#2097)",118,25,0,1,"2018-04-16 10:25:39","763.91"
"grafana/loki","51761ece2c097c7146a1090548049240b660814c","cyriltovena","2019-07-24 22:27:22","false","adds tests for instant queries.",102,15,0,1,"2018-04-16 10:25:39","463.75"
"grafana/loki","bf56d9b5403dafda5f490b83fe518a853bddf7f7","salvacorts","2023-05-09 08:27:53","true","Fix docker image tag in release template (#9425)

**What this PR does / why we need it**:
Releases in GitHub are published automatically from Drone. Drone calls
the `tools/release` script which uses the `tools/release-note.md`
template to generate the release body.

Before this PR, the template used the `$DRONE_TAG` env variable which
had a `v` preffix (e. `v2.8.0`). Since we publish the docker images
without the `v` preffix, the docker images referenced by the release did
not exist. This affected the `v2.8.0`, `v2.8.1` and `v2.8.2` releases.

I manually fixed the `v2.8.0`, `v2.8.1` and `v2.8.2` release pages, but
this PR should fix the template so we no longer run into this situation.

**Which issue(s) this PR fixes**:
Fixes https://github.com/grafana/loki/issues/9384

**Special notes for your reviewer**:

Not sure where to find the available env variables in Drone. I wonder if
there is an existing env var with the version without the `v` preffix.

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",83,61,1,1,"2018-04-16 10:25:39","1849.17"
"grafana/loki","bee456737ea05a9a16c721780bb4b22b1da873c1","cyriltovena","2021-07-07 17:30:13","true","Shards Series API. (#3856)

* Shards Series API.

This PR introduces Series Queries Sharding. It does not check the boundaries of ingesters data since I'm assuming
https://github.com/grafana/loki/pull/3852 will be merge first.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes tests sorting.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",122,39,0,1,"2018-04-16 10:25:39","1177.04"
"grafana/loki","cd38e987d8d84e49c2a1840fc9619c9e27edcde0","sandeepsukhani","2021-06-09 08:59:35","true","Logs deletion fixes (#3827)

* fix temp file suffix in delete requests table

* log error on failure in removal of temp file only when the error is not os.IsNotExist

* fix the cli flag for delete requests cancellation period",203,38,0,1,"2018-04-16 10:25:39","1148.69"
"grafana/loki","f60554ce91e7c00365351d7163c30da6bf0171e5","sandeepsukhani","2020-10-20 18:15:31","true","Boltdb shipper query performance improvements (#2770)

* boltdb-shipper query with cursor to do multiple queries in a single transaction

* index deduper

* use fifo cache in ingesters

* snapshot dbs in ingester for reads

* retain fewer files in ingesters for queries

* set timeout in cache config instead of index read cache config which saves us from unmarshalling the object for checking the expiry

* add comment about fifo cache invalidation

* tweaking a few comments

Co-authored-by: Edward Welch <edward.welch@grafana.com>",117,30,0,1,"2018-04-16 10:25:39","914.83"
"grafana/loki","72032854d86ef60e8d055a2e6f2d592d28a19766","davkal","2019-03-07 13:38:37","false","Links to promtail setup docs",88,11,0,0,"2018-04-16 10:25:39","321.13"
"grafana/loki","b247a5450da4be9d0abfa868694c5b4b6dec1c2f","tomwilkie","2018-06-27 04:35:35","false","Command to fetch label names.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",1,2,0,0,"2018-04-16 10:25:39","70.76"
"grafana/loki","d06ed8fb1f2472de82034ba1e1991c563e5d0d94","tomwilkie","2018-11-22 15:03:48","false","Remove flagext, use cortex's.  Allow flags to be loaded from a file.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",5,7,0,0,"2018-04-16 10:25:39","216.19"
"grafana/loki","3ba29320834a6ff9211a4215f9b0eee0f7c765b1","nicknezis","2019-03-07 17:28:38","false","Made the docker root configurable. Default is '/var/lib/docker'",87,11,0,0,"2018-04-16 10:25:39","321.29"
"grafana/loki","9956717383486966e313b728db0e2f457887f7f7","pstibrany","2019-11-26 18:45:47","false","Include positions filename in the error when YAML unmarshal fails. (#1311)

* Include positions filename in the error when YAML unmarshal fails.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Include filename when parsing of YAML/JSON file fails.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>",82,19,0,0,"2018-04-16 10:25:39","585.6"
"grafana/loki","3ffa385b1ec968ab0bf040a8a72f58e0a93d2b29","cyriltovena","2019-12-05 19:07:43","true","Let Loki start when using the debug image. (#1372)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",91,20,0,1,"2018-04-16 10:25:39","594.61"
"grafana/loki","0de1a42406bdb8953e03c85736ea27f88c1deb81","cyriltovena","2020-05-14 19:38:36","true","Fixes a panic in dry-run when using external labels. (#2075)

Fixes #1972.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",119,25,0,1,"2018-04-16 10:25:39","758.88"
"grafana/loki","56bbb43748705ade16ac3c578ac52229d11a6651","salvacorts","2023-04-19 13:40:22","true","Logcli - Better logging when object cannot get loaded from object store (#9194)

**What this PR does / why we need it**:
This PR improves the error messaging for Logcli when an object cannot be
downloaded from the store by printing the name of the object along with
the error.

**Which issue(s) this PR fixes**:
Internal support escalation

**Special notes for your reviewer**:
There are other places where GetObject is called:
- `indexStorageClient.GetFile`
- `indexStorageClient.GetUserFile`

Looks like both of them are used only by the compactor and the table
manager. IIUC, these functions are not used by LogCLI.

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",77,60,1,1,"2018-04-16 10:25:39","1829.39"
"grafana/loki","c06f1daf59fcd138d6736c1637c193f458b0d514","DylanGuedes","2023-02-27 10:40:37","true","Update CHANGELOG.md (#8633)

**What this PR does / why we need it**:
Update our changelog to inherit v2.7.4 release notes",69,58,1,1,"2018-04-16 10:25:39","1772.01"
"grafana/loki","5973f044bf01c40c71d152504cde3f71a75d9aad","halcyondude","2020-10-05 15:54:47","true","nit: fix formatting for ksonnet/loki (#2719)",117,30,0,0,"2018-04-16 10:25:39","899.73"
"grafana/loki","80539a296a5ce27a9d0b3f0357ef67584a2d44b4","halcyondude","2020-11-09 08:34:48","true","gateway: fix regression in tanka jsonnet (#2899)

Seeing the following when importing loki...

evaluating jsonnet: RUNTIME ERROR: {snip}everquoteinc/loki-du/tanka/vendor/loki/gateway.libsonnet:97:5-6 Unexpected: ""$"" while parsing field definition

Related to:

https://github.com/grafana/loki/pull/2852
https://github.com/grafana/loki/commit/cb383d69067ab66a6b33e0e4fd8bff531122a9e7",119,31,0,0,"2018-04-16 10:25:39","933.42"
"grafana/loki","2ae8bb2bed4acf03a38061916fa5fcece700d100","sandeepsukhani","2020-01-20 06:59:57","true","logcli: replaced GRAFANA_* with LOKI_* in logcli env vars, set default server url for logcli to localhost (#1492)

* replaced GRAFANA_* with LOKI_* in logcli env vars, set default server url for logcli to localhost

* add env var details in help text of logcli",91,21,0,1,"2018-04-16 10:25:39","639.11"
"grafana/loki","3d7e9cee362434e870459039cd02bfcb44cd43ce","DylanGuedes","2022-01-12 15:58:07","true","Copy `cortex/pkg/ruler` package dependency into Loki (#5089)

* Fork cortex `ruler/rulestore/local`.

* Fork cortex ruler into Loki as package `ruler/base`.

* Use forked cortex ruler instead of vendored.

* Update `vendor/modules.txt` and Makefile instruction.

* Merge `pkg/ruler/base/rulestore` with `pkg/ruler/rulestore`.

* Move `pkg/ruler/base/rulespb` to `pkg/ruler/rulespb`.

* Rename `cortex_ruler` usage to `base_ruler`.

* Fix lint issues.

* Add forked ruler tests.

* Use own `pkg/storage/bucket` instead of Cortex one.

* Swap to `pkg/storage/chunk/{aws,gcp,etc}`.

* Update with correct prometheus import.

* Change error comparison.

* Code style changes",262,45,0,1,"2018-04-16 10:25:39","1361.98"
"grafana/loki","ba6a2fd41eb0d506015f24fb6f7904c25b8e166c","DylanGuedes","2022-01-27 16:05:00","true","Get rid of Cortex chunk. (#5239)",276,45,0,1,"2018-04-16 10:25:39","1376.99"
"grafana/loki","8b5c8899a44c286bc64d40db1b6cf3432301fc95","oddlittlebird","2020-04-30 19:44:29","true","Docs: Added labels content (#1999)

* Create labels-best-practices.md

* Create labels.md

* Update labels-best-practices.md

* Adding links to readme's for navigation

Signed-off-by: Ed Welch <edward.welch@grafana.com>

Co-authored-by: Ed Welch <edward.welch@grafana.com>",120,24,0,0,"2018-04-16 10:25:39","744.89"
"grafana/loki","b15a3414f7f36357efa5716ffc609b6577effd9b","kavirajk","2021-02-10 09:21:25","true","Add step to version Loki docs during public release process. (#3277)

* Add step to version Loki docs during public release process.

* Update docs/sources/maintaining/release.md

Co-authored-by: Cyril Tovena <cyril.tovena@gmail.com>

Co-authored-by: Cyril Tovena <cyril.tovena@gmail.com>",129,34,0,1,"2018-04-16 10:25:39","1024.46"
"grafana/loki","2e1279d99654a3b6ae25cdaf61ec907b2293ec06","kavirajk","2021-10-12 14:50:17","true","Fix return values of Matrix and Vector during query range in QueryShardingMiddleware (#4457)

* Fix matrics `result` type being `null`

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Add test for vector type as well

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",146,42,0,1,"2018-04-16 10:25:39","1271.93"
"grafana/loki","e858779e6bbb6d95cdb16a175cacbc66faf41167","chaudum","2023-09-14 18:51:09","true","Fix bug in cache of the index object client (#10587)

The bug could manifest in missing results when querying logs older than
what is kept on ingesters.

This commit changes the behaviour of the caching in the storage client
client used by the indexshipper to download indexes from object store.

The object store client maintains an internal, in-memory cache of tables
(= per-day index directories) available on object storage to reduce the
amount of expensive List operations. This cache gets updated in a
regular interval (1m) by the table manager that uses the client.
However, when the per-tenant setting `query_ready_index_num_days` is set
the 0, which is the default (to disable index pre-fetching), the sync is
only performed once on startup, but not subsequently. This leads to a
stale list of table names in the cache and any new index directory added
to the object storage is not added to the client cache.

This commit changes the object client to use a read-through caching
strategy for listing tables. If a table is not found locally in cache,
it performs a lookup against object storage. In this way, the cache is
updated even without the regular sync described above.

**Special notes for your reviewer**:

This is a port of #10585 which was first applied on the 2.9 release
branch.

---------

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",42,65,1,1,"2018-04-16 10:25:39","1974.6"
"grafana/loki","b8787163b60ee4261a00ec23f7720cf782c54c48","owen-d","2020-10-12 12:23:04","true","removes r/w pools from block/chunk types (#2711)",111,30,0,1,"2018-04-16 10:25:39","906.58"
"grafana/loki","aea78d6f26c074c7a5b87ba3398cd678249291fc","owen-d","2020-08-21 16:57:33","true","Update docker-compose.yaml (#2527)",123,28,0,1,"2018-04-16 10:25:39","855.77"
"grafana/loki","79c337e234139e7441da2e3261cf5bafca4194fc","SasSwart","2022-01-10 18:35:18","true","Add the option to configure memory ballast for Loki (#5081)

* Add memory ballast

* Add changelog entry

* Add documentation

Add additional information to Flag description

* Ensure that ballast_bytes can be configured from config file

Add documentation

* Add Operational scalability documentation related to memory ballast

* Restore config.ballast-bytes cli flag

* Move config.ballast-bytes cli flag declaration

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>",254,45,0,0,"2018-04-16 10:25:39","1360.09"
"grafana/loki","6e67d1ea5d128c15e6b4c69895057891c1d1a8f9","slim-bean","2021-04-19 19:51:47","true","Loki/Promtail: Client Refactor (#3623)

* move docker driver

* move fluent-bit output plugin

* move fluentd plugin

* move logstash plugin

* move promtail

* match stage uses simple logql label matcher and filter expressions only

* remove remaining logql imports

* remove helpers package and move contents to util package

* move validation and runtime out of util package

* fix imports

* move build and cfg packages into util

* move ParseRequest function to util package

* create a new package for logql models and move marshal/unmarshal code to util folder

* move ErrorLabel to logqlmodel

* move stats package to logqlmodel

* decouple loghttp from logql by moving validation to logql package

* move gcplog to tools

* move PackedEntryKey constant to logqlmodel

* fix stats proto import and rebuild protos

* fix windows promtail tests

* update drone to new dockerfile locations",161,36,0,1,"2018-04-16 10:25:39","1099.14"
"grafana/loki","0ca896eecfe000d7f76b6675e9114ab949eb7b14","daixiang0","2019-04-19 01:32:42","false","Update language

Signed-off-by: Xiang Dai <764524258@qq.com>",95,12,0,0,"2018-04-16 10:25:39","367.88"
"grafana/loki","ab7a970b94cc8dd76934cb2838927d4b06ce6e5a","dannykopping","2023-03-02 10:07:39","true","Querier/Ruler: add histogram to track fetched chunk size distribution (#8682)

**What this PR does / why we need it**:
We are looking at making some changes to the chunk caching strategy, and
we need this data to know what size chunks we're typically requesting.
For example, if the overwhelming majority of chunks are small we may
decide to cache only small chunks to decrease the number of requests to
the object store; we could fit more chunks in cache this way, which may
have a positive performance impact.",72,58,1,1,"2018-04-16 10:25:39","1776.99"
"grafana/loki","4210fcef355e898f53c9634a8804c9488e1cf450","cyriltovena","2020-02-13 14:01:14","true","--dry-run Promtail. (#1652)

* --dry-run Promtail.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Remove changed on gomod

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes flaky test

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Ensure position file is readonly when doing dry-run

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add information about dry run mode in the troubleshooting section.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add more spaces.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes journaltarget refactor.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes journaltarget refactor.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes journaltarget refactor.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",114,22,0,1,"2018-04-16 10:25:39","662.4"
"grafana/loki","6d85c7c212f95c7fbf902b467edc46a5ec3555fd","cyriltovena","2020-12-08 09:22:43","true","Add absent_over_time (#3053)

* Add absent_over_time

This adds absent_over_time which is super useful when alerting, it can be combine with any logql selector including parsers and filter to returns a timeseries with 1  when logs go missing.

Fixes #2893

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Adds comment.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",127,32,0,1,"2018-04-16 10:25:39","962.46"
"grafana/loki","844024ca9f397d830d0e5e556c81fcba1da9c82b","nicknezis","2019-03-08 16:40:48","false","More generic handling of volumes and volumeMounts in Promtail helm template",91,11,0,0,"2018-04-16 10:25:39","322.26"
"grafana/loki","5f5660719d39b0b41ddd8aef4e8b6daa24a9ee44","davkal","2019-04-10 15:56:41","true","Merge pull request #467 from steven-sheehy/missing-volume

Fix missing volume after refactor",98,12,0,0,"2018-04-16 10:25:39","354.23"
"grafana/loki","f1d00807eb3e452d66d9e997ee63b8520b21958a","sandeepsukhani","2020-08-12 11:09:23","true","fix a bug in ingester doing store queries when using boltdb shipper (#2493)",120,28,0,1,"2018-04-16 10:25:39","846.53"
"grafana/loki","086dbf7270d1199e0afdcaccc078f8102fd8386d","sandeepsukhani","2022-06-07 16:07:38","true","always retry syncing index files from indexshipper when the index list cache is stale (#6327)",72,50,0,1,"2018-04-16 10:25:39","1512.24"
"grafana/loki","0d64d2d91200563c327f9317b6e0adc61848f00a","owen-d","2020-09-22 19:46:30","true","fixes ruler docs & includes ruler configs in cmd/configs + docker img (#2657)",114,29,0,1,"2018-04-16 10:25:39","886.89"
"grafana/loki","92ec0e5317549afa0456d4d02273ab8629bc52cb","oke-py","2020-02-14 18:14:17","true","fix promtail/templates/NOTES.txt to show correctly port-forward command (#1697)

Co-authored-by: Cyril Tovena <cyril.tovena@gmail.com>",121,22,0,0,"2018-04-16 10:25:39","663.58"
"grafana/loki","2858ebde5c0dcf435cf57cffadc012f95c47cfda","liguozhong","2022-03-03 15:21:02","true","[bugfix] fix nil pointer (#5527)",298,46,0,1,"2018-04-16 10:25:39","1412.96"
"grafana/loki","825c497b4f8068a64990dd516e6ebe9ea33eae79","KMiller-Grafana","2021-08-31 17:32:46","true","Docs: minor improvements to Loki Canary docs (#4222)

* Docs: correct path to Promtail configuration file

* Docs: minor improvements to Loki Canary docs
  - reduce size of canary drawing
  - add a description of what Loki Canary does
  - update wording of the configuration options
  - minor grammar improvements throughout the section

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>",130,40,0,0,"2018-04-16 10:25:39","1231.05"
"grafana/loki","9ccfeca43de6c7c1352af294891646a087cc4f3d","hedss","2020-10-26 17:36:57","true","CHANGELOG: Update update document links to point to the right place. (#2810)

Signed-off-by: Heds Simons <heds@whaleway.net>",118,30,0,0,"2018-04-16 10:25:39","920.8"
"grafana/loki","250b7d5dc6eb7781409d1c2cb9a9cdcbeebff3a0","fredgate","2020-02-13 13:24:39","true","Loki stack helm chart can deploy datasources without Grafana (#1688)",115,22,0,0,"2018-04-16 10:25:39","662.37"
"grafana/loki","e7931a50d0f718fa9800af9f8cb159b01c53302a","tomwilkie","2019-02-05 11:31:55","false","Fix promtail active targets & files dashboard.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",80,9,0,0,"2018-04-16 10:25:39","289.05"
"grafana/loki","993caeb33991e047298ea83bf584023ea472127f","tomwilkie","2018-11-19 21:08:24","false","Only init each module once.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",5,7,0,0,"2018-04-16 10:25:39","213.45"
"grafana/loki","cf228b588da930810fdc54417e4c894cb123c500","periklis","2023-08-11 12:12:41","true","operator: Ensure generated api docs land on vcs (#10177)",53,64,1,1,"2018-04-16 10:25:39","1941.32"
"grafana/loki","cba373cce5bc4f853728f0301df4284bda24bb5a","cyriltovena","2021-05-17 09:31:19","true","Update publish.yml (#3731)",195,37,0,1,"2018-04-16 10:25:39","1126.71"
"grafana/loki","59410dfb7350bd7042a8e51fd5a86449feda63c0","cyriltovena","2020-03-17 19:34:13","true","Improve fluentbit logfmt. (#1791)

* Improve fluentbit logfmt.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* mod check.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",115,23,0,1,"2018-04-16 10:25:39","696.63"
"grafana/loki","e81ca28c801b2a007c2cd45df4f3819ce6089e3f","cyriltovena","2021-09-10 07:53:13","true","Fixes a bug in the block cache code. (#4302)

* Fixes a bug in the block cache code.

Because chunks can overlap and that can causes multiple processing of the same chunk within batches, we decided to cache the
evaluation of it.

However there was a bug here causing incorrect query result, specially for metric queries. The bug would occur when we would only partially consume a block (overlaping block between multiple batches) and then try to replay it.
In which case it wouldn't actually replay it but keep consuming the underlaying iterator.

This took us 2 days to figure out, thank Danny for helping along.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Missing warning when closing fails.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* got linted.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Review feedback.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Forgot to rename usage.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",130,41,0,1,"2018-04-16 10:25:39","1239.64"
"grafana/loki","891eae9af8cbb119024a18c94ffd0ad8a3fe300f","cyriltovena","2020-01-30 20:53:32","true","Fixes config change in the result cache (#1613)

Since https://github.com/grafana/loki/pull/1612 we don't need the cache_split_interval anymore.",104,21,0,1,"2018-04-16 10:25:39","649.69"
"grafana/loki","f6d26e20823d4675f6f4eb1d8bc4401bdf376f0d","briangann","2019-07-15 17:54:45","true","Merge pull request #757 from grafana/20190715_bump_fluent_plugin_version

cleanup rake warnings, bump version",98,15,0,0,"2018-04-16 10:25:39","454.56"
"grafana/loki","f4c884f2f699ce479e3700262f3c082b98a99914","rfratto","2020-05-05 18:10:06","true","Remove generated comment at top of .drone/drone.yaml (#2042)",117,25,0,1,"2018-04-16 10:25:39","749.82"
"grafana/loki","3d946030c7a0df9fd731a58df5f32c583320853b","slim-bean","2019-05-06 19:33:53","false","fixing capitalization on CRI stage and some lints",98,13,0,1,"2018-04-16 10:25:39","385.63"
"grafana/loki","4bee91e2ea2201760990df2be133172fc4ae4c21","BenHall","2018-12-12 16:36:48","false","When running inside a container, use promtail-docker-config.yaml (#80)

Signed-off-by: Ben Hall <ben@benhall.me.uk>",19,8,0,0,"2018-04-16 10:25:39","236.26"
"grafana/loki","01ee8313c0a31e0d7e4e1f557f156c5ad963503b","tomwilkie","2018-05-15 19:42:26","false","Fix request paths and logging.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",0,1,0,0,"2018-04-16 10:25:39","29.39"
"grafana/loki","58b0f3a1d49181886516a9588176d5a539b41668","tomwilkie","2018-04-23 14:59:22","false","Add ingester lifecycle.",0,0,0,0,"2018-04-16 10:25:39","7.19"
"grafana/loki","e5d117cf4645b7ab3a1017193702e2768e5c30cc","tomwilkie","2018-04-17 15:23:11","true","Merge pull request #2 from grafana/http

Add HTTP interface to distributor and querier.",0,0,0,0,"2018-04-16 10:25:39","1.21"
"grafana/loki","d77e0fe2342b16530e719317b7fe58dc378bb986","tomwilkie","2018-04-17 13:49:24","false","Add unit tests to CI.",0,0,0,0,"2018-04-16 10:25:39","1.14"
"grafana/loki","b97525a448bc6068bb902a475d34a46d9cc6182d","grafanabot","2023-03-30 11:45:24","true","[CI/CD] Update yaml file `./production/helm/loki/values.yaml` (+1 other) (#8955)

**Here is a summary of the updates contained in this PR:**
***
Update attribute `$.enterprise.version` in yaml file
`./production/helm/loki/values.yaml` to the following value: `v1.6.3`
***
Bump version of Helm Chart
Add changelog entry to `./production/helm/loki/CHANGELOG.md`
Re-generate docs",83,59,1,0,"2018-04-16 10:25:39","1805.06"
"grafana/loki","2a04ac9af709b1199f9b2e442b34945b70065298","trevorwhitney","2022-04-25 21:06:47","true","Remove references to cortex (#6015)",170,48,0,1,"2018-04-16 10:25:39","1470.45"
"grafana/loki","e3b74158a58a6f44692bb829d329890467c76c29","cyriltovena","2022-02-04 08:29:27","true","Fixes log deduplication when mutating Labels using LogQL (#5289)

* Changes the iterator interface to include labelshash.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Improve unused args and fixes build

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Implement the new hash in the memchunk.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add the hash in logproto

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Insert the hash from ingester-querier

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Rename LabelsHash to StreamHash

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Working through fixing tests.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Refactor HeapIterator into merge and sort Iterator.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* lint

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Order alphabetically when ordering samples.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Do not JSON encode the hash for legacy model.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add more regression tests.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Update CHANGELOG.md

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Review feedback",277,45,0,1,"2018-04-16 10:25:39","1383.67"
"grafana/loki","8c1095a55447c8d3a9d0b4c222fd4f9ebb578465","cyriltovena","2022-04-11 07:16:36","true","Moves TSDB to the stores package. (#5852)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",320,48,0,1,"2018-04-16 10:25:39","1450.62"
"grafana/loki","d765921735c971d5323f6950311c324f421ef7a9","sandeepsukhani","2021-05-28 09:41:31","true","revendor cortex to latest master (#3771)",200,37,0,1,"2018-04-16 10:25:39","1137.72"
"grafana/loki","205b43305ec93b2644145b10ca68bf6c6b6f5a97","sh0rez","2019-08-15 20:49:03","true","chore(packaging): set tag length to 7 (#901)

* chore(packaging): set tag length to 7

relied on git approximation before, which causes problems with other parts of
the automation.

Because we do not need the tag to be strictly unique, but just to identify the
latest version, limiting to 7 is fine.

If this ever causes problems, raise the limit but make sure to update all other
places as well.

* chore(packaging): request at least 7 characters

Co-Authored-By: Dan Cech <dan@aussiedan.com>",103,16,0,0,"2018-04-16 10:25:39","484.68"
"grafana/loki","3296c6dbe85d38c37ee6d564e9dbf9bb61c36801","liguozhong","2022-09-02 17:31:32","true","[new feature] logql engine support exec `vector(0)` grama (#7023)

**What this PR does / why we need it**:
logql engine support exec `vector(0)` grama.
new PR of :https://github.com/grafana/loki/pull/7007
**Which issue(s) this PR fixes**:
Fixes #6946

**Special notes for your reviewer**:
test passed.
test1: vectorExpr only
![image](https://user-images.githubusercontent.com/9583245/187871060-2ce63f01-5613-4a1e-9a52-59712f32cc7c.png)

test2: binExpr and vectorExpr
![image](https://user-images.githubusercontent.com/9583245/188090201-702c1ec4-7c37-41cb-9f2f-8f137a39dadf.png)

**Checklist**
- [ ] Documentation added
- [x] Tests updated
- [ ] Is this an important fix or new feature? Add an entry in the `CHANGELOG.md`.
- [ ] Changes that require user attention or interaction to upgrade are documented in `docs/sources/upgrading/_index.md`",80,52,1,1,"2018-04-16 10:25:39","1597.3"
"grafana/loki","d66dd30c17bea65d9428e6557f7e081e203c15f9","slim-bean","2023-10-19 13:32:09","true","Loki: introduce an exponential backoff on failed query retries. (#10959)

**What this PR does / why we need it**:

Currently any subquery which fails with a 5xx status code is retried by
the query frontend immediately, and by default will make a total of 5
attempts to execute the subquery, ultimately failing the query if you
exhaust those attempts.

We notice there are times when subqueries can fail extremely quickly,
mostly around queriers handling various GRPC related issues between
components like ingesters or index gateways.

In these cases a query will exhaust all the retries in less than a
second and fail back to the user.

Also in cases where a query is causing a lot of memory pressure on a
pool of queriers leading to OOM crashes of queriers, the lack of a
backoff on retries can make this behavior quite aggressive and
potentially cause disruption if you don't have enough queriers
available.

This PR introduces a simple exponential backoff on retries of failed
queries to allow for the downstream GRPC issues to have time to sort out
as well as causing queries causing a lot of memory pressure and OOMing
to be slowed down and minimize their impact slightly.


**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

---------

Signed-off-by: Edward Welch <edward.welch@grafana.com>",20,66,1,1,"2018-04-16 10:25:39","2009.38"
"grafana/loki","cf2dacf70f4211a3d70dfff3de89773015e673ee","kavirajk","2021-11-01 12:16:06","true","Update PR template to include `changelog` update in the checklist (#4604)

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",168,42,0,1,"2018-04-16 10:25:39","1290.83"
"grafana/loki","a58aea1bf456280aa06fb2f2d09d2d005eefa6ed","JordanRushing","2021-08-31 15:56:22","true","Update limits_config docs to include querier.max_query_lookback flag (#4244)",131,40,0,0,"2018-04-16 10:25:39","1230.98"
"grafana/loki","ff72e70925b5e4cd523d175a5dc34576066fb73b","cstyan","2023-02-07 15:42:34","true","[jsonnet] fix import ordering in loki.libsonnet (#8442)

Signed-off-by: Callum Styan <callumstyan@gmail.com>",79,58,1,1,"2018-04-16 10:25:39","1752.22"
"grafana/loki","165ff31e2d5ec8ba29199049869d3e2d8306e472","cyriltovena","2021-10-27 12:48:05","true","Fixes the Series function to hanlde properly sharding. (#4563)

Before they would try to match the injected label but this label is only used by the store
and not returned in the chunks causing all chunks to be filtered out.

Fixes #4547

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",167,42,0,1,"2018-04-16 10:25:39","1286.85"
"grafana/loki","81a697c541c76b75501f3580d717b95bd1a71fb1","cyriltovena","2020-10-06 20:59:31","false","Fixes the frontend logs to include org_id.

The auth middleware was happening after the stats one and so org_id was not set :facepalm:.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",120,30,0,1,"2018-04-16 10:25:39","900.94"
"grafana/loki","6e9517e4b50dd36ae0e45c0c42bb25c5b6d03c9e","periklis","2022-05-17 08:00:36","true","ruler: Add support for alertmanager header authorization (#6136)",76,49,0,1,"2018-04-16 10:25:39","1491.9"
"grafana/loki","3e46067cbb4ca63a0b87e89f4ac3a6824173df3d","cyriltovena","2021-01-28 13:15:08","true","Fixes a bug where slice of Entries where not zeroed before decoding json. (#3249)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",124,33,0,1,"2018-04-16 10:25:39","1012.62"
"grafana/loki","03ce63b730a17c16c095903504ea43348f60d906","periklis","2021-04-21 15:30:46","true","Provide handler for LokiStack create and update events (#27)",165,36,0,1,"2018-04-16 10:25:39","1100.96"
"grafana/loki","0208071bbd703a83fb865cdd4eb72bc4408d2ead","liguozhong","2021-01-25 08:37:56","true","[doc] fix err. ""loki_frontend"" is invalid (#3220)",116,33,0,1,"2018-04-16 10:25:39","1009.43"
"grafana/loki","56bf5e707319a354fde868bd070c8a3f24832e4a","MichelHollands","2021-01-19 07:48:37","true","Make httpAuthMiddleware field public (#3159)

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",110,33,0,1,"2018-04-16 10:25:39","1003.39"
"grafana/loki","2477f70431179e55f7c39fffbf75dc403e91a67f","pracucci","2019-10-08 13:46:14","false","docs: clarified the relation between retention period and table period (#1129)",71,18,0,0,"2018-04-16 10:25:39","537.39"
"grafana/loki","29f08ccb1cde0e26d57d2c95e293eceb4df17976","pracucci","2019-09-09 23:50:03","false","Fix panic in tailer due to race condition between send() and close() (#986)",118,17,0,0,"2018-04-16 10:25:39","508.81"
"grafana/loki","e64c7e5faf2db42080310624166cf6d9bfb93e8e","rfratto","2019-07-25 20:57:42","false","ingester: log error if closing client after transfer fails",103,15,0,1,"2018-04-16 10:25:39","464.69"
"grafana/loki","3ab7bcd17a2f7742a4c4838514356996539cba9c","DylanGuedes","2021-10-29 13:12:10","true","Change default RejectOldSamplesMaxAge from 14d to 7d. (#4569)",168,42,0,1,"2018-04-16 10:25:39","1288.87"
"grafana/loki","c2c5249676d5b13e97681e4a589de45abe94298e","jeschkies","2023-07-13 13:26:14","true","Remove goroutines from limiter middleware. (#9923)

**What this PR does / why we need it**:
The `limitedRoundTripper` would spawn thousands if not millions of
goroutines. However, they were mostly idle waiting for downstream calls.
This would congest the Go scheduler.

A semaphore is more suitable to control concurrency as the
[example](https://pkg.go.dev/golang.org/x/sync/semaphore#example-package-WorkerPool)
in the documentation illustrates.",58,63,1,1,"2018-04-16 10:25:39","1913.38"
"grafana/loki","cb4e8009bef8813ad05b4d0e790deec78d7ad867","jeschkies","2023-11-04 05:05:37","true","Correct checksum config path for Helm chart. (#9609)

**What this PR does / why we need it**:
As request in
https://grafana.slack.com/archives/CEPJRLQNL/p1685453125856569

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",12,66,1,1,"2018-04-16 10:25:39","2024.03"
"grafana/loki","7bbed2be498a317e7600e82851306a6ad9fed167","jeschkies","2022-01-06 17:11:35","true","Define Ingester interface to enable wrapping. (#4988)",253,45,0,1,"2018-04-16 10:25:39","1356.03"
"grafana/loki","17e05d28e4bf4f3a3c382180e4ba0fdb141af26f","andriikushch","2023-03-23 21:37:06","true","Promtail: Add a new target for the Azure Event Hub (#8787)

**What this PR does / why we need it**:

We want to allow receiving logs from the Azure Cloud. To solve this
problem, we need to be able to configure Promtail to consume logs from
the Azure Events Hub.

To achieve this goal, we need to add a new configuration option to the
scrape configuration in Promtail and implement the component that, given
this configuration, can connect to the Azure Event Hub, parse received
data, and prepare it to be stored in Loki.


**Which issue(s) this PR fixes**:
Fix [#8788](https://github.com/grafana/loki/issues/8788)

# **Special notes for your reviewer**:

With the current implementation, I would like to leverage Azure Events
Hub's compatibility with a Kafka protocol and reuse code for a Kafka
target.

### Why I decided to create a new target instead of just reusing the
Kafka target:
1. Configuration for Kafka in this scenario requires fewer parameters.
For example, version and auth should have some specific values.
2. Message handling is different for Azure Logs. In addition to what we
are doing for the Kafka target, we want to fix JSON and split incoming
messages into multiple log lines before propagating it further.

### From the implementation perspective, there are two goals:
- Extract interfaces that are not Kafka configuration specific from the
Kafka target module. Splitting Kafka config parsing and target creation.

- To make the message handler/parser injectable or configurable: we
would like to fix JSON and split a message into multiple messages.


**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [x] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

---------

Co-authored-by: Pablo <2617411+thepalbi@users.noreply.github.com>
Co-authored-by: Paschalis Tsilias <tpaschalis@users.noreply.github.com>
Co-authored-by: J Stickler <julie.stickler@grafana.com>",82,59,1,0,"2018-04-16 10:25:39","1798.47"
"grafana/loki","162a2d0057df2f4952ac2a7bf0a211f9ed9212c4","sandeepsukhani","2023-03-08 09:55:23","true","deletion: fix issue in processing delete requests with tsdb index (#8665)

**What this PR does / why we need it**:
When a delete request creates a new chunk from an existing chunk, we
index it to the index store.
In TSDB, we
[drop](https://github.com/grafana/loki/blob/944b488bd2506012d149fc363401f9b7d51af3e7/pkg/storage/stores/tsdb/head_manager.go#L235-L237)
`__name__` label, which was being added to chunkrefs for historical
reasons.
However, this was not done while indexing chunks from the deletion code,
causing deletion to fail with the error [chunk insertion is only allowed
on existing
streams](https://github.com/grafana/loki/blob/619c2212f58c645661c7a004c084b839e91aec1b/pkg/storage/stores/tsdb/builder.go#L67).

This PR handles the issue by dropping the `__name__` label and adding
relevant tests.

**Special notes for your reviewer**:
I will add an integration test for deletion with TSDB once we have PR
https://github.com/grafana/loki/pull/7754 merged since it does some
groundwork to run integration tests with both `boltdb-shipper` and
`tsdb`.

**Checklist**
- [x] Tests updated
- [x] `CHANGELOG.md` updated",84,59,1,1,"2018-04-16 10:25:39","1782.98"
"grafana/loki","e383472d906f45832c69642376d312ea55f28f24","wardbekker","2021-03-09 14:32:00","true","Don't auto-include pod labels as loki labels as a sane default (#3390)

Don't auto-include pod labels as loki labels as a sane default. Folks regularly run into stream limits when they have a bunch of labels on their pods, so better to remove this to get them a nicer first onboarding experience.",149,35,0,0,"2018-04-16 10:25:39","1053.67"
"grafana/loki","209b4d83af4f1939b6b2f1f8ec0d57e2d7b4a509","isimluk","2023-09-20 16:27:19","true","fluentd docs: fix broken link (#10640)

Co-authored-by: J Stickler <julie.stickler@grafana.com>",34,65,1,0,"2018-04-16 10:25:39","1980.5"
"grafana/loki","72bab9affde022558a18e8f0e1790d7e4b97984e","jdbaldry","2022-07-07 10:02:46","true","CI/CD: Update documentation publishing workflows (#6381)

* Update next publishing to use latest workflow

- Ensure docs links are checked before merge
- Allow manual workflow dispatch

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* Add release branch documentation publishing

- Only publish on release branches with a corresponding release tag

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>",71,51,0,0,"2018-04-16 10:25:39","1541.98"
"grafana/loki","fe1d28a545e08545c0bf3f9450421983cee0991d","kavirajk","2022-01-04 08:58:03","true","Chore: use `spanlogger` from `dskit` (#5029)

* Move `cortex/pkg/spanlogger` into `loki`.

It uses spanlogger from `dskit/pkg/spanlogger` with small wrapper created on the
`pkg/util/spanlogger` in loki repo.

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Remove `cortex/util/spanlogger` -> `loki/util/spanlogger`

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Fix linter (with goimports) and `FromContext`

Run goimports with `-local` flag
`FromContext` takes util logger to keep the API same as currently used inside loki

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",253,44,0,1,"2018-04-16 10:25:39","1353.69"
"grafana/loki","1ff95fc0256609f42d2bf444d5ee83390c70ce79","taisho6339","2021-10-30 02:59:19","true","Respect gRPC context error when handling errors (#4593)

* Respect rpc status when handling http errors

* Format by goimport

* Update pkg/util/errors.go

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>

* Update pkg/util/errors.go

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>

* Update pkg/util/errors.go

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>

* Add some tests

* context, rpc cancelled and another error case
* context, rpc deadline exceeded and another error case

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>",167,42,0,0,"2018-04-16 10:25:39","1289.44"
"grafana/loki","f5872ec4d3466ef4ec532acdc287d88235a01a59","bboreham","2023-06-02 14:36:14","true","marshal tests: make random quantities more obvious (#9612)

**What this PR does / why we need it**:

Computing a new random number on every iteration of the loop is hard to
reason about, and probably not what was meant.

This PR will mean that much more data is generated than before; I
computed the expected value before as 11.2, whereas now it is 49.5.
Consider reducing the `100` if that is undesired.

**Checklist**
- NA Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- NA Documentation added
- [x] Tests updated
- NA `CHANGELOG.md` updated
- NA Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- NA For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",69,62,1,0,"2018-04-16 10:25:39","1872.42"
"grafana/loki","615941234af86084ae4c3571c726a29e0a467003","vlad-diachenko","2022-08-29 13:35:51","true","Logql Analyzer (#6171)

* created logql-debugger page and API endpoint that returns information for each stage of the query

* added docker-compose setup for local testing

* refactored analyzer and added unit tests

* removed docs page to release it in a separate PR when back-end API is published

* changes structure of results object in response to return origin log line needed for case when only stream selector is sent in query

* merged the latest main and resolved conflicts

* added endpoint for readiness probe and configured CI

* fixed drone.yml discrepancy

* fixed method signature

* fixed path to Dockerfile

* added clean step",81,52,1,0,"2018-04-16 10:25:39","1594.13"
"grafana/loki","5c3d204ebf5d37b511a79a73505045aab2526557","dannykopping","2023-03-21 11:06:27","true","Ruler: rule evaluation jitter (#8848)

**What this PR does / why we need it**:
This PR introduces a configurable random sleep before each rule
evaluation to prevent contention on the query engine should multiple
runs execute concurrently. It's quite likely that rules will be
evaluated ~concurrently if they have the same interval.",84,59,1,1,"2018-04-16 10:25:39","1796.03"
"grafana/loki","2bed54ff2b437d4fa1916117108958d2c7b3775e","daniellee","2018-12-05 12:54:30","false","README - spelling (#34)",7,8,0,0,"2018-04-16 10:25:39","229.1"
"grafana/loki","37b1c0fce035affeb486528c09de8975f5b31d68","trevorwhitney","2022-12-02 09:13:18","true","guard against divide by 0 when splitting parallelism (#7831)

**What this PR does / why we need it**:

**Which issue(s) this PR fixes**:
We saw a spike in divide by zero panics in the code introduced in #7769.
I was able to reproduce this error via a test that calculates
`WeightedParallelism` with a start that's after the end. Not sure if
this is possible, but we definitely saw this happening in our ops
environment, so something is causing it, and the fix should guard
against it in any case.

**Special notes for your reviewer**:

**Checklist**
- [X] Tests updated

Co-authored-by: Sandeep Sukhani <sandeep.d.sukhani@gmail.com>",92,55,1,1,"2018-04-16 10:25:39","1686.95"
"grafana/loki","9a64334f2a0ee6f4b724bd54e8ea9fdaa6c2774a","kavirajk","2021-06-22 08:42:59","true","Add missing `-querier.max-concurrent` config in the doc (#3875)",103,38,0,1,"2018-04-16 10:25:39","1161.68"
"grafana/loki","268b7a3d0380b4621c862409ed42e95be8702fab","owen-d","2020-06-09 20:51:44","true","bumps cortex & fixes conflicts (#2204)

* bumps cortex & fixes conflicts

* go mod tidy",137,26,0,1,"2018-04-16 10:25:39","783.93"
"grafana/loki","a95e900a763eaaf37a9e7dcd372785b80f438d55","xperimental","2022-09-14 17:14:50","true","operator: Skip enforcing matcher for certain tenants on OpenShift (#7037)",88,53,1,1,"2018-04-16 10:25:39","1609.28"
"grafana/loki","18e29236f45fb46b09613c7f72bb3871c1d98b16","cyriltovena","2020-11-13 14:47:00","true","Fixes all in one grpc registrations. (#2930)

We can only register push server once, in all in one, we want to register only ingester.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",125,31,0,1,"2018-04-16 10:25:39","937.68"
"grafana/loki","f39552c7fa4f7f173f85f953f33efe2095f77f50","MichelHollands","2022-05-16 10:17:11","true","Add docs for updated deletion api (#5763)

* Add docs for updated deletion api

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Fix parameter name

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Clarify that only the delete requests for the current tenant are shown

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Update docs/sources/api/_index.md

Co-authored-by: Christian Simon <simon@swine.de>

* Update docs/sources/operations/storage/logs-deletion.md

Co-authored-by: Sandeep Sukhani <sandeep.d.sukhani@gmail.com>

* Update docs/sources/operations/storage/logs-deletion.md

Co-authored-by: Sandeep Sukhani <sandeep.d.sukhani@gmail.com>

* Update docs/sources/operations/storage/logs-deletion.md

Co-authored-by: Sandeep Sukhani <sandeep.d.sukhani@gmail.com>

* Specify all delete endpoints use authentication

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Add description of delete modes

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Apply suggestions from code review

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

Co-authored-by: Christian Simon <simon@swine.de>
Co-authored-by: Sandeep Sukhani <sandeep.d.sukhani@gmail.com>
Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>",78,49,0,1,"2018-04-16 10:25:39","1490.99"
"grafana/loki","aea05f381e21b53293e05e3aed47ca5164f44905","DylanGuedes","2022-07-06 12:43:35","true","Set ingester PDB to have max_unavailable=0. (#6589)

Change our ingesters policy disruption budget to use max_unavailable pods as 0 instead of 1. Without this, in some cases, we get more than 1 ingester unavailable.",71,51,0,1,"2018-04-16 10:25:39","1541.1"
"grafana/loki","dddace862d3f384a38bcebd36e16859e7049134c","kavirajk","2022-01-18 11:27:46","true","Add nil check for Ruler BasicAuth config. (#5168)

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",265,45,0,1,"2018-04-16 10:25:39","1367.79"
"grafana/loki","564f833a307247be0373609afa2610bdffe09485","kavirajk","2022-01-05 13:32:07","true","Improve error message if incoming logs timestamp is far too behind. (#5040)

* Improve error message if incoming logs timestamp is far too behind.

This is part of JSON response giving out as the response to HTTP /push endpoint.

Old message
```
{""code"":400,""status"":""error"",""message"":""entry for stream '{foo=\""bar\""}' has timestamp too old: 1970-01-01 01:00:00.5 +0100 CET""}
```

New message
```
{""code"":400,""status"":""error"",""message"":""entry for stream '{foo=\""bar\""}' has timestamp too old: 2021-12-28 01:48:45.5 +0100 CET, accepts timestamp from: 2021-12-29 09:48:45.737756651 +0100 CET""}
```

main rationale being, hard to know what is the closest timestamp that Loki is expecting without going through the config.
Also config is not straight forward (its `latest stream's timestamp - ingester.max-chunk-age/2`)

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Tweaks the error message

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Fix `distributor/validator_test`.

1. Make `time.Now()` mockable.
2. Make time format consistent across error messages.

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Rename `getValidationContextFor` to `getValidationContextForTime`

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",251,45,0,1,"2018-04-16 10:25:39","1354.88"
"grafana/loki","48d606405d179f657f05e265ca8c4bb4d7cdbadb","kavirajk","2023-10-11 17:46:20","true","test(TestRuleEval): Increase timeout on this integration test (#10857)",26,66,1,1,"2018-04-16 10:25:39","2001.56"
"grafana/loki","c636a0f51ca1bf8c1c8890399e33c3fa8e86bd78","kavirajk","2023-09-20 16:11:32","true","Add missing changelog for sharding optimizations (#10469)

**What this PR does / why we need it**:
https://github.com/grafana/loki/pull/10101

**Which issue(s) this PR fixes**:
NA

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] `CHANGELOG.md` updated

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",34,65,1,1,"2018-04-16 10:25:39","1980.49"
"grafana/loki","cd8bb0f148dfa8cfdfe8e5a67be2ccc711452658","tomwilkie","2018-06-25 07:45:05","false","Only put the http middleware on specific routes, we don't want auth on /metrics.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",1,2,0,0,"2018-04-16 10:25:39","68.89"
"grafana/loki","c6f809a7389631e3c6e766439acc531554e446d9","fernferret","2023-06-05 12:11:28","true","Fix missing ~ in the regexp match for namespace (#9618)

**What this PR does / why we need it**:

Fix documentation which has a missing `~` for the regexp match. I was
following the documentation and found it odd that this query didn't
follow
[LogQL](https://grafana.com/docs/loki/latest/logql/log_queries/#log-queries),
but it actually does and was just a typo in the docs.

I've tested this with my own Loki 2.8 release and with the `~` this
works great!

I also added a similar description block to the above example explaining
the pipeline, but if this is not desired, I'm happy to remove it.

**Which issue(s) this PR fixes**:
NA, trivial issue, just a small fix in the docs.

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [x] Tests updated
- [x] `CHANGELOG.md` updated
- [x] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [x] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",70,62,1,0,"2018-04-16 10:25:39","1875.32"
"grafana/loki","85696d00eb5c3aa4aa6289e12b3656a42f581e58","arl","2020-09-21 20:04:39","true","pkg/chunkenc: fix test using string(int) conversion (#2647)

Since go1.15, there's a new vet check for code such as string(x) where x
has an integer type other than rune.  This vet check is enabled by
default on go test.

TestSerialization failed because of that, this commit replaces `string()`
conversions with `strconv.Itoa` calls

Fixes #2646",116,29,0,0,"2018-04-16 10:25:39","885.9"
"grafana/loki","a41aee83a49c312c0ef8aaee1abd2fd0058eb2f1","56quarters","2023-09-01 20:36:40","true","Update to latest dskit version for SpanLogger changes (#10423)

**What this PR does / why we need it**:

In particular, dskit has changed the SpanLogger struct such that all
fields are unexported. This updates Loki to work with the new version
while preserving the existing Loki behavior.

**Which issue(s) this PR fixes**:

N/A

**Special notes for your reviewer**:

Required for Mimir vendor update job in `backend-enterprise` because
Reasons.

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

---------

Signed-off-by: Nick Pillitteri <nick.pillitteri@grafana.com>",45,64,1,0,"2018-04-16 10:25:39","1961.67"
"grafana/loki","6d59b4144e1554b8d516e97ee58b58a36c306478","james-callahan","2023-02-20 19:17:13","true","lambda-promtail: Various Terraform fixes (#8549)

* lambda-promtail: omit_extra_labels_prefix is a boolean
  This can be changed without a migration as it hasn't been in a release yet
* lambda-promtail: fix typo
* lambda-promtail: declare variables as a set
* lambda-promtail: add a versions file with provider requirements
* lambda-promtail: remove provider block
   - There's no reason to specify a region here
   - Empty provider blocks are not needed in terraform for quite some time now
     (and infact they end up producing a warning about their deprecation)
* lambda-promtail: bucket_names can be the empty array
  Without this, you get an error that `resources` cannot be the empty list
* lambda-promtail: convert inline policy to a aws_iam_policy_document",71,58,1,0,"2018-04-16 10:25:39","1765.37"
"grafana/loki","c49e807a55561eb4855898dda2d07a12c56ce841","cyriltovena","2021-03-12 12:29:20","true","Fixes Issue 28593: loki:fuzz_parse_expr: Timeout in fuzz_parse_expr. (#3470)

This was caused by a lot of allocations when parsing range duration.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",155,35,0,1,"2018-04-16 10:25:39","1056.59"
"grafana/loki","b06d9703d59425d636aa04b7f35247937d3f1ffc","sandeepsukhani","2021-03-18 13:41:07","true","fix live tailing of logs from Loki (#3509)",163,35,0,1,"2018-04-16 10:25:39","1062.64"
"grafana/loki","fad3b61be778668a62aaca744111a1c088dbbb83","sandeepsukhani","2020-04-20 10:22:38","true","flush boltdb to object store (#1837)

* flush boltdb to object store

files are stored in folder per periodic table and are named after ingester
flushed every 15 mins to make index available to other services
files are also flushed before ingester stops to avoid any data loss
new stores can be implemented easily
ingester to also query store when using boltdb

* persisting uploader name across restarts, detecting objectstore type from periodic config, other refactorings

* updated cli flag for active directory

* add tests for boltdb shipper and update vendor

* syncing boltdb files to disk during update

* sleep in tests to let mtime of boltdb file be changed

* add documentation for boltdb shipper and remove unwanted config",115,24,0,1,"2018-04-16 10:25:39","734.5"
"grafana/loki","2564a810c5872205c7385cd6d0a787b68477188f","sandeepsukhani","2021-11-03 18:30:22","true","Logs deletion fixes (#4625)

* check all tables when we have delete requests to process since chunks could span multiple tables

* upload modified index when the it is modified without dropping the chunk

* fix broken test

* lint

* Fix modified check

Co-authored-by: Cyril Tovena <cyril.tovena@gmail.com>

* suggested changes from PR review

* add changelog

Co-authored-by: Cyril Tovena <cyril.tovena@gmail.com>
Co-authored-by: Owen Diehl <ow.diehl@gmail.com>",170,42,0,1,"2018-04-16 10:25:39","1293.09"
"grafana/loki","9dad6a1350fdaa313fbea5512050c1f6f142e863","kevinburkesegment","2023-09-18 07:45:48","true","clients,pkg: use http.NewRequestWithContext (#10616)

**What this PR does / why we need it**: It saves one line, and the new
function
(vs. http.NewRequest) performs additional validation of the request.

**Which issue(s) this PR fixes**: None

**Special notes for your reviewer**: None

**Checklist**
- [X] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)

Not necessary:

- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

Co-authored-by: Michel Hollands <42814411+MichelHollands@users.noreply.github.com>",39,65,1,0,"2018-04-16 10:25:39","1978.14"
"grafana/loki","7c1355cedfa36b627e785edcac65b0c4c695a5d2","tomwilkie","2018-11-19 18:37:31","false","update vendor

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",5,7,0,0,"2018-04-16 10:25:39","213.34"
"grafana/loki","fb6f6d2e2f0b1aad8667da579816a04dff521b7b","shantanualsi","2023-11-01 13:55:30","true","Stop using global logger in modules (#11051)

**What this PR does / why we need it**:
Refactors Loki to inject logger from the constructors instead of using
global logger variable. It is generally considered a good practice.

**Which issue(s) this PR fixes**:
[Fixes #<issue
number>](https://github.com/grafana/loki-private/issues/810)

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)
- [ ] If the change is deprecating or removing a configuration option,
update the `deprecated-config.yaml` and `deleted-config.yaml` files
respectively in the `tools/deprecated-config-checker` directory. <!--
TODO(salvacorts): Add example PR -->",15,66,1,0,"2018-04-16 10:25:39","2021.4"
"grafana/loki","038a7722d6aba68640e662bb946476233ef809e4","jeschkies","2023-03-29 14:55:39","true","Ask users to add node types to the sizing tool. (#8834)

**What this PR does / why we need it**:
We want to invite users to make contributions to the node types of the
sizing tool since we don't have the capacity to do so.

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

---------

Co-authored-by: J Stickler <julie.stickler@grafana.com>",85,59,1,1,"2018-04-16 10:25:39","1804.19"
"grafana/loki","550bfa794881163feae3a895d474aee8aaacbd74","oke-py","2019-11-07 12:13:48","false","helm/loki-stack supports k8s 1.16 (#1238)",66,19,0,0,"2018-04-16 10:25:39","566.33"
"grafana/loki","735e8dc17dffbe969b936821536be54dda1d944a","rsteneteg","2021-05-05 12:57:29","true","Remove targets that dont have any tails, in order for the target to be removed and recreated during next sync (#3587)

Signed-off-by: Roger Steneteg <rsteneteg@ea.com>",186,37,0,0,"2018-04-16 10:25:39","1114.86"
"grafana/loki","42040f2d5b6f4034a40918c4a61ea1481c89ebee","pracucci","2019-09-30 07:56:10","false","Skip ingester tailer filtering if no filter is set",70,17,0,0,"2018-04-16 10:25:39","529.15"
"grafana/loki","5b361a0c892e41bddb994547c7465f1afb2abad3","sandeepsukhani","2020-09-18 12:09:01","true","improvements for boltdb-shipper compactor (#2640)

1. Run the compaction process on startup instead of waiting for the first tick.
2. Run the compactor service when using loki with boltdb-shipper in single binary mode without clustering.",120,29,0,1,"2018-04-16 10:25:39","882.57"
"grafana/loki","501f93fa9269ee0de6a38912159e66e25e93ded1","sandeepsukhani","2020-08-24 11:52:31","true","revendor cortex to latest master (#2543)",122,28,0,1,"2018-04-16 10:25:39","858.56"
"grafana/loki","db14ff193cba32152e67930e45d1f544a2f8137f","sandeepsukhani","2021-01-28 13:37:59","true","limit query range in async store for ingesters when query-ingesters-within flag is set (#3201)

* limit query range in async store for ingesters when query-ingesters-within flag is set

* do not reduce ingester query start time",123,33,0,1,"2018-04-16 10:25:39","1012.63"
"grafana/loki","9b1dc8062ec0bf4818b8707e20be76ec9b5b2a81","tomwilkie","2018-07-04 10:11:02","true","Fix heap iterator & make tests a lot better. (#23)

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",5,3,0,0,"2018-04-16 10:25:39","77.99"
"grafana/loki","1f7fabfbb986ef126875173b0b5d9376cf288cbe","shwetaap","2022-11-12 09:40:39","true","operator: Add provision for the user to set proxy env variables in the loki pods (#7384)",86,55,1,0,"2018-04-16 10:25:39","1666.97"
"grafana/loki","ace5993202401ea27c04ce7153ca83106d1602c3","sh0rez","2019-08-01 15:37:20","true","chore: deploy (#836)

- bump build image to 0.4.0
- re-gen protos
- re-add deploy task",107,15,0,0,"2018-04-16 10:25:39","470.47"
"grafana/loki","1ff4ad75d397b54f25158459b35c60192d960cc3","Alex3k","2023-04-14 20:28:09","true","Updated Scalability benefit to call out decoupled read/write paths an… (#9032)

**What this PR does / why we need it**:
Updated Scalability benefit to call out decoupled read/write paths and
that benefit - this is a huge competitive edge over tools like Splunk
and Elastic and it makes sense to explicitly call it out under our
benefits",81,60,1,0,"2018-04-16 10:25:39","1819.42"
"grafana/loki","b03e2783d6c71ab230c8d82de5746bac84211081","jeschkies","2022-01-18 14:04:51","true","Package logcli as rpm and deb. (#4667)

* Package logcli as rpm, deb and apk.

* Package logcli on release builds.",265,45,0,1,"2018-04-16 10:25:39","1367.9"
"grafana/loki","054b8fcc915d656e6444168e3e890afd1fcce82d","chancez","2021-02-02 16:28:35","true","logcli: Refactor logcli Client interface to use time.Time and time.Duration for LiveTailQueryConn method (#3271)",122,33,0,0,"2018-04-16 10:25:39","1016.75"
"grafana/loki","ddddd14726bf0190eb87035e9aab77769f410a0d","gouthamve","2019-03-15 12:59:29","true","Update cortex vendoring (#325)

* Update cortex vendoring

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>

* Fix API breakage

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>",93,11,0,0,"2018-04-16 10:25:39","329.11"
"grafana/loki","904ea0586ab82fc14d9b0a1b42f8e6183e39b6e0","bboreham","2023-06-16 20:05:49","true","Remove some unused code (#9611)

**What this PR does / why we need it**:

Remove some functions I came across while making Loki compatible with
different `Labels` structures.
Move `MetricToLabels` to the only place it is now used, and make it call
abstractions instead of assuming `Labels` is a slice.

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- NA Documentation added
- NA Tests updated
- NA `CHANGELOG.md` updated
- NA Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- NA For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",58,62,1,0,"2018-04-16 10:25:39","1886.65"
"grafana/loki","aa544a9dffdb8e78f7d7ed8edafce466d333b0a8","sandeepsukhani","2021-05-03 12:16:52","true","cleanup boltdb files failing to open during loading tables which are possibly corrupt (#3605)",181,37,0,1,"2018-04-16 10:25:39","1112.83"
"grafana/loki","9b554bba8d27991820a4ce5e01c17f3753264415","sandeepsukhani","2023-07-26 12:21:51","true","implementing string interning to optimize resource usage for storing and processing non-indexed labels (#10044)

**What this PR does / why we need it**:
In PR #9700, we added support for storing non-indexed labels in chunks.
This PR optimizes resource usage for storing and processing non-indexed
labels by doing string interning. We will store deduped label names and
values as a list in chunks
in the newly added non-indexed labels section. The labels would then be
referenced in blocks by their index(called symbols).

Additionally, I have started the convention of writing lengths of
sections with their offsets within chunks, making it easier to introduce
new sections. The section offsets and lengths would be stored at the end
of the chunk, similar to
[TOC](https://ganeshvernekar.com/blog/prometheus-tsdb-persistent-block-and-its-index/#a-toc)
in TSDB.

**Checklist**
- [x] Tests updated",54,63,1,1,"2018-04-16 10:25:39","1926.33"
"grafana/loki","94a5f94cf408e2da3e4293e8163e18c47c74e4d6","alexandresalome","2023-08-29 18:34:30","true","Docker: Update the analytics sourcecode URL in the docker local configuration (#10363)

**What this PR does / why we need it**:

The URL about Analytics sourcecode in the docker configuration file returns a 404.

**Which issue(s) this PR fixes**: *no issue opened, trivial fix*

**Special notes for your reviewer**: hello :wave: nice to meet you",48,64,1,0,"2018-04-16 10:25:39","1959.59"
"grafana/loki","f9aba994555da55f424163a49b53bb6643946aa2","oleksii-boiko-ua","2023-05-25 14:36:04","true","Helm: add hpa for read, write and backend (#8684)

**What this PR does / why we need it**:
It adds missing HPA (HorizontalPodAutoscaler) templates to write, read,
and backend components
**Which issue(s) this PR fixes**:
Fixes #7864

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [ ] Tests updated
- [x] `CHANGELOG.md` updated
- [x] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

Co-authored-by: Oleksii Boiko <oleksii_boiko@external.mckinsey.com>",67,61,1,0,"2018-04-16 10:25:39","1865.42"
"grafana/loki","5c9e8b467ff27d2e88572cd9449076e93405a61b","blockloop","2021-03-19 22:46:55","true","rename github workflow to make more sense (#6)",169,35,0,0,"2018-04-16 10:25:39","1064.01"
"grafana/loki","42e251bb345cc75aecad0ef1a4d80d4b5ecd6285","davkal","2019-03-19 13:12:57","true","Merge pull request #398 from daixiang0/enable-loki

Support only deploy loki or promtail and fix helm lint issue",103,11,0,0,"2018-04-16 10:25:39","333.12"
"grafana/loki","8b8d2ca382d29c0d5612dee956dfe48ae2b51d10","trevorwhitney","2023-03-15 22:40:17","true","prepare changelog for 2.8 release (#8798)

**What this PR does / why we need it**:

Prepares the changelog for the 2.8 release",87,59,1,1,"2018-04-16 10:25:39","1790.51"
"grafana/loki","384520436d65921cb1a8118424057cf787051a1c","adityacs","2020-07-02 20:37:31","true","Fix fluent-bit \n and \t characters (#2286)",130,27,0,1,"2018-04-16 10:25:39","806.92"
"grafana/loki","67b12f235752b1fe9b74967442fe7ed00d06cd4d","chaudum","2022-09-21 08:07:17","true","Update distributor push tests (#6641)

Adds a test case for concurrent pushes (which would have spotted a bug
in https://github.com/grafana/loki/pull/5248) and a test case for
tolerance regarding replication factor.

The PR also replaces the mock ring with an actual in-memory kv store
ring.
And variables and function names were changed to meet Loki/logs
terminology.

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",86,53,1,1,"2018-04-16 10:25:39","1615.9"
"grafana/loki","2836c79537786399524bdf3329299f8dfa30c055","owen-d","2023-02-22 23:18:57","true","Revert ""Loki: Fix memchunk headblock filter"" (#8594)

Reverts grafana/loki#8591

This altered an internal API. We execute queries that are inclusive of
start and exclusive of end: `[start,end)` and shouldn't break this. We
use other ways to ensure `start==end` still works, such as by using the
lookback-period to alter the range of queries:

https://github.com/grafana/loki/blob/main/pkg/logql/evaluator.go#L179-L181",65,58,1,1,"2018-04-16 10:25:39","1767.54"
"grafana/loki","4721d7efd308e7d85fe03464041179bb1414fe8c","Red-GV","2023-03-23 10:18:23","true","operator: Remove mutations to non-updatable statefulset fields (#8875)",83,59,1,1,"2018-04-16 10:25:39","1797.99"
"grafana/loki","bf530fc64b4c67965a9e93344a7c99b465c4c128","JStickler","2023-09-06 07:20:19","true","[Docs] Update warning on structured metadata topic (#10459)",46,65,1,0,"2018-04-16 10:25:39","1966.12"
"grafana/loki","4a569f255a68bee103d7c3a08d8106cd3253d79f","sandeepsukhani","2019-07-26 13:32:17","false","Fix broken link in readme file",100,15,0,1,"2018-04-16 10:25:39","465.38"
"grafana/loki","1221658fc5bb1da5c87ae57e9c3b3115459db882","DylanGuedes","2023-08-03 18:03:00","true","Introduces cache to TSDB postings (#9621)

**What this PR does / why we need it**:
Introduces a new interface for fetching TSDB postings and implements a cached TSDB postings.
The new postings interface is named `PostingsReader` and contains two implementations: a simple one, which is identical to the former Postings behavior, and a new one, that caches postings using the existing `index_queries_cache_config`. By default, the simple/former implementation is used. The new cached implementation can be configured in the following way:
```yaml
storage_config:
  tsdb_shipper:
    cache_postings: true
```

In the future, we'll remove the `cache_postings` flag and change the behavior to cache postings by default.",52,64,1,1,"2018-04-16 10:25:39","1933.57"
"grafana/loki","19260d442532e7a6268f74dca0c5cf2b74fa46d3","slim-bean","2019-03-05 21:07:46","true","Adding a configurable timeout for calls to the loki server. (#368)

Adding a configurable timeout for calls to the loki server.
Updating promtail test to set sane defaults for all configurations and then override for testing.
Removing .idea folder from .gitignore, we should encourage people (and myself) to use global ignore for IDE configs",89,10,0,1,"2018-04-16 10:25:39","319.45"
"grafana/loki","33e44ed39d61c910f7d84c68816d23d121f2a54c","dannykopping","2023-03-13 11:55:23","true","Ruler: remote rule evaluation (#8744)

**What this PR does / why we need it**:
Adds the ability to evaluate recording & alerting rules against a given
`query-frontend`, allowing these queries to be executed with all the
parallelisation & optimisation that regular adhoc queries have. This is
important because with `local` evaluation all queries are
single-threaded, and rules that evaluate a large range/volume of data
may timeout or OOM the `ruler` itself, leading to missed metrics or
alerts.

When `remote` evaluation mode is enabled, the `ruler` effectively just
becomes a gRPC client for the `query-frontend`, which will dramatically
improve the reliability of the `ruler` and also drastically reduce its
resource requirements.

**Which issue(s) this PR fixes**:
This PR implements the feature discussed in
https://github.com/grafana/loki/pull/8129 (**LID 0002: Remote Rule
Evaluation**).",87,59,1,1,"2018-04-16 10:25:39","1788.06"
"grafana/loki","82635f6f397e94942f406b316ecff1a8399c3386","daixiang0","2019-05-17 05:38:24","false","bump up promtail chart version

Signed-off-by: Xiang Dai <764524258@qq.com>",102,13,0,0,"2018-04-16 10:25:39","396.05"
"grafana/loki","d14669d20b83862af7cd15f1a8dbbae2000fe2bb","MattiasSegerdahl","2023-05-01 08:26:49","true","Update cri.md (#9310)

**What this PR does / why we need it**:

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",79,60,1,0,"2018-04-16 10:25:39","1841.17"
"grafana/loki","29be929a8cde0a20fc2e639285db90cf9be88338","jeschkies","2020-11-19 08:14:51","true","Test label filter for bytes. (#2941)

* Test label filter for bytes.

Summary:
- Adds a new test to `ast_test` for filtering by bytes.|
- Test another case than `B`.

* Test all combinations of byte sizes.",116,31,0,1,"2018-04-16 10:25:39","943.41"
"grafana/loki","d3d7ab7d82c6dda769f3867df3be8be9651b2fb5","chaudum","2023-09-22 14:56:27","true","Promtail: Remove deprecated stream_lag_labels setting (#10677)

The setting was deprecated and already caused an error on startup when used.
This behaviour was noticed when looking at the reference configuration docs of Promtail.

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",35,65,1,1,"2018-04-16 10:25:39","1982.44"
"grafana/loki","3d7060bf73ac192b31d7dc547897286e04498410","jcantrill","2023-04-26 13:51:39","true","fluent-plugin-grapha-loki: Add config to support tls: ciphers, min_version (#9289)",81,60,1,0,"2018-04-16 10:25:39","1836.39"
"grafana/loki","cc6f6b9171b20a1d10d85d948f4a303933ec16a6","owen-d","2023-04-26 21:52:10","true","Revert ""start writing tsdb v3"" (#9301)

Reverts grafana/loki#9276

Update main to prevent writing v3 by default while I find a bug in it.",80,60,1,1,"2018-04-16 10:25:39","1836.73"
"grafana/loki","0489d16af8adcad8fc34273009f4f35d8083dfad","ashwanthgoli","2023-04-28 10:17:03","true","fix flaky integration TestMicroServicesDeleteRequest test (#9337)

**What this PR does / why we need it**:

`loki_compactor_deleted_lines` increments each time we find a line to
delete from a chunk. If the chunk is indexed in multiple tables, we
increment it for each of these tables as they get compacted.

Currently the chunk (that holds the line to be deleted) starts @`now -
46h`, so depending on when the test runs it gets indexed in 2 or 3
tables. It has been failing between hours `22:00 - 23:59` as the chunk
only overlaps and gets indexed in 2 tables while the test expects it to
be indexed in 3
https://drone.grafana.net/grafana/loki/23063/2/1
https://drone.grafana.net/grafana/loki/23067/2/1

Updating the chunk start time to now-48h so that it always gets indexes
in 3 tables",80,60,1,0,"2018-04-16 10:25:39","1838.24"
"grafana/loki","cbc9c60b59a184dd2b3921e4b6ed000155663fe0","jeschkies","2023-04-18 06:56:13","true","Give config snippets for automatic stream sharding. (#9098)",83,60,1,1,"2018-04-16 10:25:39","1828.1"
"grafana/loki","ee371a867df379d36e06e98c0639c899ee719b9d","btaani","2023-03-21 20:27:50","true","operator: Add support for rules configmap sharding (#7451)",84,59,1,0,"2018-04-16 10:25:39","1796.42"
"grafana/loki","53b9a351e5cd27dd3f1175a3d2cbe9522838c707","DylanGuedes","2023-03-17 21:08:35","true","Loki: Add a `prepare-shutdown` endpoint (#8786)

**What this PR does / why we need it**:
Add a new `/ingester/prepare_shutdown` endpoint. This new endpoint
configures the ingester to release resources on the next SIGTERM.

---------

Co-authored-by: J Stickler <julie.stickler@grafana.com>",84,59,1,1,"2018-04-16 10:25:39","1792.45"
"grafana/loki","d8ee6b8a5bd3405b5130c976b7867e163fb1b4f8","rfratto","2019-07-26 19:39:54","false","ingester: register Ingester service in gRPC on loki start

Registering the Ingester service to gRPC enables the chunk transfer
mechanism to work.",100,15,0,1,"2018-04-16 10:25:39","465.63"
"grafana/loki","7e9ac16dbf1014d5183571e4858457005f99e0bf","cyriltovena","2021-03-04 23:01:21","true","Add fgfprof to Loki and Promtail. (#3424)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",141,34,0,1,"2018-04-16 10:25:39","1049.02"
"grafana/loki","55b91fc79399c12cfbc5e081fa99ac7803484ccb","cyriltovena","2021-02-26 15:47:44","true","Fixes head chunk iterator direction. (#3383)

* Fixes head chunk iterator direction.

For backward queries, since LogQL parser we are using a heapIterator in the headchunk to re-order properly entries.
But we also reverse all iterators in the memchunk code, even the headchunk which causes reversal of already reversed entries.

This PR skips reversal of the headchunk.

Fixes #3345
Fixes #3208

This has for side effects:
-  when using replication you would not dedupe data properly anymore, since the data is not correctly ordered accross batches.
-  when using limit it would miss entries.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fix reversal and time filtering of headchunk.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",138,34,0,1,"2018-04-16 10:25:39","1040.72"
"grafana/loki","ea488f994023a7c3a436a9297efeff4ef1b3efd5","cyriltovena","2021-01-21 09:12:09","true","Improve ingester flush memory usage. (#3200)

* Add basic benchmark.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Improves memory usage of checkpointer series iterator.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* make lint.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add benchmark for flush loop.

```
goos: darwin
goarch: amd64
pkg: github.com/grafana/loki/pkg/ingester
Benchmark_FlushLoop-16    	      16	  70040359 ns/op	241901661 B/op	    1112 allocs/op
PASS
ok  	github.com/grafana/loki/pkg/ingester	4.829s
```

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Improve benchmark.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Re-use buffer when flushing chunks.

benchcmp

```
❯ benchcmp  before.txt after.txt
benchmark                  old ns/op     new ns/op     delta
Benchmark_FlushLoop-16     104723243     9233780       -91.18%

benchmark                  old allocs     new allocs     delta
Benchmark_FlushLoop-16     1115           568            -49.06%

benchmark                  old bytes     new bytes     delta
Benchmark_FlushLoop-16     241857243     989590        -99.59%
```

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* better size computation.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes test ordering flakyness.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* lint.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",115,33,0,1,"2018-04-16 10:25:39","1005.45"
"grafana/loki","45ed6d560d9d29814e73da2effc230882936c40a","cyriltovena","2021-11-24 15:30:07","true","Fix up a merge conflict on log filter (#4815)

* Fix up a merge conflict on log filter

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* use the same parameter order as the stdlib

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",214,43,0,1,"2018-04-16 10:25:39","1313.96"
"grafana/loki","e5c425eef6980604d96ed5f341598b32e706b9e6","periklis","2023-09-04 12:05:47","true","Allow using the forget button when access via the internal server (#10221)",46,65,1,1,"2018-04-16 10:25:39","1964.32"
"grafana/loki","bbb82b5781d9a1614d20f8a689af0c3cfb335837","julienduchesne","2021-05-10 15:11:17","true","Deploy loki with Drone plugin instead of CircleCI job (#3708)

We are deprecating the CircleCI job
Also, I moved secrets to Vault instead of Drone repository secrets

Note that this will require Flux in all environments that are updated

Issue: grafana/deployment_tools#5307",190,37,0,0,"2018-04-16 10:25:39","1119.95"
"grafana/loki","20bb95f75a6d10112d35d3c4e2c3223ce81155f3","slim-bean","2019-11-25 18:51:28","false","Removing this file used to trick dep into importing packages, the second import already exists in the logproto.pb.go file and the first import is already imported other places in our code.
This should fix the anyone using the logproto.pb.go file from registering a bunch of cortex metrics.",83,19,0,1,"2018-04-16 10:25:39","584.6"
"grafana/loki","cb53a4713986ec9af7e3054a97b95a667d5c9ca6","sandeepsukhani","2020-11-05 06:34:42","true","fix query intervals when running boltdb-shipper in single binary (#2855)",127,31,0,1,"2018-04-16 10:25:39","929.34"
"grafana/loki","cf64b70db398b6fa547ec045589ca02813836cb6","sandeepsukhani","2020-08-13 13:38:04","true","add some spans for boltdb shipper index queries (#2495)",119,28,0,1,"2018-04-16 10:25:39","847.63"
"grafana/loki","6442ec1bdddd810ab261d18bceb604e40f6835a3","dannykopping","2023-04-04 08:56:50","true","Mixins: check that `memcached_index_writes` exists before using it in `boltdb_shipper` (#8995)

**What this PR does / why we need it**:
This key is missing when not using boltdb_shipper, but this lib is
included by default",81,59,1,1,"2018-04-16 10:25:39","1808.94"
"grafana/loki","eff4ff1231c8f25092b965ae5b239651c81d5117","cyriltovena","2021-03-31 12:26:44","true","Improve matchers validations. (#3564)

1- It currently 500.
2- Happens too late, at ingester level and querier. (better at the frontend)
3- Improve API surface level, we don't need to expose this validation for anything else than ParseLogSelector.

see #3216

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",146,35,0,1,"2018-04-16 10:25:39","1075.58"
"grafana/loki","d450bbb668e9edd3f3ee1a00a27abc176b76d93c","cyriltovena","2021-03-31 11:17:26","true","Fixes a test from #3216. (#3562)

Minor refactoring missing.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",146,35,0,1,"2018-04-16 10:25:39","1075.54"
"grafana/loki","27f17bc1de9500f3c7cf1927668a6d5ce3e33644","cyriltovena","2019-11-28 14:14:04","true","Fixes linter warning from the yacc file. (#1328)

* Fixes linter warning from the yacc file.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Improves sed to work on POSIX

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",86,19,0,1,"2018-04-16 10:25:39","587.41"
"grafana/loki","184927ccdcf2f5fc8e93ec1c3b25c1b3f9736968","codesome","2019-08-30 09:18:52","false","Split files and make yacc more redable

Signed-off-by: Ganesh Vernekar <cs15btech11018@iith.ac.in>",120,16,0,0,"2018-04-16 10:25:39","499.2"
"grafana/loki","b7359c5d5379f0fc3ad958a752cca53db8449ab6","salvacorts","2023-06-16 11:48:56","true","Revert ""Add summary stats and metrics for stats cache (#9536)"" (#9721)

This reverts commit af287ac3eba46e04ad1d5cf8051262ea0f2a25de.

There is a bug in this PR that inflates the stats returned for the query
since we reuse the stats ctx in the query execution engine.",59,62,1,1,"2018-04-16 10:25:39","1886.31"
"grafana/loki","949126e75b4035fe2fe30b98f6561a81c6637ecd","cyriltovena","2019-12-14 18:05:44","false","Add a line limit in case a chunk is corrupted to avoid OOM.

Also when running out of memory we should just return an error
and not keep going.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",93,20,0,1,"2018-04-16 10:25:39","603.57"
"grafana/loki","f5c0fdf02873ec353a7cb4cc4f17c06431412947","dannykopping","2023-05-03 08:03:45","true","Upgrade to latest security release: go1.20.4 (#9370)

**What this PR does / why we need it**:
https://groups.google.com/g/golang-announce/c/MEb0UyuSMsU

Also updated the build image.

---------

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",80,61,1,1,"2018-04-16 10:25:39","1843.15"
"grafana/loki","54e46446fa73a26c15759648b8c536063eebd834","chaudum","2023-10-04 16:57:03","true","Do not transfer off chunks on ingester shutdown (#10709)

This PR removes the ability of an ingester in LEAVING state prior to shutdown to transfer chunks off to another ingester in the ring in PENDING state.

The **Write Ahead Log** (WAL) supersedes the chunk transfer feature.

See upgrade notes for information how to replace the removed setting.

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>
Co-authored-by: Salva Corts <salva.corts@grafana.com>",27,66,1,1,"2018-04-16 10:25:39","1994.52"
"grafana/loki","3d5319e72afb8008e1ed75432af4212fc7e5be47","slim-bean","2019-07-23 13:09:58","false","adding ability to supply timezone to timestamp pipeline stage",103,15,0,1,"2018-04-16 10:25:39","462.36"
"grafana/loki","cb8a630ca79b8ec135fbaed4a4c2edee74c6c99c","blockloop","2021-03-11 21:50:57","true","kustomize",154,35,0,0,"2018-04-16 10:25:39","1055.98"
"grafana/loki","513cb44b081301c895e9f52b78fe9254ed083a06","grafanabot","2023-09-06 16:55:42","true","[CI/CD] Update yaml file `./production/helm/loki/Chart.yaml` (+1 other) (#10483)

**Here is a summary of the updates contained in this PR:**
***
Update attribute `$.appVersion` in yaml file
`./production/helm/loki/Chart.yaml` to the following value: `2.9.0`
***
Bump version of Helm Chart
Add changelog entry to `./production/helm/loki/CHANGELOG.md`
Re-generate docs

Co-authored-by: Kaviraj Kanagaraj <kavirajkanagaraj@gmail.com>",46,65,1,0,"2018-04-16 10:25:39","1966.52"
"grafana/loki","0e729e032c4f872335f999b83e1ec5bee01c0324","DylanGuedes","2023-08-12 10:14:59","true","Configuration: Allow customization of default runtime values (#10193)

**What this PR does / why we need it**:
Adds a new section to our runtime configuration that will allow
customization of default runtime values.
For instance, our default `log_push_request` is `false`. Previously,
there was no way of setting it to `true`, so you'd have to set it for
every existing tenant. Now you can by making usage of the new `default` section.",52,64,1,1,"2018-04-16 10:25:39","1942.24"
"grafana/loki","71837194ba4859da672987010544196999c40215","trevorwhitney","2023-02-07 23:46:50","true","add section to prom operator instructions about necessary label (#8379)",77,58,1,1,"2018-04-16 10:25:39","1752.56"
"grafana/loki","bc0069756e2e6942cfd34924d2e3ab0b9474b967","DylanGuedes","2023-07-05 16:33:20","true","Queriers: Stop emitting spans for every objectstorage call (#9857)

**What this PR does / why we need it**:
Stop emitting spans for every call to our object storages (like S3 or
Azure). They are causing every chunk fetching to emit a span. Request metrics will still be reported just fine.

**Which issue(s) this PR fixes**:
N/A",59,63,1,1,"2018-04-16 10:25:39","1905.51"
"grafana/loki","57f9452231575b0e8cd4ea27029ec2dd6b88c21c","kavirajk","2023-06-12 13:21:08","true","Revert 9217 chaudum/tsdb chunkrefs pool (#9685)

Revert #9217 (potential bug in query result)

---------

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",67,62,1,1,"2018-04-16 10:25:39","1882.37"
"grafana/loki","a65c99d9bfc711f4ed50e70346aa3f0b650bd959","chaudum","2023-06-27 07:21:49","true","Add per-tenant request counter metric to index gateway server (#9797)

This commit add a counter metric `loki_index_gateway_requests_total` with labels `operation`, `tenant`, `status` for gRPC requests that are served by the index gateway.

**What for?**

The per-tenant RPS on the index gateway is used to derive the per-tenant shard factor.

**Why tracking on the server?**

Unlike tracking index gateway RPS on the client side, tracking on the server side does not yield that many series, even in multi-tenant installations with a lot of tenants, because the amount of index gateway instances is relatively small compared to the amount of queriers and frontends.

**Special notes for your reviewer**:

The previous approach of tracking requests on the client https://github.com/grafana/loki/pull/9781 has been abandoned.


Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",61,62,1,1,"2018-04-16 10:25:39","1897.12"
"grafana/loki","afee8bcabf5bba6c962eaad039eca4174a0a867a","Tolsto","2023-04-20 08:11:25","true","Re-add helm configuration for Azure OIDC federation (#9168)

**What this PR does / why we need it**:

This re-adds the configuration that was removed in
https://github.com/grafana/loki/pull/8515

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",77,60,1,0,"2018-04-16 10:25:39","1830.16"
"grafana/loki","b5308bbb14794b24fb074302df4674cf2ec3280f","MichelHollands","2023-07-24 09:42:39","true","Update docs to 2.8.3 (#10016)

**What this PR does / why we need it**:
Mention the new 2.8.3 release instead of 2.8.2

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [X] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

Signed-off-by: Michel Hollands <michel.hollands@gmail.com>",54,63,1,1,"2018-04-16 10:25:39","1924.22"
"grafana/loki","d5b6d05557423524ca9e99f43b730f98d1c3cabd","dannykopping","2021-09-21 09:48:14","true","CI: Fixing linter deprecations (#4353)

* Fixing CI deprecations

Replacing deprecated golint with revive (https://github.com/golangci/golangci-lint/pull/1965)

Removing interfacer (https://github.com/golangci/golangci-lint/pull/1755)

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Further suggestions from Marco in https://github.com/grafana/loki/issues/1002

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Clarify instruction

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",136,41,0,1,"2018-04-16 10:25:39","1250.72"
"grafana/loki","7cd70aa01828b5f0e9ad742ce9e4bc1e98f02612","kavirajk","2021-02-10 09:21:40","true","Use project-id from the variables. Remove hardcoding (#3304)",129,34,0,1,"2018-04-16 10:25:39","1024.46"
"grafana/loki","2ad3467a98c4d5fe3497581f9fa556fe873ae729","tomwilkie","2018-04-16 13:12:59","false","Install docker client.",0,0,0,0,"2018-04-16 10:25:39","0.12"
"grafana/loki","01fd5c63d7339eeab5ac8616b22dc3bcbed59a30","tomwilkie","2018-04-16 11:25:38","false","Basic queier boilerplate.",0,0,0,0,"2018-04-16 10:25:39","0.04"
"grafana/loki","76e73d7c2004c3cfe58bdd78261a0a7e95366723","sandeepsukhani","2020-10-06 15:02:53","true","set timestamp in instant query done by canaries which otherwise gets set to now by loki (#2732)",119,30,0,1,"2018-04-16 10:25:39","900.69"
"grafana/loki","9ea59f2062016d91398387ee2231e2e840af6a06","oddlittlebird","2021-08-04 09:01:35","true","Create pull_request_template.md (#3913)",102,40,0,0,"2018-04-16 10:25:39","1203.69"
"grafana/loki","11f699c5a6c5ebe7c26358a6a72cefc9599a0936","blockloop","2021-03-29 15:17:23","true","add bingo (#12)",143,35,0,0,"2018-04-16 10:25:39","1073.7"
"grafana/loki","05e0e91d6e04d7a06dd6831750d2692e09e4ec98","owen-d","2020-08-06 15:00:44","true","Fix/promtail yaml config (#2471)

* promtail config cloneable

* config parsing compile time checks against cloneable",124,28,0,1,"2018-04-16 10:25:39","840.69"
"grafana/loki","54a9e67529e88f3f54c0e09b02abd46825a4f80f","cyriltovena","2020-06-22 12:48:48","true","Render loki datasources even if Grafana is disabled. (#2197)

I didn't realize but this was a perfect ok use case to generate datasource when using a different grafana deployment.

Fixes #2186
Fixes #2195

Now regarding https://github.com/grafana/loki/pull/2086 it seems pretty easy to use `.Values.grafana.sidecar.datasources.enabled` if you don't want any datasources.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",141,26,0,1,"2018-04-16 10:25:39","796.6"
"grafana/loki","c3d3f2ba777a9f57a95e5b2ec67b641af9d69922","fredr","2020-06-15 18:15:16","true","docs: BoltDB typo (#2217)",137,26,0,0,"2018-04-16 10:25:39","789.83"
"grafana/loki","ff7b46297345b215fbf49c2cd4c364d125b6290b","irizzant","2022-12-29 13:03:30","true","updated versions to the latest release v2.7.1 (#7940)

Signed-off-by: irizzant <i.rizzante@gmail.com>

**What this PR does / why we need it**:
This PR updates Loki version to v2.7.1

**Which issue(s) this PR fixes**:
Fixes #7768

Signed-off-by: irizzant <i.rizzante@gmail.com>",99,56,1,0,"2018-04-16 10:25:39","1714.11"
"grafana/loki","27477bf5f56107a9438fad56b3239177f734ab17","KMiller-Grafana","2022-06-28 19:44:22","true","Docs: improve API docs (#6485)

* Docs: improve API docs

* Implement review suggestions.",75,50,0,0,"2018-04-16 10:25:39","1533.39"
"grafana/loki","96130ae38923a69968eb8dc3de5975a90043e117","KMiller-Grafana","2021-11-02 00:15:35","true","Docs: revise incendiary language added in PR 4507 (#4611)",169,42,0,0,"2018-04-16 10:25:39","1291.33"
"grafana/loki","459e4e3f4eb45be27262ac44133f7768340489ae","sandeepsukhani","2019-07-30 12:11:14","false","Update logcli usage in docs and improve help text",104,15,0,1,"2018-04-16 10:25:39","469.32"
"grafana/loki","e65d1b8c692f11240f46f91105f266257696334a","sandeepsukhani","2022-02-15 11:29:16","true","add more context to logs, improve comments for clarity in boltdb-shipper code (#5341)",288,46,0,1,"2018-04-16 10:25:39","1394.79"
"grafana/loki","7566aa49500eb00b0c5f1e516120beae229bcc10","sandeepsukhani","2020-09-01 16:36:56","true","fix closing of compressed file from boltdb-shipper compactor (#2574)",118,28,0,1,"2018-04-16 10:25:39","865.76"
"grafana/loki","97a7ed0b611a5cb9afa9ad1e01cd3d893c66d5d5","sandeepsukhani","2022-11-23 10:19:20","true","fix logs deletion integration test to properly validate deleted data (#7751)

**What this PR does / why we need it**:
Currently, the integration test for deletion does not validate whether
the delete request properly deleted the requested data or not. It just
currently checks if the delete request got processed. This was due to
the singleton `boltdb-shipper` client causing problems in flushing
chunks.

I have used `ResetBoltDBIndexClientWithShipper` to reset the
boltdb-shipper client to get the chunk flush from the ingester working.
The test now does the checks to ensure that the right data got deleted
by the compactor. This should help us catch any bugs earlier for any
future changes in deletion code.

**Checklist**
- [x] Tests updated",93,55,1,1,"2018-04-16 10:25:39","1678"
"grafana/loki","b31c3316fe137fd87792d94dc6a5263d97780bec","periklis","2021-03-29 15:40:49","true","Add operator-sdk to bingo targets (#14)

Co-authored-by: Periklis Tsirakidis <periklis@redhat.com>",143,35,0,1,"2018-04-16 10:25:39","1073.72"
"grafana/loki","557fdf2206f9942022ce3608952d419185616ab9","liguozhong","2022-09-22 11:38:03","true","[bugfix] logql: vectorExpr run fail when query_range: parallelise_shardable_queries: true (#7045)

…hardable_queries: true

<!--  Thanks for sending a pull request!  Before submitting:

1. Read our CONTRIBUTING.md guide
2. Name your PR as `<Feature Area>: Describe your change`.
a. Do not end the title with punctuation. It will be added in the
changelog.
b. Start with an imperative verb. Example: Fix the latency between
System A and System B.
  c. Use sentence case, not title case.
d. Use a complete phrase or sentence. The PR title will appear in a
changelog, so help other people understand what your change will be.
3. Rebase your PR if it gets out of sync with main
-->

**What this PR does / why we need it**:
A grafana error occurred when I deployed the vector(0) function to our
online loki cluster.
It was finally found because online loki has a configuration


`unexpected expr type (*syntax.VectorExpr) for ASTMapper type
(logql.ShardMapper)
`
```yaml
query_range:
   parallelise_shardable_queries: true
```
**Which issue(s) this PR fixes**:
Fixes #

**Special notes for your reviewer**:
error snapssnapshot

![image](https://user-images.githubusercontent.com/9583245/188357957-e573e589-a789-4e5e-a1c3-b91c019ceb62.png)
with this pr，success snapshot

![image](https://user-images.githubusercontent.com/9583245/188358036-5ca0d9be-c2b6-4516-807c-c027445ee62d.png)

<!--
Note about CHANGELOG entries, if a change adds:
* an important feature
* fixes an issue present in a previous release, 
* causes a change in operation that would be useful for an operator of
Loki to know
then please add a CHANGELOG entry.

For documentation changes, build changes, simple fixes etc please skip
this step. We are attempting to curate a changelog of the most relevant
and important changes to be easier to ingest by end users of Loki.

Note about the upgrade guide, if this changes:
* default configuration values
* metric names or label names
* changes existing log lines such as the metrics.go query output line
* configuration parameters 
* anything to do with any API
* any other change that would require special attention or extra steps
to upgrade
Please document clearly what changed AND what needs to be done in the
upgrade guide.
-->
**Checklist**
- [ ] Documentation added
- [ ] Tests updated
- [ ] Is this an important fix or new feature? Add an entry in the
`CHANGELOG.md`.
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",85,53,1,1,"2018-04-16 10:25:39","1617.05"
"grafana/loki","f9ed9cb7d98dcdaa6fe2f1b7e97ca86af2864121","jijotj","2023-01-04 19:48:06","true","[loki-canary] Support passing loki address as environment variable (#8024)

**What this PR does / why we need it**:
- Replace flag with kingpin which has more capabilities to override
defaults
- Override default for `addr`, `user` and `pass` from environment the
variables `LOKI_ADDRESS`, `LOKI_USERNAME` and `LOKI_PASSWORD`
respectively.

**Which issue(s) this PR fixes**:
Fixes #8021

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the `CONTRIBUTING.md` guide
- [x] Documentation added
- [ ] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",96,56,1,0,"2018-04-16 10:25:39","1719.39"
"grafana/loki","67de0334e970b86f81618139b62479fbf7fc8a44","DylanGuedes","2022-10-21 17:08:27","true","Docs: Add max_streams to Promtail configuration doc (#7489)

**What this PR does / why we need it**:
Document `max_streams` configuration, introduced in 2.7.

Co-authored-by: Ursula Kallio <ursula.kallio@grafana.com>",91,54,1,1,"2018-04-16 10:25:39","1646.28"
"grafana/loki","db423a31fa78fc854afac38d015bac4c20c9ec78","Tazmaniac","2023-02-09 11:30:41","true","[helm] Fix read-only /tmp in 3 targets mode (#8477)",78,58,1,0,"2018-04-16 10:25:39","1754.05"
"grafana/loki","625d19cddbd67afb2d7e6bc5f0f85f9b73e3e073","KMiller-Grafana","2022-01-07 19:43:00","true","Docs: Revise hedging configuration block descriptions (#5069)

* Docs: Revise hedging configuration block descriptions

* Docs: revise 99th percential description per review",256,45,0,0,"2018-04-16 10:25:39","1357.14"
"grafana/loki","7fff66014464893b519ac944979f11f38b6b2c3a","chaudum","2022-05-03 05:37:35","true","Add UDP protocol support to Promtail's syslog target (#5790)

Until now, the syslog target in Promtail did only support TCP. This PR
adds support for sending syslog messages to Promtail (via ng-syslog or
rsyslog) via UDP.

UPD for syslogs can be used if you prefer speed over guaranteed
delivery.

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",75,49,0,1,"2018-04-16 10:25:39","1477.8"
"grafana/loki","162e82ebfbb2d7c9c7f9f81f2e0f5c02ab5cb75d","DylanGuedes","2022-05-02 08:12:09","true","Use quiet flag in logcli tail.go. (#6033)",80,49,0,1,"2018-04-16 10:25:39","1476.91"
"grafana/loki","7b214e2ea60484ced22948f3536c5fc0c6c8b943","trevorwhitney","2022-04-07 20:04:34","true","fix missing file during rpm and deb packaging step (#5818)",320,48,0,1,"2018-04-16 10:25:39","1447.15"
"grafana/loki","55512b11c940baf76381ce1dce28d65b9a5846e9","periklis","2021-12-17 19:36:22","true","Provide saner defaults for loki-operator reconciled config (#4963)",237,44,0,1,"2018-04-16 10:25:39","1337.13"
"grafana/loki","413a8e9d9cb17aed0c16e23255334b8ac531bc94","thejosephstevens","2021-12-14 07:23:21","true","Docs: Fix comment in Loki module loading for accuracy (#4926)

* Fix comment in Loki module loading for accuracy

* Update CHANGELOG.md",230,44,0,0,"2018-04-16 10:25:39","1333.62"
"grafana/loki","556c309549bbea664395ed89df385c8d64a5d827","trevorwhitney","2021-12-06 07:34:34","true","always apply replication factor common config (#4875)

* always apply replication factor common config

* update changelog

* Update pkg/loki/config_wrapper_test.go

Co-authored-by: Dylan Guedes <djmgguedes@gmail.com>

* Update pkg/loki/config_wrapper_test.go

Co-authored-by: Dylan Guedes <djmgguedes@gmail.com>

Co-authored-by: Dylan Guedes <djmgguedes@gmail.com>",214,44,0,1,"2018-04-16 10:25:39","1325.63"
"grafana/loki","29f2a09b0c7399f21ee2a9eec6c29cdd3a3fa2c4","DaveOHenry","2021-11-29 13:39:54","true","Loki mixin: Add grafonnet-lib as dependency (#4811)",214,43,0,0,"2018-04-16 10:25:39","1318.88"
"grafana/loki","e7ecb41331c9233fc416211a4a0ba43d70fb80a2","sandeepsukhani","2023-11-02 11:51:08","true","add documentation on how to use otel collector for ingesting logs to loki (#11026)

**What this PR does / why we need it**:
In PR #10727, we added support for ingesting logs to loki in OTLP
format. This PR adds the documentation on how to configure otel
collector and how the data is mapped from OTLP format to Loki format.

**Checklist**
- [x] Documentation added

---------

Co-authored-by: J Stickler <julie.stickler@grafana.com>",14,66,1,1,"2018-04-16 10:25:39","2022.31"
"grafana/loki","f331d2bf20ccf145eb84b32640646f5f67911eb9","sh0rez","2020-01-17 17:20:02","true","fix(ksonnet): use apps/v1 (#1543)

Required for more modern Kubernetes versions. Limits version support of our libs
to Kubernetes 1.9 to latest (1.17).",104,21,0,0,"2018-04-16 10:25:39","636.54"
"grafana/loki","46334ed5da4de364560af3bf9d2995dd1222023e","slim-bean","2019-03-06 11:23:07","false","adding a few more test cases for entry parsing docker format (#369)

* adding a few more test cases for entry parsing docker format

* adding testify assert and require to clean up tests

* some tweaking to improve readability",88,11,0,1,"2018-04-16 10:25:39","320.04"
"grafana/loki","a9b2dee0b7af473f5e5b51af5ea7223918b88fc8","slim-bean","2023-10-12 19:02:09","true","jsonnet: add index-gateway headless service (#10880)

**What this PR does / why we need it**:

In a recent PR we added support for the simple mode in the index gateway
client to support a connection pool, a headless service is needed for
resolving all the current gateways to be used in the pool

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

Signed-off-by: Edward Welch <edward.welch@grafana.com>",25,66,1,1,"2018-04-16 10:25:39","2002.61"
"grafana/loki","b04ad2e409e53bf88ba5686bacb718f65f5cb023","hervenicol","2023-02-13 07:49:38","true","helm: azure config: don't set use_federated_token if false (#8513)",79,58,1,0,"2018-04-16 10:25:39","1757.89"
"grafana/loki","1ab642f9703c19d25f1937ac50a751053464a542","KMiller-Grafana","2022-06-14 16:27:58","true","Docs: add unpopulated v2.6 release notes section (#6354)",67,50,0,0,"2018-04-16 10:25:39","1519.25"
"grafana/loki","488e64e3ff1bbce70d856c3daed150b061c5614d","MichelHollands","2022-10-21 10:17:54","true","Update helm chart version (#7484)

Update the Loki helm chart version after the changes made in
https://github.com/grafana/loki/pull/7479

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",93,54,1,1,"2018-04-16 10:25:39","1645.99"
"grafana/loki","79dc9ebef88847294ff0d9969eef7dd79fd972b0","salvacorts","2022-07-18 14:57:12","true","Add push route (#6616)",69,51,0,1,"2018-04-16 10:25:39","1553.19"
"grafana/loki","14b0873f2b0a87bedd9d3ab222e865a777116133","n4mine","2022-05-04 18:33:48","true","Revert ""Docs: fix pic location in `sources/fundamentals/architecture/deployment-modes.md` (#6089)"" (#6093)

This reverts commit 1d25e17b321a13c451db3e4c5f58fd1a20629c9e.",75,49,0,0,"2018-04-16 10:25:39","1479.34"
"grafana/loki","1e0386e9e681c0217f11428f210f82f29e433c7d","kavirajk","2021-11-02 14:52:42","true","Fix `ip` matcher lexer to differentiate filter from identifier (#4598)

* Fix `ip` matcher lexer to differentiate filter from identifier

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Revert small fmt fix on expr.y

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* PR remarks from Cyril

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Add ip line filter parser test in mix with ip as label

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",169,42,0,1,"2018-04-16 10:25:39","1291.94"
"grafana/loki","de0c46916111fd89e96617dac37a9a3d0122357a","trevorwhitney","2021-09-29 12:39:14","true","default chunk target size to ~1MB~ 1.5MB (#4388)

* default chunk target size to 1MB

Signed-off-by: Trevor Whitney <trevorjwhitney@gmail.com>

* bump up to 1.5MB

Signed-off-by: Trevor Whitney <trevorjwhitney@gmail.com>",139,41,0,1,"2018-04-16 10:25:39","1258.84"
"grafana/loki","cc0a4c2188cb492a9f8cf820e5b334e7eb70cfa8","rfratto","2019-09-26 12:45:43","true","Fix broken links to docs in README.md (#1067)",72,17,0,1,"2018-04-16 10:25:39","525.35"
"grafana/loki","0ffb432f304be3cd0364e533f98ebe8f76e8e795","tomwilkie","2018-11-19 18:59:34","false","Update for cortex changes.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",5,7,0,0,"2018-04-16 10:25:39","213.36"
"grafana/loki","80bbd0477897e5926ce0441b82a1672f09c0b5ad","tomwilkie","2019-04-19 07:50:13","false","Add an extra filter step if the user specifies a regex using old API.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",95,12,0,0,"2018-04-16 10:25:39","368.14"
"grafana/loki","7f421375841c2334818b9fffc22f774b68edc871","MasslessParticle","2023-03-03 18:02:02","true","Use Line Filters in StringLabelFilter (#8659)

We've done a ton of work to optimize regexes in line filters but nothing
in label filters. To avoid duplicating the work or reworking all of our
filter types, this PR creates a new label filter that has an optimized
line filter. It uses that against the label value to determine if they
match.

Note on Benchmarks: the input string for this is 1114195 bytes long. The
`not` test tells us that our approach is quite a lot slower when the
literal pattern isn't present in the input. The size of the input really
emphasizes it.

Benchmarks:
```
name                                        old time/op    new time/op        delta
LineLabelFilters/foo-8                        50.6ns ± 9%        14.3ns ± 1%        -71.67%  (p=0.000 n=10+8)
LineLabelFilters/not-8                        15.7ns ± 1%     64165.6ns ± 2%    +407766.77%  (p=0.000 n=10+10)
LineLabelFilters/(foo)-8                      58.4ns ± 1%        14.8ns ±10%        -74.68%  (p=0.000 n=9+9)
LineLabelFilters/(foo|ba)-8                   64.9ns ± 0%        18.2ns ± 2%        -71.90%  (p=0.000 n=7+9)
LineLabelFilters/(foo|ba|ar)-8                74.8ns ± 7%        21.4ns ± 2%        -71.42%  (p=0.000 n=10+8)
LineLabelFilters/(foo|(ba|ar))-8              65.1ns ± 1%        18.1ns ± 2%        -72.22%  (p=0.000 n=8+8)
LineLabelFilters/foo.*-8                       882ns ± 4%          15ns ±11%        -98.30%  (p=0.000 n=9+10)
LineLabelFilters/.*foo-8                      11.5ns ± 8%        14.9ns ± 7%        +30.39%  (p=0.000 n=10+10)
LineLabelFilters/.*foo.*-8                    5.46µs ± 7%        0.01µs ± 3%        -99.74%  (p=0.000 n=10+9)
LineLabelFilters/(.*)(foo).*-8                6.26µs ± 7%        0.01µs ± 2%        -99.77%  (p=0.000 n=10+9)
LineLabelFilters/(foo.*|.*ba)-8               5.58µs ± 3%        0.02µs ± 8%        -99.67%  (p=0.000 n=9+10)
LineLabelFilters/(foo.*|.*bar.*)-8            7.02µs ± 7%        0.02µs ± 8%        -99.73%  (p=0.000 n=10+10)
LineLabelFilters/.*foo.*|bar-8                5.53µs ± 6%        0.02µs ± 2%        -99.67%  (p=0.000 n=10+8)
LineLabelFilters/.*foo|bar-8                  3.73µs ± 6%        0.02µs ± 3%        -99.52%  (p=0.000 n=10+9)
LineLabelFilters/(?:.*foo.*|bar)-8            5.43µs ± 8%        0.02µs ± 8%        -99.65%  (p=0.000 n=10+10)
LineLabelFilters/(?P<foo>.*foo.*|bar)-8       5.71µs ± 3%        0.02µs ±10%        -99.68%  (p=0.000 n=9+9)
LineLabelFilters/.*foo.*|bar|buzz-8           5.34µs ± 2%        0.02µs ± 3%        -99.65%  (p=0.000 n=10+9)
LineLabelFilters/.*foo.*|bar|uzz-8            5.36µs ± 1%        0.02µs ± 3%        -99.60%  (p=0.000 n=8+8)
LineLabelFilters/foo|bar|b|buzz|zz-8          68.8ns ± 8%        22.6ns ± 7%        -67.19%  (p=0.000 n=10+10)
LineLabelFilters/f|foo|foobar-8               77.1ns ± 1%        18.6ns ± 9%        -75.90%  (p=0.000 n=8+10)
LineLabelFilters/f.*|foobar.*|.*buzz-8        5.64µs ± 7%        0.02µs ±10%        -99.60%  (p=0.000 n=10+10)
LineLabelFilters/((f.*)|foobar.*)|.*buzz-8    6.29µs ± 8%        0.02µs ±10%        -99.65%  (p=0.000 n=10+10)
LineLabelFilters/.*-8                          963ns ± 8%           2ns ±14%        -99.77%  (p=0.000 n=10+10)
LineLabelFilters/.*|.*-8                      4.46µs ± 8%        0.00µs ± 8%        -99.95%  (p=0.000 n=10+10)
LineLabelFilters/.*||||-8                     2.99µs ± 1%        0.00µs ±16%        -99.93%  (p=0.000 n=8+10)
LineLabelFilters/#00-8                        43.5ns ± 8%         2.1ns ± 1%        -95.25%  (p=0.000 n=10+8)
LineLabelFilters/(?i)foo-8                    71.7ns ± 6%        13.1ns ± 1%        -81.73%  (p=0.000 n=10+8)
LineLabelFilters/(?i)界-8                      16.5ns ± 8%       150.2ns ± 8%       +809.55%  (p=0.000 n=10+10)
LineLabelFilters/(?i)ïB-8                     23.8ns ± 1%  14748979.8ns ± 7%  +62074730.81%  (p=0.000 n=8+10)
LineLabelFilters/(?:)foo|fatal|exception-8     185ns ± 2%          21ns ± 2%        -88.38%  (p=0.000 n=9+8)
LineLabelFilters/(?i)foo|fatal|exception-8    78.4ns ± 3%        20.2ns ± 2%        -74.23%  (p=0.000 n=9+9)
LineLabelFilters/(?i)f|foo|foobar-8           94.3ns ±16%        15.4ns ± 9%        -83.66%  (p=0.000 n=10+10)
LineLabelFilters/(?i)f|fatal|e.*-8            65.7ns ± 5%        18.2ns ± 3%        -72.24%  (p=0.000 n=9+8)
LineLabelFilters/(?i).*foo.*-8                6.04µs ± 8%        0.01µs ± 2%        -99.78%  (p=0.000 n=10+10)

name                                        old alloc/op   new alloc/op       delta
LineLabelFilters/foo-8                         0.00B              0.00B                ~     (all equal)
LineLabelFilters/not-8                         0.00B              0.00B                ~     (all equal)
LineLabelFilters/(foo)-8                       0.00B              0.00B                ~     (all equal)
LineLabelFilters/(foo|ba)-8                    0.00B              0.00B                ~     (all equal)
LineLabelFilters/(foo|ba|ar)-8                 0.00B              0.00B                ~     (all equal)
LineLabelFilters/(foo|(ba|ar))-8               0.00B              0.00B                ~     (all equal)
LineLabelFilters/foo.*-8                       0.00B              0.00B                ~     (all equal)
LineLabelFilters/.*foo-8                       0.00B              0.00B                ~     (all equal)
LineLabelFilters/.*foo.*-8                     0.00B              0.00B                ~     (all equal)
LineLabelFilters/(.*)(foo).*-8                 0.00B              0.00B                ~     (all equal)
LineLabelFilters/(foo.*|.*ba)-8                0.00B              0.00B                ~     (all equal)
LineLabelFilters/(foo.*|.*bar.*)-8             0.00B              0.00B                ~     (all equal)
LineLabelFilters/.*foo.*|bar-8                 0.00B              0.00B                ~     (all equal)
LineLabelFilters/.*foo|bar-8                   0.00B              0.00B                ~     (all equal)
LineLabelFilters/(?:.*foo.*|bar)-8             0.00B              0.00B                ~     (all equal)
LineLabelFilters/(?P<foo>.*foo.*|bar)-8        0.00B              0.00B                ~     (all equal)
LineLabelFilters/.*foo.*|bar|buzz-8            0.00B              0.00B                ~     (all equal)
LineLabelFilters/.*foo.*|bar|uzz-8             0.00B              0.00B                ~     (all equal)
LineLabelFilters/foo|bar|b|buzz|zz-8           0.00B              0.00B                ~     (all equal)
LineLabelFilters/f|foo|foobar-8                0.00B              0.00B                ~     (all equal)
LineLabelFilters/f.*|foobar.*|.*buzz-8         0.00B              0.00B                ~     (all equal)
LineLabelFilters/((f.*)|foobar.*)|.*buzz-8     0.00B              0.00B                ~     (all equal)
LineLabelFilters/.*-8                          0.00B              0.00B                ~     (all equal)
LineLabelFilters/.*|.*-8                       0.00B              0.00B                ~     (all equal)
LineLabelFilters/.*||||-8                      0.00B              0.00B                ~     (all equal)
LineLabelFilters/#00-8                         0.00B              0.00B                ~     (all equal)
LineLabelFilters/(?i)foo-8                     0.00B              0.00B                ~     (all equal)
LineLabelFilters/(?i)界-8                       0.00B              0.00B                ~     (all equal)
LineLabelFilters/(?i)ïB-8                      0.00B              0.00B                ~     (all equal)
LineLabelFilters/(?:)foo|fatal|exception-8     0.00B              0.00B                ~     (all equal)
LineLabelFilters/(?i)foo|fatal|exception-8     0.00B              0.00B                ~     (all equal)
LineLabelFilters/(?i)f|foo|foobar-8            0.00B              0.00B                ~     (all equal)
LineLabelFilters/(?i)f|fatal|e.*-8             0.00B              0.00B                ~     (all equal)
LineLabelFilters/(?i).*foo.*-8                 0.00B              0.00B                ~     (all equal)

name                                        old allocs/op  new allocs/op      delta
LineLabelFilters/foo-8                          0.00               0.00                ~     (all equal)
LineLabelFilters/not-8                          0.00               0.00                ~     (all equal)
LineLabelFilters/(foo)-8                        0.00               0.00                ~     (all equal)
LineLabelFilters/(foo|ba)-8                     0.00               0.00                ~     (all equal)
LineLabelFilters/(foo|ba|ar)-8                  0.00               0.00                ~     (all equal)
LineLabelFilters/(foo|(ba|ar))-8                0.00               0.00                ~     (all equal)
LineLabelFilters/foo.*-8                        0.00               0.00                ~     (all equal)
LineLabelFilters/.*foo-8                        0.00               0.00                ~     (all equal)
LineLabelFilters/.*foo.*-8                      0.00               0.00                ~     (all equal)
LineLabelFilters/(.*)(foo).*-8                  0.00               0.00                ~     (all equal)
LineLabelFilters/(foo.*|.*ba)-8                 0.00               0.00                ~     (all equal)
LineLabelFilters/(foo.*|.*bar.*)-8              0.00               0.00                ~     (all equal)
LineLabelFilters/.*foo.*|bar-8                  0.00               0.00                ~     (all equal)
LineLabelFilters/.*foo|bar-8                    0.00               0.00                ~     (all equal)
LineLabelFilters/(?:.*foo.*|bar)-8              0.00               0.00                ~     (all equal)
LineLabelFilters/(?P<foo>.*foo.*|bar)-8         0.00               0.00                ~     (all equal)
LineLabelFilters/.*foo.*|bar|buzz-8             0.00               0.00                ~     (all equal)
LineLabelFilters/.*foo.*|bar|uzz-8              0.00               0.00                ~     (all equal)
LineLabelFilters/foo|bar|b|buzz|zz-8            0.00               0.00                ~     (all equal)
LineLabelFilters/f|foo|foobar-8                 0.00               0.00                ~     (all equal)
LineLabelFilters/f.*|foobar.*|.*buzz-8          0.00               0.00                ~     (all equal)
LineLabelFilters/((f.*)|foobar.*)|.*buzz-8      0.00               0.00                ~     (all equal)
LineLabelFilters/.*-8                           0.00               0.00                ~     (all equal)
LineLabelFilters/.*|.*-8                        0.00               0.00                ~     (all equal)
LineLabelFilters/.*||||-8                       0.00               0.00                ~     (all equal)
LineLabelFilters/#00-8                          0.00               0.00                ~     (all equal)
LineLabelFilters/(?i)foo-8                      0.00               0.00                ~     (all equal)
LineLabelFilters/(?i)界-8                        0.00               0.00                ~     (all equal)
LineLabelFilters/(?i)ïB-8                       0.00               0.00                ~     (all equal)
LineLabelFilters/(?:)foo|fatal|exception-8      0.00               0.00                ~     (all equal)
LineLabelFilters/(?i)foo|fatal|exception-8      0.00               0.00                ~     (all equal)
LineLabelFilters/(?i)f|foo|foobar-8             0.00               0.00                ~     (all equal)
LineLabelFilters/(?i)f|fatal|e.*-8              0.00               0.00                ~     (all equal)
LineLabelFilters/(?i).*foo.*-8                  0.00               0.00                ~     (all equal)
```",73,58,1,1,"2018-04-16 10:25:39","1778.32"
"grafana/loki","899e8cc95b9fbf2e76c898b9f8a7a9d5623536d4","periklis","2020-09-18 16:17:09","true","Add config options for loki dashboards (#2617)",120,29,0,1,"2018-04-16 10:25:39","882.74"
"grafana/loki","0f4a7f4d92385d88d4a1bf80423e214de8677b77","trevorwhitney","2023-04-17 22:59:32","true","[helm] Bump GEL version, default to 3 scalable targets (#9170)

**What this PR does / why we need it**:

This PR bumps the GEL version to match the Loki version that was added
in version 5 of the helm chart. With these new versions we can now
default to 3 targets in scalable mode `read`, `write`, and `backend`.

This PR also fixes 2 bugs when running in scalable mode:

* the gateway should forward requests to the admin api to the `backend`
target when running 3 targets
* the index gateway should default to using `ring` mode, which will
allow the queriers in the new `read` target to find the index gateway
address for their index gateway clients via the ring.",83,60,1,1,"2018-04-16 10:25:39","1827.77"
"grafana/loki","1df72ee2094dda66f20115cd20a0a2461f048035","thepalbi","2022-10-27 07:19:34","true","Add GCP Logs push target Promtail docs (#7511)

**What this PR does / why we need it**:
Some months ago, a new Promtail target was added to support receiving
GCP Logs in a push manner. This PR updates the setting up GCP guide, for
adding the new required push subscription.

Also, adds some notes on details of the setup procedure.

This PR will have a follow up expanding on the terraform code needed to
setup the GCP resources in a IaaC way.

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the `CONTRIBUTING.md` guide
- [x] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",88,54,1,0,"2018-04-16 10:25:39","1651.87"
"grafana/loki","97165fc0a0398d0b2a5645ef6e5c256737b9de6e","cyriltovena","2020-03-11 21:35:55","true","Use ingester client GRPC call options from config. (#1797)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",117,23,0,1,"2018-04-16 10:25:39","690.72"
"grafana/loki","364b5bc4f654230eb0640b89fba99be98184a610","cyriltovena","2019-09-11 15:47:46","false","Make Loki HTTP API more similar to Prometheus",70,17,0,1,"2018-04-16 10:25:39","510.47"
"grafana/loki","04f4f82b8e10d599bb8d66ffbb884bde903ad803","cyriltovena","2021-04-29 13:17:33","true","Adds the ability to provide a tripperware to Promtail client. (#3654)

Fixes #3608

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",178,36,0,1,"2018-04-16 10:25:39","1108.87"
"grafana/loki","4a8f62ba00bcf6d338833eb506f91789c9ed584e","cyriltovena","2021-07-13 10:50:06","true","Improve head chunk allocations when reading samples. (#3968)

* Improve head chunk allocations when reading samples.

Reading sample is the worst because we are not limited and must return all of them.
 Re-using memory will helps ingesters read path.

```
❯ benchcmp  before.txt after.txt
benchmark                                          old ns/op     new ns/op     delta
BenchmarkHeadBlockSampleIterator/Size_20000-16     2935102       1568140       -46.57%
BenchmarkHeadBlockSampleIterator/Size_10000-16     1441980       750856        -47.93%
BenchmarkHeadBlockSampleIterator/Size_8000-16      1146807       602796        -47.44%
BenchmarkHeadBlockSampleIterator/Size_5000-16      698638        370655        -46.95%

benchmark                                          old allocs     new allocs     delta
BenchmarkHeadBlockSampleIterator/Size_20000-16     32             16             -50.00%
BenchmarkHeadBlockSampleIterator/Size_10000-16     29             15             -48.28%
BenchmarkHeadBlockSampleIterator/Size_8000-16      28             15             -46.43%
BenchmarkHeadBlockSampleIterator/Size_5000-16      26             15             -42.31%

benchmark                                          old bytes     new bytes     delta
BenchmarkHeadBlockSampleIterator/Size_20000-16     2269664       484068        -78.67%
BenchmarkHeadBlockSampleIterator/Size_10000-16     1073582       984           -99.91%
BenchmarkHeadBlockSampleIterator/Size_8000-16      827825        819           -99.90%
BenchmarkHeadBlockSampleIterator/Size_5000-16      475557        786           -99.83%
```

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Improve unorderedHeadBlock too.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",106,39,0,1,"2018-04-16 10:25:39","1182.77"
"grafana/loki","82cd54722a5ad4953c8beacc5b8de1b1d23b94b7","KMiller-Grafana","2021-06-09 07:03:20","true","Docs: add and order missing design docs (#3824)",203,38,0,0,"2018-04-16 10:25:39","1148.61"
"grafana/loki","f686885eb4be4ef5a03e7a5c7c88b31ab610cbb7","rfratto","2019-11-13 00:56:49","true","docs: slightly modify language in community Loki packages section (#1248)",69,19,0,1,"2018-04-16 10:25:39","571.85"
"grafana/loki","58d2d217f50a30ed4c8c3b3ea0c13bcad4826a7b","tomwilkie","2019-02-09 14:19:04","false","Tweaks",78,10,0,0,"2018-04-16 10:25:39","293.16"
"grafana/loki","515f82ee1ed2d80e7ca17dc64a2d95ae1b98570b","MichelHollands","2021-04-20 07:52:18","true","Add interceptor override and make ingester and cfg public (#3618)

* Add interceptor override and make ingester and cfg public

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Remove extraneous comment

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",161,36,0,1,"2018-04-16 10:25:39","1099.64"
"grafana/loki","24cce4f799ec46f1e3fee4bfc7162f9687f5db09","MattiasSegerdahl","2023-05-01 08:33:50","true","Update gcplog-cloud.md (#9304)

**What this PR does / why we need it**:

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",79,60,1,0,"2018-04-16 10:25:39","1841.17"
"grafana/loki","3acaec31a69fb9358885cdc37d649bfb7e229207","owen-d","2020-09-02 17:26:55","true","fixes some doc links (#2592)

* fixes some doc links

* Update docs/sources/storage/_index.md

Co-authored-by: Diana Payton <52059945+oddlittlebird@users.noreply.github.com>

Co-authored-by: Diana Payton <52059945+oddlittlebird@users.noreply.github.com>",119,28,0,1,"2018-04-16 10:25:39","866.79"
"grafana/loki","910d604a73ae6833a78b3e40a1ea6b39b1444ea6","DylanGuedes","2021-11-05 18:23:31","true","Document duplicated protos warning occurence. (#4650)",176,43,0,1,"2018-04-16 10:25:39","1295.08"
"grafana/loki","3669770c07e7cf15bf63a29fd4b9af6f0f3a33b2","Decad","2020-09-10 12:16:19","true","Update to raw link (#2605)

Currently wget downloads the html not the raw yaml",116,29,0,0,"2018-04-16 10:25:39","874.58"
"grafana/loki","dc5cf8f57c5fb7e81c8e1251a8cad5b80469798b","cyriltovena","2020-04-29 13:31:50","true","Allow to aggregate binary operations. (#1970)

* Allow to aggregate binary operations.

For example:
	`sum by (job) (count_over_time({namespace=""tns""}[5m] |= ""level=error"") / count_over_time({namespace=""tns""}[5m]))`

would have failed previously.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add missing () rules in yacc.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",117,24,0,1,"2018-04-16 10:25:39","743.63"
"grafana/loki","62272cdaa1d2f92cdfb97eb572c70934b5d63eab","cyriltovena","2020-10-15 21:18:31","true","Fixes all lint errors. (#2768)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",115,30,0,1,"2018-04-16 10:25:39","909.95"
"grafana/loki","0d7d5b3be31c07aa038efb2a72c18db68392ff69","JordanRushing","2021-09-01 17:51:58","true","Change prefix for `runtimeconfig` metrics from `cortex_` to `loki_` (#4253)

* Change prefix for runtime config metrics from `cortex_` to `loki_`

* Revert out-of-scope metric prefix change from `loki_` to `cortex_` for `dnsProviderRegisterer`",131,40,0,0,"2018-04-16 10:25:39","1231.06"
"grafana/loki","cff8324f241cdc13318ff4b834be750a15ce05fc","dannykopping","2021-10-15 17:33:49","true","Replacing go-kit/kit/log with go-kit/log (#4484)

* Replacing go-kit/kit/log with go-kit/log

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Appeasing the f&^$ing linter

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Adding depguard

Cleaning go mod

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Updating weaveworks after https://github.com/weaveworks/common/pull/226 was merged

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Appeasing the mod checker

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",158,42,0,1,"2018-04-16 10:25:39","1275.05"
"grafana/loki","33c00ade755721020d37854d14db259422bdb5ff","bboreham","2022-03-04 13:56:56","true","regexp filter: use modified package with optimisations (#5542)

See https://github.com/grafana/regexp/tree/speedup#readme

Includes the following changes proposed upstream:
* [regexp: allow patterns with no alternates to be one-pass](https://go-review.googlesource.com/c/go/+/353711)
* [regexp: speed up onepass prefix check](https://go-review.googlesource.com/c/go/+/354909)
* [regexp: handle prefix string with fold-case](https://go-review.googlesource.com/c/go/+/358756)
* [regexp: avoid copying each instruction executed](https://go-review.googlesource.com/c/go/+/355789)
* [regexp: allow prefix string anchored at beginning](https://go-review.googlesource.com/c/go/+/377294)",297,46,0,0,"2018-04-16 10:25:39","1413.9"
"grafana/loki","675a5f35feedc3495a7c525a80c7113e3762ff8b","takanabe","2020-02-07 19:37:19","true","Convert second(Integer class) to nanosecond precision (#1656)

* Convert time(Integer) to nanosecond precision

* Bump gem version",114,22,0,0,"2018-04-16 10:25:39","656.63"
"grafana/loki","bbf4552cc4da28803bfde22f81adababc603c849","tomwilkie","2018-04-17 13:15:10","false","Wire up query path with new parsers and iterators.",0,0,0,0,"2018-04-16 10:25:39","1.12"
"grafana/loki","01f88af75d8e275664c15c3272790cc0e7418875","JStickler","2023-11-02 20:26:00","true","[Style] Update timeseries to time series. (#11125)

**What this PR does / why we need it**:
Small update to conform to recent Style decision re: spelling of `time
series`.
https://grafana.com/docs/writers-toolkit/write/style-guide/word-list/#t",14,66,1,0,"2018-04-16 10:25:39","2022.67"
"grafana/loki","7cbfdb5d6d5f6bb7fd6cc97d3f63cfb2997bfed6","sandeepsukhani","2023-07-04 07:12:46","true","cache: fix a mistake in returning cached error in the index list cache (#9853)

**What this PR does / why we need it**:
I did a mistake in returning a cached error in the code pushed in PR
#9798. Fixing it in the PR with some tests.

**Checklist**
- [x] Tests updated",60,63,1,1,"2018-04-16 10:25:39","1904.12"
"grafana/loki","068a995134ba52598478f2146e6bba5022d8af59","trevorwhitney","2023-04-17 22:28:34","true","upgrade go to 1.20 in nix flake (#9024)

**What this PR does / why we need it**:

Updates `flake.lock` to grab the latest `nixpkgs-unstable` in order to
upgrade go version to `1.20`.",83,60,1,1,"2018-04-16 10:25:39","1827.75"
"grafana/loki","8eac851962a23d39c33339146e204d257174463c","jeschkies","2023-03-10 19:39:39","true","Remove print statements introduced by #8727. (#8775)",87,59,1,1,"2018-04-16 10:25:39","1785.38"
"grafana/loki","0dfd2cbbcc15d888466b520ee9345be9b7c8ee8a","ssncferreira","2022-05-24 12:43:31","true","Fix label extraction pushdown on instant queries (#6215)

* Add downstream label extraction tests

* Fix label extraction downstream pushdown",73,49,0,0,"2018-04-16 10:25:39","1499.1"
"grafana/loki","f4bdf5db4e31929f5816ad8e69eafd0b164e0f0c","cyriltovena","2021-06-03 09:17:02","true","Update README.md (#3503)

* Update README.md

Add oss-fuzz badge.

* Update README.md",207,38,0,1,"2018-04-16 10:25:39","1142.7"
"grafana/loki","0d66319a1fce61d6c7a08a63198bd076d24d7554","DylanGuedes","2021-11-03 19:42:53","true","Revert distributor defaulting to inmemory. (#4638)

- [PR 4440](https://github.com/grafana/loki/pull/4440/files) modified
  the distributor setup to use inmemory by default (instead of consul).
That was necessary because, by changing the default rate limiting to
global, a ring was necessary, and since by default the ring was set to
consul, the project couldn't run with the default configs. That's not
the case anymore: right now we are reusing the same config set for the
ingester (which users already have properly configured otherwise they
wouldn't be able to run the project). List of changes:
  - Remove changelog entries
  - Remove upgrading guide entries
  - Remove added tests (unnecessary checks)
  - Remove value overriding",170,42,0,1,"2018-04-16 10:25:39","1293.14"
"grafana/loki","80e938c4129aa86def24a656f5a98cf30e71c09f","owen-d","2020-02-05 19:26:26","true","adds query stats and org id options in logcli (#1638)",110,22,0,1,"2018-04-16 10:25:39","654.63"
"grafana/loki","f1d431778bb7d6385a9c0a9c808c0ed31d045b80","sandeepsukhani","2020-01-13 13:49:48","false","fix sample yaml in docs for installing promtail to k8s (#1505)",99,21,0,1,"2018-04-16 10:25:39","632.39"
"grafana/loki","dc5d458c14a16e8ef57343e6a7219eb1fc41c27f","DylanGuedes","2023-06-27 23:09:36","true","Failures logging: avoid logging generic errors (#9796)

**What this PR does / why we need it**:
Modify our write path to not log generic messages with the
`writefailures.Manager`. With generic messages I mean: contextCancel
errors and contextDeadlineExceeded errors.

**Which issue(s) this PR fixes**:
N/A",62,62,1,1,"2018-04-16 10:25:39","1897.78"
"grafana/loki","f1114fd2219ca660b1b55c5efd4f599ff301ba12","owen-d","2022-09-16 13:15:17","true","[Bugfix] TSDB index bucket calculation (#7178)

When calculating the index buckets a chunk belongs to, we shouldn't
error when a bucket falls outside the current TSDB store's periodConfig
range. This can happen when a chunk is written across the bounds between
a previous index type (i.e. boltdb-shipper) and a new tsdb type or vice
versa. Instead of erroring when this happens, we'll now correctly return
only the buckets matching the TSDB store (the other buckets are handled
by their respective stores).

I think we can also remove the error from this function signature,
although I left it in as it's conceivably helpful in the case of a chunk
range that doesn't overlap at all with the store (which shouldn't
happen).


Dependent on https://github.com/grafana/loki/pull/7177",88,53,1,1,"2018-04-16 10:25:39","1611.12"
"grafana/loki","ce3b1e454d5b9ea71665d7fba25281d49e2a253f","sandeepsukhani","2019-08-28 14:46:46","false","added a variable for storing periodic table duration as an int to be able to reuse it",119,16,0,1,"2018-04-16 10:25:39","497.43"
"grafana/loki","ff21fb063fc0c620b324d90ccb48d871621b5421","sandeepsukhani","2022-02-21 07:41:46","true","jsonnet: move boltdb-shipper configs set as compactor args to yaml config (#5393)

* move boltdb-shipper configs set as compactor args to yaml config

* update changelog

* update upgrade guide",297,46,0,1,"2018-04-16 10:25:39","1400.64"
"grafana/loki","faff8b663212869c9cef4be9ce6e029fbed765b1","sandeepsukhani","2021-02-26 16:16:01","true","Boltdb shipper doc fixes (#3265)

* Remove incorrect value for boltdb_shipper.resync_interval in example doc which anyways has a default value of 5m

* Update incorrect default value for resync_interval mentioned in docs

* Add boltdb shipper configuration in config reference file",133,34,0,1,"2018-04-16 10:25:39","1040.74"
"grafana/loki","b26b73d5bebb555b381236cba744f897d93104e4","RangerCD","2022-01-20 18:25:15","true","Remove instance level streams lock (#5179)

* Feat(ingester): remove instance level streams lock

* Fix lint

* Solve Load and Delete consistency problem while pushing to ingester",268,45,0,0,"2018-04-16 10:25:39","1370.08"
"grafana/loki","4d1da2edf3b243ac1bb8348b2dbb7c17219eb6eb","cyriltovena","2021-04-01 08:15:11","true","first_over_time and last_over_time (#3050)

* Wip

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* [POC] last_over_time and first_over_time.

This is an attempt to allow users to select the first or last discrete sample values from a range vector.
This way we can create gauge, the only drawback being the log need to exists at least in every range.

May be we could transfer the last or first  value to the next range, but it will still be a problem for small ranges.

Still wondering how useful this is compare to min/max_over_time.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",145,35,0,1,"2018-04-16 10:25:39","1075.41"
"grafana/loki","979530b6b94b489980b58ec2ee9cd46232149488","jeschkies","2023-11-08 18:44:45","true","Propagate query metrics and cache num information. (#11176)

**What this PR does / why we need it**:
https://github.com/grafana/loki/pull/10858 removed the extraction of the
query time header on the querier side and the generation of the cache
number. This change adds them back and uses the headers of the response
format.

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)
- [ ] If the change is deprecating or removing a configuration option,
update the `deprecated-config.yaml` and `deleted-config.yaml` files
respectively in the `tools/deprecated-config-checker` directory.
[Example
PR](https://github.com/grafana/loki/pull/10840/commits/0d4416a4b03739583349934b96f272fb4f685d15)

---------

Signed-off-by: Edward Welch <edward.welch@grafana.com>
Co-authored-by: Edward Welch <edward.welch@grafana.com>",1,67,1,1,"2018-04-16 10:25:39","2028.6"
"grafana/loki","595cb7d3a65a2e2319c7e846ed719e8e5140de52","ronensc","2022-01-05 08:38:32","true","Fix typo 'Registring'->'Registering' (#4979)",252,45,0,0,"2018-04-16 10:25:39","1354.68"
"grafana/loki","c80244a3e42ff99566d4f41e7c7526fee6c6f270","SasSwart","2022-02-22 06:34:53","true","Parse duration expressions in accordance with promql (#5275)

* Add support for Prometheus like duration units in logql

* Remove redundant type conversion

* deduplicate call to sb.String

Add a comment to explain why both promql and time's ParseDuration methods are used

* extract duration parsing to separate function.

* Add tests to ensure promql duration units are supported

* Sort duration rune comment and list of runes in ascending order of length.",298,46,0,0,"2018-04-16 10:25:39","1401.59"
"grafana/loki","87c2afceff4c63f0591aef9c141a37a48cb2c92d","rsteneteg","2020-02-03 16:41:22","true","added ability to configure kernel setting fs.inotify.max_user_instances through init container to resolve issue with too many open files (#1620)

Signed-off-by: Roger Steneteg <rsteneteg@ea.com>",107,21,0,0,"2018-04-16 10:25:39","652.51"
"grafana/loki","381735d3d40a50822a0451552b8e4d39051296a4","quodlibetor","2022-10-11 07:26:58","true","logging: Change Docker target discovery log level from Error to Info (#7312)

**What this PR does / why we need it**:

Discovering a new node is not an error, so having it send errors to
dashboards is confusing.

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the `CONTRIBUTING.md` guide
- [x] Documentation added
- [ ] Tests updated
- [x] `CHANGELOG.md` updated
- [x] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",93,54,1,0,"2018-04-16 10:25:39","1635.88"
"grafana/loki","23ad7f2e6178708523093d0c8293c5a7335dc5cb","owen-d","2021-07-08 17:42:44","true","Unordered head block (#3957)

* speccing out unordered head block

* testware & unordered serialise

* common utils for iter & sampleIter

* more generic forEntries

* more efficient unordedHeadChunk serialise (no internal re-casting)

* roundtripping unordered head block, exit headchunk iteration early, add constant for current default chunk version

* adds head block write benchmarks for ordered & unordered writes

* fixes bench

* removes unused initializer

* gofmt

* linting",118,39,0,1,"2018-04-16 10:25:39","1178.05"
"grafana/loki","f470943433baec3f02c1ddd70d1fcba5f33f0f8d","owen-d","2022-08-16 10:38:39","true","reintroduces now deprecated+noop deletion configs for compatibility (#6917)

* reintroduces now deprecated+noop deletion configs for compatibility
Signed-off-by: Owen Diehl <ow.diehl@gmail.com>

* better deprecation logging
Signed-off-by: Owen Diehl <ow.diehl@gmail.com>

* fixes import
Signed-off-by: Owen Diehl <ow.diehl@gmail.com>",83,52,0,1,"2018-04-16 10:25:39","1581.01"
"grafana/loki","2efd059b495088f61778d534fa4cb9a35513afb1","owen-d","2023-05-17 17:46:59","true","Slight improvements to `GetFactorOfTime` (#9473)

* correctly returns zero for non-overlapping data
* adds tests",71,61,1,1,"2018-04-16 10:25:39","1857.56"
"grafana/loki","233997ef208c6d4dd6b804a4bf1d66abd6af89d2","Red-GV","2023-02-23 06:07:10","true","operator: Store gateway tenant information in secret instead of configmap (#8577)",65,58,1,1,"2018-04-16 10:25:39","1767.82"
"grafana/loki","6dd2e9ef3456a1ba26a1b44dfa96b21069bbeeef","sandeepsukhani","2020-09-04 07:12:04","true","Read, Write and operational dashboard improvements (#2584)

1. Add bigtable, boltdb-shipper to read/write dashboards.
2. Add boltdb-shipper to operational dashboard.
3. Record latency for write operation in boltdb-shipper.",118,29,0,1,"2018-04-16 10:25:39","868.37"
"grafana/loki","7418d42141a0aab6d877209482fe97c3da36e41e","slim-bean","2020-08-10 20:03:40","true","Promtail: force the log level on any Loki Push API target servers to match Promtail's log level. (#2475)

* force the log level on any Loki Push API target servers to match Promtail's log level.

* also include logformat",120,28,0,1,"2018-04-16 10:25:39","844.9"
"grafana/loki","6c8fdd68aa9812a8d31b41cdadbe52334e0814f3","gregorybrzeski","2021-02-09 13:31:00","true","fix typo in config variable name: BookmarkPath (#3298)",125,34,0,0,"2018-04-16 10:25:39","1023.63"
"grafana/loki","0a68bd2d4e440ea1300bb3347e9a3e6c15069cb9","gabor","2022-05-04 15:18:31","true","docs: update the labels timespan info (#6019)

* docs: update the labels timespan info

* updated docs

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* updated docs

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>",75,49,0,0,"2018-04-16 10:25:39","1479.2"
"grafana/loki","0bf7b608d4586aded81d9035f443b047b905c456","dannykopping","2021-06-03 15:05:31","true","Exposing remote writer for use in integration tests (#3797)

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",209,38,0,1,"2018-04-16 10:25:39","1142.94"
"grafana/loki","50ff10dfff98d07c27b8a04a566208b4bb08482e","slim-bean","2019-05-14 15:18:08","true","Add LICENSE",100,13,0,1,"2018-04-16 10:25:39","393.45"
"grafana/loki","f359a8280fca446af575c3ff790e71e6ace31978","HolgerHees","2022-03-03 06:37:10","true","Update out_loki.rb (#5512)

this will fix ""UndefinedConversionError error=""\""\\xC2\"" from ASCII-8BIT to UTF-8"""" for messages of systemd journal",297,46,0,0,"2018-04-16 10:25:39","1412.59"
"grafana/loki","4f27c758df4f219a389d1b2d6d83dc273cd59101","caleb15","2021-03-08 13:43:13","true","add note about regex (#3437)

to prevent people from running into https://github.com/grafana/loki/issues/3436",144,35,0,0,"2018-04-16 10:25:39","1052.64"
"grafana/loki","4d489729394ec77fdde3fd2ca2170e06a9c25313","cyriltovena","2019-06-18 01:32:11","false","Query storage by iterating through chunks by batches.
Also adds more tests for the store",83,14,0,1,"2018-04-16 10:25:39","426.88"
"grafana/loki","ab2bc8766a422b939fc8e26cfcf390feac70e461","cyriltovena","2019-05-31 16:43:32","false","fix flaky timestamp test",109,13,0,1,"2018-04-16 10:25:39","410.51"
"grafana/loki","1cc25f8db6d3076c185d421b994920292bcfd29c","prometherion","2019-07-09 12:41:45","false","Typo on values.yaml (#728)",100,15,0,0,"2018-04-16 10:25:39","448.34"
"grafana/loki","6347faf8761538be946f751da604fc20fc91d9c2","cstyan","2021-12-02 09:31:48","true","fixes for operational and promtail dashboard (#4856)

* Fix missing log datasource selector in operational dashboard plus broken
label selectors in every query in promtail dashboard.

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* Add a uuid to the promtail dashboard.

Signed-off-by: Callum Styan <callumstyan@gmail.com>",212,43,0,1,"2018-04-16 10:25:39","1321.71"
"grafana/loki","05bb3cec4c397181eeecc618c3419220757034f2","cstyan","2021-09-28 20:05:47","true","Rewrite lambda-promtail to use subscription filters. (#4315)

* Rewrite lambda-promtail to use subscription filters.

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* Update lambda library vendoring.

* Fix small terraform comments.

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* Allow for lambda-promtail binary to pull basic auth credentials via env
vars.

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* remove mistakenly committed binary and zip

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* Update terraform to allow passing of variousn configuration values, like
the write endpoint and log groups to subscribe to.

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* Update cloudformation template to also use parameters/env vars.

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* don't show password in template parameters + include examples of deploy
commands in readme

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* We can use terraform vars, with empty defaults, to allow for specifying
VPC config for promtail-lambda deployment.

Signed-off-by: Callum Styan <callumstyan@gmail.com>",141,41,0,1,"2018-04-16 10:25:39","1258.15"
"grafana/loki","de040ca04083d165422088354e10e8d8f8bf2a16","sh0rez","2019-10-17 14:31:47","false","feat(cli): order flags by categories (#1168)

We have many flags of the form `<category>.<name>`. This change orders them
groups flags by category.

All flags with no categories and all categories with a single flag only won't be
grouped and will be printed at the top",66,18,0,0,"2018-04-16 10:25:39","546.42"
"grafana/loki","2e21896aa5068f1927cf704096c4b0e3585b6c2d","btaani","2022-08-19 06:39:17","true","Change Loki Operator namespace to openshift-logging in the CSV (#6935)",83,52,0,0,"2018-04-16 10:25:39","1583.84"
"grafana/loki","60ea954f5df20978b9724ca6180d7986276c1caa","poyzannur","2023-10-24 16:41:48","true","Fix ring start up errors (#11015)

**What this PR does / why we need it**:
The errors below were introduced during adding initial service structure
for BloomGateway https://github.com/grafana/loki/pull/10782 and
BloomCompactor https://github.com/grafana/loki/pull/10748 components.

```
docker-loki-read-3      | panic: runtime error: invalid memory address or nil pointer dereference
docker-loki-read-3      | [signal SIGSEGV: segmentation violation code=0x1 addr=0x0 pc=0x9e6d90]
docker-loki-read-3      |
docker-loki-read-3      | goroutine 1 [running]:
docker-loki-read-3      | github.com/grafana/dskit/kv.createClient({_, _}, {_, _}, {{{0x22f6128, 0xe}, {{0x0, 0x0}}, 0x4a817c800, 0x0, ...}, ...}, ...)
docker-loki-read-3      |       /src/loki/vendor/github.com/grafana/dskit/kv/client.go:158 +0x360
docker-loki-read-3      | github.com/grafana/dskit/kv.NewClient({{0x22ec444, 0xa}, {0x22ee95d, 0xb}, {{{0x22f6128, 0xe}, {{...}}, 0x4a817c800, 0x0, 0x3ff0000000000000, ...}, ...}, ...}, ...)
```

This PR initialies new components as part of MemberlistKV.


**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:
Tested on local via docker workflow

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)
- [ ] If the change is deprecating or removing a configuration option,
update the `deprecated-config.yaml` and `deleted-config.yaml` files
respectively in the `tools/deprecated-config-checker` directory. <!--
TODO(salvacorts): Add example PR -->",20,66,1,0,"2018-04-16 10:25:39","2014.51"
"grafana/loki","b8d260edc04687b4e1f61e34a6efc5313e5ca43f","dannykopping","2022-07-20 08:18:02","true","Reinclude .git dir in docker builds (#6723)

This was removed in #6691, but caused errors in docker builds

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",71,51,0,1,"2018-04-16 10:25:39","1554.91"
"grafana/loki","f3d37e339c79a09d0b7bd5417543526022e12ebe","nicknezis","2019-03-18 18:39:24","false","More updates to make `dataRoot` more generic",102,11,0,0,"2018-04-16 10:25:39","332.34"
"grafana/loki","3f93b5bd28f64c5257153b089d465d1f2ac09484","cyriltovena","2020-10-23 18:49:00","true","Fixes a bug that would add __error__ labels incorrectly. (#2796)

Wrong usage of slices would add error label to the original set of labels.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",116,30,0,1,"2018-04-16 10:25:39","917.85"
"grafana/loki","03d4238700bafa548c1b9d8d6a4b3707a3d8b754","KMiller-Grafana","2022-04-15 17:04:58","true","Fix SSD Docker installation (#5916)

* Fix SSD Docker installation

* Clarify endpoints and ports",320,48,0,0,"2018-04-16 10:25:39","1455.03"
"grafana/loki","0e519b46e00d15933c680c5e357d1b3469536d26","KMiller-Grafana","2021-07-22 08:00:37","true","Docs: correct fluentbit config value for DqueSync (#4026)",98,39,0,0,"2018-04-16 10:25:39","1191.65"
"grafana/loki","712bfdd0e0921bae9b007ebd88f47714ddee2d01","trevorwhitney","2023-01-11 22:43:02","true","[helm] add third scalable target `backend` (#7920)

**What this PR does / why we need it**:

Adds the new 3rd scalable deployment mode target (backend) to the helm
chart. This new target was added in #7650",99,57,1,1,"2018-04-16 10:25:39","1726.51"
"grafana/loki","f17d3d768cb915b656af20a2ef7973efae335d51","DylanGuedes","2022-07-07 13:57:32","true","Promtail: Add text encoding conversion to file targets (#6395)

Adds support for text encoding conversion for file targets. To use it, add `encoding: <encoding_name>` into the scrapeconfig.",72,51,0,1,"2018-04-16 10:25:39","1542.15"
"grafana/loki","35c79e4a09cd1695d323d1869019fee1faf94a3a","chaudum","2023-04-04 06:49:52","true","Trigger `deploy` CI step only on push to main or tag of new release (#8991)

**What this PR does / why we need it**:

Right now, backporting to a kXXX branch causes a trigger of the `deploy` pipeline, which overrides already deployed newer releases.

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",80,59,1,1,"2018-04-16 10:25:39","1808.85"
"grafana/loki","a4d06acca70e13da780abec76941636990706805","trevorwhitney","2023-03-17 07:11:46","true","Add yaml linting step to helm ci (#8822)

**What this PR does / why we need it**:

Adds a yaml linting step for the included rules in the loki helm chart.
Only way I could think to enforce the comma line ending was to require
qutoes around string, otherwise the linter cannot tell if the comma is
just part of the string.",85,59,1,1,"2018-04-16 10:25:39","1791.87"
"grafana/loki","2597429c893cb470aca86d6f30854d6cfbf20e67","kavirajk","2023-01-16 13:48:39","true","promtail: Add `max-line-size` limit to drop on client side  (#8153)",94,57,1,1,"2018-04-16 10:25:39","1731.14"
"grafana/loki","c474f265a7a36fc65270e4c28c447ebe6be440a7","Tolsto","2023-01-11 13:20:13","true","Add config for optional pod labels (#7594)",101,57,1,0,"2018-04-16 10:25:39","1726.12"
"grafana/loki","39f285616c1f76ed1e31d9b081e956cc44e827a9","periklis","2023-01-10 08:42:57","true","Add loki-operator multi-arch image manifest (#8073)",99,57,1,1,"2018-04-16 10:25:39","1724.93"
"grafana/loki","a6101f47ac8550324342de2469de92d9c2b9fda8","trevorwhitney","2022-09-14 22:49:45","true","Update GEL helm deployment example (#7144)

**What this PR does / why we need it**:

This update the example for deploying a GEL cluster using the new helm
chart. The previous example was a bit out of date.",87,53,1,1,"2018-04-16 10:25:39","1609.52"
"grafana/loki","7378b697f8dc05762e45d4a243005dad27d93d35","MasslessParticle","2022-02-15 14:59:54","true","Fix Azure issue where 404 not recognized (#5399)",288,46,0,1,"2018-04-16 10:25:39","1394.94"
"grafana/loki","79b95d976a0dc416f67163fbf107f990ddddd998","aknuds1","2021-09-21 13:18:27","true","Chore: Use dskit/limiter (#4327)

Signed-off-by: Arve Knudsen <arve.knudsen@gmail.com>",136,41,0,0,"2018-04-16 10:25:39","1250.87"
"grafana/loki","36164bbe1a5878bdebb59634a692a844d7273c17","slim-bean","2020-08-07 00:57:04","true","Promtail: use --client.external-labels for all clients (#2474)

* --client.external-labels command line argument will now apply the labels to all clients configured in the clients config section of the config file.

* do better Ed",124,28,0,1,"2018-04-16 10:25:39","841.11"
"grafana/loki","4ef52f29c1a8ac78363e33c18576e1317325f2ef","owen-d","2020-07-02 12:41:17","true","Update local.md (#2284)

Fixes image referenced in docs.

Closes https://github.com/grafana/loki/issues/2276",131,27,0,1,"2018-04-16 10:25:39","806.59"
"grafana/loki","0fac61801c27cb91ee84d10ddee165688a5cc39d","slim-bean","2019-04-29 21:12:10","false","adding regex pipeline stage",97,12,0,1,"2018-04-16 10:25:39","378.7"
"grafana/loki","6b74422150fdb36185a25fd53e52a46995ea2546","toshipp","2022-04-07 13:29:55","true","Promtail docs: fix metrics stage. (#5740)

Signed-off-by: Toshikuni Fukaya <toshikuni-fukaya@cybozu.co.jp>",320,48,0,0,"2018-04-16 10:25:39","1446.88"
"grafana/loki","4b1a09e91e9ba03bf181eb4f93d79c2550eec42e","dannykopping","2021-11-29 13:56:38","true","Set alert to fire after 15m, to match message (#4839)

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",214,43,0,1,"2018-04-16 10:25:39","1318.9"
"grafana/loki","0a79e2a96ef2c91e055ae9277d59ef6f32a53739","pracucci","2019-07-11 19:04:11","false","Converted source in regex and josn stages to string pointer",101,15,0,0,"2018-04-16 10:25:39","450.61"
"grafana/loki","ae4cd27d8396b2e45653300c0b9a2f1600d85dcc","trevorwhitney","2023-07-19 22:47:41","true","add sharded to querystats bytes processed (#9934)

Add a sharded label to the
`loki_logql_querystats_bytes_processed_per_second` metric that we use
for determining our `LokiQueryRangeReadPerformanceBudgetBurn` metric so
we can exclude slow queries with <= 1 shard from burning our SLO budget.",58,63,1,1,"2018-04-16 10:25:39","1919.77"
"grafana/loki","8f9c065fa21013dc1df3b640ff9e6cb6c3e31324","wardbekker","2020-04-13 13:29:44","true","Clarified that the api push path needs to be specified. (#1925)

clarified the api push path needs to be specified. Otherwise folks see this message:

level=error ts=2020-04-09T15:08:53.408999Z caller=client.go:247 component=client host=example.com:3100 msg=""final error sending batch"" status=404 error=""server returned HTTP status 404 Not Found (404): 404 page not found""",123,24,0,0,"2018-04-16 10:25:39","722.38"
"grafana/loki","8f6a75cd0de57eb0fd9f329a93d8e13f68f56851","sandeepsukhani","2022-04-19 13:10:07","true","fix index gateway chunk refs response (#5957)",173,48,0,1,"2018-04-16 10:25:39","1464.11"
"grafana/loki","8ddcc884fe710c72babbb3cebc7746c629675aec","sandeepsukhani","2021-11-18 17:22:24","true","add logging in querier when live tailing request starts and ends (#4783)

* add logging in querier when live tailing request starts and ends

* Suggested changes

Co-authored-by: Danny Kopping <dannykopping@gmail.com>

* Update pkg/querier/http.go

Co-authored-by: Susana Ferreira <ssncferreira@gmail.com>

Co-authored-by: Danny Kopping <dannykopping@gmail.com>
Co-authored-by: Susana Ferreira <ssncferreira@gmail.com>",204,43,0,1,"2018-04-16 10:25:39","1308.04"
"grafana/loki","7e3dbd4907ebd4e298a01cd16eb15e713b1a8d7c","DylanGuedes","2023-02-07 21:50:20","true","Improve installation instructions (#8454)

What this PR does / why we need it:
Improve Helm installation instructions and add a note on how to use MinIO.

Which issue(s) this PR fixes:
Fixes #8440",79,58,1,1,"2018-04-16 10:25:39","1752.48"
"grafana/loki","3941767c6fba6b090c3ff6c23160d835c63e297b","DylanGuedes","2023-05-30 19:47:12","true","Loki: Introduce new `limited_log_push_errors`. (#9568)

**What this PR does / why we need it**:
Introduce a new configuration named `limited_log_push_errors` that will
be implemented.
The configuration is being introduced on a separated PR to facilitate
future rollbacks.

**Which issue(s) this PR fixes**:
N/A",68,61,1,1,"2018-04-16 10:25:39","1870.64"
"grafana/loki","f5a20e4e96d1428bd422772aba9f9499979c9e5d","DylanGuedes","2023-05-04 21:59:56","true","Avoid excessive gRPC logging (#9401)

**What this PR does / why we need it**:
Change the default value of `DisableRequestSuccessLog` to true. This way
Loki won't log every successful gRPC call by default. The log line isn't
useful either since it is redundant with existing gRPC metrics.

**Which issue(s) this PR fixes**:
N/A",80,61,1,1,"2018-04-16 10:25:39","1844.73"
"grafana/loki","9f06bc008329a80c59064157678341ba8300f161","kavirajk","2022-08-01 14:52:47","true","chore(groupcache): Groupcache doesn't need global server handler anymore (#6820)

Remove it from the constructor

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",77,51,0,1,"2018-04-16 10:25:39","1566.19"
"grafana/loki","b52d836867d3e26d9dcd864ba652d23ce82a97b6","owen-d","2023-10-13 16:05:21","true","Blooms/chunk check (#10886)

[WIP]

Adds ability to return the list of chunks needed to be downloaded by a
query based on bloom membership results",25,66,1,1,"2018-04-16 10:25:39","2003.49"
"grafana/loki","7a1fcab465b9f4252e5eff2a93a3076d4765652a","RutgerKe","2023-01-12 21:45:19","true","Promtail: Improve LabelsMap CPU performance (#7882)

**What this PR does / why we need it**:

The labelsMapToString function takes a relative high amount of CPU in a
simple promtail pipeline. By replacing the fmt.Sprintf with a string.
Builder we achieve a 50+% improvement in the function. In my local
promtail installation I get about a 10% global cpu reduction.

```
name                 old time/op    new time/op    delta
LabelsMapToString-8    1.10µs ± 3%    0.30µs ± 4%  -72.40%  (p=0.008 n=5+5)

name                 old alloc/op   new alloc/op   delta
LabelsMapToString-8      344B ± 0%      184B ± 0%  -46.51%  (p=0.008 n=5+5)

name                 old allocs/op  new allocs/op  delta
LabelsMapToString-8      14.0 ± 0%       6.0 ± 0%  -57.14%  (p=0.008 n=5+5)
```

**Special notes for your reviewer**:
The code does get more complex, and this might be a trade-off.
Considering promtail is running on many machines (ie. kubernetes nodes)
I think the gain is worth it.

Two alternatives:
- Only replace the `lstrs = append(lstrs, fmt.Sprintf(""%s=%q"", l, v))`
call, as it takes most of the time
- Get rid of the explicit `b.Grow` calls and the tracking of size. This
only adds a slight improvement

**Checklist**
- [x] Reviewed the `CONTRIBUTING.md` guide
- [ ] Documentation added
- [x] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>",100,57,1,0,"2018-04-16 10:25:39","1727.47"
"grafana/loki","63281468765b56c4581cec4fc9cbb384f39b68fe","cyriltovena","2020-02-26 17:30:46","true","Fixes querier cancellation error to return 499 instead of 500. (#1745)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",117,22,0,1,"2018-04-16 10:25:39","675.55"
"grafana/loki","53f4aa4ac38ca30f6f01337a91e4d7cfa5708d26","cyriltovena","2020-11-05 14:34:17","true","Labels computation LogQLv2 (#2875)

* Adding a benchmark to compare before and after.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Improves labels management in logql v2.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Cache grouped result when no changes has occured.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Removes unused methods.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Adds docs and tests.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Uncomment tests.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",131,31,0,1,"2018-04-16 10:25:39","929.67"
"grafana/loki","490c19e38c2e78eee8a73541ab4670ed28fb3945","cyriltovena","2021-05-03 12:09:20","true","Deprecate max_look_back_period in the chunk storage. (#3677)

* Deprecate max_look_back_period in the chunk storage.

From now on it will be applied at the frontend, ruler and querier level.

The querier validation was missing so I added it.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Lint

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",181,37,0,1,"2018-04-16 10:25:39","1112.82"
"grafana/loki","f8dcf47ad36a6f98b41793f404042b14446ecf81","cyriltovena","2021-06-15 07:28:50","true","Fixes Loki reads dashboard. (#3854)

Recently realized the latency for ingester isn't working.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",118,38,0,1,"2018-04-16 10:25:39","1154.63"
"grafana/loki","7343ebf27867d73b1bc9f6030a4d405b44d457f9","oddlittlebird","2019-09-10 17:43:21","false","Update README.md

Fixed two broken links",101,17,0,0,"2018-04-16 10:25:39","509.55"
"grafana/loki","8d9f162460f307d25fb4305eeccdcb0f24fbcbbb","hervenicol","2022-09-27 20:21:43","false","CONTRIBUTING: fix layout",90,53,1,0,"2018-04-16 10:25:39","1622.41"
"grafana/loki","59bb6d3fbab553f72f8f16ed9e6769730bbe561a","cyriltovena","2021-06-15 07:45:02","true","LogQL: Pattern Parser (#3837)

* The beginning of a fun story.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Working on adding ragel.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Adding AST parsing with Yacc and Ragel.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Got a pattern parser working.

Reworking ast to works with bytes and not runes.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Setup tests and the matches algorithm.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* moar tests case.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add some validation for the pattern expression.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Hooking to LogQL + performance boost.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Adds documentation

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Improve bound check.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Removes generated files from being linted.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Update docs/sources/logql/_index.md

Co-authored-by: Danny Kopping <dannykopping@gmail.com>

* Update docs/sources/logql/_index.md

Co-authored-by: Danny Kopping <dannykopping@gmail.com>

* Review feedback

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Update docs/sources/logql/_index.md

Co-authored-by: Danny Kopping <dannykopping@gmail.com>

* Update docs/sources/logql/_index.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* Update docs/sources/logql/_index.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* Update docs/sources/logql/_index.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* Update docs/sources/logql/_index.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* Update docs/sources/logql/_index.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* Update docs/sources/logql/_index.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* Update docs/sources/logql/_index.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* Update docs/sources/logql/_index.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* Update docs/sources/logql/_index.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* Update docs/sources/logql/_index.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* Docs suggestions

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

Co-authored-by: Danny Kopping <dannykopping@gmail.com>
Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>",118,38,0,1,"2018-04-16 10:25:39","1154.64"
"grafana/loki","6e79cee85d8d5b62e524f08ae54a7d0f2f55a10b","cyriltovena","2020-11-11 08:44:27","true","Fixes race condition in tailer since logql v2. (#2917)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",126,31,0,1,"2018-04-16 10:25:39","935.43"
"grafana/loki","d438bda94a51536e55d7995d8452a8ec43622d55","cyriltovena","2019-10-29 12:01:19","true","Update cortex to bring v11 schema (#1201)

* Update cortex to bring v11 schema

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes change in ParseProtoReader

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* sync go mod

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",70,18,0,1,"2018-04-16 10:25:39","558.32"
"grafana/loki","83081653d1af45bdc10efdbc3a74d35549f306f1","salvacorts","2022-08-19 14:42:57","true","Add operational guide for autoscaling (#6801)

* Add operational guide for autoscaling

* Add promql tags to code snippets

* Apply feedback from Karen

* Update docs/sources/operations/autoscaling_queriers.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* Update docs/sources/operations/autoscaling_queriers.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* Update docs/sources/operations/autoscaling_queriers.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* Update docs/sources/operations/autoscaling_queriers.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* Update docs/sources/operations/autoscaling_queriers.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* Update docs/sources/operations/autoscaling_queriers.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* Update docs/sources/operations/autoscaling_queriers.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* CR feedback

* Add note about needing to use the query-scheduler.

* Update docs/sources/operations/autoscaling_queriers.md

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Update docs/sources/operations/autoscaling_queriers.md

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Update docs/sources/operations/autoscaling_queriers.md

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Update docs/sources/operations/autoscaling_queriers.md

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Update docs/sources/operations/autoscaling_queriers.md

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Update docs/sources/operations/autoscaling_queriers.md

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Update docs/sources/operations/autoscaling_queriers.md

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Update docs/sources/operations/autoscaling_queriers.md

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Update docs/sources/operations/autoscaling_queriers.md

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Update docs/sources/operations/autoscaling_queriers.md

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Update docs/sources/operations/autoscaling_queriers.md

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Update docs/sources/operations/autoscaling_queriers.md

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Update docs/sources/operations/autoscaling_queriers.md

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Update docs/sources/operations/autoscaling_queriers.md

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* CR changes

* Apply suggestions from code review

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Update docs/sources/operations/autoscaling_queriers.md

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* CR feedback

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>
Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>",82,52,0,1,"2018-04-16 10:25:39","1584.18"
"grafana/loki","80a4261b467c6e1feefcd00da7bdd69e56d3a026","cyriltovena","2019-10-02 16:17:57","true","Add fluent-bit missing link in the main documentation page. (#1106)",77,17,0,1,"2018-04-16 10:25:39","531.49"
"grafana/loki","6848ea37dd78000907233d73a920d7cd3cb7ea07","liguozhong","2022-11-08 09:36:40","true","fix ingester: grpc method=/logproto.Querier/Query fail. (#5970)

When ingester's ctx times out, don't try to use grpc to return data to
the querier again.
This PR fixes the ingester error rate > 0 for our loki cluster.
We rely on this error rate indicator for alarming

Fixes #5964",89,55,1,1,"2018-04-16 10:25:39","1662.97"
"grafana/loki","569de47d7633a81b7bac67dcadfa04b47ddc25ec","jeschkies","2023-08-31 12:46:46","true","Remove anonymous step evaluator and add `explain`. (#10400)",46,64,1,1,"2018-04-16 10:25:39","1961.35"
"grafana/loki","e4b99f2729baba8479548429d187e16e96dc27fa","sh0rez","2019-08-12 20:04:43","true","chore(packaging): wrong executable format (#886)

Due to an invalid usage of bash, the binary was always built for amd64.
This fixes that and builds the correct one.",104,16,0,0,"2018-04-16 10:25:39","481.65"
"grafana/loki","6a9557a1e005eb346376170a2596950f2a10c188","julienduchesne","2022-06-27 13:53:18","true","Add Drone pipeline to test packaging (#6482)

* Add Drone pipeline to test packaging
Currently, the packaging process only happens on tags, which could lead to surprises
Especially considering I'm working on deb and RPM packaging (lots more steps than now)

I also moved the publishing from Circle to Drone because:
1. I'll need some new secrets from Vault
2. It should be faster

* Fix make target

* Remove `-parallel` arg for `gox`",72,50,0,0,"2018-04-16 10:25:39","1532.14"
"grafana/loki","df9c6fcac4177788749eaa74cb5890bfa060cf13","poyzannur","2023-11-01 15:47:36","true","Add series population to tokenizer (#11070)

**What this PR does / why we need it**:
I started to use tokenizer module for bloom creation and populating the
SBF without the series with chunk ref is weird, as we populate only half
of a data structure.
I modified it to populate entire `SeriesWithBloom` as it has all the
information.

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)
- [ ] If the change is deprecating or removing a configuration option,
update the `deprecated-config.yaml` and `deleted-config.yaml` files
respectively in the `tools/deprecated-config-checker` directory. <!--
TODO(salvacorts): Add example PR -->

---------

Co-authored-by: Paul Rogers <paul.rogers@grafana.com>",15,66,1,0,"2018-04-16 10:25:39","2021.47"
"grafana/loki","9159c1dac3ad1e80b9ebf0fe256dbe6dc0b8e903","DylanGuedes","2023-03-31 11:04:07","true","Loki: Improve spans usage (#8927)

**What this PR does / why we need it**:
- At different places, inherit the span/spanlogger from the given
context instead of instantiating a new one from scratch, which fix spans
being orphaned on a read/write operation.
- At different places, turn spans into events. Events are lighter than
spans and by having fewer spans in the trace, trace visualization will
be cleaner without losing any details.
- Adds new spans/events to places that might be a bottleneck for our
writes/reads.",83,59,1,1,"2018-04-16 10:25:39","1806.03"
"grafana/loki","5993640329a7f8bfafd80c88468dcbb32bee54de","chaudum","2023-01-26 19:46:43","true","Reflect release 2.7.2 on main branch (#8299)

To reflect current version in documentation and deployment files.

* CHANGELOG and release notes for release 2.7.2
* Helm and jsonnet deployment files

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",83,57,1,1,"2018-04-16 10:25:39","1741.39"
"grafana/loki","23cc93862df4fb443c423a62a8569a0c8d931197","taharah","2022-06-10 07:27:50","true","chore(fluentd): resolve rubocop failures (#6359)

Signed-off-by: Trevor Wood <Trevor.G.Wood@gmail.com>",71,50,0,0,"2018-04-16 10:25:39","1514.88"
"grafana/loki","5eb4c0d66a44793ad0b6a447af915bcbf5ade6d2","Red-GV","2022-05-19 13:11:29","true","operator: Changing GCP secret file path (#6199)

* Changing GCP secret file path

* Update changelog",72,49,0,1,"2018-04-16 10:25:39","1494.12"
"grafana/loki","91b0bcf36a084f9cf5d6da4af83c1c05c654925c","slim-bean","2022-02-17 12:57:34","true","remove promtail_log_entries_bytes_bucket (#5377)

Signed-off-by: Edward Welch <edward.welch@grafana.com>",294,46,0,1,"2018-04-16 10:25:39","1396.86"
"grafana/loki","ad3c8d07b742d7b575c50b3020de815039732f81","DylanGuedes","2022-01-31 21:14:03","true","Cleanup `util/validation` code. (#5285)

* Cleanup `util/validation` code.

* Remove `errors.go` file.",276,45,0,1,"2018-04-16 10:25:39","1381.2"
"grafana/loki","8b8d3a4eec256a26fa7472744d0fdd0fee64a3b8","irake99","2020-02-24 13:34:39","true","docs: fix outdated link of fluentd (#1728)",116,22,0,0,"2018-04-16 10:25:39","673.38"
"grafana/loki","be010f049dbbc4dae86da6e1aeed4a0833767991","cyriltovena","2020-01-08 15:29:18","true","Close iterator properly and check nil before releasing buffers. (#1480)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",104,21,0,1,"2018-04-16 10:25:39","627.46"
"grafana/loki","52efdfdf40d3df467539fd5ec6a1ab5a598c5d8b","slim-bean","2019-08-19 00:21:21","false","adding the beginnings of the release doc with steps, fixing a bug in the release_prepare.sh script and tweaking the output based on the current process.",107,16,0,1,"2018-04-16 10:25:39","487.83"
"grafana/loki","6ea5a8e497cf11962d8fc3a986999f4a080369b0","dimitarvdimitrov","2023-01-16 10:23:07","true","Update vendored dskit (#8155)

**What this PR does / why we need it**:

The Changelog diff between the two commits is
https://github.com/grafana/dskit/compare/3e308a49441b...7242706251b9

```
* [CHANGE] Cache: Switch Memcached backend to use `github.com/grafana/gomemcache` repository instead of `github.com/bradfitz/gomemcache`. #248
* [ENHANCEMENT] Add cache, gate and stringsutil packages. #239
* [ENHANCEMENT] Cache: add Redis support. #245
* [ENHANCEMENT] Cache: Add the ability to use a custom memory allocator for cache results. #249
* [BUGFIX] Memberlist: fix crash when methods from `memberlist.Delegate` interface are called on `*memberlist.KV` before the service is fully started. #244
```

**Checklist**
- [x] Reviewed the [`CONTRIBUTING.md`](../CONTRIBUTING.md) guide
(**required**)
- N/A Documentation added
- N/A Tests updated
- N/A `CHANGELOG.md` updated
- N/A Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",95,57,1,0,"2018-04-16 10:25:39","1731"
"grafana/loki","426bac7f5b283d03b95ef022c8015bc966433194","carlpett","2020-10-05 15:52:11","true","Add counter promtail_batch_retries_total (#2723)

Signed-off-by: Calle Pettersson <calle@cape.nu>",117,30,0,0,"2018-04-16 10:25:39","899.73"
"grafana/loki","333d5da0d0470338beaeedf92433e8f03e7927c4","sandeepsukhani","2022-02-22 20:22:12","true","add a metric for tracking the duration it took to sync the tables in queriers/index-gateways (#5446)

* add a metric for tracking the duration it took to sync the tables in queriers/index-gateways

* changes suggested from PR review",298,46,0,1,"2018-04-16 10:25:39","1402.16"
"grafana/loki","6bf7be2a6aff1ea77d80b2b15668b5e830f7d740","DanCech","2018-12-05 20:01:56","true","Fix typos in api.md",6,8,0,0,"2018-04-16 10:25:39","229.4"
"grafana/loki","835f710bc958eaa0dee4b22d46b58de1dc91abaa","sandeepsukhani","2021-03-17 14:26:03","true","make prefix for keys of objects created by boltdb-shipper configurable (#3491)

* make prefix for keys of objects created by boltdb-shipper configurable

* shared store key prefix should have a path separator",160,35,0,1,"2018-04-16 10:25:39","1061.67"
"grafana/loki","9686e4ba30f636e0a62ca339127ff58641aea027","DylanGuedes","2022-06-10 14:43:00","true","Add total number of unique users involved in query readiness. (#6035)",71,50,0,1,"2018-04-16 10:25:39","1515.18"
"grafana/loki","7df7169ccdeec1b900f98bc5bb09752d9aa2d41e","vlad-diachenko","2022-06-03 15:23:11","true","We shouldn't modify the loki config at all if the memberlist ring is not (#6299) (#6308)

enabled.

Signed-off-by: Callum Styan <callumstyan@gmail.com>

Co-authored-by: Callum Styan <callumstyan@gmail.com>",72,50,0,0,"2018-04-16 10:25:39","1508.21"
"grafana/loki","d6e0156d9a83aa58a6c1bbc8791ae3a103e285a5","tomwilkie","2018-12-11 14:19:13","false","Don't set columnkey, doesn't exist anymore.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",12,8,0,0,"2018-04-16 10:25:39","235.16"
"grafana/loki","31dd0e52b1bc9abfd95923086d770d614f8a438f","tomwilkie","2018-12-11 15:09:33","false","Put title back to anchor from grafana.com work.s

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",12,8,0,0,"2018-04-16 10:25:39","235.2"
"grafana/loki","d1f42fff5083761fee69e7257199636cf0f8d4a8","chodges15","2022-09-14 21:26:36","true","promtail: Fix issue with dropping logs when a file based SD target's labels are updated (#7016)

<!--  Thanks for sending a pull request!  Before submitting:

1. Read our CONTRIBUTING.md guide
2. Name your PR as `<Feature Area>: Describe your change`.
a. Do not end the title with punctuation. It will be added in the
changelog.
b. Start with an imperative verb. Example: Fix the latency between
System A and System B.
  c. Use sentence case, not title case.
d. Use a complete phrase or sentence. The PR title will appear in a
changelog, so help other people understand what your change will be.
3. Rebase your PR if it gets out of sync with main
-->

**What this PR does / why we need it**:
Allows for modifying labels for a target and continuing to scrape logs
afterwards.

**Which issue(s) this PR fixes**:
Fixes #7001 

**Special notes for your reviewer**:

<!--
Note about CHANGELOG entries, if a change adds:
* an important feature
* fixes an issue present in a previous release, 
* causes a change in operation that would be useful for an operator of
Loki to know
then please add a CHANGELOG entry.

For documentation changes, build changes, simple fixes etc please skip
this step. We are attempting to curate a changelog of the most relevant
and important changes to be easier to ingest by end users of Loki.

Note about the upgrade guide, if this changes:
* default configuration values
* metric names or label names
* changes existing log lines such as the metrics.go query output line
* configuration parameters 
* anything to do with any API
* any other change that would require special attention or extra steps
to upgrade
Please document clearly what changed AND what needs to be done in the
upgrade guide.
-->
**Checklist**
- [ ] Documentation added
- [x] Tests updated
- [x] Is this an important fix or new feature? Add an entry in the
`CHANGELOG.md`.
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",88,53,1,0,"2018-04-16 10:25:39","1609.46"
"grafana/loki","cb76da6c1d1f4290b7d1fa32206784d606876d51","cyriltovena","2020-06-04 21:13:03","true","Fixes path prefix in the querier. (#2178)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",128,26,0,1,"2018-04-16 10:25:39","778.95"
"grafana/loki","4da505b41390e8e62d777e40b6b4b21e9039d147","cyriltovena","2020-11-19 08:22:31","true","Fixes the Stringer of the byte label operator. (#2946)

This would cause the operator to become a numeric one once stringified.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",116,31,0,1,"2018-04-16 10:25:39","943.41"
"grafana/loki","0c721b49d64a24518763ad6b56fea7364ef9bb37","JordanRushing","2022-04-29 13:02:15","true","Add IndexGateway Query Readiness Duration panel to `Loki - Reads Resources` dashboard in production/loki-mixin (#6014)

* Add IndexGateway Query Readiness Duration panel to `Loki - Reads Resources` dashboard in production/loki-mixin

Signed-off-by: JordanRushing <rushing.jordan@gmail.com>

* Satisfy `make lint-jsonnet` by fixing query used in IndexGateway Query Readiness dashboard

Signed-off-by: JordanRushing <rushing.jordan@gmail.com>",93,48,0,0,"2018-04-16 10:25:39","1474.11"
"grafana/loki","31bb757c3be2fbaf6dec1799bdb22b046f6dd728","slim-bean","2021-04-19 20:43:02","true","update CI for branch rename to main (#3625)",161,36,0,1,"2018-04-16 10:25:39","1099.18"
"grafana/loki","2902f986a4f7bcad84a101ce2a11672d832df675","ashwanthgoli","2023-09-22 13:51:54","true","cache: Enable embedded cache if no other cache is configured. (#10620)

**What this PR does / why we need it**:

FIFO cache is replaced by embedded-cache in
https://github.com/grafana/loki/pull/6821
This PR enables embedded cache for query range results, chunks cache,
index_stats_results and volume_results if no other cache is explicitly
configured (redis, memcache).

**Special notes for your reviewer**:
Also removes a deprecated flag `cache-split-interval`

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [x] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [x] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

---------

Co-authored-by: Christian Haudum <christian.haudum@gmail.com>",35,65,1,0,"2018-04-16 10:25:39","1982.39"
"grafana/loki","9e9652a3b8372d805948dd00706c158ab801e5bd","owen-d","2020-01-07 16:08:26","false","initiates docker daemon for circle windows builds (#1476)

* initiates docker daemon for circle windows builds

* touch-protos amke target, circle windows build uses it

* touch-protos doenst explicitly depend on $(PROTO_GOS)",102,21,0,1,"2018-04-16 10:25:39","626.49"
"grafana/loki","15e1f158875ffd113a2d1dbaf0bb10677b59bab4","blockloop","2021-03-19 22:40:11","true","add TestCreateLokiStack_WhenGetReturnsNotFound_DoesNotError (#5)

* add TestCreateLokiStack_WhenGetReturnsNotFound_DoesNotError",169,35,0,0,"2018-04-16 10:25:39","1064.01"
"grafana/loki","4248825ad296da5bfa2cbd496559ddefda44054d","salvacorts","2023-11-10 15:25:33","true","Bloom-compactor Sharding (#11154)

**What this PR does / why we need it**:
This PR adds tenant and fingerprint (FP) sharding to bloom compactors.
Note that the bloom-compactor doesn't yet perform any compaction, but
iterates through all tables, tenants, and series checking if the
compactor owns the tenant and the series (by the series FP). Actual
compaction will be implemented with
https://github.com/grafana/loki/pull/11115.

A new structure `Job` is added which will carry around all the context
for a compaction job such as the tenant ID, the table name, and the
series FP. The sharding strategy has two methods:
- `OwnsTenant(tenant string)`: Checks if the compactor shard owns the
tenant.
- `OwnsJob(job Job)`: Checks (again) if the compactor owns the job's
tenant. Then, it checks if the compactor owns the job's fingerprint by
looking inside the tenant subring.

We add a new per-tenant limit: `bloom_compactor_shard_size`. If it's 0,
the tenant can use all compactors (i.e. `OwnsTenant` will always return
`true`), otherwise, only `bloom_compactor_shard_size` out of the total
number of compactors will own the tenant. A given job's FP will be owned
by exactly one compactor within the tenant shard.

**Special notes for your reviewer**:
- Added a bunch of metrics in `metrics.go`
- Added a test for the sharding strategy",0,67,1,1,"2018-04-16 10:25:39","2030.46"
"grafana/loki","67050207e57f2eef0e4f428a62e0328e16ee2013","tomwilkie","2018-04-16 10:34:29","false","use 1.10.1 as build container.",0,0,0,0,"2018-04-16 10:25:39","0.01"
"grafana/loki","89a094c5fef518bf130e09080c118b0233e9694f","periklis","2023-06-20 17:40:16","true","operator: Add rules labels filters for openshift application tenant (#9600)

Co-authored-by: Mohamed-Amine Bouqsimi <bouqsimiamine@gmail.com>",61,62,1,1,"2018-04-16 10:25:39","1890.55"
"grafana/loki","3ed4f4d69838a97d242fcff9a45453a7575c005a","davkal","2019-04-17 13:13:01","true","Merge pull request #488 from ialidzhikov/multitenancy-note

Add note about auth_enabled",103,12,0,0,"2018-04-16 10:25:39","366.37"
"grafana/loki","c5bc41628a6c4f7ae3a5382f858cf47850cab1fb","sandeepsukhani","2020-08-10 18:28:01","true","download boltdb files parallelly during reads (#2483)

* download boltdb files parallelly during reads

* changes suggested from PR review",120,28,0,1,"2018-04-16 10:25:39","844.83"
"grafana/loki","3a8325d8289ef1ad35c0bd65fcc67b13a5f38aef","sandeepsukhani","2023-01-02 09:58:13","true","make query-frontend service grpc lb friendly (#8025)

**What this PR does / why we need it**:
In PR #7966, I made changes to Query Frontend service. Part of it was
creating a new service.
To make the service properly load balance grpc requests, we need to use
`grpclbServiceFor`, but since we do not use grpc in QF, I went with the
usual method, i.e. I used `serviceFor`. Thinking more about it, I think
there is no harm in keeping it grpc LB friendly, and it would save us
from any possible bugs if we make QF accept queries via grpc.",99,56,1,1,"2018-04-16 10:25:39","1716.98"
"grafana/loki","24bc2d662322958d7ae20e2cb67bd9fe4a627a53","Skeen","2020-02-21 01:39:18","true","Update fluentd base image for docker. (#1703)

Updated base image from: v1.3.2-debian to v1.9.2-debian-1.0.
Changed ruby from 2.3.0 to 2.6.0.",119,22,0,0,"2018-04-16 10:25:39","669.88"
"grafana/loki","99c5b35895ebb42ed2f39479b1acfd016ac53370","chaudum","2022-04-12 15:14:58","true","Add more function comments to the rangemapper implementation (#5861)

* Add more function comments to the rangemapper implementation

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* Apply suggestions from code review

Co-authored-by: Susana Ferreira <susana.ferreira@grafana.com>

Co-authored-by: Susana Ferreira <susana.ferreira@grafana.com>",319,48,0,1,"2018-04-16 10:25:39","1451.95"
"grafana/loki","ab4d885276f3a65e91826a75d9be9733009446fa","rfratto","2020-02-25 15:06:03","true","Fix 32-bit Promtail ARM docker builds from Drone (#1740)

* link ld-linux-armhf.so.3 when building 32-bit arm promtail image if needed

* Update .drone/drone.jsonnet

Co-Authored-By: sh0rez <me@shorez.de>

* review feedback

Co-authored-by: sh0rez <me@shorez.de>",117,22,0,1,"2018-04-16 10:25:39","674.44"
"grafana/loki","1fe5dc45b3dcd383ef837e3ff94f58c8b96c8f7b","rfratto","2020-02-05 17:55:23","true","ci: prune docker tags prefixed with ""master-"" older than 90 days on merge (#1639)",109,22,0,1,"2018-04-16 10:25:39","654.56"
"grafana/loki","2c8cf9e86f84cb3e8d78fd0c24db99aec139e63f","chancez","2021-01-27 21:24:07","true","Makefile: Build promtail for windows/386 to support 32 bit windows hosts (#3243)",123,33,0,0,"2018-04-16 10:25:39","1011.96"
"grafana/loki","365235bdc6f1f6664f14641b2d3f936bf094c960","cyriltovena","2020-06-05 13:47:39","true","Refactor mixin routes and add series API. (#2185)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",130,26,0,1,"2018-04-16 10:25:39","779.64"
"grafana/loki","732fe6d14fb3efc34ce1b1c1ad87feb4bd3fdedc","cyriltovena","2020-06-22 12:49:02","true","Adds default -config.file for the promtail docker images. (#2196)

Closes #2194.

This is already the case for Loki. I think it's better to have this since most people would expect it as default at least for docker.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",139,26,0,1,"2018-04-16 10:25:39","796.6"
"grafana/loki","36594e21ae5aec4d50ec920eaec0ac56b8160351","cyriltovena","2020-07-13 19:33:28","true","Add a complete tutorial on how to ship logs from AWS EKS. (#2338)

* Add a complete tutorial on how to ship logs from AWS EKS.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Update docs/clients/aws/eks/promtail-eks.md

* Update docs/clients/aws/eks/promtail-eks.md

* Final touches.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",117,27,0,1,"2018-04-16 10:25:39","817.88"
"grafana/loki","8393c3382afd0ec723e4810c2a50da1a2614cbc8","cyriltovena","2019-10-15 12:28:31","false","rollback fluent-bit push path until we release 0.4",66,18,0,1,"2018-04-16 10:25:39","544.34"
"grafana/loki","ec81583b635d5e225738f99bb37d47cae7c7aa7d","rfratto","2019-09-16 18:17:35","true","ksonnet: use consistent hashing in memcached client configs (#1020)",70,17,0,1,"2018-04-16 10:25:39","515.58"
"grafana/loki","557f9ccd7b83bb28ebbf3e65b879a1b7db68365a","JensErat","2020-01-06 14:58:31","false","fluent-bit: multi-instance support (#1294)

To run multiple plugin instances at the same time, the plugin instance
must be registered and later retrieved.

Additionally, a list of registered plugin instances must be stored for
proper disposal during fluent-bit shutdown.

Based on the [out_multiinstance example] in the upstream repository.

[out_multiinstance example]: https://github.com/fluent/fluent-bit-go/blob/fc386d263885e50387dd0081a77adf4072e8e4b6/examples/out_multiinstance/out.go

Signed-off-by: Jens Erat <email@jenserat.de>
Co-authored-by: Hiroshi Hatake <cosmo0920.oucc@gmail.com>",106,21,0,0,"2018-04-16 10:25:39","625.44"
"grafana/loki","3038170aee8d26cc7d5cad09fba5e77bf5e2231b","ashwanthgoli","2023-10-03 10:28:02","true","Add deprecation node for write dedupe cache (#10736)

**What this PR does / why we need it**:
Adds a deprecation node for write dedupe cache. This cannot be fully
removed yet as legacy indexes rely on this.

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [x] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",28,65,1,0,"2018-04-16 10:25:39","1993.25"
"grafana/loki","31ca108a3cf5bcb87ffeb54d06d6fa4c53e4830d","KMiller-Grafana","2022-05-06 21:09:46","true","Docs: redo PR 5109 (#6119)",73,49,0,0,"2018-04-16 10:25:39","1481.45"
"grafana/loki","32ca444543a363cea2739646d4d77656b1bd9570","davkal","2019-04-02 12:51:08","true","Merge pull request #438 from daixiang0/update-doc

Update logcli doc",95,11,0,0,"2018-04-16 10:25:39","346.1"
"grafana/loki","7735b1e98eed49dcd4b8ef4308bfa351a830835e","MasslessParticle","2023-04-13 13:47:24","true","Sanitize label keys in the unpack parser (#9121)

This PR makes the `unpack` parser sanitize label keys like all the other
parsers. When invalid label names are included, it causes the user to
get `could not write JSON response` errors when the response is
serialized to send back to the user.",82,60,1,1,"2018-04-16 10:25:39","1818.14"
"grafana/loki","75b6832a61ca3f5be04c3a000aa6f530e458d44d","sandeepsukhani","2019-05-15 10:17:03","false","Update table manager image in production/ksonnet (#582)",100,13,0,1,"2018-04-16 10:25:39","394.24"
"grafana/loki","5db578bfe831ffef400a54060ebf39e1f2fd6adb","sandeepsukhani","2022-07-13 01:52:05","true","fix the issue of overwriting tsdb files during rollouts (#6668)",71,51,0,1,"2018-04-16 10:25:39","1547.64"
"grafana/loki","a5c544e7ba49053dfcee65f8b516d9877ca3c280","cstyan","2022-01-06 18:18:39","true","Add an egress bytes total metric to the azure client. (#5067)

* Add an egress bytes total metric to the azure client.

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* Update changelog entry PR # for egress metric addition.

Signed-off-by: Callum Styan <callumstyan@gmail.com>",253,45,0,1,"2018-04-16 10:25:39","1356.08"
"grafana/loki","78aad0b80515091184705531068df53d98e9ff91","salvacorts","2023-07-19 12:59:31","true","Fix buffered iterator (#9976)

**What this PR does / why we need it**:

In https://github.com/grafana/loki/pull/9700, we added support for
writing non-indexed labels from entries into chunks. This PR introduced
two bugs:

- When the buffered iterator is closed, the buffer to read metadata
labels is put back into the pool but not set to nil. Subsequent uses of
the iterator may write on top of the buffer that was put back on the
pool. This may lead to inconsistent/incorrect results.
- Inside the buffered iterator, we were not correctly handling EOFs
while reading the number of labels and each label length. This was due
to the `lastAttemp` variable not being reset.

This PR adds a new test for these two bugs and also fixes them.

**Which issue(s) this PR fixes**:
Fixes https://github.com/grafana/loki/pull/9700

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",58,63,1,1,"2018-04-16 10:25:39","1919.36"
"grafana/loki","61d407b4bbf21182a16dcce8e3a99fe4703a7227","salvacorts","2023-06-16 20:03:01","true","Add keep stage to LogQL (#9693)

**What this PR does / why we need it**:
This PR adds a new `keep` stage to LogQL. It allows filtering specific
labels and helps to avoid hitting the _max streams per query_ limit by
keeping only specific labels in the label set. It works the opposite of
[drop
stage](https://grafana.com/docs/loki/latest/logql/log_queries/#drop-labels-expression).

**Special notes for your reviewer**:
We do not drop [special error
labels](https://github.com/grafana/loki/blob/edc6b0bff76714ff584c20d7ff0235461a4f4a88/pkg/logqlmodel/error.go#L18-L20)
added by Loki at query time. Users will have to explicitly drop them by
using the drop stage.

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [x] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

---------

Co-authored-by: Sandeep Sukhani <sandeep.d.sukhani@gmail.com>
Co-authored-by: J Stickler <julie.stickler@grafana.com>",58,62,1,1,"2018-04-16 10:25:39","1886.65"
"grafana/loki","814cc87eb2e1175b9664ef2137130e725705cf32","cyriltovena","2020-02-11 15:33:08","true","Pipe data to Promtail (#1649)

* Adds readerTarget that read from io.Reader

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Updates comment and function names.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Adds stdin manager

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add more tests.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Adds default config with labels and support for static configs labels.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Adds a test with pipeline stages.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes race on shutdown and adds documentation

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes deadlock on server.run

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Update docs/clients/promtail/troubleshooting.md

Co-Authored-By: Owen Diehl <ow.diehl@gmail.com>

* gofmt

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* gofmt

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* unlock mutex if Promtail.Run is called when Promtail is stopped

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>
Co-authored-by: Robert Fratto <robertfratto@gmail.com>",113,22,0,1,"2018-04-16 10:25:39","660.46"
"grafana/loki","222ffc52d3e9d2830f6b8678df14529f67dde1db","thepalbi","2023-09-18 15:50:36","true","Add CloudFormation template for lambda + EventBridge setup (#10540)

**What this PR does / why we need it**:

https://github.com/grafana/loki/pull/10449 added support so that lambda-promtail can handle s3 events through AWS EventBridge. This PR is a follow up adding a CloudFormation template to deploy lambda-promtail, with the corresponding EventBridge rule to deliver s3 events to the lambda.

**Which issue(s) this PR fixes**:

Rel https://github.com/grafana/loki/issues/10209

---------

Co-authored-by: J Stickler <julie.stickler@grafana.com>
Co-authored-by: Christian Haudum <christian.haudum@gmail.com>",40,65,1,0,"2018-04-16 10:25:39","1978.48"
"grafana/loki","e6192a69084b5fd48333728cc970914e7caf1d10","oiooj","2019-02-24 08:17:14","false","Fix start tailing panic

Signed-off-by: kun <oiooj@qq.com>",81,10,0,0,"2018-04-16 10:25:39","307.91"
"grafana/loki","95052943c4c1fde919ac0b3825d951bde0d09e6f","owen-d","2021-01-07 20:42:14","true","swaps mutex for atomic (#3141)",116,33,0,1,"2018-04-16 10:25:39","991.93"
"grafana/loki","ad803af9dc6f8d9ec9b393ae2a91eac0e0ab3894","owen-d","2021-01-05 13:09:37","true","Wal/recover corruption (#3117)

* simplifies recovery code and continues after errors

* does not exit on wal recovery failure

* log line parity

* less scary error msgs

* more descriptive errors

* Update pkg/ingester/ingester.go

Co-authored-by: Ed Welch <ed@oqqer.com>

* Update pkg/ingester/ingester.go

Co-authored-by: Ed Welch <ed@oqqer.com>

Co-authored-by: Ed Welch <ed@oqqer.com>",113,33,0,1,"2018-04-16 10:25:39","989.61"
"grafana/loki","7d93c30806a3fb8be89a269688e71b5edfeac07d","kavirajk","2023-09-06 16:03:48","true","Freeze v2.9.0 release notes on `main` (#10481)

**What this PR does / why we need it**:
`next.md` -> `2.9.0` and create new `next.md`

**Which issue(s) this PR fixes**:
relate: #10468 

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",46,65,1,1,"2018-04-16 10:25:39","1966.48"
"grafana/loki","b073ec90173449c0a8488b470998891e70622a91","chaudum","2022-05-19 07:49:25","true","security: Redact credentials when marshalled to YAML (#6186)",73,49,0,1,"2018-04-16 10:25:39","1493.89"
"grafana/loki","ed025e0cd6931427d2c75866f14edee05a615bc4","trevorwhitney","2021-10-28 17:40:55","true","Change a few default config values and improve application of common storage config (#4543)

* further config simplifications and better defaults

* default ruler api to on
* register defaults for storage configs in the common config (ie.
  signature version for S3)
* enable ingester wal by default
* disable chunk retries by default
* allow common path prefix to include or omit trailing slash
* allow partial storage config to be defined for overriding things like
  bucket names per component

* fix tests

* add changelog and upgrade docs

* explain impact of wal change in upgrading.md

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>

* rename add WithPrefix to RegisterFlags

* fix (frontend OR worker) and scheduler boot order when both are running (#4545)

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>",166,42,0,1,"2018-04-16 10:25:39","1288.05"
"grafana/loki","e2a443452d24421b8d0fd9e10f747dd0d096d552","cyriltovena","2022-01-14 08:31:09","true","Fixes operational dashboard and add azure. (#5127)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",263,45,0,1,"2018-04-16 10:25:39","1363.67"
"grafana/loki","82d96dec03c27c7cab2e55999307a3a1024525e5","cyriltovena","2021-01-07 16:49:14","true","Improve distributors validation. (#3134)

```bash
❯ benchcmp  before.txt after.txt
benchmark             old ns/op     new ns/op     delta
Benchmark_Push-16     18708519      1348876       -92.79%

benchmark             old allocs     new allocs     delta
Benchmark_Push-16     44             42             -4.55%

benchmark             old bytes     new bytes     delta
Benchmark_Push-16     4008391       2079          -99.95%
```

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",115,33,0,1,"2018-04-16 10:25:39","991.77"
"grafana/loki","9467a341f6feab8068d030765fd1dd940b99e839","09jvilla","2022-09-19 14:43:42","true","Update README.md (#7190)

Typo fix on helm chart readme",87,53,1,0,"2018-04-16 10:25:39","1614.18"
"grafana/loki","d1b873165aad068f883a2d6700d9b37565ea931f","tomwilkie","2019-04-19 08:46:13","false","Better error messages.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",95,12,0,0,"2018-04-16 10:25:39","368.18"
"grafana/loki","7195539a3fb036f44903d3702b9dd982399916da","rfratto","2019-09-03 18:28:39","false","docs: incorporate formatting fixes from #860",124,17,0,1,"2018-04-16 10:25:39","502.59"
"grafana/loki","ded261482334759a3179bc1ea48831efdda0b4b5","slim-bean","2022-08-19 16:42:57","true","Remove comparisons page, it's not very acurate and the information is outdated. (#6938)

Signed-off-by: Edward Welch <edward.welch@grafana.com>

Signed-off-by: Edward Welch <edward.welch@grafana.com>",82,52,0,1,"2018-04-16 10:25:39","1584.26"
"grafana/loki","882010a810254e880d42521aa046b6e59c77590f","sandeepsukhani","2022-07-21 01:28:09","true","Index shipper move code (#6704)

* move compactor code to generic indexshipper

* move table client to generic indexshipper

* move storage package and relevant code for managing files on storage to generic indexshipper

* add missing files

* lint",70,51,0,1,"2018-04-16 10:25:39","1555.63"
"grafana/loki","b865afc0d7dd7488bd6b873074cefe061b449e99","sandeepsukhani","2022-01-03 11:19:10","true","fix splitting of queries when step is larger than split interval (#5006)",255,44,0,1,"2018-04-16 10:25:39","1352.79"
"grafana/loki","da72c68834e02fb2781c2fa221c7d485f11de8a2","sandeepsukhani","2022-07-19 05:36:55","true","add jsonnet for configuring memberlist cluster label (#6707)

* add jsonnet for configuring memberlist cluster label

* simplify jsonnet

* set the memberlist labels directly in the config",69,51,0,1,"2018-04-16 10:25:39","1553.8"
"grafana/loki","fad57e299e4381330423e6ec5ec505aafe9afab1","tomwilkie","2019-01-31 18:40:24","true","Fix validation; allow 'metrics' without a metric name. (#268)

* Update cortex to include optionally-enforce-metric-name

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>

* Configure validation to allow 'metrics' without metric names.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",77,9,0,0,"2018-04-16 10:25:39","285.34"
"grafana/loki","c54be421ca233bbb2cb6b97e7a354e16a43ac0f3","wardbekker","2020-07-02 20:37:17","true","Change the Grafana image to latest (#2287)

For a better first use experience, I would recommend changing the grafana image to latest. Grafana master is not guaranteed to be in a stable state.",130,27,0,0,"2018-04-16 10:25:39","806.92"
"grafana/loki","048e8bdb9c8c0dc77039c2ab1ec68b389cfae87f","sandeepsukhani","2020-08-24 06:21:29","true","minor fixes and improvements for boltdb shipper (#2530)

1. Continue uploading of other tables during failures.
2. Remove .temp files while loading dbs during startup.
3. Remove empty table folders while loading tables during startup.",122,28,0,1,"2018-04-16 10:25:39","858.33"
"grafana/loki","fc12a2355dbadc171ef408a649ae9c8690aa469e","slim-bean","2019-08-01 14:28:31","false","style(loki-canary): spelling  (#832)",107,15,0,1,"2018-04-16 10:25:39","470.42"
"grafana/loki","fb7b97521c1dd7e2157c2e8a2c4fc3cd37ea75e0","blockloop","2021-03-19 21:07:26","true","fix golangci-lint timeout flag",169,35,0,0,"2018-04-16 10:25:39","1063.95"
"grafana/loki","bddf4fc9befd08bbe4ab2d3c44ac48ac473f44d4","sandeepsukhani","2019-08-05 06:13:53","false","rebased and removed some unwanted code",104,16,0,1,"2018-04-16 10:25:39","474.08"
"grafana/loki","2ed3c15c224dec896cffda2dc6967f62dcc8cda2","sandeepsukhani","2023-06-30 19:33:07","true","index: allow refreshing index file names cache for specific tables (#9798)

**What this PR does / why we need it**:
We have a cache for index files available in the object storage, which
helps reduce the number of list calls we make to the object storage.
Currently, we only support refreshing the whole index cache, which
includes all the files for all tables and users. However, in a large
cell with many tables and tenants, it is less likely that all the tables
are being referenced. Also, most iterative operations would only need a
fresh listing of just a few tables at a time so it is wasteful to always
refresh the whole index cache.

This PR adds support for refreshing the index cache for only specific
tables. I am doing it as part of some compactor improvements to run
compaction and retention in separate goroutines to avoid blocking
compaction when some expensive delete requests are being processed. To
make those changes, I needed a way to cost-effectively refresh the index
files in the table being picked up for processing.

**Checklist**
- [x] Tests updated",61,62,1,1,"2018-04-16 10:25:39","1900.63"
"grafana/loki","dfff86f1cd325dfb96d3b7df611acba64b6cc959","sandeepsukhani","2023-01-13 15:38:56","true","skip compacting tables that do not fit in start and end date of desired schema config (#8127)

Before compacting tables, we look up the schema config for them. If we
do not find a schema config for a table, we skip them. However, the
schema lookup code was considering the start time of the schema and not
the end time.
This can cause the compactor to try compacting tables with the same
prefix as one of the previous schemas, but the table interval falls into
one of the subsequent schemas with a different config.

This PR fixes the issue and simplifies the code by reusing existing
schema lookup code.
I have also updated test cases to verify the fix works.",96,57,1,1,"2018-04-16 10:25:39","1728.22"
"grafana/loki","0cdbf3689e8031bec745ef3ce28477ff492bf49e","granular-ryanbonham","2019-03-25 18:50:41","false","range is not a valid option for seLinux",92,11,0,0,"2018-04-16 10:25:39","339.35"
"grafana/loki","a037f19fd29c94ea9bff9b74c3ccd25b6341cfc5","cyriltovena","2019-05-13 21:18:21","false","tweaking test target",99,13,0,1,"2018-04-16 10:25:39","392.7"
"grafana/loki","3dd2d51f8ed3ec87f0ce17442ac0454bd48b017b","cyriltovena","2020-03-25 21:04:45","true","Pin helm version in circle-ci helm testing workflow. (#1849)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",119,23,0,1,"2018-04-16 10:25:39","704.69"
"grafana/loki","862491ea9de1dfcde2007ad8b8527a6adfba6443","cyriltovena","2019-05-07 17:36:55","true","fix backward compatibility with client config (#554)

* fix backward compatibility with client config

* fix comment",100,13,0,1,"2018-04-16 10:25:39","386.55"
"grafana/loki","c9f3868287c1a2c8ab267579cf452bea3d980f8c","jeschkies","2022-04-12 10:04:52","true","Update dskit to v0.0.0-20220331160727-49faf69f72ca. (#5881)",319,48,0,1,"2018-04-16 10:25:39","1451.74"
"grafana/loki","b1917a617877921b662f9dd7f710fb91a5aac12c","zeitlinger","2023-06-09 11:38:21","true","add ""alignLeft"" and ""alignRight"" functions (#9672)

Fixes https://github.com/grafana/loki/issues/9667",69,62,1,0,"2018-04-16 10:25:39","1879.3"
"grafana/loki","80278fd1bd70a34a5a1ba989464dd1e845ef9994","periklis","2021-12-16 14:12:55","false","Remove old license references",233,44,0,1,"2018-04-16 10:25:39","1335.91"
"grafana/loki","5d7e0fd6c0a23cf0f1bf48a46a277515c2b5e0aa","jeschkies","2023-05-26 07:46:43","true","Pass emtpy TLS config to Loki Canary client. (#9516)",68,61,1,1,"2018-04-16 10:25:39","1866.14"
"grafana/loki","fe8befe1bb7acd75db380e547af51be466a32342","grafanabot","2023-05-03 11:29:55","true","[CI/CD] Update yaml file `./production/helm/loki/Chart.yaml` (+1 other) (#9385)

**Here is a summary of the updates contained in this PR:**
***
Update attribute `$.appVersion` in yaml file
`./production/helm/loki/Chart.yaml` to the following value: `2.8.2`
***
Bump version of Helm Chart
Add changelog entry to `./production/helm/loki/CHANGELOG.md`
Re-generate docs

Co-authored-by: Salva Corts <salva.corts@grafana.com>",81,61,1,0,"2018-04-16 10:25:39","1843.29"
"grafana/loki","d434e808777b713cb7527b33cf414270b8653f68","Jack-Kingdom","2023-02-03 12:15:56","true","Promtail: Add custom headers on push requests (#7470) (#7472)",79,57,1,0,"2018-04-16 10:25:39","1748.08"
"grafana/loki","4cd1246b8830ccc241fa4afff85d208dc6ae2129","mar4uk","2023-01-26 21:55:12","true","Logproto: Extract push.proto from logproto package to the separate module (#8259)

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>",83,57,1,0,"2018-04-16 10:25:39","1741.48"
"grafana/loki","089ec1b05f5ec15a8851d0e8230153e0eeb4dcec","chaudum","2022-12-23 07:49:36","false","Fix various linter errors

These changes have been generated using `make lint`.

```console
$ golangci-lint --version
golangci-lint has version 1.50.0 built from 704109c6 on 2022-10-04T10:25:07Z
```

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",97,56,1,1,"2018-04-16 10:25:39","1707.89"
"grafana/loki","679c9e122f604a17842380c023149584e13a5b69","rfratto","2022-12-04 17:54:15","true","rerun make drone so the newest build image is used (#7849)

Follow up on #7848, where the Drone config needed to be updated as well",96,56,1,1,"2018-04-16 10:25:39","1689.31"
"grafana/loki","040c549845cb8534cc49d4fd97c562965af17efc","alexandre1984rj","2022-11-28 10:57:38","true","[Docs] Fix helm loki examples links (#7779)

Fixes links to Helm documentation.",97,55,1,0,"2018-04-16 10:25:39","1683.02"
"grafana/loki","c23e541fe7d6aa4e35e720df4e191f034325d24f","jeschkies","2022-08-31 14:53:23","true","Generate Helm chart README. (#7012)

**What this PR does / why we need it**:
The Helm CI would break because the Helm chart README was not generated.
This change

* updates the README
* introduces a filter that will only run the Helm CI on changes to the
  Helm chart directory
* removes trailing whitespace
* corrects the Minio chart repository",81,52,1,1,"2018-04-16 10:25:39","1596.19"
"grafana/loki","d91a64f910086a7bf5c295cebbd9713a09901e69","periklis","2022-06-01 13:57:51","true","operator: Add support for custom S3 CA (#6198)",73,49,0,1,"2018-04-16 10:25:39","1506.15"
"grafana/loki","d4a5e60445909f70c89e1fa727e598200d660e99","blockloop","2021-03-17 15:41:02","true","fix rbac generation, etc",159,35,0,0,"2018-04-16 10:25:39","1061.72"
"grafana/loki","7f343d248a85e5a1ecdb90fce6eefc4043cf97cd","MasslessParticle","2022-07-20 07:29:02","true","Fix goroutine leak when using http2 (#6718)",71,51,0,1,"2018-04-16 10:25:39","1554.88"
"grafana/loki","4d90c7713dedcc04e626e7967b0270a345836f9e","fhalim","2019-07-31 15:18:13","false"," docs: missing escape character on regex in YAML (#811)

* Use single quote to avoid escaping regex",106,15,0,0,"2018-04-16 10:25:39","470.45"
"grafana/loki","e65fd2e7981ff430436b165fef9d313a6b42650a","sandeepsukhani","2019-08-20 09:57:36","true","bigtable-backup-tool: Improvements (#895)

* improvements in bigtable backup tool

Added some metrics for monitoring of backup jobs
Added a command to delete out of range backups, otherwise, there would be more backups than expected and alerts would start firing for unexpected backups",112,16,0,1,"2018-04-16 10:25:39","489.23"
"grafana/loki","962e03932d3c216e171ca3f01eb37e0d60681d2a","sandeepsukhani","2023-08-25 10:22:27","true","non-indexed labels: support for deletion of logs with non-indexed labels (#10337)

**What this PR does / why we need it**:
We recently added support for storing and querying non-indexed labels
with each log line. This PR wires up the code for supporting deletion
using non-indexed labels.

**Checklist**
- [x] Tests updated",50,64,1,1,"2018-04-16 10:25:39","1955.25"
"grafana/loki","21d4ca41e232f479e12b6a75af213bdee5e83e28","sandeepsukhani","2020-04-27 13:52:02","true","make boltdb shipper singleton and some other minor refactoring (#1995)

* make boltdb shipper singleton and some other minor refactoring",115,24,0,1,"2018-04-16 10:25:39","741.64"
"grafana/loki","b39e4900ec60e04afd01f2e95a08a9da0dbf5e90","vlad-diachenko","2022-07-18 10:15:36","true","updated versions to the latest release v2.6.1 (#6703)",69,51,0,0,"2018-04-16 10:25:39","1552.99"
"grafana/loki","4c2187ebb85745bf2b21926bdd74c58b8647d1a9","kavirajk","2023-08-11 12:21:51","true","CODEOWNERS: Remove duplicate file from `.github` directory (#10227)

**What this PR does / why we need it**:
This file was added by docs squad some time back
https://github.com/grafana/loki/pull/2454

It's no longer needed as we have [root level
CODEOWNERS](https://github.com/grafana/loki/blob/main/CODEOWNERS) that
has right permissions to docs squad already.

If we need to change anything, we do it here
**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",53,64,1,1,"2018-04-16 10:25:39","1941.33"
"grafana/loki","3cba86faf24569c577217b2dda6b6e9d6e129500","owen-d","2022-08-12 09:53:00","true","[bugfix] fixes issues sharding series by storageref vs fingerprint in stripeSeries (#6882)

Signed-off-by: Owen Diehl <ow.diehl@gmail.com>",82,52,0,1,"2018-04-16 10:25:39","1576.98"
"grafana/loki","7f498e96174171bca3a1aa179558e2013ec726ba","sandeepsukhani","2022-03-09 06:06:55","true","cleanup common index source files at the end while compacting index with boltdb-shipper (#5585)",305,47,0,1,"2018-04-16 10:25:39","1418.57"
"grafana/loki","6f83c01c1454fcda74e0666db611b924061c2097","julienduchesne","2023-04-18 05:22:37","true","Fix pipeline skipping in forks (#9165)",83,60,1,0,"2018-04-16 10:25:39","1828.04"
"grafana/loki","ba54f519a8993fdd840854c3df01bd4029a3f4b1","sh0rez","2019-06-04 10:19:27","false","feat(ci): promtail cross platform

Build promtail on linux and windows, discard artifacts",109,14,0,0,"2018-04-16 10:25:39","413.25"
"grafana/loki","f206165c4f88556b229d7e2700bc943b15c49fbe","slim-bean","2020-05-13 12:19:52","true","output a debug log if the requested path in the scrape config doesn't match any files (#2069)

Signed-off-by: Ed Welch <edward.welch@grafana.com>",118,25,0,1,"2018-04-16 10:25:39","757.58"
"grafana/loki","78bb4bcef76e5351bc276144ca24c7695fc07a95","oddlittlebird","2020-11-13 18:37:29","true","Update CODEOWNERS (#2933)",126,31,0,0,"2018-04-16 10:25:39","937.84"
"grafana/loki","82a0b9afd680bab3affa1a7df36c7fa579d91720","cyriltovena","2020-04-01 18:36:32","true","Add precision about the range notation for LogQL. (#1881)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",121,23,0,1,"2018-04-16 10:25:39","710.59"
"grafana/loki","0fc934e4ea3ed76b995fd488a5fec3fab5a82886","vlad-diachenko","2023-08-04 12:26:43","true","non_indexed_labels stage: additional test-case (#10170)

added additional test-case to cover match and non_indexed_labels stages
together.

Signed-off-by: Vladyslav Diachenko <vlad.diachenko@grafana.com>",53,64,1,0,"2018-04-16 10:25:39","1934.33"
"grafana/loki","11e2375e6d145b793217c697fb0914039fb3a8e5","JStickler","2023-06-15 18:44:37","true","Removing 'please' from the docs. (#9658)

**Which issue(s) this PR fixes**:
Fixes #8922 

**Special notes for your reviewer**:
This is to conform with our Style Guide.
https://developers.google.com/style/tone#politeness-and-use-of-please",60,62,1,0,"2018-04-16 10:25:39","1885.6"
"grafana/loki","bcdc807dd34d7a4e2e1dcfdffecd869da66e6efe","periklis","2023-06-29 18:57:20","true","operator: Expose limits config setting cardinality_limit (#9830)",60,62,1,1,"2018-04-16 10:25:39","1899.61"
"grafana/loki","4efdc131beedcc6e75cc5b8847af65bef2d7ba24","kavirajk","2022-12-01 10:40:26","true","fix(memcached): panic on `send on closed channel`. (#7817)",93,55,1,1,"2018-04-16 10:25:39","1686.01"
"grafana/loki","835dd293167fc125066dd78b318045d406355f7e","osela","2020-05-14 19:39:08","true","fluentd plugin: support placeholders in tenant field (#2074)",118,25,0,0,"2018-04-16 10:25:39","758.88"
"grafana/loki","0f7f200c032314eae328d43d8d1a4689333aa2dc","joe-elliott","2019-10-11 15:14:19","false","Improved compression ratio histogram (#1143)

* Updated compression ratio histogram to better cover the actual range

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Guard against divide by 0

Signed-off-by: Joe Elliott <number101010@gmail.com>

* Removed temp test

Signed-off-by: Joe Elliott <number101010@gmail.com>",63,18,0,0,"2018-04-16 10:25:39","540.45"
"grafana/loki","7b89f203786d955cefe572cf6fbb9b5823ad5b0f","kavirajk","2022-08-03 07:48:02","true","fix(logql): Make `LabelSampleExtractor` work as expected when label doesn't exist in logline (#6766)

* fix(logql): Make `StringLabelfilter` work as expected

Consider Log lines

```
msg=hello subqueries=5
msg=hello subqueries=0
msg=hello
```

If you run following logql
```
{foo=""bar""}|logfmt|subqueries!=0
```
it returns
```
msg=hello subqueries=5
```

But if you run following logql
```
{foo=""bar""}|logfmt|subqueries!=""0"" # NOTE: ""0"" as string.
```
it returns
```
msg=hello subqueries=5
msg=hello
```

NOTE: it also returns log lines that doesn't contain `subqueries` label in the first
place.

This cause subtle error if used in metric queries using that `label` in unwrap.

e.g: following logql on above log lines returns
```
sum_over_time({foo=""bar""}|logfmt|subqueries!=""0""|unwrap subqueries[1m])
```

Returns `pipeline error: 'SampleExtractionErr'`. Because, the lines without `subqueries`
labels are not skipped during `ProcessLine` and during metric extraction, our extractor
sets this `SampleExtractionerror`.

Fixes: https://github.com/grafana/loki/issues/6713

* Add it on changelog

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Fix linter

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Add more tests and fix the edge case with equality to empty strings

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* typo on the comment

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* handle this edge case during metric extraction. Not in label filter

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Fix linter

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Remove commented code

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Update changelog

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",77,52,0,1,"2018-04-16 10:25:39","1567.89"
"grafana/loki","d495c68ef90a028fb50917c03a983a1e3b979b0a","tomwilkie","2019-03-20 18:41:40","false","Need to set the number of bytes read, not add them.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",91,11,0,0,"2018-04-16 10:25:39","334.34"
"grafana/loki","9590e5ca4ec823c2fcb0b6076fac474c2e1112f8","sandeepsukhani","2022-07-07 07:20:03","true","Tsdb tenant index querying (#6598)

* update per tenant index identifier and relevant changes

* add a flag to ForEach index callback to tell whether it is multitenant index or not",71,51,0,1,"2018-04-16 10:25:39","1541.87"
"grafana/loki","d3e42959a56637b9a6c384dd071fcedffcdd30f9","sandeepsukhani","2022-11-21 06:09:28","true","fix bugs in processing delete requests with line filters and add proper tests (#7720)

**What this PR does / why we need it**:
It fixes the following issues:
* Whole chunks being deleted with a line filter were skipped.
* Chunks partially covered by delete requests with a line filter were
not properly processed. The part that **was not covered** by the delete
request was rewritten with a line filter, while the part that **was
covered** by the delete request was completely deleted.

The issue went unnoticed because it seems we continue to do query time
filtering of data even after the delete requests are processed.

**Which issue(s) this PR fixes**:
Fixes #7590 

**Special notes for your reviewer**:
If multiple delete requests with a line filter touch the same chunk,
then I am considering just the first request that marks it for deletion
to keep this PR simple. I have left a to-do to see if we can make it
work efficiently.

**Checklist**
- [x] Tests updated
- [x] `CHANGELOG.md` updated",95,55,1,1,"2018-04-16 10:25:39","1675.82"
"grafana/loki","fbcfad13dc26460881f81b09cf06bf1c35a415ab","sandeepsukhani","2020-01-13 16:02:42","false","fix panic in tailer when max tail duration exceeds (#1511)",100,21,0,1,"2018-04-16 10:25:39","632.48"
"grafana/loki","1bba2a89f895c2b0ecfd97899ccd5f8ccac0ac52","sandeepsukhani","2020-08-27 11:33:46","true","add some metrics for monitoring compactor (#2548)",127,28,0,1,"2018-04-16 10:25:39","861.55"
"grafana/loki","4e2812b9f3789e589d777707e5472c6f3fa960da","slim-bean","2021-11-04 23:55:42","true","no longer publish `latest` tag on every push to main (#4651)

publish `latest` tag when building tagged release",172,43,0,1,"2018-04-16 10:25:39","1294.31"
"grafana/loki","88120a0857af4e45e204185117d7a32bbca2478f","vlad-diachenko","2023-02-27 10:16:19","true","added missed binaries required to run `./tools/image-tag` script (#8640)

**What this PR does / why we need it**:

[This drone step](https://drone.grafana.net/grafana/loki/20764/21/3) had
to prepare a config for the `updater` to update loki helm chart with the
latest image version automatically. However, it failed due to an error:
```
+ RELEASE_TAG=$(./tools/image-tag)
env: can't execute 'bash': No such file or directory
```
I forgot to install `bash` and `git` before running this script inside
`alpine` container.",70,58,1,0,"2018-04-16 10:25:39","1771.99"
"grafana/loki","8133b34b23b4ffd1587c890bf3325c508f1e117b","xperimental","2023-09-14 17:16:16","true","operator: Update gateway arguments to enable namespace extraction (#10545)",41,65,1,1,"2018-04-16 10:25:39","1974.54"
"grafana/loki","3a8a5e54ddbb35dd24229297a10aa0c965c67800","chaudum","2023-09-18 15:31:24","true","Fix object store type for table manager (#10632)

**What this PR does / why we need it**:

This commit fixes a regression in the object store client creation introduced with #10518

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",40,65,1,1,"2018-04-16 10:25:39","1978.46"
"grafana/loki","654b543e4e05027f13f9822629ecce063b5f0b15","owen-d","2021-08-18 15:08:15","true","updates unordered writes config docs (#4131)

* updates unordered writes config docs

* removes experimental flag

* Apply suggestions from code review

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>",132,40,0,1,"2018-04-16 10:25:39","1217.95"
"grafana/loki","35b61e661c95b471b6421e6e6dfc3c72513866ee","owen-d","2020-07-16 15:03:03","true","Makes timestamp parsing docs clearer (#2360)",121,27,0,1,"2018-04-16 10:25:39","820.69"
"grafana/loki","2bfe626605b688de5e6b9ad8b8f01638ff9ba62b","owen-d","2022-10-03 16:01:51","true","reintroduce mmap for tsdb indices (#7321)

This reverts a [previous
decision](https://github.com/owen-d/loki/commit/b45efd4c2df0d54ed984a11777a5c24fc076a58c#diff-e3f5966d58063d2852aa51899b5aae14e65bb05f29fec7302eb982c3d18c60ab)
which removed `mmap` support when loading TSDB indices. I did this
primarily for simplicity, but since then have reneged on my original
choice for two reasons:
1) Retention in Loki is variable and can be very long. Requiring we keep
all loaded tsdb indices in memory creates a cost burden in terms of
memory required to hold all queried indices at once.
2) A high number of tenants also exacerbates the memory claims which
mmap helps alleviate.",92,53,1,1,"2018-04-16 10:25:39","1628.23"
"grafana/loki","4b750cc0ccbeccee2b6ddb52bcb3e54643cbb0e1","aschleck","2023-10-31 14:41:07","true","Storage: Allow setting a constant prefix for all created keys (#10096)

**What this PR does / why we need it**:

Adds a new option under the aws stanza named key_prefix. This is useful
if you have many Loki installations and do not want to create a million
buckets. This is different than `compactor.shared_store_key_prefix`
because it also affects eg the `loki_cluster_seed.json` file.

**Which issue(s) this PR fixes**:
Fixes #5889

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [x] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [x] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

---------

Signed-off-by: Edward Welch <edward.welch@grafana.com>
Co-authored-by: Ed Welch <edward.welch@grafana.com>",17,66,1,0,"2018-04-16 10:25:39","2021.43"
"grafana/loki","f1026a18d47c0cf4735b67f4423505dc1f4e33ab","blockloop","2021-04-15 14:43:58","true","center image on readme (#25)",162,36,0,0,"2018-04-16 10:25:39","1089.68"
"grafana/loki","f2a99ce3034c3ff407564010930c25fae8c9780f","tomwilkie","2018-05-16 14:54:24","false","Update vendor

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",0,1,0,0,"2018-04-16 10:25:39","30.19"
"grafana/loki","b46e392adbbb59f40fecd16c9ff925cb40456e0c","trevorwhitney","2023-03-13 22:02:09","true","gofmt is needed for the build (#8678)

**What this PR does / why we need it**:

`gofmt` is needed for the build, `make format` fails without it.",89,59,1,1,"2018-04-16 10:25:39","1788.48"
"grafana/loki","7b584b54f75fbc7267822c0d37a6ffa3ab24b79f","sandeepsukhani","2019-05-15 07:16:54","false","Limiting query start time with config (#572)

* Limiting query start time with config

* Fixed maxLookBackPeriod check, added it to existing configs, some other fixes

* gofmted file

* Changed maxLookBackPeriod to 4 weeks in helm chart

* Setting maxLookBackPeriod in helm chart to 0 and bumping up the helm chart version

* changed maxLookBackPeriod in yaml in cmd to 0 and some nit",100,13,0,1,"2018-04-16 10:25:39","394.12"
"grafana/loki","e6bf5487f59d46155b97b436099e94bd3567def1","davkal","2019-02-22 08:11:20","true","Merge pull request #218 from daixiang0/support-config

cmd/logcli: support load config from file",81,10,0,0,"2018-04-16 10:25:39","305.91"
"grafana/loki","b16e1bc73c0b68b6a1fe6d52f656818934694c4c","nicknezis","2019-03-07 19:32:26","false","Changed 'dockerRoot' to a more generic name",87,11,0,0,"2018-04-16 10:25:39","321.38"
"grafana/loki","9a7f5a22f623df6bfdec6d51c0e0dad989d00a70","cyriltovena","2022-01-06 13:55:25","true","Fix race conditions in frontend_scheduler_worker. (#5060)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",253,45,0,1,"2018-04-16 10:25:39","1355.9"
"grafana/loki","03a551cf63e58fdc16bea2d1e726475f8ffc2924","cyriltovena","2019-06-17 19:46:06","false","Improve helm default values for ingesters.",83,14,0,1,"2018-04-16 10:25:39","426.64"
"grafana/loki","44e1c88acabf35fb6505a874f66b8fa8064726c9","salvacorts","2023-08-29 11:48:49","true","Add changelog for non-indexed labels (#10379)

**What this PR does / why we need it**:

We recently implemented a new feature to support attaching and querying
non-indexed labels attached to each log line.
This PR updates the changelog with entries referencing the main PRs of
this feature.

---------

Co-authored-by: Sandeep Sukhani <sandeep.d.sukhani@gmail.com>",48,64,1,1,"2018-04-16 10:25:39","1959.31"
"grafana/loki","2af69cb57cfbe27529b5fbe1869a9198c5a11b51","cyriltovena","2020-02-10 18:32:32","true","Frontend & Querier query statistics instrumentation. (#1661)

* wip stats frontend

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* wip stats frontend

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* wip

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Updates cortex and add a record metric function.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add some tests in the mix

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Removes unused tests.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Replace global by an injected interface.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Adds a test to make sure the stats middleware update response statistics.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",113,22,0,1,"2018-04-16 10:25:39","659.59"
"grafana/loki","a9b9e22303f3e9ca85cde2e9ae9dd730847b5887","cyriltovena","2019-04-19 14:51:26","false","Plug the log entry pipeline into promtail

Co-authored-by: Edward Welch <edward.welch@grafana.com>",94,12,0,1,"2018-04-16 10:25:39","368.43"
"grafana/loki","58bf983518ea8eb7173b6ab36327c1cf3aac249f","cyriltovena","2021-05-17 12:51:57","true","Fixes doc w/r/t grpc compression. (#3551)

* Fixes doc w/r/t grpc compression.

Fixes #3537. Due to a change in upstream we didn't catch that breaking change in the config.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Update _index.md

* Update _index.md

* Update _index.md",195,37,0,1,"2018-04-16 10:25:39","1126.85"
"grafana/loki","fb76416b277bfe5b0f56e05cb74588a92bf4ec38","cyriltovena","2019-12-20 22:09:39","true","Add decompression tracing instrumentation. (#1445)

* Add decompression tracing instrumentation.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fix time conversion.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Use span logger so we also get a log line.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Improve reusability and add fetched chunks.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",98,20,0,1,"2018-04-16 10:25:39","609.74"
"grafana/loki","94fec51fb5b4fa225f7aec4c5c21592eb33050a1","periklis","2021-12-20 13:02:06","true","Fix operator images actions for bundle and calculator (#4973)",242,44,0,1,"2018-04-16 10:25:39","1339.86"
"grafana/loki","6bf782b0a784e0aeeb36c9e292532d631955f134","dannykopping","2023-02-28 10:31:19","true","Ruler: do not keep appending logger keys (#8650)

**What this PR does / why we need it**:
Corrects a logger which was accidentally appending keys in every loop
iteration, causing massive lines to be ingested",69,58,1,1,"2018-04-16 10:25:39","1773"
"grafana/loki","1dd6ca07c75ceeccaf5551c334effafeeb3a2cff","tomwilkie","2019-01-31 12:33:44","false","Prevent ks diffs.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",73,9,0,0,"2018-04-16 10:25:39","285.09"
"grafana/loki","c71a9b0dceb52e0bf8555ccd41747e57c3465d26","tomwilkie","2019-04-18 08:44:23","false","Fix logcli.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",96,12,0,0,"2018-04-16 10:25:39","367.18"
"grafana/loki","eeac68f1839927e2f2ffbb56e2909306764727d7","tomwilkie","2019-01-31 11:30:47","false","Log filename with parsing errors.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",73,9,0,0,"2018-04-16 10:25:39","285.05"
"grafana/loki","6f1d1d73b80fbeb85a0cca21d8c748a142bd1f82","rgroothuijsen","2023-04-25 09:51:08","true","operator: Replace deprecated MinIO environment variables (#9245)",80,60,1,0,"2018-04-16 10:25:39","1835.23"
"grafana/loki","04facc4d007c4087bb5e27f8238345e3a25557d1","slim-bean","2019-05-31 20:39:03","false","updating docs for new pipeline config.
removed helm entry in scrape_config.sh because there doesn't seem to be anyway to make it work with new pipeline config",109,13,0,1,"2018-04-16 10:25:39","410.68"
"grafana/loki","8a3c9c8e2ca3de68de60849550176343503cb429","oddlittlebird","2020-11-06 07:08:10","true","Update CODEOWNERS (#2888)",127,31,0,0,"2018-04-16 10:25:39","930.36"
"grafana/loki","b8118b1e7bed46ee81298c4e309707ec6d5c44ad","ssncferreira","2023-02-23 14:51:28","true","Helm enterprise-logs: update kubernetes secrets creation (#8467)

**What this PR does / why we need it**:

Fix the Kubernetes secrets creation for the tokengen and provisioner
jobs for multiple helm installations/uninstallations.

The execution flow for the helm installation is the following:
1) `tokengen` job `loki` container generates a new admin token, stores
it in the object storage and writes it to the `shared` mount.
2) `tokengen` job `create-secret` container creates a new Kubernetes
secret for the generated admin token.
3) `provisioner` job `provisioner` container creates the new admin
resources via the Admin API and writes the tokens to the `bootstrap`
mount.
4) `provisioner` job `create-secret` container creates new Kubernetes
secrets for each token of the additional tenants.

## Previous implementation 

Uninstall and re-install the enterprise-logs helm:
1) `tokengen` job `loki` container generates a new admin token, stores
it in the object storage, and writes it to the `shared` mount. This is
because this job uses an
[emptyDir](https://kubernetes.io/docs/concepts/storage/volumes/#emptydir)
mount which is deleted once the job completes. When a new job is
created, the directory will be again empty, forcing the `tokengen` to
generate a new token.
2) `tokengen` job `create-secret` container fails, because an admin
token secret already exists:
```
Defaulted container ""create-secret"" out of: create-secret, loki (init)
error: failed to create secret secrets ""enterprise-logs-admin-token"" already exists
```
3) The helm installation fails ❌ 

## Implementation in this PR

1) `tokengen` job `loki` container generates a new admin token, stores
it in the object storage, and writes it to the `shared` mount.
2) `tokengen` job `create-secret` container updates the previously
created Kubernetes secret for the admin token.
3) `provisioner` job `provisioner` container checks that the admin
resources already exist and doesn't write the token files to the
`bootstrap` mount.
4) `provisioner` job `create-secret` container checks that the token
files are not present on the `bootstrap` mount, and does not create new
secrets.
5) The helm installation succeeds ✅ 

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",64,58,1,0,"2018-04-16 10:25:39","1768.18"
"grafana/loki","0c08e3ee034946e234a1460e0334b82e32435f46","cyriltovena","2020-02-11 15:02:48","true","Add Owen to the maintainer team. (#1673)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",113,22,0,1,"2018-04-16 10:25:39","660.44"
"grafana/loki","6fcd02bad46083eed2665e413f6eee4e517b32bc","liguozhong","2021-10-25 18:27:46","true","[querier] s3: add getObject retry (#4453)

* [querier] s3: add getObject retry

* [querier] s3: add getObject retry

* [querier] s3: add getObject retry #4452

* [querier] s3: add getObject retry

* [querier] s3: add getObject retry #4453

* [querier] s3: add getObject retry

* [querier] s3: add getObject retry #4453

* [querier] s3: add getObject retry #4453

* [querier] s3: add getObject retry #4453

* [querier] s3: add getObject retry

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>",163,42,0,1,"2018-04-16 10:25:39","1285.08"
"grafana/loki","1ec4374e83ae16fa5629f33e73784704db3b0289","srstsavage","2020-01-17 19:37:22","false","Add `fluentd_thread` label when `flush_thread_count' > 1 (#1514)",104,21,0,0,"2018-04-16 10:25:39","636.63"
"grafana/loki","e9419747c93d9dd79848514c7329fa99116f92e3","periklis","2022-10-05 06:44:44","true","Fix internal server bootstrap for query frontend (#7328)

Adds a fix for setting up the internal server module",93,54,1,1,"2018-04-16 10:25:39","1629.85"
"grafana/loki","32daf71c7ef4f14bf6f09ca0ae89240ea5b5e0d7","stevendungan","2023-09-05 19:52:40","true","Update next.md (#10458)

clean up for 2.9 release

**What this PR does / why we need it**:

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",46,65,1,0,"2018-04-16 10:25:39","1965.64"
"grafana/loki","7c462caa6407771957035433f74c1a95233c60f1","simonswine","2022-04-22 17:07:43","true","Add buf to the build image (#5785)

This is part 1 of 2 PRs and updates the build image to version
0.10.4 and adding the buf utility which will later be used for
formatting *.proto files",168,48,0,0,"2018-04-16 10:25:39","1467.28"
"grafana/loki","d9327ecd0c508a42eb270843ae9e61aad62b55b6","corentinaltepe","2022-05-02 13:53:38","true","Added NLog-Targets-Loki as unofficial C# client to Loki (#6061)

Added a link to the HTTP C# client [NLog-Targets-Loki](https://github.com/corentinaltepe/nlog.loki) in Loki's clients documentation in the unofficial clients sections, right next to its Serilog counterpart.",74,49,0,0,"2018-04-16 10:25:39","1477.14"
"grafana/loki","459036f9f9bbb29fcae501bf2f0c2d53608ff3ea","hervenicol","2022-06-13 08:24:18","true","Loki Prometheus mixin: templatize cluster label (#6353)",70,50,0,0,"2018-04-16 10:25:39","1517.92"
"grafana/loki","e74eb549baafbb5fd58fe1e105b8527b7694594d","cyriltovena","2021-01-21 16:10:51","true","Reverts flush buffer pooling. (#3210)

Currently this requires more work, as the cache is asynchronously using the buffer when flushing chunks.

We still benefits from other improvements like computing the right size for a chunk.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",115,33,0,1,"2018-04-16 10:25:39","1005.74"
"grafana/loki","fcb4c763dce7b49ae341bbdd0f31306190c62af0","cyriltovena","2020-05-08 15:27:35","true","Fix a bug in range vector skipping data. (#2058)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",115,25,0,1,"2018-04-16 10:25:39","752.71"
"grafana/loki","7ed7e88173a7a03aad75f72605f0c1a46112d0e8","owen-d","2022-01-03 15:46:35","true","adds instrumentation to azure object client (#5022)

* adds instrumentation to azure object client

* Update pkg/storage/chunk/azure/blob_storage_client.go

nice catch!

Co-authored-by: Susana Ferreira <ssncferreira@gmail.com>

Co-authored-by: Susana Ferreira <ssncferreira@gmail.com>",254,44,0,1,"2018-04-16 10:25:39","1352.97"
"grafana/loki","7b70d3d9394dc17b74eb9baf939e36819cc79c17","julienduchesne","2022-08-01 13:22:51","true","deb and rpm packaging for all binaries (#6456)

* deb and rpm packaging for all binaries
There is currently deb and rpm packages being published for logcli amd64 but they aren't signed

In this PR:
- Add RPM and deb packages for `logcli`, `loki-canary` `loki` and `promtail` for arm, arm64 and amd64
- Sign them with the Grafana GPG key (packages.grafana.com/gpg.key). This will be the same key for all Grafana products
- Add CI steps to test the RPM and deb packages. This launches a docker image with systemd installed, then it installs both loki and promtail and does a `logcli` query on the Loki instance

* Remove specific version in test scripts

* Bump build image to 0.22.0

* Add restart policy for promtail's service",77,51,0,0,"2018-04-16 10:25:39","1566.12"
"grafana/loki","cd9d9c9b425e0ad11d5510deeb8fc2ff76c7a4aa","siavashs","2022-01-05 07:26:03","true","Support Redis Cluster Configuration Endpoint (#4947)

The go-redis options requires multiple redis addresses for a cluster.
In some scenarios like AWS ElastiCache, a single configuration endpoint
is used to resolve all cluster nodes.

This change adds an extra step to resolve all nodes and pass them to go-redis.
It remove the need to specify multiple cluster nodes in the configuration.

No tests were added for this scenario since it requires patching
the Go resolver during runtime.

Signed-off-by: Siavash Safi <siavash.safi@gmail.com>",252,45,0,0,"2018-04-16 10:25:39","1354.63"
"grafana/loki","8ff8b42899bc3165dd4c5f3ff3ba3f06aa90afce","wardbekker","2020-08-13 14:31:20","true","Added Sha3 as alternative (#2480)

* Added Sha3 as alternative

* Added crypto x dependency to modules.txt

* CI not picking up explicit module def

* CI not picking up explicit module def

* CI not picking up explicit module def

* add x/crypto/sha3/ to vendor dir

* Implemented review feedback

* doc fix

* Update docs/sources/clients/promtail/stages/replace.md

Co-authored-by: Ed Welch <ed@oqqer.com>

* Update docs/sources/clients/promtail/stages/template.md

Co-authored-by: Ed Welch <ed@oqqer.com>

Co-authored-by: Ed Welch <ed@oqqer.com>",119,28,0,0,"2018-04-16 10:25:39","847.67"
"grafana/loki","a1dce32d9a3f7c9f42d0036e6c557b9b57936dd7","jeschkies","2022-09-16 16:37:23","true","Abide to Mixin linting rules. (#7010)

Cloud integrations need to pass linting rules such as proper dashboard
names. It should be `Data Source` not `datasource`. See also
grafana/cloud-onboarding#2228",88,53,1,1,"2018-04-16 10:25:39","1611.26"
"grafana/loki","9dde2c4e5f9be43d432b4dd469828a0a3cccbdd9","slim-bean","2019-05-14 16:57:53","false","fixing how auth is applied",100,13,0,1,"2018-04-16 10:25:39","393.52"
"grafana/loki","c3af249fe0f77c43ef5a7cfa95225abf1790f278","sandeepsukhani","2021-06-04 06:56:12","true","add a dashboard for log deletion requests in loki (#3794)",209,38,0,1,"2018-04-16 10:25:39","1143.6"
"grafana/loki","954df433e98f659d006ced52b23151cb5eb2fdfa","darxriggs","2023-06-23 20:57:51","true","Promtail: Fix file descriptor leak (#8987)

This reduces the amount of open file descriptors per followed journal
file from 3 to 2. It also releases file descriptors for removed files
(journal vacuuming).

The `defaultJournalEntryFunc` is only called once upon startup. It
creates a `Journal` instance to only read a single entry to determine
the age of the entry referenced in the positions file. Right after, this
instance is not required anymore.

The actually used `Journal` instance used to follow the journal is
created inside `journalTargetWithReader`.",60,62,1,0,"2018-04-16 10:25:39","1893.69"
"grafana/loki","ff5f056f0313d113d252f414e4e49c29d3e7049d","lycheese","2023-02-07 22:04:17","true","Put instance_addr in proper place in loki-local-config (#6106) (#8364)

Co-authored-by: Travis Patterson <travis.patterson@grafana.com>",78,58,1,0,"2018-04-16 10:25:39","1752.49"
"grafana/loki","2aa3f92115032505838d5516a2678c0d775b7b21","periklis","2023-08-02 14:23:54","true","operator: Remove `v` prefix from openshift bundle version refs (#10134)",52,63,1,1,"2018-04-16 10:25:39","1932.42"
"grafana/loki","4c46a5fc7b328720e8d0cdee5c3b8ce128bdbc38","bradleypettit","2023-05-12 20:40:36","true","Correct Loki Helm monitoring config placeholders (#9451)

**What this PR does / why we need it**:
The remote write URL placeholders for metrics and logs are in the
incorrect positions in the config example.",73,61,1,0,"2018-04-16 10:25:39","1852.68"
"grafana/loki","65ec35a18b46e1d2916d8dc4773573815ea2189c","JoaoBraveCoding","2023-05-08 10:54:48","true","Add default TopologySpreadContraints to distributor (#9383)

Signed-off-by: Joao Marcal <jmarcal@redhat.com>",81,61,1,0,"2018-04-16 10:25:39","1848.27"
"grafana/loki","eba255c945345989876b1a3d446e7df84ae821fc","salvacorts","2023-04-24 11:43:49","true","Do not use IPv6 when getting addr from ring (#9255)

**What this PR does / why we need it**:
https://github.com/grafana/loki/pull/9184 changed the signature of
`ring.GetInstanceAddr`. That function is now used since
https://github.com/grafana/loki/pull/8067 which was not updated to use
the changed signature.

This PR fixes this by passing a new config flag `EnableIPv6` to the new
`enableInet6` argument of `ring.GetInstanceAddr`. Similar to how it's
done for the ruler:

https://github.com/grafana/loki/blob/3abd26097587779b461a8befef1af06700d0ae13/pkg/ruler/base/ruler_ring.go#L80

**Which issue(s) this PR fixes**:
Fixes `main`

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

[1]: https://grafana.com/docs/loki/latest/configuration/",80,60,1,1,"2018-04-16 10:25:39","1834.3"
"grafana/loki","b3c818e13215534b76028a234985153d1a9426d7","sandeepsukhani","2022-04-18 15:11:15","true","build generic index shipper to be shared between boltdb-shipper and tsdb-shipper (#5705)

* build generic index shipper to be shared between boltdb-shipper and tsdb-shipper

* changes suggested from pr review

* Update pkg/storage/stores/indexshipper/downloads/index_set.go

Co-authored-by: Cyril Tovena <cyril.tovena@gmail.com>

* update comments on trying to open corrupt files

* fix references broken due to storage refactoring

* lint

Co-authored-by: Cyril Tovena <cyril.tovena@gmail.com>",322,48,0,1,"2018-04-16 10:25:39","1463.2"
"grafana/loki","1407f0f43d69a32afe8015356866032c71fa817d","trevorwhitney","2022-09-09 16:59:05","true","Bump chart version to test release (#7124)

**What this PR does / why we need it**:

Bumps the helm chart version to trigger a release to test if that action
is fixed.",85,53,1,1,"2018-04-16 10:25:39","1604.27"
"grafana/loki","1fcefe8efaccc4175506d2a64f7d4dbe55a5e608","sandeepsukhani","2023-03-31 20:23:26","true","index-gateway: fix failure in initializing index gateway when boltdb-shipper is not being used (#8755)

**What this PR does / why we need it**:
When only `tsdb` index is being used in the schema without configuring
`boltdb-shipper` index store, we fail to initialize `index-gateway`
since it also tries to build `boltdb-shipper` index client. This
reference is used for serving `QueryIndex` calls which are for serving
index from boltdb files.

This PR fixes the issue by adding a check for the existence of
`boltdb-shipper` in the schema config before initializing an index
client. On the index gateway side, it adds a `failingIndexClient`, which
errors when someone tries to query it.

**Checklist**
- [ ] `CHANGELOG.md` updated

---------

Co-authored-by: Travis Patterson <masslessparticle@gmail.com>
Co-authored-by: Dylan Guedes <djmgguedes@gmail.com>
Co-authored-by: Travis Patterson <travis.patterson@grafana.com>",81,59,1,1,"2018-04-16 10:25:39","1806.42"
"grafana/loki","a4f218305d3575c639429359bdfc57c875608298","DylanGuedes","2022-01-05 14:33:21","true","Copy `cortex/pkg/frontend` package dependency into Loki (#5044)

* Move `cortex/pkg/frontend` to `loki/pkg/lokifrontend/frontend`.

* Update modules.txt with removed Cortex frontend.

* Use `pkg/lokifrontend` instead of cortex `pkg/frontend`.",252,45,0,1,"2018-04-16 10:25:39","1354.92"
"grafana/loki","6b6b33f9ebe1556086b884d7d0f18e9455416b43","owen-d","2020-08-19 01:26:24","true","adds batch based metrics (#2510)

* adds batch based metrics

* changing metric names a bit

Co-authored-by: Edward Welch <edward.welch@grafana.com>",115,28,0,1,"2018-04-16 10:25:39","853.13"
"grafana/loki","1bec8c301c04b4067a361549b9631a09930b55e4","owen-d","2021-03-22 08:30:00","true","fixes broken link (#3513)",142,35,0,1,"2018-04-16 10:25:39","1066.42"
"grafana/loki","443693fb7234886b753deb1e3ae7468d428d8297","trevorwhitney","2023-07-17 08:08:39","true","Add 3rd backend target to docker-compose stack (#9899)

* Adds 3rd backend target to `production/docker` stack
* Uses a anchor for the image to make local overrides easier
* Updates the config to use TSDB

@dannykopping you seem to be the SME here, mind taking a look?",59,63,1,1,"2018-04-16 10:25:39","1917.15"
"grafana/loki","c38ad3461d06f74ce3366e0341d9263c846b0d90","davkal","2019-04-17 13:45:03","true","Merge pull request #476 from steven-sheehy/loki-config

Helm: Allow custom loki config",103,12,0,0,"2018-04-16 10:25:39","366.39"
"grafana/loki","94a74400a3cf3f0a7e184933ba3dc4fc3b88c931","davkal","2019-03-18 15:37:23","true","Merge pull request #387 from belminf/master

Adds network policy to Helm chart for promtail to reach loki",102,11,0,0,"2018-04-16 10:25:39","332.22"
"grafana/loki","daacfd0b70d83147968ad99e006e2290e822d9ac","RangerCD","2022-02-24 09:41:35","true","Fix two remote_timeout configs in ingester_client block (#5418)

* Fix two remote_timeout configs in ingester_client block

* Add default value of remote_timeout in document",299,46,0,0,"2018-04-16 10:25:39","1403.72"
"grafana/loki","d6727398d042cc429232120a7127701278249a26","cyriltovena","2022-01-10 15:14:46","true","Removes split-by upstream validation (#5087)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",255,45,0,1,"2018-04-16 10:25:39","1359.95"
"grafana/loki","93a0b716d4efd96fb15a30362ecaa1cd0a70ec32","cyriltovena","2021-10-27 15:31:13","true","Refactor client configs in Promtail. (#4567)

This refactor a big how we mutate the original config for backward compatibility.
Also add tests on untested code path.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",166,42,0,1,"2018-04-16 10:25:39","1286.96"
"grafana/loki","91158abec19ecab87e2a2a486f439047c6a89cb7","cyriltovena","2020-06-19 21:37:38","true","Reuse slice for the range vector allocations. (#2219)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",143,26,0,1,"2018-04-16 10:25:39","793.97"
"grafana/loki","ebfeba5de3854136f53df68930c9beb1b1c77a88","dannykopping","2023-01-26 11:49:52","true","Ruler: implement rule-based and shuffle sharding (#8092)",80,57,1,1,"2018-04-16 10:25:39","1741.06"
"grafana/loki","b6f1088245349958c3857dde5129177fd4a8355e","monotek","2020-01-28 15:22:18","false","[loki helm chart] added ingress (#1585)

* added ingress template

Signed-off-by: André Bauer <andre.bauer@kiwigrid.com>

* raised loki-stack chart version to 0.29.0

Signed-off-by: André Bauer <andre.bauer@kiwigrid.com>",101,21,0,0,"2018-04-16 10:25:39","647.46"
"grafana/loki","b022f5eee3630092cdbad152c8721995a02894cd","jijotj","2023-01-06 03:46:40","true","[loki-canary] Fix changelog (#8052)

**What this PR does / why we need it**:
#8024 added an enhancement to loki-canary to pickup config from env
variables. However the change was wrongly added under loki instead of
loki-canary in the changelog. This PR fixes the changelog.

**Which issue(s) this PR fixes**:
NA

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the `CONTRIBUTING.md` guide
- [ ] Documentation added
- [ ] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",95,57,1,0,"2018-04-16 10:25:39","1720.72"
"grafana/loki","4e8cc8d719287d40ff740a213945c46347c46a3c","dannykopping","2023-01-27 07:22:03","true","LID: Remote Rule Evaluation (#8129)

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",83,57,1,1,"2018-04-16 10:25:39","1741.87"
"grafana/loki","f785faa8206c2690c0d8744ba057d15d689b5a0a","agologan","2023-06-23 20:54:59","true","Helm: add additionalRuleLabels to PrometheusRule alerts (#9020)

**What this PR does / why we need it**:

Adds the ability to specify other labels on the Prometheus alerts.
Specifying:
```yaml
monitoring:
  rules:
    additionalRuleLabels:
      custom_label: custom_value
```

will add it to all alerts:
```yaml
- alert: LokiRequestErrors
  annotations: ...
  expr: ...
  for: 15m
  labels:
    severity: critical
    custom_label: custom_value
```

This approach is inspired by:
[kube-prometheus-stack/rules](https://github.com/prometheus-community/helm-charts/blob/main/charts/kube-prometheus-stack/templates/prometheus/rules-1.14/general.rules.yaml)
Though in their case they run
[sync_prometheus_rules.py](https://github.com/prometheus-community/helm-charts/blob/main/charts/kube-prometheus-stack/hack/sync_prometheus_rules.py)
to create the `tpl`.

I can understand if this is not the approach (manual) you want to take
as editing the tpl adding the labels everywhere and escaping go tpl `{{
}}` is quite painful.

**Which issue(s) this PR fixes**:
N/A

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [x] Tests updated
- [ ] `CHANGELOG.md` updated
- [x] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",60,62,1,0,"2018-04-16 10:25:39","1893.69"
"grafana/loki","144bee11af8262be94c5a04bd94f3b2b9bc22178","cyriltovena","2022-01-17 09:38:56","true","Retry pulling Cloudflare logs after a stream error (#5158)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",265,45,0,1,"2018-04-16 10:25:39","1366.72"
"grafana/loki","7b01864a91c2c6daed3e545351fac619e5924fae","cyriltovena","2022-10-27 14:28:20","true","Improves performance of distributor validations (#7534)

Most of the time we don't need to create those strings which create an
alloc per entry.",89,54,1,1,"2018-04-16 10:25:39","1652.17"
"grafana/loki","d6ecfd24313ecc9ad03e26875cb11394de7e988a","cyriltovena","2021-03-16 07:58:17","true","Set the byte slice cap correctly when unsafely converting string. (#3487)

Fixes #3485

Should also unblock #3481

When unsafely converting string to bytes the cap of the bytes is lost but not when doing bytes to string.
It seems that this is only a problem when using go 1.16 or when using delve.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",157,35,0,1,"2018-04-16 10:25:39","1060.4"
"grafana/loki","7961ef6a4ec7a2fb5498d5c0bf3f2fb3f80777b1","salvacorts","2022-08-24 11:28:54","true","Evenly spread distributors across available nodes (#6964)

* Evenly spread distributors across available nodes

* Add note about reliability implications",81,52,0,1,"2018-04-16 10:25:39","1589.04"
"grafana/loki","f6468f16816f3d6028f6d9ce4bbe42d73888745f","sh0rez","2019-09-09 19:55:46","true","chore(packaging): simplify tagging (#989)

Simplifies tagging by removing conditionals and always publishing as `latest`
and for images also `master` on all builds (including tags).

Also fixes the tagging of the docker-driver, latest tag is back!",119,17,0,0,"2018-04-16 10:25:39","508.65"
"grafana/loki","52cd0a39b8266564352c61ab9b845ab597008770","ashwanthgoli","2023-04-25 10:04:13","true","compactor: multi-store support (#7447)

**What this PR does / why we need it**:
This PR adds multi-store support for compactors. Since loki allows users
to configure mutiple stores using schema_config, compactor should be
able to operate on multiple object stores that contain index. Currently,
it can perform compaction on indexes in a single store.

To maintain backward compatibility: if
`boltdb.shipper.compactor.shared-store` is set, compactor will only
operate on that store, else compactor will be initialized to operate on
all the object store indexes (`boltdb, tsdb`) defined in the schema
config.

This PR also adds a new config option to define where delete requests
are to be stored - `boltdb.shipper.compactor.delete-request-store`. If
it's not set, `boltdb.shipper.compactor.shared-store` is used for
storing them, this is to ensure no config changes are required by the
users when upgrading. Refer to
[docs/sources/upgrading/_index.md](https://github.com/grafana/loki/blob/a85d01c9cd3c62a62b29a20274b71d3c51f1d11a/docs/sources/upgrading/_index.md)
for more details.

**Which issue(s) this PR fixes:**
Fixes https://github.com/grafana/loki/issues/7276

**Checklist**
- [X] Reviewed the `CONTRIBUTING.md` guide
- [X] Documentation added
- [X] Tests updated
- [X] `CHANGELOG.md` updated
- [X] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

---------

Signed-off-by: Ashwanth Goli <iamashwanth@gmail.com>",79,60,1,0,"2018-04-16 10:25:39","1835.24"
"grafana/loki","c19a6c5bbc67676c78e6821b6b6b58e857367cba","jeschkies","2021-11-12 12:47:17","true","Join contain filters into one. (#4528)

* Join contain filters into one.

* Update pkg/logql/log/filter.go

Co-authored-by: Dylan Guedes <djmgguedes@gmail.com>

* Test Filter method.

* Test old and new filter consturctors.

* Remove comment.

* Define more benchmark cases.

* Take care of empty contain filters.

* Satisfy linter.

* USe different method to filter.

* Simplify all filter concat.

* Format code.

* Push regex filters to the end.

* Remove unused test.

* Add a few more tests.

* Make filters private again.

* Fix test failure.

* Only accumulate successive contain filters.

* Reverse accumulation.

* Satisfy linter.

* Remove old version.

Co-authored-by: Dylan Guedes <djmgguedes@gmail.com>",194,43,0,1,"2018-04-16 10:25:39","1301.85"
"grafana/loki","9ba5753e253dc60a751848c1fa6352c1d905187c","slim-bean","2020-11-25 13:32:24","true","Loki: handle faults when opening boltdb files (#2988)

* we also need to catch faults not just panics when opening boltdb files

* fix lint

* i'll get it one of these times

* fix typo",112,31,0,1,"2018-04-16 10:25:39","949.63"
"grafana/loki","5a570cb921545aa5aaff7532b2cad8799f151c33","trevorwhitney","2023-07-11 16:18:46","true","Query ingesters for SeriesVolume in single binary (#9888)

This change is necessary to get recent SeriesVolume data from the
ingesters when running without an `AsyncStore` in single binary.
It changes the queriers to query both the ingester and the store,
rather than relying on the `AsyncStore` to query the ingesters.",59,63,1,1,"2018-04-16 10:25:39","1911.5"
"grafana/loki","7c26cdf7385d762bbaaeab79b25f08d491dc315d","periklis","2023-01-30 17:39:44","true","operator: Update operand Loki to v2.7.2 (#8336)",82,57,1,1,"2018-04-16 10:25:39","1745.3"
"grafana/loki","e8d14157256918e623c1ebe232b8db7fb67b9284","chaudum","2021-12-15 14:01:23","true","Correctly use limits middleware in series query (#4929)

* Revert ""Skip middleware for unsupported type (#4924)""

This reverts commit 64999ffdf96000f7d5406dd4818ffdbf8c5626bc.

* Use correct middlewares in query range roundtrippers

This fixes a regression introduced with a47a76cdb5b50ae440b90e4140a28dfdaa8a715c
that caused 500 errors on label name queries.

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* Update query range tripper middleware tests

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",228,44,0,1,"2018-04-16 10:25:39","1334.9"
"grafana/loki","a01787af19a8839b0098d51c89c07d2c98eafd79","cyriltovena","2020-06-04 13:08:43","true","Update old link for pipeline stages. (#2172)

Fixes #2165",129,26,0,1,"2018-04-16 10:25:39","778.61"
"grafana/loki","fa51393bce1bcbacbddea00b4a03f85fb5d5f9b6","cyriltovena","2020-03-23 14:54:51","true","Move default port for Loki to 3100 everywhere. (#1838)

Also fixes default value for the table manager that doesn't support 0 anymore on master.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",122,23,0,1,"2018-04-16 10:25:39","702.44"
"grafana/loki","df1a8e3632e04fcfd48fbd3e0d5dc97a88178f6a","cyriltovena","2022-03-16 09:33:51","true","Remove unused code from cortex (#5633)

* Remove unused code from cortex

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes the build

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes flakky test

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* update vendor

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",304,47,0,1,"2018-04-16 10:25:39","1425.71"
"grafana/loki","69d9c9ab5d5aea84c6194e65eec51111dbe2a4da","tomwilkie","2018-04-17 11:30:59","false","Update build image for goyacc",0,0,0,0,"2018-04-16 10:25:39","1.05"
"grafana/loki","107dfd3607a634fea1fecf763e10b0e5fa6fb9c1","sandeepsukhani","2019-09-16 06:46:28","true","Use grpc client config from cortex for Ingester to get more control (#755)

* Use grpc client config from cortex for Ingester for more control over the connection

* moved ingester client config block at right place in production ksonnet",69,17,0,1,"2018-04-16 10:25:39","515.1"
"grafana/loki","f6d5ebf5136a291a89424e87e8f1d90d1416b0af","tomwilkie","2018-11-25 12:06:28","false","Document how to get promtail running locally.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",5,7,0,0,"2018-04-16 10:25:39","219.07"
"grafana/loki","a399cc1f4f82ead9295ecd11b416d6be6e33ce29","slim-bean","2019-09-16 15:10:45","false","updating the image version for loki-canary and adding the version increment to the release_prepare script",69,17,0,1,"2018-04-16 10:25:39","515.45"
"grafana/loki","f8e582a71682b4333299f76a46b750004f1c995b","slim-bean","2023-01-11 13:59:56","true","Promtail: Remove noisy error message when cleaning up filesystem watches which are already removed. (#8086)

**What this PR does / why we need it**:

Promtail will emit an error message when trying to remove filesystem
watches which do not exist, this PR squelches those error messages
thanks to some updates in the underlying fsnotify lib which allow
checking for this exact error.

**Which issue(s) this PR fixes**:
Fixes #3874 

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the `CONTRIBUTING.md` guide
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

Signed-off-by: Edward Welch <edward.welch@grafana.com>",100,57,1,1,"2018-04-16 10:25:39","1726.15"
"grafana/loki","f58ef7008b313938fadd0dc207957e46afed900b","jeschkies","2023-08-30 05:35:38","true","Remove `t2.4xlarger` from sizing tool. (#10347)

**What this PR does / why we need it**:
The sizing tool was listing an AWS EC2 instance that does not exsit.

**Which issue(s) this PR fixes**:
Fixes #10315

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",48,64,1,1,"2018-04-16 10:25:39","1960.05"
"grafana/loki","6c53113be1d7f7e4e691a59a5a6b4b7740dad0cb","trevorwhitney","2022-10-25 16:00:12","true","[helm] Add a loki canary test to the helm chart (#7229)

**What this PR does / why we need it**:

Add a helm chart test that utilizes the Loki canary to confirm the Loki
cluster is functioning correctly.

**Which issue(s) this PR fixes**:
Fixes #7228

Co-authored-by: Karsten Jeschkies <k@jeschkies.xyz>",90,54,1,1,"2018-04-16 10:25:39","1650.23"
"grafana/loki","5d8c48bd103ed911a0006a0bdaee5b5340abb791","DylanGuedes","2022-08-24 21:02:55","true","Loki: Implement stream sharding (#6952)

* introduce 'StreamSharder' interface to decouple sharding from managing shards

* make the streamsharder take a whole stream instead of just and ID

* Implement stream sharding usage.

* move streamShard to distributor

* Implement the stream sharder and shard iter (#6941)

* Modify sharding to not duplicate all entries for all shards (#6942)

* Modify sharding to not duplicate all entries for all shards.

* Rename ShardIter and get rid of NextShardId method.

* Get rid of ShardIter and ShardStats.

* Implement a StreamSharder mock and use it in tests.

* Rewrite stubbing and remove flags.

* Add auto-splitting.

* Only shard stream when approppriate.

* Make sharding mode an enum.

* Bench shardStream function.

* Modify shard comparison to be <= 1.

* Add a guard clause for when lowerbound>upperbound.

* Apply suggestions from code review

Avoid using `fmt.Sprintf`.

Co-authored-by: Danny Kopping <danny.kopping@grafana.com>

* Update pkg/distributor/distributor.go

Rename metric name.

Co-authored-by: Danny Kopping <danny.kopping@grafana.com>

* Avoid double-negative by Danny's suggestion.

* Move TODO to its right place.

* Log scenario where upperbound < lowerbound.

* Reuse compiled regex.

* Add docstring explaining why we use max(shards*2, 2).

* make sharder use a RWMutex

* simplify sharding config

* replace doc string

* Revert ""Add auto-splitting"" for standalone PR.

This reverts commit e3886a62106505753d7a1260ec61049150f95438.

* shard loop refactor

* move shard creation into it's own function

* fix after refactor

* make config more explicit and document it

* reduce allocations

* review feedback

Co-authored-by: Travis Patterson <travis.patterson@grafana.com>
Co-authored-by: Danny Kopping <danny.kopping@grafana.com>",81,52,0,1,"2018-04-16 10:25:39","1589.44"
"grafana/loki","4c0e01b93f2e6a360410eedc15538af530c71bbe","kavirajk","2023-06-15 20:04:22","true","revert(9476): Bringback async store like before for the queriers (#9715)

This seems to cause some issue with `querier`, not getting chunks from
ingesters correctly via `async_store`.

I narrowed down to this PR. But hard `revert` seems not possible
anymore. So created this manually.

https://github.com/grafana/loki/pull/9476

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",59,62,1,1,"2018-04-16 10:25:39","1885.65"
"grafana/loki","ac840413a41f15295f6a9bb53ff06eba9e88968e","fredr","2020-09-10 11:25:04","true","typo in operational dashboard (#2612)

seconds_seconds => seconds",117,29,0,0,"2018-04-16 10:25:39","874.54"
"grafana/loki","22d56524ad6d533a2311dcd6a14b21654ed6330e","dannykopping","2023-05-09 09:12:27","true","Log when memcached servers are updated (#9426)

**What this PR does / why we need it**:
Currently we do not have any insight when memcached clients update their
server list.

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",82,61,1,1,"2018-04-16 10:25:39","1849.2"
"grafana/loki","cb399523091c980141ea19d145c69ac60946644d","salvacorts","2023-10-20 14:04:13","true","Deprecated/Deleted Config Checker tool (#10977)

**What this PR does / why we need it**:

This PR adds a new _deprecated/deleted config checker_ tool to allow
users upgrading from previous Loki versions to check their Loki config
and runtime config for deprecated and deleted options, as well as
providing them with alternatives and reasons why those configs were
deprecated/deleted.

Mimir provides a [tool][1] that allows users to migrate their old
configs to new ones. Having that is our future goal but the new tool in
this PR is a good middle ground for the short-mid term.

We also update the checklist in the PR template to ask contributors to
update the tool source of truth if the contributor is deprecating or
deleting a config.

Here's an example for how to use the tool:
```bash
go run tools/deprecated-config-checker/main.go \
  -config.file tools/deprecated-config-checker/test-fixtures/config.yaml \
  -runtime-config.file tools/deprecated-config-checker/test-fixtures/runtime-config.yaml
```

And this is an example output:

![image](https://github.com/grafana/loki/assets/8354290/a86c0815-9875-4086-a267-9bbe06a6ee0e)

### Notes

I think I've gone through all the deprecated and deleted configs. I
cannot find the config pointed by the deprecated `ruler.storage`. It
states
```
ruler:
    ...
    # Deprecated: Use -ruler-storage. CLI flags and their respective YAML config
    # options instead. 
    storage:
          ...
```

I couldn't find that `-ruler-storage` cli flag nor the YAML definition.

[1]:
https://grafana.com/docs/mimir/latest/manage/tools/mimirtool/#convert",22,66,1,1,"2018-04-16 10:25:39","2010.4"
"grafana/loki","d70fc0e45f28a1d16c8e813525ee6cf5b21be41b","cyriltovena","2020-04-28 12:28:07","true","Improve URL building in the logcli to strip trailing /. (#2000)

Fixes #1985.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",116,24,0,1,"2018-04-16 10:25:39","742.59"
"grafana/loki","4733221fe331e21dbc6ef544bb5d0aaefbfd0a14","cyriltovena","2019-05-24 12:53:17","true","This add make target to deploy a dev version using helm (#586)

* add a dev target to deploy the current image in k8s

* impr/clients: Handle TLS config and MTLS for logcli and promtail (#540)

* impr/clients: Handle TLS config and MTLS for logcli and promtail

* fix/tls: Please gofmt...

* impr/clients: use prometheus HTTPClientConfig for logcli and promtail

* fix/promtail: Set proper Client config name

* impr/promtail: Use prometheus HTTPClientConfig configuration

* adapt with master

* address review

* fix conflicts

* address requested changes

* remove file

* add helm dev targets

* adding back assets

* fix review comments

* Review feedback",107,13,0,1,"2018-04-16 10:25:39","403.35"
"grafana/loki","51105f6f5b4d26f8f8a1dbaabf15b2f8a20adf78","tarokkk","2019-10-25 18:27:41","false","fluentd: Refactor label_keys and and add extract_kubernetes_labels configuration (#1186)

* refactor label_keys to labels and add kubernetes label extract

* fix escaping",69,18,0,0,"2018-04-16 10:25:39","554.58"
"grafana/loki","a5d56e23156a7d215db2f92012aa7909ce6e14d6","periklis","2023-09-14 17:04:15","true","operator: Update dashboards for Loki v2.9.0 (#10558)",41,65,1,1,"2018-04-16 10:25:39","1974.53"
"grafana/loki","bc71d81f66ad86cf802541051c03e5bf2e04aecf","Lucostus","2023-01-04 18:01:07","true","Docs: Removed unnecessary s3 value from example (#8017)

**What this PR does / why we need it**:
removes a confusing value field that isn't necessary. 
more clarity

closes #8036

**Checklist**
- [x] Reviewed the `CONTRIBUTING.md` guide
- [x] Documentation added
- [x] Tests updated
- [ ] `CHANGELOG.md` updated
- [x] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",98,56,1,0,"2018-04-16 10:25:39","1719.32"
"grafana/loki","905d14bee78c6596cd287b57f2f4310835a9b7ab","BlakeFernandez","2023-05-26 09:29:14","true","Add Prometheus Link for scrape_configs (#9270)

**What this PR does / why we need it**:
Adds some context to the scrape configs section in Promtail Config Docs
to ensure clarity around the connection to Prometheus
Here is a link to a slack thread where the customer was confused on
this:
https://raintank-corp.slack.com/archives/C04KY6NJSCE/p1681761335754199

---------

Co-authored-by: Michel Hollands <42814411+MichelHollands@users.noreply.github.com>
Co-authored-by: J Stickler <julie.stickler@grafana.com>",68,61,1,0,"2018-04-16 10:25:39","1866.21"
"grafana/loki","c41971b184e30334d473ef8240d36dd2516332f1","sandeepsukhani","2021-06-24 09:08:34","true","add index-gateway to reads and reads-resources dashboards (#3891)",107,38,0,1,"2018-04-16 10:25:39","1163.7"
"grafana/loki","4310ffe0bd053bc121d2be92207d862f877bcbe3","09jvilla","2022-09-19 14:43:11","true","Update README.md (#7191)

Fix typo on README",87,53,1,0,"2018-04-16 10:25:39","1614.18"
"grafana/loki","78a5de8f54116fe6d0cd16acd412f6ae613c2702","davkal","2019-04-17 13:36:07","true","Merge pull request #479 from jmvizcainoio/master

Added option that loki service run as nodeport",103,12,0,0,"2018-04-16 10:25:39","366.38"
"grafana/loki","9b67d6cb7a6ffacbd2f504598b5107319f071d1c","gouthamve","2018-12-19 10:34:10","false","Rename instance to tenant to avoid clash with Prom (#164)

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>",45,8,0,0,"2018-04-16 10:25:39","243.01"
"grafana/loki","ab5d490f9042ccdbf5e62a8d4e51ff62543063f4","MasslessParticle","2022-04-11 17:47:18","true","Fix flaky test (#5307)

- Ensure the registry is stopped before removing directories
- Fix possible panic when stopping registry
- Fix race conditions in registry state",322,48,0,1,"2018-04-16 10:25:39","1451.06"
"grafana/loki","2264b7331198a29c1022b0cba6f413309b734d5e","KMiller-Grafana","2022-05-03 17:01:47","true","Docs: remove Cortex references (#6079)

* Docs: remove Cortex references

* Bug fix: (after PR 6015) Cortex to Loki update",74,49,0,0,"2018-04-16 10:25:39","1478.28"
"grafana/loki","71677dbc8f358e67715fb54a6688e9f204353861","cyriltovena","2021-06-07 07:20:03","true","Retention doc (#3775)

* wip

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Finish docs.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Addresses Karen's feedback.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Update docs/sources/operations/storage/retention.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* Update docs/sources/operations/storage/retention.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* Update docs/sources/operations/storage/retention.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* Update docs/sources/operations/storage/retention.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>",201,38,0,1,"2018-04-16 10:25:39","1146.62"
"grafana/loki","89829065e7b0a95791d4249cd7840c45ed09f78e","salvacorts","2023-10-18 16:57:07","true","Use lazy bloom filter (#10896)

**What this PR does / why we need it**:

When querying bloom filters, use lazy decoders from
https://github.com/owen-d/BoomFilters/pull/1 so we don't make a copy of
bloom filters.",20,66,1,1,"2018-04-16 10:25:39","2008.52"
"grafana/loki","866a1266dbe4f688e556968e7c2e5211ad454c9d","tomwilkie","2019-03-26 14:40:36","true","Add Julien's blog post to the README. (#425)

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",91,11,0,0,"2018-04-16 10:25:39","340.18"
"grafana/loki","4d55a24ed3cbed399c189dafb8c4140cbffce21d","cstyan","2023-02-03 22:02:24","true","Upstream additional multi-zone ingester jsonnet  (#8360)

Signed-off-by: Callum Styan <callumstyan@gmail.com>",79,57,1,1,"2018-04-16 10:25:39","1748.48"
"grafana/loki","8580b8f8ad1c6ffac1017f2c25bc76701ac22805","DylanGuedes","2023-04-19 14:00:29","true","Distributor: Reuse `time.Now()` for better performance (#9192)

**What this PR does / why we need it**:
Modifies `AggregateByShard` to reuse `time.Now()` to improve performance.",77,60,1,1,"2018-04-16 10:25:39","1829.4"
"grafana/loki","c39cce74d18403759651cda7c6a93a4ed605b475","owen-d","2023-01-12 22:12:04","true","Go mod tidy (#8126)

Saw some errors on main -- this just cleans up go mod via `go mod tidy`",98,57,1,1,"2018-04-16 10:25:39","1727.49"
"grafana/loki","ca2132d7cbe6d14fe253f870208a45147aacb954","flokli","2022-01-27 08:42:18","true","Update _index.md (#5241)

We also fixes typo.",275,45,0,0,"2018-04-16 10:25:39","1376.68"
"grafana/loki","fb143fec02c6915888280a62595730e2a7777650","pstibrany","2019-12-15 09:17:58","false","Undo small change.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>",91,20,0,0,"2018-04-16 10:25:39","604.2"
"grafana/loki","baa264392bf9c0170931c67310c6aeba1cac7f4e","carlpett","2020-06-22 12:47:29","true","Set user agent on outgoing http requests (#2242)

Signed-off-by: Calle Pettersson <calle@cape.nu>",143,26,0,0,"2018-04-16 10:25:39","796.6"
"grafana/loki","5e34df8caf0ae1a9d17a27ca608434e270806c4d","cyriltovena","2020-04-29 19:52:54","true","Fix a bad rebase between #1970 and #1965. (#2011)

* Fix a bad rebase between #1970 and #1965.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* fmt

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",116,24,0,1,"2018-04-16 10:25:39","743.89"
"grafana/loki","d5688b5eb65ac558fc75f9922576be85a0233fd3","slim-bean","2019-07-10 19:41:53","false","adding a golang Template stage",101,15,0,1,"2018-04-16 10:25:39","449.64"
"grafana/loki","d3d63e17789483370b62c9278af422d0940e7e5c","DylanGuedes","2021-10-13 18:31:16","true","Loki: Override distributor's default ring KV store (#4440)

* Override default KV store for the compactor.

- Currently, the default KVstore is consul. This changes it to inmemory
to make it easier for new users to run the project without dependencies.
- Refactor default flag value tests. Now, it will check for a populated
map instead of checking for flags during iteration.

* Move distributor flag override to RegisterFlags.

* Add missing CHANGELOG and upgrading guide entries.",152,42,0,1,"2018-04-16 10:25:39","1273.09"
"grafana/loki","3f3d10afccae08f27234d8c8040ab2701397af38","cyriltovena","2021-07-26 13:14:53","true","Add min_sharding_lookback limits to the frontends (#4047)

* Add min_sharding_lookback limits to the frontends

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* improve doc.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* lint

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",103,39,0,1,"2018-04-16 10:25:39","1195.87"
"grafana/loki","a5b9a9a91c0564cbd9c4305183cdc4e913e38ac0","KMiller-Grafana","2022-05-02 06:45:42","true","Docs: Improve wording of getting started guide (#6060)

- Add the -d option to all docker-compose up commands
    - Make the wording consistent about the CWD",80,49,0,0,"2018-04-16 10:25:39","1476.85"
"grafana/loki","ccf9630c58cacbd60b0b049b6450e59b4a6a32ce","owen-d","2019-12-14 17:51:38","false","asserts encodings are nominally the same in chunks during roundtrips",93,20,0,1,"2018-04-16 10:25:39","603.56"
"grafana/loki","35003f3da094507cfff7321759e312d4e1baf452","trevorwhitney","2022-09-14 22:50:24","true","Fix minio values, reduce replicas, and fix tokengen job (#7147)

**What this PR does / why we need it**:

This PR fixes a few small things with the helm chart:

* After upgrading to the new minio chart, the subvalues for that chart
were not correctly changed to the new values for `rootUser` and
`rootPassword`
* The default replica count for the new minio chart is 16, which seems a
little much for our needs.
* The `grafana-token` created by the tokengen job was meant to be used
when configuring the GEL plugin, but it was not working, so I removed
it.",87,53,1,1,"2018-04-16 10:25:39","1609.52"
"grafana/loki","17b2ce0700d631a0e688e34adb68160ed06b0ffd","eraac","2019-12-05 23:30:51","false","documentation: iam requirement for autoscaling (#1350)",92,20,0,0,"2018-04-16 10:25:39","594.8"
"grafana/loki","f504de8013136ba8ec3954d21cea21fae5dce0ad","sh0rez","2019-08-02 18:09:19","true","chore(packaging): Release pipeline (#840)

This PR sets up an automated release pipeline to cross compile build artifacts and publish them to github. mitchellh/gox is used for building, ghr for publishing",106,15,0,0,"2018-04-16 10:25:39","471.57"
"grafana/loki","bbbbe2440f1039f61e00096abb32e6b48c52ed7d","ashwanthgoli","2023-06-22 09:53:22","true","changelog: moving unreleased changes to the main section (#9769)

**What this PR does / why we need it**:
noticed that a couple of unreleased changes are incorrectly showing
under 2.8.0 release, moving them to the right place.
also adds the missing changelog entry for #7447

**Checklist**
- [X] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

Signed-off-by: Ashwanth Goli <iamashwanth@gmail.com>",63,62,1,0,"2018-04-16 10:25:39","1892.23"
"grafana/loki","7d8fd39d9402395538e23ad03c781d0b334a6c49","yubozhao","2019-02-07 21:43:33","false","update aws doc base on Tom's suggestion",78,10,0,0,"2018-04-16 10:25:39","291.47"
"grafana/loki","6ce510dc5512ba52a35cfe63f2da856acd859e9c","DylanGuedes","2023-08-30 10:17:54","true","Storage: Introduce new ""ObjectExists"" API (#10360)

**What this PR does / why we need it**:
Introduce to our `Store` interface a new function named `ObjectExists`,
which can be used by external tools to validate if a given file is
present on an object store without downloading the file.

**Which issue(s) this PR fixes**:
N/A",46,64,1,1,"2018-04-16 10:25:39","1960.24"
"grafana/loki","287f29bc46e077f43cfa8778732bdcb43ed882a3","salvacorts","2023-08-14 13:39:10","true","Update chunk and head fmt to v4 (non-indexed labels) (#10242)

**What this PR does / why we need it**:

This PR updates the default chunk and heads format to v4 to support
writing and reading non-indexed labels.

---------

Co-authored-by: Sandeep Sukhani <sandeep.d.sukhani@gmail.com>",53,64,1,1,"2018-04-16 10:25:39","1944.38"
"grafana/loki","2a2d1f9178564ef2a6a94592431206b566ba6b26","ammarlakis","2023-01-04 19:45:51","true","Docs: Fix promtail installation doc (#8007)

**What this PR does / why we need it**:
Fix promtail installation command using helm in the docs.

**Which issue(s) this PR fixes**:
None

**Special notes for your reviewer**:
None

**Checklist**
- [X] Reviewed the `CONTRIBUTING.md` guide
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

Signed-off-by: Ammar Lakis <ammar.lakis@gmail.com>",96,56,1,0,"2018-04-16 10:25:39","1719.39"
"grafana/loki","a08a7324f47f5e490003bfb4dc2a47593fffbcf4","adityacs","2023-01-04 17:27:25","true","fix(logql): fix caseinsensitive search in filter (#8037)

**What this PR does / why we need it**:
Fix caseinsensitive search in filter

**Which issue(s) this PR fixes**:
Fixes #7904 #7837

**Checklist**
- [x] Reviewed the `CONTRIBUTING.md` guide
- [ ] Documentation added
- [x] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",99,56,1,1,"2018-04-16 10:25:39","1719.29"
"grafana/loki","8fe386fbb3787ad6534208ed687af68715dd95b3","mar4uk","2022-12-14 13:41:51","true","Move to fork github.com/grafana/tail (#7931)",101,56,1,0,"2018-04-16 10:25:39","1699.14"
"grafana/loki","abcf4d083f8ab7358754ee7cb111861d5c91a3ee","owen-d","2021-08-24 14:54:12","true","WAL replay discard metrics (#4212)

* adds replay discard metrics

* lint",126,40,0,1,"2018-04-16 10:25:39","1223.94"
"grafana/loki","790ba403b193eade4daa311db9b370b9dd2389cd","slim-bean","2020-01-24 20:24:21","false","Add another sleep to the canary reconnects this time if connection succeeds but there is an error receiving the stream. (#1581)

Signed-off-by: Edward Welch <edward.welch@grafana.com>",98,21,0,1,"2018-04-16 10:25:39","643.67"
"grafana/loki","90d5d24998e44e9c0bdb0517a9d518f29b72a75b","slim-bean","2021-11-08 00:09:08","true","Project: Loki 2.4.1 release notes (#4688)

* add 2.4.1 bug fixes

* update changelog",178,43,0,1,"2018-04-16 10:25:39","1297.32"
"grafana/loki","3d5a3936d168e388e5806e95336069c401523a34","jeschkies","2022-03-17 16:58:50","true","Support limits in multi-tenant queries. (#5626)

**What this PR does / why we need it**:
This changes adds support for the the following limits in multi-tenant queries:
- `MaxQuerySeries`
- `QuerySplitDuration`
- `MaxEntriesLimitPerQuery`
- `MinShardingLookback`
- `MaxQueryLength`
- `MaxQueryParallelism`
- `MaxQueriersPerUser`
- `MaxCacheFreshness`


It always uses the more restricted limit. That means the smallest `MaxQuerySeries` but biggest `QuerySplitDuration`. The split duration is special. Zero means disabled.

Also, the global default resolver is the multi tenant resolver when multi-tenant queries are enabled. This will result HTTP 400 errors in case the user sends multiple tenants to endpoints that do not support it.

**Which issue(s) this PR fixes**:

**Special notes for your reviewer**:

**Checklist**
- [ ] Documentation added
- [x] Tests updated
- [x] Add an entry in the `CHANGELOG.md` about the changes.

Co-authored-by: JordanRushing <rushing.jordan@gmail.com>",308,47,0,1,"2018-04-16 10:25:39","1427.02"
"grafana/loki","9f301cf87d39bc6876448441854ec75d70f5a3d6","sandeepsukhani","2022-02-24 09:19:56","true","use the defined querypages callback in all the types implementing QueryPages function from IndexClient interface (#5463)",300,46,0,1,"2018-04-16 10:25:39","1403.7"
"grafana/loki","12538b0d9e97dd8c394c2856b2d4315871540a1a","slim-bean","2019-11-20 04:41:46","true","simplify the release page and instructions on installing and working with binaries to remove our opinionated installation path. (#1290)",74,19,0,1,"2018-04-16 10:25:39","579.01"
"grafana/loki","b5f0557e79daa39d431afa148c8f5bf0387cd389","slim-bean","2022-06-01 15:35:23","true","fix boltdb shipper local query in logcli and support `fake` tenant (#6282)

Signed-off-by: Edward Welch <edward.welch@grafana.com>",72,49,0,1,"2018-04-16 10:25:39","1506.22"
"grafana/loki","03e9059ecb29f39b05dbba9cf278b2c95e64a612","slim-bean","2020-07-30 21:44:47","true","Loki: Improve error messages on query timeout or cancel (#2453)

* Instead of returning ""context deadline exceeded"" on timeout and ""context cancelled"" when the query is cancelled, return a more descriptive error message.

* fixing tests",126,27,0,1,"2018-04-16 10:25:39","834.97"
"grafana/loki","d7345c1c4c81dc483f33dd423e7ff57adb2cd67a","slim-bean","2022-07-18 19:05:05","true","Loki: Do not store exact log line duplicates (now including unordered inserts) (#6642)

* do not insert log lines which are an exact duplicate in both timestamp and log content

Signed-off-by: Edward Welch <edward.welch@grafana.com>

* update test to now ignore dupes pushed out of order

Signed-off-by: Edward Welch <edward.welch@grafana.com>

* make the test unordered to be more thorough

Signed-off-by: Edward Welch <edward.welch@grafana.com>",69,51,0,1,"2018-04-16 10:25:39","1553.36"
"grafana/loki","bd63f371ecb0ffd3cbefd521dd507b2fd22f2fc3","vlad-diachenko","2023-09-25 11:20:09","true","Update structured-metadata docs (#10698)

OSS users tried to use the structured metadata feature and faced an
issue because they used previous schema versions (V11, V12) and they
were not aware that it was necessary to use V13 because the docs did not
cover it.

re: https://github.com/grafana/loki/issues/10683",34,65,1,0,"2018-04-16 10:25:39","1985.29"
"grafana/loki","2afebbc064ff8b156964661790f05f15cb9f4980","MichelHollands","2021-01-26 10:05:37","true","Add config endpoint (#3228)

* Add config route

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Add documentation

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",121,33,0,1,"2018-04-16 10:25:39","1010.49"
"grafana/loki","3d579fb3291db58491a1e32a78e7ea8e3f2e4d0a","kavirajk","2022-04-18 15:28:56","true","chore: Fix flaky test with `TestSingleIdx`. (#5947)",296,48,0,1,"2018-04-16 10:25:39","1463.21"
"grafana/loki","4f62f36af73eaa9717f6ae57537007e14b4a3ed3","MichelHollands","2021-01-07 08:43:56","true","Update cortex to 1 6 (#3131)

* Update Cortex to recent master (1.5.0+, 35e698bb56d6).

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Ignore set scheduler address.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Make linter happy.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Upgrade cortex to 1.6

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Work around issues in go-openapi libraries

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Clean up go.mod and go.sum

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

Co-authored-by: Peter Štibraný <peter.stibrany@grafana.com>",116,33,0,1,"2018-04-16 10:25:39","991.43"
"grafana/loki","5f380872b407fe90f5b1c09be0d5363a64d1712a","DoomAndLove","2023-07-10 06:16:38","true","helm: fix formatting in CHANGELOG.md (#9891)

**What this PR does / why we need it**:
Fix the formatting for 5.8.6 in the changelog, which was bugging me too
much. I have no idea why my change did anything

**Which issue(s) this PR fixes**:
N/A

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",57,63,1,0,"2018-04-16 10:25:39","1910.08"
"grafana/loki","ff47d7419a889ac94e43c08c534a58f9d448bf8e","sandeepsukhani","2022-01-07 07:31:25","true","compactor changes for building per user index files in boltdb shipper (#5026)

* compactor changes for building per user index files in boltdb shipper

* update comments

* lint and changes suggested from PR review

* fix broken code after merging main",252,45,0,1,"2018-04-16 10:25:39","1356.63"
"grafana/loki","f4967c46dadc69ed3a7e47b7429eaa65c66011f0","agologan","2022-09-21 16:05:52","true","Helm: expose Prometheus-compatible endpoints in gateway (#7195)

**What this PR does / why we need it**:

The gateway in non-enterprise mode doesn't expose Prometheus endpoint
for alerts/rules so Grafana fails to query and display them in alerting
section.

**Note**: When comparing **nginxConfig** enterprise vs non-enterprise
there are a couple of other endpoints which are missing from the gateway
config.",84,53,1,0,"2018-04-16 10:25:39","1616.24"
"grafana/loki","40ae03b48a4bba0c79f804cbe5ac82bcc0679344","tomwilkie","2019-02-11 12:05:11","true","Include the stream's labels in OOO error responses. (#304)

* Include the stream's labels in OOO error responses.

Also, read the body of error responses and log them.  And retries 500s and connection errors.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>

* Log close errors.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>

* Update pkg/promtail/client/client.go

Co-Authored-By: tomwilkie <tomwilkie@users.noreply.github.com>

* Log retries at warn, final errors at error.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",79,10,0,0,"2018-04-16 10:25:39","295.07"
"grafana/loki","75ec3f33864ce98df1b89b0973cc67479d7486bc","alanconway","2023-03-31 15:47:52","true","Redefine 1x.extra-small to have 0 requirements. (#8977)

Remove resource requirements so lokistack can run on laptop-sized SNO or
CRC clusters.
Originally I thought to add an even smaller size, but I see that
1x.extra-small is already documented as not-for-production, so it seems
appropriate.

Doc comment:

// SizeOneXExtraSmall defines the size of a single Loki deployment
// with NO resource requirements and without HA support.
//
// This is ONLY for development, testing, or demos
// on limited single-node clusters.
// There are NO performance guarantees.
// LokiStack will use whatever resources are available,
// and WILL NOT FUNCTION CORRECTLY if there is not enough memory or CPU.
//
// DO NOT USE THIS IN PRODUCTION!",81,59,1,0,"2018-04-16 10:25:39","1806.22"
"grafana/loki","551b1530da643edb42a2f9c255524dc145dc8fb7","KMiller-Grafana","2021-06-21 22:51:28","true","Docs: remove duplicated arch info from the overview section (#3873)

* Docs: remove duplicated arch info from the overview section

* Update docs/sources/architecture/_index.md

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>

* Update docs/sources/architecture/distributor.md

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>",102,38,0,0,"2018-04-16 10:25:39","1161.27"
"grafana/loki","a6c7ecc2fa118604f7cad3e13a5f8c8bd6a9bfa1","cyriltovena","2021-09-10 08:11:05","true","Fixes the pattern parser validation. (#4308)

We should never have 2 consecutive capture, since when we do we can't figure which data goes where.
The previous validation was validating two nodes at the time and moving to the next two nodes so in the end it wasn't validating properly.

:facepalm:

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",131,41,0,1,"2018-04-16 10:25:39","1239.66"
"grafana/loki","7b085e1eadc21834b122775a3960267daaeafd5b","cyriltovena","2019-04-19 17:34:51","false","Polish json entry stage",94,12,0,1,"2018-04-16 10:25:39","368.55"
"grafana/loki","554a7413d3e6a9884a840c15686b95a0ce1468b0","3Xpl0it3r","2021-05-05 12:58:57","true","fix the promtail-default-config download link in doc (#3647)",184,37,0,0,"2018-04-16 10:25:39","1114.86"
"grafana/loki","048587f1a6e9e74a889292305b7eac326ffee4ed","ashwanthgoli","2023-10-16 13:55:50","true","ksonnet: remove usage of already deleted config match_max_concurrent (#10910)

**What this PR does / why we need it**:
remove the usage of already deleted config match_max_concurrent from
loki ksonnet

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",24,66,1,0,"2018-04-16 10:25:39","2006.4"
"grafana/loki","784c4ce2325250f31ab75874bbfc601dc685bbbd","rfratto","2020-02-05 18:26:53","true","ci: print error when getting tags fails (#1640)

This commit also removes fatal logs. The pruning process isn't essential
and should generally never cause the CI to report failure.",109,22,0,1,"2018-04-16 10:25:39","654.58"
"grafana/loki","e0ec61f9860e4df5cc77b02ef0620a5fed8ce389","pstibrany","2019-12-05 17:57:44","false","pkg/ingester: handle labels mapping to the same fast fingerprint. (#1247)

* pkg/ingester: handle labels mapping to the same fast fingerprint.

Uses slightly adapted fpMapper code from Cortex.

Fixes issue #898

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* empty commit to force new build

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Removed empty lines in imports.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Added test that pushes entries concurrently.

To be run with -race.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Stream now keeps both original and mapped fingerprint

Mapped fingerprint is used in streams map.
Original (""rawFP"") is preserved when saving chunks.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Vendoring

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Reverted previous commit (keep the test, with updated checks).

Preserving raw fingerprints could lead to data loss when
doing chunk deduplication while storing chunks. We don't want
that.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* go mod vendor

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>",92,20,0,0,"2018-04-16 10:25:39","594.56"
"grafana/loki","bfe558c67c96bc81c8c8be83822ae893c462135c","grafanabot","2023-09-08 15:22:29","true","[CI/CD] Update yaml file `./production/helm/loki/values.yaml` (+1 other) (#10517)

**Here is a summary of the updates contained in this PR:**
***
Update attribute `$.enterprise.version` in yaml file
`./production/helm/loki/values.yaml` to the following value: `v1.8.0`
***
Bump version of Helm Chart
Add changelog entry to `./production/helm/loki/CHANGELOG.md`
Re-generate docs

Co-authored-by: Kaviraj Kanagaraj <kavirajkanagaraj@gmail.com>",42,65,1,0,"2018-04-16 10:25:39","1968.46"
"grafana/loki","ba8c87373399d4ed48cf037fb360f38304a1c4de","Red-GV","2022-04-19 11:37:45","true","operator: Bump operator-sdk to v1.19.1 (#5929)",173,48,0,1,"2018-04-16 10:25:39","1464.05"
"grafana/loki","aaa476368475303eb04d4ecff3e76332cd9b567c","granular-ryanbonham","2019-03-25 19:01:06","false","Fix security context remove fsGroup",92,11,0,0,"2018-04-16 10:25:39","339.36"
"grafana/loki","b7f18a57db5986c37286ac531c4a64f188edd547","tomwilkie","2018-06-05 12:10:05","false","Include image tag with names

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",1,2,0,0,"2018-04-16 10:25:39","49.07"
"grafana/loki","314fe78f99393de06109256f5315c1dac5e83065","jtlisi","2019-06-18 13:08:31","true","Merge pull request #676 from grafana/fix-gateway-metrics

updating the loki dashboards to use the metrics from the new gateway",85,14,0,0,"2018-04-16 10:25:39","427.36"
"grafana/loki","3ae6fecbfc04e5680fb64741d2052547a9745b72","adamjohnson01","2019-11-30 18:02:32","false","feat(loki): support IAM roles for EKS (#1340)

* pull in cortex changes to support IAM roles for EKS
* update go.sum after running tidy

Signed-off-by: Adam Johnson <a.johnson@winton.com>",89,19,0,0,"2018-04-16 10:25:39","589.57"
"grafana/loki","481906c4254880c2480e85f609cf51705d78202a","sandeepsukhani","2019-08-22 07:38:08","false","fix incrementing of bigtable_backup_job_backups_created metric (#930)",117,16,0,1,"2018-04-16 10:25:39","491.13"
"grafana/loki","989fb106a044922cb380750e805a93ae142d2646","sandeepsukhani","2020-04-29 09:57:27","true","table client for boltdb shipper to enforce retention (#2001)

* table client for boltdb shipper to enforce retention",117,24,0,1,"2018-04-16 10:25:39","743.48"
"grafana/loki","7a7eeb0d639c0b60ba0ca4c8f824991b7dade5f0","sandeepsukhani","2021-07-02 10:12:51","true","skip applying retention when data in table is still within retention period and there are no overlapping delete requests (#3934)",116,38,0,1,"2018-04-16 10:25:39","1171.74"
"grafana/loki","c4faa579e33b33afa2c15bca72796d000e6b79fb","cyriltovena","2020-12-02 19:56:59","true","Asynchronous Promtail stages (#2996)

* Introducing go pipelines to promtail.

Based off @jeschkies  idea.

WIP

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes all tests.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* More tests and code cleanup.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Wip breaking things.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixing tests, adding Stop to the interface.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes all tests.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes more test.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Moar fixes for tests.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Close correctly client before reading.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Use defer.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add some comments.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes lint issues

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Attempt to fix journald without linux.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes journald json test.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add missing stop in the filetarget.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Update pkg/logentry/stages/match_test.go

Co-authored-by: Karsten Jeschkies <k@jeschkies.xyz>

* First set of feeback review fixes.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Use newEntry as suggested by Karsten.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fix tests.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* lint.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

Co-authored-by: Karsten Jeschkies <k@jeschkies.xyz>",125,31,0,1,"2018-04-16 10:25:39","956.9"
"grafana/loki","019ac9975c878ddf9d13fe778e270b932b903556","bboreham","2023-02-23 19:51:54","true","Iterators: re-implement entrySortIterator using loserTree for performance (#8351)

**What this PR does / why we need it**:

[Draft PR for comment at this time]

This implementation uses a data structure called Loser Tree, also known
as Tournament Tree, based on Knuth, ""Sorting and Searching"" section
5.4.1.

I couldn't find an existing Loser Tree in Go, so I wrote my own; the
file is 132 lines long. It uses generics in the hope it can also be
applied elsewhere.

One benchmark result: 
```
name                 old time/op    new time/op    delta
SortIterator/sort-4    3.78ms ± 4%    2.66ms ± 3%  -29.54%  (p=0.008 n=5+5)

name                 old alloc/op   new alloc/op   delta
SortIterator/sort-4     319kB ± 0%      14kB ± 0%  -95.52%  (p=0.008 n=5+5)

name                 old allocs/op  new allocs/op  delta
SortIterator/sort-4       104 ± 0%         5 ± 0%  -95.19%  (p=0.008 n=5+5)
```

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- NA Documentation added
- [x] Tests updated
- [ ] `CHANGELOG.md` updated
- NA Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",63,58,1,0,"2018-04-16 10:25:39","1768.39"
"grafana/loki","2182b306f4d7541c5a780c228e4605dcc78b7d29","cristiangreco","2023-02-07 21:54:15","true","Usage stats reporter: fix to remove duplicate if block (#8392)

Co-authored-by: Christian Haudum <christian.haudum@gmail.com>",78,58,1,0,"2018-04-16 10:25:39","1752.48"
"grafana/loki","710eb78e3f180655d5a6c272f9203def63cdfd19","Gnitry","2019-10-29 12:22:00","false","fluent-plugin-grafana-loki: Fixes the issue when sorting entries with the same timestamps (#950)

* Fixes the issue when sorting entries with the same timestamps

* bump gem version

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>
Co-authored-by: Cyril Tovena <cyril.tovena@gmail.com>",69,18,0,0,"2018-04-16 10:25:39","558.33"
"grafana/loki","380cabaf8cffc3728db3b28a1ef9854bbc1aa69a","MrWong99","2023-01-11 13:28:18","true","Fixed typo in Helm values docs (#8075)",101,57,1,0,"2018-04-16 10:25:39","1726.13"
"grafana/loki","7db7a963782827115fe263618a1a3f54863a7e40","dannykopping","2023-09-28 18:41:22","true","Update getting-in-touch.md (#10742)

**What this PR does / why we need it**:
Users don't strictly ""deploy"" Loki via our Cloud, they use a deployed
instance",29,65,1,1,"2018-04-16 10:25:39","1988.59"
"grafana/loki","40e47bdd2ef0ff767744ffc7517c24d912a13767","wardbekker","2020-03-26 16:59:27","true","throw exceptions on HTTPTooManyRequests and HTTPServerError so FluentD will retry (#1845)

* throw exceptions on HTTPTooManyRequests and HTTPServerError to trigger retry

* fixed variable naming

* Update fluentd/fluent-plugin-grafana-loki/spec/gems/fluent/plugin/loki_output_spec.rb

spelling fix

Co-Authored-By: Cyril Tovena <cyril.tovena@gmail.com>

* removed newline

Co-authored-by: Cyril Tovena <cyril.tovena@gmail.com>

(cherry picked from commit 7413f11d29da94e9eb0bb8ac6257ed985f494548)
Signed-off-by: Edward Welch <edward.welch@grafana.com>",120,23,0,0,"2018-04-16 10:25:39","705.52"
"grafana/loki","b9301045cb6e93ad959de053f0c2cec1cfe4dbbe","slim-bean","2022-07-04 18:09:23","true","introduce randomness to the first call for the metric test query to reduce the likelyhood that large numbers of canaries will all make this request at the same time. (#6562)

Signed-off-by: Edward Welch <edward.welch@grafana.com>",72,51,0,1,"2018-04-16 10:25:39","1539.32"
"grafana/loki","f019e573fa027c3da66220f375d8a9fedff568be","davkal","2019-04-01 12:52:42","true","Merge pull request #422 from daixiang0/add-health

Add health check",96,11,0,0,"2018-04-16 10:25:39","345.1"
"grafana/loki","08f267e68ee6f67902eb6672c1a270e746e9e146","tomwilkie","2018-05-29 18:31:04","true","Merge pull request #11 from grafana/tests

Add some unit tests for the iterators.",1,1,0,0,"2018-04-16 10:25:39","43.34"
"grafana/loki","9cb78bdad826991bc49d4aed983e92bbc906a53d","cyriltovena","2022-04-29 16:48:53","true","Improve index entries deduping and concurrency (#6055)",93,48,0,1,"2018-04-16 10:25:39","1474.27"
"grafana/loki","5d51e5a54f42dc9dc920bd05d5d01ce144940a9b","cyriltovena","2022-04-29 14:51:59","true","Improve batching in boltdb index (#6044)

* Improve batching in boltdb index

* review feedback",93,48,0,1,"2018-04-16 10:25:39","1474.18"
"grafana/loki","fa00b901286f4b101e18ca6e6ae4466ba8f934ec","cyriltovena","2020-10-26 12:43:35","true","Fix error swallowed in the frontend. (#2807)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",118,30,0,1,"2018-04-16 10:25:39","920.6"
"grafana/loki","1efeace6441b36c64d71dd9ebee39563ec6edd79","cyriltovena","2021-08-03 14:07:17","true","Fixes instant queries in the frontend. (#4091)

* Fixes instant queries in the frontend.

This is a set of fixes for instant queries:
- correctly propagate statistics.
- correctly convert sampleStream to vector.
- correctly marshal to json.
- correctly encode the time for the request.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes tests.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",103,40,0,1,"2018-04-16 10:25:39","1202.9"
"grafana/loki","9be3c0863e28ade5c060fa09c5efc8e397da2f19","salvacorts","2023-10-31 13:01:01","true","Support categorized labels in Tailing (#11079)

**What this PR does / why we need it**:

This is a follow-up PR for https://github.com/grafana/loki/pull/10419
adding support for tailing.

I tested it on a dev cell and works fine.
<img width=""1296"" alt=""image""
src=""https://github.com/grafana/loki/assets/8354290/6177e0ca-02ce-48cd-a17f-0739dc3caa0a"">


**Note**: With these changes, the JSON marshal unmarshal functions for
the tail are no longer used ([example][1]) so I think we can remove
them. Also, the new Tail response is no longer used, so we can also make
it an alias to the _legacy_ one. Let's do it on a follow-up PR to avoid
making this one bigger.

[1]:
https://github.com/grafana/loki/blob/52a3f16039dd5ff655fc3681257d99794f620ec4/pkg/loghttp/entry.go#L210-L238",17,66,1,1,"2018-04-16 10:25:39","2021.36"
"grafana/loki","662ef3272adb7578855fc2b463bfd158a10a201c","candlerb","2019-07-15 12:29:17","false","fluentd-plugin-grafana-loki: change log.info to log.debug (#751)

Reduces background chatter which in turn can trigger more log writes

Signed-off-by: Brian Candler <b.candler@pobox.com>",101,15,0,0,"2018-04-16 10:25:39","454.34"
"grafana/loki","c477e29c3f517bf7d6b8344a289cc2c09d4852d8","trevorwhitney","2022-02-03 13:50:41","true","Add tooling for local k3d clusters under tools/dev (#5272)

* add k3d folder with loki-distributed env

* add readme

* shellcheck create_cluster.sh

* lint jsonnet

* Update grafana image to latest",276,45,0,1,"2018-04-16 10:25:39","1382.89"
"grafana/loki","9130c1a40d47e7e95171ef4f81a62af651d28a8d","DylanGuedes","2023-08-01 20:27:40","true","Include stream name on error message (#10131)

**What this PR does / why we need it**:
Modify the ""errTooFarBehind"" error to include the stream name if it will
be emitted by the write failures manager. This will make the behavior
for the write failures more consistent without breaking the existing
behavior.",53,63,1,1,"2018-04-16 10:25:39","1931.67"
"grafana/loki","2f7e0e50c221aca7920c291df2a0db77d8818413","sandeepsukhani","2020-09-18 12:07:54","true","rpc for querying ingesters to get chunk ids from its store (#2601)

* rpc for querying ingesters to get chunk ids from its store

* fix broken tests

* separate out code from querier to query ingester to a new type called IngesterQuerier

* add AsyncStore which helps with querying and merging results from both chunk store and ingesters

* query ingesters local store for labels when active index type is boltdb-shipper or query store is true

* better naming

* add some tests

* add test case for duplicate chunk ids from ingesters

* add some logs and spans

* check for nil fetcher

* use require.Same to assert that two pointers are pointing to same object

* some more improvements

1. query chunk-refs parallely from store and ingesters.
2. limit look back for chunk refs and labels from ingesters to start of schema when using boltdb-shipper.

* fixes suggested from PR review

* fix mode not being set before cortex_storage.NewStore is being called

* add IngesterQuerier as a dependency for store when target is either ingester or querier

* do not cache index from ingester

* rename tests

* fix broken tests

* update upgrade guide to rollout ingesters before queriers

* upgrade guide changes suggested in PR review

* runtime check for whether active index store is boltdb-shipper

* consider previous schema as well for boltdb-shipper for calculating max look back",120,29,0,1,"2018-04-16 10:25:39","882.57"
"grafana/loki","ae488b4d1bf4825241c82ce2e7692d0f1bd0569f","tomwilkie","2018-11-25 12:06:13","false","Update vendor

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",5,7,0,0,"2018-04-16 10:25:39","219.07"
"grafana/loki","54f09b89fd4b86ee2423506a1f2d7901d8bb6900","jijotj","2023-01-20 15:04:40","true","[loki-canary] Support passing loki address as environment variable (#8205)",83,57,1,0,"2018-04-16 10:25:39","1735.19"
"grafana/loki","f9f1eddfc573394dbff4c0ac2ece53ad90695057","DylanGuedes","2022-09-30 17:16:41","true","Loki: Improve query timeouts behavior (#7230)

**What this PR does / why we need it**:
Improves the different query-related timeouts behavior by fixing a bug and having better defaults.
The changes are:
- Fix the timeout middleware by creating a new request that will use the new WithDeadline context
- `engine:timeout` was being ignored. This PR improves such scenario by using **the query timeout as a fallback** instead of the default `5min` for all cases",91,53,1,1,"2018-04-16 10:25:39","1625.29"
"grafana/loki","d34b0a9d3069c830eba63e016872690d864be6ad","cyriltovena","2020-03-10 17:45:12","true","Regexp simplification (#1787)

* Refactor line filter to support custom parsing for perl regexp.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Support alternate, concat regex simplification

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add benchmark between normal and simplified regex.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Working through all possible concat operation.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes concat operations.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Adds more type of capture group

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Improve test robustness

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Support for nexted concat.
git push

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes bug with anychar.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* add more not supported cases.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Refactor the concat alternates function.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Improve documentation and refactor code.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes all code using line filter.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Improve tests to check nil filter.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Ensure benchmark is not optimized by the compilation.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Review feedback.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",118,23,0,1,"2018-04-16 10:25:39","689.56"
"grafana/loki","a70e68862b2353a3bcc9ffa1b812cb4b5cfb9c32","cyriltovena","2021-01-22 17:01:06","true","Rename checkpoint proto package to avoid conflict with cortex. (#3217)

This will fix the warning in all our binaries.

```
2021-01-21 16:09:11.947264 I | proto: duplicate proto type registered: ingester.Series
```

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",118,33,0,1,"2018-04-16 10:25:39","1006.77"
"grafana/loki","02b51f2d5c32d9b6d0390f4fe4c5bc16dcc6bfd1","cyriltovena","2020-04-30 15:32:43","true","Update lz4 library to latest to ensure deterministic output. (#2010)

* Update lz4 library to latest to ensure deterministic output.

See https://github.com/pierrec/lz4/pull/72.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* GO SUM 😡.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",120,24,0,1,"2018-04-16 10:25:39","744.71"
"grafana/loki","a74947de1825b46dcc8f109a0fa17298f5a7f7b8","cyriltovena","2021-07-28 12:52:54","true","Restoring drone signature (#4069)

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

Co-authored-by: Danny Kopping <danny.kopping@grafana.com>",109,39,0,1,"2018-04-16 10:25:39","1197.85"
"grafana/loki","a0e9f1aeb5d557330eabde21efd02cca58d77b1a","salvacorts","2023-07-24 10:22:50","true","Make naming consistent for non-Indexed labels (#10024)

**What this PR does / why we need it**:

We started using _metadata_ to refer to _non-indexed labels_. This PR
replaces all the _metadata_ usages and renames them to _non-indexed
labels_.

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",54,63,1,1,"2018-04-16 10:25:39","1924.25"
"grafana/loki","1260adc756ad96da05acbebf1925cc112f6e5c15","gouthamve","2022-10-25 10:08:05","true","[mixin] Add cortex-gw-internal to dashboards (#7481)",90,54,1,0,"2018-04-16 10:25:39","1649.99"
"grafana/loki","fb1ebcb01b0eaaa1a5283aae1f63c379eef575d2","09jvilla","2023-01-11 23:21:22","true","Fixed a typo and made a small edit to the Helm monolithic setup doc.  (#8109)

Its storage type, not filesystem type. Also ""before you begin"" seemed a
bit vague given the list below, so I added that the list below was
software requirements.",99,57,1,0,"2018-04-16 10:25:39","1726.54"
"grafana/loki","e16a365c66eb8e51eee6479c86cf2a0461721875","blockloop","2021-04-21 19:19:11","true","implement t-shirt sizes (#28)",165,36,0,0,"2018-04-16 10:25:39","1101.12"
"grafana/loki","2ee3b4649c16e16b4a0b45668c7dd8fe96d4110e","blockloop","2021-04-01 14:00:56","true","LOG-1251/convert to statefulsets (#16)",147,35,0,0,"2018-04-16 10:25:39","1075.65"
"grafana/loki","ed945027237a6235b73c54871d56368cf85d1240","davkal","2019-03-25 10:37:53","true","Merge pull request #397 from cosmo0920/fluent-plugin-documentation

Fix unused parameter warning for Fluentd",92,11,0,0,"2018-04-16 10:25:39","339.01"
"grafana/loki","1ef1ff02249f37e3e865a38bdd8d0174d25c7d01","owen-d","2021-10-29 13:59:01","true","replaces fallthrough statement in InitFrontend (#4589)",169,42,0,1,"2018-04-16 10:25:39","1288.9"
"grafana/loki","6fe414eb256fb15b45ff37873b46c65b7483cff3","owen-d","2020-08-21 16:57:17","true","consistent chunk metrics (#2534)",123,28,0,1,"2018-04-16 10:25:39","855.77"
"grafana/loki","10e9695b21ae8c91598e7d71c25ffb6484041f53","ssncferreira","2022-09-29 11:08:05","true","Fix rangemapper with VectorExpr support (#7288)

**What this PR does / why we need it**:
The new expression type VectorExpr introduced recently in
[PR](https://github.com/grafana/loki/pull/7007), is not taken into
account in the query mapping in the AST mapper rangemapper.
The AST mapper shardmapper was updated in
[PR](https://github.com/grafana/loki/pull/7045).

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the `CONTRIBUTING.md` guide
- [ ] Documentation added
- [x] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",91,53,1,0,"2018-04-16 10:25:39","1624.03"
"grafana/loki","dc1c31a7fd38d6ea164ea8cf9e36b91584560796","wagdav","2019-05-23 14:01:19","false","Update operations.md (#615)

Small update to fix the link to the Cortex project.",107,13,0,0,"2018-04-16 10:25:39","402.4"
"grafana/loki","288e6448945228d449078d08018f6acb38c21169","Alex3k","2022-08-23 13:39:23","true","docs: Fixed examples within Loki and Promtail docs (#6591)

* Updated the promtail install example to both fix the Daemonset yaml file and provide a more concrete example for deploying to kubernetes

* Removed the sidecar documentation for promtail install as it was both broken and didn't do what it said it did

* Updated the simple scalable chart docs to include an example of using a overrides values file and to point to a working example of deploying promtail in a k8s cluster

* Updated promtail and loki SSD install docs based on PR feedback

* Update docs/sources/clients/promtail/installation.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* Update docs/sources/installation/simple-scalable-helm.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* Update docs/sources/installation/simple-scalable-helm.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* Update docs/sources/installation/simple-scalable-helm.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* Update docs/sources/installation/simple-scalable-helm.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>",82,52,0,0,"2018-04-16 10:25:39","1588.13"
"grafana/loki","d74fc2c06d0551e86c8cb6d8fd0be2d396140261","gabor","2022-03-08 12:20:52","true","Docs: update documentation about ""limit"" param (#5540)",303,47,0,0,"2018-04-16 10:25:39","1417.83"
"grafana/loki","eb39e8283f303eb50a704a9b67a5e28de3614621","dojci","2020-07-17 13:51:31","true","fluent-bit: Add more loki client configuration options (#2367)

* Add more loki client configuration options to flb output plugin

* Fix/Add config option tests",122,27,0,0,"2018-04-16 10:25:39","821.64"
"grafana/loki","beb0052ad074c6dd2fa20bfb1eb09e86cb6ee453","tomwilkie","2019-05-08 08:48:39","false","Remove unnecessarily long wait times in tests.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",98,13,0,0,"2018-04-16 10:25:39","387.18"
"grafana/loki","96d522753264de2635cec135a8854b4a945c9945","chaudum","2023-02-08 11:12:11","true","Fix parsing of vector expression (#8448)

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",77,58,1,1,"2018-04-16 10:25:39","1753.03"
"grafana/loki","cf353bb9a0ae8452d7fc2af409a3f6eeaaf099c8","bboreham","2023-08-23 12:02:06","true","Series Index Store: fix race in GetSeries (#10310)",50,64,1,0,"2018-04-16 10:25:39","1953.32"
"grafana/loki","bb963269530d39caa7999efc5719151450a6953e","btaani","2023-05-26 11:56:04","true","operator: Include runtime-config in compiling the SHA1 checksum (#9448)",68,61,1,0,"2018-04-16 10:25:39","1866.31"
"grafana/loki","38cb093358fc14311a13b1376a3c66b42a6d657d","sh0rez","2019-07-19 13:39:54","true","feat(loki): extended tailing (#764)

* refactor(querier/ingester): TailRequest Lookback window

Moves the specifications of the Lookback Window out of the
logproto.QueryRequest into it's own type logproto.Lookback.
This is required, because the Lookback Window will be used in the TailRequest
as well.

* feat(querier): parse Lookback from HTTP Request

* feat(logcli): send Lookback Window spec with tail request

* feat(querier): include historic entries in tail mode

Extends tailing by sending a configurable amount of historic entries with
before the live entries. This enables a behaviour that is closer to kubectl logs
-f and docker logs -f.

It is implemented by running a regular Query before subscribing to the ingesters.

* fix: adapt tests to Lookback change

* feat(querier): check all errors to make the linter happy

* fix(logproto): flatten Lookback window spec

Flattens the Lookback window spec into the individual queries

* fix(ingester): adapt test to Lookback flatten",103,15,0,0,"2018-04-16 10:25:39","458.38"
"grafana/loki","421265c90c7b34f181508a8cd2474ad369c3716f","sh0rez","2019-06-04 06:41:33","false","chore(vendor): update cortex vendor

Updates cortex vendor to get the changes from cortexproject/cortex#1431.
Required for making promtail build on Windows

Signed-off-by: sh0rez <me@shorez.de>",109,14,0,0,"2018-04-16 10:25:39","413.09"
"grafana/loki","dca244f7aa8ed76dde3d5dfdafb1ad3f8b5c0cce","pstibrany","2019-12-18 11:21:01","false","pkg/ingester: added sync period flags

SyncPeriod can be used to tell ingesters to cut chunks early
(before they are full) to synchronize ingesters so that they put
the same data into the new chunks. If they do, they generate
fully equal chunks and then they don't need to store them.

To avoid very small chunks, additional parameter is added:
-ingester.sync-min-utilization. When set to eg. 0.5, chunk must be
at least 50% full (utilization) in order to be cut early for sync purposes.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>",95,20,0,0,"2018-04-16 10:25:39","607.29"
"grafana/loki","e4e5e3c1f136045d91e93fcff68c756c745576fc","rfratto","2019-07-25 20:48:09","false","ingester: fix feedback from PR review",103,15,0,1,"2018-04-16 10:25:39","464.68"
"grafana/loki","715f215c50761bc75eaf727bd58672a031ca027d","rfratto","2019-11-25 22:02:53","true","pkg/promtail: remove journal target forced path (#1298)

* pkg/promtail: remove journal target forced path

The forced default path for the journal target (/var/log/journal) did
not apply to all Linux systems: systemd actually defaults to reading
from _two_ default paths: /var/log/journal and /run/log/journal. Not
setting an explicit default will enable both of those paths to be
searched for journal logs.

The comment mentioning the local machine ID was technically accurate,
but is normally dealt with by bind mounting /etc/machine-id. That's the
standard approach for running fluent-bit in a container, and should be
the standard approach for Promtail as well.

Fixes #1286.",84,19,0,1,"2018-04-16 10:25:39","584.73"
"grafana/loki","9d5630d8756d487959cb6eae3c6e047c77a87eaa","sh0rez","2019-07-15 12:28:12","false","feat(logcli): output modes (#731)

* feat(logcli): quiet mode

Adds a quiet mode (-q / --quiet) to suppress the debug messages to stderr

* feat(logcli): output modes

Adds two alternative output modes (-o / --output)

- raw: emits the line as parsed
- jsonl: emits the line plus all known metadata as JSONL (JSON Line)

Usage: -o [default, raw, jsonl]

* feat(logcli): quiet tailing mode

* feat(logcli): output modes while tailing

Supports the three different output modes in tail mode as well

* feat(logcli): print labels in jsonl tail mode

* refactor(logcli): clean up entry printing

Moves the entry printing into a standardized interface, implements this three
times:

- default (human readable)
- jsonl (for scripts)
- raw ('as is')",102,15,0,0,"2018-04-16 10:25:39","454.34"
"grafana/loki","2eb1046818468fadc7a5847b61946c85a186a82d","owen-d","2022-03-10 17:57:01","true","Tsdb/multi idx (#5598)

* begins working on a multi file index for querying across TSDBs

* abandons heapsort for multi-index

* series struct includes fingerprint and implements rest of multi-idx methods

* goimports",306,47,0,1,"2018-04-16 10:25:39","1420.06"
"grafana/loki","79a7bdbabcbf337002db72b6eb94c94c61610193","56quarters","2021-08-27 14:50:20","true","Chore: Use services and modules from grafana/dskit (#4196)

* Update Cortex vendor to bcf15611345da65e03604a08a0213aaaaac49e54

Signed-off-by: Nick Pillitteri <nick.pillitteri@grafana.com>

* Use services and modules packages from grafana/dskit

Signed-off-by: Nick Pillitteri <nick.pillitteri@grafana.com>

* Update promtail test to set default weaveworks server network type

Signed-off-by: Nick Pillitteri <nick.pillitteri@grafana.com>

* Punctuation

Signed-off-by: Nick Pillitteri <nick.pillitteri@grafana.com>",128,40,0,0,"2018-04-16 10:25:39","1226.93"
"grafana/loki","d3af5e1425b7ed541229cca5ff55d5d11397bb80","tomwilkie","2018-12-12 15:34:27","true","Add go report card badge",17,8,0,0,"2018-04-16 10:25:39","236.21"
"grafana/loki","55daa5e1c7ac5d25ac0cde04e8769125f8c54a7e","davkal","2019-02-01 13:18:36","false","Expand documentation (#261)

* Clarify links to other sections

* Expanded setup sections

* Clarified usage docs

* Extracted contributing.md

* Extracted provisioning.md

* Operations docs

* Troubleshooting docs started

* Review feedback.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",79,9,0,0,"2018-04-16 10:25:39","285.12"
"grafana/loki","e45a382297f1e3cc1d5bf3c4555d1b5e90669ba4","dannykopping","2021-12-07 09:17:39","true","Revert ""Adding PR gatekeeper (#4869)"" (#4880)

This reverts commit 369a6ac2f1505371dabc2a7972c88a57a77a44c7.",214,44,0,1,"2018-04-16 10:25:39","1326.7"
"grafana/loki","1d47c7d54b44c67f986299c9518ea57ce237108b","jdbaldry","2023-01-11 17:11:56","true","Update publishing workflows to use PATs with fine-grained access control (#8062)

The required secrets have already been created by @slim-bean.

Internal documentation is in
https://github.com/grafana/technical-documentation/pull/545.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>",101,57,1,0,"2018-04-16 10:25:39","1726.28"
"grafana/loki","6bb8a071caf508f2f76b440d84f6eb0c7aea5227","dannykopping","2023-03-30 20:12:43","true","Querier: block query by hash (#8953)

**What this PR does / why we need it**:
Using the [query
blocker](https://grafana.com/docs/loki/next/operations/blocking-queries/)
can be unergonomic since queries can be long, require escaping, or hard
to copy from logs. This change enables an operator to block queries by
their hash.",83,59,1,1,"2018-04-16 10:25:39","1805.41"
"grafana/loki","7ba8bf0710fb95fa9c63608c714df8767867a4b9","sh0rez","2019-08-07 13:51:03","false","style: improvements",97,16,0,0,"2018-04-16 10:25:39","476.39"
"grafana/loki","99e046c42f36b187c90def2016f35cdfb6822929","trevorwhitney","2022-01-24 15:33:52","true","Default max_outstanding_per_tenant to 2048 (#5204)

* Default max_outstanding_per_tenant to 2048

* Update changelog",273,45,0,1,"2018-04-16 10:25:39","1373.96"
"grafana/loki","1e19aa4715c83dc1b58475779b3d9941e91cee91","cyriltovena","2020-06-25 19:13:24","true","Add performance profile flags for logcli. (#2248)

* Add performance profile flags for logcli.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Update the logcli documentation.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Remove comment.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* remove unused import.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",135,26,0,1,"2018-04-16 10:25:39","799.87"
"grafana/loki","3c7a91b6f17aa1852a02aa5f2f399364ca976662","jkroepke","2023-02-07 21:52:29","true","[Helm] Allow to configure publishNotReadyAddresses on memberlist service (#8446)

Signed-off-by: Jan-Otto Kröpke <jok@cloudeteer.de>",78,58,1,0,"2018-04-16 10:25:39","1752.48"
"grafana/loki","cd74043db96c97e7e4f86141d5eaa7a298b7de1a","cyriltovena","2020-07-08 13:35:52","true","Improve entry deduplication. (#2302)

* Improve entry deduplication.

This PR removes mostcommon and sort insert function in the heap iterator. I discovered while working on #2293 that those are actually not helping since we're deduping those lines anyways. There were no tests checking if deduping was correctly working  so I did added those.

Bonus point this means deduping will run faster and the code is less complex. The only side effect is that the order of entries that are at the same timestamp, before the most common entry would appear first, now we keep the same order as we stored them, which I think is better.

I also change the label ordering, I think whether we are forward or backward we should keep the same aphabetical labels ordering not sure why direction was altering this before.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Improve heap iterator backward test.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",124,27,0,1,"2018-04-16 10:25:39","812.63"
"grafana/loki","e29d53631e8b5d442d2550d96d038a6af645115e","cyriltovena","2021-03-12 12:28:44","true","Fixes out-of-memory fuzzing issue. (#3469)

* Fixes out-of-memory fuzzing issue.

Fixes Issue 28535 in oss-fuzz: loki:fuzz_parse_expr: Out-of-memory in fuzz_parse_expr

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add test case.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",155,35,0,1,"2018-04-16 10:25:39","1056.59"
"grafana/loki","4544f7b7385b0f19876164e0b32aaa7ef0d84597","ashwanthgoli","2023-04-17 12:48:54","true","expiration: do not drop index if period is a zero value (#9156)

**What this PR does / why we need it**:

`DropFromIndex` should be return false when `retention_period` is set to
a zero value.

If we take chunks that overlap period boundary and are indexed in two
tables, we drop these from the table on the left side of the period
boundary even if they have not expired -
https://github.com/grafana/loki/blob/ashwanth/drop-from-index-zero-value/pkg/storage/stores/indexshipper/compactor/retention/retention.go#L218

**Checklist**
- [X] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [X] Tests updated
- [x] `CHANGELOG.md` updated

---------

Signed-off-by: Ashwanth Goli <iamashwanth@gmail.com>",82,60,1,0,"2018-04-16 10:25:39","1827.35"
"grafana/loki","09f23ecd03fa5ddf9304fd42b89405fc9b77999b","gabor","2023-03-31 17:13:34","true","Docs: Improve time range documentation (#8847)

**What this PR does / why we need it**:

Describes how exactly the `start` and `end` timestamps operate on the
time range boundaries.

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added

---------

Co-authored-by: J Stickler <julie.stickler@grafana.com>",81,59,1,0,"2018-04-16 10:25:39","1806.28"
"grafana/loki","bc4f1f5833dec7595191e8d33bc8de08fd645ad6","periklis","2020-07-03 12:46:52","true","Add support for memberlist dns-based discovery (#2288)

* Bump cortex to 0ea5a8b5 to enable memberlist dns-based discovery

* Update docs for memberlist config DNS-based discovery support

* Fix mock chunk store client DeleteChunk signature",130,27,0,1,"2018-04-16 10:25:39","807.6"
"grafana/loki","02ff6bc3117b6330dd82b38e91378aaff4c23896","davkal","2019-02-15 16:59:13","true","Merge pull request #336 from grafana/davkal/help-always-pull

Change image pull default policy to Always",87,10,0,0,"2018-04-16 10:25:39","299.27"
"grafana/loki","6500f821951b737c980df832d9d78a34220430d6","cyriltovena","2020-09-30 08:06:33","true","Improve lz4 compression (#2614)

* Improve lz4 compression.

- Move to v4.
- Remove not required checksuming.
- Default will now write 4M blocks, it's backward compatible for reads.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* vendor update

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",118,29,0,1,"2018-04-16 10:25:39","894.4"
"grafana/loki","87cbe50b59f8e85ca979d858b6a4b02ca5b9cbe5","RangerCD","2022-01-26 15:27:10","true","Lock consistencyMtx outside locking chunkMtx (#5210)

* Lock consistencyMtx outside locking chunkMtx

* Remove unnecessary RLock",273,45,0,0,"2018-04-16 10:25:39","1375.96"
"grafana/loki","2f1e2fc3d2b3fc6b42a3d87b35911f51430d36ec","cyriltovena","2021-11-09 19:54:43","true","Fixes Promtail User-Agent. (#4716)

This was because promtail client was still user the old version.Version which is initialized at run-time via init.

But if we use it also at init time there's no guarantee that the version will be set.

So intead I'm using the original version variable stamped in the binary and not at runtime.

Fixes #4686

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",188,43,0,1,"2018-04-16 10:25:39","1299.15"
"grafana/loki","6c1a62d8298748ba2fc92f40bb904fdf96178aa1","simonswine","2022-04-29 13:01:38","true","Ensure proto definitions are formatted [2/2] (#6000)

* Update build image to 0.10.4

* Add a fmt target for proto defintions

This uses buf to ensure the proto defintions are more
consistently formatted.

* Update formatted files",93,48,0,0,"2018-04-16 10:25:39","1474.11"
"grafana/loki","d88f3996eaa2ab4e60f29cdb396e947d28ea0986","owen-d","2021-04-29 13:21:26","true","revendor compatibility: various prom+k8s+cortex (#3664)

* revendor compatibility: various prom+k8s+cortex

* fix logcli client instantiation

* go mod tidy",177,36,0,1,"2018-04-16 10:25:39","1108.87"
"grafana/loki","d38c208aa73e25311b9ec83fce02553dc70cc4b8","DylanGuedes","2022-07-25 14:47:30","true","Rephrase error message (indexgateway->groupcache). (#6763)",73,51,0,1,"2018-04-16 10:25:39","1560.18"
"grafana/loki","5c99fe388631f5e125e637dbad7a08b23470868f","slim-bean","2019-09-09 22:59:51","false","full cirlce",118,17,0,1,"2018-04-16 10:25:39","508.77"
"grafana/loki","750ab36bc15702b2e6eb8a462ae9e602f27c14b7","owen-d","2020-08-25 15:57:13","true","fixes batch metrics help text & corrects bucketing (#2552)",125,28,0,1,"2018-04-16 10:25:39","859.73"
"grafana/loki","c4562f19ed511b7a82c47ba5957b8dcdb758beba","KMiller-Grafana","2021-10-15 22:31:41","true","Docs: correct the page parameter in the Grafana Cloud advertisement (#4486)",158,42,0,0,"2018-04-16 10:25:39","1275.25"
"grafana/loki","422560b6b12409f524aa13e5f13070c38372836f","salvacorts","2023-04-19 06:51:18","true","Flag to disable index stats cache (#9177)

**What this PR does / why we need it**:
At https://github.com/grafana/loki/pull/8972 we started caching all
index stats requests.
If the results cache gets overloaded, it can quickly take down the rest
of the loki cell due to all the increased work.
This PR adds a new flag so we can easily disable caching index stats
requests.

**Which issue(s) this PR fixes**:
This PR is a follow up for https://github.com/grafana/loki/pull/8972

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [x] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",79,60,1,1,"2018-04-16 10:25:39","1829.1"
"grafana/loki","7353a6aeb30506ab21c0b23d622adef12ef86211","trevorwhitney","2022-11-03 16:41:25","true","[helm] Document helm migration from `loki-distributed` (#7514)

**What this PR does / why we need it**:

Adds a migration guide to the new `loki` chart for people coming from
the `loki-distributed` or `enterprise-logs` helm charts.

**Which issue(s) this PR fixes**:
Fixes #7330

Co-authored-by: Karsten Jeschkies <k@jeschkies.xyz>",91,54,1,1,"2018-04-16 10:25:39","1658.26"
"grafana/loki","379ca6b4090f59110397a9e969f2a0f94bc17169","danpoltawski","2022-01-31 08:19:25","true","Promtail docs: Fix link to `unpack` LogQL documentation (#5274)",277,45,0,0,"2018-04-16 10:25:39","1380.66"
"grafana/loki","18482c67d649c83d6fb60f48be08ecab5cf29799","ashwanthgoli","2023-08-28 06:34:00","true","compactor: deprecate -boltdb.shipper.compactor. prefix in favor of -compactor. (#10344)

**What this PR does / why we need it**:
Compactor config use `-boltdb.shipper.compactor.` as prefix which is
misleading as the config options apply to tsdb index as well.

This pr introduces `-compactor.` prefix which can now be used to
configure compactor configuration options and deprecates
`-boltdb.shipper.compactor.`


**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [ ] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",49,64,1,0,"2018-04-16 10:25:39","1958.09"
"grafana/loki","6841c418ef70e37f87cc263bc5a2c6211c895ed4","slim-bean","2020-03-23 15:58:53","false","promtail retry 429 rate limit errors, clarifying risks in the docs of configuring multiple client sections in promtail, also increased the backoff and retry settings in promtail.

Signed-off-by: Edward Welch <edward.welch@grafana.com>",119,23,0,1,"2018-04-16 10:25:39","702.48"
"grafana/loki","46d811b9ff55adc4a8a656168a1d9508e0fb22b5","owen-d","2022-07-21 07:16:27","true","use owen-d gomemcache fork for connection sharding (#6722)

Signed-off-by: Owen Diehl <ow.diehl@gmail.com>",72,51,0,1,"2018-04-16 10:25:39","1555.87"
"grafana/loki","5fcd399f5d07d3bf6c9f7f2aace0a117562d552c","owen-d","2020-08-20 21:04:19","true","Update tanka.md with steps for using k8s-alpha lib (#2528)

* Update tanka.md

* Update docs/sources/installation/tanka.md

Co-authored-by: Diana Payton <52059945+oddlittlebird@users.noreply.github.com>

* Update docs/sources/installation/tanka.md

Co-authored-by: Diana Payton <52059945+oddlittlebird@users.noreply.github.com>

Co-authored-by: Diana Payton <52059945+oddlittlebird@users.noreply.github.com>",118,28,0,1,"2018-04-16 10:25:39","854.94"
"grafana/loki","3f7bc33aaa67d157c17d1da232a8bbe055272427","wardbekker","2020-07-28 20:38:09","true","DOCS: clarified globbing behaviour of __path__ of the doublestar library (#2437)

* clarified globbing behaviour of __path__ of the doublestar library

* Update docs/sources/clients/promtail/scraping.md

Co-authored-by: Ed Welch <edward.welch@grafana.com>

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>
Co-authored-by: Ed Welch <edward.welch@grafana.com>",126,27,0,0,"2018-04-16 10:25:39","832.93"
"grafana/loki","9844fad8b4110a1a706b114335402228599c81d9","chaudum","2023-03-23 10:52:49","true","Rename LeafQueue to TreeQueue (#8856)

**What this PR does / why we need it**:

`TreeQueue` is the semantically more correct term for this type of queue.

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",83,59,1,1,"2018-04-16 10:25:39","1798.02"
"grafana/loki","7682b32cbae8c1146d44601ebf4b13cc9c718b98","owen-d","2020-06-26 13:16:26","true","Revert ""Revert ""Update go from 1.13 to 1.14. (#2013)"""" (#2029)

* Revert ""Revert ""Update go from 1.13 to 1.14. (#2013)""""

This reverts commit e8fece69e316c7c58ca2033349e43b9bbac2f0b0.

* Update cortex to latest.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Update go.sum and doc.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

Co-authored-by: Cyril Tovena <cyril.tovena@gmail.com>",133,26,0,1,"2018-04-16 10:25:39","800.62"
"grafana/loki","ad0f7ab8455740a6c38015469bfe5d8dd98fb371","owen-d","2023-10-17 15:18:39","true","Blooms/merge-iters (#10923)

Adds a bunch of bloom filterutilities in preparation for merging &
extending bloom blocks with new chunks/series",21,66,1,1,"2018-04-16 10:25:39","2007.45"
"grafana/loki","c6b55e75122ae0761102395651a4da647c639039","vlad-diachenko","2022-11-25 08:56:02","true","[docs] removed static URL to LogQL Analyzer API (#7773)

added logic to determine logql-analyzer version dynamically based on the
value selected in docs version dropdown.
Adding this logic to the docs, allows us to skip the step on release
when we manually update the link to the new version of LogQL Analyzer",95,55,1,0,"2018-04-16 10:25:39","1679.94"
"grafana/loki","1921c3d428146338a568c57f47eed19eca11fdbb","owen-d","2021-10-07 16:53:46","true","tests checkpoints immediately and gives more of a time buffer (#4432)",139,42,0,1,"2018-04-16 10:25:39","1267.02"
"grafana/loki","dd7d821b31cbf22b24fb938caeaa684edc3747be","owen-d","2020-08-27 17:56:55","true","Website doc link fixes (#2566)

* index file links

* non _index.md links

* path fix

* base readme links

* fixes drone badge",123,28,0,1,"2018-04-16 10:25:39","861.81"
"grafana/loki","440fb7d74cad481bebb222b21fc063fa56c2f5ac","DylanGuedes","2022-05-20 06:50:27","true","Loki: Modifies TableManager to use IndexGateway ring (#5972)

* Add two metrics to the IndexGateway.

- Add a new `query_readiness_duration_seconds` metric, that reports
  query readiness duration of a tablemanager/index gateway instance. We
  should use it later to report performance against the ring mode
- Add a new `usersToBeQueryReadyForTotal` metric, that reports number of
  users involved in the query readiness operation. We should use it
  later to correlate number of users with the query readiness duration.

* Remove `usersToBeQueryReadyForTotal`.

- It will report all users always for now, so it isn't too helpful the
  way it is.

* Rename metric help text to not mislead people.

* Log queryReadiness duration.

* Fix where log message and duration and triggered.

* Add two metrics to the IndexGateway.

- Add a new `query_readiness_duration_seconds` metric, that reports
  query readiness duration of a tablemanager/index gateway instance. We
  should use it later to report performance against the ring mode
- Add a new `usersToBeQueryReadyForTotal` metric, that reports number of
  users involved in the query readiness operation. We should use it
  later to correlate number of users with the query readiness duration.

* Remove `usersToBeQueryReadyForTotal`.

- It will report all users always for now, so it isn't too helpful the
  way it is.

* Rename metric help text to not mislead people.

* Log queryReadiness duration.

* Fix where log message and duration and triggered.

* Use boundaries to skip users in TableManager.

- Separate the assigning of indexClient in the IndexGateway to allow
  initializing the shipper with the IndexGateway ring
- Add new TenantBoundariesClient entity, that answers if a given
  tenantID should be ignored or not
- Use the TenantBoundariesClient implemented by the IndexGateway in the
  downloads TableManager

* Add IndexGateway configuration docs.

* Add tests for pkg/util/ring TokenFor() and IsAssignedKey()

Signed-off-by: JordanRushing <rushing.jordan@gmail.com>

* Small whitespace fix in pkg/util/ring_test.go

Signed-off-by: JordanRushing <rushing.jordan@gmail.com>

* Apply suggestions from code review

Rewrite QueryIndex error phrase.

Co-authored-by: JordanRushing <rushing.jordan@gmail.com>

* Join users list in a single string.

- This is necessary since go-kit doesn't support array type.

* Tweak queryReadiness log messages.

- As suggested by Ed on
  https://github.com/grafana/loki/pull/5972#discussion_r859734129 and
  https://github.com/grafana/loki/pull/5972#discussion_r859736072

* Implement new RingManager.

- Adds a new entity to indexgateway named RingManager, responsible for
  managing the ring and the lifecycler used by the indexgateway. The
  ringManager is guaranteed to be initiatiated before the Shipper and
  before the IndexGateway.
- Remove the readiness logic from the IndexGateway.
- Pass the RingManager as the TenantBoundaries implementation of the
  Shipper

* Return non-empty ringmanager for all modes.

* Fix lint regarding error not being check.

* Fix lint due to wrong import order.

* Implement support for client and server mode for the ring manager.

* Fix ring manager services registration.

* Add option to configure whether or not to log gateway requests.

* Check if IndexGateway is enabled instead of active.

* Tune RingManager behavior.

- Instantiate ring buffers inside IsAssignedKey instead of reusing same
  buffer to avoid issues with concurrency.
- Remove unnecessary details from IndexGateway mode docs.
- Return error when wrongly instantiating a RingManager when
  IndexGateway is in simple mode.

* Rewrite `TenantInBoundaries` as a func instead of interface.

* Fix lint.

- Fix YAML tag
- Remove else clause

* Use distributor instead of querier in test.

- Since the querier needs to wait for the index gateway ring, it isn't
  suitable for this test anymore.

* Add ring mode guard clause.

* Return code erased by mistake.

* Rename TenantInBoundaries to IndexGatewayOwnsTenant.

* Log len of users instead of all of them to avoid log msgs.

* Add docstrings to new public functions.

* Apply suggestions from code review

Document that tenant filtering is only applied during query readiness.

Co-authored-by: Sandeep Sukhani <sandeep.d.sukhani@gmail.com>

* Modify IsAssignedKey to expect address directly instead of lifecycler.

- Also removes HasDedicatedAddress, since it isn't necessary anymore

* Log error message when IsInReplicationSet fails.

* Modify IsAssignedKey to return true by default.

* Remove wrong assigning of Service for clientMode.

* Log gateway requests before error checks.

* Remove unnecessary endpoint registration.

* Fix lint.

* Update pkg/util/ring.go

Co-authored-by: Sandeep Sukhani <sandeep.d.sukhani@gmail.com>

Co-authored-by: JordanRushing <rushing.jordan@gmail.com>
Co-authored-by: Sandeep Sukhani <sandeep.d.sukhani@gmail.com>",72,49,0,1,"2018-04-16 10:25:39","1494.85"
"grafana/loki","1b410dbc01fddf2879ee7242de28844184793b0c","rasta-rocket","2023-06-09 11:48:42","true","feat(promtail): add CF ClientRequestSource field (#9669)

**What this PR does / why we need it**:

Hey folks 👋 

Little contribution here to add a useful log field for cloudflare users.
Indeed I add the [ClientRequestSource
field](https://developers.cloudflare.com/logs/reference/clientrequestsource/
) which is pretty useful when debugging some specific traffic handled by
cloudflare

Extra: Since I was on the documentation I fixed an indentation issue
that I spotted

Don't hesitate to reach me if you have any questions

Cheers 😉 


**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

Loki rocks 🚀 

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",68,62,1,0,"2018-04-16 10:25:39","1879.31"
"grafana/loki","cb20afaa26d1e8fd285554129e32843a21afbe5a","owen-d","2020-08-05 14:07:14","true","BatchIter edge cases (#2466)

* sampleIter uses correct cache

* minimal lazy chunk iterator test

* memchunk Blocks() inclusivity

* fixes a few edge cases in the batchiterator batching

* fixes bad metric name in test

* due to later chunks len check, resetting nextChunk is unnecessary

* lazychunks pop test

* safe starting of batchChunkIterator

* batchiter rudimentary safe start test",123,28,0,1,"2018-04-16 10:25:39","839.65"
"grafana/loki","b114dc93d62fb8f453fcc11a8afee31a192db93f","owen-d","2022-08-10 16:51:00","true","update deletion docs (#6869)

* update deletion docs
Signed-off-by: Owen Diehl <ow.diehl@gmail.com>

* Update docs/sources/operations/storage/logs-deletion.md",77,52,0,1,"2018-04-16 10:25:39","1575.27"
"grafana/loki","927767059eb8451c5e13291c2e58347cadddf6e5","wardbekker","2021-03-19 12:32:45","true","fix spelling in doc (#3518)",167,35,0,0,"2018-04-16 10:25:39","1063.59"
"grafana/loki","de77777a05176adc7e644a743a978346f1a7f752","aglees","2023-07-28 15:24:49","true","Lambda Promtail - Add functions to ungzip incoming data from Cross-Account AWS Kinesis/CloudWatch (#10077)

**What this PR does / why we need it**:
When using Lambda Promtail to receive logs via Kinesis that have come
from a CloudWatch Logs Subscription Filter in another account, the data
is gzipped. This PR add a check for gzipped content and if detected
unzips and sends to Loki.

[AWS Docs - Cross Account Subscriptions -
Kinesis](https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/CrossAccountSubscriptions-Kinesis.html)

**Which issue(s) this PR fixes**:
n/a

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

Co-authored-by: Michel Hollands <42814411+MichelHollands@users.noreply.github.com>",52,63,1,0,"2018-04-16 10:25:39","1928.46"
"grafana/loki","e15da437f09ecd698ecd9a303546ff4cfa3adbe2","MasslessParticle","2022-08-24 14:45:00","true","Shard deletes requests based on time ranges (#6903)

* Refactor the store API to be in terms of DeleteRequest

* backfill remove tests

* backfill GetAll tests

* Make the delete request store deal in groups of requests instead of single ones

* Make cancelation aware of request groups

* remove cancelation deadline

* shard deletes based on a query parameter

* merge request group on gets

* global configuration for max query range

* sort delete requests by start time so batches are grouped to similar chunks

* Fix status when some deletes haven't happened yet

* fix tests

* Review feedback

* review feedback

* make max_interval > deletion interval a validation error

* list partially completed deletes

* list partially completed deletes

* fix flaky test

* clarify naming

* disallow cancelation of partial deletes unless the 'force' flag is passed

* more comment specificity for the delete request hash",81,52,0,1,"2018-04-16 10:25:39","1589.18"
"grafana/loki","e1c5c4be4aa1b27a05141d9dc400634a7c98ce12","tomwilkie","2019-02-09 21:52:02","false","Basic distributor & ingester tests.

Proves that they can accept multiple samples with the same timestamp.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",78,10,0,0,"2018-04-16 10:25:39","293.48"
"grafana/loki","a8509a8fd9d1b4f05c2ed61b332455927cfeccc0","tomwilkie","2018-11-20 12:10:15","false","Fix circle config.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",5,7,0,0,"2018-04-16 10:25:39","214.07"
"grafana/loki","0cde54c4dc6d8ecebe22590771a3fec39d6d2bf5","jeschkies","2021-07-06 09:10:56","true","Lint script files. (#3944)

* Lint script files.

This patch adds a Drone CI step that runs shellcheck on all Bash script
files.

* Install Bash in shellcheck container.

* Fix a few shelcheck errors.

* Fix build.sh

* Fix remaining shellcheck errors.",119,39,0,1,"2018-04-16 10:25:39","1175.7"
"grafana/loki","a76fe22942be73f0646d684e688cd7dfd84e1eb7","slim-bean","2022-04-11 17:24:20","true","add some docs for working with the storage schema (#5863)

Signed-off-by: Edward Welch <edward.welch@grafana.com>",322,48,0,1,"2018-04-16 10:25:39","1451.04"
"grafana/loki","1b16bb3d1d0c0c9e0d1670987d604547c978ca44","avtion","2022-01-03 13:49:20","true","docs: fix yaml grammar mistakes (#5027)",255,44,0,0,"2018-04-16 10:25:39","1352.89"
"grafana/loki","594ca50f6fba897c318789c5431cf0a333a31d7f","trevorwhitney","2023-04-27 16:46:05","true","Fix GF_INSTALL_PLUGINS syntax for k3d env GEL plugin (#9300)

**What this PR does / why we need it**:

Not sure if this is a change to Grafana, but while the old sytnax used
to work, it no longer does, and needs this
`;grafana-enterprise-logs-app` suffix, which appears to fix things.",80,60,1,1,"2018-04-16 10:25:39","1837.51"
"grafana/loki","feb66d62cfd9020901bd5540122d5fe78162ea52","sandeepsukhani","2020-10-28 08:31:13","true","fix flaky tests in boltdb-shipper (#2831)",123,30,0,1,"2018-04-16 10:25:39","922.42"
"grafana/loki","e1c59e87ba48c8a43bfd8e9334141fe95dd8adc5","sandeepsukhani","2021-10-29 13:50:07","true","set wal dir to /loki/wal in docker config (#4585)",169,42,0,1,"2018-04-16 10:25:39","1288.89"
"grafana/loki","02540703c86afeca67d2533ee1fbb4a59d92fa44","sandeepsukhani","2020-09-25 12:12:47","true","fix jsonnet for memcached-writes when using boltdb-shipper (#2677)",122,29,0,1,"2018-04-16 10:25:39","889.57"
"grafana/loki","bae599a25e6702f443d614cc246e3274cfe1ad70","davkal","2019-03-29 15:58:34","true","Merge pull request #428 from daixiang0/add-comment

Add comment about external_labels",93,11,0,0,"2018-04-16 10:25:39","343.23"
"grafana/loki","07ea1ed99c4ef10cbafc4212f589500afa85c59d","trevorwhitney","2021-11-03 20:14:17","true","Add common ring configuration (#4617)

* add ring section to common config

Co-Authored-By: Dylan Guedes <djmgguedes@gmail.com>

* fix compactor test to append loopback interface it ifnames in test if present

* add loopback interface to compactor ring iface names

* clean-up from PR review

Co-authored-by: Dylan Guedes <djmgguedes@gmail.com>

* only appy ingester config to rings with no non-default properties

Co-authored-by: Dylan Guedes <djmgguedes@gmail.com>",170,42,0,1,"2018-04-16 10:25:39","1293.16"
"grafana/loki","ecd371db87660fcf59510a78e903394d9be87e2a","bboreham","2023-08-22 20:14:34","true","indexshipper/compactor: fix two race conditions (#10313)

**What this PR does / why we need it**:
We must call wg.Add before starting the goroutine.
And protect the data in mockCompactorClient.
And another fix in shipper/index/compactor.

**Which issue(s) this PR fixes**:
Part of #8586

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- NA Documentation added
- NA Tests updated
- NA `CHANGELOG.md` updated
- NA If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- NA Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- NA For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",50,64,1,0,"2018-04-16 10:25:39","1952.66"
"grafana/loki","9f19c384e12ee80ae4bbb2ed8ef61eec071cea4c","xperimental","2023-05-24 18:50:45","true","operator: Do not update status after setting degraded condition (#9511)",68,61,1,1,"2018-04-16 10:25:39","1864.6"
"grafana/loki","2ae80d7166d3392caf0ae136bac7741d7ba0740d","periklis","2023-04-04 04:02:08","true","Align common instance_addr with memberlist advertise_addr (#8959)",80,59,1,1,"2018-04-16 10:25:39","1808.73"
"grafana/loki","e82885da5046dba5485578fd36e0292641a921be","trevorwhitney","2023-04-03 21:04:07","true","Change loki version in docs for 2.8 release (#8985)

Changes version references in Loki docs for the upcoming release

Also adds a script for diffing metrics when doing a release.",80,59,1,1,"2018-04-16 10:25:39","1808.44"
"grafana/loki","527ee122201a4d9df1b35660251b7e3613bddcc9","etcet","2022-12-08 06:46:52","true","Fixing a typo in configuration.md (#7878)

**What this PR does / why we need it**:
Fixes a typo in configuration.md, improves reader clarify and confidence

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the `CONTRIBUTING.md` guide
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",95,56,1,0,"2018-04-16 10:25:39","1692.85"
"grafana/loki","f83988a061b7c13cdd6167ac00f12fe26e05c5b2","trevorwhitney","2022-10-25 18:10:52","true","Add 2.7.0 section to upgrading doc (#7457)

Add 2.7.0 section to Upgrading doc.

Co-authored-by: Ursula Kallio <ursula.kallio@grafana.com>",89,54,1,1,"2018-04-16 10:25:39","1650.32"
"grafana/loki","c0eb73c34a59b6bbd1ccc7632b27cc212002a5ed","trevorwhitney","2022-09-02 19:11:06","true","Enable build in env w/o internet or GCP creds (#7029)

**What this PR does / why we need it**:

The build is currently dependent upon you building in an environment with internet connectivity and GCP credentials. This PR fixes the few parts of our code and test that rely on these external dependencies so it can be built in an environment without internet or GCP credentials (such as when building a [nix flake](https://github.com/grafana/loki/pull/7020))


**Which issue(s) this PR fixes**:
Fixes #7028",79,52,1,1,"2018-04-16 10:25:39","1597.36"
"grafana/loki","81d0f1d53395d11583e3ac852ab20107522854c1","trevorwhitney","2021-10-12 16:25:59","true","Add more tests around config parsing changes from common config PR (#4433)

* add test to demonstrate bug

Signed-off-by: Trevor Whitney <trevorjwhitney@gmail.com>

* a totally empty yaml file causes weird behavior

Signed-off-by: Trevor Whitney <trevorjwhitney@gmail.com>

* add default unmarshal test for test config wrapper

Signed-off-by: Trevor Whitney <trevorjwhitney@gmail.com>

* add additional tests around default unmarshal to confirm bug is not there

Signed-off-by: Trevor Whitney <trevorjwhitney@gmail.com>

* clean up tests

Signed-off-by: Trevor Whitney <trevorjwhitney@gmail.com>

* check errors in test

Signed-off-by: Trevor Whitney <trevorjwhitney@gmail.com>",146,42,0,1,"2018-04-16 10:25:39","1272"
"grafana/loki","2d4448603a959064c1a11fb7c49915493f50947c","rfratto","2019-07-23 11:50:26","true","Merge pull request #793 from daixiang0/centos-support

Document centos dep",103,15,0,1,"2018-04-16 10:25:39","462.31"
"grafana/loki","cf6fad29d41d3cd5226e3a4992b9e028d1311777","rfratto","2020-02-04 18:31:42","true","Exempt proposals from stale bot (#1628)

I think proposals should be something we always take a look at and decide to close manually.",108,21,0,1,"2018-04-16 10:25:39","653.59"
"grafana/loki","b75965e9151b38936d276c904cd049ed8d1cb9e9","sandeepsukhani","2019-10-03 05:29:04","false","list backups just before starting deletion of wanted backups",76,17,0,1,"2018-04-16 10:25:39","532.04"
"grafana/loki","43c16ed8a10ffc01cea17d0d178351d762760e4a","sandeepsukhani","2021-07-01 12:44:52","true","remove boltdb files from ingesters on startup which do not have a index bucket (#3929)",116,38,0,1,"2018-04-16 10:25:39","1170.85"
"grafana/loki","c2ccb2539077f905c4c4fc4a08362e74588da6ba","dannykopping","2022-10-05 08:09:32","true","Updating loki-build-image to Go 1.19 (#7334)

**What this PR does / why we need it**:
Updated the `loki-build-image` to Go 1.19.2 as a precursor for
https://github.com/grafana/loki/pull/7243.

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",93,54,1,1,"2018-04-16 10:25:39","1629.91"
"grafana/loki","b4d0a2cd68e25f2d07991ebda01c10464c89eccb","chaudum","2023-05-25 11:40:02","true","Force using a buffer from the ChunkRefsPool (#9217)

**What this PR does / why we need it**:

Re-using a buffer from the `ChunkRefsPool` avoids unnecessary allocations in TSDB's `GetChunkRefs` call.

**Special notes for your reviewer**:

Benchmarks

```
$ gotest -v -count=1 ./pkg/storage/stores/tsdb/ -test.run=""^$"" -test.bench=Bench -test.benchtime=10000x
```

```console
$ benchstat old.txt new.txt 
name                      old time/op    new time/op    delta
TenantHeads/10-8             244µs ±58%      55µs ± 4%  -77.49%  (p=0.000 n=10+9)
TenantHeads/100-8           1.75ms ± 9%    0.58ms ±26%  -66.89%  (p=0.000 n=9+10)
TenantHeads/1000-8          16.5ms ± 6%     6.4ms ± 2%  -60.89%  (p=0.000 n=9+10)
IndexClient_Stats-8         25.0µs ±10%    25.1µs ±13%     ~     (p=0.863 n=9+9)
TSDBIndex_GetChunkRefs-8    3.34ms ±12%    1.46ms ± 2%  -56.41%  (p=0.000 n=10+9)

name                      old alloc/op   new alloc/op   delta
IndexClient_Stats-8         2.37kB ±12%    2.37kB ±12%     ~     (p=0.923 n=10+10)
TSDBIndex_GetChunkRefs-8    6.40MB ± 0%    1.40MB ± 0%  -78.08%  (p=0.000 n=9+10)

name                      old allocs/op  new allocs/op  delta
IndexClient_Stats-8           59.0 ± 0%      59.0 ± 0%     ~     (all equal)
TSDBIndex_GetChunkRefs-8      42.0 ± 0%      27.0 ± 0%  -35.71%  (p=0.000 n=10+10)
```

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",68,61,1,1,"2018-04-16 10:25:39","1865.3"
"grafana/loki","8331785a238c965bc67b50eceae6c5639f4288e5","owen-d","2022-10-07 18:34:08","true","Revert ""Update Thanos dependency to latest version"" (#7371)

Reverts grafana/loki#7348

I expect we'll merge this again in the future, but we'll need some more
time for downstream projects to be ready for this change.",94,54,1,1,"2018-04-16 10:25:39","1632.34"
"grafana/loki","9c2e11d1863a6108d0a2180c6bf6057f455ab8a5","DylanGuedes","2023-04-18 20:23:08","true","Ingester: Reuse allocations on `GetStreamRates` (#9180)

**What this PR does / why we need it**:
- Reuse rates mapping returned by the calculator to reduce the number of
allocations",79,60,1,1,"2018-04-16 10:25:39","1828.66"
"grafana/loki","130878f3f6f6355800d86bd7f15bb0330e064c85","DylanGuedes","2021-11-16 08:28:54","true","Enrich WAL folder creation error message (#4705)

* Enrich WAL folder creation error message.

* Apply suggestions from code review

Use %q and try absolute path.

Co-authored-by: Mateusz Gozdek <mateusz@kinvolk.io>

* Include file/path package.

Co-authored-by: Mateusz Gozdek <mateusz@kinvolk.io>",198,43,0,1,"2018-04-16 10:25:39","1305.67"
"grafana/loki","90c4821dd3377087980cde515fe5a5895c7bf34c","DylanGuedes","2021-11-05 18:47:50","true","Docs: Document the common ring section (#4664)

* Document the common ring section.

- Create a new <ring_config> section that document the
  pkg/util/ring_config.go
- Rewrite ruler and scheduler_ring docs to make usage of <ring_config>
  section
- Document new ring under common section

* Update docs/sources/configuration/_index.md

Co-authored-by: Ed Welch <ed@oqqer.com>",176,43,0,1,"2018-04-16 10:25:39","1295.1"
"grafana/loki","4e4359e67c6c760e175d2b517dc87ec76a385e42","vlad-diachenko","2023-02-16 09:18:02","true","Fixed XSS on LogQL Analyzer page (#8521)

Signed-off-by: Vladyslav Diachenko <vlad.diachenko@grafana.com>",74,58,1,0,"2018-04-16 10:25:39","1760.95"
"grafana/loki","81e67f89b30567639db3c66fb1fe190880975735","cyriltovena","2021-11-15 07:32:13","true","Add GELF support for Promtail. (#4744)

* Add Gelf support for Promtail.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add documentation.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Changelog

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Move change to MAIN

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Update graylog to grafana remote.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add a test and check mod

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* add log messages around startup and shutdown

Co-authored-by: Edward Welch <edward.welch@grafana.com>",195,43,0,1,"2018-04-16 10:25:39","1304.63"
"grafana/loki","3f0800dc4417eeddbd48eaf7d86c8ba36690eb53","cyriltovena","2020-12-08 08:24:06","true","Add function label_replace. (#3047)

You might be wondering why do we need label_replace when we already have label_format.
Well for two reasons:

1. It's nice to have something similar to Prometheus, so users building metric queries will feel right at home.
2. Interestingly, they are quite different in how they execute. label_format executes for every log line, however label_replace execute for every sample. Since you aggregate log lines into sample then label_replace is way more efficient at scale.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",127,32,0,1,"2018-04-16 10:25:39","962.42"
"grafana/loki","c4d016fd53de7c4af0a4a6d60d191859d244417d","pixiono","2023-03-31 20:26:48","true","Add projected volume type to psp (#8747)

**What this PR does / why we need it**:
When I tried to use an S3 bucket as storage and access it using an IAM
role, I got the following event:

> 27s Warning FailedCreate statefulset/loki-read create Pod loki-read-0
in StatefulSet loki-read failed error: pods ""loki-read-0"" is forbidden:
PodSecurityPolicy: unable to admit pod: [spec.volumes[0]: Invalid value:
""projected"": projected volumes are not allowed to be used

This can be simply solved with this PR.

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

Co-authored-by: Travis Patterson <travis.patterson@grafana.com>",81,59,1,0,"2018-04-16 10:25:39","1806.42"
"grafana/loki","5aba13bb6299086fbf80af28e2dd178f8e88111f","daniellee","2018-12-12 19:00:14","false","readme: adds section about search

Signed-off-by: Daniel Lee <dan.limerick@gmail.com>",19,8,0,0,"2018-04-16 10:25:39","236.36"
"grafana/loki","e1ab2cc5090c4b0133111b3d7034e3dcb743acfc","cyriltovena","2020-11-13 15:16:29","true","Cleanup labels parsing. (#2929)

* Cleanup labels parsing.

Make sure we only use one type of labels parsing.This just reduce the amount of code we have to maintain.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes tests.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes a test.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",125,31,0,1,"2018-04-16 10:25:39","937.7"
"grafana/loki","3f704de3a8b6ba2f70797af1aaf6c366da81bfc1","cyriltovena","2019-05-16 14:16:09","false","fixes test in circle ci getting OOMKilled (#593)",102,13,0,1,"2018-04-16 10:25:39","395.41"
"grafana/loki","4bcecefd058ee7bf7515bcb1d13109f7c1b3b900","xperimental","2022-11-29 19:51:20","true","operator: Fix histogram-based alerting rules (#7809)",94,55,1,1,"2018-04-16 10:25:39","1684.39"
"grafana/loki","48b8504c30e6680bfd1c009fc62ef1d41285f4b3","owen-d","2020-06-26 15:42:54","true","lock fix for flaky test (#2268)",133,26,0,1,"2018-04-16 10:25:39","800.72"
"grafana/loki","8eed9a4ddebe5b5ccbd332ae517c4effe381da2a","owen-d","2022-06-27 17:57:51","true","dont call getinstance twice in checkpointing (#6516)

Signed-off-by: Owen Diehl <ow.diehl@gmail.com>",73,50,0,1,"2018-04-16 10:25:39","1532.31"
"grafana/loki","eb6ba615f48cb7dd0098c9c15051d40ba42ff837","chodges15","2023-01-11 17:52:24","true","Promtail: Add configuration to drop batches when rate limited by Loki (#7973)

This change will allow for more deterministic behavior by multitenant
Promtail instances where one or more tenants are being heavily throttled
due to limits exceeded within Loki. Specifically, it will reduce the
performance impact of having exponential backoff cause HOL blocking for
rate limit response codes while other tenants are ready to send batches.

Co-authored-by: chodges15 <chris.hodges@gmail.org>",101,57,1,0,"2018-04-16 10:25:39","1726.31"
"grafana/loki","6d1963221500574312e00c4da950d16c637e6b04","tomwilkie","2019-01-31 12:51:32","false","add active files and targets to promtail dashboard.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",73,9,0,0,"2018-04-16 10:25:39","285.1"
"grafana/loki","f657122ccdcf592b63d8530f40ec91e2147322f4","jesusvazquez","2022-06-15 16:28:25","true","Git ignore pkg/loki/wal (#6405)

* Git ignore pkg/loki/wal

I noticed that after running make test the directory pkg/loki/wal is
created which a bunch of files and data.

I think it would be a good idea to ignore the entire directory with git.

* Trigger CLA sign",68,50,0,0,"2018-04-16 10:25:39","1520.25"
"grafana/loki","98b5e35f94ab70a05e92a95343f83b2ed1984e84","DylanGuedes","2023-04-27 12:35:50","true","HTTP: Reuse `buffer.Bytes()` when decompressing (#9266)

**What this PR does / why we need it**:
- Modifies `decompressFromBuffer` to call `buffer.Bytes()` a single time.
- Adds a new Benchmark under `http_loki_test.go` file. This is in a separate file to differentiate from the original `http_test.go` forked from Cortex and because `http_test.go` uses package `http_test` which doesn't allow us to test private functions.",79,60,1,1,"2018-04-16 10:25:39","1837.34"
"grafana/loki","7413f11d29da94e9eb0bb8ac6257ed985f494548","wardbekker","2020-03-26 16:59:27","true","throw exceptions on HTTPTooManyRequests and HTTPServerError so FluentD will retry (#1845)

* throw exceptions on HTTPTooManyRequests and HTTPServerError to trigger retry

* fixed variable naming

* Update fluentd/fluent-plugin-grafana-loki/spec/gems/fluent/plugin/loki_output_spec.rb

spelling fix

Co-Authored-By: Cyril Tovena <cyril.tovena@gmail.com>

* removed newline

Co-authored-by: Cyril Tovena <cyril.tovena@gmail.com>",120,23,0,0,"2018-04-16 10:25:39","705.52"
"grafana/loki","4a3d287566e2219a72da970086c9a1ccf53e5f9f","periklis","2022-06-29 10:06:28","true","operator: Use default interface_names for lokistack clusters (#6531)",72,50,0,1,"2018-04-16 10:25:39","1533.99"
"grafana/loki","54b334eb9e1923d9d532f3ce2d2d0d57fe688c72","periklis","2021-10-01 15:23:18","false","Disable multi-arch builds",138,41,0,1,"2018-04-16 10:25:39","1260.96"
"grafana/loki","6f8bfe0c79fda038819426d989bb262a492f692c","owen-d","2020-09-22 13:34:46","true","Ruler docs + single binary inclusion (#2637)

* starts alerting docs

* ruler in single binary

* make docs interactive

* alerting docs

* ruler prom alerts endpoint

* Apply suggestions from code review

Co-authored-by: Diana Payton <52059945+oddlittlebird@users.noreply.github.com>

* doc fixes

* capitalize ruler

* removes double spaces

* Update docs/sources/alerting/_index.md

Co-authored-by: Diana Payton <52059945+oddlittlebird@users.noreply.github.com>

* Apply suggestions from code review

Co-authored-by: Ed Welch <ed@oqqer.com>
Co-authored-by: Diana Payton <52059945+oddlittlebird@users.noreply.github.com>

Co-authored-by: Diana Payton <52059945+oddlittlebird@users.noreply.github.com>
Co-authored-by: Ed Welch <ed@oqqer.com>",114,29,0,1,"2018-04-16 10:25:39","886.63"
"grafana/loki","91d5cce8ad74825dd872aa408833281ff7025c55","owen-d","2021-11-03 13:49:04","true","index-gw sts doc fix. closes #4583 (#4616)

* index-gw sts doc fix. closes #4583

* Update docs/sources/operations/storage/boltdb-shipper.md

Co-authored-by: Kaviraj <kavirajkanagaraj@gmail.com>

Co-authored-by: Kaviraj <kavirajkanagaraj@gmail.com>",170,42,0,1,"2018-04-16 10:25:39","1292.89"
"grafana/loki","499e4efc24d03b0e0029d62010a76a107bf135ab","owen-d","2020-09-30 18:37:02","true","shows cortextool lint command for loki in alerting docs (#2705)",119,29,0,1,"2018-04-16 10:25:39","894.84"
"grafana/loki","3c16658ee07e92b9271d2c42f93add85949eb3ae","DylanGuedes","2021-10-29 06:06:21","true","Loki: Append loopback to ingester net interface default list (#4570)

* Move LoopbackInterfaceName to its own package.

- Create new package `util/net` and puts `LoopbackInterfaceName` there
- Modify distributor_test to use `util/net` package

* By default, append loopback to ingester interfaces.

- Append the loopback net interface to the list of net interfaces used
  by the ingester ring. The append only occurs if the ingester net
interfaces are default
- Add CHANGELOG entry

* Test ring net interface behavior.

- Add tests to check the current net interface name resolution. The
  tests checks if the ingester ring net interface names are correctly
copied to other rings",168,42,0,1,"2018-04-16 10:25:39","1288.57"
"grafana/loki","2758dc659acbf5682a9655422b43396a1fed5a83","sandeepsukhani","2022-05-02 08:09:22","true","boltdb shipper index list cache improvements (#6054)

* bypass index list cache when doing query time downloading of index

* detect and refresh stale index list cache during sync",80,49,0,1,"2018-04-16 10:25:39","1476.91"
"grafana/loki","1b6d0bf3a099e8dad0d7908e0c6eefa4a92f80de","jonathanmorais","2022-08-20 14:20:02","true","feat: add kms ecryption (#6926)",82,52,0,0,"2018-04-16 10:25:39","1585.16"
"grafana/loki","9ad05f25da1a123e0ce9aa9dae7c1196e0630823","dannykopping","2021-10-28 22:18:30","true","Adding recording rules dashboard (#4575)

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",167,42,0,1,"2018-04-16 10:25:39","1288.25"
"grafana/loki","bbe68802d14a62a1f3c2d8f05356b50f4ad18bb6","sandeepsukhani","2022-10-07 16:18:48","true","lock boltdb and tsdb index while queries are in process (#7367)

**What this PR does / why we need it**:
We noticed ingesters and index-gateways panicking when using `tsdb` as
an index store with the latest build. This is caused by closing `mmap`
while the index queries are still being processed. This PR takes care of
it by locking the index until we are done querying the index.

**Checklist**
- [x] Tests updated",94,54,1,1,"2018-04-16 10:25:39","1632.25"
"grafana/loki","7f629c88497581bd9d1f73e2f8778b73c970d99b","vlad-diachenko","2022-09-16 10:13:03","true","[loki] Azure auth using Service Principal (#7179)

This PR adds the ability to use Service Principal credentials to
authenticate through Azure OAuth. It might be needed when we want to
access Azure Blob storage from another tenant.
Previously we could use only StorageAccount key that can not be used
cross-tenant.",88,53,1,0,"2018-04-16 10:25:39","1610.99"
"grafana/loki","47b79f3ea5d089aa77914441aca68c3bf7e2607f","cyriltovena","2020-04-27 13:24:40","true","Update cortex to latest. (#1982)

* Update cortex to latest.

This brings fixes for traceID in the logger and swift.
I've also added a bit of configuration for swift.

Fixes https://github.com/grafana/loki/issues/905

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes a test.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Update go.sum

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",116,24,0,1,"2018-04-16 10:25:39","741.62"
"grafana/loki","42df286b7eebc6cffcbcc4593e3aa2ec81d6c9ae","tomwilkie","2019-02-06 19:48:43","false","Factor out mostCommon function, test it, fix it.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",76,10,0,0,"2018-04-16 10:25:39","290.39"
"grafana/loki","928acc17a28a708628afbffb00a138e4fdca6966","tomwilkie","2019-01-31 11:28:47","false","Look for promtail image in promtail dashboards.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",73,9,0,0,"2018-04-16 10:25:39","285.04"
"grafana/loki","8ee0d62d9ee8c8c16a30fbe5eb43e0e619a0ac15","cyriltovena","2022-06-20 07:50:29","true","Fixes bad initialization for uniqueString (#6432)",67,50,0,1,"2018-04-16 10:25:39","1524.89"
"grafana/loki","adc18bff34291d2765a24fc48b9e10564213e041","cyriltovena","2019-05-13 20:56:40","false","add more memory to circle ci",99,13,0,1,"2018-04-16 10:25:39","392.69"
"grafana/loki","ce2cd15e63ea0c59047f4c48fee5c1eaf97ce0ee","yubozhao","2019-02-21 18:54:05","false","nit typo",79,10,0,0,"2018-04-16 10:25:39","305.35"
"grafana/loki","d5c840bd6642292348059527e7a0a43be0b03e13","sandeepsukhani","2020-07-30 08:06:20","true","enforce requirment for periodic config for index tables to be 24h when using boltdb shipper (#2166)",128,27,0,1,"2018-04-16 10:25:39","834.4"
"grafana/loki","7fafe94e1abb230338e5ae0fd177216da3ad67af","sandeepsukhani","2022-02-10 08:24:03","true","add a ms instead of ns to end time of the rebound chunk interval (#5351)

* add a ms instead of ns to end time of the rebound chunk interval

conversion between ms and ns loses ns precision which causes us to not include all the logs

* improve error when failing to rebound chunk",282,46,0,1,"2018-04-16 10:25:39","1389.67"
"grafana/loki","ce945b42a4057a8f0d43e5a495a6145bd41ecd1b","sandeepsukhani","2019-08-20 12:42:24","false","fix data type passed to a function call and usage of oldest table number in bigtable backup",112,16,0,1,"2018-04-16 10:25:39","489.34"
"grafana/loki","74327e53747867a40fa02601cfaea889109468ab","periklis","2022-06-27 10:08:40","true","operator: Disable report on overlay openshift (#6504)",71,50,0,1,"2018-04-16 10:25:39","1531.99"
"grafana/loki","9900e6982038603c0624877c05c967d72516dbee","shokada","2020-11-09 08:48:03","true","Fix error 'Unexpected: (""$"", ""$"") while parsing field definition' (#2895)",119,31,0,0,"2018-04-16 10:25:39","933.43"
"grafana/loki","e506f16030e38156641aecaa2ab1de63dc6883e2","daixiang0","2019-04-26 15:16:12","false","Add target config (#486)

* Add target config

Support costomize target config.

Signed-off-by: Xiang Dai <764524258@qq.com>

* Update default value

Signed-off-by: Xiang Dai <764524258@qq.com>

* bump helm version

Signed-off-by: Xiang Dai <764524258@qq.com>",95,12,0,0,"2018-04-16 10:25:39","375.45"
"grafana/loki","29cc5ad8be71972692fbbf0154d8973d59def671","liguozhong","2021-07-22 08:36:35","true","[ui] add '/config' page (#3619)

* [ui] add '/config' page

* config.go

* lint",97,39,0,1,"2018-04-16 10:25:39","1191.67"
"grafana/loki","17517bfea82eefb186b8495cf8749455f1d81f91","RutgerKe","2022-12-08 07:19:32","true","Promtail: Fix broken promtail-debug docker image (#7852)

**What this PR does / why we need it**:
The 'grafana/loki-build-image' version was not specified for the
promtail-debug docker image, resulting in a ~6 month old 'latest' image
as a build image. Updating this resulted in one more change: the newer
version has a different location for the 'dlv' binary.

The promtail-debug image would also hang waiting for a connection when
ran, this adds the same flag, `--continue`, as added to the loki debug
file in #1372.

**Special notes for your reviewer**:
I was interested in using the `-server.profiling_enabled=true` flag, to
enable pprof endpoints, and scrape with phlare. This flag is not
available in the non-debug version. Therefore I do not really care for
attaching a debugger right away. Open to removing that change though.

**Checklist**
- [x] Reviewed the `CONTRIBUTING.md` guide
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",95,56,1,0,"2018-04-16 10:25:39","1692.87"
"grafana/loki","bca29c011fe570a06c1f72551ecbb1ced59c8098","cyriltovena","2021-02-16 13:54:01","true","Embed timezone data in Promtail. (#3332)

Fixes #2995
Fixes #1361

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",134,34,0,1,"2018-04-16 10:25:39","1030.64"
"grafana/loki","337aed06a6d6b80ca09f88d6edc0066cedfe1c26","cyriltovena","2021-07-08 14:14:09","true","Fixes negative gauge in Promtail. (#3971)

* Fixes negative gauge in Promtail.

Fixes #3281

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* got linted.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",121,39,0,1,"2018-04-16 10:25:39","1177.91"
"grafana/loki","2f231a50ad9b02991ce1d5907316c960f20f3433","rfratto","2019-09-03 15:00:54","true","Add probot-stale configuration to close stale issues. (#964)

See [probot-stale's](https://github.com/probot/stale) repository for full
list of configuration options.",125,17,0,1,"2018-04-16 10:25:39","502.44"
"grafana/loki","600b6cf45932527d70e984704870f84f06ddce9e","rfratto","2019-08-12 21:45:02","true","Makefile: disable building promtail with systemd support on non-amd64 platforms (#888)

This commit introduces a stopgap to get ARM builds working by
temporarily disabling journal reading support on ARM platforms.",103,16,0,1,"2018-04-16 10:25:39","481.72"
"grafana/loki","2e95a64cb45e1f2cffcaaca0dea6ee8f7b7741dd","sandeepsukhani","2022-07-28 12:29:42","true","query-tee: support for multi backend response comparison and disabling query proxy for select backends (#6736)

* add support for comparing responses with multiple secondary backends

* allow disabling read proxy for select secondary backends

* Update tools/querytee/proxy.go

Co-authored-by: Salva Corts <salva.corts@grafana.com>

Co-authored-by: Salva Corts <salva.corts@grafana.com>",77,51,0,1,"2018-04-16 10:25:39","1563.09"
"grafana/loki","7f4d6d5912b65abd8d1eca7dd7636839a3fb1a8e","sandeepsukhani","2020-10-28 08:23:14","true","fix panic in ingester when not running with boltdb shipper while queriers does (#2830)",123,30,0,1,"2018-04-16 10:25:39","922.41"
"grafana/loki","8ef3d5fee9653f8e542bd01cfb50cf05005b00e4","sandeepsukhani","2021-08-17 07:28:13","true","add a storage client for boltdb-shipper which would do all the object key management for storage operations (#4128)

* add a storage client for boltdb-shipper which would do all the object key management for storage operations

* changes suggested from PR review",131,40,0,1,"2018-04-16 10:25:39","1216.63"
"grafana/loki","25912ea02ddf3e868f1cc187b6cd57c665592cf6","sandeepsukhani","2022-07-05 07:50:29","true","generic index compactor (#6537)

* make compactor generic to support compacting various index types

* implement and register compaction for boltdb-shipper index type

* lint and fix broken test

* add more comments

* fix some code and tests

* remove duplicate user-id kv in logger

* some improvements in code and test cases

* lint",72,51,0,1,"2018-04-16 10:25:39","1539.89"
"grafana/loki","9988ce4b9fb9b521093682761e409c71ca0ab4a1","cyriltovena","2020-05-11 16:00:40","true","Improve protobuf serialization (#2031)

* Generate custom proto type for Streams.

This is the first step to improve protobuf serialization.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Improve protobuf serialization allocations.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Saves allocations by stringifying labels only once.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",117,25,0,1,"2018-04-16 10:25:39","755.73"
"grafana/loki","53075db577c72a5649fdb50020590382812bf0f9","cyriltovena","2019-05-07 15:52:58","true","Send logs to multiple loki instances (#536)

* Adds the ability to provide multiple Loki URL

For backward compatibility `client:` still works with flag.

* add some tests for multi client

* update ksonnet module to support multiple client

* fix comment

* fix lint issues",100,13,0,1,"2018-04-16 10:25:39","386.48"
"grafana/loki","095b4a1cb789e36458fdbb1360209865a8f97515","cyriltovena","2020-11-09 13:43:57","true","Fixes a panic with the logql.NoopPipeline. (#2901)

Totally forgot that now we can't share this across multiple queries since they hold a map.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",120,31,0,1,"2018-04-16 10:25:39","933.64"
"grafana/loki","5739150136f77f40464bf24e04309237dd8e86a3","cyriltovena","2020-01-13 15:18:37","true","Fixes bad json in Loki API documentation. (#1508)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",99,21,0,1,"2018-04-16 10:25:39","632.45"
"grafana/loki","34f9649c6d6a241697eea58d67cfa364c2381d94","cyriltovena","2022-03-17 07:06:07","true","Remove more unused code (#5638)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",307,47,0,1,"2018-04-16 10:25:39","1426.61"
"grafana/loki","bc3ac62b065b724676f554c291ec19e70a506ac5","tomwilkie","2018-04-23 19:53:40","true","Merge pull request #4 from grafana/ingester-lifecycle

Ingester lifecycle, various other fixes.",0,0,0,0,"2018-04-16 10:25:39","7.39"
"grafana/loki","2424a9f2b2834b408b80a4797a92132f726738ef","tomwilkie","2018-04-17 14:04:10","false","Save images and reload them in the deploy step.",0,0,0,0,"2018-04-16 10:25:39","1.15"
"grafana/loki","eb1b72ab80a7acc603db8c59e7139fa79be632f9","MasslessParticle","2023-02-22 19:07:55","true","Fix ruler deadlock (#8486)

A circular dependency between the Prometheus rules.Manager and the
MemStore causes occasional deadlock in the rulers.

This change makes both the manager and the memstore rely on the
`GroupLoader` interface to break the circular dependency. The manger
holding the `GroupLoader` only ever adds rules to it so we add another
layer to cleanup any leftover state after an update happens.

This supersedes https://github.com/grafana/loki/pull/8453

---------

Co-authored-by: Michel Hollands <42814411+MichelHollands@users.noreply.github.com>",66,58,1,1,"2018-04-16 10:25:39","1767.36"
"grafana/loki","965650740cb54d6a2cc5ee2f931ea01af44ac48e","MasslessParticle","2022-08-16 16:25:16","true","Disable distributed cache for the default loki local config (#6925)",83,52,0,1,"2018-04-16 10:25:39","1581.25"
"grafana/loki","9d20bed26a3ba40fedef07c48c25debea7fa267c","MasslessParticle","2023-03-22 16:10:11","true","Short circuit parsers (#8724)

In many cases we only need a few labels from a line. Because most of our
parsers parse lines incrementally, we can stop parsing a line after we
have all the labels we want from it.

This pr uses `ParserHints` to keep track of the number of extracted
labels. It also provides a way for parsers to know when they should stop
parsing.

Notes:
- parsers had inconsistent ordering between the `ShouldExtract` call and
adding the `_extracted` label to duplicates. This PR makes appending
`_extracted` always happen before `ShouldExtract` to keep counts of what
is extracted compared to expected labels consistent.

Next Steps:
- When the user specifies a query with a grouping containing the
`_extracted` label but there is no duplicate between the passed line and
labels, short circuiting will not work. I'll address this in a follow up
PR.

Benchmarks:
To try and show a balanced view of what this buys us, this pr picks a
label our of the middle of a line. In a best case this might be much
better. In the worst case, we have to parse the whole line.

```
benchstat short_circuit_old.txt short_circuit_new.txt
name                               old time/op    new time/op    delta
KeyExtraction/json-8                  456ns ± 3%     256ns ± 2%  -43.84%  (p=0.000 n=9+10)
KeyExtraction/logfmt-8                347ns ± 4%     171ns ± 2%  -50.86%  (p=0.000 n=10+10)
KeyExtraction/logfmt-expression-8     552ns ± 2%     368ns ± 2%  -33.23%  (p=0.000 n=9+10)

name                               old alloc/op   new alloc/op   delta
KeyExtraction/json-8                  5.00B ± 0%     5.00B ± 0%     ~     (all equal)
KeyExtraction/logfmt-8                5.00B ± 0%     5.00B ± 0%     ~     (all equal)
KeyExtraction/logfmt-expression-8     16.0B ± 0%     16.0B ± 0%     ~     (all equal)

name                               old allocs/op  new allocs/op  delta
KeyExtraction/json-8                   1.00 ± 0%      1.00 ± 0%     ~     (all equal)
KeyExtraction/logfmt-8                 1.00 ± 0%      1.00 ± 0%     ~     (all equal)
KeyExtraction/logfmt-expression-8      2.00 ± 0%      2.00 ± 0%     ~     (all equal)
```

---------

Co-authored-by: J Stickler <julie.stickler@grafana.com>",83,59,1,1,"2018-04-16 10:25:39","1797.24"
"grafana/loki","da18cb343a9d5343dc846692df0a8da875c9573a","tomwilkie","2018-11-22 15:51:30","false","Add option to disable auth when running locally.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",5,7,0,0,"2018-04-16 10:25:39","216.23"
"grafana/loki","1319b622c47663bbdebb60b314d45a3642df3a82","tomwilkie","2019-05-08 08:07:37","false","Review feedback.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",98,13,0,0,"2018-04-16 10:25:39","387.15"
"grafana/loki","191a8a6f9d4ae67f8dc29e6f4dc7c1b38954bc5b","ssncferreira","2022-01-06 11:46:58","true","Store metrics queueTime in seconds (#5052)

* Store metrics queueTime in seconds

* Address comments

* Helper function to convert seconds to nanoseconds",251,45,0,0,"2018-04-16 10:25:39","1355.81"
"grafana/loki","221fd382a945960b1e68d248fda2671df1244619","cyriltovena","2020-11-24 17:55:30","true","Move CI to helm3. (#2986)

* Move CI to helm3.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Rollback to v3.2.3

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",111,31,0,1,"2018-04-16 10:25:39","948.81"
"grafana/loki","c8f3df33cfc8bc82bdd8c769cc475e7016dceb00","cyriltovena","2021-11-04 11:17:22","true","Promtail Kafka target (#4568)

* Adds a kafka target manager in promtail.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add validations.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Working on tests.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Moar test for the fanout client.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Finishing off tests.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* final  adjustement

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Adding topics discovery.
Still needs to finish tests.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Finishing off testing it.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Wip

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Revert config changes.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* lint

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add group id as discovered label

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* linter

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add tools for running kafka and testing locally.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* got linted shell

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Update sarama to compile in ARM.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add documentation for kafka target.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Improve code comment.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* add a few s's

* Better cancellation support.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* adds `__meta_kafka_` suffix to discovered labels.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

Co-authored-by: Edward Welch <edward.welch@grafana.com>",171,43,0,1,"2018-04-16 10:25:39","1293.79"
"grafana/loki","06a89ea0ee0a58df343c0a25ad954d36b69f626c","cyriltovena","2020-11-25 07:30:23","true","Fixes vector grouping injection. (#2975)

* Fixes vector grouping injection.

During an improvement I introduced a bug where we would pre-aggregate some range vector
aggregations, although the result is not the same.

We can only inject vector grouping in range vector if the operation is associative through grouping.

This is not the case for max/min/stddev/stddvar/quantile/avg_over_time.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* got linted.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",112,31,0,1,"2018-04-16 10:25:39","949.38"
"grafana/loki","a411bb9420ec5313e51469ade32f345296b7d4bd","cyriltovena","2022-02-25 07:03:11","true","Disable sharding of count/avg when labels are mutated (#5474)",301,46,0,1,"2018-04-16 10:25:39","1404.61"
"grafana/loki","93f2b2d89b53424ac1a6ecb6edd4a23044a911ca","cyriltovena","2021-03-10 02:42:22","true","Fixes split interval for metrics queries. (#3459)

The step needs to be taken into account:
- to be removed on each split end.
- to not split queries that have a step lower than the split interval.

The code is taken from Cortex but adjusted to keep the nanoseconds precision.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",148,35,0,1,"2018-04-16 10:25:39","1054.18"
"grafana/loki","5e527a03ccf3a5457ad768b6f0569cd4c05ab2ac","slim-bean","2020-01-22 18:03:22","true","1.3.0 Release (#1563)

* updating changelog and versions for 1.3.0 release

Signed-off-by: Edward Welch <edward.welch@grafana.com>

* fixing incorrect quote

Signed-off-by: Edward Welch <edward.welch@grafana.com>",96,21,0,1,"2018-04-16 10:25:39","641.57"
"grafana/loki","ea5eec2abff887c9097d0a1e2dbe42c9a6ac3ae8","slim-bean","2019-12-05 14:42:38","false","respond to label queries at `loki/api/v1/labels` instead of `loki/api/v1/label`",93,20,0,1,"2018-04-16 10:25:39","594.43"
"grafana/loki","3467440b301cd88d2b6edefa39fac75771240568","sh0rez","2019-09-10 15:20:14","true","fix(distributor): parseError BadRequest (#975)

When the label validation in the distributor failed, it was reported as 500
Internal Server Error instead of 400 BadRequest. Fixes that.",117,17,0,0,"2018-04-16 10:25:39","509.45"
"grafana/loki","885c64ff5100f3fa4b7297906d47259d945877ac","EnessenE","2023-08-10 14:27:25","true","Documentation: Remove a lost comma (#10203)

**What this PR does / why we need it**:

Found a lost comma in the cache configuration yaml example

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ x ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ x ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",53,64,1,0,"2018-04-16 10:25:39","1940.42"
"grafana/loki","b4fc43fd3afe78e6f08b5a92a8cda4ca3884f53b","blockloop","2021-04-27 14:57:18","true","LOG-1247: add support for tolerations (#38)",175,36,0,0,"2018-04-16 10:25:39","1106.94"
"grafana/loki","0d3815edc315fa9598e733afb37b52f784215bd6","davkal","2018-12-17 05:54:50","true","Merge pull request #117 from daixiang0/state-entrance

state loki entrance",36,8,0,0,"2018-04-16 10:25:39","240.81"
"grafana/loki","f9c3f7baef56bbde64756067b617836038c4af7e","davkal","2019-03-28 15:42:50","true","Update operations.md",92,11,0,0,"2018-04-16 10:25:39","342.22"
"grafana/loki","36109eb09a4edf70bc9a3186836c01c366f26e20","afayngelerindbx","2022-08-30 13:34:30","true","compactor: prefetch existing compacted user index files in parallel (#6803)

**What this PR does / why we need it**:
Before this change, these files are fetched while [holding a table global lock](https://github.com/grafana/loki/blob/a1e75da9707d4fe5bacf5d3aea947225c5781d09/pkg/storage/stores/shipper/index/compactor/table_compactor.go#L195), serializing fetches.

I chose the approach of prefetching index files over attempting to change the locking pattern to allow parallel, on-demand fetches because the complexity of parallelizing on-demand fetches outweighed the benefits of avoiding extra fetches. More specifically, this patch trades off fetching idle, non-compactable index files in favor of avoiding blocking during compactions. The extra fetches are parallelized and so should incur a negligible wall clock penalty even for large numbers of tenants(e.g. 1k idle tenants at 50 threads and 500ms to fetch is ~10s).

**Which issue(s) this PR fixes**:
This should help with #6775, without completely resolving it.

**Checklist**
This change does not introduce any settings, metrics etc. It should be transparent from a user perspective. Therefore, I don't believe it merits documentation/changelog updates.

- [x] Tests updated",80,52,1,0,"2018-04-16 10:25:39","1595.13"
"grafana/loki","c538171d6573525b58aa0fa393636eddc9990d61","KMiller-Grafana","2021-11-05 23:51:51","true","Docs: revise v2.4 release notes (#4675)",176,43,0,0,"2018-04-16 10:25:39","1295.31"
"grafana/loki","269b73ddbf6177d0bdc6bbb4c036bb308fd9a918","tomwilkie","2018-11-20 12:18:51","false","Fail push-images correctly.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",5,7,0,0,"2018-04-16 10:25:39","214.08"
"grafana/loki","36d832e5bec008cf63dfb1498b148aab526a6651","sleleko","2019-04-24 14:30:33","false","Update api documentation (#497)

* Added example of usage API on Python

* fix link",97,12,0,0,"2018-04-16 10:25:39","373.42"
"grafana/loki","f289384a1ca335529936e07e90a64745b30ddd57","rfratto","2019-07-19 17:56:33","false","promtail: clarify linux build instructions in docs",105,15,0,1,"2018-04-16 10:25:39","458.56"
"grafana/loki","9eefae10fd2dae285526a20ce8ffa908643d3e07","btaani","2022-11-16 10:56:55","true","operator: Fix broken links in README.md (#7702)",93,55,1,0,"2018-04-16 10:25:39","1671.02"
"grafana/loki","7cfce6e5e4aafd4562a48238c8998883fadfc2e6","JadCham","2019-06-12 20:35:48","false","Add dynamodb sample for overriding default provisioning capacity units (#626)",108,14,0,0,"2018-04-16 10:25:39","421.67"
"grafana/loki","becc9bee99f431c6b9a7bf47ff45df00494050e1","DylanGuedes","2023-08-23 20:45:21","true","Jsonnet: Add `default` section to runtime jsonnet file (#10330)

**What this PR does / why we need it**:
Add a `default` section to our runtime jsonnet file.
The `default` section was introduced by
https://github.com/grafana/loki/pull/10193.",49,64,1,1,"2018-04-16 10:25:39","1953.68"
"grafana/loki","27b9fe50f0fe85607706a0ac6aa45ad032d0bf0a","DylanGuedes","2022-07-28 13:09:14","true","Fix Promtail dashboard. (#6796)

Fix Promtail production dashboard/panels. Error message was `bad_data: 1:40: parse error: unexpected character inside braces: '~'`.",77,51,0,1,"2018-04-16 10:25:39","1563.11"
"grafana/loki","07f95849d2e499b5a599551b86192aefa5fdb9a8","slim-bean","2019-08-06 15:33:24","false","Reorder relabeling rules to prevent pod label from overwriting config defined labels",99,16,0,1,"2018-04-16 10:25:39","475.46"
"grafana/loki","23c16a9ac44b95da1fcf322006c2687f632258bc","slim-bean","2019-05-16 11:31:54","false","updating to match websocket api changes",101,13,0,1,"2018-04-16 10:25:39","395.3"
"grafana/loki","4aeeeea1c813c253eae3ffed19a087608971baa7","slim-bean","2020-02-12 03:58:46","false","Allow a metric defined as a counter to match all lines, useful for creating line count metrics which include all your labels.
Found a bug in the the test runner where it didn't fail if the actual error was nil but the test expected an error
Added some tests to the counters to test valid configs

Signed-off-by: Edward Welch <edward.welch@grafana.com>",114,22,0,1,"2018-04-16 10:25:39","660.98"
"grafana/loki","1c954166b87a3b4920a39d9c8837fc3c93bd85bc","MasslessParticle","2023-01-23 07:31:18","true","Fix documentation linter errors (#8229)",82,57,1,1,"2018-04-16 10:25:39","1737.88"
"grafana/loki","5ea38fbd51a075ac6664c81d507b71abb9de722e","ashwanthgoli","2022-09-02 18:18:00","true","tsdb: build rotated heads asynchronously (#6956)

<!--  Thanks for sending a pull request!  Before submitting:

1. Read our CONTRIBUTING.md guide
2. Name your PR as `<Feature Area>: Describe your change`.
  a. Do not end the title with punctuation. It will be added in the changelog.
  b. Start with an imperative verb. Example: Fix the latency between System A and System B.
  c. Use sentence case, not title case.
  d. Use a complete phrase or sentence. The PR title will appear in a changelog, so help other people understand what your change will be.
3. Rebase your PR if it gets out of sync with main
-->

**What this PR does / why we need it**:
Currently `Append` call to the head has to wait for block creation to complete when rotating head.
And since we rotate head every 15m (default period), this would result in latency spikes at these times.
This PR moves the TSDB build step to an async routine.

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

<!--
Note about CHANGELOG entries, if a change adds:
* an important feature
* fixes an issue present in a previous release, 
* causes a change in operation that would be useful for an operator of Loki to know
then please add a CHANGELOG entry.

For documentation changes, build changes, simple fixes etc please skip this step. We are attempting to curate a changelog of the most relevant and important changes to be easier to ingest by end users of Loki.

Note about the upgrade guide, if this changes:
* default configuration values
* metric names or label names
* changes existing log lines such as the metrics.go query output line
* configuration parameters 
* anything to do with any API
* any other change that would require special attention or extra steps to upgrade
Please document clearly what changed AND what needs to be done in the upgrade guide.
-->
**Checklist**
- [ ] Documentation added
- [ ] Tests updated
- [ ] Is this an important fix or new feature? Add an entry in the `CHANGELOG.md`.
- [ ] Changes that require user attention or interaction to upgrade are documented in `docs/sources/upgrading/_index.md`

Signed-off-by: Ashwanth Goli <iamashwanth@gmail.com>
Co-authored-by: Owen Diehl <ow.diehl@gmail.com>",79,52,1,0,"2018-04-16 10:25:39","1597.33"
"grafana/loki","ec1ae42083fde3472917630e0aa25cdffe96d8f7","jeschkies","2022-02-15 12:59:53","true","Verify that drone.yml was updated. (#5396)",288,46,0,1,"2018-04-16 10:25:39","1394.86"
"grafana/loki","f35409c713831dc52c04ac746b4ea0d11c9720c5","tomwilkie","2018-05-18 19:29:19","false","Pad distinct labels to make output prettier.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",0,1,0,0,"2018-04-16 10:25:39","32.38"
"grafana/loki","b04af08b1b593a4694947b14873dae16bda23ffb","slim-bean","2021-04-15 16:07:35","true","Remove codecov (#3615)

* remove codecov from CI, also remove circleci tests as we run these somewhere else now already.

* leaving an empty test step for now",162,36,0,1,"2018-04-16 10:25:39","1089.74"
"grafana/loki","ffb961c439b086136db84b6296d35e376749b09f","athira-varghese","2023-03-28 13:52:00","true","feat(storage): add support for IBM cloud object storage as storage client (#8826)

**What this PR does / why we need it**:
   Add support for IBM cloud object storage as storage client
   
**Which issue(s) this PR fixes**:
Fixes NA



**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [x] Tests updated
- [ ] `CHANGELOG.md` updated

---------

Signed-off-by: Shahul <shahulsonhal@gmail.com>
Co-authored-by: Aman Kumar Singh <amankrsingh2110@gmail.com>
Co-authored-by: Suruthi-G-K <shruthi.suruthi@gmail.com>
Co-authored-by: tareqmamari <tariq.mamari@de.ibm.com>
Co-authored-by: shahulsonhal <shahulsonhal@gmail.com>
Co-authored-by: Aditya C S <aditya.gnu@gmail.com>
Co-authored-by: Tareq Al-Maamari <tariq.mamari@gmail.com>",82,59,1,0,"2018-04-16 10:25:39","1803.14"
"grafana/loki","20b13cb3178161c5a5339aa10bb47fb4f2b18a38","MichelHollands","2023-02-02 16:20:15","true","Fix comparison in a delete request integration test (#8389)

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",79,57,1,1,"2018-04-16 10:25:39","1747.25"
"grafana/loki","02c3e6a1aafb62c1ed10f222b621baf0af1ab1d9","GrafanaWriter","2022-06-27 10:05:34","true","Updating maintainers.md (#6466)

* Updating maintainers.md

To be consistent with other OSS products, adding the maintainer of the technical documentation to the list of maintainers.

* Update MAINTAINERS.md

Adding further detail to properly explain maintainer role for docs.",71,50,0,0,"2018-04-16 10:25:39","1531.99"
"grafana/loki","6b97de765ecded132bf7837765004032ea5ae278","owen-d","2022-05-17 18:32:42","true","tsdb creation supports fingerprint overrides (#6178)",74,49,0,1,"2018-04-16 10:25:39","1492.34"
"grafana/loki","e5c514359bf57a2fb75b909dd7ef29cc97785b0e","kavirajk","2022-01-14 11:37:35","true","Fix broken `template_variable` doc link (#4960)",264,45,0,1,"2018-04-16 10:25:39","1363.8"
"grafana/loki","37a7189d4ed76655144d982e2eeebf495e0809ea","robbymilo","2021-03-26 08:55:53","true","docs: add title to Lambda Promtail (#3525)",143,35,0,0,"2018-04-16 10:25:39","1070.44"
"grafana/loki","a48cc047777eabf71a772d4325739f59a9bbee1d","slim-bean","2019-05-23 14:01:43","false","Also bumping lok-stack version which needs to be done if the loki or promtail chart versions are changed (#612)",107,13,0,1,"2018-04-16 10:25:39","402.4"
"grafana/loki","0d8cd062ffc62cdbb7429d5827ecb22adcf92a91","granular-ryanbonham","2019-03-25 20:11:48","false","Change Loki's Pod and Conainter Security Policies.",92,11,0,0,"2018-04-16 10:25:39","339.41"
"grafana/loki","22779e13c50b617637fbeb7ce6fdcb8a6912615a","MichelHollands","2023-06-09 12:33:15","true","Fix date template function with epoch times (#8886)

**What this PR does / why we need it**:

Adds new toUnixEpoch... functions to convert from a string with a
Unix/Epoch time to an integer that can be used in the existing `toDate`
function.

Note that these are the opposites of some of the functions introduced in
https://github.com/grafana/loki/pull/8774.

**Which issue(s) this PR fixes**:
Fixes https://github.com/grafana/loki/issues/8624.

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [X] Documentation added
- [X] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

---------

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",68,62,1,1,"2018-04-16 10:25:39","1879.34"
"grafana/loki","1d87a2285eedc0ce1e07a488c07a62938798f48b","negbie","2018-12-14 21:26:47","false","Add line length to batchSize (#108)

* Add line length to batchSize

Signed-off-by: Eugen Biegler <nupagadi@posteo.de>

* Reset batchSize in timer condition too

Signed-off-by: Eugen Biegler <nupagadi@posteo.de>",28,8,0,0,"2018-04-16 10:25:39","238.46"
"grafana/loki","208798e0200fd82cddb818ea7c3129d5abeda3d0","tomwilkie","2018-12-18 13:52:44","true","Add link to protobuf and client library to API docs. (#147)

* Add link to protobuf and client library to API docs.

* Link to API docs from README

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>

* Add more words about auth.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",34,8,0,0,"2018-04-16 10:25:39","242.14"
"grafana/loki","1107c8bd45e5f306b85b0bf92147dbdfdf313807","davkal","2019-03-18 15:35:31","true","Merge pull request #355 from granular-ryanbonham/helm_timeouts

Helm Chart Production Improvements.",102,11,0,0,"2018-04-16 10:25:39","332.22"
"grafana/loki","d0bbeffbb246fb99e3f3d90fd33bf0c08eaee4ec","dannykopping","2022-11-28 13:59:01","true","Update delve version to be compatible with Go 1.19 (#7793)

In order to use the `production/docker` with an interactive debugger, we
need to upgrade the Delve tool to a version that works with the version
of Go which Loki uses: 1.19",97,55,1,1,"2018-04-16 10:25:39","1683.15"
"grafana/loki","3ef030ab91216262e35b6707d9d6e802338c51e8","periklis","2021-12-07 10:25:14","false"," Move github actions to top-level github directory",214,44,0,1,"2018-04-16 10:25:39","1326.75"
"grafana/loki","4a208ce6e68231b431d54b6070e2301aa28c01ba","cyriltovena","2020-04-22 12:17:49","true","Improve the local config to work locally and inside docker. (#1963)

* Improve the local config to work locally and inside docker.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add a file specifically for docker loki config.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",118,24,0,1,"2018-04-16 10:25:39","736.58"
"grafana/loki","b11d2effe29d0ee497def7eef84634310563c602","cyriltovena","2021-03-29 07:46:18","true","Fixes a bug in MatrixStepper when sharding queries. (#3550)

* Fixes a bug in MatrixStepper when sharding queries.

Since we split correctly metric queries, this bug has show itself.
Basically we were not correctly stepping through time. We should always start from start, add the step until the start is after the end.

For more read: https://www.robustperception.io/step-and-query_range

Fixes #3541

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes tests.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes tests. for real.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Not easy to get those test working.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",144,35,0,1,"2018-04-16 10:25:39","1073.39"
"grafana/loki","43e542ee64cd2488e26ebe9592841cc0d1a79cea","changhyuni","2023-08-22 06:35:13","true","Storage: Remove `SignatureVersionv2` from the AWS S3 API request authentication. (#10295)

AWS S3 stopped accepting requests signed using SigV2 in all regions on June 24, 2019, any requests signed using SigV2 made after this time will fail.

* https://docs.aws.amazon.com/AmazonS3/latest/userguide/UsingAWSSDK.html#UsingAWSSDK-sig2-deprecation
* https://aws.amazon.com/blogs/aws/amazon-s3-update-sigv2-deprecation-period-extended-modified/",50,64,1,0,"2018-04-16 10:25:39","1952.09"
"grafana/loki","a6164c395bb8ba38859ee2419e08c4f70ecf308c","davkal","2018-12-17 05:51:31","true","Merge pull request #119 from daixiang0/fix-url

fix wrong url",35,8,0,0,"2018-04-16 10:25:39","240.81"
"grafana/loki","1925d77f65ae4a3d55d1b9bbf72096e43c491da4","MasslessParticle","2022-02-02 21:29:04","true","cleanup: consolidate util strings contain functions (#5304)

* Consolidate util strings contain functions

* fix test",278,45,0,1,"2018-04-16 10:25:39","1382.21"
"grafana/loki","adb4dc3e31f17685ec47d50d0d19bf22344647bd","tomwilkie","2018-11-20 12:05:53","false","Change image prefix to grafana/

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",5,7,0,0,"2018-04-16 10:25:39","214.07"
"grafana/loki","236ed187be5e33cd9d7c541b8394515122d261d6","Duologic","2021-09-09 00:29:48","true","fix(rules): upstream recording rule switched to sum_irate (#4217)

ref: https://github.com/kubernetes-monitoring/kubernetes-mixin/pull/619",127,41,0,0,"2018-04-16 10:25:39","1238.34"
"grafana/loki","9688f83954cd1a2515166d93acc4e4621e7a2666","hervenicol","2023-03-16 21:40:10","true","helm chart: fix role/PSP mapping (#8656)

**What this PR does / why we need it**:

Fixes role/PSP and role/SCC mapping in Helm chart.

**Which issue(s) this PR fixes**:
Fixes #8652

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

Co-authored-by: Herve Nicol <12008875+hervenicol@users.noreply.github.com>",86,59,1,0,"2018-04-16 10:25:39","1791.47"
"grafana/loki","8e80160db7a08eb02a8646340f622ab1783116de","cyriltovena","2020-04-03 19:46:31","true","Removes file size check for pipe, not provided by linux. (#1893)

* Removes file size check for pipe, not provided by linux.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Disable color on windows.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>
(cherry picked from commit 75730782a71d0d3944e8e29c959b79a7eb478395)",119,23,0,1,"2018-04-16 10:25:39","712.64"
"grafana/loki","f7cc7b035e397cee34907535baf8256f80e569ba","pracucci","2019-07-11 12:09:14","false","Redirect / to /targets in promtail server",101,15,0,0,"2018-04-16 10:25:39","450.32"
"grafana/loki","872a998fbba12c867a322cde864c465932f28d13","slim-bean","2020-04-30 13:00:31","true","make `loki_ingester_memory_streams` Gauge per tenant. (#2019)

Signed-off-by: Ed Welch <edward.welch@grafana.com>",119,24,0,1,"2018-04-16 10:25:39","744.61"
"grafana/loki","de2b0c6e9dcce028ed69c6e40f75e1ff0c081358","jeschkies","2023-04-04 19:13:25","true","Rename per-request query limits. (#9011)

**What this PR does / why we need it**:
`maxQueryTime` is more in line with the other per-request limits we
have.

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [x] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",81,59,1,1,"2018-04-16 10:25:39","1809.37"
"grafana/loki","8b71a44a86cdd54b169b7b7094087969303d68ca","cyriltovena","2022-01-04 19:27:23","true","Pre-allocate chunk buffer size (#4884)

* Pre-allocate chunk buffer size

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* add doc",253,44,0,1,"2018-04-16 10:25:39","1354.13"
"grafana/loki","b9463436b2a6372ccd468a5dc48be902a0fb9b6d","cyriltovena","2019-07-29 20:06:33","true","fix panic in docker driver for newer docker version (18.09.7+) (#813)",105,15,0,1,"2018-04-16 10:25:39","468.65"
"grafana/loki","47336cdbe62bd86b8ce5da576ccba95099248562","cyriltovena","2021-10-26 13:55:02","true","Fixes a panic in the labels API when no parameters are supplied. (#4554)

* Fixes the a panic in the labels API when no parameters are supplied.

We were supporting this before.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Remove bad test

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",167,42,0,1,"2018-04-16 10:25:39","1285.9"
"grafana/loki","9950046a4ba27e02d16e6825884f3e0479f757f6","cyriltovena","2021-02-18 14:21:25","true","Bound parallelism frontend (#3342)

* Bound parallelism at the roundtripper level.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* improve test and correctly forward ctx.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* lint and test.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",131,34,0,1,"2018-04-16 10:25:39","1032.66"
"grafana/loki","8272f0862111b3be7cd663f9d703af52a664d44f","rfratto","2019-09-03 14:21:41","false","docs: Clarify examples",125,17,0,1,"2018-04-16 10:25:39","502.41"
"grafana/loki","8b06eb66bf0651118e2bce68609e104f208fa15e","rfratto","2019-07-15 19:04:43","false","Rollback changes to Makefile and build/Dockerfile from #730 (#758)

This commit rolls back the changes to the Makefile and build/Dockerfile
that caused CGO_ENABLED=1 to be present during some builds. This commit
causes the journal support to be disabled in any build produced by make.

Journal support can still be enabled in a manual build:

  go build -o cmd/promtail/promtail cmd/promtail",97,15,0,1,"2018-04-16 10:25:39","454.61"
"grafana/loki","3f9b9cc9611105be4271a14e9c0f36dbd31bcbed","trevorwhitney","2023-01-11 18:25:36","true","[helm] fix race between minio bucket job and enterprise tokengen job (#8064)

**What this PR does / why we need it**:

This PR replaces https://github.com/grafana/loki/pull/7985. It solves
the same problem, which is the race condition between the minio create
bucket job and the enterprise tokengen job, but without removing minio.",100,57,1,1,"2018-04-16 10:25:39","1726.33"
"grafana/loki","dc1854eeaaf0d91127de2c8a54e970a70e1baa99","davkal","2019-03-26 08:52:56","true","Merge pull request #419 from granular-ryanbonham/fix_helm

Fix helm",92,11,0,0,"2018-04-16 10:25:39","339.94"
"grafana/loki","e3e4a2d9ae8fd1fda1eacb0d56448cee47ee52ec","tomwilkie","2019-01-17 11:06:49","true","Update vendored Cortex. (#213)

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",64,9,0,0,"2018-04-16 10:25:39","271.03"
"grafana/loki","6b83717339792c37fd65a70fbafefdb5e972d78e","tomwilkie","2018-06-27 08:22:39","false","Don't forget to register the metrics.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",3,2,0,0,"2018-04-16 10:25:39","70.91"
"grafana/loki","e76139d61b4ed804d7147530c3a98e52aac8693e","tomwilkie","2018-12-04 14:36:21","false","Fallback to lo0 if we can't find a interface to advertise. (#33)

* Fallback to lo0 if we can't find a interface to advertise.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>

* s/lo0/lo/

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",6,7,0,0,"2018-04-16 10:25:39","228.17"
"grafana/loki","9249ebc02200b764e62a9a05922b022ae81e40ac","owen-d","2020-11-05 06:59:50","true","Fix/validate compactor config (#2824)

* default compactor config throws error when compactor is a target or subtarget

* linting

* moves compactor config validation to NewCompactor fn",126,31,0,1,"2018-04-16 10:25:39","929.36"
"grafana/loki","802b337c635f4ebe7a9957e846dda4f0b83ca16e","GuiguiBlitz","2023-01-13 13:19:49","true","Update README.md (#8132)

**What this PR does / why we need it**:
Updates docker diagram after changes in #8019

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>
Co-authored-by: Danny Kopping <danny.kopping@grafana.com>",97,57,1,0,"2018-04-16 10:25:39","1728.12"
"grafana/loki","6d05ade6a83bc474f4f86589ab69576ac122a888","liguozhong","2022-11-29 14:14:00","true","[performance] metrics query: range vector support streaming agg when no overlap (#7380)

metrics query: range vector support streaming agg when no overlap",95,55,1,1,"2018-04-16 10:25:39","1684.16"
"grafana/loki","62f0596afe622d5cd8e6acedcd9da93245031f3f","MiggL","2022-09-16 11:49:29","true","Helm: Fix limits_config key in helm values file (#7182)",88,53,1,0,"2018-04-16 10:25:39","1611.06"
"grafana/loki","b2fe044279a963c9d6b2c4ffdd39ab333be92b9f","sh0rez","2019-08-15 20:14:51","true","chore(ci/cd): fix grafanasaur credentials and CircleCI image build (#900)

brrrrrrr",103,16,0,0,"2018-04-16 10:25:39","484.66"
"grafana/loki","2933ffecd381e96ea8305bdf55e8b896c05f5dc6","cyriltovena","2020-06-04 13:01:56","true","Add Aditya CS as a member of Loki. (#2170)

* Add Aditya CS as a member of Loki.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Update governance.md

* Update governance.md",129,26,0,1,"2018-04-16 10:25:39","778.61"
"grafana/loki","4b53909ccf0d137ff9dd09658f4dd1a999163cf5","cuishuang","2023-06-29 19:09:29","true","all: remove repetitive the (#9823)

**What this PR does / why we need it**:

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [x] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [x] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [x] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

Signed-off-by: cui fliter <imcusg@gmail.com>",59,62,1,0,"2018-04-16 10:25:39","1899.61"
"grafana/loki","a64e0eddfa980e5c04a2d598c7193c23e8101811","davkal","2019-03-19 15:54:56","true","Add example of client use to api.md

Fixes #220",96,11,0,0,"2018-04-16 10:25:39","333.23"
"grafana/loki","3b24a25a856df3d8c140a1b057b5d08d13cc3aa7","briangann","2019-06-17 14:20:40","true","Merge pull request #667 from grafana/20190614_rename_fluent_plugin

component/integrations: rename fluent plugin",96,14,0,0,"2018-04-16 10:25:39","426.41"
"grafana/loki","9d2c6cf2d30d325e9aae088d8c0fb116211ed6f7","tomwilkie","2019-01-29 09:39:26","false","s/__meta_kubernetes_container_name/__meta_kubernetes_pod_container_name/ for the helm chart too.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",67,9,0,0,"2018-04-16 10:25:39","282.97"
"grafana/loki","23d8c7c63c8b3cdc28645c7b50803ac5a53ddfa2","kevinburkesegment","2023-09-18 07:33:33","true","clients/pkg/promtail/client: better error on nil metrics (#10611)

Fixes #10610.

**Checklist**
- [X] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)


Not necessary:

- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",40,65,1,0,"2018-04-16 10:25:39","1978.13"
"grafana/loki","1763ebb5e98fa12b9c70c47c34ced97617ad47fe","periklis","2023-02-06 15:06:49","true","operator: Update operand Loki to v2.7.3 (#8397)",81,58,1,1,"2018-04-16 10:25:39","1751.2"
"grafana/loki","386e498092f15ed0292720719600aed501979780","wardbekker","2020-03-26 17:28:11","true","bump gem version (#1853)",120,23,0,0,"2018-04-16 10:25:39","705.54"
"grafana/loki","0b5996021fb16bc9404679e2c0028ba9fbfe95e2","slim-bean","2020-07-11 22:15:52","true","Loki: add -print-config-stderr flag to dump loki's runtime config to stderr (#2336)

* Loki: add -print-config-stderr flag to dump loki's runtime config to stderr

* add ability to print inline config for better readability in grafana

* add an option to log the config in reverse order to make viewing in Grafana easier.

Also added this capability to Promtail",121,27,0,1,"2018-04-16 10:25:39","815.99"
"grafana/loki","62403350a57bfb2460d0a070896f2137a342215a","owen-d","2023-04-03 16:57:15","true","remove redundant splitby middleware (#8996)

Found this double-copied line which a mistake. This PR removes one of
them which won't change behavior (besides removing duplicate spans/etc).",81,59,1,1,"2018-04-16 10:25:39","1808.27"
"grafana/loki","89b786fe51785dc6f0fce035b757cc992ba29f0a","MichelHollands","2023-05-25 08:34:22","true","Add instructions for Helm chart updates in the pull request template (#9514)

**What this PR does / why we need it**:

Add additional instructions for Helm charts in the pull request
template.

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

---------

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",68,61,1,1,"2018-04-16 10:25:39","1865.17"
"grafana/loki","1c7f791a1e963e312442ef3bdaba73b242ee99ad","CCOLLOT","2023-05-11 10:46:28","true","lambda-promtail: add terraform code to process s3 logs through SQS (#8700)

## Add Terraform sample code to process AWS S3 log files through an SQS
queue

Lambda-promtail supports processing AWS s3 logs files through an SQS
queue since #8231

As explained in the [documentation section of
lambda-promtail](https://github.com/grafana/loki/blob/main/docs/sources/clients/lambda-promtail/_index.md#triggering-lambda-promtail-via-sqs:~:text=Triggering%20Lambda%2DPromtail,DLQ%20redrive%20feature.),
this can be leveraged to re-process logs that lambda-promtail failed to
process (or send to loki) using a main SQS queue and a secondary SQS
dead-letter queue.
AWS has a feature called `SQS redrive`, which enables routing messages
pending in the DLQ back to the main (source) queue.

This PR demonstrates how to spin up this architecture using terraform.",76,61,1,0,"2018-04-16 10:25:39","1851.26"
"grafana/loki","17fdfcbaa1f3f1dc5c8261c6e981a5aff22e8f45","jeschkies","2023-01-16 11:52:45","true","Emit help message when check-mod fails (#8157)",95,57,1,1,"2018-04-16 10:25:39","1731.06"
"grafana/loki","947d0f1cbfc3bad31fd02180abe4b8ce9b9bcb72","jeschkies","2022-09-08 14:57:01","true","Automatically label Helm realted pull requests. (#7083)

**What this PR does / why we need it**:
Labelling Helm related pull requests with `area/helm` will ease
discovery.

Co-authored-by: Trevor Whitney <trevorjwhitney@gmail.com>",85,53,1,1,"2018-04-16 10:25:39","1603.19"
"grafana/loki","0a4bfbe4f76788d7bfa7ccd779771b3a7f71f8dd","kavirajk","2022-05-04 07:59:01","true","Remove nosiy ""inflight"" requests log entries (#6074)

We have enough metrics now (queue time, queue length and metrics.go statistics)
that makes these log entries obselete.

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",74,49,0,1,"2018-04-16 10:25:39","1478.9"
"grafana/loki","7ccd0ab8d0ef93947e9a7489359c10fbceadfb11","roidelapluie","2019-11-25 21:17:13","false","Use tenant as label name for discarded_samples metrics

discarded_samples should use the name labels as the other metrics.

Signed-off-by: Julien Pivotto <roidelapluie@inuits.eu>",83,19,0,0,"2018-04-16 10:25:39","584.7"
"grafana/loki","4834fdef16ebf27266f908efe4d3879f7277ccb2","yubozhao","2019-02-04 22:07:48","false","Add aws based storage configuration documentation",80,9,0,0,"2018-04-16 10:25:39","288.49"
"grafana/loki","56901f76b509fca5c82df533ec55916c24bffda8","davkal","2019-03-20 15:03:02","true","Merge pull request #411 from steven-sheehy/helm-cleanup

Add readiness probe to Helm chart and cleanup",92,11,0,0,"2018-04-16 10:25:39","334.19"
"grafana/loki","558cebf7a257fa5a76270626ce1b8a786536dd95","oleksii-boiko-ua","2023-05-30 09:16:01","true","helm: fix backend hpa missing parameter (#9548)

**What this PR does / why we need it**:

**Which issue(s) this PR fixes**:
Fixes #9547

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [ ] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [x] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

Co-authored-by: Michel Hollands <42814411+MichelHollands@users.noreply.github.com>",70,61,1,0,"2018-04-16 10:25:39","1870.2"
"grafana/loki","20726e6ba1a81f56a0bf0daa2ad3d51242fbcce5","sandeepsukhani","2021-11-08 10:15:02","true","fix flaky retention tests (#4697)",180,43,0,1,"2018-04-16 10:25:39","1297.74"
"grafana/loki","d10549e3ece02120974929894ee333d07755d213","sandeepsukhani","2023-05-22 05:56:53","true","helm: release a new helm charts to use k8s service for discover query-scheduler replicas (#9477)

**What this PR does / why we need it**:
Currently, we have a bug in our code when running Loki in SSD mode and
using the ring for query-scheduler discovery. It causes queries to not
be distributed to all the available read pods. I have explained the
issue in detail in [the PR which fixes the
code](https://github.com/grafana/loki/pull/9471).

Since this bug causes a major query performance impact and code release
might take time, in this PR we are doing a new helm release which fixes
the issue by using the k8s service for discovering `query-scheduler`
replicas.

**Which issue(s) this PR fixes**:
Fixes #9195",68,61,1,1,"2018-04-16 10:25:39","1862.06"
"grafana/loki","b687ec6e5bda396eac3acffda6857e1c223efc5a","sandeepsukhani","2019-08-28 08:05:02","false","vendoring: update cortex to latest master (#938)

* update cortex to latest master

using v3.4.0-rc.1 for go.etcd.io/etcd
v0.0.2 for github.com/prometheus/procfs
v1.0.0 for github.com/prometheus/client_golang
latest master for github.com/weaveworks/common with changes from https://github.com/weaveworks/common/pull/153

* fixed failing tests

* use large instance for test and lint jobs in CircleCI

* running only 6 test binaries in parallel

* removed resource type change for CircleCI

* changed GOGC to 10 for lint makefile target",122,16,0,1,"2018-04-16 10:25:39","497.15"
"grafana/loki","3a2b5696847f8891219ab1173da3bd8f544415bd","sandeepsukhani","2019-07-17 15:24:33","false","Added tail length limit to limit duration of live tailing of logs to 1 hour (#756)

* Added tail length limit to limit duration of live tailing of logs to 1 hour

* Some code refactoring suggested from PR review for live tailing duration limit

* Fixed error messages in live tailing of logs

* Fixed lint errors",101,15,0,1,"2018-04-16 10:25:39","456.46"
"grafana/loki","1cd37a306c7d8a71342cc6ab46497b62df5cc359","sandeepsukhani","2021-02-12 14:01:51","true","fix config for statefulset rulers when using boltdb-shipper (#3329)",128,34,0,1,"2018-04-16 10:25:39","1026.65"
"grafana/loki","d5783e86a3415cfd5d62f86ace88d33305be2284","DylanGuedes","2022-01-03 14:36:54","true","Copy `cortex/pkg/querier/astmapper` package dependency into Loki (#4982)

* Fork cortex `pkg/querier/asmapper` into Loki.

* Move away from cortex `pkg/querier/astmapper`.

* Fix lint issues.

- Use _ in argument of method `pkg/querier/astmapper/subtree_folder.go`
  since it is not being used
- Remove unnecessary cast from `subtree_folder.go`",255,44,0,1,"2018-04-16 10:25:39","1352.92"
"grafana/loki","bf1b5a5ced04bcf04aa899a7a872c423da2f6a50","DylanGuedes","2022-09-19 14:39:59","true","Project: Change PR template and CONTRIBUTING guide (#7116)

**What this PR does / why we need it**:
- Move contributing instructions from the PR template to the
CONTRIBUTING guide
- Rewrite the contributing guide
- Make the PR template slim by getting rid of sections that are optional
but often left blank by most contributors/maintainers
- We're making the PR template slim as we're using the merged PR body as
the merge commit message. Because the comments are often left there by
contributors, they're prone to be merged by maintainers, hence making
our commit log history dirty with a lot of undesired comments.",87,53,1,1,"2018-04-16 10:25:39","1614.18"
"grafana/loki","d970e737ab288e084acaecac3191f9584bc8afb4","kavirajk","2022-02-15 13:40:33","true","Add more context to tailer-> ingester connect error. (#5394)

NOTE: When client is tailing, Querier **has** to create grpc connections to **all** the ingesters.

Sometimes when ingester is rolloing out and Querier unable to connect to ingester when
client is tailing, then error message reported by Querier is confusing.

This PR add some context to it.

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",289,46,0,1,"2018-04-16 10:25:39","1394.89"
"grafana/loki","fb8df0e7239cdb3f4ac5d1f16872a64d82849e69","kavirajk","2021-12-20 06:51:43","true","Copy `cortex/util/fakeauth` package dependency into Loki (#4956)

* Copy `cortex/util/fakeauth` package dependency into Loki

* No need for CHANGELOG. As this is not user facing changes",240,44,0,1,"2018-04-16 10:25:39","1339.6"
"grafana/loki","67f8ff8c64185cf8b541462e6ec0d07646411dc1","pracucci","2019-10-07 12:24:39","false","Increased promtail's backoff settings in prod and improved doc (#1083)",72,18,0,0,"2018-04-16 10:25:39","536.33"
"grafana/loki","3ff62d7f4621c324210903a0cc927ba57f4ecf44","mizeng","2019-05-29 14:20:45","false","provide Cassandra Index Store Example (#625)

Mentioned in title. To save new beginner's time, provide one config example for use Cassandra as Index Storage.",110,13,0,0,"2018-04-16 10:25:39","408.41"
"grafana/loki","7d67b6306f2dc740493f781b6d88b60d176017ed","DylanGuedes","2023-05-31 21:43:37","true","Loki: Implement initial phase of `limited_log_push_errors` (#9556)

**What this PR does / why we need it**:
Adds an initial implementation of `limited_log_push_errors`.
This initial implementation encompass:
- Runtime per-tenant configuration
- Simple per-tenant rate-limiting based on error message size

Notable features that will be added in future phases:
- Instead of a single error with the final string, give to the manager
the list of all entries
- Once it supports per-entry error, make the rate-limiting separated
per-reason
- Hash the entry error and avoid repeating errors by caching seen errors
in memory",68,61,1,1,"2018-04-16 10:25:39","1871.72"
"grafana/loki","dbc3040739ea33c71b7fd2508da4a410001ea69f","trevorwhitney","2023-06-20 23:01:07","true","Convert SeriesVolume response to prometheus-style (#9703)

Changes the response type of the label volume stats endpoint to
return volumes as prometheus-style timeseries metrics. It currently only
supports instant queries, but is a necessary step to eventually
supporting range queries.",61,62,1,1,"2018-04-16 10:25:39","1890.77"
"grafana/loki","b152bc2cf3e0c3b558ff400af3056f2f64baa8dd","sandeepsukhani","2021-03-30 17:04:54","true","check for stream selectors to have atleast one equality matcher (#3216)

* check for stream selectors to have atleast one equality matcher

* move equality matchers check to logql",144,35,0,1,"2018-04-16 10:25:39","1074.78"
"grafana/loki","3d3c05717ad27dd0407c9bed3b016a144f1a0b70","sandeepsukhani","2019-05-24 12:54:09","false","Update cortex vendor (#610)

* Update cortex vendor
Use query max look back from cortex
Update config changes from cortex
Fixed breaking code due to updating cortex vendor

* fixed linter error",107,13,0,1,"2018-04-16 10:25:39","403.35"
"grafana/loki","944b488bd2506012d149fc363401f9b7d51af3e7","owen-d","2023-01-24 18:10:59","true","logs more metadata when failing to recover head from WAL in TSDB (#8250)",83,57,1,1,"2018-04-16 10:25:39","1739.32"
"grafana/loki","e7acb5356bf054ab738ce6227e6fa26eab1d6cd0","mrbrianevans","2022-09-14 10:35:42","true","Docs: Fix template function examples (#7148)

Some examples only had a single open brace,
but require two. I added the missing braces.


**What this PR does / why we need it**:
Improves documentation, helps users who are reading docs about template
functions.",88,53,1,0,"2018-04-16 10:25:39","1609.01"
"grafana/loki","bf1365b580bd6771a571eca9f8e271fd80dfde87","slim-bean","2021-09-09 00:26:53","true","Build: Tweak stalebot message (#4286)

* change yaml to not strip whitespaces and newlines

* change wording a little",127,41,0,1,"2018-04-16 10:25:39","1238.33"
"grafana/loki","aee064d0a8ff3f4692f5f95efee04740595a5595","slim-bean","2020-06-26 15:44:17","true","Loki: Series API will return all series with no match or empty matcher (#2254)

* Allow series queries with no match or an empty {} matcher which will return all series for the provided timeframe.

* fix test

* fix lint",133,26,0,1,"2018-04-16 10:25:39","800.72"
"grafana/loki","bcccbbfaaf0f0e703581295b72ac66154519f4c3","slim-bean","2019-06-26 20:49:39","false","changing the default prune interval to 60 seconds, at the previous 1 second it would cause some way too aggressive querying when scaled out over all our clusters and loki had a hiccup",95,14,0,1,"2018-04-16 10:25:39","435.68"
"grafana/loki","e0b4e25962269452520c65f12abc156444ca35c0","DylanGuedes","2021-10-25 17:37:25","true","Document the common config section (#4485)

* Document the common_config section.

* Apply suggestions from code review

Fix subsection reference from `filesystem_storage_config` to `local_storage_config`

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>",164,42,0,1,"2018-04-16 10:25:39","1285.05"
"grafana/loki","19be2c473205387cf8678a23ab5bdcb7ac505064","cyriltovena","2020-07-03 13:32:30","true","Fixes the lint issue merge to master. (#2290)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",130,27,0,1,"2018-04-16 10:25:39","807.63"
"grafana/loki","e4d78b984b07abaf6575d9a9ea7dbea231ce7167","cyriltovena","2020-04-16 15:17:24","true","Log docker driver config map. (#1903)

This will allow users to verify which config option are passed to the driver.
See dicussions here https://github.com/grafana/loki/issues/1868, it seems that it can be confusing when using docker-compose.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",115,24,0,1,"2018-04-16 10:25:39","730.7"
"grafana/loki","4854e4af898542f3b0e816347ffd357ad1837e62","periklis","2023-03-13 19:40:29","true","operator: Update Loki operand to v2.7.4 (#8771)",89,59,1,1,"2018-04-16 10:25:39","1788.39"
"grafana/loki","d224dfb90a9c0de0d1ea25bb10a569f4ef25fc00","periklis","2023-02-06 17:37:40","true","operator: Bump bundle OCP max version property to 4.15 (#8411)",79,58,1,1,"2018-04-16 10:25:39","1751.3"
"grafana/loki","8d7dbc3e13192572394e6ab7b3ea25a0f77123e1","feber","2022-03-07 06:23:54","true","Docs: Fix broken link to ""Matching IP addresses"" (#5550)",299,47,0,0,"2018-04-16 10:25:39","1416.58"
"grafana/loki","8716e2451865a86d1ef26794217b6de26797f370","cyriltovena","2021-01-27 14:00:24","true","Allocate entries array with correct size  while decoding WAL entries. (#3241)

Small optimization I found while deployment the new version.
We might want to have a pool of entries here.

```
❯ benchcmp  before.txt after.txt
benchmark                  old ns/op     new ns/op     delta
Benchmark_DecodeWAL-16     2350024       1591633       -32.27%

benchmark                  old allocs     new allocs     delta
Benchmark_DecodeWAL-16     20043          20005          -0.19%

benchmark                  old bytes     new bytes     delta
Benchmark_DecodeWAL-16     4946246       1763270       -64.35%
```

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",123,33,0,1,"2018-04-16 10:25:39","1011.65"
"grafana/loki","5887096f3c7e9b679e1c054f67b28382b7e3fb5a","cyriltovena","2021-07-01 09:25:20","true","Add Danny Kopping to the Loki Team. (#3926)

Welcome :rocket:

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",115,38,0,1,"2018-04-16 10:25:39","1170.71"
"grafana/loki","04a615a72de3d77a20067f4de26717af5f9b94c3","slim-bean","2019-09-16 20:55:21","false","make promtail daemonset name configurable
also adding a regex test for something else I was working on",69,17,0,1,"2018-04-16 10:25:39","515.69"
"grafana/loki","db8880e6e0418ebd104eb587e6bdc51ae41d891f","sh0rez","2019-09-09 20:37:47","true","chore(ci/cd): breaking the circle (#990)

* chore(ci/cd): breaking the circle

As the trial period for drone.io went really well (not a single failed build,
apart from merge-failures), I think it is time to make the switch to the new,
native ARM and much more performant platform.

This should fix all kinds of issues and be a solid architecture for the future
to level up our CI/CD in terms of performance and reliability.

* chore(packaging): drone.io check stage

Adds a check stage to the drone pipeline to lint and test",119,17,0,0,"2018-04-16 10:25:39","508.68"
"grafana/loki","c89df1a795b8eaf6f3c765db85e86f1a20f16deb","putrasattvika","2019-11-26 18:33:15","false","storage: fix missing logs with batched chunk iterator (#1299)

* fix batched chunk iterator

* fix expected series labels in iterator_test.go

* add query range boundary check

* add __name__ label matcher to test cases

* trim __name__ without mutating chunks",83,19,0,0,"2018-04-16 10:25:39","585.59"
"grafana/loki","5465aaf3e097870990fb31e29bf46244b34cf1d7","dbirks","2022-10-05 09:09:40","true","docs: Document setting up command completion for logcli (#7325)

This documents the existing command completion that kingpin provides
(docs
[here](https://github.com/alecthomas/kingpin#bashzsh-shell-completion)
on that).

**Which issue(s) this PR fixes**:
Fixes #2949",94,54,1,0,"2018-04-16 10:25:39","1629.95"
"grafana/loki","b2b4fdec714eb221197b8852b491ec0763b44cb4","chaudum","2022-06-01 07:59:19","true","Update docs for xk6-loki log formats (#6134)

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",72,49,0,1,"2018-04-16 10:25:39","1505.9"
"grafana/loki","4f2f0886d7d8f93ee29c8c4d0301d930c76d61b5","xperimental","2022-03-21 13:40:34","true","operator: Update Loki operand to 2.4.2 (#5655)",308,47,0,1,"2018-04-16 10:25:39","1430.89"
"grafana/loki","628747e4cbb5b62f83f825e5c1e20ebd2ee70096","jeschkies","2021-11-17 09:33:07","true","Only run benchmarks on `loki-bench` cron. (#4753)

Summary:
Currently, all pipelines are run by the `loki-bench` bron scheduler.
However, we only want `benchmark-cron` to run. That is why all other
pipelines need to define their own trigger which defaults to `push` and
`pull_request`.",201,43,0,1,"2018-04-16 10:25:39","1306.71"
"grafana/loki","2e84bcfaa9d1928162d10c0b6774e2b2486f84a9","rfratto","2021-07-08 14:02:13","true","remove robert fratto from list of team members (#3963)",121,39,0,1,"2018-04-16 10:25:39","1177.9"
"grafana/loki","c175ad0862609bcd8a38a55a2803d6142bf848ce","owen-d","2021-01-15 20:09:09","true","moves boltdb flags to config file (#3180)",119,33,0,1,"2018-04-16 10:25:39","999.91"
"grafana/loki","3640d2d4a8295bc9319bb34dccbbb250494692fe","ilpianista","2021-01-04 14:50:00","true","Update reference to old helm chart repo (#3084)",110,32,0,0,"2018-04-16 10:25:39","988.68"
"grafana/loki","6890c315a58be30ec1251fe2a4f16d5760b17235","tomwilkie","2018-12-12 15:35:50","true","Fix report card badge",17,8,0,0,"2018-04-16 10:25:39","236.22"
"grafana/loki","ea538b6580d5bdbb98ca20280a16837e9daffb46","tomwilkie","2018-05-18 09:08:05","false","Fix last bug, make CLI prettier.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",0,1,0,0,"2018-04-16 10:25:39","31.95"
"grafana/loki","43b9b224ea5561fb37c004a054b7a3fc391662cd","vitaliyf","2021-08-10 21:39:01","true","Fixed broken ""Upgrading"" documentation link (#4120)",113,40,0,0,"2018-04-16 10:25:39","1210.22"
"grafana/loki","bfc59b559b386c8ada9ea973392ddcd13b743eb9","davkal","2019-02-15 11:45:21","true","Added UI issue templates",87,10,0,0,"2018-04-16 10:25:39","299.06"
"grafana/loki","3957c18cb048571283077941e74b4a5736767565","sh0rez","2019-09-09 21:18:33","true","chore(packaging): deploy from drone (#991)

Moves the continuous deploy call from CircleCI to drone, because the images are
now built there.",118,17,0,0,"2018-04-16 10:25:39","508.7"
"grafana/loki","76c6681feb47910856430da795c55a45e9886dd6","trevorwhitney","2023-04-17 22:29:23","true","Add release notes appender action (#9063)

**What this PR does / why we need it**:

This PR aims to remove the manual process required to create release
notes during a release. It will allow contributors to add the label
`add-to-release-notes` to any PR. When that PR is merged, this action
will create another PR appending the original PR's # and title to the
release notes for the next release. This second PR will give the author
an opportunity to add a description to their addition, as well as give
maintainers an opportunity to discuss it's relevance in the release
notes.",83,60,1,1,"2018-04-16 10:25:39","1827.75"
"grafana/loki","415d4b03faf8b6fcbc850ef9416646f8bcbc6526","owen-d","2021-10-07 07:35:44","true","Safe per tenant overrides loading (#4421)

* safe per tenant overrides loading

* exports submap for OverwriteMarshalingStringMap",138,42,0,1,"2018-04-16 10:25:39","1266.63"
"grafana/loki","63f3f732be49901c9684ca46041a778396c6b2c9","JoaoBraveCoding","2023-04-28 10:43:35","true","operator: Add default PodAntiAffinity to Ingester (#9329)

Signed-off-by: Joao Marcal <jmarcal@redhat.com>",80,60,1,0,"2018-04-16 10:25:39","1838.26"
"grafana/loki","923671a17e250542e10037f514e8f5c21fa205b9","jtlisi","2021-02-04 16:50:52","true","chore: update cortex to latest and fix refs (#3295)

* chore: update cortex to latest and fix refs

Signed-off-by: Jacob Lisi <jacob.t.lisi@gmail.com>

* tidy mod file

Signed-off-by: Jacob Lisi <jacob.t.lisi@gmail.com>",127,33,0,0,"2018-04-16 10:25:39","1018.77"
"grafana/loki","f8ee4081801d84d2cd4bbb559660a043f9336807","owen-d","2020-08-06 17:40:17","true","series endpoint uses normal splits (#2472)",124,28,0,1,"2018-04-16 10:25:39","840.8"
"grafana/loki","22089415e8353528e4e96034690778345712090e","owen-d","2022-11-25 06:30:34","true","Split parallelism across Period Configs (#7769)

One of things we watch while updating non-TSDB period configs to TSDB
period configs is the difference in query parallelism. TSDB dynamically
shards queries into (potentially) much smaller units of work compared to
the static shard factors uses prior. To account for this, we use much
higher query parallelism configurations with TSDB period configs.

This creates a potential problem when querying across `non-tsdb, tsdb`
period boundaries: we may want a query parallelism of 512 for the tsdb
portion but only 64 for the non-tsdb portion! However, we only had one
limit to specify this per tenant, meaning this would be too high when
querying non-tsdb periods or too low when querying tsdb ones.

This PR

* Introduces `tsdb_max_query_parallelism` (default `512`) to
`limits_config`
* Uses `tsdb_max_query_parallelism` and `max_query_parallelism` limits
to find a better parallelism _per query_ by weighting the two respective
configs by the proportion of each query spent on TSDB or non-TSDB period
configurations.

Signed-off-by: Owen Diehl <ow.diehl@gmail.com>",95,55,1,1,"2018-04-16 10:25:39","1679.84"
"grafana/loki","47ce070b730ea6f5bdc8c27c8e303c6ffd595728","DylanGuedes","2022-05-02 08:11:23","true","Add missing changelog entry for change introduced by PR 6034. (#6040)

* Add missing changelog entry regarding PR 6034.

* Move changelog entry to promtail subsection",80,49,0,1,"2018-04-16 10:25:39","1476.91"
"grafana/loki","f5d570177ae8cf0ffe087e737126df079e9d90d6","kavirajk","2022-01-28 11:40:16","true","Fork `cortex/pkg/util` into Loki (#5257)

* Fork `cortex/pkg/util/validation`

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Fork `pkg/cortex/util/limiter`

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* fork util/extract

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Spanlogger add more helpers

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* getting rid of `cortex/pkg/util`

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* With lesser linter errors

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Make linter happy by removing unused method

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Remove missed util_log

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Fix gofmt and goimports

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Do not touch operator

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Do not touch generated go files

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Format

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Make linters happy

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Fix lambda promtail tools

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Upgrade Dockerfile of lambda promtail

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Add tests for `pkg/util`

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",275,45,0,1,"2018-04-16 10:25:39","1377.8"
"grafana/loki","549250c30d9fbc544bc8a986705aba3c45dfcd23","cyriltovena","2019-12-14 16:41:16","false","Sets the chunk encoding correctly when creating chunk from bytes.

Previously only the reader and writer for the encoding was set, on subsequent serialization
the format would be missing, this only happens if the chunk is created from a chunk transfer.
Because it uses NewBytesChunk to load and also write.

I've also added a regression tests.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",93,20,0,1,"2018-04-16 10:25:39","603.51"
"grafana/loki","210dc355cb77f45cbe3fde9fc4d7daaeedbacd26","cyriltovena","2021-05-17 14:54:48","true","Fixes a goroutine leak in the store when doing cancellation. (#3733)

Found out that we might have no listener and trying to send the information of cancellation.
I've moved the error information down the respective log and sample iterators so that we don't need to send
it via the channel.

This seems to have cause some pretty big memory leak on our side.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",195,37,0,1,"2018-04-16 10:25:39","1126.94"
"grafana/loki","c6a909b0ec52f2323f161e458e1fff99e9a1e6c0","hervenicol","2023-08-23 14:26:14","true","helm: Add rbac.pspAnnotations (#9900)

**What this PR does / why we need it**:

Allows to define annotations for PSPs.

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [ ] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

---------

Co-authored-by: Herve Nicol <12008875+hervenicol@users.noreply.github.com>
Co-authored-by: Michel Hollands <42814411+MichelHollands@users.noreply.github.com>",50,64,1,0,"2018-04-16 10:25:39","1953.42"
"grafana/loki","20ef66df65b629ce93e3a04d5d40f98de71c0982","cyriltovena","2021-03-02 14:10:15","true","Fixes a race in the scheduling limits. (#3417)

* Fixes a race in the scheduling limits.

Found out the hard way that sharding might not listen correctly to context and so still run queries
after the upstream request ends. This can lead to panic when scheduling work which send on a closed channel.

I've added a safe guard to wait for all jobs to end before ending the original request but also attemped to fix the sharding downstreamer
to properly stop sending work when context is closed.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* typo

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",140,34,0,1,"2018-04-16 10:25:39","1046.66"
"grafana/loki","09f5a907105f2ed6ff0f241544a73678bfcef477","liguozhong","2021-11-24 10:25:50","true","[doc] wal: fix default value (#4810)",215,43,0,1,"2018-04-16 10:25:39","1313.75"
"grafana/loki","3091ccd3ebdd7409ec591aa2376fcdc946900b0c","trevorwhitney","2022-01-11 19:12:12","true","improve default config values (#5077)

* improve default config values

* change defaults for upstream query range package

* update changelog

* remove max_tranfer_retries fix as it is covered in another PR, 4792

* increase query ingesters within by 1h

This provides an additional buffer on top of the max_chunk_age.

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>

* add comment reminder to remove query range config hack

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>

* rollback change to align_queries_with_step and parallelise_shardable_queries

* add upgrading docs

* re-enable parallelise_shardable_queries by default

* add parallelise_shardable_queries back to upgrading doc

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>",258,45,0,1,"2018-04-16 10:25:39","1361.12"
"grafana/loki","cfa0ba838b0d8785886202e12abf0a9340ae1e9f","davkal","2019-03-29 15:46:35","true","Merge pull request #423 from daixiang0/full-config

add miss promtail client config option",93,11,0,0,"2018-04-16 10:25:39","343.22"
"grafana/loki","6a533e5a56479dec9b69eb970ee16cdb833b4004","sandeepsukhani","2022-03-17 10:02:56","true","improve boltdb-shipper logging to help debug index query latency issues (#5651)",307,47,0,1,"2018-04-16 10:25:39","1426.73"
"grafana/loki","d2ce08280f3daf17f00a9dc344be5047f944b398","sandeepsukhani","2022-03-09 12:10:10","true","Compactor improvements (#5587)

* upload and cleanup index sets concurrently

* reuse batch slice used for building a batch of index during compaction",305,47,0,1,"2018-04-16 10:25:39","1418.82"
"grafana/loki","2abb472e7e9a198c043e3f6c6d4af7483661ef74","chaudum","2023-10-19 08:13:20","true","Unify ring managers across components (#10931)

**What this PR does / why we need it**:

This PR creates a re-usable `RingManager` implementation that is then used by

* Query Scheduler ring
* Index Gateway ring
* Bloom Gateway ring
* Bloom Compactor ring

**Which issue(s) this PR fixes**:

Every component had its own implementation of the ring manager which only really differed in the log messages containing the component name.

---------

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",20,66,1,1,"2018-04-16 10:25:39","2009.16"
"grafana/loki","1c90b9c57f6d46a565d2d0c00c4d1284cf04430b","owen-d","2021-09-07 20:13:07","true","remove empty streams after wal replay (#4265)",122,41,0,1,"2018-04-16 10:25:39","1237.16"
"grafana/loki","98ecfefd895dad34e3a85056787ce7df20f3aa09","DylanGuedes","2022-01-03 18:22:55","true","Add distributor ring page (#4938)

* Implement new IngestionRateStrat Enum.

- This new IngestionRateStrat is used internally to represent the chosen
  ingestion rate strategy, to avoid using plain strings.

* Add a ring to the distributor.

As of now, the distributor only has a pointer to its lifecycler. Since
the ring HTTP handler isn't implemented for the lifecycler but it is
for the ruler, this extends the distributor by also holding a ring
instance.

* Implement /distributor/ring page.

* Reuse existing global strat const.

* Add distributor ring HTTP page tests.

* Add missing CHANGELOG entry.

* Document missing ring status pages.

* Fork Cortex util/http.go into source code.",254,44,0,1,"2018-04-16 10:25:39","1353.08"
"grafana/loki","ffe109384ba6124b1dc3011ea859797beb117aa8","tomwilkie","2019-01-29 12:39:13","false","Tweak Loki Writes dashboards, add resource request and limits to distributor and ingester ksonnet.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",68,9,0,0,"2018-04-16 10:25:39","283.09"
"grafana/loki","84c5e20af1a7461dec436ee98911195223dfdf3c","farodin91","2023-02-28 11:02:16","true","S3: add support for s3 session token (#8474)

We want to automate the access account rotation. This is that easy at moment with service accounts in MinIO. Our currently life time of tokens is 3 months with MinIO STS works this fine.

Signed-off-by: Jan Jansen <jan.jansen@gdata.de>",69,58,1,0,"2018-04-16 10:25:39","1773.03"
"grafana/loki","071118a090ce1ef77e5bce1a7aa1e93781ce2749","MasslessParticle","2022-09-14 19:26:02","true","revert stream push error response (#7160)

We've changed approaches to how we want to do per-stream rate limiting.
The new approach will rely on creating an api on the ingester so the
distributors can decide how streams should be sharded. As a result, the
work to return rate-limited streams in the error body is no longer
needed.",88,53,1,1,"2018-04-16 10:25:39","1609.38"
"grafana/loki","4e893a0a88b2c8c3ea9d1d8b1037f54d8fb7f1af","sandeepsukhani","2023-03-23 15:28:54","true","tsdb: sample chunk info from tsdb index to limit the amount of chunkrefs we read from index (#8742)

**What this PR does / why we need it**:
Previously we used to read the info of all the chunks from the index and
then filter it out in a layer above within the tsdb code. This wastes a
lot of resources when there are too many chunks in the index, but we
just need a few of them based on the query range.

Before jumping into how and why I went with chunk sampling, here are
some points to consider:
* Chunks in the index are sorted by the start time of the chunk. Since
this does not tell us much about the end time of the chunks, we can only
skip chunks that start after the end time of the query, which still
would make us process lots of chunks when the query touches chunks that
are near the end of the table boundary.
* Data is written to tsdb with variable length encoding. This means we
can't skip/jump chunks since each chunk info might vary in the number of
bytes we write.

Here is how I have implemented the sampling approach:
* Chunks are sampled considering their end times from the index and
stored in memory.
* Here is how `chunkSample` is defined:
```
type chunkSample struct {
	largestMaxt   int64 // holds largest chunk end time we have seen so far. In other words all the earlier chunks have maxt <= largestMaxt
	idx           int   // index of the chunk in the list which helps with determining position of sampled chunk
	offset        int   // offset is relative to beginning chunk info block i.e after series labels info and chunk count etc
	prevChunkMaxt int64 // chunk times are stored as deltas. This is used for calculating mint of sampled chunk
}
```
* When a query comes in, we will find `chunkSample`, which has the
largest ""largestMaxt"" that is less than the given query start time. In
other words, find a chunk sample which skips all/most of the chunks that
end before the query start time.
* Once we have found a chunk sample which skips all/most of the chunks
that end before the query start, we will sequentially go through chunks
and consider only the once that overlap with the query range. We will
stop processing chunks as soon as we see a chunk that starts after the
end time of the query since the chunks are sorted by start time.
* Sampling of chunks is done lazily for only the series that are
queried, so we do not waste any resources on sampling series that are
not queried.
* To avoid sampling too many chunks, I am sampling chunks at `1h` steps
i.e given a sampled chunk with chunk end time `t`, the next chunk would
be sampled with end time >= `t + 1h`. This means typically, we should
have ~28 chunks sampled for each series queried from each index file,
considering 2h default chunk length and chunks overlapping multiple
tables.

Here are the benchmark results showing the difference it makes:
```
benchmark                              old ns/op     new ns/op     delta
BenchmarkTSDBIndex_GetChunkRefs-10     12420741      4764309       -61.64%
BenchmarkTSDBIndex_GetChunkRefs-10     12412014      4794156       -61.37%
BenchmarkTSDBIndex_GetChunkRefs-10     12382716      4748571       -61.65%
BenchmarkTSDBIndex_GetChunkRefs-10     12391397      4691054       -62.14%
BenchmarkTSDBIndex_GetChunkRefs-10     12272200      5023567       -59.07%

benchmark                              old allocs     new allocs     delta
BenchmarkTSDBIndex_GetChunkRefs-10     345653         40             -99.99%
BenchmarkTSDBIndex_GetChunkRefs-10     345653         40             -99.99%
BenchmarkTSDBIndex_GetChunkRefs-10     345653         40             -99.99%
BenchmarkTSDBIndex_GetChunkRefs-10     345653         40             -99.99%
BenchmarkTSDBIndex_GetChunkRefs-10     345653         40             -99.99%

benchmark                              old bytes     new bytes     delta
BenchmarkTSDBIndex_GetChunkRefs-10     27286536      6398855       -76.55%
BenchmarkTSDBIndex_GetChunkRefs-10     27286571      6399276       -76.55%
BenchmarkTSDBIndex_GetChunkRefs-10     27286566      6400699       -76.54%
BenchmarkTSDBIndex_GetChunkRefs-10     27286561      6399158       -76.55%
BenchmarkTSDBIndex_GetChunkRefs-10     27286580      6399643       -76.55%
```

**Checklist**
- [x] Tests updated",83,59,1,1,"2018-04-16 10:25:39","1798.21"
"grafana/loki","167c95c3207c115284dd646179e53d66f7a84a66","KMiller-Grafana","2022-06-21 23:07:22","true","Docs: revise multi-tenancy prose (#6355)

* Docs: revise multi-tenancy prose

* Update multi-tenancy docs using review comments",70,50,0,0,"2018-04-16 10:25:39","1526.53"
"grafana/loki","fdbb06d1231ea2727b5982aa979a199068a6a9e2","liguozhong","2022-10-11 08:59:46","true","add promtail reload changelog and doc (#7386)",92,54,1,1,"2018-04-16 10:25:39","1635.94"
"grafana/loki","2d649a7fdd9603a526a3813a1a8517237e78a10c","BenjaminVouillaume","2022-10-19 07:04:48","true","Promtail: Add additional fields for cloudflare (#7463)",90,54,1,0,"2018-04-16 10:25:39","1643.86"
"grafana/loki","f2d7bb4c387b8db24bfa57ce2a8ac5d7198c4760","DylanGuedes","2023-01-31 13:20:04","true","Docs: Improve/update examples page (#8338)

What this PR does / why we need it:
Update our examples page to reflect recent changes to Loki configuration.
Motivated by feedback on #6122",80,57,1,1,"2018-04-16 10:25:39","1746.12"
"grafana/loki","72880d17a150fff07956b97ce3b680798bc74490","owen-d","2020-07-16 17:18:31","true","Storage backend examples (#2357)

* [wip] adds storage docs

* storage docs

* small doc fixes

* addresses PR comments",122,27,0,1,"2018-04-16 10:25:39","820.79"
"grafana/loki","ec516facaf9e3f855855df0971d96e65f5faf022","owen-d","2023-04-20 07:50:59","true","removes 20 user test from compaction; seems redundant and hits timeouts (#9201)

just a little cleanup to make tests run faster -- the 20 user test
doesn't seem to test any additional surface area and takes a long time.",77,60,1,1,"2018-04-16 10:25:39","1830.14"
"grafana/loki","88503ae2e1ecd50c64b43312e8a8f9b9568fb9f0","ashwanthgoli","2022-09-14 11:40:01","true","tsdb: clean-up metrics (#7150)

**What this PR does / why we need it**:
clean-up unused tsdb metrics and refactor others to use a `CounterVec`

Signed-off-by: Ashwanth Goli <iamashwanth@gmail.com>",87,53,1,0,"2018-04-16 10:25:39","1609.05"
"grafana/loki","580a5693b597ad109233f1d20835d33aa6c4f119","owen-d","2022-07-14 13:00:22","true","stripes frontend requests in progress (#6679)

Signed-off-by: Owen Diehl <ow.diehl@gmail.com>",71,51,0,1,"2018-04-16 10:25:39","1549.11"
"grafana/loki","05f3d6e0daafabcca8442e60dd70617ca76011a1","owen-d","2020-12-02 14:20:01","true","Updates chunkenc doc for V3 (#2956)",124,31,0,1,"2018-04-16 10:25:39","956.66"
"grafana/loki","e4d6767412511a5ea2d8bfa53c74e789c00e7c47","sandeepsukhani","2022-02-08 15:04:07","true","Fix apply retention issue (#5342)

* call mark phase started/finished only when applying retention

* correctly pass userID to IntervalMayHaveExpiredChunks call on retention and dletion expiry check",279,46,0,1,"2018-04-16 10:25:39","1387.94"
"grafana/loki","e1aea518ce5a9f82a4a815e643bb4a63df71ec88","slim-bean","2021-08-06 16:47:09","true","update jsonnet for 2.3.0 (#4109)",103,40,0,1,"2018-04-16 10:25:39","1206.01"
"grafana/loki","f7ad6a18b647281ccd321a95e54eb19a58205ce6","cyriltovena","2020-01-28 18:58:14","true","Update tanka.md doc. (#1598)

* Update tanka.md

Fixed and tested see https://github.com/grafana/loki/issues/1591

* Update tanka.md

* Update docs/installation/tanka.md

Co-Authored-By: Robert Fratto <robert.fratto@grafana.com>

Co-authored-by: Robert Fratto <robertfratto@gmail.com>",105,21,0,1,"2018-04-16 10:25:39","647.61"
"grafana/loki","27428f668b4d4c673dd9a06c0488ed73cbdb2f19","davkal","2019-02-15 15:25:53","true","Merge pull request #326 from erkules/master

fixed promtail ds, it had deployment options",88,10,0,0,"2018-04-16 10:25:39","299.21"
"grafana/loki","6362534da63bbfce4065b8e407b43f3452cfb252","davkal","2019-02-11 13:06:28","true","Merge pull request #278 from daixiang0/update-doc

Add k8s part in docs",77,10,0,0,"2018-04-16 10:25:39","295.11"
"grafana/loki","02876514b375dd8f2ef383c01c5c6e2ed1c71761","cristiangreco","2022-04-08 17:21:37","true","lambda-promtail: fix typos in CloudFormation and Terraform files. (#5749)

This fixes a typo in the CloudFormation template file (`Descripton`)
which makes it unusable, as well as some other minor typos.",319,48,0,0,"2018-04-16 10:25:39","1448.04"
"grafana/loki","f6daf776d8748e6a53131fb39c44afa2b727451e","granular-ryanbonham","2019-02-25 02:03:11","false","Add minReadySeconds",82,10,0,0,"2018-04-16 10:25:39","308.65"
"grafana/loki","ebb39db864f56986cb8385166d220980fd8be684","timchenko-a","2022-05-05 11:22:00","true","lambda-promtail: Add multi-tenancy support (#6102)

* lambda-promtail: adding multi-tenancy support

* update changelog and fix import order

* fix import order

* fix import order",75,49,0,0,"2018-04-16 10:25:39","1480.04"
"grafana/loki","16e63cf99542b4beb5fd66b7efb35c999d9beb1f","davkal","2019-03-29 16:30:05","true","Merge pull request #437 from daixiang0/add-help

Add help about how to get metrics",93,11,0,0,"2018-04-16 10:25:39","343.25"
"grafana/loki","23f64ef7e1896b4a85cbba3e2e703490771ddafc","cyriltovena","2020-07-23 12:10:59","true","Docker driver doc (#2389)

* wip

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Merge all documentation for docker-driver in one place.

Fixes #2198

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",119,27,0,1,"2018-04-16 10:25:39","827.57"
"grafana/loki","5233e7804841ef73474648ff1ead19017ecf84d0","gouthamve","2018-07-03 17:31:09","false","Add the required label name to the metric (#20)

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>",4,3,0,0,"2018-04-16 10:25:39","77.3"
"grafana/loki","a375a727ba288887dece164ad46ddc9afc5093e9","gouthamve","2018-12-10 16:43:14","false","Add ksonnet config (#32)

* Add ksonnet config

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>

* Address feedback

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>

* /s/tempo/loki

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>

* Instructions for running promtail

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>

* Add dependencies and lock-files

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>

* Minor promtail and loki updates

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>

* WIP: README

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>

* Add a single-tenant gateway

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>

* Don't reference default, use loki everywhere

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>

* Update to latest master

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>

* Make gateway optional with the ksonnet

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>

* Remove lock files as this is a lib

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>",11,8,0,0,"2018-04-16 10:25:39","234.26"
"grafana/loki","6bdecd6a5035ec1e2f2ae712b89b95a3b1b6a338","sandeepsukhani","2022-04-19 08:21:39","true","common index set should not expire before any of the user index sets (#5954)",172,48,0,1,"2018-04-16 10:25:39","1463.91"
"grafana/loki","49ffe5291d0c19799ed896162e82ceca200486e9","sandeepsukhani","2022-01-20 09:27:12","true","add objects list caching for boltdb-shipper index store to reduce object storage list api calls (#5160)",266,45,0,1,"2018-04-16 10:25:39","1369.71"
"grafana/loki","96a4fc1409338b6f4a3df4e2a4ed195fc7da1990","sandeepsukhani","2023-01-24 12:27:07","true","index-store: fix indexing of chunks overlapping multiple schemas (#8251)",83,57,1,1,"2018-04-16 10:25:39","1739.08"
"grafana/loki","cff61248e9d488217b00d3a13f73e4e93348daf5","sandeepsukhani","2019-05-28 07:11:54","false","Update details about logs retention",109,13,0,1,"2018-04-16 10:25:39","407.12"
"grafana/loki","18cf9d23050cee0395dff714eb5ec96dc1093a9a","cyriltovena","2020-12-01 13:42:56","true","Fixes promtail mixin dashboard. (#3010)

e14463b  removed a metric that was used previously in a dashboard could not find a better way yet to use the new metric so instead I added back the recording rules.

Also fixes a missing template expansion from 899e8cc.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",120,31,0,1,"2018-04-16 10:25:39","955.64"
"grafana/loki","45b51ef8d826cd2d7f465dd01f2c22f3e3fb1c9d","cyriltovena","2020-03-17 14:43:26","true","Non-root user docker image for Loki. (#1706)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",116,23,0,1,"2018-04-16 10:25:39","696.43"
"grafana/loki","ea8e0987b3d10d131e4da95feb279c5f3055d5ad","cyriltovena","2021-10-26 14:07:53","true","Fixes an edge case in the batch chunk iterator. (#4550)

* no-cache

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* found a bug to fix.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes a edge case in the batch chunk iterator.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",166,42,0,1,"2018-04-16 10:25:39","1285.9"
"grafana/loki","16a0e572de3b7ad58cb05f7d2feed38724f5c9e4","salvacorts","2023-05-03 11:09:31","true","Update docs 2.8.2 (#9379)

**What this PR does / why we need it**:

Update docs and changelog with Loki 2.8.2 changes.

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",81,61,1,1,"2018-04-16 10:25:39","1843.28"
"grafana/loki","86f6c2eb8d549438df6628be4d1efacae5444831","Red-GV","2022-09-01 17:38:04","true","operator: Adding Lokistack Gateway Request Errors Alert (#6999)",80,52,1,1,"2018-04-16 10:25:39","1596.3"
"grafana/loki","e15a03b5e5aa2828aeabfe24cfb3584ab88fcfda","slim-bean","2022-04-05 20:31:35","true","Loki: Add more details about usage reporting to the docs and default config files. (#5767)

* Add more details to usage reporting including putting it in our default config files

Signed-off-by: Ed Welch <edward.welch@grafana.com>

* Update docs/sources/configuration/_index.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* update verbiage

Signed-off-by: Ed Welch <edward.welch@grafana.com>

* add newlines

Signed-off-by: Ed Welch <edward.welch@grafana.com>

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>",321,47,0,1,"2018-04-16 10:25:39","1445.17"
"grafana/loki","1550762f9a401295f70de346b539594af468851d","periklis","2022-07-07 10:16:15","true","operator: Bump loki.grafana.com/LokiStack from v1beta to v1 (#6474)",71,51,0,1,"2018-04-16 10:25:39","1541.99"
"grafana/loki","9399ed930a594fcc55a3e03666604ec0fc6b26c0","simonswine","2023-05-26 07:48:40","true","Fix wrong error check (#9518)

I am afraid I broke main with #9502. It seem to have auto-merged with
failing tests :cry:",68,61,1,0,"2018-04-16 10:25:39","1866.14"
"grafana/loki","658dcb841632ef6a9a1dbb4342358167341b89ce","cyriltovena","2020-04-15 13:32:47","true","Support stdin target via flag instead of automatic detection. (#1935)

This seems to causes issue on some environment so let's use a flag instead.

Fixes #1921

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",121,24,0,1,"2018-04-16 10:25:39","724.38"
"grafana/loki","feba6ab9d5bc9273e0f9a4705e6f81e1dfeacfc4","cyriltovena","2019-05-09 17:24:34","false","working version with Gatherer",98,13,0,1,"2018-04-16 10:25:39","388.54"
"grafana/loki","9231169a54b36cd4a37f37d87594d82321d3f1de","MalloZup","2019-11-11 15:54:43","false","DOC: add minimal info about openSUSE linux pkgs (#1148)",67,19,0,0,"2018-04-16 10:25:39","570.48"
"grafana/loki","bc566fbbab29888abeff3f6b9317069af9091d80","KMiller-Grafana","2021-07-14 16:50:45","true","Docs: Revise/update the overview section. (#3980)

* Docs: Revise/update the overview section.

* Update docs/sources/overview/_index.md

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>

* Update docs/sources/overview/_index.md

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>",106,39,0,0,"2018-04-16 10:25:39","1184.02"
"grafana/loki","a4eb536fb29d6f88e8a9693d10f4f0a6bf08a6e5","slim-bean","2023-03-10 19:56:46","true","Loki: remove `subqueries` from metrics.go logging and replace it with separate split and shard counters (#8761)

**What this PR does / why we need it**:

Currently the `metrics.go` log line emitted after every query includes a
metric called ""subqueries"". This currently tracks the number of queries
created by the split_by_time operations done in Loki, but does not
include any counts for subqueries created as a result of sharding.

It becomes difficult to make a single subqueries counter that gives
useful information to determine how much a query is split by time and
sharded by a shard factor, especially now that sharding in TSDB indexes
is dynamic.

This PR removes and deprecates the `subqueries` stat and instead creates
a `splits` and `shards` statistic which records how much a query was
split_by_time and the total number of shards created as well.

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [x] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

---------

Signed-off-by: Edward Welch <edward.welch@grafana.com>",87,59,1,1,"2018-04-16 10:25:39","1785.4"
"grafana/loki","347e3e37cf55244a918b536483e84dcfe15a7dc3","DylanGuedes","2021-11-26 11:38:41","true","Loki: Implement custom /config handler (#4785)

* Implement custom /config handler.

* Make `customConfigEndpointHandlerFn` public.",216,43,0,1,"2018-04-16 10:25:39","1315.8"
"grafana/loki","b3b96568ed9ee7faf3a8fee61579ff077cb9753b","DylanGuedes","2022-04-13 16:36:02","true","Loki: Flush chunks one at a time (#5894)

* Flush chunks one at time.

- Calls `store.Put` (flushes chunk to the store) for each chunk
  individually until it doesn't work instead of calling it for all
  chunks a single time

* Refactor chunk flushing into smaller functions.

* Rearrange flushing locks.

- Updates our locking strategy to release the chunk lock more
  frequently. This release the lock after closing and marking a chunk as
  flushed.

* Change where we report `chunksFlushedPerReason` metric.",322,48,0,1,"2018-04-16 10:25:39","1453.01"
"grafana/loki","f74f2c82f43f6b6120419b782571c4ebca10baf5","rfratto","2019-07-18 17:07:50","false","feat(logcli): add --to flag to specify latest RFC3339 time for query (#776)

Fixes #774",104,15,0,1,"2018-04-16 10:25:39","457.53"
"grafana/loki","813f0d2d0b7ad410c35d76d6bd3cce0018eb21e8","sh0rez","2019-07-08 14:11:52","false","feat(docker): multi-arch Dockerfile (#668)

Adds an entirely new Dockerfile to the repository root which is capable of:

- building promtail and loki from the same image
- based on `scratch`, so that the final image can be executed on every supported
  GOARCH

Please note that this Dockerfile should always be built using
BuildKit (`buildctl` or `DOCKER_BUILDKIT=1` in recent versions) for maximum
performance, as BuildKit's DAG allows for smart skipping of uneeded stages.

These changes were proposed in #659",98,15,0,0,"2018-04-16 10:25:39","447.41"
"grafana/loki","46813867758729df3e18763ad7366f141291f3c9","DylanGuedes","2023-09-14 09:45:35","true","Update alpine versions (#10573)

**What this PR does / why we need it**:
Update alpine versions used by our images to `3.18.3`

**Which issue(s) this PR fixes**:
N/A

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",42,65,1,1,"2018-04-16 10:25:39","1974.22"
"grafana/loki","2e14c45ceb71a8285101341462190f6c7b94f9da","cyriltovena","2020-10-21 09:44:45","true","Logqlv2 pushes groups down to edge (#2786)

Pushes down grouping into range aggregation to reduce labels at edges.

This works  only for sums.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",117,30,0,1,"2018-04-16 10:25:39","915.47"
"grafana/loki","635dd0add5541dc1d9029cd6567f5c55c102c29a","cyriltovena","2020-06-02 11:53:20","true","Adds the ability to have a pull secrets for Promtail. (#2141)

* Adds the ability to have a pull secrets for Promtail.

Fixes #2118

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* bump chart version

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",126,26,0,1,"2018-04-16 10:25:39","776.56"
"grafana/loki","c6fbff26e1537e913225fafbf335ed8a231b28a4","salvacorts","2023-06-09 12:40:36","true","Add config to avoid caching stats for recent data (#9537)

**What this PR does / why we need it**:

When we query the stats for recent data, we query both the ingesters and
the index gateways for the stats.

https://github.com/grafana/loki/blob/ebdb2b18007e024d56105afc5230383165ca1650/pkg/storage/async_store.go#L112-L114


https://github.com/grafana/loki/blob/ebdb2b18007e024d56105afc5230383165ca1650/pkg/storage/async_store.go#L126-L127

Then we merge all the responses, which means summing up all the stats


https://github.com/grafana/loki/blob/ebdb2b18007e024d56105afc5230383165ca1650/pkg/storage/async_store.go#L157-L158


https://github.com/grafana/loki/blob/ebdb2b18007e024d56105afc5230383165ca1650/pkg/storage/stores/index/stats/stats.go#L23-L26

Because we have a replication factor of 3, this means that we will get
the stats from the ingesters repeated up to 3 times, hence inflating the
stats.

In the stats cache, we store the stats for a given matcher set for the
whole day, then we extract the stats from the cache by the factor of
time from the request that is stored in the cache:

https://github.com/grafana/loki/blob/336283acadb34f5fda9abce4e6fcef1dca9965d8/pkg/querier/queryrange/index_stats_cache.go#L33

https://github.com/grafana/loki/blob/336283acadb34f5fda9abce4e6fcef1dca9965d8/pkg/querier/queryrange/index_stats_cache.go#L40

Inflated stats for recent data will be cached, so subsequent stats
extracted from the cache will be inflated regardless of the time.

This PR adds a new per-tenant limit `max_stats_cache_freshness` to not
cache requests with an end time that falls within Now minus this
duration.

Here's a scenario illustrating this. The graphs below show the bytes
stats queried in the sharding middleware. We are running a log filter
query that won't match any log, every 5 seconds with a length of 3h.


![image](https://github.com/grafana/loki/assets/8354290/45c2e6e9-185c-4a18-b290-47da27fc3e39)

As can be seen, after enabling the stats cache and
configuring`do_not_cache_request_within` to not cache stats for requests
within 30m, the bytes stats used in the sharding middleware stopped
increasing.

In both cases the stats cache hit ration was 100%.

![image](https://github.com/grafana/loki/assets/8354290/cd35bcb8-0c77-4693-a06b-502741fd6e23)

**Special notes for your reviewer**:
- Blocked by https://github.com/grafana/loki/pull/9535
- Note that this PR doesn't fix the root issue of inflated stats form
the ingesters, but rather buys us some time to work on that.

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [x] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",67,62,1,1,"2018-04-16 10:25:39","1879.34"
"grafana/loki","3af7b7900ef8637d352591b6d02ee67165b60d5f","cyriltovena","2022-02-01 07:46:20","true","Refactor HeapIterator into Merge and Sort Iterator. (#5281)

* Refactor HeapIterator into merge and sort Iterator.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* lint

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",276,45,0,1,"2018-04-16 10:25:39","1380.64"
"grafana/loki","b9534c65b357b04049b57350da68be12b950521d","RangerCD","2020-11-05 14:40:21","true","Fix typos (#2853)",128,31,0,0,"2018-04-16 10:25:39","929.68"
"grafana/loki","72292cbab305e81779776db0c696386aabc198b3","cyriltovena","2021-11-05 11:40:20","true","Add a test to verify goroutine leak in compression pools. (#4653)

* Add a test to verify goroutine leak in compression pools.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Account for other goroutine tests.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Improve test with eventually.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",172,43,0,1,"2018-04-16 10:25:39","1294.8"
"grafana/loki","ee0b502cc67a0d33790b9d1cfc4ddd35cdcc269c","cyriltovena","2019-05-09 18:34:06","false","better counters",98,13,0,1,"2018-04-16 10:25:39","388.59"
"grafana/loki","1995eaa42627e9fb1e73cd4eb6de3f540bc80a91","cyriltovena","2021-05-05 08:12:26","true","Pass in the now value to the retention. (#3673)

This allows to call model.Time only once per table which is reasonable for accuracy and this will save some cpu cycle.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",185,37,0,1,"2018-04-16 10:25:39","1114.66"
"grafana/loki","6bacfa1f3ff5e844f5dd346b28c4171cb50a8fbb","cyriltovena","2020-11-04 10:44:04","true","Bump fluentd plugin (#2825)

so we can push it.

```
gem push fluent-plugin-grafana-loki-1.2.15.gem
/System/Library/Frameworks/Ruby.framework/Versions/2.6/usr/lib/ruby/2.6.0/universal-darwin19/rbconfig.rb:229: warning: Insecure world writable dir /Users/ctovena/go/src/github.com/grafana/loki/cmd/logcli in PATH, mode 040777
Pushing gem to https://rubygems.org...
Repushing of gem versions is not allowed.
Please use `gem yank` to remove bad gem releases.
```
Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",128,31,0,1,"2018-04-16 10:25:39","928.51"
"grafana/loki","7073ea870252c7392198eaddee607c4fd8c66a74","kavirajk","2022-11-14 10:36:24","true","docs(embedded-cache): Add missing docs on config page. (#7684)

**What this PR does / why we need it**:
Adds `embedded-cache` config under `cache_config` section. Also adds
message about deprecation of `fifocache`

**Which issue(s) this PR fixes**:
Fixes #7677 

**Special notes for your reviewer**:

**Checklist**
- [x] Documentation added
- [x] `CHANGELOG.md` updated",89,55,1,1,"2018-04-16 10:25:39","1669.01"
"grafana/loki","b1ea8ac050e5c2f740d82b7528204f1cc6295740","adityacs","2021-03-16 08:13:48","true","support math functions in line_format and label_format (#3434)

* support math functions in line_format and label_format

* fix lint and tests

* added docs and more tests

* update doc

* remove toString and int64

* doc adjustement.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

Co-authored-by: Cyril Tovena <cyril.tovena@gmail.com>",156,35,0,1,"2018-04-16 10:25:39","1060.41"
"grafana/loki","a5d1f283e03fe113bb6a386093f88148331c9d03","cstyan","2020-04-17 13:03:10","true","Move build from source instructions to root readme. (#1951)

Signed-off-by: Callum Styan <callumstyan@gmail.com>",118,24,0,1,"2018-04-16 10:25:39","731.61"
"grafana/loki","0cdb66013ba960e7f1683bc84cb2a2c889452274","DylanGuedes","2022-01-10 18:35:05","true","Copy `cortex/pkg/storegateway` package dependency into Loki (#5088)

* Fork Cortex `pkg/storegateway` into Loki.

* Update forked `pkg/storegateway` imports.

Modify it to use Loki's `spanlogger` instead of Cortex implementation.

* Include `thanos-io` in the list of protos to include.

* Remove `bucket_store_inmemory_server.go` as its content isn't used.

* Update `go.mod` with new explicit dependency.",254,45,0,1,"2018-04-16 10:25:39","1360.09"
"grafana/loki","7289c064b7059d7a2ce68089671c52fd608778f9","owen-d","2021-07-19 07:18:16","true","Fixes regexReplaceAll docs (#3998)

closes #3939",108,39,0,1,"2018-04-16 10:25:39","1188.62"
"grafana/loki","d2c099ac1db23fb0c29e55b6df17e177f356fda3","owen-d","2022-07-15 03:16:14","true","query_frontend_shard_factor uses exponential buckets (#6689)

Signed-off-by: Owen Diehl <ow.diehl@gmail.com>",71,51,0,1,"2018-04-16 10:25:39","1549.7"
"grafana/loki","414f95fedc1b921dc9891d77a4ee16e9729309fd","owen-d","2020-02-14 19:21:27","true","Literal Expressions in LogQL (#1677)

* binops in ast

* bin op associativity & precedence

* binOpEvaluator work

* defers close only if constructed without error

* tests binary ops

* more binops

* updates docs

* changelog

* number literals in ast

* [wip] literalExpr parsing

* number parsing

* signed literals

* propagates evaluator close, handles healthchecks

* literal evaluator works on non commutative operations

* literalExprs cannot be used as legs of logical/set binops

* removes comment

* single literalExpr tests

* reduces binops with literals in ast construction where possible

* doc updates

* scalar datatypes in logql

* scalar serialization type

* increases safety and reduces complexity in ast evaluator

* recursive literal binop reduction parse test, improves parse errors on literal construction

* vector + literal test",120,22,0,1,"2018-04-16 10:25:39","663.62"
"grafana/loki","439741578140608fbdf86d7b4c4be160390060a6","fitzoh","2020-01-16 03:44:41","false","Add note on using Loki with ECS (#1531)",100,21,0,0,"2018-04-16 10:25:39","634.97"
"grafana/loki","c2e43dd8f507dc51672866d5b3ae98ad7a7e647e","mar4uk","2022-05-06 18:15:39","true","Bump k8s.io/api, k8s.io/client-go, k8s.io/apimachinery from 0.22.7 to 0.23.6 (#6037)",74,49,0,0,"2018-04-16 10:25:39","1481.33"
"grafana/loki","205ad61b8c44ca0b7d79cd80cce7c1d5f5cb2726","SasSwart","2022-01-14 16:31:49","true","Docs: Update memory ballast documentation (#5106)

* Add memory ballast

* Add changelog entry

* Add documentation

Add additional information to Flag description

* Ensure that ballast_bytes can be configured from config file

Add documentation

* Add Operational scalability documentation related to memory ballast

* Restore config.ballast-bytes cli flag

* Move config.ballast-bytes cli flag declaration

* Update memory ballast documentation as per https://github.com/grafana/loki/pull/5081\#pullrequestreview-848460132

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>",263,45,0,0,"2018-04-16 10:25:39","1364"
"grafana/loki","7b68293e26b92a55e7d0bdb5df3c8a3b576a8b8d","owen-d","2020-08-31 17:33:47","true","logql rule loading (#2576)",119,28,0,1,"2018-04-16 10:25:39","865.8"
"grafana/loki","99b7c14e099c8b624b2029778e9e83d6af684778","trevorwhitney","2022-12-09 17:54:56","true","Prepare changelog and release notes for 2.7.1 (#7895)

**What this PR does / why we need it**:

Prepares changelog and release notes for 2.7.1 release.

Co-authored-by: Dylan Guedes <djmgguedes@gmail.com>",98,56,1,1,"2018-04-16 10:25:39","1694.31"
"grafana/loki","666bac28d9d345351f82f7dd7e5262fad7b0471f","kavirajk","2022-06-13 10:57:44","true","Revert ""Loki Prometheus mixin: templatize cluster label"" (#6377)

* Revert ""Loki Prometheus mixin: templatize cluster label (#6353)""

This reverts commit 459036f9f9bbb29fcae501bf2f0c2d53608ff3ea.

* Replace `loki-mixin` dependency to working commit.

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",69,50,0,1,"2018-04-16 10:25:39","1518.02"
"grafana/loki","27202ee9598a8106a1c313af6f0410ed58c57c01","tomwilkie","2018-12-17 11:28:52","true","Add Goutham's blog post to README (#141)

* Add Goutham's blog post.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>

* Review feedback, add David's other talk.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",38,8,0,0,"2018-04-16 10:25:39","241.04"
"grafana/loki","385d277372faeae94fc9efbf832c0c1a146b1119","tomwilkie","2019-03-20 18:02:13","false","Add missing default value.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",91,11,0,0,"2018-04-16 10:25:39","334.32"
"grafana/loki","8df1489ddc16daff46f9bd9801a80a2952f48b35","tomwilkie","2018-06-24 12:01:15","false","Don't infinitely loop deduping.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",1,2,0,0,"2018-04-16 10:25:39","68.07"
"grafana/loki","30fbe383411c56e0d7a6be11e2333ab2513a89c0","DylanGuedes","2023-11-07 20:03:12","true","Revert ""Introduces cache to TSDB postings (#9621)"" (#11157)

This reverts commit 1221658fc5bb1da5c87ae57e9c3b3115459db882.

**What this PR does / why we need it**:
We decided to discontinue the postings cache a few releases ago for not
finding any evidences that postings was the culprit for the bad igw
performance. Plus, we noticed a major issue with it: it doesn't bubble
down shards correctly, so every query end up processing every shard.",9,67,1,1,"2018-04-16 10:25:39","2027.65"
"grafana/loki","b4bb8a1a46b4c1d1e234ee9f2f688435e5d455bc","cyriltovena","2022-02-16 10:31:39","true","Fixes double metrics registration in reporting (#5407)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",290,46,0,1,"2018-04-16 10:25:39","1395.75"
"grafana/loki","3f99a07323eba4121a4b71072256e8ba9ea98f97","cyriltovena","2020-12-09 21:22:25","true","Remove regexes in the operational dashboard. (#3062)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",128,32,0,1,"2018-04-16 10:25:39","963.96"
"grafana/loki","4ee686c22c50350a880db307b9cfad9a964def76","RangerCD","2022-01-26 04:17:44","true","Remove ErrStreamMissing (#5234)",271,45,0,0,"2018-04-16 10:25:39","1375.49"
"grafana/loki","e6778e9827f6c11b73d05fb8a65d3ebe736dcdc4","cyriltovena","2020-11-04 17:03:32","true","Update to go 1.15 (#2877)

* Upgrade to 1.15.

Also upgrade linter and fixes some lint issues.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Update CI.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Update generated files.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Moar lint :facepalm:

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* moar lint and tests fixes.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Moar tests fixes.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",129,31,0,1,"2018-04-16 10:25:39","928.78"
"grafana/loki","73b39a97bc9d18f9dde16ac23320f04860198400","domcyrus","2022-05-16 08:55:58","true","specify logcli authorization header by flag (#6164)

* specify logcli authorization header by flag #6144

* default AuthHeader to Authorization in client lib

* use constant for default auth header

* for consistency use LOKI_AUTH_HEADER",77,49,0,0,"2018-04-16 10:25:39","1490.94"
"grafana/loki","ea735ab8c0334243c1b2a102a1cd18a0be6dc22c","dannykopping","2021-08-19 15:31:44","true","Write meaningful logs when remote-write is disabled or is misconfigured (#4141)

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",131,40,0,1,"2018-04-16 10:25:39","1218.96"
"grafana/loki","0c2ed01d92360a4f65bedb48e0d0ad8ef2dc71aa","ssncferreira","2022-01-03 13:52:18","true","Remove querier.query-ingesters-within check when sharding is enabled (#5024)",255,44,0,0,"2018-04-16 10:25:39","1352.89"
"grafana/loki","2d079340c3259138bd1745ecb736f5c70b4bb060","owen-d","2021-03-08 21:00:11","true","uses go_memstats_heap_inuse_bytes on the operational dashboard (#3447)",144,35,0,1,"2018-04-16 10:25:39","1052.94"
"grafana/loki","66f7407f15fd60da3bb8bad3a4e7e3bd302ae8ac","MasslessParticle","2023-01-30 18:17:31","true","Ensure a delete request interval of at least a second (#8340)",81,57,1,1,"2018-04-16 10:25:39","1745.33"
"grafana/loki","0723678573d5d7dc200f1df425f5b4db321cdf64","ashwanthgoli","2023-01-18 10:46:19","true","limits: add tenant to log lines for per-stream rate-limited and out-of-order errors (#8177)",94,57,1,0,"2018-04-16 10:25:39","1733.01"
"grafana/loki","02027e442c0faecabc9a96649cca3e47c6e908f2","jeschkies","2023-07-10 21:48:19","true","Document deadlocked Docker daemon workaround. (#9896)

**What this PR does / why we need it**:
This pulls @Pandry's
[workaround](https://github.com/grafana/loki/issues/2361#issuecomment-718024318)
for the seemingly deadlocked Docker daemon into the documentation.

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",58,63,1,1,"2018-04-16 10:25:39","1910.72"
"grafana/loki","a11921bbb85f8903855412cee321ae8c44a928f5","trevorwhitney","2023-04-24 19:34:53","true","Upgrade alpine 3.16.4 -> 3.16.5 (#9264)

**What this PR does / why we need it**:

Upgrade alpine version to address [openssl
CVEs](https://www.alpinelinux.org/posts/Alpine-3.17.3-released.html)

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",79,60,1,1,"2018-04-16 10:25:39","1834.63"
"grafana/loki","847ea21230317297e2b4519f1dc218a44b2da84c","tomwilkie","2018-04-17 07:26:41","false","Add iterator for chunks and streams.",0,0,0,0,"2018-04-16 10:25:39","0.88"
"grafana/loki","a98b7ebaf494301ea0afe29317eaf554b900f7fb","MasslessParticle","2022-08-31 21:20:08","true","Hide duplicates caused by stream sharding (#7005)

As streams are sharded and resharded across different ingesters, the likelihood of duplicate logs being ingested increases dramatically. This removes duplicates at query time by dynamically removing the `__shard_stream__` label  for both log and sample queries so the `stream hash` used by the `MergeEntryIterator` will match when doing comparisons for duplicates.

The `stream hash` is created in either the `store` or `ingester instance` at query time so the labels are removed there. Additionally, the `MergeEntryIterator` has been modified to remove duplicates in a stream rather than just across streams. 

For completeness, `__shard_stream__` has also been removed from Label and Series Queries.",82,52,1,1,"2018-04-16 10:25:39","1596.45"
"grafana/loki","3eecd7fe62e29f8dccfa39416637b6d26a10d74b","MichelHollands","2022-06-22 11:34:42","true","operator: Add shellcheck disables (#6460)

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",71,50,0,1,"2018-04-16 10:25:39","1527.05"
"grafana/loki","d97724e8dd12214092932f7e82cd46a3bb6bfd74","MasslessParticle","2022-05-04 14:50:09","true","Introduce coverage to PR pipelines (#5357)

* Add code coverage diff to CI

* remove test package from coverage diff

* review feedback

* lint

* Env variable test

* faster experiment

* drone vars

* drone vars

* how does the shell work?

* add pr comment

* escape json

* report diff in comment

* properly format json

* quote post body

* review feedback

* add querier/queryrange to coverage",75,49,0,1,"2018-04-16 10:25:39","1479.18"
"grafana/loki","0094783a1b0958234c622ef644ca47c75527152e","eranra","2021-08-23 05:34:15","true","fix issues in example secret + add LOKI_BUCKET_NAME as configurable environment variable (#67)",127,40,0,0,"2018-04-16 10:25:39","1222.55"
"grafana/loki","f04bc99e05d8a1a81e97ee9220298328e0ef0d5e","sandeepsukhani","2020-06-16 07:31:45","true","query tee proxy with support for comparison of responses (#2211)",136,26,0,1,"2018-04-16 10:25:39","790.38"
"grafana/loki","ec40515d31cefb887e368cb2baf169d07d9783eb","pracucci","2020-01-09 22:18:15","false","Added max streams per user global limit (#1493)

* Added max streams per user global limit

Signed-off-by: Marco Pracucci <marco@pracucci.com>

* Updated changelog

Signed-off-by: Marco Pracucci <marco@pracucci.com>

Co-authored-by: Cyril Tovena <cyril.tovena@gmail.com>",101,21,0,0,"2018-04-16 10:25:39","628.74"
"grafana/loki","385abd8cef0914a929faddf021e999a61b8cfc80","slim-bean","2019-10-30 23:26:57","false","update dashboards to include the new /loki/api/v1/* endpoints in addition to the deprecated /api/prom/*",67,18,0,1,"2018-04-16 10:25:39","559.79"
"grafana/loki","0a80472671e103004f12d2d584d92bcd9256a13a","qw1mb0","2019-06-01 16:38:54","false","fix labels for PodDisruptionBudget on helm (#623)",109,13,0,0,"2018-04-16 10:25:39","410.51"
"grafana/loki","1489c1731277c327e3661da182bfc6c90d4559f4","shwetaap","2022-09-24 10:19:17","true","operator: Add support for certificates to allow external S3 storage connections (#7070)

Signed-off-by: Shweta Padubidri <spadubid@redhat.com>

This PR supports bringing up Loki in a cluster that runs behind a proxy
It also adds support to provide proxy certificates to support secure
traffic behind a proxy in a cluster.",87,53,1,0,"2018-04-16 10:25:39","1619"
"grafana/loki","39ec520a9502bf0a9190de9e6e11eb3a2e61504d","davkal","2019-05-14 07:35:44","true","Merge pull request #448 from daixiang0/add-help

Add custom help info",100,13,0,0,"2018-04-16 10:25:39","393.13"
"grafana/loki","a5921f791a1fac46dae1ce4c310599ae947e9c10","jeschkies","2022-03-30 14:28:04","true","Revert changes to generated assets_vfsdata.go. (#5728)",309,47,0,1,"2018-04-16 10:25:39","1439.92"
"grafana/loki","55c768bf8eb483f0c7e2c0f7a5058cc9c166d398","jeschkies","2020-11-04 13:07:06","true","Log throughput and total bytes human readable. (#2751)",128,31,0,1,"2018-04-16 10:25:39","928.61"
"grafana/loki","42fc522b3e2ee8fa20c3970f06fbdadedef5f32a","shokada","2020-02-17 12:53:39","true","Add headers for WebSocket (#1689)

* Add headers for WebSocket

* Remove the OrgID

* fix",116,22,0,0,"2018-04-16 10:25:39","666.35"
"grafana/loki","236d3728d5bcd8699d406135d360ab8b9b4ba961","joe-elliott","2020-05-05 20:01:22","true","Swapped to container restarts over terminated reasons (#2043)

Signed-off-by: Joe Elliott <number101010@gmail.com>",116,25,0,0,"2018-04-16 10:25:39","749.9"
"grafana/loki","1e56dca7416084d1e1d0812cb8a077a8a7ab4ecb","sandeepsukhani","2022-02-28 13:11:25","true","per user index query readiness with limits overrides (#5484)

* add support for configuring query readiness for user index with limits overrides config

* improve tracking of duration for query time downloading of index

* update changelog

* use the existing context.Context we have for background operations while ensuring query readiness",299,46,0,1,"2018-04-16 10:25:39","1407.87"
"grafana/loki","d4018f5aca3bd48ffe9146880d4a5a5b8b33f751","wardbekker","2020-09-04 11:51:16","true","Update README.md (#2594)

* Update README.md

updated to required Go version

* Update README.md",118,29,0,0,"2018-04-16 10:25:39","868.56"
"grafana/loki","e5d6f3c317829d9cf332bb88cb24d303354edfc2","pracucci","2019-08-14 20:18:02","false","Fix panic in tailer when an ingester is removed from the ring while tailing (#897)",103,16,0,0,"2018-04-16 10:25:39","483.66"
"grafana/loki","de722350354dbba42102000ccc1deb9911694425","blockloop","2021-03-24 20:28:45","true","LOG-1241: create cli for generating manifests (#8)

* LOG-1241: create cli for generating manifests

* add makefile entry, fix lint",144,35,0,0,"2018-04-16 10:25:39","1068.92"
"grafana/loki","5ee0d093897a1c0b33edb4f7e3a3d7bd492d49d9","bboreham","2022-09-27 14:12:13","true","chunks: update klauspost/compress package to v1.15.11 (#7263)

**What this PR does / why we need it**:

Bring in various improvements from upstream, particularly
https://github.com/klauspost/compress/pull/668

**Checklist**
- [x] Reviewed the `CONTRIBUTING.md` guide
- NA Documentation added
- NA Tests updated
- [x] `CHANGELOG.md` updated
- NA Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

**Benchmarks**

(using changes from #7246, ignoring lines that didn't change much)

```
name                           old time/op      new time/op      delta
Write/ordered-flate-4              81.5ms ± 5%      78.7ms ± 2%    -3.39%  (p=0.016 n=5+5)
Read/none_66_kB-4                  4.16ms ± 6%      3.93ms ± 4%    -5.51%  (p=0.032 n=5+5)
Read/flate_66_kB-4                  168ms ± 4%       179ms ±11%    +6.50%  (p=0.032 n=5+5)
Read/zstd_66_kB-4                   334ms ±16%       152ms ± 3%   -54.57%  (p=0.008 n=5+5)
Read/none_262_kB-4                 3.93ms ± 1%      3.81ms ± 2%    -2.91%  (p=0.008 n=5+5)
Read/zstd_262_kB-4                  369ms ± 8%       131ms ± 1%   -64.62%  (p=0.008 n=5+5)
Read/zstd_524_kB-4                  466ms ±17%       146ms ± 2%   -68.68%  (p=0.008 n=5+5)
Read/sample_zstd_66_kB-4            420ms ±18%       224ms ± 1%   -46.69%  (p=0.016 n=5+4)
Read/sample_gzip_262_kB-4           214ms ± 1%       218ms ± 1%    +1.90%  (p=0.016 n=5+5)
Read/sample_zstd_262_kB-4           418ms ±21%       200ms ± 2%   -52.15%  (p=0.016 n=5+4)
Read/sample_zstd_524_kB-4           576ms ±35%       234ms ± 1%   -59.42%  (p=0.008 n=5+5)

name                           old speed        new speed        delta
Write/ordered-gzip-4              267MB/s ±10%     284MB/s ± 2%    +6.51%  (p=0.008 n=5+5)
Write/ordered-flate-4             274MB/s ± 4%     291MB/s ± 2%    +6.49%  (p=0.008 n=5+5)
Read/none_66_kB-4                1.82GB/s ± 6%    1.92GB/s ± 4%    +5.78%  (p=0.032 n=5+5)
Read/gzip_66_kB-4                 669MB/s ± 4%     698MB/s ± 1%    +4.30%  (p=0.008 n=5+5)
Read/zstd_66_kB-4                 425MB/s ±14%     930MB/s ± 3%  +119.12%  (p=0.008 n=5+5)
Read/none_262_kB-4               1.93GB/s ± 1%    1.99GB/s ± 2%    +3.00%  (p=0.008 n=5+5)
Read/gzip_262_kB-4                701MB/s ± 5%     721MB/s ± 2%    +2.96%  (p=0.032 n=5+5)
Read/zstd_262_kB-4                357MB/s ± 8%    1009MB/s ± 1%  +182.89%  (p=0.008 n=5+5)
Read/flate_524_kB-4               750MB/s ± 1%     763MB/s ± 1%    +1.74%  (p=0.008 n=5+5)
Read/zstd_524_kB-4                365MB/s ±18%    1149MB/s ± 2%  +215.34%  (p=0.008 n=5+5)
Read/sample_zstd_66_kB-4          341MB/s ±17%     616MB/s ± 9%   +80.67%  (p=0.008 n=5+5)
Read/sample_zstd_262_kB-4         318MB/s ±18%     658MB/s ± 2%  +107.08%  (p=0.016 n=5+4)
Read/sample_gzip_524_kB-4         521MB/s ± 1%     530MB/s ± 1%    +1.72%  (p=0.032 n=5+5)
Read/sample_zstd_524_kB-4         299MB/s ±28%     718MB/s ± 1%  +140.23%  (p=0.008 n=5+5)

name                           old %compressed  new %compressed  delta
Write/ordered-gzip-4                 6.89 ± 0%        6.73 ± 0%    -2.32%  (p=0.000 n=5+4)
Write/ordered-flate-4                6.89 ± 0%        6.69 ± 0%    -2.84%  (p=0.008 n=5+5)
Write/ordered-zstd-4                 6.17 ± 0%        6.16 ± 0%    -0.02%  (p=0.008 n=5+5)
Write/unordered-gzip-4               6.89 ± 0%        6.73 ± 0%    -2.32%  (p=0.008 n=5+5)
Write/unordered-flate-4              6.89 ± 0%        6.70 ± 0%    -2.81%  (p=0.000 n=4+5)
Write/unordered-zstd-4               6.17 ± 0%        6.16 ± 0%    -0.02%  (p=0.008 n=5+5)

name                           old alloc/op     new alloc/op     delta
Write/unordered-lz4-4              18.8MB ± 4%      17.8MB ± 1%    -5.28%  (p=0.008 n=5+5)
Read/gzip_66_kB-4                   713kB ± 0%       735kB ± 1%    +2.99%  (p=0.008 n=5+5)
Read/flate_66_kB-4                  715kB ± 0%       733kB ± 0%    +2.57%  (p=0.008 n=5+5)
Read/zstd_66_kB-4                   423MB ± 0%         1MB ± 0%   -99.65%  (p=0.016 n=5+4)
Read/gzip_262_kB-4                  198kB ± 0%       204kB ± 0%    +3.07%  (p=0.016 n=4+5)
Read/lz4-64k_262_kB-4               169kB ± 0%       169kB ± 0%    -0.07%  (p=0.000 n=5+4)
Read/flate_262_kB-4                 197kB ± 0%       205kB ± 0%    +3.77%  (p=0.008 n=5+5)
Read/zstd_262_kB-4                  553MB ± 0%         0MB ± 0%   -99.92%  (p=0.016 n=5+4)
Read/gzip_524_kB-4                 96.2kB ± 0%      98.8kB ± 0%    +2.71%  (p=0.016 n=4+5)
Read/flate_524_kB-4                95.4kB ± 0%      98.7kB ± 0%    +3.46%  (p=0.008 n=5+5)
Read/zstd_524_kB-4                  786MB ± 0%         1MB ± 6%   -99.93%  (p=0.008 n=5+5)
Read/sample_gzip_66_kB-4            686kB ± 0%       703kB ± 0%    +2.48%  (p=0.029 n=4+4)
Read/sample_flate_66_kB-4           688kB ± 0%       710kB ± 1%    +3.08%  (p=0.016 n=4+5)
Read/sample_zstd_66_kB-4            423MB ± 0%         2MB ± 0%   -99.59%  (p=0.016 n=5+4)
Read/sample_gzip_262_kB-4           194kB ± 0%       200kB ± 0%    +3.10%  (p=0.016 n=4+5)
Read/sample_flate_262_kB-4          194kB ± 0%       201kB ± 0%    +3.77%  (p=0.016 n=4+5)
Read/sample_zstd_262_kB-4           553MB ± 0%         0MB ± 0%   -99.91%  (p=0.016 n=5+4)
Read/sample_gzip_524_kB-4          95.4kB ± 0%      97.9kB ± 0%    +2.65%  (p=0.008 n=5+5)
Read/sample_flate_524_kB-4         95.2kB ± 0%      98.8kB ± 0%    +3.71%  (p=0.016 n=5+4)
Read/sample_zstd_524_kB-4           786MB ± 0%         1MB ± 0%   -99.90%  (p=0.008 n=5+5)

name                           old allocs/op    new allocs/op    delta
Write/ordered-gzip-4                  701 ± 0%         718 ± 1%    +2.40%  (p=0.008 n=5+5)
Write/ordered-lz4-256k-4              656 ± 0%         657 ± 0%    +0.21%  (p=0.048 n=5+5)
Write/ordered-flate-4                 626 ± 0%         634 ± 1%    +1.37%  (p=0.008 n=5+5)
Write/ordered-zstd-4                2.07k ± 0%       1.44k ± 0%   -30.49%  (p=0.008 n=5+5)
Write/unordered-gzip-4               418k ± 0%        428k ± 0%    +2.39%  (p=0.008 n=5+5)
Write/unordered-flate-4              418k ± 0%        430k ± 0%    +2.89%  (p=0.008 n=5+5)
Write/unordered-zstd-4               469k ± 0%        468k ± 0%    -0.12%  (p=0.008 n=5+5)
Read/gzip_66_kB-4                   13.2k ± 0%       13.5k ± 0%    +2.54%  (p=0.016 n=5+4)
Read/lz4-256k_66_kB-4               13.7k ± 0%       13.7k ± 0%    -0.01%  (p=0.029 n=4+4)
Read/flate_66_kB-4                  13.2k ± 0%       13.6k ± 0%    +2.72%  (p=0.008 n=5+5)
Read/zstd_66_kB-4                   18.0k ± 1%       10.8k ± 0%   -40.19%  (p=0.008 n=5+5)
Read/gzip_262_kB-4                  4.61k ± 0%       4.76k ± 0%    +3.17%  (p=0.016 n=4+5)
Read/flate_262_kB-4                 4.61k ± 0%       4.78k ± 0%    +3.62%  (p=0.008 n=5+5)
Read/zstd_262_kB-4                  7.10k ± 2%       2.54k ± 0%   -64.22%  (p=0.016 n=5+4)
Read/gzip_524_kB-4                  2.62k ± 0%       2.69k ± 0%    +2.36%  (p=0.016 n=4+5)
Read/flate_524_kB-4                 2.62k ± 0%       2.70k ± 0%    +3.09%  (p=0.008 n=5+5)
Read/zstd_524_kB-4                  6.13k ± 2%       1.63k ± 0%   -73.40%  (p=0.008 n=5+5)
Read/sample_gzip_66_kB-4            13.2k ± 0%       13.5k ± 0%    +2.54%  (p=0.029 n=4+4)
Read/sample_flate_66_kB-4           13.2k ± 0%       13.6k ± 0%    +2.88%  (p=0.016 n=4+5)
Read/sample_zstd_66_kB-4            18.0k ± 1%       10.8k ± 0%   -40.00%  (p=0.008 n=5+5)
Read/sample_gzip_262_kB-4           4.63k ± 0%       4.77k ± 0%    +3.16%  (p=0.016 n=4+5)
Read/sample_flate_262_kB-4          4.62k ± 0%       4.79k ± 0%    +3.61%  (p=0.016 n=4+5)
Read/sample_zstd_262_kB-4           7.12k ± 1%       2.54k ± 0%   -64.28%  (p=0.008 n=5+5)
Read/sample_gzip_524_kB-4           2.63k ± 0%       2.69k ± 0%    +2.36%  (p=0.008 n=5+5)
Read/sample_flate_524_kB-4          2.63k ± 0%       2.72k ± 0%    +3.31%  (p=0.016 n=5+4)
Read/sample_zstd_524_kB-4           6.11k ± 2%       1.64k ± 0%   -73.23%  (p=0.008 n=5+5)
```",90,53,1,0,"2018-04-16 10:25:39","1622.16"
"grafana/loki","89d81020ce810b63122cda86ff257fa3314c6009","sandeepsukhani","2022-11-30 11:32:11","true","fix lint issues from PR 7804 (#7814)

**What this PR does / why we need it**:
I had enabled auto-merge in PR #7804, but somehow it still merged the PR
without all the checks passing.
This PR fixes the failing lint and tests.",93,55,1,1,"2018-04-16 10:25:39","1685.05"
"grafana/loki","557b516b665eda3eb2c37d43ba69db65f81a181e","cstyan","2023-10-25 14:25:06","true","Refactor the proto Request interface to return time.Time (#11018)

Part of our query path improvements. In addition to Karstens new
protobuf formats for all the query request and responses, plus our use
of just proto grpc rather than httpgrpc, we'd like refactor the proto
Request interface to return time.Time for start and end instead of
int64. This will allow his protobuf formats to use more `logproto` proto
types.

There's still one or two tests that I need to fix.

---------

Signed-off-by: Callum Styan <callumstyan@gmail.com>
Co-authored-by: Karsten Jeschkies <karsten.jeschkies@grafana.com>",19,66,1,1,"2018-04-16 10:25:39","2015.42"
"grafana/loki","16a7dd19a21ca2c44f52eac23e0a337693b6bca5","dannykopping","2022-09-22 10:09:41","true","Jsonnet: fix overrides exporter to use correct CPU limits (#7221)

Currently the overrides exporter uses 200 vCPUs due to a missing `m` unit indicating ""milli-CPUs"".",85,53,1,1,"2018-04-16 10:25:39","1616.99"
"grafana/loki","2321da49b580dd00204fe9f19a0db837af8d19f0","dannykopping","2022-08-23 15:38:14","true","Upgrade prometheus/client_golang and reconfigure to restore `go_sched.*` metrics (#6957)

* Upgrading prometheus/client_golang to restore go_sched.* metrics

These metrics were removed unintentionally in #6403

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Fixing test to match interface correctly

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",82,52,0,1,"2018-04-16 10:25:39","1588.22"
"grafana/loki","687662ea0821a0d5721e53af257df231d28ff754","oddlittlebird","2020-06-22 21:11:51","true","Docs: Local install edits (#2220)

* Update README.md

* Update README.md

* Update README.md

* Update tanka.md

* content edits

* Create install-for-manual-build.md

* Update README.md

* Update helm.md

* Update local.md

* Create get-logs-into-loki.md

* Update local.md

* Update get-logs-into-loki.md

* Update get-logs-into-loki.md

* Update local.md

* Update get-logs-into-loki.md

* Update README.md

* Update README.md

* Update installation.md

* Update README.md

* Update docs/getting-started/get-logs-into-loki.md

Co-authored-by: Cyril Tovena <cyril.tovena@gmail.com>

* Update docs/installation/local.md

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>

* Update docs/installation/local.md

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>

* applied edits

* Update docs/getting-started/get-logs-into-loki.md

Co-authored-by: Ed Welch <edward.welch@grafana.com>

* Update get-logs-into-loki.md

* Update docs/getting-started/get-logs-into-loki.md

Co-authored-by: Ed Welch <edward.welch@grafana.com>

* Update docs/getting-started/get-logs-into-loki.md

Co-authored-by: Ed Welch <edward.welch@grafana.com>

* Update docs/installation/README.md

Co-authored-by: Ed Welch <edward.welch@grafana.com>

* applied edits

* Update local.md

Co-authored-by: Cyril Tovena <cyril.tovena@gmail.com>
Co-authored-by: Owen Diehl <ow.diehl@gmail.com>
Co-authored-by: Ed Welch <edward.welch@grafana.com>",138,26,0,0,"2018-04-16 10:25:39","796.95"
"grafana/loki","7cdb1564247ce2da8d9f1bfa0538501b2687cae1","gyrofx","2023-01-24 16:52:41","true","Helm: Add selector to backend's volumeClaimTemplates (#8235)",83,57,1,0,"2018-04-16 10:25:39","1739.27"
"grafana/loki","bdf8dca5b1f54a8022d84bc7eb01df239b6ec6d9","owen-d","2020-11-11 13:06:59","true","loki delete namespace ruler api (#2918)",126,31,0,1,"2018-04-16 10:25:39","935.61"
"grafana/loki","0f0ff7d949b8786c074820ccd2202eef37bfd6b0","carlpett","2021-10-25 09:20:46","true","Fix branch reference in PR template (#4535)",165,42,0,0,"2018-04-16 10:25:39","1284.7"
"grafana/loki","38de2fc74f26b1284568e4c154c4e7e3d5812b6a","salvacorts","2022-03-02 11:23:52","true","Change path for deploy config (#5506)

* Try non-existent path

* Move secret

* make drone

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

Co-authored-by: Danny Kopping <danny.kopping@grafana.com>",298,46,0,1,"2018-04-16 10:25:39","1411.79"
"grafana/loki","68ac695fd8f365f3a3763e08977a7cb8f544dd9e","cyriltovena","2020-07-07 15:27:48","true","Removes arm32 for now as we're migrating the CI. (#2307)

* Removes arm32 for now as we're migrating the CI.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Removes flaky test, its being rewritten anyway.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",122,27,0,1,"2018-04-16 10:25:39","811.71"
"grafana/loki","21fa187fa80ee6a1325b76251153928f696bfd08","cyriltovena","2022-02-10 15:05:45","true","Improve report usage to never fail (#5364)

* Improve report usage to never fail

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* wait until cancelled for the service to not fail

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",281,46,0,1,"2018-04-16 10:25:39","1389.94"
"grafana/loki","73ac208981932bb50bca785639cdbb1f93254aa5","salvacorts","2023-06-12 08:46:30","true","Improve docs for empty value in cache compression config (#9649)

**What this PR does / why we need it**:
Follow up PR for
https://github.com/grafana/loki/pull/9535#discussion_r1218167670

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",67,62,1,1,"2018-04-16 10:25:39","1882.18"
"grafana/loki","ae5548c09d4d4c99091b7b2621f96b58776c64fe","kavirajk","2021-05-12 08:11:47","true","Fluent-bit git repo link fix (#3714)",191,37,0,1,"2018-04-16 10:25:39","1121.66"
"grafana/loki","2880b5055a71f337e2a0f8bfe724faac08c73294","fgouteroux","2023-07-27 09:12:21","true","fix: parse expression error message based on record or alert (#10065)",53,63,1,0,"2018-04-16 10:25:39","1927.2"
"grafana/loki","999259a4d335a0238a31ff8325490f12321c058e","manohar-koukuntla","2023-06-28 12:17:33","true","jsonnet: Add TSDB shipper configuration flag (#9790)

This commit adds the TSDB equivalent of `use_boltdb_shipper` flag to be able to configure `tsdb_shipper` section.

Fixes #9789",61,62,1,0,"2018-04-16 10:25:39","1898.33"
"grafana/loki","98936437a937447a163023d1c5961549614fa93a","liguozhong","2023-04-20 09:24:50","true","[opt] s3: add s3 client http timeout for GetObject or PutObject (#8951)

**What this PR does / why we need it**:
add s3 client http timeout for GetObject or PutObject,

why？
The flush queue has been increasing. This is a difficult problem. We
have been investigating this problem for half a year. When the querier
has a large query, the load on the s3 server is too high and the number
of connections is full. It will cause the flush queue of the ingester to
increase continuously and cannot be reduced. When this problem occurs,
after we restart the s3 server, the flush queue will quickly become 0.

We checked with our s3 (object storage compatible with the s3 protocol)
team and found that it was because we used the s3 v1 sdk. The v1 sdk did
not configure timeout by default, and it would wait indefinitely without
configuration. The s3 v2 sdk defaults to a timeout of 30s, which only
causes write failures and does not cause loki to get stuck.

**Which issue(s) this PR fixes**:
Fixes #<issue number>
At present, as long as there are large logql queries such as 30 days, I
must restart the s3 server, otherwise our ingester queue will continue
to increase. We hope that we can break the stuck go routine after the 5m
timeout occurs.

**Special notes for your reviewer**:
ingester flush queue length up 🔝

![image](https://user-images.githubusercontent.com/9583245/228786401-cf07dc32-dcc0-428f-9558-561b588ea2c4.png)

big query, 30day logql or something happen

![image](https://user-images.githubusercontent.com/9583245/228789991-57185bc3-e628-45a5-82df-e4682590b786.png)

pprof goroutine list profile snapshot

![image](https://user-images.githubusercontent.com/9583245/228787732-6170b8ec-db86-4ca7-8ea0-a7f19b7d6141.png)

**There are other alternatives**:
```
ingester:
  flush_op_timeout: 10m
```
This `flush_op_timeout` configuration is more about the timeout of loki,
not the timeout of s3 client. We will also have various s3 operations
such as delete and getObject. We should add an independent timeout for
s3, just like the cassandra client has a separate The timeout period can
be configured.

And the parameter `flush_op_timeout` in the early version of loki
represents the timeout of writing `a batch of chunks `to s3, not a
timeout of s3. Now it is indeed changed to write to s3 one by one, but
it is not ruled out that in the future, it will be changed back to write
a batch of chunks to s3 sequentially. In this way, `flush_op_timeout:
5m` is far from enough to write a batch of chunks to s3.

```
  cassandra:
    timeout: 5m
```



**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

---------

Co-authored-by: Michel Hollands <42814411+MichelHollands@users.noreply.github.com>",77,60,1,1,"2018-04-16 10:25:39","1830.21"
"grafana/loki","71846b0430ccaf5b93f1772d3c215085acac08c3","trevorwhitney","2023-01-24 18:22:36","true","[helm] add local k3d loki cluster (#8218)",83,57,1,1,"2018-04-16 10:25:39","1739.33"
"grafana/loki","fc3ef3e7cebd43908dc2c3be60ea5b139bef9c9c","cyriltovena","2021-11-30 11:29:18","true","Allow to set JAEGER_REPORTER_MAX_QUEUE_SIZE globally. (#4843)

* Allow to set JAEGER_REPORTER_MAX_QUEUE_SIZE globally.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Update production/ksonnet/loki/config.libsonnet",215,43,0,1,"2018-04-16 10:25:39","1319.79"
"grafana/loki","fc13c9843b7590c32159400cf77393fcb39374a5","aknuds1","2023-10-10 15:20:25","true","Fix some typos (#10845)

**What this PR does / why we need it**:
Fix some typos, no behavioral changes.

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

Signed-off-by: Arve Knudsen <arve.knudsen@gmail.com>",25,66,1,0,"2018-04-16 10:25:39","2000.45"
"grafana/loki","9e84648f3e176d82780db98e59a34d0e40560d1d","owen-d","2022-08-26 20:43:07","true","querier deployment rollingupdate works as a percentage to allow faste… (#6990)

…r rollouts in large environments",81,52,0,1,"2018-04-16 10:25:39","1591.43"
"grafana/loki","6bbb61eb2f52288038ae0112a3b577a1b7861d4d","owen-d","2020-02-11 16:36:36","true","Binary operators in LogQL (#1662)

* binops in ast

* bin op associativity & precedence

* binOpEvaluator work

* defers close only if constructed without error

* tests binary ops

* more binops

* updates docs

* changelog

* better logql parsing errors for binops

Signed-off-by: Owen Diehl <ow.diehl@gmail.com>

* adds ^ operator",113,22,0,1,"2018-04-16 10:25:39","660.51"
"grafana/loki","d421feafe6c9a480dcfe844adaf6fd6f2a4df8bf","salvacorts","2023-03-29 15:21:45","true","Log when returning query-time limit (#8938)

**What this PR does / why we need it**:
At https://github.com/grafana/loki/pull/8727 we introduced various
limits that can now be configured at query time. We always compare the
value of the limit configured at query time with the value set on the
overrides for the tenant or the default if not configured (aka
original); applying the most restrictive one.

If the most restrictive is the original value or the limit is not
configured at query-time, we print the following debug message:

https://github.com/grafana/loki/blob/9e1846c47a1f3685fc540b7d03d285c7530da223/pkg/util/querylimits/limiter.go#L43

It will be printed many times: every time the query is not configured at
query-time, as well as every time the original value is more
restrictive. Moreover, this log message lacks some useful information
such as the original value, the query-time value, the tenant ID and the
limit name.

This PR fixes this by removing the debug message above and printing a
new debug message only if we return the query-time limit. This new log
also prints the tenant ID, the limit name, as well as the original and
the query-time limit values.

**Which issue(s) this PR fixes**:
Fixes https://github.com/grafana/loki/issues/8932

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",85,59,1,1,"2018-04-16 10:25:39","1804.21"
"grafana/loki","34f9c601c9761a5d2e3b0702d00029421e7b2ad2","cyriltovena","2020-04-29 13:32:10","true","Adds config to disable HTTP and GRPC server in Promtail. (#2004)

Fixes #1991.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",117,24,0,1,"2018-04-16 10:25:39","743.63"
"grafana/loki","6ac955cc7d395874ce60516d182678542415bca3","sandeepsukhani","2022-05-25 11:03:24","true","make boltdb-shipper use the generic indexshipper for managing index in object storage (#6226)",74,49,0,1,"2018-04-16 10:25:39","1500.03"
"grafana/loki","4784ea2388e586bada370bd26e1c4558b3fe7ecc","sandeepsukhani","2021-09-28 09:26:31","true","add logfmt promtail stage to be able to extract data from logfmt formatted log (#4346)",141,41,0,1,"2018-04-16 10:25:39","1257.71"
"grafana/loki","4a358bc9ea427c7de8f07d8912b4bb1fdd4c2202","sandeepsukhani","2020-08-04 16:33:06","true","revendor cortex to latest master (#2463)",123,28,0,1,"2018-04-16 10:25:39","838.76"
"grafana/loki","822e94fe6a56798f42fd80b99389ebad1427a6e7","rfratto","2019-11-26 15:53:56","true","Fix v1 label API to be Prometheus-compatible (#1322)

The label and label values API will now return the expected form
of:

```json
{
  ""status"": ""success"",
  ""data"": [
    ""label1"",
    ""label2"",
    ""labeln""
  ]
}
```",83,19,0,1,"2018-04-16 10:25:39","585.48"
"grafana/loki","d43de72f3baaf0f10454f8cf2396897f36825db6","sh0rez","2019-07-15 12:26:50","false","feat(logcli): query from absolute timestamp (#736)

* feat(logcli): query from absolute timestamp

Adds a new flag (`--from`) as to complement `--since`.
While since subtracts a relative duration from the current time, from allows to
specify the absolute start of the lookback window.

Note: `--from` takes precedence over `--since`, but only if set.

* fix(logcli): use RFC3339Nano for -from

To comply with Prometheus, this flag now honors Nanoseconds as well (was using
RFC3339 so far)",104,15,0,0,"2018-04-16 10:25:39","454.33"
"grafana/loki","a00b19240b07aa209101454a19d80b02c1f69489","dannykopping","2021-05-17 09:52:35","true","Modifying issue templates (#3732)

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",195,37,0,1,"2018-04-16 10:25:39","1126.73"
"grafana/loki","05c4b77ed02df5682d35db6582058c9e2764558c","jeschkies","2023-11-10 16:04:36","true","Define QueryResponse and QueryRequest protobufs. (#10956)

**What this PR does / why we need it**:
This will be a follow up to https://github.com/grafana/loki/pull/10688
finally switching over to protos. Hang on tight!

Everything is behind the feature flag `-frontend.encoding=protobuf` which will disable the transcoding to HTTP and HTTPgRPC.


**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [x] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

---------

Signed-off-by: Callum Styan <callumstyan@gmail.com>
Co-authored-by: Callum Styan <callumstyan@gmail.com>
Co-authored-by: Danny Kopping <dannykopping@gmail.com>",0,67,1,1,"2018-04-16 10:25:39","2030.49"
"grafana/loki","3786d742739691bdc867f1cdb66e295c848915fa","dottedmag","2020-04-06 13:08:56","true","JSON encoding: avoid base64 encoding of []byte inside other slices (#1890)

Closes #1889

Signed-off-by: Mikhail Gusarov <misha@ridge.co>",115,24,0,0,"2018-04-16 10:25:39","715.36"
"grafana/loki","3b26c63c82de372149119c36eec962abea8a9542","sandeepsukhani","2021-05-19 11:54:14","true","Boltdb shipper deletion fixes (#3746)

* use return instead of break in select case

* skip compaction on delete requests table",199,37,0,1,"2018-04-16 10:25:39","1128.81"
"grafana/loki","a7d86a83a1ada6d323f1da32c176e5317ae06e99","rfratto","2020-03-03 14:41:54","true","change slack url to slack.grafana.com and use https (#1771)",118,22,0,1,"2018-04-16 10:25:39","682.43"
"grafana/loki","526dc4bbe7d60b7f7a5ed753754e2a5fd0009215","cyriltovena","2021-05-25 14:00:42","true","Fixes parser labels hint for grouping. (#3763)

* Fixes parser labels hint for grouping.

This PR include those now.

Fixes #3707

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes array allocations.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",203,37,0,1,"2018-04-16 10:25:39","1134.9"
"grafana/loki","2a90c4ceb591c8560c319c8163006e679cb496f0","cyriltovena","2021-01-11 13:35:54","true","Improve wal entries encoding. (#3153)

Little trick to avoid memory allocation with regards to bytes slice and string.

benchmp:

```
❯ benchcmp  before.txt after.txt
benchmark                      old ns/op     new ns/op     delta
Benchmark_EncodeEntries-16     1699362       1055627       -37.88%

benchmark                      old allocs     new allocs     delta
Benchmark_EncodeEntries-16     20025          25             -99.88%

benchmark                      old bytes     new bytes     delta
Benchmark_EncodeEntries-16     5625393       4665376       -17.07%
```

This originated from an investigation on CPU usage of ingester.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",107,33,0,1,"2018-04-16 10:25:39","995.63"
"grafana/loki","030ab857cd60b2ba2304acd9167e61e84c8c1be1","sjmiller609","2023-10-23 15:18:42","true","Fix typo in Loki authentication docs (#11007)

**What this PR does / why we need it**:

Typo fix

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)
- [ ] If the change is deprecating or removing a configuration option,
update the `deprecated-config.yaml` and `deleted-config.yaml` files
respectively in the `tools/deprecated-config-checker` directory. <!--
TODO(salvacorts): Add example PR -->",24,66,1,0,"2018-04-16 10:25:39","2013.45"
"grafana/loki","2bb2eebace469683cec366a42f5087db08166556","sandeepsukhani","2020-08-27 11:32:33","true","register boltdb shipper compactor cli flags (#2546)",127,28,0,1,"2018-04-16 10:25:39","861.55"
"grafana/loki","b74db24a007511d437c459aa36c693dc7dae8409","rfratto","2019-09-06 17:40:59","false","docs: re-add docs from #654",119,17,0,1,"2018-04-16 10:25:39","505.55"
"grafana/loki","49bebcebe517ea24631c5593406a541d6a0a97df","sandeepsukhani","2019-10-28 12:13:45","false","fix replication always set to 3 in ksonnet (#1206)",70,18,0,1,"2018-04-16 10:25:39","557.33"
"grafana/loki","5e465ad74e598bc5d0c30af303ecdedbfd63451c","joanlopez","2022-05-20 19:48:06","true","Docs: Fix design docs index page (#6008)

* Fix design docs index

* Apply suggestions from code review

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>",71,49,0,0,"2018-04-16 10:25:39","1495.39"
"grafana/loki","37ff197c9a9989b03868914c34fa1197f572cf74","davkal","2019-04-10 07:26:52","true","Merge pull request #450 from steven-sheehy/separate-charts

Separate loki & promtail charts",99,12,0,0,"2018-04-16 10:25:39","353.88"
"grafana/loki","e1966e16949d92a50414320c58ca2b61efb7ccd2","sshah90","2020-04-07 00:11:54","true","updating typo for end time parameter (#1905)

there are typos in end time parameter description which needs to be corrected.",114,24,0,0,"2018-04-16 10:25:39","715.82"
"grafana/loki","2e348218e240a2191db5a9a12b44616c143de3c4","owen-d","2022-07-05 07:36:43","true","log addtl info about bytes/shard in planning (#6573)

Signed-off-by: Owen Diehl <ow.diehl@gmail.com>",72,51,0,1,"2018-04-16 10:25:39","1539.88"
"grafana/loki","db114b60dab1957ff73043fcc5adc1b1b34dbfc4","tomwilkie","2018-12-17 14:16:06","true","Move all the config for various ways of deploying Loki into one place. (#125)

* Move all the config for various ways of deploying Loki into one place.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>

* Fix reference to consul ksonnet module.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>

* Move getting started docs into the production dir.

Remove the raw docker commands, only use the compose file.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>

* Spell production correctly.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>

* Tweaks

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>

* Tweak docs and docker compose setup; put config in images.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>

* typo

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",37,8,0,0,"2018-04-16 10:25:39","241.16"
"grafana/loki","00afed1eb394595f8baced9bb4a04efc0d5d396a","tomwilkie","2018-05-20 10:42:23","false","Add start, end and direction options to querier.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",0,1,0,0,"2018-04-16 10:25:39","34.01"
"grafana/loki","b3b3da67b86fc30cee4efefec6d0b38bb8601603","julienduchesne","2022-07-06 14:59:26","true","Drone: Do not run pipelines twice on PRs (#6511)

Currently, pipelines that should run in PRs are those that are configured to exclude the `main` or tag refs
However, pipelines are configured to run on PRs, tags and pushes. This means that PRs run the same pipelines for the `pull_request` and `push` events
With this PR, the `push` run should no longer trigger on PRs",72,51,0,0,"2018-04-16 10:25:39","1541.19"
"grafana/loki","14f8faf544a25681a9e7f22cdc9d950cde4241d8","dannykopping","2021-07-27 13:11:06","true","Group memcached queries by container (#4057)

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",106,39,0,1,"2018-04-16 10:25:39","1196.86"
"grafana/loki","a3414a5d9b56e88cc7c3a5616c167fbfaa621411","dannykopping","2021-07-28 15:01:02","true","Promtail: handling tight loop in journal follow logic (#4066)

* Handling EBADMSG explicitly, and preventing tight loop

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Appeasing the linter

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",110,39,0,1,"2018-04-16 10:25:39","1197.94"
"grafana/loki","ba5332867346699edf7afb5b3e2ef02fed2ac2bb","jeanlucmongrain","2020-03-18 13:36:55","true","Prevent prometheus to scrap both services (#1817)

Signed-off-by: Bruno Clermont <bruno@robotinfra.com>",114,23,0,0,"2018-04-16 10:25:39","697.38"
"grafana/loki","5470ff09684f5e86ed9d3dcd65f30722559a9702","salvacorts","2023-04-26 11:27:36","true","GitHub Actions - Replace `::set-output` by new format (#9254)

**What this PR does / why we need it**:
Starting 1st June 2023 workflows using `save-state` or `set-output`
commands via stdout will fail with an error.
More details:
https://github.blog/changelog/2022-10-11-github-actions-deprecating-save-state-and-set-output-commands/

This PR changes all `set-output` commands by the new expected
formatting.

**Which issue(s) this PR fixes**:
Fixes https://github.com/grafana/loki-private/issues/659

**Special notes for your reviewer**:

There are no usages for `save-state`.

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",81,60,1,1,"2018-04-16 10:25:39","1836.29"
"grafana/loki","ea59e4bdc48ebc9c9ff17a9bf9dc01e6833f07fe","ssncferreira","2022-04-21 06:04:51","true","Add changelog entry for split by range of instant queries (#5966)",171,48,0,0,"2018-04-16 10:25:39","1465.82"
"grafana/loki","36e819800474d715ec6b71fc3123546fd372f739","KMiller-Grafana","2021-09-17 07:34:05","true","Docs: Organize and edit the LogQL section (#4342)

* Docs: Organize and edit the LogQL section

* Update docs/sources/logql/metric_queries.md

Co-authored-by: Danny Kopping <dannykopping@gmail.com>

Co-authored-by: Danny Kopping <dannykopping@gmail.com>",140,41,0,0,"2018-04-16 10:25:39","1246.63"
"grafana/loki","f05cecf1942fc2b7b86487858718f949094408be","KMiller-Grafana","2021-11-15 17:07:13","true","Docs: inject newlines into knob descriptions to avoid horizontal scroll bar (#4733)",198,43,0,0,"2018-04-16 10:25:39","1305.03"
"grafana/loki","cc9ba40be00b54013372744a86ecd4ec39c947fd","abenbachir","2022-10-14 05:05:57","true","promtail: Fix exposed metric documentation for request_duration_seconds (#7420)

**What this PR does / why we need it**:
Fixing the documentation about exposed promtail metrics for
promtail_request_duration_seconds

**Which issue(s) this PR fixes**:
No issue related

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the `CONTRIBUTING.md` guide
- [x] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",94,54,1,0,"2018-04-16 10:25:39","1638.78"
"grafana/loki","f571282ffc1fb29220218ee92f2ba2d3a6cbb22c","DylanGuedes","2022-09-29 13:17:48","true","Tests: Improve several tests behavior (#7283)

**What this PR does / why we need it**:
Follow-up of https://github.com/grafana/loki/pull/7273
* Tune a filetarget test to remove created files to guarantee that all
tailers are interrupted/fred
* Call pubsub close for our GCP `pull target`
* Append testName to the job names used in GCP tests. This will help us
to identify which tests are struggling.",91,53,1,1,"2018-04-16 10:25:39","1624.12"
"grafana/loki","8838530976e13f6969849cffd53ca03445bc87a4","dannykopping","2022-05-06 10:24:37","true","Document `/services` API endpoint (#6111)

* Documented /services API endpoint

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Grammar

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",76,49,0,1,"2018-04-16 10:25:39","1481"
"grafana/loki","8c236f1c978785ddc7a47d96afd082143fd97202","gouthamve","2018-12-10 22:56:44","false","Update config for newer kubernetes clusters (#55)

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>",11,8,0,0,"2018-04-16 10:25:39","234.52"
"grafana/loki","5a8bc848dbe453ce27576d2058755a90f79d07b6","robbymilo","2020-07-21 15:53:48","true","Sync docs to website (#2378)

* update docs location

* add workflow

* update docs content

* update content

* cleanup",120,27,0,0,"2018-04-16 10:25:39","825.73"
"grafana/loki","a8d5815510bd959a6dd8c176a5d9fd9bbfc8f8b5","thampiotr","2023-09-19 10:41:51","true","Fix race condition when stopping to tail files (#10631)

**What this PR does / why we need it**:

Users are getting `PromtailFileMissing` alerts, which are defined as:
```
promtail_file_bytes_total{namespace!=""""} unless promtail_read_bytes_total{namespace!=""""}
```

This appears to be due to a race condition where a file can be deleted
while the file target is being stopped.",39,65,1,0,"2018-04-16 10:25:39","1979.26"
"grafana/loki","a205dce83600a874da5a02176217e333662cbf01","agebhar1","2023-05-22 15:56:42","true","chunks-inspect: print chunk version (format) (#9490)

Get the version byte of the current inspecting Loki chunk printed.",67,61,1,0,"2018-04-16 10:25:39","1862.48"
"grafana/loki","4c5d6ea206940041af225b8d5bd885fe383760ef","granular-ryanbonham","2019-03-25 20:26:14","false","Dropping liveness/readiness probe from promtail helm template as there is not health checks currently.. Can add back once something exist and we can do so without if statements..",92,11,0,0,"2018-04-16 10:25:39","339.42"
"grafana/loki","2015763327eb9c4c4c4d437d5f9bd44ef8dee9bf","slim-bean","2020-09-09 20:15:08","true","Loki: Fix query-frontend ready handler (#2610)

* query frontend should not have a default route as it usurps the ready handler, the ready handler was also not implemented completely for the query frontend.

* enable ready check for query-frontend in ksonnet",117,29,0,1,"2018-04-16 10:25:39","873.91"
"grafana/loki","fbfc8abdab90f6ef3b1f13f6adf19822dccefde1","jeschkies","2021-09-27 07:24:03","true","Instruct how to sign `drone.yml`. (#4373)",138,41,0,1,"2018-04-16 10:25:39","1256.62"
"grafana/loki","fbebf675882ad6241a3844da73bf3b6d66916ebb","slim-bean","2021-11-07 23:29:34","true","Loki: check new Read target when initializing boltdb-shipper store (#4681)

* make sure to check for new `Read` target when setting up boltdb-shipper

* also need to make sure ingester querier is added as a dep for Read target

* improve the comment on why we shorten the cache validity.

* fix shellcheck errors

* apply smart defaults to chunk retain period to avoid query gaps.

* typo",180,43,0,1,"2018-04-16 10:25:39","1297.29"
"grafana/loki","c4e376c233c63a40e9b353feba576d86f2c3e20e","blockloop","2021-03-12 16:51:49","true","kustomize/v1/base/{ => config}/loki-config.yaml",156,35,0,0,"2018-04-16 10:25:39","1056.77"
"grafana/loki","245fe8e022235c8ef47bf590443041fe5c99e941","owen-d","2019-12-14 17:46:27","false","roundtrip v2 encoding tests",93,20,0,1,"2018-04-16 10:25:39","603.56"
"grafana/loki","48d0cf67fe4b26e6b355ebe116b4f2c90a958366","Red-GV","2021-06-18 13:51:12","true","Log 1403: OCP Certificate Signing (#59)

* Adding service annotations to all loki services

* Adding secret creation script; Adding OCP flag

* Applying fixes based on review commits

* Adding run flags for deploy

* Moving service manager creation methods to new file

* Adding in go run command argumentes

* First attempt at adding the secret volume mount

* Fixing deploy and adding bundle configurations for openshift

* Initial clean up and review fixes

* Code style changes

* Moving configurations; build can return configuration error

* Removing global variables

* Code clean up

* Adding service monitor build test case

* Review changes

* Code updates

* Code change

* Code change",101,38,0,1,"2018-04-16 10:25:39","1157.89"
"grafana/loki","766f27645d2610a36eaaca8418482b740ae14215","ashwanthgoli","2023-11-09 13:20:16","true","config: remove flags & YAML settings deprecated in 2.9.x (#11151)

**What this PR does / why we need it**:
- remove `-ruler.evaluation-delay-duration`
- remove `boltdb.shipper.compactor.deletion-mode`
- remove compactor flags with prefix`-boltdb.shipper.compactor.*`
- remove `validation.enforce-metric-name`
- remove `log.use-buffered`, `log.use-sync`


**Special notes for your reviewer**:
`log.use-buffered`, `log.use-sync` are not mentioned in the upgrade
guide since they were hidden fields

**Checklist**
- [X] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [X] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [X] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)
- [X] If the change is deprecating or removing a configuration option,
update the `deprecated-config.yaml` and `deleted-config.yaml` files
respectively in the `tools/deprecated-config-checker` directory.
[Example
PR](https://github.com/grafana/loki/pull/10840/commits/0d4416a4b03739583349934b96f272fb4f685d15)

---------

Co-authored-by: J Stickler <julie.stickler@grafana.com>",0,67,1,0,"2018-04-16 10:25:39","2029.37"
"grafana/loki","eda7f313560350167588433057297172b09cb8eb","nvtkaszpir","2021-07-29 07:18:43","true","Bump fluent-bit base image to 1.8 (#4059)",100,39,0,0,"2018-04-16 10:25:39","1198.62"
"grafana/loki","0e21f02d76174509683cb5bc5aa30bd1d5be3d0f","taisho6339","2021-10-29 17:33:33","true","Respect shard number in series api (#4577)

* Respect shard number in series api

* Refactor codes

* remove duplicate logic in instance
* format with goimport

* Improve complexity of getting all fingerprints",168,42,0,0,"2018-04-16 10:25:39","1289.05"
"grafana/loki","bde65667f7c88af17b7729e3621d7bd5d1d3b45f","charleskorn","2023-08-07 08:11:28","true","Upgrade dskit to use packages migrated from weaveworks/common (#10164)

**What this PR does / why we need it**:

This PR upgrades dskit and replaces use of packages from
weaveworks/common with their migrated equivalents in dskit. See
https://github.com/grafana/dskit/pull/342 for more details.

Note that Loki still uses some packages from weaveworks/common that I
haven't migrated (`aws` and `test`) - I'll migrate these separately.

If this PR needs to be rebuilt, I used `rewrite.sh`
([source](https://gist.github.com/charleskorn/48efe62a09d6d70f3de30327003df5c5#file-rewrite-sh))
to generate most of these changes.

**Which issue(s) this PR fixes**:

(none)

**Special notes for your reviewer**:

(none)

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [n/a] Documentation added
- [n/a] Tests updated
- [n/a] `CHANGELOG.md` updated
- [n/a] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [n/a] Changes that require user attention or interaction to upgrade
are documented in `docs/sources/setup/upgrade/_index.md`
- [n/a] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

Co-authored-by: Kaviraj Kanagaraj <kavirajkanagaraj@gmail.com>",53,64,1,0,"2018-04-16 10:25:39","1937.16"
"grafana/loki","5e8a204480cde684067bf4d4d4c5fdec0df7d235","JordanRushing","2021-09-28 17:43:09","true","Add recovery middleware to Ingester; re-add recovery middleware to Querier when not running in standalone mode (#4349)

* Add recovery middleware to ingester; re-add recovery middleware to querier when not running in standalone mode

* Re-add gRPC recovery middleware

* Break out gRPC recovery middleware from setupAuthMiddleware() into new function setupGRPCRecoveryMiddleware()",143,41,0,0,"2018-04-16 10:25:39","1258.05"
"grafana/loki","c2f100c33424dc305e5ecf7e62839a4dbe950799","cyriltovena","2020-05-14 19:38:12","true","Allows to pass inlined pipeline stages to the docker driver. (#2076)

* Allows to pass inlined pipeline stages to the docker driver.

Fixes #1296

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* doc.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",120,25,0,1,"2018-04-16 10:25:39","758.88"
"grafana/loki","1a36874e1cec88efc077e6707ce40155354ca26b","cyriltovena","2021-01-28 15:47:55","true","Ensure we have parenthetis for bin ops. (#3251)

This ensure we correctly keep the order of execution when we stringify a bin operation.
This has recently introduced a bug because we now use stringify to deep clone a LogQL expression.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",123,33,0,1,"2018-04-16 10:25:39","1012.72"
"grafana/loki","89b32835c21da4610faac36c214b75f2fd3f79e4","cyriltovena","2021-05-25 12:47:09","true","Improve mark file processing. (#3762)

This makes boltdb batch for deleting entries smaller and so goroutines for deletion of chunks
are not stuck.
Also improve metrics to refresh more often.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",203,37,0,1,"2018-04-16 10:25:39","1134.85"
"grafana/loki","375ec5ed0217b78be13a1ccd2099539327835c6c","garo","2019-04-09 06:26:04","false","Fix typos",99,12,0,0,"2018-04-16 10:25:39","352.83"
"grafana/loki","37fcbf942881989737a5a6615dbbfbd73f2f288d","sandeepsukhani","2022-01-28 10:09:21","true","use default retention period to check user index may have expired chunks when user does not have custom retention (#5261)",275,45,0,1,"2018-04-16 10:25:39","1377.74"
"grafana/loki","eb4e99d928698b9c4d44aebf736375212baf307a","tomwilkie","2018-04-17 14:19:20","true","Merge pull request #1 from grafana/test

Unit tests in CircleCI",0,0,0,0,"2018-04-16 10:25:39","1.16"
"grafana/loki","54f16c008a9df4281f69f9d7d9ce7d1a74cf333a","wilfriedroset","2022-10-03 06:49:53","true","Fix typo in flags definitions (#7257)

**What this PR does / why we need it**:
As all flags defined for `TSDBShipperConfig` are already prefixed by a
dot, suffixing tsdb with one makes it redundant.

Signed-off-by: Wilfried Roset <wilfriedroset@users.noreply.github.com>",92,53,1,0,"2018-04-16 10:25:39","1627.85"
"grafana/loki","52a3f16039dd5ff655fc3681257d99794f620ec4","salvacorts","2023-10-25 10:16:36","true","Flag categorize labels on streams response (#10419)

We recently introduced support for ingesting and querying structured
metadata in Loki. This adds a new dimension to Loki's labels since now
we arguably have three categories of labels: _stream_, _structured
metadata_, and _parsed_ labels.

Depending on the origin of the labels, they should be used in LogQL
expressions differently to achieve optimal performance. _stream_ labels
should be added to stream matchers, _structured metadata_ labels should
be used in a filter expression before any parsing expression, and
_parsed_ labels should be placed after the parser expression extracting
them.

The Grafana UI has a hard time dealing with this same problem. Before
https://github.com/grafana/grafana/pull/73955, the filtering
functionality in Grafana was broken since it was not able to distinguish
between _stream_ and _structured metadata_ labels. Also, as soon as a
parser expression was added to the query, filters added by Grafana would
be appended to the end of the query regardless of the label category.
The PR above implements a workaround for this problem but needs a better
API on Loki's end to mitigate all corner cases.

Loki currently returns the following JSON for log queries:
```json
...
{
	""stream"": {
	  ""cluster"": ""us-central"",
	  ""container"": ""query-frontend"",
	  ""namespace"": ""loki"",
	  ""level"": ""info"",
	  ""traceID"": ""68810cf0c94bfcca""
	},
	 ""values"": [
                    [
                        ""1693996529000222496"",
                        ""1693996529000222496 aaaaaaaaa.....\n""
                    ],
          ...
},
{
	""stream"": {
	  ""cluster"": ""us-central"",
	  ""container"": ""query-frontend"",
	  ""namespace"": ""loki"",
	  ""level"": ""debug"",
	  ""traceID"": ""a7116cj54c4bjz8s""
	},
	 ""values"": [
                    [
                        ""1693996529000222497"",
                        ""1693996529000222497 bbbbbbbbb.....\n""
                    ],
          ...
},
...
```

As can be seen, there is no way we can distinguish the category of each
label.

This PR introduces a new flag `X-Loki-Response-Encoding-Flags:
categorize-labels` that makes Loki return categorized labels as follows:

```json
...
{
        ""stream"": {
	  ""cluster"": ""us-central"",
	  ""container"": ""query-frontend"",
	  ""namespace"": ""loki"",
	},
	""values"": [
                    [
                        ""1693996529000222496"",
                        ""1693996529000222496 aaaaaaaaa.....\n"",
                       {
                           ""structuredMetadata"": {
                                ""traceID"": ""68810cf0c94bfcca""
                           },
                          ""parsed"": {
                                 ""level"": ""info""
                          }
                       }
                    ],
                    [
                        ""1693996529000222497"",
                        ""1693996529000222497 bbbbbbbbb.....\n"",
                       {
                           ""structuredMetadata"": {
                                ""traceID"": ""a7116cj54c4bjz8s""
                           },
                          ""parsed"": {
                                 ""level"": ""debug""
                          }
                       }
                    ],
    ...
},
...
```

Note that this PR only supports log queries, not metric queries. From a
UX perspective, being able to categorize labels in metric queries
doesn't have any benefit yet. Having said that, supporting this for
metric queries would require some minor refactoring on top of what has
been implemented here. If we decide to do that, I think we should do it
on a separate PR to avoid making this PR even larger.

I also decided to leave out support for Tail queries to avoid making
this PR even larger. Once this one gets merged, we can work to support
tailing.

---

**Note to reviewers**

This PR is huge since we need to forward categorized all over the
codebase (from parsing logs all the way to marshaling), fortunately,
many of the changes come from updating tests and refactoring iterators.

Tested out in a dev cell with query `'{stream=""stdout""} | label_format
new=""text""`.
- Without the new flag:
```
$ http http://127.0.0.1:3100/loki/api/v1/query_range\?direction\=BACKWARD\&end\=1693996529322486000\&limit\=30\&query\=%7Bstream%3D%22stdout%22%7D+%7C+label_format+new%3D%22text%22\&start\=1693992929322486000 X-Scope-Orgid:REDACTED
{
    ""data"": {
        ""result"": [
            {
                ""stream"": {
                    ""new"": ""text"",
                    ""pod"": ""loki-canary-986bd6f4b-xqmb7"",
                    ""stream"": ""stdout""
                },
                ""values"": [
                    [
                        ""1693996529000222496"",
                        ""1693996529000222496 pppppppppppp...\n""
                    ],
                    [
                        ""1693996528499160852"",
                        ""1693996528499160852 pppppppppppp...\n""
                    ],
...
```

- With the new flag
```
$ http http://127.0.0.1:3100/loki/api/v1/query_range\?direction\=BACKWARD\&end\=1693996529322486000\&limit\=30\&query\=%7Bstream%3D%22stdout%22%7D+%7C+label_format+new%3D%22text%22\&start\=1693992929322486000 X-Scope-Orgid:REDACTED X-Loki-Response-Encoding-Flags:categorize-labels
{
    ""data"": {
        ""encodingFlags"": [
            ""categorize-labels""
        ],
        ""result"": [
            {
                ""stream"": {
                    ""pod"": ""loki-canary-986bd6f4b-xqmb7"",
                    ""stream"": ""stdout""
                },
                ""values"": [
                    [
                        ""1693996529000222496"",
                        ""1693996529000222496 pppppppppppp...\n"",
                        {
                            ""parsed"": {
                                ""new"": ""text""
                            }
                        }
                    ],
                    [
                        ""1693996528499160852"",
                        ""1693996528499160852 pppppppppppp...\n"",
                        {
                            ""parsed"": {
                                ""new"": ""text""
                            }
                        }
                    ],
...
```",19,66,1,1,"2018-04-16 10:25:39","2015.24"
"grafana/loki","00ee65226030673e0531c20856cafaed6d722b71","slim-bean","2020-03-26 13:59:19","false","remove a few places we recommend the schema version and consolidate in the configuration doc

Signed-off-by: Edward Welch <edward.welch@grafana.com>",120,23,0,1,"2018-04-16 10:25:39","705.4"
"grafana/loki","3f78d876ff3f05ab889e15f9e9313578e79c0abd","DylanGuedes","2022-01-25 09:15:12","true","Copy `cortex/pkg/prom1` package dependency into Loki (#5196)

* Fork cortex `prom1`.

* Use forked `prom1` instead of Cortex one.",275,45,0,1,"2018-04-16 10:25:39","1374.7"
"grafana/loki","61ff29a57475ee7fd3cd3caa21dccdefb90db65e","DylanGuedes","2022-01-24 10:51:43","true","Copy `cortex/pkg/chunk/purger` package dependency into Loki (#5169)

* Fork cortex `pkg/chunk/purger`.

* Replace `chunk/purger` usage.

- Move away from Cortex implementation to instead use the new forked
  Loki implementation.

* Remove unused code from `storage/chunk/purger`.

* Remove unused vendored dependencies.

* Remove `chunk/purger` implementation.

- Loki already has the `compactor/deletion`, so the `chunk/purger`
  isn't really used.",273,45,0,1,"2018-04-16 10:25:39","1373.77"
"grafana/loki","247c312dd811330084637735f85df08f167383dd","JStickler","2023-09-11 15:26:19","true","[Docs] Separate command and result (#10463)

Now that we've implemented a copy-paste feature for code blocks on the
docs website, put commands and the results in separate code blocks in
the docs for ease of use.

---------

Co-authored-by: Christian Haudum <christian.haudum@gmail.com>
Co-authored-by: Ashwanth <iamashwanth@gmail.com>",43,65,1,0,"2018-04-16 10:25:39","1971.46"
"grafana/loki","336e08fc4b6280f82b9f38bb15ff679819cc4b70","salvacorts","2023-03-28 10:06:14","true","Salvacorts/max querier size messaging (#8916)

**What this PR does / why we need it**:
In https://github.com/grafana/loki/pull/8670 we introduced a new limit
`max_querier_bytes_read`. When the limit was surpassed the following
error message is printed:

```
query too large to execute on a single querier, either because parallelization is not enabled, the query is unshardable, or a shard query is too big to execute: (query: %s, limit: %s). Consider adding more specific stream selectors or reduce the time range of the query
```

As pointed out in [this comment][1], a user would have a hard time
figuring out whether the cause was `parallelization is not enabled`,
`the query is unshardable` or `a shard query is too big to execute`.

This PR improves the error messaging for the `max_querier_bytes_read`
limit to raise a different error for each of the causes above.

**Which issue(s) this PR fixes**:
Followup for https://github.com/grafana/loki/pull/8670

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [x] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

[1]: https://github.com/grafana/loki/pull/8670#discussion_r1146008266

---------

Co-authored-by: Danny Kopping <danny.kopping@grafana.com>",82,59,1,1,"2018-04-16 10:25:39","1802.99"
"grafana/loki","13c667c58c789142cbcd18c5c0926c04951cc0b3","tomwilkie","2019-05-08 09:06:09","false","Update vendor for weaveworks/commont to Tom's fork, for now.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",99,13,0,0,"2018-04-16 10:25:39","387.19"
"grafana/loki","3f0ecd3c7b45b4305f9c07454c433d5b41fa566d","MasslessParticle","2022-09-13 14:30:16","true","Implement all-or-nothing stream ingestion (#7094)

Per-stream sharding will introduce automatic stream sharding on
rate-limited streams. The ingester's current line-by-line behavior may
result in duplicates when a partially-accepted stream is resharded and
sent to other ingesters. This PR makes the ingester either rate limit
the entire stream before attempting to write lines to a chunk. The PR

1. Separates validation, storage, and wal replay into their own
functions
2. Implements a flag to rate limit the whole stream or not
3. Checks rate limits for the whole stream rather than line-by-line
4. Returns an error with information on the whole stream when rate
limited",88,53,1,1,"2018-04-16 10:25:39","1608.17"
"grafana/loki","1903de20ad29c67d68d29c466fb104c7f4fe3d1d","blockloop","2021-03-19 21:06:08","true","increase golangci-lint timeout to 5m",169,35,0,0,"2018-04-16 10:25:39","1063.94"
"grafana/loki","1c8ebaff61829fb92184b2eda340aea3e3f61f83","shwetaap","2022-07-06 15:22:28","true","operator: Build and publish images for docker hub (#6086)",72,51,0,0,"2018-04-16 10:25:39","1541.21"
"grafana/loki","66324a65a2d7e8817e8f77f959d3293a3acf1865","DylanGuedes","2022-06-22 12:18:35","true","Set RingManager mode as Server if in read target. (#6427)",70,50,0,1,"2018-04-16 10:25:39","1527.08"
"grafana/loki","a1d090e16106a47fe876afe60c1ec93a445dd67a","owen-d","2020-01-08 21:35:58","false","Fix/deadlock frontend queue (#1490)

* buffers splitby interval channels to prevent deadlocks

* improves codec merge test requiring merging from multiple intervals

* bound concurrency by min(parallelism,jobs)

* approximates goroutine test",104,21,0,1,"2018-04-16 10:25:39","627.72"
"grafana/loki","a66e148f83ae2b7c874794abaa55d9e5970ff7a5","liguozhong","2022-01-04 07:47:41","true","[new feature] logql: extrapolate unwrapped rate function (#5013)

* [new feature] logql：reimplement metrics rate function

* [new feature] logql：reimplement metrics rate function

* [new feature] logql：reimplement metrics rate function

* [new feature] logql: extrapolate unwrapped rate function #5013",253,44,0,1,"2018-04-16 10:25:39","1353.64"
"grafana/loki","8fa33d7496af67f20dda18b08569868ff74d64c8","daixiang0","2019-01-10 21:23:58","false","deploy promtail on master node as default (#184)

Signed-off-by: Xiang Dai <764524258@qq.com>",60,9,0,0,"2018-04-16 10:25:39","264.46"
"grafana/loki","8a3150b68e6b5de7e62fb2384b0d337a389743e2","daixiang0","2019-03-26 09:22:19","false","Add health check

Signed-off-by: Xiang Dai <764524258@qq.com>",92,11,0,0,"2018-04-16 10:25:39","339.96"
"grafana/loki","8ac859c5cdeb4b8670bf03e6ea5ceb0133bb74b8","owen-d","2022-07-21 07:16:17","true","[Enhancement] Removes memcached failure log (#6720)

* removed memcached failure log
Signed-off-by: Owen Diehl <ow.diehl@gmail.com>

* remove memcached fetch error log
Signed-off-by: Owen Diehl <ow.diehl@gmail.com>",72,51,0,1,"2018-04-16 10:25:39","1555.87"
"grafana/loki","46e67f71a8c33660ca283b669493d1c5e7cc36e4","tomwilkie","2018-11-25 15:01:04","false","Don't ignore the error

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",5,7,0,0,"2018-04-16 10:25:39","219.19"
"grafana/loki","4f2316ff7462f9afcb52881d303cbeac51918941","eraac","2020-01-06 14:59:54","false","<documentation>: Update IAM requirement (#1466)

* update iam requirement

* move ListTables in correct section",106,21,0,0,"2018-04-16 10:25:39","625.44"
"grafana/loki","9265b8eef55bb252bb3116d34eabebfa5eb5ed56","j4rj4r","2022-09-21 15:21:38","true","Helm: Fix ExternalLicence (#7189)

**What this PR does / why we need it**:

Update references from:

```
.Values.useExternalLicense
.Values.externalLicenseName
```
to

```
.Values.enterprise.useExternalLicense
.Values.enterprise.externalLicenseName
```

**Which issue(s) this PR fixes**:
Fixes #7171 

Signed-off-by: CAJNA Jarod <contact@jarodcajna.fr>",86,53,1,0,"2018-04-16 10:25:39","1616.21"
"grafana/loki","9bc6e85604bcfb3d486eb4bc48305fdc163f0589","jeschkies","2022-10-25 11:24:53","true","Helm: Allow users to define remote write for metrics. (#7399)",90,54,1,1,"2018-04-16 10:25:39","1650.04"
"grafana/loki","289c946667e590c4e1e40a7bb30f78513e485467","slim-bean","2021-11-01 20:45:39","true","put Karen back in charge of the docs! (#4609)",169,42,0,1,"2018-04-16 10:25:39","1291.18"
"grafana/loki","e59adccfa0bbdade7dfd7a1e0747c2629064e931","sandeepsukhani","2020-07-28 10:57:44","true","create smaller unique files from boltdb shipper and other code refactorings (#2261)

* rename package local to shipper

* reorganized files to separate out uploads and downloads

* create smaller unique files from boltdb shipper and other improvements

* cancellation of downloading of initial files when service is being stopped

* migration of existing files to dedicated folders and cleanup of index from ingesters

* some more improvements to uploads and downloads code

* tests for uploads and downloads package in shipper

Signed-off-by: Sandeep Sukhani <sandeep.d.sukhani@gmail.com>

* test cleanup fix and some other minor changes

* refactor getting uploader from object key

* better naming

* changes suggested from PR review

* Fixes goroutine loop.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Simplify getoradd table.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes loop in upload manager.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* some more tests, logs and changes suggested from PR review

* move ready state check for downloaded table inside query function

* add info log for successfully finishing uploading of a table

* fix merge conflict

* fix ingester name and mode config

Co-authored-by: Cyril Tovena <cyril.tovena@gmail.com>",126,27,0,1,"2018-04-16 10:25:39","832.52"
"grafana/loki","854930e661ee566734e6502ddfb5f4ce08364d72","owen-d","2020-12-01 18:25:51","true","headblock checkpointing up to v3 (#3013)",121,31,0,1,"2018-04-16 10:25:39","955.83"
"grafana/loki","86ed98c1fac0defb93c5152a3983b179969875ae","chaudum","2022-01-18 16:17:27","true","Fix promtail deadlock (#5170)

* Remove unused clientConfigs argument from NewTargetsManagers

* Do not create targetScrapeConfigs if stdin target is used

* fixup! Remove unused clientConfigs argument from NewTargetsManagers

* Close file watcher when target is removed

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* fixup! Close file watcher when target is removed

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* fixup: add changelog entry

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* fixup! fixup! Close file watcher when target is removed

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",265,45,0,1,"2018-04-16 10:25:39","1367.99"
"grafana/loki","4c2feb32b55dc0431aff659607b67e4ac078325e","cyriltovena","2021-07-27 12:22:25","true","Fixes test helper `newChunk` in the storage pkg. (#4056)

I wanted to test that overlapping chunks are correctly re-ordered
and bump into a rounding issue.
Keeping both for future will avoid the same mistake.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",106,39,0,1,"2018-04-16 10:25:39","1196.83"
"grafana/loki","28a7733edeb6eddff99952b98fcba2121f78ed37","salvacorts","2023-03-30 09:00:58","true","Rename config for enforcing a minimum number of label matchers (#8940)

**What this PR does / why we need it**:
Followup PR for https://github.com/grafana/loki/pull/8918 renaming
config. See https://github.com/grafana/loki/pull/8918/files#r1151820792.

**Which issue(s) this PR fixes**:
Fixes https://github.com/grafana/loki-private/issues/699

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

---------

Co-authored-by: Dylan Guedes <djmgguedes@gmail.com>",84,59,1,1,"2018-04-16 10:25:39","1804.94"
"grafana/loki","9be21a7c6b2d4aec3257699776488d9d87dea65e","cyriltovena","2020-02-24 18:06:39","true","This logs queries with latency tag when  recording stats. (#1733)

* This logs queries  with latency tag when  recording stats.

Useful for building a dashboard of slow queries.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* mod-check.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",116,22,0,1,"2018-04-16 10:25:39","673.57"
"grafana/loki","e53d2032fe5a13dc682caa77e4a8c9cdf06ba4a2","sandeepsukhani","2020-09-10 11:51:22","true","fix a panic when trying to stop boltdb-shipper multiple times using sync.once (#2613)",117,29,0,1,"2018-04-16 10:25:39","874.56"
"grafana/loki","7e658e8766ee8601c0474b5644b6c87ca72433f5","cyriltovena","2021-06-10 07:09:00","true","Fixes a flaky retention test. (#3833)

This was due because the condition was using a string array that may be not in correct order.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",164,38,0,1,"2018-04-16 10:25:39","1149.61"
"grafana/loki","aa32194262d10b12c411e9881bfc076cfe8a6e2f","davkal","2019-03-25 14:57:53","true","Merge pull request #413 from steven-sheehy/helm-securitycontext

Helm: Run with reduced privileges",92,11,0,0,"2018-04-16 10:25:39","339.19"
"grafana/loki","a3bacd5739da2d41f3f9a2ad45fb58e8d0039006","DylanGuedes","2022-02-08 19:57:00","true","Test `LegacySample` and `LegacyLabelPair` compatibility. (#5313)

The expected values were built from Cortex' `cortexpb.Sample` and
`cortexpb.LabelPair`.
They prove that `logproto.LegacyLabelPair` and `logproto.LegacySample`
are not compatible with `logproto.LabelPair` and `logproto.Sample`,
requiring us to keep both implementations for now.",280,46,0,1,"2018-04-16 10:25:39","1388.15"
"grafana/loki","8948ce1f2eff15747efba9114815916daebb9880","rfratto","2020-03-30 14:52:43","true","clarify logcli commands and output (#1712)

* clarify logcli commands and output

This commit attempts to do two things:

1. Differentiate between log entries and raw log lines, where the latter
   is what is produced by `-oraw`.
2. Explain the difference between `logcli query` and
   `logcli instant-query`.

Fixes #1676.

* address feedback

* address more feedback

* explain that instant-query is not useful for log lines

* address review feedback

This commit leaves logcli.md unmodified; that will be done in a later
commit if the changes are approved.

* sync logcli.md with command output",121,23,0,1,"2018-04-16 10:25:39","709.44"
"grafana/loki","8a9abdfe1646954c2d21964b30359641b692a932","sandeepsukhani","2021-07-22 07:55:17","true","Compactor improvements (#4018)

* use previously compacted file as seed file and copy index into it

* allow configuring compactor to compact multiple tables at a time",98,39,0,1,"2018-04-16 10:25:39","1191.65"
"grafana/loki","c071447900c316545a12f18fc2ced20e99ed03e3","kevinburkesegment","2023-10-11 12:15:19","true","clients/pkg/promtail/targets/gcplog: avoid listening on 0.0.0.0 (#10411)

**What this PR does / why we need it**: Previously on Mac, running these
tests triggers a dialog box asking me to accept all incoming network
connections. Edit the test to listen on localhost only.

**Which issue(s) this PR fixes**:
Updates #10407

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added (Just test changes, no documentation changes)
- [X] Tests updated
- [x] `CHANGELOG.md` updated (Not worth adding to CHANGELOG)
- [x] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label (Not worth adding to release notes)
- [x] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md` (No user attention
required)
- [x] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)
(No need to do this)",25,66,1,0,"2018-04-16 10:25:39","2001.33"
"grafana/loki","077b6c2e5c79b9221d8f7abebfc3d9a43c281476","periklis","2021-04-22 16:59:52","true","Add support for compactor (#30)",165,36,0,1,"2018-04-16 10:25:39","1102.02"
"grafana/loki","72dcda165a41e3d71127ac801f9e5260e1cc82a1","cyriltovena","2021-04-14 09:52:28","true","Adds chunk filter hook for ingesters. (#3603)

* Adds chunk filter hook for ingesters.

Follow up on https://github.com/grafana/loki/pull/3569 this is the missing piece.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* That interface is not required to change.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",156,36,0,1,"2018-04-16 10:25:39","1088.48"
"grafana/loki","3f8de6bfd7ddb21921738fbd3eac1449b99ad0ef","cyriltovena","2020-11-03 14:08:35","true","Revert ""Add support for building binaries for ppc64le arch (#2813)"" (#2867)

This reverts commit f715e0f847a8f4256066d9fe2b9f49aab035d935.",126,30,0,1,"2018-04-16 10:25:39","927.65"
"grafana/loki","a5cb38d54c2c62930dbdcce4620eeadf6957016b","cyriltovena","2021-01-26 14:16:47","true","Fixes unmarshalling of tailing responses. (#3237)

* Fixes unmarshalling of tailing responses.

Some websocket were still using old json package.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes missing update of generated files.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",121,33,0,1,"2018-04-16 10:25:39","1010.66"
"grafana/loki","faeccdc8319602f110b28f356e43bdc3afb48603","fredrikekre","2021-05-31 11:47:43","true","[docs] add LokiLogger.jl to unofficial clients. (#3756)",203,37,0,0,"2018-04-16 10:25:39","1140.81"
"grafana/loki","85e2e52279ecac6dc111d5c113c54d6054d2c922","trevorwhitney","2023-08-29 17:47:33","true","fix: respect query matcher in ingester when getting label values (#10375)

There is a bug when passing a query parameter to the
`/label/:label/values`. Currently the ingester is not respecting this
query string, and so is always returning all label values. This PR fixes
that bug.",48,64,1,1,"2018-04-16 10:25:39","1959.56"
"grafana/loki","bb2927172a6f9e4d3b925015d1bf6227d90a6993","sandeepsukhani","2022-10-25 10:05:50","true","tsdb post compaction cleanup (#7502)

**What this PR does / why we need it**:
Previously when we were reading the whole tsdb index in memory, there
was not much cleanup required after we were done with the index. Now
that we are mmaping the tsdb index, we need to close the mmap.
I had missed calling `index.Close()` on the compacted-away multi-tenant
index. This causes the compactor to retain the files on disk, leading to
the compactor running away from disk space. This PR takes care of it.

While doing the changes, I noticed that some of the tests failed due to
`LabelValues` tsdb implementation returning strings valid only until the
underlying byte slice stays valid. Since the underlying byte slice could
become invalid when we close the tsdb, we should return a copy instead
of yolostring. This can also happen on the query path when a sync closes
the index before we get to return the response. This PR also fixes that.",90,54,1,1,"2018-04-16 10:25:39","1649.99"
"grafana/loki","4108aedeea108e98254746edce140c6e392e9692","hterik","2023-01-11 23:41:56","true","Promtail Docs: Clarifiy labels and timestamps set by cri stage (#7521)

Add description that `cri` stage not only adds labels for timestamp, but
that it also sets the timestamp of the log-entry before sending it.

Honestly I don't know if this is the intention or not, but this is how
things are implemented today and it makes the most sense. Even if not,
changing the behavior now would not be possible without breaking old
implicit assumptions, so better have more explicit documentation.

Also clarify that the cri-`flags` get extracted as a label.",99,57,1,0,"2018-04-16 10:25:39","1726.55"
"grafana/loki","c182940201fb4a51de84532d6c4de03f256e9cc6","ngc4579","2023-10-11 08:35:50","true","Helm: Fix GrafanaAgent tolerations scope (#10813)

**What this PR does / why we need it**:
`monitoring.selfMonitoring.grafanaAgent.tolerations` was evaluated
inside a wrong scope in the `GrafanaAgent` template, thus having no
effect at all.

**Which issue(s) this PR fixes**:
n/a

**Special notes for your reviewer**:
Fixes an issue with my first (ever)
[PR](https://github.com/grafana/loki/pull/10613) that I thought was
rather trivial but somehow turned out not to be. At least, regarding my
inability to correctly count `with` / `end` scope markers... :(

**Checklist**
- [X] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [X] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [X] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

---------

Co-authored-by: Michel Hollands <42814411+MichelHollands@users.noreply.github.com>",25,66,1,0,"2018-04-16 10:25:39","2001.17"
"grafana/loki","e465e38382dee10772e34da72adef5086c696c47","Tazmaniac","2023-01-12 20:07:00","true","Helm: Add missing azure check (#8113)

In Azure storage case, storage ruler config is correctly prepared, but
not included.",100,57,1,0,"2018-04-16 10:25:39","1727.4"
"grafana/loki","217a914f98188cbbd31e51bd9b8e0da0d1366e17","TeddyAndrieux","2022-11-29 12:34:54","true","helm/loki: Allow to override default loki `target` (#7791)

**What this PR does / why we need it**:

Add the ability to change the Loki `target` argument. E.g. one might
want to use the single-binary which has target `all` but also the
`table-manager` which is not part of it. So one can override the target
with `all,table-manager`.

**Which issue(s) this PR fixes**:
Fixes #7788 

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the `CONTRIBUTING.md` guide
- [x] `CHANGELOG.md` updated",96,55,1,0,"2018-04-16 10:25:39","1684.09"
"grafana/loki","dd7200564bb0da76bedd49df7a961dab330340cd","cyriltovena","2022-04-11 19:10:33","true","Improve kafka discovery test. (#5860)

The `Test_TopicDiscovery` expections were wrong, we only need them to be true at some point since this
is reconciliation loop.

Fixes #5858

Nice catch !

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",323,48,0,1,"2018-04-16 10:25:39","1451.11"
"grafana/loki","279349930991150c1ce27ec379fe783390e05514","sandeepsukhani","2020-10-25 20:50:22","true","Boltdb shipper metrics changes (#2790)

* rename boltdb shipper metrics to have table in their name instead of files

* Increment tables_sync_operation_total metric during periodic syncs as well

* tweak error handling

Co-authored-by: Edward Welch <edward.welch@grafana.com>",119,30,0,1,"2018-04-16 10:25:39","919.93"
"grafana/loki","c5453f156c1d4b5a9d2d4151eaabc689b32811bd","3deep5me","2023-04-11 14:47:10","true","Helm: Removed support for PodDisruptionBudget in policy/v1alpha1 and upgraded it to policy/v1 (#8894)

This PR removes the old policy/v1beta1 from pdb objects and removes with
it the not needed helper function. This simplifies the helmchart and
makes it more compatible with argocd and newer kubernetes versions.

**Which issue(s) this PR fixes**:
Fixes #8887 

**Special notes for your reviewer**:
First PR 😅",83,60,1,0,"2018-04-16 10:25:39","1816.18"
"grafana/loki","92aa69bb5cddb8a4344fb8fcf48a3b1ea14c3a01","KMiller-Grafana","2022-06-30 20:20:48","true","Docs: Add multi-tenant query curl examples (#6530)

* Docs: Add multi-tenant query curl examples

* Revise per review suggestions.",73,50,0,0,"2018-04-16 10:25:39","1535.41"
"grafana/loki","bd321fb4f2f34198aa5487fbc7613139003e19b6","liguozhong","2021-01-05 17:20:56","true","lru cache logql.ParseLabels (#3092)

* lru cache logql.ParseLabels

* lru cache logql.ParseLabels

* lru cache logql.ParseLabels

* lru cache logql.ParseLabels

* lru cache logql.ParseLabels",113,33,0,1,"2018-04-16 10:25:39","989.79"
"grafana/loki","82cead2af7986d90119a5357f8377b3dbf3eaa81","cyriltovena","2021-02-09 10:09:06","true","Increase the windows bookmark buffer. (#3303)

See this discussion https://github.com/grafana/loki/pull/3246#discussion_r568674040

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",125,34,0,1,"2018-04-16 10:25:39","1023.49"
"grafana/loki","0be64fcb34eba40cbda0d5c6e1f5ec9732b10aaa","cyriltovena","2020-07-11 22:22:19","true","Improve metric queries by computing samples at the edges. (#2293)

* First pass breaking the code appart.

Wondering how we're going to achieve fast mutation of labels.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Work in progress.

I realize I need hash for deduping lines.
going to benchmark somes.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Tested some hash and decided which one to use.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Wip

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Starting working on ingester.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Trying to find a better hash function.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* More hash testing we have a winner. xxhash it is.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Settle on xxhash

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Better params interfacing.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add interface for queryparams for things that exist in both type of params.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add storage sample iterator implementations.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixing tests and verifying we don't get collions for the hashing method.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixing ingesters tests and refactoring utility function/tests.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixing and testing that stats are still well computed.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixing more tests.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* More engine tests finished.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes sharding evaluator.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes more engine tests.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fix error tests in the engine.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Finish fixing all tests.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes a bug where extractor was not passed in correctly.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add notes about upgrade.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Renamed and fix a bug.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add memchunk tests and starting test for sampleIterator.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Test heap sample iterator.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* working on test.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Finishing testing all new iterators.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Making sure all store functions are tested.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Benchmark and verify everything is working well.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Make the linter happy.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* use xxhash v2.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fix a flaky test because of map.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* go.mod.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

Co-authored-by: Edward Welch <edward.welch@grafana.com>",121,27,0,1,"2018-04-16 10:25:39","816"
"grafana/loki","768bf914e00f008bc833b87da7fdbdb55152df35","cyriltovena","2019-12-20 20:56:27","false","Changes the encoding used for the benchmark in the store. (#1448)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",98,20,0,1,"2018-04-16 10:25:39","609.69"
"grafana/loki","3ecfe2478ce746341286f72415574b2402646ca1","slim-bean","2022-10-25 18:56:02","true","Fix drone signature (#7512)

Signed-off-by: Edward Welch <edward.welch@grafana.com>

**What this PR does / why we need it**:

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the `CONTRIBUTING.md` guide
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

Signed-off-by: Edward Welch <edward.welch@grafana.com>",89,54,1,1,"2018-04-16 10:25:39","1650.35"
"grafana/loki","29eaec1a04bbd8013b35cf78cf29a28d5071c331","slim-bean","2019-05-29 02:50:43","false","implementing all the functions for the counter and gauge metric types
metric test is still failing because of missing metrics when the counter is 0
added a lot of TODO's I need to go back and cleanup",110,13,0,1,"2018-04-16 10:25:39","407.93"
"grafana/loki","f62b4ae1905cca995c9eca3cfda331b7777b514a","slim-bean","2022-04-20 04:41:48","true","Other: Update pr template (#5885)

* update pr template

* Add some more notes about upgrade guide",174,48,0,1,"2018-04-16 10:25:39","1464.76"
"grafana/loki","962d081cf0f4c14209c6525c09b6a8d167eb4589","alanconway","2022-06-15 04:54:32","true","Add lokistack prefix to role and rolebinding names. (#6397)",68,50,0,0,"2018-04-16 10:25:39","1519.77"
"grafana/loki","e69b64f6bf3fb62fc3f3cf61db01dd7c453b14c4","slim-bean","2020-08-13 15:29:36","true","Promtail: Drop stage (#2496)

* Adding a drop stage, it's very broken but want feedback on the design in the docs.

* documentation fixes

* documentation fixes

* implemented and added tests

* add a metric to track dropped logs with a configurable reason label.",119,28,0,1,"2018-04-16 10:25:39","847.71"
"grafana/loki","2864a4f728878df083a6a80352e22f58f58804cc","trevorwhitney","2021-10-26 06:52:30","true","enable virtual read write targets (#4498)

Co-Authored-By: Mauro Stettler <mauro.stettler@gmail.com>

Co-authored-by: Mauro Stettler <mauro.stettler@gmail.com>",165,42,0,1,"2018-04-16 10:25:39","1285.6"
"grafana/loki","6dc722bc9f4fe1ec2eddc8ab152058b86c745f30","MasslessParticle","2023-07-14 20:38:19","true","correctly handle unpack when reordering stages (#9936)

The optimization to reorder stages doesn't take into account the
`unpack` stage. When line filters come after unpack stages, they
shouldn't be moved.",58,63,1,1,"2018-04-16 10:25:39","1914.68"
"grafana/loki","22b672986a83c2aa160a9ff37bc953429848987b","chaudum","2023-03-14 14:31:48","true","Revert ""Implement hierarchical queues for query scheduler"" (#8796)

Reverts grafana/loki#8691

These changes caused problems with the scheduler in our dev environments.

I will conduct further testing and include the reverted changes in https://github.com/grafana/loki/pull/8752",89,59,1,1,"2018-04-16 10:25:39","1789.17"
"grafana/loki","10c92a901e1d07dcd36bdca83b56db27aa8e073a","aknuds1","2021-08-19 15:35:58","true","Chore: Upgrade to latest Cortex (#4188)

* Chore: Upgrade to latest Cortex

Signed-off-by: Arve Knudsen <arve.knudsen@gmail.com>

* Fix formatting

Signed-off-by: Arve Knudsen <arve.knudsen@gmail.com>",131,40,0,0,"2018-04-16 10:25:39","1218.97"
"grafana/loki","416320dc5ff0b86592e88277c283362763216110","kavirajk","2023-08-23 09:18:38","true","Revert ""Stopped String() from doubly escaping regex characters"" (#10318)

Reverts grafana/loki#10277

This currently breaks and cause panics for query with regex label
matcher. Reverting it till we find the fix.",50,64,1,1,"2018-04-16 10:25:39","1953.2"
"grafana/loki","e33bf5eeadb8d8bc21c80aeddef03647e944f8e6","mizeng","2019-07-05 13:46:21","false","sync with Cortex for s3 path style url (#705)",99,15,0,0,"2018-04-16 10:25:39","444.39"
"grafana/loki","eb7b495565122dd8c425dfdff003b0e0748d9eed","roidelapluie","2019-11-27 19:08:14","false","Metrics: use Namespace everywhere when declaring metrics (#1320)

Code linting to make things consistent.

Signed-off-by: Julien Pivotto <roidelapluie@inuits.eu>",83,19,0,0,"2018-04-16 10:25:39","586.61"
"grafana/loki","c6d3228263c7230652ba4da3f98545b0e7c4f5e0","cyriltovena","2021-11-30 14:35:34","true","Correctly set string in env variable in jsonnet (#4847)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",214,43,0,1,"2018-04-16 10:25:39","1319.92"
"grafana/loki","dcbfecf9e549f264e5c16b1eefbe1b4071e508c1","cyriltovena","2020-12-01 13:44:21","true","Fixes the ruler storage with  the boltdb store. (#3008)

This ensure we have read-only local index, and also query chunk store from ingesters. Found this bug while deploying a new cluster using the ruler and boltdb store.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",120,31,0,1,"2018-04-16 10:25:39","955.64"
"grafana/loki","3d27b1f468c2e3d23a6731309c9b93298a0e497b","nehaev","2020-11-24 15:44:39","true","docs: added loki4j to the list of unofficial clients (#2869)",114,31,0,0,"2018-04-16 10:25:39","948.72"
"grafana/loki","747771c640e6b4fc8e772754072fcbc49a201a1d","slim-bean","2019-06-03 21:22:37","false","release stage is broken, removing for now",109,14,0,1,"2018-04-16 10:25:39","412.71"
"grafana/loki","625c4f1f532ef9d26a80028cecb4a0031cf4c92d","cyriltovena","2019-08-07 15:18:53","false","Move to milliseconds for samples to follow prometheus convention",98,16,0,1,"2018-04-16 10:25:39","476.45"
"grafana/loki","274170ffece003e0da51ba43189e9bae7f0edba3","daixiang0","2019-06-19 10:53:32","false","Merge branch 'master' into reduce-config-option",84,14,0,0,"2018-04-16 10:25:39","428.27"
"grafana/loki","36f5ebfbda11e66634e2e4534ff14c00f65a8209","davkal","2019-04-17 13:25:24","false","Small edits",103,12,0,0,"2018-04-16 10:25:39","366.37"
"grafana/loki","d8c22bf212cdb6715f9dca9699c707068086553c","davkal","2019-02-25 15:37:36","false","Clarify promtail troubleshooting around positions (#351)",82,10,0,0,"2018-04-16 10:25:39","309.22"
"grafana/loki","50fdd2d4442001a40091279e87033513b1df1eac","tomwilkie","2018-05-16 15:29:28","false","Fix bugs in ingester iterators.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",0,1,0,0,"2018-04-16 10:25:39","30.21"
"grafana/loki","b57d260ddc3e3bbd8caf8286e82da5421069f717","shantanualsi","2023-08-09 14:42:55","true","Upgrade alpine 3.16.5 -> 3.16.7 (#10188)

**What this PR does / why we need it**:

**Which issue(s) this PR fixes**:
Fixes #10181

Fixes Open SSL vulnerabilities
[CVE-2023-1255](https://security.alpinelinux.org/vuln/CVE-2023-1255),
[CVE-2023-2650](https://security.alpinelinux.org/vuln/CVE-2023-2650),
[CVE-2023-2975](https://security.alpinelinux.org/vuln/CVE-2023-2975),
[CVE-2023-3446](https://security.alpinelinux.org/vuln/CVE-2023-3446),
[CVE-2023-3817](https://security.alpinelinux.org/vuln/CVE-2023-3817)

Alpine Release Notes:

[3.16.7](https://www.alpinelinux.org/posts/Alpine-3.15.10-3.16.7-3.17.5-3.18.3-released.html)

[3.16.6](https://www.alpinelinux.org/posts/Alpine-3.15.9-3.16.6-3.17.4-3.18.2-released.html)

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",53,64,1,0,"2018-04-16 10:25:39","1939.43"
"grafana/loki","cc6634972f9ee8af669bc128de3d42293ba33d65","ashwanthgoli","2023-08-25 15:22:32","true","config: deprecates unordered-writes and few unused configs (#10324)

**What this PR does / why we need it**:

Deprecates the following configs:

out of order writes will be the default and the only format with the
next major release
- ingester.unordered-writes

these need not be configurable, were added for testing
- log.use-buffered
- log.use-sync

unused
- frontend.forward-headers-list


**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",49,64,1,0,"2018-04-16 10:25:39","1955.46"
"grafana/loki","15714b11c2ce23d10a2db2de52125eb2a919d347","julienduchesne","2023-04-17 17:08:44","true","Skip pipelines that require secrets in forks (#9161)",82,60,1,0,"2018-04-16 10:25:39","1827.53"
"grafana/loki","43a21eac0379d7f9320cd94f2d27a3a46bd19d3f","kavirajk","2023-02-20 09:10:09","true","fix(promtail): Make `cri` tags streams aware. (#8497)",72,58,1,1,"2018-04-16 10:25:39","1764.95"
"grafana/loki","e7e752378f0c5f8abe5767be7574d3c6a9fb7f2d","MichelHollands","2023-03-29 08:02:23","true","Add release notes for v2.7.5 release (#8924)

**What this PR does / why we need it**:

This adds the release notes for v2.7.5 and v2.7.4. This last release was
apparently not added last time.

This will be backported to the release branch as well in a separate PR.

**Checklist**
- [X] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [X] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",85,59,1,1,"2018-04-16 10:25:39","1803.9"
"grafana/loki","3f5f0c38d0f5a610d235964ce3849d06c8f9ee1f","agologan","2023-01-12 23:06:03","true","Helm: fix ruler config storage regression (#8071)

While #7528 fixed an issue with null storage when using filesystem it
changed the behavior of other storage configs.
Fix reintroduces previous behavior where by default you get the computed
`rulerStorageConfig` and appends/overlays `rulerConfig`.
This enables the use of `.Values.storage` adding to `rulerConfig` only
the extra parameters one would need e.g. `enable_api: true`.


Co-authored-by: Travis Patterson <travis.patterson@grafana.com>",97,57,1,0,"2018-04-16 10:25:39","1727.53"
"grafana/loki","334c39461f89407057b27be02d7afd8e75ff21c6","shwetaap","2022-06-21 08:50:38","true","operator: Enhancement Proposal to configure log retention (#6232)

Signed-off-by: Shweta Padubidri <spadubid@redhat.com>",68,50,0,0,"2018-04-16 10:25:39","1525.93"
"grafana/loki","54b27674f8a67a844f236f1b78280527384bd0ce","rfratto","2019-11-05 22:22:41","true","Standardize schema used in `match` stage (#1234)

This PR changes the schema for the `drop` field in `match` stages to use the same schema present throughout the rest of the docs. The comment describing the field has also been updated.",66,19,0,1,"2018-04-16 10:25:39","564.75"
"grafana/loki","30d2b7640ff9d55901ba26208a37fa75220f165c","kavirajk","2023-08-11 10:04:30","true","CODEOWNERS: Add codeowners for loki operator (#10222)

**What this PR does / why we need it**:
Explicit code-owners for loki operator

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",52,64,1,1,"2018-04-16 10:25:39","1941.24"
"grafana/loki","fd93a6c9994f3da477ffb2f96cbe1cc16e11f476","MichelHollands","2022-10-24 13:02:02","true","Add how to connect to Azure using Service Principal (#7485)

Add documentation for https://github.com/grafana/loki/pull/7179 which
added authentication using a Service Principal for Azure.",91,54,1,1,"2018-04-16 10:25:39","1649.11"
"grafana/loki","2bb2a2c0e1b9e68dfa05d3b88c9e435c71eaa5e7","DylanGuedes","2022-07-11 19:32:05","true","Loki: Remove ring client from the distributor (#6622)

Removes the ring client from the distributor.
- It was originally added on PR #4938 because it was the only ring implementation with HTTPHandler support (used for the ring page). Now that DSKit has support for the other ring implementations (including the lifecycler) this isn't necessary anymore.
- It had an IgnoreUnhealthyInstancesReplicationStrategy attached to it, added by mistake",71,51,0,1,"2018-04-16 10:25:39","1546.38"
"grafana/loki","73bea7e4fadcad5ce10e32037f65fbc6a01a542f","DylanGuedes","2022-09-27 14:53:48","true","Promtail: Add compressed files support (#6708)

**What this PR does / why we need it**:
Adds to Promtail the ability to read compressed files. It works by:
1. Infer which compression format to use based on the file extension
2. Uncompress the file with the native `golang/compress` packages
3. Iterate over uncompressed lines and send them to Loki

Its usage is the same as our current file tailing.

**Which issue(s) this PR fixes**:
Fixes #5956 

Co-authored-by: Danny Kopping <dannykopping@gmail.com>",90,53,1,1,"2018-04-16 10:25:39","1622.19"
"grafana/loki","c1be35eb31e17d55545a272eb84f2c4d4dfdb159","RichiH","2022-06-06 14:52:21","true","Add licensing boiler plate in case we ever need it (#5251)

* Add licensing boiler plate in case we ever need it

Signed-off-by: Richard Hartmann <richih@richih.org>

* Update LICENSING.md

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>",73,50,0,0,"2018-04-16 10:25:39","1511.19"
"grafana/loki","6c05970ba1017c83dca5efbd87dc158577bcbd54","cyriltovena","2021-07-23 12:21:54","true","Improve the sweep lag panel in the retention dashboard. (#4030)

This uses now a graph panel which shows us lags over time.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",97,39,0,1,"2018-04-16 10:25:39","1192.83"
"grafana/loki","61ba02e2c477896075f61d795e3a4fb90e87201a","cyriltovena","2020-11-18 10:18:36","true","Limit series for metric queries. (#2903)

* Work in progress limit series.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* First draft of the series limiter.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add limiter to query-frontend.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add documentation.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fix build

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* fmted

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* lint and build fix

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Update docs/sources/configuration/_index.md

Co-authored-by: achatterjee-grafana <70489351+achatterjee-grafana@users.noreply.github.com>

* Review feedback.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Reduce // for to fix flaky test.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

Co-authored-by: achatterjee-grafana <70489351+achatterjee-grafana@users.noreply.github.com>",123,31,0,1,"2018-04-16 10:25:39","942.5"
"grafana/loki","078a040794a0345144920b5ffa57d9c28a2fe5af","MasslessParticle","2023-01-25 23:47:18","true","Retry getting logs from pubsub forever (#8283)",80,57,1,1,"2018-04-16 10:25:39","1740.56"
"grafana/loki","0d1144cf8f24e4bea1d18fb82824485280d621fa","kavirajk","2023-01-12 22:13:28","true","chore(go.mod): Remove unnecessary grpc contraints from `weaveworks/common` (#8125)

Not needed after https://github.com/weaveworks/common/pull/254 and
https://github.com/weaveworks/common/pull/262

More rationale on the issue.

Fixes #8085 

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",98,57,1,1,"2018-04-16 10:25:39","1727.49"
"grafana/loki","4089b73bc3c766a272356c03ff4501a993ef6661","liguozhong","2022-09-26 07:37:37","true","[Optimization] logql client: When logql fails to execute, return the failure information to the caller (#6671)

…ail msg to the client caller.

When logql fails to execute, return the failure information to the caller.
Solve the problem that grafana's loki alarm cannot see the cause of failure.

Co-authored-by: Christian Haudum <christian.haudum@gmail.com>",88,53,1,1,"2018-04-16 10:25:39","1620.88"
"grafana/loki","f560dcc5b12b48a4182efd8577f5e1b250dd3eac","dannykopping","2022-07-14 09:40:13","true","Set log level for GetChunkRefs log (#6677)

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",71,51,0,1,"2018-04-16 10:25:39","1548.97"
"grafana/loki","40a637e89720dbd80cf29d488413d96e96f97111","owen-d","2021-01-15 20:21:52","true","remaining sts use parallel mgmt policy (#3181)",119,33,0,1,"2018-04-16 10:25:39","999.91"
"grafana/loki","24d99566538d7c982c08eea02c29f164ed4c2faf","cyriltovena","2020-02-13 13:46:04","true","This improves the log ouput for statistics in the logcli. (#1644)

* This improves the log ouput for statistics in the logcli.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Please the linter

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",114,22,0,1,"2018-04-16 10:25:39","662.39"
"grafana/loki","27a027824fd8cc3f193168a5baaa2dec85b3a9e6","sandeepsukhani","2022-04-08 12:45:21","true","incorporate feedback on merged pr #5830 (#5831)",322,48,0,1,"2018-04-16 10:25:39","1447.85"
"grafana/loki","1f1706f467636e184abc404ab0651ee0f36154c0","sandeepsukhani","2019-04-12 10:08:55","false","Move live log tailing behind websocket on server (#439)

* Move live log tailing behind websocket on server

Live log tailing now requires client to just open a websocket and keep listening to it for getting live logs for matching query

* Fixed linting errors

* Unexported tailQuery querier method

* Added a delay in querying of logs to not miss delayed entries

* Renamed variable for better readability

* Some code refactoring suggested in PR review

* Fixed linter errors

* Code refactoring requested in PR review

* Disabling linting for writeHTTPErrorResponse since same value for an input is being passed from all function calls for now

* Removed a function which already existed

* Improved printing of log entries using cli and some other code refactoring

* Checking no-labels flag before printing log stream while tailing",101,12,0,1,"2018-04-16 10:25:39","355.99"
"grafana/loki","9b0740c0ed9338be9a9127a3e15d758a949a4e17","sandeepsukhani","2020-08-24 11:51:45","true","upload boltdb files from shipper only when they are not expected to be modified or during shutdown (#2487)

* upload boltdb files from shipper only when they are not expected to be modified or during shutdown

* updated comment

* add one more test condition to make sure files are not re-uploaded

Co-authored-by: Edward Welch <edward.welch@grafana.com>",122,28,0,1,"2018-04-16 10:25:39","858.56"
"grafana/loki","c657857e956d78f9f42a74464c21c94a2aad5cdb","rfratto","2022-10-06 07:26:03","true","Update Thanos dependency to latest version (#7348)",92,54,1,1,"2018-04-16 10:25:39","1630.88"
"grafana/loki","d1be9d54edaf7873b749bf169d572a5d44b808f9","DylanGuedes","2023-07-21 17:10:58","true","Change ""tenant"" to ""org_id"" (#10017)

**What this PR does / why we need it**:
Change our writefailures module to use ""org_id"" instead of ""tenant"" to be more consistent with the rest of our system.",55,63,1,1,"2018-04-16 10:25:39","1921.53"
"grafana/loki","c31c85bdcd3ee0004aa4ef9f14b1b0f030ea3ea2","kavirajk","2023-01-06 15:23:46","true","chore(ci): Remove CircleCI (#8061)",97,57,1,1,"2018-04-16 10:25:39","1721.21"
"grafana/loki","1a7614ff701949403f392af5757cd376dd140b03","cyriltovena","2022-01-19 11:21:25","true","Avoid splitting large range vector aggregation. (#5172)

* Reduce split by for large range vector

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Update pkg/querier/queryrange/split_by_interval.go

Co-authored-by: Christian Haudum <christian.haudum@gmail.com>

* improve fn name.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

Co-authored-by: Christian Haudum <christian.haudum@gmail.com>",267,45,0,1,"2018-04-16 10:25:39","1368.79"
"grafana/loki","bce4470a5bbde0c664df96ec814207fbe7a339e3","cyriltovena","2020-05-11 15:27:35","true","Recover from panic in http and grpc handlers. (#2059)

* Recover from panic in http and grpc handlers.

I don't see any good reason to crash any component during a bad request.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add alerts to the mixin for panics.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* 😡 gomod

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",117,25,0,1,"2018-04-16 10:25:39","755.71"
"grafana/loki","f984e71192d41723c16f01c83f04d191b0bb2a8c","adityacs","2020-05-22 18:01:44","true","Fix Promtail journal seeking known position (#2111)",121,25,0,1,"2018-04-16 10:25:39","766.82"
"grafana/loki","306cc724380c1fca80948b4e29221a17bd9846b3","owen-d","2021-03-10 12:58:13","true","Revendor/cortex (#3446)

* Upgrade Cortex in Loki

Signed-off-by: Marco Pracucci <marco@pracucci.com>

* proto compat

* gofmt

* changelog for deprecated querier.split-queries-by-day

Co-authored-by: Marco Pracucci <marco@pracucci.com>",152,35,0,1,"2018-04-16 10:25:39","1054.61"
"grafana/loki","c3e74b3ecaac7e2910aa1676903a139a277de87e","cyriltovena","2019-07-18 18:47:25","true","fix path escape (#779)",102,15,0,1,"2018-04-16 10:25:39","457.6"
"grafana/loki","0913ea5bf3899018c2234d906ff69085acfbc760","kavirajk","2022-01-24 13:40:12","true","Update Loki Team members in the Governance doc. (#5219)

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",273,45,0,1,"2018-04-16 10:25:39","1373.89"
"grafana/loki","ab2b9c031e0aa5c6852ece6e38db5f496e2309ec","wardbekker","2020-03-26 17:28:11","true","bump gem version (#1853)

(cherry picked from commit 386e498092f15ed0292720719600aed501979780)
Signed-off-by: Edward Welch <edward.welch@grafana.com>",120,23,0,0,"2018-04-16 10:25:39","705.54"
"grafana/loki","b353251e4759df8fc7484336042af7e3eaf2f642","chaudum","2023-09-22 16:20:43","true","Docs: Revise components page (#10666)

**What this PR does / why we need it**:

The page was lacking information about components and also did not
contain components that were added already a long time ago.

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

---------

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",35,65,1,1,"2018-04-16 10:25:39","1982.5"
"grafana/loki","07b583bb8316aebabcb3a14018c313f702543164","DylanGuedes","2022-01-03 15:13:29","true","Copy `cortex/pkg/scheduler` package dependency into Loki (#4962)

* Fork pkg/scheduler from cortex to Loki.

* Replace cortex/pkg/scheduler with loki/pkg/scheduler.

* Remove unused cortex subpackages from modules.txt.

* Run `make format` to fix new loki/pkg/scheduler imports.

* Update new scheduler .proto generated files.",254,44,0,1,"2018-04-16 10:25:39","1352.95"
"grafana/loki","c1052d704cf80d1624bb159dec1f35b423ca69aa","alainpham","2023-05-04 15:26:31","true","Update retention doc tsdb support of compactor (#9397)

compactor now also supports tsdb in addition to boltdb-schipper

**What this PR does / why we need it**:

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",80,61,1,0,"2018-04-16 10:25:39","1844.46"
"grafana/loki","f6acb87d1f3f4b9a1cc6d43c20d1b054ecfe8e62","tomwilkie","2019-02-04 11:08:26","false","Correctly propagate errors in the distributor; should now return 4xx on OOO entries.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",80,9,0,0,"2018-04-16 10:25:39","288.03"
"grafana/loki","5207751cbdadd821aaf9999ee052ce25cc19d305","tomwilkie","2019-02-25 16:28:46","false","Add -metrics to port name for loki so our Prometheus will scrape it.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",82,10,0,0,"2018-04-16 10:25:39","309.25"
"grafana/loki","bd30921981d9700dfbd0810f1295e50b7c833fb6","aknuds1","2021-07-22 12:29:31","true","loki-build-image: Upgrade golangci-lint and Go (#4028)

* loki-build-image: Upgrade golangci-lint

Signed-off-by: Arve Knudsen <arve.knudsen@gmail.com>

* loki-build-image: Upgrade Go

Signed-off-by: Arve Knudsen <arve.knudsen@gmail.com>",96,39,0,0,"2018-04-16 10:25:39","1191.84"
"grafana/loki","f53498c4aa5714feae9935cd3ac99d735a0cb0ab","owen-d","2023-08-21 21:52:32","true","allows filter-only matchers in series endpoint (#10269)

We already allow empty matchers `{}` as a special case in series queries
to return all series. This PR also allows specifying only filter-style
matchers. This is specifically helpful when a tenant is trying to
understand all streams which do _not_ have a corresponding label.
```
$ logcli series '{does_not_exist=""""}' --analyze-labels --org-id=""fake""
2023/08/16 10:13:32 http://localhost:3100/loki/api/v1/series?end=1692206012889997000&match=%7Bdoes_not_exist%3D%22%22%7D&start=1692202412889997000
Total Streams:  6
Unique Labels:  2
```

Co-authored-by: Michel Hollands <42814411+MichelHollands@users.noreply.github.com>",50,64,1,1,"2018-04-16 10:25:39","1951.73"
"grafana/loki","92c05493e1ceeebdddef4b4452266de846e39914","DylanGuedes","2022-01-03 15:03:28","true","Copy `cortex/pkg/distributor` package dependency into Loki (#4983)

* Fork cortex `pkg/distributor/distributor_ring.go`

Copy content from `pkg/distributor/distributor_ring.go` into Loki's
`pkg/distributor/distributor_ring.go`.

* Fork cortex `pkg/distributor/ingester_client_pool.go`.

Copy Cortex `pkg/distributor/ingester_client_pool.go` into Loki's
`pkg/distributor/clientpool/ingester_client_pool.go`.
We couldn't copy it directly to
`pkg/distributor/ingester_client_pool.go` because we distributor imports
a package that imports the ingester_client_pool, which leads to import
cycle.

* Stop using Cortex `pkg/distributor`.

Instead, use Loki's `pkg/distributor` and `pkg/distributor/clientpool`.

* Remove unused Cortex distributor pkg.

* Use random ports for Loki test.",254,44,0,1,"2018-04-16 10:25:39","1352.94"
"grafana/loki","f24da4a1948d5d53991236630017c14a52dc0308","jeschkies","2023-01-18 09:13:54","true","Display replicas, cores and nodes in sizing tool. (#8088)

**What this PR does / why we need it**:
No every users wants to deploy Loki with Helm. That's why we are going
to display the required replicas as well.


![image](https://user-images.githubusercontent.com/2418440/212642958-17bc3fcd-0f6a-4ea8-8366-a3c28ddc6622.png)

This change also fixes two bugs in the algorithm and introduces some
tests for its invariant.

**Checklist**
- [ ] Reviewed the `CONTRIBUTING.md` guide
- [x] Documentation added
- [x] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

Signed-off-by: dependabot[bot] <support@github.com>
Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>
Signed-off-by: Danny Kopping <danny.kopping@grafana.com>
Signed-off-by: Ashwanth Goli <iamashwanth@gmail.com>
Co-authored-by: Dimitar Dimitrov <dimitar.dimitrov@grafana.com>
Co-authored-by: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
Co-authored-by: Danny Kopping <danny.kopping@grafana.com>
Co-authored-by: Kaviraj Kanagaraj <kavirajkanagaraj@gmail.com>
Co-authored-by: liam-howe-maersk <118169897+liam-howe-maersk@users.noreply.github.com>
Co-authored-by: JordanRushing <rushing.jordan@gmail.com>
Co-authored-by: Trevor Whitney <trevorjwhitney@gmail.com>
Co-authored-by: Periklis Tsirakidis <periklis@redhat.com>
Co-authored-by: Ashwanth Goli <iamashwanth@gmail.com>",94,57,1,1,"2018-04-16 10:25:39","1732.95"
"grafana/loki","67f104a78341cf86f1ab62aaaaa0fb2385da8465","ludydoo","2022-05-25 07:03:40","true","Add NRC in Adopters (#6242)",72,49,0,0,"2018-04-16 10:25:39","1499.86"
"grafana/loki","d9cc6a87c225f3378b492a82cbff5f87b4b8fcca","cyriltovena","2022-06-03 10:27:13","true","Improve write dashboard by removing unrelated route (#5853)

* Improve write dashboard by removing unrelated route

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Update production/loki-mixin/dashboards/loki-writes.libsonnet

Co-authored-by: Sandeep Sukhani <sandeep.d.sukhani@gmail.com>

Co-authored-by: Sandeep Sukhani <sandeep.d.sukhani@gmail.com>",72,50,0,1,"2018-04-16 10:25:39","1508"
"grafana/loki","22dcfcde33874bfc332af975791457c9375ca55d","cyriltovena","2021-07-01 10:53:47","true","Add retention label to loki_distributor_bytes_received_total metrics (#3840)

* Add retention label on the loki_distributor_bytes_received_total metrics.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Update docs.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Update docs/sources/operations/observability.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* Move ParseRequest to an apache2 package.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add retention label on the loki_distributor_bytes_received_total metrics.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* fixes bad merge.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes bad merge.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>",116,38,0,1,"2018-04-16 10:25:39","1170.77"
"grafana/loki","f3a49f4734659a8dfb7630783ba580cf37ae7ca1","alfredo-d","2023-03-31 16:23:27","true","Update contains and hasPrefix/hasSuffix with the correct examples (#8929)

**What this PR does / why we need it**:
WHAT:
- Update examples for `contains` and `hasSuffix`
- Correct order should be `functionName arg1 arg2 argN`, eg. `contains s
src`

WHY:
- Current example for `contains` and `hasPrefix` / `hasSuffix` has a
wrong order that will cause `TemplateFormatErr`.
- Examples I'm referring to `{{ if .err hasSuffix ""Timeout"" }} timeout
{{end}}`

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",81,59,1,0,"2018-04-16 10:25:39","1806.25"
"grafana/loki","dab393a62ddc6e0b5eee4cc8e47577a0e5083948","sandeepsukhani","2020-08-25 16:02:31","true","fix a flaky test in boltdb shipper (#2550)",125,28,0,1,"2018-04-16 10:25:39","859.73"
"grafana/loki","57c0c2cde2b5d01f82b75bc56f0b74f5ae8b29d0","vlad-diachenko","2022-10-12 12:49:15","true","[docs: logql-analyzer] changed url for main branch (#7378)

pointed unreleased docs(`next`) to logql-analyzer that is built from
main branch",91,54,1,0,"2018-04-16 10:25:39","1637.1"
"grafana/loki","5ec9dfc5d1cab257dd6ad41d22e298cc46671666","tomwilkie","2018-06-27 05:00:32","false","Fix logic.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",1,2,0,0,"2018-04-16 10:25:39","70.77"
"grafana/loki","06f41e793b855dd8d65afae84604f73559f8f312","tomwilkie","2019-05-08 09:05:43","false","Explictly listen on localhost in tests, to stop warning on MacOS.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",99,13,0,0,"2018-04-16 10:25:39","387.19"
"grafana/loki","7713ff78e2627b835d1ad73afb3695d25943ebf1","kavirajk","2022-01-25 13:00:23","true","Fix `cortexpb` -> `logproto` rename in some tests (#5231)

* Fix `cortexpg` -> `logproto` rename in some tests

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Fix TimestampMs rename

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* queryrange test

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Fix tests on queryrangebase pacakage\

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Fix some typos

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",271,45,0,1,"2018-04-16 10:25:39","1374.86"
"grafana/loki","f5fbfabd8445b5f027d0da896bfa44c66829d705","trevorwhitney","2022-12-12 21:01:22","true","Add 3rd target (`backend`) to SSD/Scalable mode (#7650)

**What this PR does / why we need it**:

This adds a 3rd target to SSD/Scalable mode, as well as a config flag to
run the legacy `read` mode from the original 2 target configuration in
order to give people time to migrate before we remove this option in
Loki 3.0 (hopefully).

The 3rd target has the two major advantages:
1. Allows the read path to be run as a deployment and thus auto-scaled
using our existing auto-scaling logic for queriers
2. Creates consistency with Mimir since they went with a 3 target model
for their SSD deployment.",99,56,1,1,"2018-04-16 10:25:39","1697.44"
"grafana/loki","0e28452f1f1a9173167640d66abc992c31f23f7b","thepalbi","2022-07-15 06:17:58","true","Targets: Add Heroku HTTPS drain target (#6448)",71,51,0,0,"2018-04-16 10:25:39","1549.83"
"grafana/loki","a290549a59fed24a4374e922dafee6c784cdedcc","liguozhong","2022-09-14 10:36:57","true","Promtail: Add support for max stream limit (#7101)

**What this PR does / why we need it**:
Add Promtail support to a new feature/configuration named `max_stream_limit`
  * This new feature limits the max number of streams Promtail can materialize. The new feature is also useful to avoid OOMing Promtail

**Which issue(s) this PR fixes**:
Fixes #6968",88,53,1,1,"2018-04-16 10:25:39","1609.01"
"grafana/loki","682e9c881db31b6492926b3d9706fdd770eef0a8","MichelHollands","2022-09-30 14:54:20","true","Add list of delete requests to deletion dashboard (#7309)

Add 2 panels to the deletion dashboard that show:
- the in progress/finished delete requests during the selected period
- the delete request that have been entered, with the query

This will help with trouble-shooting deletions.

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",91,53,1,1,"2018-04-16 10:25:39","1625.19"
"grafana/loki","0323e02187e4544f5bc8c0902bf7c2bfcd718f3f","sh0rez","2020-01-16 22:04:15","true","fix(docs): tk init instructions (#1538)",104,21,0,0,"2018-04-16 10:25:39","635.74"
"grafana/loki","420a359ff79ced72fb39f82c31249fb8b1b2abc1","sh0rez","2019-07-05 13:46:37","false","fix(loki|promtail): logger re-init nil config panic (#697)

When a more or less invalid config (e.g. `null`) is supplied, the log level prop
of the config receives an invalid value which causes the logger to panic on
re-init.

Prevents this by checking for a nil log-level and notifies the user in case",98,15,0,0,"2018-04-16 10:25:39","444.39"
"grafana/loki","c69605f2afa075c3aa3095f63abf3823f73a8e38","DylanGuedes","2022-06-23 16:08:14","true","Loki: Fix flaky IndexGatewayClient test (#6481)

* Stop gRPC clients in tests.",69,50,0,1,"2018-04-16 10:25:39","1528.24"
"grafana/loki","15f8f42295c48968fbb5209b46360b79b4108020","DylanGuedes","2022-08-24 21:02:38","true","Adapt queryTimeout to be a per-tenant configuration (#6835)

What this PR does / why we need it:

* Add a new per-tenant query timeout
* Adds new middleware to query calls. This new middleware will timeout requests based on the new per-tenant query timeout
* Add span logs to query calls missing it
* Deprecate `engine.timeout` configuration

The motivation to change this configuration to be per-tenant instead of global is that it makes sense to alleviate the timeout for particular tenants or make it more strict for others. Especially useful for scenarios where the Loki client doesn't handle context cancellations correctly; in such scenarios, since Loki would still process expensive queries that were canceled, this allows one to have small timeouts for most tenants, which will help mitigate unnecessary work without having a timeout that is too short for important tenants.",81,52,0,1,"2018-04-16 10:25:39","1589.44"
"grafana/loki","28e192f22e1b76b10fe5b6fda431969f916c0ad7","DylanGuedes","2022-10-20 19:09:22","true","Loki: Implement random entries assignment when sharding (#7427)

**What this PR does / why we need it**:
Modify sharding to assign random shards when the number of shards is
bigger than the number of entries.
This helps us to avoid hot-spotting the first shards. 
By randomizing the entries assignment we help spread the load between
all shards.",93,54,1,1,"2018-04-16 10:25:39","1645.36"
"grafana/loki","1b5b8a31096784ac94981a0122b81e21ef6c5f78","owen-d","2022-01-19 16:23:31","true","log headblock conversion error during replay cleanup (#5185)",266,45,0,1,"2018-04-16 10:25:39","1369"
"grafana/loki","b848ac510ba72e56e215a4e1df362162343ca3e2","owen-d","2021-02-05 18:10:59","true","adds stateful ruler clause for boltdb shipper jsonnet (#3297)",126,34,0,1,"2018-04-16 10:25:39","1019.82"
"grafana/loki","eb949e29077d3d517b341e31b2f5e9e0674b6214","shwetaap","2022-09-26 20:23:58","true","Operator: Config and bundle manifest changes for Lokistack API ObjectstorageTLS CA certificate key addition (#7256)",87,53,1,0,"2018-04-16 10:25:39","1621.42"
"grafana/loki","634baa8aa87b88ca649c3897d029c4557fd2ff97","DylanGuedes","2022-01-12 16:49:41","true","Copy `cortex/pkg/querier/stats` package dependency into Loki (#5047)",262,45,0,1,"2018-04-16 10:25:39","1362.02"
"grafana/loki","d5b68c025762723134dc8379c25cfeb6e6084029","kavirajk","2022-12-23 05:56:12","true","fix(promtail): Fix cri tags extra new lines. (#7997)",97,56,1,1,"2018-04-16 10:25:39","1707.81"
"grafana/loki","36e0979cf52c2943045c1f3c2c5dad31d5fe2f4a","dannykopping","2022-06-07 13:59:48","true","Add cache usage statistics (#6317)

* Adding cache statistics

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Adding metrics to metrics.go

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Creating new stats context for use in metric queries middleware

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Clean up unnecessary log fields

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Fixing tests

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Adding stats tests

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* CHANGELOG entry

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Appeasing the linter

Documenting function

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Moving CHANGELOG entry to appropriate section

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Implementing a stats collector cache wrapper to simplify stats collection

If we keep the stats collection in pkg/storage/chunk/cache/instrumented.go, then any implementation that wraps it will cause the stats collected to be incomplete. For example: NewBackground(cacheName, cfg.Background, Instrument(cacheName, cache, reg), reg)) - the background cache requests are not collected

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Fixing tests

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",73,50,0,1,"2018-04-16 10:25:39","1512.15"
"grafana/loki","cbd3b007cc1e537ce01a08f75c704ac1b950f525","tpaschalis","2022-02-24 09:32:05","true","logproto: Add deprecated annotation to LegacySample and LegacyLabelPair (#5454)

* Add deprecated annotation to LegacySample and LegacyLabelPair

Signed-off-by: Paschalis Tsilias <paschalis.tsilias@grafana.com>

* Replace annotation with more generic docstring

Signed-off-by: Paschalis Tsilias <paschalis.tsilias@grafana.com>",300,46,0,0,"2018-04-16 10:25:39","1403.71"
"grafana/loki","c4234e0bbace448cbaf0f5892fc7bdb50b4c8a11","eraac","2019-11-26 19:41:41","false","adding iam access for autoscaling configuration (#1262)",82,19,0,0,"2018-04-16 10:25:39","585.64"
"grafana/loki","c5daa31b65fded89c32996087816e5f84c9c0fc3","dannykopping","2022-08-01 08:48:30","true","Remove reference to non-existent config field (#6781)

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",76,51,0,1,"2018-04-16 10:25:39","1565.93"
"grafana/loki","09712dfa673133f8246070d0bc439b81fb86889d","periklis","2022-06-10 12:19:56","true","operator: Allow optional installation of webhooks (#6363)",71,50,0,1,"2018-04-16 10:25:39","1515.08"
"grafana/loki","4b1269afabdc2e45a80bc280535d5af900dcda8c","DylanGuedes","2022-01-14 11:20:14","true","Remove unused `storegateway` base (#5141)",264,45,0,1,"2018-04-16 10:25:39","1363.79"
"grafana/loki","be4cebc516a7f9039b9e81676377ce7a69cbeb21","KMiller-Grafana","2021-09-16 06:10:48","true","Docs: improve spelling, grammar, and formatting. (#4320)

- section titled ""Get logs into Loki""",138,41,0,0,"2018-04-16 10:25:39","1245.57"
"grafana/loki","5be93e0480d31fc7f26ce6750358752aa2878bb3","cyriltovena","2021-07-06 09:10:21","true","Improve marker file current time metrics. (#3946)

Currently we'll keep the last recorded time, but if the marker file doesn't exist anymore we should reset it.
This would allow us to build consistent alert based on marker files that are too far behind.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",119,39,0,1,"2018-04-16 10:25:39","1175.7"
"grafana/loki","cba42426b9c0692c882b4f93022684007fc9a5b7","daixiang0","2019-03-29 02:51:12","false","Add help about how to get metrics

Signed-off-by: Xiang Dai <764524258@qq.com>",93,11,0,0,"2018-04-16 10:25:39","342.68"
"grafana/loki","351b4c69ac215f305054a6c9abd39a9f4e0b287b","daixiang0","2019-02-20 10:55:53","false","delete all duplicate empty blanks (#344)

Signed-off-by: Xiang Dai <764524258@qq.com>",78,10,0,0,"2018-04-16 10:25:39","304.02"
"grafana/loki","31789eafc4269083bf480d4d0872a24fb18550f1","simonswine","2018-12-18 21:57:47","false","Refactor structure of promtail

This allows easier integration of other targets than files for promtail.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",37,8,0,0,"2018-04-16 10:25:39","242.48"
"grafana/loki","d47a189efb496ead4cbf773d251a3190f1e8a061","ashwanthgoli","2023-10-16 13:28:10","true","[release-2.9.x] add release notes for 2.9.2 (#10911)

**What this PR does / why we need it**:

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",24,66,1,0,"2018-04-16 10:25:39","2006.38"
"grafana/loki","ba0df61531449c7eabc3fc588246d37d363aa86e","cyriltovena","2021-01-21 12:24:35","true","Fixes panic when using multiple client with the same prometheus registry. (#3207)

Introduce by #3175.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",115,33,0,1,"2018-04-16 10:25:39","1005.58"
"grafana/loki","4da4d74311f19636b095d193804eaa9efd708a19","cyriltovena","2020-02-28 14:19:02","false","Query range should not support date where start == end.

Since we are always checking against start inclusively and not end, this means this type of query
will always returns no result.

Fixes #1702, the frontend was not handling this type of query correctly.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",119,22,0,1,"2018-04-16 10:25:39","677.41"
"grafana/loki","ece671c146553b89b23977c06aeb4589ebf25061","salvacorts","2021-11-26 10:13:18","true","Enhance logging on timeout tailing logs on canary (#4825)

* Enhance logging on timeout tailing logs

* Apply CR changes",217,43,0,1,"2018-04-16 10:25:39","1315.74"
"grafana/loki","7ec072dbacb208d9e6fc96d1658a7df39088922a","periklis","2022-11-04 17:38:45","true","operator: Add TLS support for compactor client (#7448)",89,55,1,1,"2018-04-16 10:25:39","1659.3"
"grafana/loki","b236f2ee273f4c6b0f8af140e166be05f6dd117e","owen-d","2020-12-01 13:37:06","true","adds the ability to read chunkFormatV3 while writing v2 (#2984)

(cherry picked from commit a8af1c0c84a18192d0c3fb04dc1634cedc8fd078)",120,31,0,1,"2018-04-16 10:25:39","955.63"
"grafana/loki","137a28d82b78ac0e1abc156d18e57b7efc08bb6e","owen-d","2022-02-17 15:14:07","true","Adds bytes and entries to chunk metadata in tsdb (#5414)

* adds bytes and entries to chunk metadata in tsdb

* removes comment",294,46,0,1,"2018-04-16 10:25:39","1396.95"
"grafana/loki","ddbf04f64c23f5b7de312f346bf93f8237004587","bt909","2021-06-09 06:56:13","true","Change redis configuration value for enabling TLS to correct syntax (#3798)

enable_tls: true doesn't work and this syntax is taken from cortex documentation, works, and is tested with AWS ElastiCache Redis cluster",203,38,0,0,"2018-04-16 10:25:39","1148.6"
"grafana/loki","f4b6c392b358f52edd9037f8640ebc9a3a0a213a","AllexVeldman","2023-01-12 23:26:22","true","helm: Add `appProtocol: tcp` to headless grpc ports (#7990)

**What this PR does / why we need it**:
This sets the `appProtocol` of the headless services of the `loki` helm
chart to `tcp`.

This is needed when deploying the helm chart in combination with Istio
due to it's protocol selection breaking the routing between replicas of
the satefulsets.",97,57,1,0,"2018-04-16 10:25:39","1727.54"
"grafana/loki","c6f7a4122574752a95423075f9fdd5922db60ff9","trevorwhitney","2022-08-23 09:18:42","true","Bring helm chart back into Loki repo (#6829)

**What this PR does / why we need it**:

This is the first step of the process to bring the helm chart back into the Loki repo. We currently have ~7 public helm charts. This creates a lot of confusion for the community on which ones to start with, and is also a lot of additional surface area that is hard for Loki contributors to keep track of. By bringing the helm chart that we use ourselves back into the Loki repo, it will be a more clear starting point for helm users. It will also increase visibility for Loki contributors into helm PRs and issues. This will _not_ affect where the helm chart is published. It will still be published to the `grafana/helm-charts` following the same pattern as the Mimir helm chart.

The helm chart that we are currently using and most actively supporting is the `loki-simple-scalable` chart. Part of this effort is to rename that chart to just `loki`, which means it needs to be expanded to support the single binary deployment topology currently deployed by the existing `loki` helm chart. This PR is the first attempt to merge those two charts.

This chart currently works for a basic install of each deployment topology. There is more work to be done before we publish it. This work will include:

  * Making sure there is a migration path from the existing `loki` chart to this new one
  * Making sure there is a migration path from the existing `loki-simple-scalable` chart to this new one
  * Making sure the single binary deployment works in both `filesystem` and minio-backed multi-replica mode
  * Migrating CI from `grafana/helm-charts` for testing helm chart changes
  * Integrating with the github action in the `grafana/helm-charts` repo (this will publish it, so we will tackle this last)

A question I have for reviewers is what we should name each deployment mode (single binary vs. simple scalable)? We have received feedback from the community that some did not think ""simple scalable"" was suitable for production loads since it had ""simple"" in the name. This might be an opportunity to adjust that perception. Some options I've thought of include:

  * `single-binary` and `simple-scalable` (currently how it's coded)
  * `basic` and `scalable` (leaving open the option for `advanced` if we ever choose to support micro-services topology in this chart as well)
  * `ha`, `redundant` or similar vs. not

Fixes #6873",83,52,0,1,"2018-04-16 10:25:39","1587.95"
"grafana/loki","6d09865911d6cfbb1840ff3a6c33e52bed3d97d1","rfratto","2019-11-20 14:10:00","true","docs: update limits_config to new structure from #948 (#1278)

Co-Authored-By: Sandeep Sukhani <sandeep.d.sukhani@gmail.com>",74,19,0,1,"2018-04-16 10:25:39","579.41"
"grafana/loki","de5d2628f6c77f322f8232c7820707ec5d86176f","owen-d","2021-08-17 20:41:56","true","corrects query scheduler image (#4180)",130,40,0,1,"2018-04-16 10:25:39","1217.18"
"grafana/loki","28e9e15639347b4b44189f95d7ebd74d8885b715","vlad-diachenko","2023-07-19 13:20:00","true","[jsonnet] removed deprecated policy.v1beta1 (#9978)

**What this PR does / why we need it**:
in k8s version 1.25 some k8s APIs are deprecated, such as policy.v1beta1
which is moved to policy.v1

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

---------

Signed-off-by: Vladyslav Diachenko <vlad.diachenko@grafana.com>",58,63,1,0,"2018-04-16 10:25:39","1919.37"
"grafana/loki","0734c9f0a67e1b6ae100a516fb55a0ce683d15b5","cyriltovena","2019-05-15 14:24:07","true","adds external labels to be passed via flags (#510)",101,13,0,1,"2018-04-16 10:25:39","394.42"
"grafana/loki","c8c8303a6a6767b8e6e196e9e160dbb2c6887273","sandeepsukhani","2022-09-14 14:09:05","true","refactor index storage code to index reader/writer interfaces for better monitoring (#7154)

**What this PR does / why we need it**:
Currently, it is hard to monitor just the index latencies since the
chunks PUT code is coupled with both object storage and index writer.
This PR refactors the code to have separate interfaces defined for index
readers/writers.

I have also added a wrapper called `monitoredReaderWriter`, which
measures the latency on the index operations.

**Special notes for your reviewer**:
Cortex had added `PutChunksAndIndex` for DynamoDB, which would write
both chunks and index in a single request when configured for storing
both. I have removed the use of it since it would be too complex to
support it with this refactoring.
Loki, anyways does not recommend using chunks in the index store, and
using a hosted object storage would be much cheaper. Also, this is not a
breaking change, it might somewhat impact the performance of flushing
the chunks.

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>",88,53,1,1,"2018-04-16 10:25:39","1609.16"
"grafana/loki","dad7fca2fd6a4e726907212c2090127447f8a9e0","sandeepsukhani","2022-01-19 12:34:19","true","align metric queries by step and other queries by split interval (#5181)",266,45,0,1,"2018-04-16 10:25:39","1368.84"
"grafana/loki","9a2a038f431a69163e11e4754264ede7e77bab3e","cstyan","2023-03-03 15:04:01","true","Allow passing of context to query related limits functions (#8689)

In this PR we're allowing for passing of a `context.Context` via the
Limits interfaces (some of which are new, to clean up
hardcoding/embedding of `validation.Overrides`) This is based on
work/ideas by @jeschkies .

Fixes #8694

---------

Signed-off-by: Callum Styan <callumstyan@gmail.com>
Co-authored-by: Karsten Jeschkies <karsten.jeschkies@grafana.com>",74,58,1,1,"2018-04-16 10:25:39","1778.19"
"grafana/loki","894357bc2a209aceaf562e4544c20fc82ac24d8e","davkal","2019-04-09 07:14:46","true","Merge pull request #461 from garo/feature/improve-documentation

Improve documentation based on what I learned when I did loki setup.",99,12,0,0,"2018-04-16 10:25:39","352.87"
"grafana/loki","67c0b3ed2c1574db85673b796080aa87517b07d7","slim-bean","2023-04-10 14:27:01","true","Loki: log all trace ID's but include `sampled=true` when the trace is logged (#9039)

**What this PR does / why we need it**:

Currently when we log ""with context"" we will only add the traceID if the
particular trace is being sampled. This is nice because it makes it
obvious that if you go search for a trace you'll find it.

However, traceID is also useful for selecting all the log lines from a
single query within Loki itself and if the trace wasn't sampled we
remove this useful piece of context for querying the log lines.

In this PR, instead of dropping the traceID from the logs, we instead
prefix it with `NS-`

Where NS is short for Not Sampled

Example:
```
level=debug ts=2023-04-05T15:06:24.377067817Z caller=fetcher.go:292 org_id=145265 traceID=NS-13ed6c30228e221d chunks=1 decodeRequests=1 missing=0
```

Questions: 

* should we bikeshed a little on this prefix? (I wanted something
concise but if it's concise it's probably confusing to folks who've
never seen it before)
* Instead of a prefix, we could change the logfmt key?
`ID=13ed6c30228e221d` (this is less confusing in some ways but maybe
more difficult/confusing in others?)


**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

---------

Signed-off-by: Edward Welch <edward.welch@grafana.com>",84,60,1,1,"2018-04-16 10:25:39","1815.17"
"grafana/loki","5e134f3b6d33b2f9b485cde7a70f160704eae5ba","agologan","2022-09-21 16:06:35","true","Helm: add support for configuring ruler (#7196)

**What this PR does / why we need it**:

Enables configuring various `ruler` options like alertmanager url.
`rulerConfig` is added second in the template so users can override the
`storage` config if necessary.
Have seen questions in community Slack asking how to get filesystem
support and alertmanager back when migrating from the old loki helm
which should now be possible.",84,53,1,0,"2018-04-16 10:25:39","1616.24"
"grafana/loki","0cc3fe7e541a2753b5b5b7046a1d970b65ef15b3","kavirajk","2022-04-26 15:02:38","true","Disable calling new index-gateway client's API. (#6025)

* Disable calling new index-gateway client's API.

* Remove infinite recursive call

* Correct mock setup for test",172,48,0,1,"2018-04-16 10:25:39","1471.19"
"grafana/loki","20654acfb80d7bffc5ddd5e37bf4275642a5cc83","tomwilkie","2018-06-27 07:46:33","false","Typo, fixes #15.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",2,2,0,0,"2018-04-16 10:25:39","70.89"
"grafana/loki","af3457b92e49262233fe6c4a8d97fe84f10ae8d4","owen-d","2022-02-02 21:29:57","true","less opaque chunk keys on fs with v12 (#5291)

* less opaque chunk keys on fs with v12

* lint",278,45,0,1,"2018-04-16 10:25:39","1382.21"
"grafana/loki","1256692f950deccd3e8e1adf0acf8b1477f5994f","kevinburkesegment","2023-09-18 07:33:09","true","clients/pkg/promtail/targets/gcplog: fix spelling error (#10615)

**What this PR does / why we need it**: Fix spelling error

**Which issue(s) this PR fixes**: none

**Checklist**
- [X] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)

Not necessary:

- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",40,65,1,0,"2018-04-16 10:25:39","1978.13"
"grafana/loki","c6d95aa83f14d56bc4f3d849744bc25e973d42d7","xperimental","2022-04-13 19:21:23","true","operator: Do not include non-static labels in pod selectors (#5907)",321,48,0,1,"2018-04-16 10:25:39","1453.12"
"grafana/loki","f715e0f847a8f4256066d9fe2b9f49aab035d935","carlosedp","2020-10-28 08:12:21","true","Add support for building binaries for ppc64le arch (#2813)",123,30,0,0,"2018-04-16 10:25:39","922.41"
"grafana/loki","b6ac00e1a3372b1f491fdd3ab51c410ca656a5b0","cstyan","2022-05-24 21:12:17","true","[Promtail] drop lines with malformed json (#6099)

* Refactor json pipeline stage to have a Run function

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* Allow for dropping log lines in json pipeline stage if they are not
valid json strings

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* fix linting

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* Clean up new malformed json test.

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* Address some review feedback.

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* Refactor json pipeline stage test to use testify assert instead of
t.Errorf

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* Update changelog and docs with new drop malformed option

Signed-off-by: Callum Styan <callumstyan@gmail.com>

* Update CHANGELOG.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* Update docs based on Karen's comments.

Signed-off-by: Callum Styan <callumstyan@gmail.com>

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>",73,49,0,1,"2018-04-16 10:25:39","1499.45"
"grafana/loki","1b0b9da3963d804a3cc1b5da6a24a411b9a68a36","jeschkies","2023-10-23 03:11:02","true","Recover querier handler from panic. (#10983)",25,66,1,1,"2018-04-16 10:25:39","2012.95"
"grafana/loki","8e59fcac914f24262446dcbf5aaeeffe5ab29d87","JStickler","2023-07-13 16:32:57","true","Update redirects to use new alias format. (part 2 of 2) (#9890)

Breaking the alias updates into two PRs to make for smaller reviews.

**Special notes for your reviewer**:
@jdbaldry commented on #9717 that the alias format had changed, but we
[agreed](https://github.com/grafana/loki/pull/9717#issuecomment-1594960563)
that I could update it in a follow up PR. This is that follow up. Also
updating previously merged file moves that used the old alias format.

<strike>I could not get relative redirects to work for the LIDS or
Maintaining files, so had to use the older format, which did
work.</strike>
Updated weights for some pages.
Updated a couple of `menuTitles` that I missed updating on previous PRs.

---------

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>",57,63,1,0,"2018-04-16 10:25:39","1913.51"
"grafana/loki","855d2b74bc075341044130303d879a3a23fa2f64","mar4uk","2023-01-27 13:07:29","true","[chore] update pkg/push version (#8312)",83,57,1,0,"2018-04-16 10:25:39","1742.11"
"grafana/loki","7314d95a91d473bc285109b876515a08707e6b24","salvacorts","2022-07-05 06:58:02","true","Support dashboards for SSD mode (#6540)

* Support dashboards for SSD mode

* Fix issues

* Add compiled mixins

* Flip $.config.ssd on if conditions

* Use prefix matcher for ssd

* Add compiled SSD mixin

* Update loki-mixin-check to check ssd compiled mixin

* Checkout compiled ssd mixin",72,51,0,1,"2018-04-16 10:25:39","1539.86"
"grafana/loki","c8ab475e2a04f526d8fa0407d836ecda8c5de131","blockloop","2021-03-19 21:09:36","true","Merge pull request #1 from ViaQ/bjones/setup-ci

fix golangci-lint timeout flag",169,35,0,0,"2018-04-16 10:25:39","1063.95"
"grafana/loki","d301867259081b8c2e9d7a226df069890d7ba5f0","blockloop","2021-03-16 16:56:30","true","working with struct definitions",156,35,0,0,"2018-04-16 10:25:39","1060.77"
"grafana/loki","a6f68fff52209899447ec1998c3dd801278d4d8d","grafanabot","2023-08-28 21:53:13","true","[Release Notes Appender] Add PR #10047: add volume and volume_range docs (#10074)

Add PR #10047 to release notes for next release

---------

Co-authored-by: Trevor Whitney <trevorjwhitney@gmail.com>",49,64,1,0,"2018-04-16 10:25:39","1958.73"
"grafana/loki","51952dafc1dc9b27967619ef92a7f69848c6fe18","slim-bean","2021-01-28 15:50:33","true","Loki: Log a crude lag metric for how far behind a client is. (#3236)

* Log the difference in time between the most recently received log entry and the current time as a crude measure of how far behind a promtail instance is.

* fix lint",123,33,0,1,"2018-04-16 10:25:39","1012.73"
"grafana/loki","0950034890e803259b05226c5e6a922a027e8a4e","nvanheuverzwijn","2022-03-24 12:52:47","true","Update retention.md (#5706)

Retention policy actually accept suffix such as `d` and `w` but Go's time.ParseDuration does not.
See https://github.com/grafana/loki/blob/a2dd73158621441fe2d83346e792913c6770c945/pkg/storage/chunk/table_manager.go#L93",309,47,0,0,"2018-04-16 10:25:39","1433.85"
"grafana/loki","918ba4198240ca993e730baf47298d02d5624dc8","oke-py","2020-05-08 14:23:15","true","Docs: update Loki Helm Chart document to support Helm 3 (#2038)

* update Loki Helm Chart document to support Helm 3

* update Loki Helm Chart document to support Helm 2 & 3",115,25,0,0,"2018-04-16 10:25:39","752.67"
"grafana/loki","75fbe015ca80ade7c7a89a08df6ba52576fef1ad","gouthamve","2019-05-17 09:19:55","true","Get rid of the cortex fork with lazy loading upstreamed (#596)

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>",102,13,0,0,"2018-04-16 10:25:39","396.2"
"grafana/loki","cb5906936512cbeb3aa9da4cecce3f7dcf73d596","kavirajk","2021-02-22 16:15:01","true","Add some operation details to gcplog doc (#3351)

* Add some operation details to gcplog doc

* Update docs/sources/clients/promtail/gcplog-cloud.md

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>

* Update docs/sources/clients/promtail/gcplog-cloud.md

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>

* Update docs/sources/clients/promtail/gcplog-cloud.md

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>",132,34,0,1,"2018-04-16 10:25:39","1036.74"
"grafana/loki","b77bb567b2eca0a6ccc8a3f4f50f1c611f367248","kavirajk","2021-06-22 08:45:27","true","Add explict syntax for using `pattern` parser (#3871)

* Add explict syntax for using `pattern` parser

Motivation is from community discussion
https://community.grafana.com/t/how-to-use-loki-pattern-parser/49195

* Update docs/sources/logql/_index.md

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>",103,38,0,1,"2018-04-16 10:25:39","1161.68"
"grafana/loki","3f496e73365c955a233722a41fb8e375228ff5e6","DylanGuedes","2022-01-25 09:18:29","true","Copy `cortex/pkg/cortexpb` package dependency into Loki (#5151)

* Fork cortexpb into Cortex `pkg/logproto`.

* Use `pkg/logproto` instead of Cortex `pkg/cortexpb`.

* Rename `cortexpb` usage to `logproto`.

* Fix encoding/decoding test.

* Replace cortexpb usage in the ruler/base package.

* Remove exemplars from logproto.",275,45,0,1,"2018-04-16 10:25:39","1374.7"
"grafana/loki","5c99962161fe895a252c788a8aa715ea787b18c7","chaudum","2021-11-03 12:32:53","true","Disable chunk transfers in jsonnet lib (#4624)

Since the WAL is now enabled by default and incompatible with chunk
transfer, the latter needs to be disabled (setting to `0`).

The default of `max_transfer_retries` is `0` and therefore the setting
can be removed.

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",170,42,0,1,"2018-04-16 10:25:39","1292.84"
"grafana/loki","3f62b4ec36291ca26baaa786f927a4710def6257","tomwilkie","2018-11-19 18:21:11","false","s/logish/tempo/

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",5,7,0,0,"2018-04-16 10:25:39","213.33"
"grafana/loki","2b4edce1d20ec1d72c953eaea0c1446b64aeca19","fredr","2020-06-15 13:09:49","true","Correct loki address for docker-compose (#2215)",137,26,0,0,"2018-04-16 10:25:39","789.61"
"grafana/loki","b5d5123e0bd7c3bd62cfea2f245add4c5fcf9fc6","thejosephstevens","2021-12-29 17:45:27","true","Docs: Fix parent of wal and wal_cleaner in loki ruler config docs (#4993)

* fix parent of wal and wal_cleaner in loki ruler config docs

* update changelog",252,44,0,0,"2018-04-16 10:25:39","1349.06"
"grafana/loki","8b66e1c3fc4130485774d20f3a8afcb336e51144","thepalbi","2022-11-01 08:20:55","true","Add terraform snippets to Promtail GCP Logs documentation (#7526)

**What this PR does / why we need it**:
This PR is a follow up to the documentation added
(https://github.com/grafana/loki/pull/7511) for configuring the
infrastructure resources for shipping logs to the new-ish GCP Logs Push
Promtail target. Terraform snippets are added for writing the same
infrastructure in an as-code manner, which works better for infra folks.

**TODO**
- [ ] Add snippet on how to setup the pubsub push caveat with terraform
(project wide policy)

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the `CONTRIBUTING.md` guide
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

Co-authored-by: kgeckhart <kgeckhart@users.noreply.github.com>",89,54,1,0,"2018-04-16 10:25:39","1655.91"
"grafana/loki","545668c5a31950df2354e9376bdfa7c6216e1b93","vlad-diachenko","2022-10-07 16:33:18","true","[logql-analyzer] auto-deploy on Tag or Main (#7366)


migrated step `deploy` to `updater` plugin from the deprecated
`deploy-image` plugin and added `logql-analyzer` to updater-config.
It's needed to automate adding a new version to logql-analyzer namespace
once the new version is released or once the new version is published on
docker hub.",94,54,1,0,"2018-04-16 10:25:39","1632.26"
"grafana/loki","1b24d2af9a75405a36e54313b82c93e67daca01a","kavirajk","2023-09-22 07:29:13","true","chore: Missed version updates. (#10676)

**What this PR does / why we need it**:

```
LOKI_NEW_VERSION=2.9.1 ./tools/release_update_tags.sh
```

This script was introduced as the part of release docs PR.
https://github.com/grafana/loki/pull/10646

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added

---------

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>
Co-authored-by: Christian Haudum <christian.haudum@gmail.com>",33,65,1,1,"2018-04-16 10:25:39","1982.13"
"grafana/loki","de418bf6acafccfbf8a49bbf10ed28e4b61d3180","splitice","2022-06-03 22:15:21","true","Reduce to a single code path through sendBatches regardless of limit (#6216)

* Reduce to a single code path through sendBatches regardless of limit specified

* simplify sendBatches by using -1 to specify no limit

* test fix",71,50,0,0,"2018-04-16 10:25:39","1508.49"
"grafana/loki","24e9efb907af48ea42b4f7c8b5caba7ba3d3bd41","DylanGuedes","2023-06-20 17:39:39","true","Loki: Report event for `GetChunkRef` instead of SpanLogging (#9748)

**What this PR does / why we need it**:
Modify our calls to `index_client.GetChunkRef` to report invocations
through a span event instead of through span logging. This way we won't
log a new log line for every GetChunkRef call.

**Which issue(s) this PR fixes**:
N/A",61,62,1,1,"2018-04-16 10:25:39","1890.55"
"grafana/loki","656ad800fe563d5fe50c9143742198acc206895a","DylanGuedes","2023-03-06 18:42:04","true","Promtail: Stop ticker to avoid leaking (#8695)

**What this PR does / why we need it**:
Call `Stop` to positions ticker to release associated resources/avoid leaking.",83,59,1,1,"2018-04-16 10:25:39","1781.34"
"grafana/loki","82a8cf425fcc5d41583bf3d2ac647302cfc67503","carlpett","2020-09-03 14:52:41","true","Add a counter for empty syslog messages (#2565)",121,29,0,0,"2018-04-16 10:25:39","867.69"
"grafana/loki","fe7aadfb9d5f87dd773fe016941460dd431927d3","cyriltovena","2020-10-20 17:04:53","true","Fixes race conditions in the batch iterator. (#2773)

* Adds logfmt, regexp and json logql parser

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* hook the ast with parsers.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* hook parser with memchunk.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* hook parser with the storage.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* hook parser with ingesters

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* fixes all tests

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Refactor to pipeline and implement ast parsing.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes the lexer for duration and range

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes all tests and add some for label filters

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add label and line format.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add tests for fmt label and line with validations.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Polishing parsers and add some more test cases

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Finish the unwrap parser, still need to add more tests

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Indent this hell.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Moar tests and it works.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add more tests which lead me to find a bug in the lexer

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add more tests and fix all engine tests

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes match stage in promtail pipelines.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Hook Pipeline into ingester, tailer and storage.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Correctly setup sharding for logqlv2

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes precedences issue with label filters and add moar tests :v:

* Adds quantile_over_time, grouping for non associate range aggregation parsing and moar tests

* Extract with grouping

* Adds parsing duration on unwrap

* Improve the lexer to support more common identifier as functions.

Also add duration convertion for unwrap.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes the frontend logs to include org_id.

The auth middleware was happening after the stats one and so org_id was not set :facepalm:.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Support byte sizes in label filters.

This patch extends the duration label filter with support for byte sizes
such as `1kB` and `42MiB`.

* Wip on error handling.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes json parser with prometheus label name rules.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* fixup! Support byte sizes in label filters.

* Wip error handling, commit before big refactoring.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Refactoring in progress.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Work in progress.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Got something that builds and throw __error__ labels properly now.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add error handling + fixes groupins and post filtering.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* 400 on pipeline errors.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes a races in the log pipeline.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Unsure the key is parsable and valid.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Cleanup and code documentation.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Lint.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Lint.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes frontend handler.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes old test.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fix go1.15 local failing test.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes race conditions in the batch iterator.

We should never advance an iterator in parallel. Unfortunately before the code was building iterators while advancing previous one, building iterator can advance iterator and thus creates a race condition. This changeset make sure we only fetch chunks in advance and build iterator and iterate over them in sequence.

Also add support for labels in the cacheIterator which is required for logqlv2.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

Co-authored-by: Karsten Jeschkies <k@jeschkies.xyz>",116,30,0,1,"2018-04-16 10:25:39","914.78"
"grafana/loki","a07b5ccba2d725ce1bf0ef9e9fe9943bccc8ea1c","davkal","2019-04-09 07:15:42","true","Merge pull request #459 from daixiang0/print-error-to-stderr

Log error to stderr",99,12,0,0,"2018-04-16 10:25:39","352.87"
"grafana/loki","3ed9f0c9ef42eb7632bb45e40eeb6f9e0da66129","bilbof","2023-03-23 20:36:13","true","Canary: support filtering / parsing logs with LogQL (#8871)

**What this PR does / why we need it**:

The canary logs can be shipped to Loki in various formats. This allows
users of the canary to parse out the canaries logs from any format e.g.
nested json.

The alternative is to do something different for the canary logs to
prevent the logs being wrapped / manipulated (e.g. write to Loki
directly, or use a different log pipeline) which limits the benefits of
the canary.

I've confirmed this works locally.

**Which issue(s) this PR fixes**:
Fixes #7775

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",83,59,1,0,"2018-04-16 10:25:39","1798.42"
"grafana/loki","c700744a7ddb753abbc8f363b3b98992963ebc91","irizzant","2022-04-21 05:59:46","true","Loki: Make DNS resolver configurable in Gateway (#5973)

* fix(gateway): make DNS resolver configurable

Signed-off-by: Ivan Rizzante <i.rizzante@gmail.com>

* fix: lint",171,48,0,0,"2018-04-16 10:25:39","1465.82"
"grafana/loki","e73024d3a4440e409248695538baf6843ffd9bf0","tomwilkie","2019-04-18 08:38:15","false","Remove RegexpIter, we don't need it.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",96,12,0,0,"2018-04-16 10:25:39","367.18"
"grafana/loki","f61cbe42888c7213e1665f6d3f9e943e35ac4522","lxwzy","2022-06-13 07:45:28","true","GCS: Add service_account option (#6366)

* gcs client: add service_account support

* Update docs for GCS's service_account

* Fixed lint check failed",71,50,0,0,"2018-04-16 10:25:39","1517.89"
"grafana/loki","75730782a71d0d3944e8e29c959b79a7eb478395","cyriltovena","2020-04-03 19:46:31","true","Removes file size check for pipe, not provided by linux. (#1893)

* Removes file size check for pipe, not provided by linux.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Disable color on windows.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",119,23,0,1,"2018-04-16 10:25:39","712.64"
"grafana/loki","93eb4ad27cfff6897bd16b7fcab50133eedab353","cyriltovena","2020-02-04 16:36:48","true","Add statistics to query_range and instant_query API. (#1615)

* Refactor stats package to use proto.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Merge statistics in the frontend.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Improve engine logging.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes GRPC by rolling back

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add a test to verify stats in the LogQL engine.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Set circle ci build image to 0.9.1 which contains protobuf regression

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fix drone CI.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Change timing data from nanoseconds to seconds like Prometheus.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Improve naming of stats

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Move stats property under data property like Prometheus.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Adjust queryrange frontend to use the new stats property

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Cleanup unused structs.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add documentation for stats API.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Format proto file.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Adds missing godoc on logql.Result

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",108,21,0,1,"2018-04-16 10:25:39","653.51"
"grafana/loki","2ad98007ffd963f549f57e578eb8c0e6341a6975","cyriltovena","2019-05-17 07:26:33","false","fixes chunks lazy loading (#595)",102,13,0,1,"2018-04-16 10:25:39","396.13"
"grafana/loki","43e214038cb7322d7e190d4696d249f74971e4d3","periklis","2023-07-27 17:06:09","true","operator: Prepare community release v0.4.0 (#10050)",50,63,1,1,"2018-04-16 10:25:39","1927.53"
"grafana/loki","ae9c4b82ec4a5d21267da50d6a1a8170e0ef82ff","sandeepsukhani","2020-11-26 07:56:56","true","fix table deletion in table client for boltdb-shipper (#2960)",113,31,0,1,"2018-04-16 10:25:39","950.4"
"grafana/loki","c4048a3adffc4b13957d0b3f41381277b391c56f","farodin91","2023-05-04 12:11:56","true","Promtail: Break on iterate journal failure (#9155)",80,61,1,0,"2018-04-16 10:25:39","1844.32"
"grafana/loki","34715deebda7e46a0595039a934c5ab2842c141d","tomwilkie","2018-05-16 11:06:25","false","Expose ring admin UI.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",0,1,0,0,"2018-04-16 10:25:39","30.03"
"grafana/loki","541f67d0c0b6dcac936a86c10f809e3656b6820c","tomwilkie","2018-04-16 10:42:59","false","Fix circle.yml.",0,0,0,0,"2018-04-16 10:25:39","0.01"
"grafana/loki","6b775ac31caaea6fe4bc71af3cd8ff47886275fd","sandeepsukhani","2021-08-18 13:17:49","true","allow setting tenant id for querying logs from loki (#4185)",131,40,0,1,"2018-04-16 10:25:39","1217.87"
"grafana/loki","c4e669d928adf7f463f7817a73c31600e9130817","vishesh92","2019-12-12 22:26:06","false","Docs: Add configuration docs for redis (#1399)",99,20,0,0,"2018-04-16 10:25:39","601.75"
"grafana/loki","9ec3117245834fb500beed215be960025f9db65f","pracucci","2019-11-07 12:32:43","false","Move ReservedLabelTenantID out from a dedicated file (#1239)",65,19,0,0,"2018-04-16 10:25:39","566.34"
"grafana/loki","4153740a12e4038726e757f666aa3b9c184ecd81","cyriltovena","2020-01-07 14:33:32","true","Loki Query Frontend (#1442)

* Adds frontend to Loki.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Improves tests.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes sneaky bug in entries sorting.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes the split by interval.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Tweak jsonnet deployments and add a way to lint/fmt.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* lint.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* fix timezone issue.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Improve tests and rollback change in loghttp package.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes a flaky test that might run one more goroutine.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes windows build.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Improve tracing in the split by interval.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add test stream to proto conversion.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes flappy retry test.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Remove err shadowing in stopQueryFrontend as it was confusing.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Refactor grpc message size in the libsonnet config file.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Don't check auth header for GRPC  TransferChunks.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Query frontend (#3)

* frontend codec merging optimizations

* codec benchmarks

* removes unused bounds code in queryrange ordering

* [wip] splitby uses channels instead of sub batching intervals

* splitBy channel limit test

* single allocation for merging entries from a single stream

* skip merging loki responses when limit is already hit

* removes checks for unlimited queries in queryrange

* removes splitByInterval{,.interval} spans

* removes interval_batch_size from jsonnet lib

* moves benchmark utils to own file

* renames markers -> entries

* priority queue comments

* Removes unused logRequest.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Sets the cache interval to the same split interval.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Missing import libsonnet for the frontend.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Frontend should not be a cluster IP.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>",102,21,0,1,"2018-04-16 10:25:39","626.42"
"grafana/loki","e83f809dd7a6e8a9dcd133985c62a59945fb0bc6","cyriltovena","2021-01-04 14:46:35","true","Small fixes for the documentation. (#3088)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",110,32,0,1,"2018-04-16 10:25:39","988.68"
"grafana/loki","315972409b58664bf55d8f24cc3bdde60548e50f","cyriltovena","2020-12-02 13:50:53","true","Add more information about why a tailer would stop. (#3015)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",124,31,0,1,"2018-04-16 10:25:39","956.64"
"grafana/loki","39101308f105418fb486cd4e53e68b11db4d8357","cyriltovena","2022-03-15 14:49:20","true","[Frontend] Log Result Cache (#5502)

* Rough verion still require some fixes

* with file saved

* Finish off the code and logic

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Refactors metrics and hook the log cache middleware

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add tests, fixes and lint

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Hash the key

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* better comment

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* better comment

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Update pkg/querier/queryrange/log_result_cache.go

Co-authored-by: Christian Simon <simon@swine.de>

* Update pkg/querier/queryrange/log_result_cache.go

Co-authored-by: Christian Simon <simon@swine.de>

* Fixes typo in variable namme

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Use only one ok bool

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Review feedbacks

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* check array boundaries

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

Co-authored-by: Christian Simon <simon@swine.de>",304,47,0,1,"2018-04-16 10:25:39","1424.93"
"grafana/loki","cdd60cdb79acd0d2283b22e24c1175b62860d5f7","cyriltovena","2020-02-25 01:16:44","true","Allow to configure global limits via the jsonnet deployment. (#1735)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",117,22,0,1,"2018-04-16 10:25:39","673.87"
"grafana/loki","8f9e456535dacf54ace32ac7a86d8059c892040b","osela","2020-05-29 00:36:46","true","helm/loki-stack: render loki datasource only if grafana is enabled (#2086)",126,25,0,0,"2018-04-16 10:25:39","773.09"
"grafana/loki","7ee89ed1d9dd57c2194bfe16dfcdf1cc2a237bd6","KMiller-Grafana","2021-08-18 13:48:47","true","Docs: correct path to Promtail configuration file (#4175)",132,40,0,0,"2018-04-16 10:25:39","1217.89"
"grafana/loki","0986d8dafedb9bec2a9978fc216734e863c6e7f2","liguozhong","2021-02-01 10:25:52","true","[ingester_query] change var ""clients"" to ""reps"" (#3274)",125,33,0,1,"2018-04-16 10:25:39","1015.5"
"grafana/loki","b3f5c872229d4b8166519c4e9a86db205f4bba43","davkal","2019-03-07 13:39:18","true","Merge pull request #347 from yubozhao/documentation-promtail-setup

Add documentation for different way to setup promtails",88,11,0,0,"2018-04-16 10:25:39","321.13"
"grafana/loki","06a6c7c9fc6d84d846ebe4f00ee41a6526d48d56","JStickler","2023-02-10 17:48:53","true","Temporarily unpublish Analyzer page. (#8503)",80,58,1,0,"2018-04-16 10:25:39","1755.31"
"grafana/loki","00460936c0ec16dd90c6a6031ef87d9bf97165ec","robbymilo","2021-12-22 17:16:17","true","update docs preview commands (#4955)

* update docs preview commands

* cleanup",245,44,0,0,"2018-04-16 10:25:39","1342.04"
"grafana/loki","58f9d0c08513df2fdc5c4e4458cc44e68670feb0","sandeepsukhani","2021-07-19 09:24:14","true","add config and documentation about index-gateway (#3956)

* add config and documentation about index-gateway

* Update docs/sources/operations/storage/boltdb-shipper.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* Update docs/sources/operations/storage/boltdb-shipper.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>",106,39,0,1,"2018-04-16 10:25:39","1188.71"
"grafana/loki","e20a1be195d0f29adea62f2cb8f6108fcc96315b","grafanabot","2023-09-14 12:43:27","true","[CI/CD] Update yaml file `./production/helm/loki/values.yaml` (+1 other) (#10572)

**Here is a summary of the updates contained in this PR:**
***
Update attribute `$.enterprise.version` in yaml file
`./production/helm/loki/values.yaml` to the following value: `v1.8.1`
***
Bump version of Helm Chart
Add changelog entry to `./production/helm/loki/CHANGELOG.md`
Re-generate docs

Co-authored-by: Dylan Guedes <djmgguedes@gmail.com>
Co-authored-by: Michel Hollands <42814411+MichelHollands@users.noreply.github.com>",42,65,1,0,"2018-04-16 10:25:39","1974.35"
"grafana/loki","b95db8d1fda860deafa516e2d1c42b27282601cf","cyriltovena","2020-06-04 13:09:23","true","Fix error message for max tail connections. (#2161)

* Fix error message for max tail connections.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes a test.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",128,26,0,1,"2018-04-16 10:25:39","778.61"
"grafana/loki","9eb3098deaa83cc45494c3e88f8a6f9d012f5683","rfratto","2019-07-15 17:36:40","true","promtail: Add systemd journal support (#730)

Support for reading systemd journal entries has been added. 
promtail will look for a job in scrape_configs with a journal key 
to activate the journal target. 

If GOOS=linux and CGO_ENABLED=1, promtail will now require 
libsystemd headers to be available for building. If GOOS is not 
linux or CGO_ENABLED is not 1, journal support will be unavailable
and a log message will be printed warning the user that their config 
file has journal tailing configured without it being built into promtail. 

See docs/promtail-examples.md for a concrete example of 
using journal support. 

Other structural changes made: 

  1. Ability for checking if scrape.Config.ServiceDiscoveryConfig is 
     non-zero has been added. 

     This was chosen over making ServiceDiscoveryConfig a pointer
     as yaml.v2 cannot parse an inline struct into a pointer value. 

  2. Updated pipeline logger component name to journal_pipeline and
     file_pipeline for JournalTargetManager and FileTargetManager
     respectively.

  3. The positions file will now store positions as strings instead of 
     integers. Existing positions will be read in properly but written out 
     as strings the next time the positions file is saved. This is done to 
     be able to store the journal cursor, which is a string. The positions 
     API has been updated to support reading in the old integer values 
     and the new string values.",98,15,0,1,"2018-04-16 10:25:39","454.55"
"grafana/loki","c00af4d38a500fedafea236759de8deb836a59b2","therealdwright","2021-08-05 07:06:59","true","Update lambda-promtail documentation example (#4098)

Closes #4097",103,40,0,0,"2018-04-16 10:25:39","1204.61"
"grafana/loki","6681923a643100492e2515bb6118caa2f5dfbd47","trevorwhitney","2022-10-25 17:52:45","true","Make 2.7.0 section (#7456)

Update the 2.7 changelog to move unreleased section into 2.7.",89,54,1,1,"2018-04-16 10:25:39","1650.31"
"grafana/loki","4704d5e51a7697c70d9bba3e860d70f85e95a11a","chaudum","2023-09-21 15:08:04","true","Docs: Fix broken link on WAL page (#10673)

The reference to a headline on the API page broke, because the headline was removed in https://github.com/grafana/loki/pull/10655

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",33,65,1,1,"2018-04-16 10:25:39","1981.45"
"grafana/loki","bd65883a50d065c04d428fc2445b8c9038ce02ae","owen-d","2021-08-12 19:02:50","true","uses more fleshed out cortex auth utility & adds new auth-ignored routes (#4153)",123,40,0,1,"2018-04-16 10:25:39","1212.11"
"grafana/loki","9366343e18d6e5daf72c914fe80a41b9c6006309","kavirajk","2023-10-27 18:32:50","true","Bug(LogQL): Fix mismatch results on `scalar` and `vector` binary ops (#10997)

**What this PR does / why we need it**:

[According to LogQL
doc,](https://grafana.com/docs/loki/latest/query/#comparison-operators)
binary operators between `scalar` and `vector` should behave as follows
(either it's `scalar` op `vector` or `vector` op `scalar`)

```
Between a vector and a scalar, these operators are applied to the value of every data sample in the vector
```
PromQL (where LogQL inspired from) [also works that
way](https://prometheus.io/docs/prometheus/latest/querying/operators/).

Currently LogQL violates this behaviour. It returns whatever on the
`left` (even if it's scalar). Look into the attached issue for more
details.

Changes:
1. Fixed `MergeBinOps` by making it aware when to return left or right
(depending on which is from vector originally)
2. Add tests in both `engine_test.go` and `evaluator_test.go` to lock
this behaviour
3. Added appropriate comments to the types and functions.

**Which issue(s) this PR fixes**:
Fixes https://github.com/grafana/loki/issues/10741

**Special notes for your reviewer**:


**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)
- [ ] If the change is deprecating or removing a configuration option,
update the `deprecated-config.yaml` and `deleted-config.yaml` files
respectively in the `tools/deprecated-config-checker` directory. <!--
TODO(salvacorts): Add example PR -->

---------

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",17,66,1,1,"2018-04-16 10:25:39","2017.59"
"grafana/loki","470cbbf1180db84e1838204437476ee8b548c3c9","ashwanthgoli","2023-08-25 14:41:56","true","querier: remove query_timeout and engine timeout from querier conf (#10302)

**What this PR does / why we need it**:
Removes `query_timeout` and `engine:timeout` from querier's config
section
Both these configs have been deprecated in 2.7.0 release in favor of
`query_timeout` in `limits_config` which also allows applying per-tenant
overrides at runtime.

CLI flag `-querier.engine.timeout` is also removed

**Checklist**
- [X] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [X] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [X] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

---------

Co-authored-by: Christian Haudum <christian.haudum@gmail.com>
Co-authored-by: J Stickler <julie.stickler@grafana.com>",49,64,1,0,"2018-04-16 10:25:39","1955.43"
"grafana/loki","c1f43771de482b66a8796ca7c0af284e27dc9255","dminca","2020-11-05 14:35:18","true","fix broken link in Best Practices section (#2848)

Resolves:
Related:",130,31,0,0,"2018-04-16 10:25:39","929.67"
"grafana/loki","45bdebf8b22d52e73248ae63a07360cc7b8ac7dc","sh0rez","2019-08-15 19:27:00","true","chore(ci/cd): build containers using drone.io (#891)

Because drone.io provides us with native ARM runners, we evaluate the platform to figure out if it is a suitable replacement for CircleCI and qemu.

Configuration is done using .drone/drone.jsonnet, the .drone/drone.yml is generated from that.
Images are built on amd64, arm64 and arm, natively and without emulation. This allows to get rid of cross-compilation, which in turn allows more advanced builds (CGO, etc.)

Hopefully this will make the CI faster and more reliable in the future. Let's see!",103,16,0,0,"2018-04-16 10:25:39","484.63"
"grafana/loki","6385b195739bd7d4e9706faddd0de663d8e5331a","periklis","2023-11-06 13:45:44","true","fix: All lifecycler cfgs ref a valid IPv6 addr and port combination (#11121)

**What this PR does / why we need it**:
Ensure that all constructors of LifeCyclerConfig are using
`net.JoinHostPort` for instance addr and port combinations. This enables
IPv6 usage compatible across the code based. Currently only distributors
provide IPv6 compatibility because they use `Lifecycler` (that pulls the
addr/port in the `NewLifeCycler`) while everything else uses
`BasicLifeCycler` delegate this to the user defining an addr/port
combination in `LifecyclerConfig`.",10,67,1,1,"2018-04-16 10:25:39","2026.39"
"grafana/loki","e455a11b49ddcf1b2610a96ebfcd6b54dcc4f75f","Juneezee","2023-07-30 07:49:19","true","Ruler: compare header with `strings.EqualFold` (#10103)",52,63,1,0,"2018-04-16 10:25:39","1930.14"
"grafana/loki","99b4f475c4d747a182f78dbf953536e7351b609b","jimgus","2023-02-07 21:38:39","true","Helm: Add podlabels to backend (#8398)

Co-authored-by: Travis Patterson <travis.patterson@grafana.com>",79,58,1,0,"2018-04-16 10:25:39","1752.47"
"grafana/loki","1d20fdbf57afd433dcfbafcb7c10c6eedae21b81","DylanGuedes","2023-06-28 20:42:55","true","LogPushFailures: Log the tenant id (#9819)

**What this PR does / why we need it**:
Modify the `writefailures.Manager` to
- Log the tenant id. Otherwise, it is hard to identify which tenant is
responsible for a problematic push
- Log stream parsing failures

**Which issue(s) this PR fixes**:
N/A",60,62,1,1,"2018-04-16 10:25:39","1898.68"
"grafana/loki","aeba51ab0fe785ab251eaf8d7005f203ece0986f","MasslessParticle","2023-05-18 21:42:29","true","Count unflushed chunks in instance stats (#9479)

The instance wasn't counting unflushed chunks in the stats. This change
checks that the chunk's `flushed time` is 0 which means it hasn't been
flushed yet.",69,61,1,1,"2018-04-16 10:25:39","1858.72"
"grafana/loki","a013e9f342fe180fe1a4fe9d5ae73a18064c87ec","CCOLLOT","2023-02-21 21:47:02","true","Lambda-promtail: Add support for processing SQS messages, add promtailClient Type, add logger, upgrade dependencies and fix unexpected flushing behaviors (#8231)",68,58,1,0,"2018-04-16 10:25:39","1766.47"
"grafana/loki","59030db186627152d8863eacf12f4dda5a1d67ef","jkroepke","2023-01-12 08:18:50","true","Add toggle for persistence disk in single-binary mode (#7778)",99,57,1,0,"2018-04-16 10:25:39","1726.91"
"grafana/loki","8423f56537cfbc4d721501189aabceaa1cb7abb2","xinau","2022-12-08 06:48:43","true","fix small typo (#7874)

This change fixes a small typo in case of a missing space.",95,56,1,0,"2018-04-16 10:25:39","1692.85"
"grafana/loki","6d520f95b3ceecf089305fa5dbabafe4b0fcecee","KMiller-Grafana","2021-11-09 19:00:44","true","Docs: small v2.4.1 release notes edits (#4718)",188,43,0,0,"2018-04-16 10:25:39","1299.11"
"grafana/loki","91eba4fb6b88c3743699873447a5bce4d93c05a4","owen-d","2021-10-22 18:41:38","true","correctly sets subservicesWatcher on scheduler (#4529)",164,42,0,1,"2018-04-16 10:25:39","1282.09"
"grafana/loki","67fe2d68a3b556dfe137770d9e347167fef4d814","sandeepsukhani","2021-08-06 08:16:07","true","fix finding tables which would have out of retention data (#4107)",103,40,0,1,"2018-04-16 10:25:39","1205.66"
"grafana/loki","2b8a3d97946268baafc3c328498409eb941661e1","sandeepsukhani","2019-08-07 13:15:02","false","live-tailing: preload all the historic entries before query context is cancelled (#862)

* preload all the historic entries before query context is cancelled

* fix lint error",97,16,0,1,"2018-04-16 10:25:39","476.37"
"grafana/loki","61be4c99dc1d2b30a9829225514a451c05c11e39","slim-bean","2019-09-13 23:10:57","false","make promtail configmap name configurable",71,17,0,1,"2018-04-16 10:25:39","512.78"
"grafana/loki","b3e8b05431db7b4db28a0b969468119497ae9317","chaudum","2021-12-14 12:14:14","true","Document correct filesystem config options in reference (#4928)

Closes #4915

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",229,44,0,1,"2018-04-16 10:25:39","1333.83"
"grafana/loki","7871ddd12b9f740018738773b7fb05e2a62fc795","owen-d","2023-02-08 14:17:37","true","More precise sharding logic for `on|ignoring` (#8461)",77,58,1,1,"2018-04-16 10:25:39","1753.16"
"grafana/loki","4bf1648da161c834b3f4aff0d15cdc020d49cf5c","slim-bean","2022-05-12 11:12:30","true","Loki: When processing logs during tailing, don't reuse the query pipeline (#6152)

* when tailing, don't reuse the query pipeline because it has an unbounded label cache

Signed-off-by: Edward Welch <edward.welch@grafana.com>

* update changelog

Signed-off-by: Edward Welch <edward.welch@grafana.com>",76,49,0,1,"2018-04-16 10:25:39","1487.03"
"grafana/loki","cc98d10d74e7963f0c6f40d704cbcff30bf40455","aknuds1","2020-05-06 12:52:27","true","Chore: Correct typo ""per seconds"" (#2050)

Signed-off-by: Arve Knudsen <arve.knudsen@gmail.com>",119,25,0,0,"2018-04-16 10:25:39","750.6"
"grafana/loki","d74c67a9d0c1fa0bc6f8205bdcdf49a1768da05b","trevorwhitney","2023-06-20 21:55:49","true","Add version to TSDB index builder struct (#9566)

Add version as a property to the TSDB Index Builder, forcing
users of the builder to specify a version for each builder instance.
This is the first of many PRs that will add the TSDB index version to
the schema version config.",61,62,1,1,"2018-04-16 10:25:39","1890.73"
"grafana/loki","ed5ecd2bdfe09cd574184342fa1936691019c887","trevorwhitney","2022-11-10 23:30:22","true","Add 2.7 release notes (#7661)

**What this PR does / why we need it**:

Adds 2.7 release notes

Co-authored-by: JordanRushing <rushing.jordan@gmail.com>",83,55,1,1,"2018-04-16 10:25:39","1665.54"
"grafana/loki","9f41182da2f69fe7164a6e93915e34cd4162f54b","andriikushch","2023-03-31 20:32:51","true","Fix the link in the Azure Event Hubs doc (#8904)

**What this PR does / why we need it**:

This PR fixes the link to the configuration in the Azure Event Hubs
scraping doc.

Link to the discussion
https://github.com/grafana/loki/pull/8787#discussion_r1145298591

**Which issue(s) this PR fixes**:
Not available


**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",81,59,1,0,"2018-04-16 10:25:39","1806.42"
"grafana/loki","82c91641dfc3a692f2d079b5c13a3d87bec22ba7","tomwilkie","2021-11-29 07:56:24","true","Use dependabot to keep gomod dependancies up to date. (#4834)

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",214,43,0,0,"2018-04-16 10:25:39","1318.65"
"grafana/loki","24deb6ed3bc5d6bfa47c927e8e7b8aff158c0dde","sandeepsukhani","2023-01-04 06:40:19","true","fix bugs in logs results caching and its tests (#7925)

**What this PR does / why we need it**:
When a logs query results in an empty response, we cache it to avoid
doing that query again and respond straight away with an empty response.
However, we cache a single entry per time split interval with the query
itself to keep things simple. For example, if the time split config for
tenant `A` is `30m`, then queries for intervals `10m`-`20m` and
`21m`-`25m` would have the same cache key.

Here is roughly how cache hit is handled:

* If the new query is within the cached query bounds, return empty
results
* If the start of new query is before the start time of the cached
query, do a query from `newQuery.Start` to `cachedQuery.Start`
* If the response of last query is also empty, set `cachedQuery.Start` =
`newQuery.Start`
* If the end of new query is after the end time of the cached query, do
a query from `cachedQuery.End` to `newQuery.Start`
* If the response of last query is also empty, set `cachedQuery.End` =
`newQuery.End`
* If we have changes in `cachedQuery.Start/End`, update it in the cache.

The problem here is when we do queries to fill the gap, we sometimes do
queries for the range outside of what the user requested and respond
back without reducing the response to what the user requested. For
example, if the cached query is from `21m`-`25m` and the user query is
from `10m`-`15m`, we will query for the whole gap i.e `10m`-`21m`. If
there are logs from `15m`-`21m` in the response, we will unexpectedly
send it back to the user.

This PR takes care of this issue by extracting the data and sending back
only the user's requested logs.

I have also found the tests for logs results cache were incorrect. They
heavily use
[mergeLokiResponse](https://github.com/grafana/loki/blob/e2842c69c5e089389b697faa792e368f42f84c19/pkg/querier/queryrange/codec.go#L1014)
for building the test data, but they were not setting the `limit` in
test queries which was causing `mergeLokiResponse` to send back empty
results. This means were were always comparing two empty results, which
would always be the same.
This PR also takes care of fixing it, and relevant changes to correct
the test.

**Checklist**
- [x] Tests updated
- [x] `CHANGELOG.md` updated",101,56,1,1,"2018-04-16 10:25:39","1718.84"
"grafana/loki","803ff5890a8fd13d537938997e93914aeef79642","blockloop","2021-03-10 21:57:28","true","WIP",154,35,0,0,"2018-04-16 10:25:39","1054.98"
"grafana/loki","1283c42a8000f8cfe59b17e712ff46cb21e0e319","trevorwhitney","2023-04-21 16:58:00","true","Bring back centralized docs toolkit (undo revert in #9146) (#9147)

**What this PR does / why we need it**:

This reverts the revert in https://github.com/grafana/loki/pull/9146
with a slightly less ""nuclear"" solution.

I think the problem was that CI was pulling `docs.mk` from `main`, and
it was creating a diff between the version we had checked in. I changed
`docs.mk` to point to a specific sha, which should prevent this in the
future.

I also opened a
[PR](https://github.com/grafana/writers-toolkit/pull/228) against the
writers-toolkit.",81,60,1,1,"2018-04-16 10:25:39","1831.52"
"grafana/loki","cc60398bb8c6752b4479e9da59dd2f44221c5d95","slim-bean","2019-05-15 01:28:33","false","change response_latency bucket sizes",100,13,0,1,"2018-04-16 10:25:39","393.88"
"grafana/loki","4287f812ce852d840925faa2f9eb591da3daaba4","tomwilkie","2018-06-27 07:51:50","true","Add API docs to the readme. (#14)

* Add API docs to the readme.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>

* Newlines.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>

* Add note about auth.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",1,2,0,0,"2018-04-16 10:25:39","70.89"
"grafana/loki","d972e77ae214fa5b82ca257ce393828a3c8a93c1","trevorwhitney","2022-09-15 08:17:43","true","Expose limits and compactor config via helm values (#7108)

**What this PR does / why we need it**:

Exposes the compactor and limits config in the helm chart via helm
values. Replaces https://github.com/grafana/loki/pull/7055 with some
minor stylistic changes, and moving default limits into the new
`limits_config` value.",87,53,1,1,"2018-04-16 10:25:39","1609.91"
"grafana/loki","7f15065ba9ca40be831426ef3ca4a67065bedb42","grafanabot","2022-07-08 12:37:31","true","updated date of the release and release notes (#6635) (#6636)

(cherry picked from commit f81dc96a360e81273d0110bc8182132796038e57)

Co-authored-by: Vladyslav Diachenko <82767850+vlad-diachenko@users.noreply.github.com>",69,51,0,0,"2018-04-16 10:25:39","1543.09"
"grafana/loki","9ff24ac736921164dad6620dad14431e35ef3805","trevorwhitney","2022-01-20 07:58:04","true","Remove temporary ruler ring key fix (#5189)

Ring keys have been moved out of dskit into their respective projects.

Edit commit drone hack",266,45,0,1,"2018-04-16 10:25:39","1369.65"
"grafana/loki","a2060efd6332464d3239ebce882e8d4a1fcd61e3","polar3130","2019-09-26 13:03:56","false","Helm: Remove default value of storageClassName in loki/loki helm chart (#1058)

* delete default name of  storageClassName ""default""

* bump loki stack",72,17,0,0,"2018-04-16 10:25:39","525.36"
"grafana/loki","89263b09a7d60e86b07034fe8c41f791310aa938","adityacs","2020-03-11 18:47:49","true","Add /ready endpoint to table-manager (#1736)",117,23,0,1,"2018-04-16 10:25:39","690.6"
"grafana/loki","8db2d06dd8a4026b3d6488c0dcdf4974ab9627c9","dgzlopes","2020-03-01 17:21:50","true","Bump testify to 1.5.1 (#1762)

Signed-off-by: Daniel González Lopes <danielgonzalezlopes@gmail.com>",117,22,0,0,"2018-04-16 10:25:39","680.54"
"grafana/loki","7b31c6634d7c52bf6660db985d37913d388280ed","slim-bean","2019-08-06 21:27:26","false","sum the read dashboard by route and make sure we are only showing query and label routes (not tail)",99,16,0,1,"2018-04-16 10:25:39","475.71"
"grafana/loki","4d46cf5dd908d499db731a82b2a1312dc11f0869","adamstrawson","2022-09-08 11:59:01","true","Missing conditional on ServiceMonitor (#7067)

**What this PR does / why we need it**:

Affects the Loki Helm chart

The ServiceMonitor resource was missing a conditional for the `enabled`
flag, as per the other monitoring resources.

**Which issue(s) this PR fixes**:
Fixes #7066

**Checklist**
- [ ] Documentation added
- [ ] Tests updated
- [ ] Is this an important fix or new feature? Add an entry in the
`CHANGELOG.md`.
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",86,53,1,0,"2018-04-16 10:25:39","1603.06"
"grafana/loki","c30fb9450bdef0db73682b097a0b044284d50a5f","periklis","2022-09-07 08:54:34","true","Add support for custom internal server (#7069)



Co-authored-by: Christian Simon <simon@swine.de>",84,53,1,1,"2018-04-16 10:25:39","1601.94"
"grafana/loki","51fbc95bbd27b9edc584c66fd7d18256e11ec33a","owen-d","2022-03-31 17:55:20","true","fixes existing test case and adds more (#5687)",310,47,0,1,"2018-04-16 10:25:39","1441.06"
"grafana/loki","8c348614e3a70409af6487e25dab694a6cf66f45","owen-d","2022-01-13 17:41:10","true","Querier worker/inflight metrics (#5124)

* refactors querier worker metrics to use metrics struct

* metrics and logs for querier worker execution

* loki_querier_worker_concurrency metric

* alter log line

* wires up prometheus.registerer args to prevent duplicate registration errors on tests",262,45,0,1,"2018-04-16 10:25:39","1363.05"
"grafana/loki","c6492629716307e87d052c364abe6b3ff1d74c1d","periklis","2021-10-01 14:42:31","true","Add multiple platforms (#89)",138,41,0,1,"2018-04-16 10:25:39","1260.93"
"grafana/loki","3d49c09e3407d4688dc93aba6ac342a81887dc40","conorevans","2022-07-05 21:41:54","true","fix(lambda-promtail): update default lambda_vpc_subnets / lambda_vpc_security_groups values to be appropriate empty list(string) value (#6453)

Signed-off-by: Conor Evans <coevans@tcd.ie>",74,51,0,0,"2018-04-16 10:25:39","1540.47"
"grafana/loki","31f3c205e6a410f56c3d78a3737c9d03ce7f53e8","slim-bean","2020-12-23 20:06:41","true","Helm: Disable CI (#3072)

* Removing the helm chart ci build steps as the helm charts are in a new repo now.

* remove helm targets from the makefile",124,32,0,1,"2018-04-16 10:25:39","977.9"
"grafana/loki","9fdcacff15a822c575a1d64e97eba61e746cecef","sandeepsukhani","2022-01-27 15:03:27","true","v12 chunk format handling in retention (#5254)

Also add some tests and safety mechanism to avoid dropping whole table when we cant find any chunks",276,45,0,1,"2018-04-16 10:25:39","1376.94"
"grafana/loki","d53aef63b10feb1fe491ff65e1d944e4e02b9f15","kavirajk","2021-11-03 16:27:23","true","Add changelog and upgrade guide for #4556 (#4631)

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",170,42,0,1,"2018-04-16 10:25:39","1293"
"grafana/loki","8fa946143c7d5f757050834e54d81238dd88784a","DanCech","2018-12-07 15:38:37","true","Merge pull request #48 from grafana/one-line-install

simple script to generate promtail yaml",10,8,0,0,"2018-04-16 10:25:39","231.22"
"grafana/loki","96e64750e0762c1614f9ffc8548b1f75c6e9cc51","DylanGuedes","2021-10-28 22:43:04","true","Tune Loki execution modes image. (#4579)

- Change modes reordering in modes image to ""monolithic"" -> ""simple scalable"" -> ""microservices""
- Add a subtitle with the name of each component to the modes image
- Rename ""monolythic"" to ""monolithic"" (typo)
- Change read components background fill from hachure to solid
- Remove old modes of operation image",167,42,0,1,"2018-04-16 10:25:39","1288.26"
"grafana/loki","9227eed9f455d1fae7f917e32523794661db7c85","rfratto","2020-01-10 20:29:54","true","pkg/ingester: limit total number of errors a stream can return on push (#1071)

* pkg/ingester: limit total number of errors a stream can return on push

* pkg/ingester: s/max_ignored_stream_errors/max_returned_stream_errors",101,21,0,1,"2018-04-16 10:25:39","629.67"
"grafana/loki","9b2c27d2132b21b3f0ec6fb19949f181eb89650f","tomwilkie","2018-05-15 14:29:40","false","Various small nits.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",0,1,0,0,"2018-04-16 10:25:39","29.17"
"grafana/loki","39bbd733be4a0d430986d9513476a91334485e9f","sandeepsukhani","2019-05-27 13:25:18","false","ksonnet changes for running loki in single binary (#622)

* ksonnet changes for running loki in single bianry
Added retention config with default values

* Fixed indentation",109,13,0,1,"2018-04-16 10:25:39","406.37"
"grafana/loki","e171c4bcd64cf441163d37c1ca324bf45d747c16","sandeepsukhani","2022-07-19 07:22:56","true","keep the memberlist labels jsonnet config backwards compatible with 2.6.1 (#6711)

* keep the memberlist labels jsonnet config backwards compatible with 2.6.1

* fix comment",69,51,0,1,"2018-04-16 10:25:39","1553.87"
"grafana/loki","4ce385f0c2d3a050e7b65235a09f489912f487a1","Fra-nk","2020-06-30 17:38:37","true","Documentation: Refine LogQL documentation (#2279)

* Fix broken list syntax in LogQL documentation

* Reformat LogQL docuto one sentence per line

* Use proper code blocks in LogQL docu

* Give LogQL operator order to dedicated docu section

Co-authored-by: Frank Fischer <frank.fischer@jda.com>",132,26,0,0,"2018-04-16 10:25:39","804.8"
"grafana/loki","3f59fa96d8e1516bfb178aab899c7cb73673fcc9","changhyuni","2022-11-09 14:54:16","true","lambda-promtail: Add kinesis data stream to use in terraform  (#7632)

**What this PR does / why we need it**:
https://github.com/grafana/loki/pull/5977
With the addition of the kinesis data stream function add kinesis data
stream to use in terraform",84,55,1,0,"2018-04-16 10:25:39","1664.19"
"grafana/loki","c1a04f4befef8ee18cd860e24eb75888818a7d96","JoaoBraveCoding","2023-07-17 17:08:35","true","operator: add initContainer to pods of zone aware components (#9795)

Co-authored-by: Periklis Tsirakidis <periklis@redhat.com>",58,63,1,0,"2018-04-16 10:25:39","1917.53"
"grafana/loki","23167e4f103424f702e6d63e5b1d7ea522166378","tomwilkie","2018-04-17 15:43:06","false","Add some unit tests for the iterators.",0,0,0,0,"2018-04-16 10:25:39","1.22"
"grafana/loki","efdabb17e8aadbec2f15008b574c0fa3645f0796","JStickler","2023-08-07 15:20:04","true","Update links in README (#10151)

**Which issue(s) this PR fixes**:
Fixes #10105  by rolling back the README changes from #9974.",53,64,1,0,"2018-04-16 10:25:39","1937.45"
"grafana/loki","90a1d4593e2d690b37333386383870865fe177bf","pstibrany","2023-04-20 10:48:58","true","Update Prometheus dependency (#9205)",77,60,1,0,"2018-04-16 10:25:39","1830.27"
"grafana/loki","1fc00fa02d7c2bcaebb2b32d0a97ac8a8dc34e97","liguozhong","2023-02-09 13:32:31","true","[new] chunk backend: Integrate Alibaba Cloud oss (#8410)",78,58,1,1,"2018-04-16 10:25:39","1754.13"
"grafana/loki","685c898b9532e5e3d85dc7fe418764983d7cdfa9","Red-GV","2022-07-19 18:09:34","true","operator: Addons work in restricted policy (#6564)",71,51,0,1,"2018-04-16 10:25:39","1554.32"
"grafana/loki","0ee476b758397eeb4dc61396b115bbb4e5b6165c","cstyan","2021-11-12 07:42:43","true","Simplify chunk flush rate % query. (#4711)

Signed-off-by: Callum Styan <callumstyan@gmail.com>",194,43,0,1,"2018-04-16 10:25:39","1301.64"
"grafana/loki","469e409f85a31ee4eb54e3a6052ed5af7b22a2b8","periklis","2021-10-01 15:05:57","true","Add support for dependabot our GH actions (#92)",138,41,0,1,"2018-04-16 10:25:39","1260.94"
"grafana/loki","626f7da151568c44c241c9c9e396629f50ecc00e","periklis","2021-08-26 11:44:00","true","Bump operator-sdk v1.11.0 and ctrl-runtime 0.9.2 (#73)",127,40,0,1,"2018-04-16 10:25:39","1225.8"
"grafana/loki","a60924792d3b4776329665e6cea2d700817366c7","KMiller-Grafana","2021-08-10 21:35:52","true","Docs: revise section header (out of order writes) (#4134)",113,40,0,0,"2018-04-16 10:25:39","1210.22"
"grafana/loki","c793d7df8e6a59e6669c2448f82b75497836824c","tarokkk","2020-01-29 13:04:36","true","add URI validation (#1603)",106,21,0,0,"2018-04-16 10:25:39","648.36"
"grafana/loki","b0c05ae9679abc5946f09d13696514635d690775","cyriltovena","2019-08-05 20:10:57","false","Add governance documentation",99,16,0,1,"2018-04-16 10:25:39","474.66"
"grafana/loki","01a0762904b53787316400b66a87fc36b644b85b","daixiang0","2019-07-23 03:59:12","false","add missing `

Signed-off-by: Xiang Dai <764524258@qq.com>",103,15,0,0,"2018-04-16 10:25:39","461.98"
"grafana/loki","c6a5111e8a28a8cbff22b1f63e9acba6c09e8247","daixiang0","2019-04-11 11:35:21","false","Remove useless config option

port need match http_listen_port, keep this option only increase possibility of wrong configuration, remove it.

Signed-off-by: Xiang Dai <764524258@qq.com>",99,12,0,0,"2018-04-16 10:25:39","355.05"
"grafana/loki","95c407ec552049f70eecd55a65f279aa32350fc7","bulletfactory","2019-02-11 19:27:20","false","Update README.md (#316)

Added info about GrafanaCon at the top",80,10,0,0,"2018-04-16 10:25:39","295.38"
"grafana/loki","fe436d6ac139829e880e901e518542c10c05fb8c","tomwilkie","2018-05-18 11:32:10","true","Merge pull request #6 from grafana/dev

Bunch of fixes",0,1,0,0,"2018-04-16 10:25:39","32.05"
"grafana/loki","b9185324f4c6bb806af3cd577cf673e647fe9a43","pracucci","2019-08-09 12:28:02","false","Improved Tailer loop (dropped entries, logic refactoring, introduced tests)",100,16,0,0,"2018-04-16 10:25:39","478.33"
"grafana/loki","8f693e77b0cbb3eca6d5d6698a14582677885425","cyriltovena","2022-03-14 10:37:54","true","Update Prometheus to latest (#5545)

* Update Prometheus to latest

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Update promql.QueryTracker

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes querier test to use new grafana/regexp

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes test with new textparse signature

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* lint

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",304,47,0,1,"2018-04-16 10:25:39","1423.76"
"grafana/loki","dd5fceb348a28741e6a3c662e37f107a0d2d729f","cyriltovena","2020-10-21 08:25:31","true","Logqv2 optimization (#2778)

* Adds logfmt, regexp and json logql parser

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* hook the ast with parsers.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* hook parser with memchunk.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* hook parser with the storage.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* hook parser with ingesters

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* fixes all tests

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Refactor to pipeline and implement ast parsing.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes the lexer for duration and range

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes all tests and add some for label filters

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add label and line format.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add tests for fmt label and line with validations.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Polishing parsers and add some more test cases

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Finish the unwrap parser, still need to add more tests

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Indent this hell.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Moar tests and it works.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add more tests which lead me to find a bug in the lexer

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add more tests and fix all engine tests

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes match stage in promtail pipelines.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Hook Pipeline into ingester, tailer and storage.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Correctly setup sharding for logqlv2

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes precedences issue with label filters and add moar tests :v:

* Adds quantile_over_time, grouping for non associate range aggregation parsing and moar tests

* Extract with grouping

* Adds parsing duration on unwrap

* Improve the lexer to support more common identifier as functions.

Also add duration convertion for unwrap.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes the frontend logs to include org_id.

The auth middleware was happening after the stats one and so org_id was not set :facepalm:.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Support byte sizes in label filters.

This patch extends the duration label filter with support for byte sizes
such as `1kB` and `42MiB`.

* Wip on error handling.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes json parser with prometheus label name rules.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* fixup! Support byte sizes in label filters.

* Wip error handling, commit before big refactoring.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Refactoring in progress.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Work in progress.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Got something that builds and throw __error__ labels properly now.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add error handling + fixes groupins and post filtering.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* 400 on pipeline errors.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes a races in the log pipeline.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Unsure the key is parsable and valid.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Cleanup and code documentation.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Lint.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Lint.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes frontend handler.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes old test.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fix go1.15 local failing test.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes race conditions in the batch iterator.

We should never advance an iterator in parallel. Unfortunately before the code was building iterators while advancing previous one, building iterator can advance iterator and thus creates a race condition. This changeset make sure we only fetch chunks in advance and build iterator and iterate over them in sequence.

Also add support for labels in the cacheIterator which is required for logqlv2.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Handle panic in the store goroutine.

This could cause Loki to crash if a panic happens in the store since it was happening in another goroutine.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Now that races are gone we can use a global decoder.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Improve labels handling in all LogQL stages.

benchmark before:

```
pkg: github.com/grafana/loki/pkg/logql/log
Benchmark_Pipeline
Benchmark_Pipeline-16    	  107580	     10271 ns/op	    6387 B/op	      67 allocs/op
PASS
ok  	github.com/grafana/loki/pkg/logql/log	1.228s
```

after
```
pkg: github.com/grafana/loki/pkg/logql/log
Benchmark_Pipeline
Benchmark_Pipeline-16    	  199170	      5670 ns/op	    3307 B/op	      54 allocs/op
PASS
ok  	github.com/grafana/loki/pkg/logql/log	1.201s
```

Way less allocations !

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes error label filtering.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Reviews comment.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

Co-authored-by: Karsten Jeschkies <k@jeschkies.xyz>",117,30,0,1,"2018-04-16 10:25:39","915.42"
"grafana/loki","760ad8691a664c339f211fa4ebbb9159cfbaf01a","chaudum","2023-09-22 13:52:22","true","Docs: Remove experimental flag from GELF support in Promtail (#10684)

GELF support in Promtail is not experimental (any more).

**Special notes for your reviewer**:

Nothing really worth mentioning in the changelog or release notes.

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",35,65,1,1,"2018-04-16 10:25:39","1982.39"
"grafana/loki","7877c8a955c19b9ec51848889f96103a4a57ca94","periklis","2021-04-15 13:26:26","true","Split default target into development and production overlays (#24)",162,36,0,1,"2018-04-16 10:25:39","1089.63"
"grafana/loki","b5f0c75c037c73eea973560688d94934b27ee4a8","rfratto","2020-07-28 20:36:37","true","pkg/promtail: propagate a logger rather than using util.Logger globally (#2438)

* pkg/promtail: propagate a logger rather than using util.Logger globally

This commit allows for creating promtail with a custom log.Logger
instance which will be propagated and used consistently throughout the
Promtail package. This allows for clients to provide a Promtail-specific
logger.

Address a portion of #2405.

* remove applyOptions function",126,27,0,1,"2018-04-16 10:25:39","832.92"
"grafana/loki","da76b1394deb95330f7248c9716fecbf3beede58","trevorwhitney","2023-01-18 07:17:58","true","fix broken drone image for arm builds (#8186)

**What this PR does / why we need it**:

Harness pushed a bad drone image, causing the build to fail for all arm
images. The build is currently failing on `main`, this should fix it.

Signed-off-by: Ashwanth Goli <iamashwanth@gmail.com>
Co-authored-by: Ashwanth Goli <iamashwanth@gmail.com>",94,57,1,1,"2018-04-16 10:25:39","1732.87"
"grafana/loki","6f28a5dc70af818dfd03eacd14ad7663334490e4","trevorwhitney","2021-10-21 22:45:01","true","Apply better defaults when boltdb shipper is being used (#4508)

* changes from PR review

* rename object_store -> storage

* add local/filesytem support to common object storage config

* add better defaults for boltdb shipper

* guard against missing schema configs in dynamic config application

* fix alphabetical order of storage configs

* return an error when more than one storage config is provided",165,42,0,1,"2018-04-16 10:25:39","1281.26"
"grafana/loki","573673a0ab7744f08241a4c6d94a34fec0746a52","slim-bean","2019-07-29 12:49:24","true","Simplify our makefile as much as possible (#753)

refactor(makefile): simplify makefile by removing the autogenerated targets and make building binaries and dockerfiles separate operations.",103,15,0,1,"2018-04-16 10:25:39","468.35"
"grafana/loki","c326d6b08bbe39baa6f75511e156339cacf23c1b","slim-bean","2019-06-03 14:29:55","false","adding a release process",109,14,0,1,"2018-04-16 10:25:39","412.42"
"grafana/loki","b6d9fd5a00d27a597a278c0be442462f9390e57a","slim-bean","2020-08-21 15:13:07","true","restart the tailer if we fail to read and upate current position (#2532)",121,28,0,1,"2018-04-16 10:25:39","855.7"
"grafana/loki","edaf0ed4228cdefbd7b3cfcdac19e6f9b2bb3e86","slim-bean","2020-07-09 15:56:17","true","transfers one chunk at a time per series instead of all (#2328)",126,27,0,1,"2018-04-16 10:25:39","813.73"
"grafana/loki","b4c6065b9726d2d5bba3f2dea0d726c698d8eb0f","slim-bean","2020-08-24 11:06:39","true","implement shutdown for the no-op server (#2542)",122,28,0,1,"2018-04-16 10:25:39","858.53"
"grafana/loki","42dccae68fc5a63526ebda786cbe8cefeedb8256","carlpett","2020-06-22 15:17:26","true","docs: Fix missing quotes (#2247)",138,26,0,0,"2018-04-16 10:25:39","796.7"
"grafana/loki","de580b923fbb22791b3720bfce22baf2911d73d4","slim-bean","2021-08-26 13:29:22","true","add backport workflow for automating PR creation (#4220)",127,40,0,1,"2018-04-16 10:25:39","1225.88"
"grafana/loki","5cef03d0ea1bfc9bb80d7aa90ffcadf26e490061","ashwanthgoli","2023-04-14 06:02:51","true","index-shipper: add support for multiple stores (#7754)

Signed-off-by: Ashwanth Goli <iamashwanth@gmail.com>

**What this PR does / why we need it**:
Currently loki initializes a single instance of index-shipper to [handle
all the table
ranges](https://github.com/grafana/loki/blob/ff7b46297345b215fbf49c2cd4c364d125b6290b/pkg/storage/factory.go#L188)
(from across periods) for a given index type `boltdb-shipper, tsdb`.
Since index-shipper only has the object client handle to the store
defined by `shared_store_type`, it limits the index uploads to a single
store. Setting `shared_store_type` to a different store at a later point
in time would mean losing access to the indexes stored in the previously
configured store.

With this PR, we initialize a separate index-shipper & table manager for
each period if `shared_store_type` is not explicity configured. This
offers the flexibility to store index in multiple stores (across
providers).

**Note**:
- usage of `shared_store_type` in this commit text refers to one of
these config options depending on the index in use:
`-boltdb.shipper.shared-store`, `-tsdb.shipper.shared-store`
- `shared_store_type` used to default to the `object_store` from the
latest `period_config` if not explicitly configured. This PR removes
these defaults in favor of supporting index uploads to multiple stores.

**Which issue(s) this PR fixes**:
Fixes #7276

**Special notes for your reviewer**:
All the instances of downloads table manager operate on the same
cacheDir. But it shouldn't be a problem as the tableRanges do not
overlap across periods.

**Checklist**
- [X] Reviewed the `CONTRIBUTING.md` guide
- [ ] Documentation added
- [X] Tests updated
- [x] `CHANGELOG.md` updated
- [x] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

---------

Signed-off-by: Ashwanth Goli <iamashwanth@gmail.com>
Co-authored-by: J Stickler <julie.stickler@grafana.com>",81,60,1,0,"2018-04-16 10:25:39","1818.82"
"grafana/loki","79f0e349f56c3ec6663a3dc0457173c49a2765b4","cyriltovena","2022-03-14 11:15:17","true","Refactor LogQL syntax into its own package (#5539)

* Refactor LogQL syntax into its own package

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Merge upstream

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Update pkg/loghttp/series.go

Co-authored-by: Susana Ferreira <ssncferreira@gmail.com>

* lint

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* lint

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

Co-authored-by: Susana Ferreira <ssncferreira@gmail.com>",303,47,0,1,"2018-04-16 10:25:39","1423.78"
"grafana/loki","18f1b0640d4f4284086c420a77e0c46b4bc12503","cyriltovena","2020-06-02 18:33:43","true","Bytes aggregations (#2150)

* Add bytes_rate and bytes_over_time.

Still need to works on test.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add more tests.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* lint.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* More lint fixes.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* More comments.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add documentation.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Review feedbacks.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fix bad conflic resolution.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",124,26,0,1,"2018-04-16 10:25:39","776.84"
"grafana/loki","177f37700a7d20df622acd73351e26307b7f29e8","chaudum","2022-08-30 07:45:15","true","Make TSDB store singleton resettable (#6950)

This changes allows downstream projects to reset the TSDB store singleton. This must only be called in test cases where a new store instances cannot be explicitly created.

Also add a `nil` check to the reset function for the BoltDB shipper singleton instance.

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",80,52,1,1,"2018-04-16 10:25:39","1594.89"
"grafana/loki","4a70f8ec8499a019b1619c2df88564c4c9fef293","DylanGuedes","2022-01-27 16:07:29","true","Copy `cortex/pkg/ingester/client` package dependency into Loki (#5164)

* Fork ingester client.

* Document magic numbers.",276,45,0,1,"2018-04-16 10:25:39","1376.99"
"grafana/loki","5dc888710ac721db90243d64e87516d46a33aa3c","kavirajk","2022-01-18 16:27:06","true","Support ""POST"" method for distributor ring (#5171)

Able to ""forget"" the unhealthy member

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",264,45,0,1,"2018-04-16 10:25:39","1368"
"grafana/loki","f94ad5f4a5258142088de797fddd18427d0ff8b4","davkal","2019-03-29 15:52:50","false","Moved provision link below normal config guide",93,11,0,0,"2018-04-16 10:25:39","343.23"
"grafana/loki","3486889db9a563ff6ba70a90c869f9fc913686ec","slim-bean","2020-08-13 17:07:32","true","Release 1.6.0 (#2502)

* Updating changelog and release notes for 1.6.0

* updating version in documentation",119,28,0,1,"2018-04-16 10:25:39","847.78"
"grafana/loki","1cca922e6dc0608117d5336c17ed4693df0b7a99","sandeepsukhani","2021-07-09 10:58:21","true","fix flaky retention tests (#3976)",117,39,0,1,"2018-04-16 10:25:39","1178.77"
"grafana/loki","3dad05aab7e91f1b7e3bca759e1f2eda91eaab58","davkal","2019-02-15 11:39:21","true","Update issue templates",87,10,0,0,"2018-04-16 10:25:39","299.05"
"grafana/loki","0170249eae2858275e8324c51d54f559b3544706","tomwilkie","2020-04-13 10:21:41","false","Put loki-mixin and promtail-mixin dashboards in a folder.",123,24,0,0,"2018-04-16 10:25:39","722.25"
"grafana/loki","ea324fe43ffbabd157e1d7484255dfa9292182c3","tomwilkie","2018-12-17 10:56:20","true","Add a section on the README for getting help. (#126)

* Add a section on the README for getting help.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>

* Review feedback.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",38,8,0,0,"2018-04-16 10:25:39","241.02"
"grafana/loki","ee69f2bd37b79230f316bebaccc9d5b6bc7446ad","salvacorts","2023-03-29 08:13:35","true","Split index request in 24h intervals (#8909)

**What this PR does / why we need it**:

At https://github.com/grafana/loki/pull/8670, we applied a time split of
24h intervals to all index stats requests to enforce the
`max_query_bytes_read` and `max_querier_bytes_read` limits. When the
limit is surpassed, the following message get's displayed:


![image](https://user-images.githubusercontent.com/8354290/227960400-b74a0397-13ef-4143-a1fc-48d885af55c0.png)

As can be seen, the reported bytes read by the query are not the same as
those reported by Grafana in the lower right corner of the query editor.
This is because:

1. The index stats request for enforcing the limit is split in
subqueries of 24h. The other index stats rquest is not time split.
2. When enforcing the limit, we are not displaying the bytes in powers
of 2, but powers of 10 ([see here][2]). I.e. 1KB is 1000B vs 1KiB is
1024B.

This PR adds the same logic to all index stats requests so we also time
split by 24 intervals all requests that hit the Index Stats API
endpoint. We also use powers of 2 instead of 10 on the message when
enforcing `max_query_bytes_read` and `max_querier_bytes_read`.


![image](https://user-images.githubusercontent.com/8354290/227959491-f57cf7d2-de50-4ee6-8737-faeafb528f99.png)

Note that the library we use under the hoot to print the bytes rounds up
and down to the nearest integer ([see][3]); that's why we see 16GiB
compared to the 15.5GB in the Grafana query editor.

**Which issue(s) this PR fixes**:
Fixes https://github.com/grafana/loki/issues/8910

**Special notes for your reviewer**:

- I refactored the`newQuerySizeLimiter` function and the rest of the
_Tripperwares_ in `rountrip.go` to reuse the new IndexStatsTripperware.
So we configure the split-by-time middleware only once.

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [x] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`


[1]: https://grafana.com/docs/loki/latest/api/#index-stats
[2]:
https://github.com/grafana/loki/blob/main/pkg/querier/queryrange/limits.go#L367-L368
[3]: https://github.com/dustin/go-humanize/blob/master/bytes.go#L75-L78",84,59,1,1,"2018-04-16 10:25:39","1803.91"
"grafana/loki","22872c41297952ea9b3281f946b348a5b7f4ec57","jiachengxu","2022-03-07 06:24:54","true","Loki mixin: add DiskSpaceUtilizationPanel (#5552)

* loki mixin: add DiskSpaceUtilizationPanel

* Add CHANGELOG

Co-authored-by: Jiacheng Xu <jiachengxu@users.noreply.github.com>",299,47,0,0,"2018-04-16 10:25:39","1416.58"
"grafana/loki","87a659a6db924904ecb7cb557b7e0504cdd0bc39","salvacorts","2023-06-02 08:39:53","true","Add span events for index stats and result cache (#9552)

**What this PR does / why we need it**:
This PR adds events to the traces to have some extra observability for
how we compute the index stats. We also add some trace events to the
results cache.


![image](https://github.com/grafana/loki/assets/8354290/7566b755-8193-4e46-ba10-37d3377ea31a)


![image](https://github.com/grafana/loki/assets/8354290/d1990150-84b1-4522-9898-6e37c2782c5b)


![image](https://github.com/grafana/loki/assets/8354290/a8c23e7f-a06d-4a47-8cd4-e900fce01e80)


![image](https://github.com/grafana/loki/assets/8354290/d1e15fb6-fb6c-4fe1-9c5f-f1c8164889de)


![image](https://github.com/grafana/loki/assets/8354290/0c0d001e-7083-488c-8809-0446b4b7c852)

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",68,62,1,1,"2018-04-16 10:25:39","1872.18"
"grafana/loki","5def37d63d8a4279b9f26d4bc62bd04077e42814","periklis","2023-10-25 13:20:10","true","operator: Prepare community release v0.5.0 (#10996)",19,66,1,1,"2018-04-16 10:25:39","2015.37"
"grafana/loki","7b32efbda599b7ea279810ab72973975eb5a5ea2","ferdikurniawan","2020-08-14 11:10:41","true","fix dead link (#2506)",117,28,0,0,"2018-04-16 10:25:39","848.53"
"grafana/loki","017c0b4e03d6d5ea6ac827654b7fd4f967382ce6","tomwilkie","2018-04-17 11:28:50","false","Get parser working.",0,0,0,0,"2018-04-16 10:25:39","1.04"
"grafana/loki","75ce97fe04a852b8e914dfa2af4a183a0442be78","tomwilkie","2018-04-17 11:02:52","false","Add basic parser for labels and matchers.",0,0,0,0,"2018-04-16 10:25:39","1.03"
"grafana/loki","eb33e810c97f78604a2d252b110b16c9f710e219","briangann","2019-07-15 17:13:03","false","cleanup rake warnings, bump version",98,15,0,0,"2018-04-16 10:25:39","454.53"
"grafana/loki","c4bddc73ab3b7b2b98bb02f69a589a76d855fea0","davkal","2019-04-02 08:54:30","false","gitignore logcli",96,11,0,0,"2018-04-16 10:25:39","345.94"
"grafana/loki","0fa98d81caf26e0df263ad7afadf0afada0d937a","wardbekker","2020-07-28 12:47:27","true","Template: Added a sha256 template function for obfuscating / anonymize PII data in e.g. the replace stage (#2422)

* Added sha256 template method

* updated hash result

* Add replace with hashing example

* use static hash function",126,27,0,0,"2018-04-16 10:25:39","832.6"
"grafana/loki","39ac2e58ad77deb2561caa0c781c3a8db6392a8c","sandeepsukhani","2021-07-08 09:56:31","true","fix a panic in compactor when retention is not enabled (#3967)",124,39,0,1,"2018-04-16 10:25:39","1177.73"
"grafana/loki","ae3e49973e8f25a2e3308d048210c40784f90390","sandeepsukhani","2021-07-08 08:49:10","true","fix panic in compactor when retention is not enabled (#3966)",124,39,0,1,"2018-04-16 10:25:39","1177.68"
"grafana/loki","11a34fb48c241fe0641087982317187c7cc5bb6f","sandeepsukhani","2022-08-10 13:41:02","true","avoid creating multiple tenant heads in tsdb during a race (#6866)

It causes us to have same ref ids for different streams since the refid in each head starts with 1",77,52,0,1,"2018-04-16 10:25:39","1575.14"
"grafana/loki","d31f8676fd9f4dbb4f509514edbf598f2bd798ca","sandeepsukhani","2021-07-28 13:30:32","true","Optimize index queries and caching (#4070)

* Use RangeValuePrefix for building queries for Series IDs

* optimize index store queries and caching by not doing broad queries",109,39,0,1,"2018-04-16 10:25:39","1197.88"
"grafana/loki","527b658cc18ced3ed644544689aef239f432421c","MichelHollands","2022-07-01 13:05:44","true","logcli: add flag to read remote schema configs (#6539)

* Add flag to read remote schema

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Fix lint imports

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Trigger CI

* Trigger CI

* Addresss review comment

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",72,50,0,1,"2018-04-16 10:25:39","1536.11"
"grafana/loki","b0646e7156d1aae0f0428631f1bbc3a0e6597330","Aletor93","2021-08-29 17:11:18","true","fix: typo on loki-external-labels for labels (#4231)",128,40,0,0,"2018-04-16 10:25:39","1229.03"
"grafana/loki","da5378c927a9557a5ba0d19a833ecb796b14ad31","DylanGuedes","2022-10-21 18:13:38","true","Loki: Remove RatelimitedStream proto (#7235)

**What this PR does / why we need it**:
Remove an unused proto (RateLimitedStream). It was only used for an
older approach to deal with rate-limited streams but since we changed
approaches this isn't necessary anymore.",91,54,1,1,"2018-04-16 10:25:39","1646.32"
"grafana/loki","e71d33bbeed6ce4bf7fc10686ff7a6321f7ec089","kavirajk","2021-03-16 08:14:59","true","doc(gcplog): Add note on scraping multiple GCP projects (#3430)",154,35,0,1,"2018-04-16 10:25:39","1060.41"
"grafana/loki","6a92eb3f0701a922f332af2bdeb466cd2be267aa","oddlittlebird","2021-05-18 08:06:56","true","Update _index.md (#3723)",197,37,0,0,"2018-04-16 10:25:39","1127.65"
"grafana/loki","6dad54fef98231e1cf191718c789eab433f9a56d","cyriltovena","2022-02-25 07:02:36","true","Fixes ingester sample deduping (#5470)

* Fixes ingester sample deduping

* Call get hash only once

* Update pkg/iter/entry_iterator.go

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>",301,46,0,1,"2018-04-16 10:25:39","1404.61"
"grafana/loki","920a2d1c5288e6ae5616ca61487d0f45e34e2d7c","cstyan","2022-07-08 05:38:33","false","Don't add the memberlist label as a selector to services.

Signed-off-by: Callum Styan <callumstyan@gmail.com>",71,51,0,1,"2018-04-16 10:25:39","1542.8"
"grafana/loki","7530bf6defef24fc09edaeabdd77e753a95e1e10","owen-d","2020-08-05 18:25:06","true","avoid mutating config while parsing -config.file (#2392)

* avoid mutating config while parsing -config.file

* minimal config mutation test case

* logcli local query config file compat",123,28,0,1,"2018-04-16 10:25:39","839.83"
"grafana/loki","9a75c0e05bbd0a8c7223f0d6632398c928348244","chaudum","2023-02-07 10:59:43","true"," Fix flaky `TestMicroServicesDeleteRequest` integration test (#8436)

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",79,58,1,1,"2018-04-16 10:25:39","1752.02"
"grafana/loki","e1ee1890f0e1462c36e0f86f3c1035ee05c52fe5","oddlittlebird","2020-08-31 20:24:01","true","Update CODEOWNERS (#2579)",119,28,0,0,"2018-04-16 10:25:39","865.92"
"grafana/loki","50456f928c796a2f05e7ab9f86ca3cb335f9f866","slim-bean","2019-09-13 22:38:09","false","Revert ""Updated stream json objects to be more parse friendly (#1010)""

This reverts commit 6185d543",71,17,0,1,"2018-04-16 10:25:39","512.76"
"grafana/loki","fdf6208dd479c95777a82f29374acb26c0a0c51a","slim-bean","2020-06-03 19:12:46","true","Fix datasource and variable dropdown choices (#2162)",126,26,0,1,"2018-04-16 10:25:39","777.87"
"grafana/loki","2af3ca077e2c70110cda2c789fbcde8b90ab8048","owen-d","2022-02-03 17:39:26","true","Logql/parallel binop (#5317)

* adds justification for keeping Downstreamer parallelism

* loads binop legs in parallel

* increases downstreamer default concurrency

* astmapper spanlogger

* always clone expr during mapping to prevent mutability bugs

* Revert ""astmapper spanlogger""

This reverts commit 23f6b55c14faccaf659bf083995d7c39ed45c379.

* cleanup + use errgroup",277,45,0,1,"2018-04-16 10:25:39","1383.05"
"grafana/loki","f4cfd284a66d0b384e611ff8cbe0817e766b3e9b","DylanGuedes","2021-10-25 12:49:55","true","Docs: Move rule storages configs to their own sections (#4493)

* Move rule storages configs to their own sections.

- Create new docs sections `azure_storage_config`, `gcs_storage_config`,
  `s3_storage_config`, and `swift_storage_config` with the docs configs from
`ruler_config[""storage""]`
- Reference the new sections in the existing `ruler_config` section
- Add missing periods at `ruler_config` configs

* Update storages to have a CLI flag prefix

- This way we can reuse these configs in different places (different from `-ruler.config`)",165,42,0,1,"2018-04-16 10:25:39","1284.85"
"grafana/loki","c90366dbe7fa3862d14760ef25537f8728b66158","sandeepsukhani","2021-06-01 15:19:32","true","just log a warning when a store type other than boltdb-shipper is detected when custom retention is enabled (#3785)

* just log a warning when a store type other than boltdb-shipper is detected when custom retention is enabled

* gofmt

* Update msg

Co-authored-by: Ed Welch <ed@oqqer.com>

Co-authored-by: Ed Welch <ed@oqqer.com>",204,37,0,1,"2018-04-16 10:25:39","1140.95"
"grafana/loki","8f4e12a5ec56cbbabaffd246c976cb0012f25967","gouthamve","2018-07-09 09:54:57","true","Chunking (#10)

* Add checkenc without serialisation for now.

Signed-off-by: Goutham Veeramachaneni <cs14btech11014@iith.ac.in>

* Simplify interface and add serialisatio`

Signed-off-by: Goutham Veeramachaneni <cs14btech11014@iith.ac.in>

* Move away from \xFF magic to something simple

Signed-off-by: Goutham Veeramachaneni <cs14btech11014@iith.ac.in>

* Add serialisation and Deserialisation

Signed-off-by: Goutham Veeramachaneni <cs14btech11014@iith.ac.in>

* Modify interface to be closer to logish interface.

Signed-off-by: Goutham Veeramachaneni <cs14btech11014@iith.ac.in>

* chunkenc: Fix race b/w append and iteration.

Signed-off-by: Goutham Veeramachaneni <cs14btech11014@iith.ac.in>

* chunkenc: Make iterators honour bounds

Signed-off-by: Goutham Veeramachaneni <cs14btech11014@iith.ac.in>

* chunkenc: Remove locks as safety is assured externally

Signed-off-by: Goutham Veeramachaneni <cs14btech11014@iith.ac.in>

* chunkenc: Add checksums

Signed-off-by: Goutham Veeramachaneni <cs14btech11014@iith.ac.in>

* Add code quotes around block design.

* Split headBlock into it's own type.

Signed-off-by: Goutham Veeramachaneni <cs14btech11014@iith.ac.in>

* Simplify encoding and decoding.

Signed-off-by: Goutham Veeramachaneni <cs14btech11014@iith.ac.in>

* Expose flags.

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>

* Use the already existing EntryIterator interface

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>

* Use existing Chunk interface.

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>

* Review feedback

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>

* Integrate the compressed chunk and add metrics

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>",5,3,0,0,"2018-04-16 10:25:39","82.98"
"grafana/loki","034e2a63cf2e245d21734c159a48aa3768fccbae","aknuds1","2021-08-27 15:46:13","true","Makefile: Add format target (#4226)

Signed-off-by: Arve Knudsen <arve.knudsen@gmail.com>",128,40,0,0,"2018-04-16 10:25:39","1226.97"
"grafana/loki","02ae366451bb216a66920d73a317cd00ad7e867f","owen-d","2023-09-18 16:13:38","true","tool for building bloom filters from log contents (#10594)

This adds a tool which builds scalable bloom filters from the contents
of logs themselves & records metrics.

---------

Signed-off-by: Owen Diehl <ow.diehl@gmail.com>",40,65,1,1,"2018-04-16 10:25:39","1978.49"
"grafana/loki","123e6f51fea866d3750330d867dbf0488adb285d","beorn7","2020-05-18 14:29:14","false","Keep scrape config in line with the new Prometheus scrape config

This is triggered by https://github.com/grafana/jsonnet-libs/pull/261 .

The above PR removes the `instance` label. As it has turned out (see
PR linked above), a sane `instance` label in Prometheus has to be
unique, and that includes the case where a single container exposes
metrics on two different endpoints. However, that scenario would still
only result in one log stream for Loki to scrape.

Therefore, Loki and Prometheus need to sync via target labels uniquely
identifying a container (rather than a metrics endpoint). Those labels
are namespace, pod, container, also added here.

This commit removes the `container_name` label. It is the same as the
`container` label and was already added to Loki previously. However,
the `container_name` label is deprecated and has disappeared in K8s
1.16, so that it will soon become useless for direct joining.",118,25,0,0,"2018-04-16 10:25:39","762.67"
"grafana/loki","94d1550e9cb60d35a175d1e186acdb70670d57bf","KMiller-Grafana","2022-01-04 08:48:39","true","Docs: improve Promtail installation prose (#5017)",253,44,0,0,"2018-04-16 10:25:39","1353.68"
"grafana/loki","37c0b3dec221f03b6b411980eac21b466873114a","MasslessParticle","2023-03-16 21:33:07","true","Allow math on errors (#8823)

Currently metric expressions will fail if they contain the parser error
label `__error__`. There are cases where you may want to count errors.
For example, `sum(count_over_time({foo=""bar""} | json | __error__=
""JSONParserErr"" [$__interval]))` to see how many of your logs are
unparsable JSON.

This pr uses `ParseHint` to determine whether the `__error__` label was
requested in the query and, if it was, do math on it like any other
query. Parse hints are only included in VectorAggregations so the label
used to signal whether or not to keep errors is never seen by a user.

All other operations remain unaffected",86,59,1,1,"2018-04-16 10:25:39","1791.46"
"grafana/loki","772b494e59df2cc986fa975cc86ce761eadeca97","trevorwhitney","2023-01-30 22:51:19","true","fix dashboard helper to use regex (#8319)",80,57,1,1,"2018-04-16 10:25:39","1745.52"
"grafana/loki","c370d9e795a37ba657845b94fe73d69ea35a0079","grafanabot","2023-10-16 14:32:51","true","[CI/CD] Update yaml file `./production/helm/loki/Chart.yaml` (+1 other) (#10914)

**Here is a summary of the updates contained in this PR:**
***
Update attribute `$.appVersion` in yaml file
`./production/helm/loki/Chart.yaml` to the following value: `2.9.2`
***
Bump version of Helm Chart
Add changelog entry to `./production/helm/loki/CHANGELOG.md`
Re-generate docs",24,66,1,0,"2018-04-16 10:25:39","2006.42"
"grafana/loki","94b9c4ba1602840f8d47a7ee568bee9dda5ea2d0","slim-bean","2019-10-24 14:54:47","true","Improve how we record file size metric to avoid a race in our file lagging alert (#1194)

* Update the filetarget sync() code to report size based on what the tailer reports for size (or read the file size from the file name if no tailer exists yet)
Update vendored (and forked) hpcloud tail library which includes a Size() function which reports size from the file handle and not file name

* needed to tidy?

* addressing code review comments",69,18,0,1,"2018-04-16 10:25:39","553.44"
"grafana/loki","391b9cea104b0e2c97203729595d41caca521a97","MichelHollands","2022-09-27 11:35:16","true","Logcli: load remote schema before validation (#7258)

The --remote-schema option didn't work as validation would be called
before the remote schema was loaded. An error about a missing schema
section is the result. This was tested by running against a remote
bucket containing a schemaconfig.yaml file with a local config file that
does not contain a schema config section.

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",88,53,1,1,"2018-04-16 10:25:39","1622.05"
"grafana/loki","a707ced67f40554ddb1c2c771064ac9bca9292cf","sandeepsukhani","2021-11-15 08:16:47","true","index cleanup fixes while applying retention (#4741)

* Add metric name to the label if missing for building index entries for deletion

* fix calculation of table interval from table name

* add changelog

* add test for series cleanup without __name__ label",194,43,0,1,"2018-04-16 10:25:39","1304.66"
"grafana/loki","7733be0658b79d5f0b7c70cdf8baa9d4e7a0ab23","wardbekker","2023-08-16 15:48:13","true","making clearer that TSDB is the new recommended index, and make expli… (#9246)

**What this PR does / why we need it**:

making clearer that TSDB is the new recommended index, and make explicit
that non TSDB and BoltDB shipper are deprecated and not recommended
Fixes #9105 

**Special notes for your reviewer**:

This needs to be changed in more places, but this is a start as it
concerns the main storage docs

**Checklist**
- [X] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [X] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

---------

Co-authored-by: Travis Patterson <masslessparticle@gmail.com>
Co-authored-by: J Stickler <julie.stickler@grafana.com>
Co-authored-by: Travis Patterson <travis.patterson@grafana.com>",53,64,1,0,"2018-04-16 10:25:39","1946.47"
"grafana/loki","9930f704467066f657d119cca9778b47bcc910dd","sandeepsukhani","2019-08-02 12:28:41","true","bigtable-backup: Tool for creating and managing periodic tables stored in Bigtable (#729)

* Tool for creating and managing periodic tables stored in Bigtable

It has 2 commands:
1. backup-active-periodic-table: For backing up active periodic table
2. ensure-backups: It helps ensure right tables are backed up and retain only single backup for non active periodic tables",106,15,0,1,"2018-04-16 10:25:39","471.34"
"grafana/loki","9e7ac3d853ac452f470fba0cd72df69cf6a0326b","sandeepsukhani","2022-12-19 09:14:19","true","fix query-frontend request load balancing when using k8s service (#7966)

**What this PR does / why we need it**:
We noticed an imbalance in the requests sent to the Query Frontend pods
using `query-frontend` k8s service. This seems to be caused by
`query-frontend` being a headless service that resolves to each QF pod
IP and leaves it up to the client to load balance the requests as
mentioned
[here](https://kubernetes.io/docs/concepts/services-networking/service/#headless-services).

This PR fixes the issue by creating two separate services for pod IP
discovery and load balancing of queries:
* `query-frontend` to be used for load balancing incoming Loki queries.
* `query-frontend-headless` to be used for discovering QF pod IPs from
queriers to connect as workers.

**Checklist**
- [x] `CHANGELOG.md` updated
- [x] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",96,56,1,1,"2018-04-16 10:25:39","1703.95"
"grafana/loki","65b539c2ab1c64f9507657cfd434bee13ee39245","sandeepsukhani","2020-09-16 06:54:39","true","add compactor details and other boltdb-shipper doc improvments (#2622)",118,29,0,1,"2018-04-16 10:25:39","880.35"
"grafana/loki","10d3fa0029b3efafd9fa1ad56e6aa23c023f5a7b","sandeepsukhani","2022-10-05 13:19:03","true","mmap tsdb index file while opening it for querying (#7338)

**What this PR does / why we need it**:
In PR #7321, we re-introduced mmap for reading tsdb index, but it does
not cover all the paths where we open the index. This PR takes care of
it.

I have also removed the code for decompressing the index file since we
always get a decompressed file from the `indexshipper`.",94,54,1,1,"2018-04-16 10:25:39","1630.12"
"grafana/loki","34a012adcfade43291de3a7670f53679ea06aefe","dannykopping","2021-11-25 12:27:45","true","Use common args in compactor and index-gateway (#4824)

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",217,43,0,1,"2018-04-16 10:25:39","1314.83"
"grafana/loki","b36f680f5844d95aa1a467b10d03b4e814f6607c","sandeepsukhani","2019-08-05 14:58:16","false","Added namespace to label value of job exported from bigtable backup cronjob",100,16,0,1,"2018-04-16 10:25:39","474.44"
"grafana/loki","e9001d87319ca91b999678d18777192231184009","MichelHollands","2020-12-14 15:57:11","true","Make the moduleManager field public (#3077)

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",121,32,0,1,"2018-04-16 10:25:39","968.73"
"grafana/loki","77d01566dab1d2918a4aacfe000134f20b7b64c5","blockloop","2021-03-17 16:13:35","true","fix memberlist resolution",159,35,0,0,"2018-04-16 10:25:39","1061.74"
"grafana/loki","f79f2e8e75b2eab7160b83d39acf1f11f793ab71","cyriltovena","2020-07-28 12:29:08","true","Add logstash to clients page with FrontMatter. (#2418)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",126,27,0,1,"2018-04-16 10:25:39","832.59"
"grafana/loki","d6a60b4a9f7d29bba1900b25eeadc35bbd5c858f","nervo","2023-01-24 23:27:37","true","Helm: Default grafana dashboard label (#8188)",86,57,1,0,"2018-04-16 10:25:39","1739.54"
"grafana/loki","20db4df542a10bef2f32a4bdb5487465a4ec6bb7","MichelHollands","2022-06-15 12:14:39","true","Add more logging for delete requests (#6394)

* Add more logging for delete requests

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Fix typo

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Rephrase logging message and add chunk ID

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Rename userID field to user

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* rename more userID

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Fix existing log messages

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",67,50,0,1,"2018-04-16 10:25:39","1520.08"
"grafana/loki","f2eb2eefec2aa4c573e01c773b473b1543e0f481","slim-bean","2021-08-10 21:33:39","true","Updating changelog, release notes and references to the previous release version. (#4112)",113,40,0,1,"2018-04-16 10:25:39","1210.21"
"grafana/loki","430e9534e7e691aab3355483afdbace0841040dc","daixiang0","2018-12-15 02:48:26","false","state loki entrance

Signed-off-by: Xiang Dai <764524258@qq.com>",31,8,0,0,"2018-04-16 10:25:39","238.68"
"grafana/loki","9e6afea5f6353212f403768e2de5174a2364fdea","Falco20019","2020-10-01 18:38:28","true","Fix timestamp parser for short year format (#2708)",117,29,0,0,"2018-04-16 10:25:39","895.84"
"grafana/loki","98d1307c7dd7df9b2d434d09568819325b60132b","ashwanthgoli","2023-06-09 07:16:38","true","config: ensure storage config defaults apply to named stores (#9650)

**What this PR does / why we need it**:
Since named store config does not register any flags, storage configs
defined under it do not get the defaults.
For example
[aws_storage_config](https://grafana.com/docs/loki/latest/configuration/#aws_storage_config)
sets the default `storage_class` to `STANDARD`, but the same doesn't get
applied by default when using named stores.

This PR ensures that named storage configs are always assigned default
values when they are unmarshalled by implementing `yaml.Unmarshaler`
interface",69,62,1,0,"2018-04-16 10:25:39","1879.12"
"grafana/loki","c17da74ef81661b46ee269ca68b38f3660002fba","sh0rez","2020-08-13 19:35:28","true","doc: close code block (#2505)",119,28,0,0,"2018-04-16 10:25:39","847.88"
"grafana/loki","dedb585bb5dcf64d5a700f126860d54a924d0722","sh0rez","2019-08-05 17:23:28","false","docs: general documentation rework

- restructures the docs to make them easier to explore
- rewrites promtail docs
- unifies, shortens and extends docs",100,16,0,0,"2018-04-16 10:25:39","474.54"
"grafana/loki","db03ae2751da5c0262dd78b6ec7173a07dd990f8","owen-d","2023-01-26 18:05:17","true","retry+backoff querier->qf response (#8285)",83,57,1,1,"2018-04-16 10:25:39","1741.32"
"grafana/loki","1a41682bb0d5d227906f41af2c732edc53fb83b2","periklis","2022-09-07 11:56:14","true","Fix internal server initialization (#7085)",82,53,1,1,"2018-04-16 10:25:39","1602.06"
"grafana/loki","093fe91ce92e0dcc86d977d072cb6ebf7c6eb5d8","foutrelis","2022-05-02 08:20:24","true","Bump inet.af/netaddr for Go 1.18 compatibility (#5872)

Fixes panic caused by outdated go4.org/unsafe/assume-no-moving-gc. [1]

[1] assume-no-moving-gc commit 538ce61f45ea5c2c48d7133d44b3e52c3db5c31e",78,49,0,0,"2018-04-16 10:25:39","1476.91"
"grafana/loki","6f78ffe33cf8f0d6534db5fe8acd663d790e9020","liguozhong","2021-08-31 08:14:17","true","[fix] distributor: fix goroutine leak (#4238)

Signed-off-by: fuling <fuling.lgz@alibaba-inc.com>",130,40,0,1,"2018-04-16 10:25:39","1230.66"
"grafana/loki","02c67bf879689c438c508b4637c67378ac29e784","eranra","2021-08-26 06:13:16","true","fix manifests and mutate function (#72)",127,40,0,0,"2018-04-16 10:25:39","1225.57"
"grafana/loki","0c6b4dc8c974eb57da9b3a6e5b472020042e8e6e","dannykopping","2021-07-26 19:44:46","true","Ruler: implementing write relabelling on recording rule samples (#4048)

* Implementing write relabelling

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Appeasing the linter

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Appeasing the linter

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",103,39,0,1,"2018-04-16 10:25:39","1196.14"
"grafana/loki","527ba6093b2181bfef7f97724963c38fab04f123","kavirajk","2021-02-11 08:20:01","true","docs(fix): Make best practices docs look better (#3316)",132,34,0,1,"2018-04-16 10:25:39","1025.41"
"grafana/loki","628c1fae95b5b9be6403e72e434664e329861a15","rfratto","2021-01-15 17:01:53","true","pass a prometheus registerer to promtail components (#3175)

Signed-off-by: Robert Fratto <robertfratto@gmail.com>",120,33,0,1,"2018-04-16 10:25:39","999.78"
"grafana/loki","8de2bc6b3d9a9e2d2f928d9717f1921feaddb27a","terjesannum","2020-01-08 07:39:28","false","docs: fix broken promtail link",103,21,0,0,"2018-04-16 10:25:39","627.13"
"grafana/loki","d31577faba583efde6b9824113779302008cfcee","cyriltovena","2019-07-19 14:34:13","true","adjust old instructions for troubleshooting docker daemon (#785)",102,15,0,1,"2018-04-16 10:25:39","458.42"
"grafana/loki","5143aca4db40cfeac58cebb1ff2507574e780eaa","granular-ryanbonham","2019-03-08 16:28:34","false","Set defaults for minReadySeconds and terminationGracePeriodSeconds and removed if statements.",91,11,0,0,"2018-04-16 10:25:39","322.25"
"grafana/loki","98551ceb9aca19f2914a96d9b3493b692456c1ce","ashwanthgoli","2023-10-12 11:57:15","true","use go 1.21.3 and go-grpc v1.56.3 (#10869)

**What this PR does / why we need it**:
Fixes CVE-2023-39325 / CVE-2023-44487


https://github.com/grpc/grpc-go/releases/tag/v1.56.3


**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",26,66,1,0,"2018-04-16 10:25:39","2002.31"
"grafana/loki","2e496ddff2c70e1c6fbc7279cabfa230bbbd5919","DylanGuedes","2022-12-05 15:34:03","true","Loki: Add one additional bucket to `rate_store_stream_shards` (#7856)

**What this PR does / why we need it**:
Add one additional bucket (value=1) to the `rate_store_stream_shards`.
By jumping from 0 to 2 we can't distinguish between streams that were
minimally sharded (shards=2) to non-sharded ones (shards=1).",96,56,1,1,"2018-04-16 10:25:39","1690.21"
"grafana/loki","8162f0d7964842ff0ebc0f84d152c4ec577f5263","kavirajk","2022-09-07 15:48:23","true","doc: Clarity on querier remapping when shuffle sharding is disabled (#7026)",85,53,1,1,"2018-04-16 10:25:39","1602.22"
"grafana/loki","f975a5dd2fb72163c0aafe571ab17de47669c490","blockloop","2021-04-14 21:01:43","true","Add the scaffolding for tshirt sizing (#21)",157,36,0,0,"2018-04-16 10:25:39","1088.94"
"grafana/loki","70ff8c5ae8ea4c358de76fc97950469c5452163e","davkal","2019-03-29 16:29:01","false","Rewrote prom config paragraph",93,11,0,0,"2018-04-16 10:25:39","343.25"
"grafana/loki","330d1a6fc0788318ac45bbb0831c522a6b1abfdc","polar3130","2019-09-16 12:47:22","false","Fix a link to correct doc and fix a typo (#1014)

* fix typo

* Fix a link to correct doc",69,17,0,0,"2018-04-16 10:25:39","515.35"
"grafana/loki","21b901db9ba99960fef4c288eb5dceec7b56da42","slim-bean","2021-04-03 11:34:52","true","Loki: Distributor log message bodySize should always reflect the compressed size (#3572)",148,35,0,1,"2018-04-16 10:25:39","1077.55"
"grafana/loki","3f5c73747bcc2186425c7c86147eeba5dd3652a1","trevorwhitney","2023-04-04 16:13:08","true","add 2.8 release date (#9015)

**What this PR does / why we need it**:

Fills out the date for the 2.8 release",81,59,1,1,"2018-04-16 10:25:39","1809.24"
"grafana/loki","7208caf2b9ad9eb57738fd6b00f413d86b0b4348","trevorwhitney","2021-09-15 17:40:08","true","Feature: allow querier and query frontend targets to run on same process (#4301)

* allow querier and query frontend to both the registered in same process

Signed-off-by: Trevor Whitney <trevorjwhitney@gmail.com>

* rename QuerierWorkerService to WorkerService

Signed-off-by: Trevor Whitney <trevorjwhitney@gmail.com>

* add debug log for standalone evaluation

Signed-off-by: Trevor Whitney <trevorjwhitney@gmail.com>

* inline generation of querier.WorkerServiceConfig

Co-authored-by: Ed Welch <edward.welch@grafana.com>

* Clarify auth middleware test, inline config gen

* Fix typo

Signed-off-by: Trevor Whitney <trevorjwhitney@gmail.com>

* reconcile go mod with HEAD of main

Signed-off-by: Trevor Whitney <trevorjwhitney@gmail.com>

Co-authored-by: Ed Welch <edward.welch@grafana.com>",139,41,0,1,"2018-04-16 10:25:39","1245.05"
"grafana/loki","68bf5434f7ac01a47976770613cfa05dde0456bf","davkal","2019-03-07 13:29:30","true","Merge pull request #350 from daixiang0/add-doc

Update logcli doc",88,11,0,0,"2018-04-16 10:25:39","321.13"
"grafana/loki","8b669ff6516133aca7061f15a2bea80cf4f8a352","shwetaap","2023-04-03 20:06:33","true","operator: Enhancement Proposal for Zone Aware Replication (#8381)

Signed-off-by: Shweta Padubidri <spadubid@redhat.com>",81,59,1,0,"2018-04-16 10:25:39","1808.4"
"grafana/loki","97788abcc510f9e1fb47469dd2eb08f083dab621","SerialVelocity","2020-04-23 18:29:45","true","[Loki]: Cleanup dockerfile (#1949)

* Reduce the amount of layers and data in the Dockerfile

* Change the loki user and data directory to match the default helm configuration

* Add an nsswitch.conf to stop localhost DNS requests

* Copy changes to Dockerfile.cross except setep

setep is probably not needed anymore due to 3100 being the default
port. Also, I'm not sure the amd64 binary works on other arch
binaries.

* Install ca-certificates earlier and split creating user and creating dir steps

* Install libcap earlier and don't bother deleting it as it doesn't make the image smaller

* Revert config changes

* Revert the dockerfile changes needed for the config revert",116,24,0,0,"2018-04-16 10:25:39","737.84"
"grafana/loki","d1fd6b78832e2c4dff1e0adf7bcf1b884ca7c251","rissson","2023-05-26 17:02:14","true","helm: gateway: also listen on IPv6 (#9510)

**What this PR does / why we need it**:

Currently the gateway only listens on IPv4. On IPv6-only clusters, this
causes the readiness probe to fail, rendering the gateway unusable.

**Which issue(s) this PR fixes**:
No issue created

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [x] `CHANGELOG.md` updated
- [x] N/A Changes that require user attention or interaction to upgrade
are documented in `docs/sources/upgrading/_index.md`

Signed-off-by: Marc 'risson' Schmitt <marc.schmitt@risson.space>",67,61,1,0,"2018-04-16 10:25:39","1866.53"
"grafana/loki","14f96c0c7b72ad52c965bc61d36c6327c4cfa385","jkroepke","2023-06-14 07:42:50","true","Add loki.memberlistConfig to fully control the memberlist configuration (#9646)

**What this PR does / why we need it**:

Add loki.memberlistConfig to fully control the memberlist configuration

On singleBinary with replica 1, memberlist isn't need and its
counter-productive since it delays the start of the loki binary. At the
moment, it isn't possible to remove the memberlist defaults.

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [ ] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [x] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",67,62,1,0,"2018-04-16 10:25:39","1884.14"
"grafana/loki","2b7f375a21457c5f412f1b13e571a3e3968146cb","cyriltovena","2019-12-05 17:30:15","true","Fixes fluentd new push path API. (#1363)

* Update fluentd to support the new v1 push API.

- also add tests for ordering.
- improve nanoseconds precision.
- fixes all lint/style issue.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Bump the gem and add myself as author.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",93,20,0,1,"2018-04-16 10:25:39","594.54"
"grafana/loki","20af4e44fea9f528e312f77f7dc706cc08108286","gouthamve","2018-12-10 16:42:05","false","Make binaries actually static (#53)

https://github.com/grafana/loki/pull/49 broke promtail with
standard_init_linux.go:178: exec user process caused ""no such file or directory""

From https://medium.com/@diogok/on-golang-static-binaries-cross-compiling-and-plugins-1aed33499671
CGO_ENABLED=0 makes it static, afaics

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>",11,8,0,0,"2018-04-16 10:25:39","234.26"
"grafana/loki","4635769b4f00bb7419cc5148d31a42c8d5bc4dfc","tomwilkie","2018-11-20 14:46:48","false","Don't register variables twice.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",5,7,0,0,"2018-04-16 10:25:39","214.18"
"grafana/loki","3f28a33d93806977f26e788048f9d96a4af52cb2","owen-d","2022-03-17 18:02:41","true","TSDB Index reuses slices, adds pools (#5630)

* adds a pool for ChunkMetas

* index takes slice pointers for allocation reasons and adds pools for all index types

* reuse slices in tsdb benchmarks

* adds count to bench script

* properly returns series to pool

* more ergonomic index signatures while still supporting slice reuse

* tsdb index documentation

* aligns tsdb-map tooling with new index signatures",308,47,0,1,"2018-04-16 10:25:39","1427.07"
"grafana/loki","d34b1f74508076f55b3b1aed78ad9b9fc3d02140","rfratto","2019-07-22 17:49:20","false","ingester: support chunk transfers on ingester shutdown.

This commit introduces chunk transfers, borrowing the mechanism from
Cortex's implementation: when an ingester is shut down with claim
on rollout enabled, the ingester will find a pending ingester and
transfer all of its chunks to it.",103,15,0,1,"2018-04-16 10:25:39","461.56"
"grafana/loki","ae2a6f31ae23d2ec33b01b0dcd2bfd0e57a125a5","trevorwhitney","2022-10-21 22:02:20","true","[Helm] Add flags needed for migration from distributed (#7331)

**What this PR does / why we need it**:
Adds flags to the helm charts that are needed when doing a zero-downtime
migration from a `loki-distributed` helm chart deployment. The flags
allow for an additional memberlist join member to be specified. This
allows the new `grafana/loki` cluster to join the old
`grafana/loki-distributed` cluster, forming one big cluster. The
ingesters in the `grafana/loki-distributed` cluster can then be taken
down 1-by-1, allowing the whole `grafana/loki-distributed` cluster to be
deleted once all the ingesters have scaled down.

**Which issue(s) this PR fixes**:
Fixes #7330

Co-authored-by: Karsten Jeschkies <k@jeschkies.xyz>",91,54,1,1,"2018-04-16 10:25:39","1646.48"
"grafana/loki","5729d88302942eb15148cc22e72aa41206d6377e","owen-d","2020-09-23 20:30:52","true","exposes rule group validation fn (#2662)",114,29,0,1,"2018-04-16 10:25:39","887.92"
"grafana/loki","6205b962d072c2ff8e0b4ff8db97e10f42b8086a","periklis","2022-06-10 11:41:15","true","operator: Allow reduced tenant OIDC authentication requirements (#6362)",71,50,0,1,"2018-04-16 10:25:39","1515.05"
"grafana/loki","45775c82f79eb52acad7dcb0bc5aa269d6bf4ec5","salvacorts","2023-03-29 10:32:29","true","Implement `RequiredNumberLabels` query limit (#8918)

**What this PR does / why we need it**:
As pointed out in https://github.com/grafana/loki/pull/8851, some
queries can impose a great workload on a cluster by selecting too many
streams.

Similarly to the `RequiredLabels` limit introduced at
https://github.com/grafana/loki/pull/8851, here we add a new limit
`RequiredNumberLabels` to require queries to specify at least N label.
For example, if the limit is set to 2, then the query should contain at
least 2 label matchers.

This limit can be configured per tenant and at query time.


![image](https://user-images.githubusercontent.com/8354290/228271398-4b9bcc49-f539-4e94-86c1-071e519a30a9.png)

**Which issue(s) this PR fixes**:
Fixes https://github.com/grafana/loki-private/issues/699

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [x] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

---------

Co-authored-by: Dylan Guedes <djmgguedes@gmail.com>",85,59,1,1,"2018-04-16 10:25:39","1804"
"grafana/loki","58f81176182782174da009a084b676718d8188e6","cyriltovena","2020-11-17 13:36:16","true","Skip journald bad message. (#2928)

Unfortunatelly I can't show the message itself without forking the library
we are using.

Fixes #2812.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",122,31,0,1,"2018-04-16 10:25:39","941.63"
"grafana/loki","c4d3f72191f527dcc12fc6482ad56f9e3135acce","cyriltovena","2021-02-18 13:35:33","true","Fixes tightloop that could happen in the engine with LogQL parser. (#3347)

I've also added a test to prove the issue was happening and now is fixed.

Fixes #3275
Fixes #3264
Fixes #3020

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",132,34,0,1,"2018-04-16 10:25:39","1032.63"
"grafana/loki","0182f845e8c59cfe46e26dbd2b9ed623d59bf812","tomwilkie","2018-11-19 21:06:45","false","Make it a single binary.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",5,7,0,0,"2018-04-16 10:25:39","213.45"
"grafana/loki","b2d8d15202cad15a7d56cb24abfdaa95aace5c2c","tomwilkie","2019-02-05 18:13:23","false","Put chunk_idle_period in the right place in the ksonnet.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",80,10,0,0,"2018-04-16 10:25:39","289.32"
"grafana/loki","a8a861b21a0f8a453288bcb20fa2aec4119540ea","owen-d","2021-07-26 14:02:14","true","adds query-frontend service hints for k8s, adapted from jsonnet (#4045)",103,39,0,1,"2018-04-16 10:25:39","1195.9"
"grafana/loki","e80b4deb438e704ec4b7c22bbee05bd30b009100","chodges15","2022-11-28 10:40:57","true","Promtail: Add tenant label to client drop metrics and logs (#7593)

**What this PR does / why we need it**:
Provides better visibility for per-tenant drops/retries in Promtail

**Which issue(s) this PR fixes**:
Fixes #7570 

**Special notes for your reviewer**:
Does anything depend on these metrics only having 1 label that this
change would break? I decided against a reason label due to cardinality
concerns given how widely promtail is often deployed.

**Checklist**
- [x] Reviewed the `CONTRIBUTING.md` guide
- [x] Documentation added
- [x] Tests updated
- [x] `CHANGELOG.md` updated
- [x] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",98,55,1,0,"2018-04-16 10:25:39","1683.01"
"grafana/loki","0e0d0b78977f5e1b4d3889bc33c0d1a716eeb0d9","owen-d","2021-11-03 16:53:39","true","dont try to use the scheduler ring when a downstream url is configured (#4635)",170,42,0,1,"2018-04-16 10:25:39","1293.02"
"grafana/loki","9c47b3084ecc4dfbc5caa51cdefed29d583f82a9","trevorwhitney","2022-09-07 08:30:37","true","Add prefix for helm-release tags (#7073)

**What this PR does / why we need it**:

The helm release job creates a tag for each new release. The tags was
previously `<chart name>-<chart version>`, which in the case of the loki
chart in this repo was `loki-3.0.0`. This is confusing, so we are adding
the prefix `helm-` to these tags.",84,53,1,1,"2018-04-16 10:25:39","1601.92"
"grafana/loki","97d34ea5af8ecfe4b77a8b62ca0e31f182102376","shwetaap","2023-07-17 07:26:24","true","operator: Gateway pods do not need to have INSTANCE_AVAILABILITY_ZONE env set in their containers (#9950)",59,63,1,0,"2018-04-16 10:25:39","1917.13"
"grafana/loki","895e95c4fc5782dcd817c269a6324a51bccdb1c4","xperimental","2022-10-17 11:28:42","true","operator: Regenerate manifests (#7438)",90,54,1,1,"2018-04-16 10:25:39","1642.04"
"grafana/loki","4b8eda64f5a978c8d40d91b1ce1fe1b3799340d5","slim-bean","2019-04-17 13:20:00","false","PR feedback",103,12,0,1,"2018-04-16 10:25:39","366.37"
"grafana/loki","a6d8bf03a0910ed9bdbbadd44f9c77cf715b2ce8","davkal","2019-03-18 20:05:32","true","Merge pull request #379 from nicknezis/feature/dockerRoot

Made the docker root configurable. Default is '/var/lib/docker'",102,11,0,0,"2018-04-16 10:25:39","332.4"
"grafana/loki","af23e36bc7eefb127d6241bb3e23750422d954a0","blockloop","2021-03-04 20:22:53","true","init",141,34,0,0,"2018-04-16 10:25:39","1048.91"
"grafana/loki","5b9de9472207945d1919af977ac44f7baabc111f","ngc4579","2023-10-04 15:16:07","true","Helm: allow GrafanaAgent tolerations (#10613)

**What this PR does / why we need it**:
Helm: Allow setting tolerations for GrafanaAgent pods in order to have
them scheduled to tainted nodes as well.

**Which issue(s) this PR fixes**:
Fixes #10575

**Special notes for your reviewer**:
n/a

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [ ] Tests updated
- [x] `CHANGELOG.md` updated
- [x] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [x] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

---------

Co-authored-by: J Stickler <julie.stickler@grafana.com>
Co-authored-by: Michel Hollands <42814411+MichelHollands@users.noreply.github.com>",28,66,1,0,"2018-04-16 10:25:39","1994.45"
"grafana/loki","cd1537d06ed1010fd5612de85a3764775b0b25d4","sandeepsukhani","2022-01-24 12:00:38","true","step align start and end time of the original query while splitting it (#5217)

* step align start and end time of the original query while splitting it

* also step align queries with step > split interval",273,45,0,1,"2018-04-16 10:25:39","1373.82"
"grafana/loki","04f58c880f735eb9d72205dcc7593acfdd454a6f","pracucci","2019-11-07 12:02:23","false","promtail: add multi-tenant support (#1135)

* promtail: added tenant_id support to promtail client

* promtail: added tenant stage to dinamically override the tenant ID

* promtail: documented client's batch struct and improved tenant stage config pointer usage

* Added static value support to tenant stage",67,19,0,0,"2018-04-16 10:25:39","566.32"
"grafana/loki","69d732b4d0642ca174f02d11335942a36e8372c0","cyriltovena","2019-05-15 19:58:29","false","move custom metrics to /metrics and prefix them",100,13,0,1,"2018-04-16 10:25:39","394.65"
"grafana/loki","df4461d712b8a101006f4a0345a8f7cff0e45f91","salvacorts","2022-09-19 12:05:25","true","Evenly spread memcached across nodes (#7183)

<!--  Thanks for sending a pull request!  Before submitting:

1. Read our CONTRIBUTING.md guide
2. Name your PR as `<Feature Area>: Describe your change`.
a. Do not end the title with punctuation. It will be added in the
changelog.
b. Start with an imperative verb. Example: Fix the latency between
System A and System B.
  c. Use sentence case, not title case.
d. Use a complete phrase or sentence. The PR title will appear in a
changelog, so help other people understand what your change will be.
3. Rebase your PR if it gets out of sync with main
-->

**What this PR does / why we need it**:
This PR enables the
[TopologySpreadConstraints](https://kubernetes.io/docs/concepts/scheduling-eviction/topology-spread-constraints/)
for Memcached chunks cache introduced at
https://github.com/grafana/jsonnet-libs/pull/832.
Now the chunks cache will be evenly spread across nodes but more than
one cache can run on the same node.



**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

<!--
Note about CHANGELOG entries, if a change adds:
* an important feature
* fixes an issue present in a previous release, 
* causes a change in operation that would be useful for an operator of
Loki to know
then please add a CHANGELOG entry.

For documentation changes, build changes, simple fixes etc please skip
this step. We are attempting to curate a changelog of the most relevant
and important changes to be easier to ingest by end users of Loki.

Note about the upgrade guide, if this changes:
* default configuration values
* metric names or label names
* changes existing log lines such as the metrics.go query output line
* configuration parameters 
* anything to do with any API
* any other change that would require special attention or extra steps
to upgrade
Please document clearly what changed AND what needs to be done in the
upgrade guide.
-->
**Checklist**
- [ ] Documentation added
- [ ] Tests updated
- [ ] Is this an important fix or new feature? Add an entry in the
`CHANGELOG.md`.
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",87,53,1,1,"2018-04-16 10:25:39","1614.07"
"grafana/loki","0313f8648f561fdd7fffb2ae142e1f4163148aa7","KMiller-Grafana","2022-08-03 04:02:23","true","Change existing labeler action to use type/docs label (#6754)",76,52,0,0,"2018-04-16 10:25:39","1567.73"
"grafana/loki","0f6981a130ace0240d745d89d0c1fdd9bba9aa9c","tomwilkie","2018-12-18 15:31:47","true","Fix typo",36,8,0,0,"2018-04-16 10:25:39","242.21"
"grafana/loki","ebc13669c0a33dca2f80a634ebb5539055706052","Red-GV","2022-07-28 12:44:54","true","operator: Changing channel to stable (#6795)",77,51,0,1,"2018-04-16 10:25:39","1563.1"
"grafana/loki","415a997fb989fc7abdc4f4a2593bd2f703cfbaed","wz2b","2023-06-07 15:25:10","true","Update CONTRIBUTING.md to point to the new location of the contributi… (#9654)

**What this PR does / why we need it**:
Updating CONTRIBUTING document to point to the location of the LID
template, which has moved

**Which issue(s) this PR fixes**:
none

**Special notes for your reviewer**:
doc change only

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",68,62,1,0,"2018-04-16 10:25:39","1877.46"
"grafana/loki","6e217c6aa18e5cbdf4cb6d71098d0f2d91afe29b","xperimental","2022-11-29 23:27:01","true","operator: Fix alert unit tests (#7812)

**What this PR does / why we need it**:

Fixes the Prometheus alert tests broken by #7809 

**Checklist**

- [x] Reviewed the `CONTRIBUTING.md` guide
- [x] Tests updated",95,55,1,1,"2018-04-16 10:25:39","1684.54"
"grafana/loki","8c84ee8b7a4a8dedc7ab8d205d27682aa323146a","MasslessParticle","2022-10-12 15:54:56","true","Fix stream sharding (#7393)

Promtail doesn't add a stream hash to push requests. As a result, we
weren't accounting for the current rate in our sharding calculation and
only sharding on individual large pushes.

This PR ensures that streams have a hash as they're ingested. It also
add a couple of metrics that were useful in debugging this issue.",91,54,1,1,"2018-04-16 10:25:39","1637.23"
"grafana/loki","b23687ad963368be4d7f748e5db2bb3df7838d7a","sandeepsukhani","2022-10-04 03:51:49","true","update regex for matching nlb logs while using lambda promtail (#7305)

**What this PR does / why we need it**:
Regex in lambda promtail looks for specific file patterns for reading
and pushing logs from it.
It currently does not read logs generated by nlb i.e having `_net` in
the name. This PR updates the regex.
Cross checked it with was docs here
https://docs.aws.amazon.com/elasticloadbalancing/latest/network/load-balancer-access-logs.html",92,54,1,1,"2018-04-16 10:25:39","1628.73"
"grafana/loki","ec5bc7054d704740a13daf154efb29ad7e75bee1","sandeepsukhani","2019-09-23 05:55:21","true","limits: limits implementation for loki (#948)

* limits implementation for loki

Added following new limits:

Length of query
Number of active streams
Number of streams matcher per query
Ingestion rate

* periodically reload ingestion rate limits to apply latest rates from overrides",68,17,0,1,"2018-04-16 10:25:39","522.06"
"grafana/loki","9ffd30455d244049151995a8e2c7bf1bf3418c24","tomwilkie","2018-11-22 15:03:13","false","Update cortex vendor to grafana/cortex:yaml.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",5,7,0,0,"2018-04-16 10:25:39","216.19"
"grafana/loki","4ccf43a7644dd6c8efd06c11cbe566657f28ada7","vlad-diachenko","2022-07-18 11:24:41","true","updated versions to the latest release v2.6.1 (#6705)",69,51,0,0,"2018-04-16 10:25:39","1553.04"
"grafana/loki","aad436b7999ec0a7f1e6da777522e76b89895ec5","andrebossi","2023-05-30 15:25:56","true","Helm: Fix single binary checksum annotation for config.yaml (#9546)

**What this PR does / why we need it**:
This PR fix name to config checksum annotation

**Which issue(s) this PR fixes**:
Fixes #9545

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [x] Tests updated
- [x] `CHANGELOG.md` updated
- [x] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [x] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",69,61,1,0,"2018-04-16 10:25:39","1870.46"
"grafana/loki","6d495a393e8f08396c807f92c10becf75e7d9dd2","jeschkies","2022-10-10 08:25:15","true","Import Canary dashboard into Loki mixin. (#7304)

Summary:
This imports our canary into the Loki mixin so it can be used by the
Helm chart. The dashboard is disabled by default. It can be enabled by
setting

```jsonnet
{
  _config+:: {
    canary+: {
      enabled: true,
    },
  },
}
```

Co-authored-by: Vladyslav Diachenko <82767850+vlad-diachenko@users.noreply.github.com>",95,54,1,1,"2018-04-16 10:25:39","1634.92"
"grafana/loki","862cfa4e1f9de6b7b31a9e66af955ae948d1eb3b","owen-d","2021-02-15 23:30:07","true","adds Start() method to WAL interface to delay checkpointing until after replay (#3339)",132,34,0,1,"2018-04-16 10:25:39","1030.04"
"grafana/loki","6dc8bee9b000c9ac1895253eb9a30c9f337d7ddb","owen-d","2021-01-08 15:25:38","true","ingester/shutdown -> ingester/flush_shutdown (#3146)",117,33,0,1,"2018-04-16 10:25:39","992.71"
"grafana/loki","31981bd4af819717e196c82221a839d2df6f2ac4","chaudum","2023-08-29 15:32:47","true","Remove dependency on Bigchunk, which is a leftover of Cortex and is only used in tests (#10354)

**What this PR does / why we need it**:

This PR removes the dependency on ""Bigchunk"", which is a ""default"" implementation of the `chunk.Data` interface and used only in tests.

**Special notes for your reviewer**:

The PR replaces the usage of this chunk type with the Loki implementation (`chunkenc.MemChunk` wrapped into `chunkenc.Facade`) where possible. In case where it was not possible (tests in `pkg/storage/chunk` package) due to otherwise circular import, it was replaces by the `chunk.dummyChunk` implementation, which is just a no-op that implements `chunk.Data` interface)

The PR also removes the protos for the ingester client (`pkg/ingester/client/ingester.proto`) which were only referenced in the removed `pkg/util/chunkcompat/compat.go` file.

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",48,64,1,1,"2018-04-16 10:25:39","1959.46"
"grafana/loki","59a34f9867ce4c128f45c0e5b498c9cbfad3e619","kavirajk","2021-02-05 13:07:58","true","Make incoming labels from gcp into Loki internal labels. (#3285)

* Make incoming labels from gcp into Loki internal labels.

If these labels are significant, we can always use relabeling.

* Add support for rebeling in gcptarget

* Test for SnakeCase",127,33,0,1,"2018-04-16 10:25:39","1019.61"
"grafana/loki","122313caf777bde68ff90987d42e3e28031b9104","DylanGuedes","2023-07-26 10:50:23","true","Remove redundant spans (#10055)

**What this PR does / why we need it**:
- Stop using `instrument.CollectedRequest` on all Index calls since it
emits spans that are redundant with existing ones and aren't improving
Loki's monitoring while making it more expensive to run
- Add events to `QuerySample` to improve its monitoring so we can better
track what is holding down its performance
- Remove redundant `Ingester.GetChunkRef` span",53,63,1,1,"2018-04-16 10:25:39","1926.27"
"grafana/loki","e713a8d83a8d9191aa7bdd3af13577a446ad953e","adityacs","2020-04-03 16:15:58","true","Fix flaky promtail test (#1865)",120,23,0,1,"2018-04-16 10:25:39","712.49"
"grafana/loki","1a867049cae8417af848c78d6e19d961ff99583d","tomwilkie","2018-05-14 13:03:45","true","Merge pull request #5 from grafana/promtail

Move promtail from kausalco/public, update it for prometheus changes.",0,1,0,0,"2018-04-16 10:25:39","28.11"
"grafana/loki","1694ad0f9b6ec2ed9cb576ab4bdaa32972f81f58","salvacorts","2023-06-07 09:00:36","true","Stats cache can be configured independently (#9535)

**What this PR does / why we need it**:

Before this PR, the index stats cache would use the same config as the
query results cache. This was a limitation since:

1. We would not be able to point to a different cache for storing the
index stats if needed.
2. We would not be able to add specific settings for this cache, without
adding it to the results cache.

In this PR, we refactor the index stats cache config to be independently
configurable. Note that if it's not configured, it will try to use the
results cache settings.

**Which issue(s) this PR fixes**:
This is needed for:
- https://github.com/grafana/loki/pull/9537
- https://github.com/grafana/loki/pull/9536

**Special notes for your reviewer**:

- This PR also refactors all the tripperwares in rountrip.go to reuse
the same stats tripperware instead of each one creating their own.
- Configuring a new cache in rountrip.go is a requirement for
https://github.com/grafana/loki/pull/9536 so the stats summary can
distinguish before the stats cache and the results cache.

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [x] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",68,62,1,1,"2018-04-16 10:25:39","1877.19"
"grafana/loki","4047d7a9c86cee6972b2acda4939920538324d25","robbymilo","2023-01-24 17:05:33","true","enable responsive table (#7890)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
Co-authored-by: Jack Baldry <jack.baldry@grafana.com>",83,57,1,0,"2018-04-16 10:25:39","1739.28"
"grafana/loki","90fc5109dd753916ed36d841def41487a34dd7a6","chaudum","2023-07-12 20:19:25","true","Remove unused package pkg/prom1 (#9927)

Removes old, unused code.

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",59,63,1,1,"2018-04-16 10:25:39","1912.66"
"grafana/loki","f1fbb7bb3f8270abdb8a4cf1d142503a31c1faef","xperimental","2022-09-20 17:41:24","true","operator: Write configuration for per-tenant retention (#7201)",88,53,1,1,"2018-04-16 10:25:39","1615.3"
"grafana/loki","0fa01651ff490d933bb9b3a469d091ab2725ce50","tomwilkie","2018-06-24 13:48:36","false","Add cli for getting label names, and sort the labels.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",1,2,0,0,"2018-04-16 10:25:39","68.14"
"grafana/loki","f4119de4df2b0908c99785ceec65a205e833712b","hervenicol","2023-02-10 16:28:37","true","helm: values to override read/write/backend paths in gateway config (#8490)

**What this PR does / why we need it**:
Add configurations to override the generated read/write/backend URLs for the gateway.

**Which issue(s) this PR fixes**:
Fixes #8488",81,58,1,0,"2018-04-16 10:25:39","1755.25"
"grafana/loki","eaecf0ff90258b83cac29e8fac8cf1ea72c83b87","slim-bean","2019-05-21 21:28:46","false","Making the pipeline itself a Stage so that we can use it to better implement the Match stage (and it cleans up the Docker and CRI extensions some too)
Still needs to fix the metrics test",106,13,0,1,"2018-04-16 10:25:39","400.71"
"grafana/loki","7dd109763c84f1653ab96e9312cf00e8799b9a89","slim-bean","2020-05-13 12:53:55","true","expand the match_all to also optionally allow counting bytes per stream (#2066)

Signed-off-by: Ed Welch <edward.welch@grafana.com>",118,25,0,1,"2018-04-16 10:25:39","757.6"
"grafana/loki","f9e37e2997cc170372bb6aa77171abb7b80bb9c8","slim-bean","2020-02-26 20:52:59","false","breakout promtail mixin to be separate.

Signed-off-by: Edward Welch <edward.welch@grafana.com>",118,22,0,1,"2018-04-16 10:25:39","675.69"
"grafana/loki","d43348c895af122e7cb9317d3ac9c8f146a53be3","cyriltovena","2019-07-25 16:09:22","false","Fix bug in topk, add more tests, improve iterator",104,15,0,1,"2018-04-16 10:25:39","464.49"
"grafana/loki","cc6f0eca9849409a10cd1f5e0c87f03e46cf6dd2","poyzannur","2023-11-08 19:11:42","true","Return checksum from BuildFrom function (#11178)

**What this PR does / why we need it**:
Follow up from https://github.com/grafana/loki/pull/11115 
We want to know the checksum of the bloom blocks before uploading them
to storage. Instead of opening the file and reading it, this PR returns
the checksum from where it's created.",1,67,1,0,"2018-04-16 10:25:39","2028.62"
"grafana/loki","b09b92e0e23fb745df8a6aa1ebe1d9c0e42d187e","fgouteroux","2023-09-05 08:22:40","true","Add terraform example in ruler docs (#10447)

**What this PR does / why we need it**:

Adding terraform example to manager alerts and recording rules.",47,65,1,0,"2018-04-16 10:25:39","1965.16"
"grafana/loki","8886800bf6e7547b41fe604d71765c2870b6c328","wilfriedroset","2022-10-03 06:54:47","true","Add support for username to redis cache configuration (#7270)

**What this PR does / why we need it**:

Add support for username to redis cache configuration

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the `CONTRIBUTING.md` guide
- [x] Documentation added
- [ ] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

Signed-off-by: Wilfried Roset <wilfriedroset@users.noreply.github.com>",92,53,1,0,"2018-04-16 10:25:39","1627.85"
"grafana/loki","8fab97d1302a1583717c6e784c15049e853ffb48","daixiang0","2019-04-12 01:54:38","false","update expression

Signed-off-by: Xiang Dai <764524258@qq.com>",100,12,0,0,"2018-04-16 10:25:39","355.65"
"grafana/loki","5139aa186783b5a812284744c260daaa43c946bf","dtennander","2020-02-26 13:07:07","true","Promtail: Ignore dropped entries in subsequent metric-stages in pipelines. (#1743)

* Adds testcase for promtail that records metrics after a ""match-drop"".

* Makes subsequent metrics stages in promtail ignore dropped entries.

Before this change a ""metric"" stage after a ""match"" stage with `action: drop` would result in an error.
This specifies the behavior in the docs and adds logic to ignore dropped entries.",117,22,0,0,"2018-04-16 10:25:39","675.36"
"grafana/loki","da175771c0738205a067fb20076204e2bade8e68","kevinburkesegment","2023-10-04 15:49:48","true","clients/pkg/promtail: tests no longer listen on 0.0.0.0 (#10599)

As a result, when you run the tests on a Mac, they no longer prompt the
user to ask if they are OK with the tests listening on an external
address. This makes the tests substantially easier to run on a Mac, in
addition to improving this library's security posture.

Updates #10407.

**Checklist**
- [X] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [x] Tests updated

These are not required

- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

Co-authored-by: Michel Hollands <42814411+MichelHollands@users.noreply.github.com>",27,66,1,0,"2018-04-16 10:25:39","1994.48"
"grafana/loki","b652f0a3f2c761ed1b4858ae1336dca3644e7f22","sshah90","2020-04-24 14:43:53","true","added extraCommandlineArgs in values file (#1981)

* added extraCommandlineArgs in values file

* corrected yaml with adding space

* upgrade promtail chart version

* update loki-stack chart version",115,24,0,0,"2018-04-16 10:25:39","738.68"
"grafana/loki","7942493524e8f91b86cdc9f76c76e63092221ca3","CyrilPeponnet","2019-05-15 20:01:25","true","impr/clients: Handle TLS config and MTLS for logcli and promtail (#540)

* impr/clients: Handle TLS config and MTLS for logcli and promtail

* fix/tls: Please gofmt...

* impr/clients: use prometheus HTTPClientConfig for logcli and promtail

* fix/promtail: Set proper Client config name

* impr/promtail: Use prometheus HTTPClientConfig configuration

* adapt with master

* address review

* fix conflicts

* address requested changes

* remove file

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>",100,13,0,0,"2018-04-16 10:25:39","394.65"
"grafana/loki","9290a5d228fef7bf4edd29a34b03e29e9d2942d3","cyriltovena","2019-05-07 15:10:11","false","rename __filename__ label to filename",100,13,0,1,"2018-04-16 10:25:39","386.45"
"grafana/loki","5cb9e239a6bb6f513bcb27a02db726b176069605","woodsaj","2019-02-06 07:19:35","true","Merge pull request #294 from grafana/fixPromtailReqDurMetric

fix promtail_request_duration metric",75,10,0,0,"2018-04-16 10:25:39","289.87"
"grafana/loki","07f20b0db3dac84835590c19b3e5fa1fe0addaad","slim-bean","2019-01-29 09:02:30","false","Unit tests for Promtail (#244)

* Adding a test for target.go
Fixing some shutdown issues where tailers were stopped but didn't properly wait for the current position to be saved to file
Fixed an issue where an empty directory would lead to nothing being tailed

* adding more tests for target.go

* renaming quitComplete -> done per feedback
making PositionsFile private again, no reason for it to be public
removed unnecessary save of empty file on creation of positions file

* fixing lint errors

* cleaning up some comments
removing TODO around directories, added a test to verify behavior
some more cleanup per review

* fixing imports",66,9,0,1,"2018-04-16 10:25:39","282.94"
"grafana/loki","fcb9812f5d122385d345e728f5b88f3e6c7166c6","cyriltovena","2022-04-08 14:49:57","true","Fixes deduping when multiple timestamp are equal (#5799)

* Fixes deduping when multiple timestamp are equal

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* update changelog

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Review feedback

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes int64

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* lint

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* that nit was not worth

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",320,48,0,1,"2018-04-16 10:25:39","1447.93"
"grafana/loki","afb539fcf3c64257b17030a3c30bd059672baa5d","cyriltovena","2021-02-26 16:11:09","true","Fixes some 500 returned by querier when storage cancellation happens. (#3344)

For unknown reasons,  Cortex is transforming all errors to promql.ErrStorage
on the storage layer.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",134,34,0,1,"2018-04-16 10:25:39","1040.74"
"grafana/loki","a7e0770acb8392db791aab16cdf87111a88ed896","cyriltovena","2021-03-19 10:51:37","true","Fixes a race introduced by #3434. (#3517)",167,35,0,1,"2018-04-16 10:25:39","1063.52"
"grafana/loki","f7ee1c753c76ef63338d53cfba782188a165144d","cyriltovena","2019-12-03 15:39:03","false","Supports same duration format in LogQL as Prometheus

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",91,19,0,1,"2018-04-16 10:25:39","592.47"
"grafana/loki","5efccca1b80b11f101ecd6a14a3371df95bb3d28","RichiH","2020-07-27 12:38:41","true","Change conduct contact email address (#2425)

Signed-off-by: Richard Hartmann <richih@richih.org>",123,27,0,0,"2018-04-16 10:25:39","831.59"
"grafana/loki","651ac093b68c2071a854382ddc2bf85e2aa58c9c","salvacorts","2022-02-25 08:38:17","true","Fix circular dependencies (#5420)",300,46,0,1,"2018-04-16 10:25:39","1404.68"
"grafana/loki","2dc5a71a6707383aadebe0b10c23c9e09c4f0ce7","DylanGuedes","2022-09-28 16:37:47","true","Tests: Reduce flakiness of GCPLog and integration tests (#7273)

**What this PR does / why we need it**:
- Reduce flakiness of GCPLog tests by reusing context and stopping GCP
topic
- Reduce flakiness of integration tests by:
  - using port as they're assigned
  - reusing context
- adding timeout to calls (hence, if something get stuck, tests fail
earlier)",90,53,1,1,"2018-04-16 10:25:39","1623.26"
"grafana/loki","b1d4efab1203adf5d110261f12171fc03148ebbe","DylanGuedes","2022-10-05 19:47:00","true","Loki: Per-tenant stream sharding (#7311)

**What this PR does / why we need it**:
- Move stream sharding configuration to its own package to avoid cyclic
imports
- Change stream sharding to be a per-tenant configuration
- Change ingesters to reject whole streams due to rate-limit based on
per-tenant stream sharding
- Change stream sharding flags prefix from `distributor.shard-stream` to
`shard-stream`",92,54,1,1,"2018-04-16 10:25:39","1630.39"
"grafana/loki","2a596a77d75a74f15fe9a7dd5bc7f309fb268adc","owen-d","2020-07-29 14:11:26","true","Lambda-Promtail (#2282)

* specs out lambda-promtail

* init fn

* udpates readme/template

* lambda-promtail docs

* lambda promtail includes source timestamp and uses context

* non markdown links

* new doc structure",125,27,0,1,"2018-04-16 10:25:39","833.66"
"grafana/loki","d9637a665477d947e30372b007631451212a1180","owen-d","2021-04-12 14:29:19","true","locks trailers during iteration (#3595)",155,36,0,1,"2018-04-16 10:25:39","1086.67"
"grafana/loki","5070605335f3360cc05abe31424de8bdaf32386d","cyriltovena","2021-01-08 14:29:59","true","Fixes absent_over_time to work with all log selector. (#3143)

* Fixes absent_over_time to work with all log selector.

I made a mistake forcing absent_over_time to work only for unwrap, which is not the most useful usecase.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* actually add a test that cover the previous mistake :)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",118,33,0,1,"2018-04-16 10:25:39","992.67"
"grafana/loki","32d668ceb0e201424aa2e0a36d24411431695cda","cyriltovena","2021-03-03 17:26:06","true","Only unpack entry if the key `_entry` exist. (#3426)

* Only unpack entry if the key `_entry` exist.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* s/kv/lbs/g

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* fix the test.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",140,34,0,1,"2018-04-16 10:25:39","1047.79"
"grafana/loki","bb2eccce3c02b2bda0e6b04a81ab8e8b7482330d","irizzant","2022-05-19 08:49:24","true","[loki microservices]: allow custom gateway server configuration (#6138)

* feat(loki)!: allow custom server configuration

Signed-off-by: irizzant <i.rizzante@gmail.com>

* doc(loki): fix documentation

* refactor: move server_snippet under gateway.libsonnet

Signed-off-by: irizzant <i.rizzante@gmail.com>",72,49,0,0,"2018-04-16 10:25:39","1493.93"
"grafana/loki","b27f92e86bba86841d0947d416636cbe8d4eaf74","dojci","2020-06-01 15:34:36","true","Add FIFO queue persistent buffering for fluent bit output plugin (#2142)

* Add FIFO queue persistent buffering for fluent bit output plugin

* Fix configuration names in logging

* Fix typos & suggested improvments",128,25,0,0,"2018-04-16 10:25:39","775.71"
"grafana/loki","4861914c81bd1580c888620f92766586869397ff","florianl","2022-10-04 07:27:59","true","pkg/ruler/rulestore/configdb: Preallocate memory (#7326)

Preallocate memory instead of enforcing an incremental growth. This will
result in less work for the garbage collector.",92,54,1,0,"2018-04-16 10:25:39","1628.88"
"grafana/loki","093ec20b43e6efafe07d01b13d42ec0409b4cfc1","danpoltawski","2023-06-14 14:17:28","true","packaging: fix postinst on debian oses (#9706)

Previously the systemd version extract pulled in debian string breaking
the detection on debian variants



**What this PR does / why we need it**:

Fixes  postinst error on Debian variants

**Which issue(s) this PR fixes**:
Fixes #9701 #9302

**Special notes for your reviewer**:

Tests on various OS variants:

Debian/12
```
$ systemctl --version 
systemd 252 (252.6-1)
+PAM +AUDIT +SELINUX +APPARMOR +IMA +SMACK +SECCOMP +GCRYPT -GNUTLS +OPENSSL +ACL +BLKID +CURL +ELFUTILS +FIDO2 +IDN2 -IDN +IPTC +KMOD +LIBCRYPTSETUP +LIBFDISK +PCRE2 -PWQUALITY +P11KIT +QRENCODE +TPM2 +BZIP2 +LZ4 +XZ +ZLIB +ZSTD -BPF_FRAMEWORK -XKBCOMMON +UTMP +SYSVINIT default-hierarchy=unified
$  systemctl --version | head -1 | sed 's/systemd \([0-9]\+\).*/\1/'
252
```
CentOS/7
```
$ systemctl --version 
systemd 219
+PAM +AUDIT +SELINUX +IMA -APPARMOR +SMACK +SYSVINIT +UTMP +LIBCRYPTSETUP +GCRYPT +GNUTLS +ACL +XZ +LZ4 -SECCOMP +BLKID +ELFUTILS +KMOD +IDN
$ systemctl --version | head -1 | sed 's/systemd \([0-9]\+\).*/\1/'
219
```
Debian/11
```
$ systemctl --version 
systemd 247 (247.3-7+deb11u2)
+PAM +AUDIT +SELINUX +IMA +APPARMOR +SMACK +SYSVINIT +UTMP +LIBCRYPTSETUP +GCRYPT +GNUTLS +ACL +XZ +LZ4 +ZSTD +SECCOMP +BLKID +ELFUTILS +KMOD +IDN2 -IDN +PCRE2 default-hierarchy=unified
$ systemctl --version | head -1 | sed 's/systemd \([0-9]\+\).*/\1/'
247
```
Ubuntu/20.04
```
$ systemctl --version
systemd 245 (245.4-4ubuntu3.20)
+PAM +AUDIT +SELINUX +IMA +APPARMOR +SMACK +SYSVINIT +UTMP +LIBCRYPTSETUP +GCRYPT +GNUTLS +ACL +XZ +LZ4 +SECCOMP +BLKID +ELFUTILS +KMOD +IDN2 -IDN +PCRE2 default-hierarchy=hybrid
$ systemctl --version | head -1 | sed 's/systemd \([0-9]\+\).*/\1/'
245
```
**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

Co-authored-by: Michel Hollands <42814411+MichelHollands@users.noreply.github.com>",66,62,1,0,"2018-04-16 10:25:39","1884.41"
"grafana/loki","7c66a363f74519ef7ef27af5f9d6956909d22ba2","sandeepsukhani","2022-08-08 16:13:38","true","Delete requests processing improvements (#6837)

* return early while checking whether a chunk is deleted if user does not have any delete requests

* track oldest start and latest end time of delete requests for each user

* add some tests

* Update pkg/storage/stores/indexshipper/compactor/deletion/delete_requests_manager.go

Co-authored-by: Michel Hollands <42814411+MichelHollands@users.noreply.github.com>

Co-authored-by: Michel Hollands <42814411+MichelHollands@users.noreply.github.com>",75,52,0,1,"2018-04-16 10:25:39","1573.24"
"grafana/loki","0f5fbb6701622231fad532a32d5a341130ffb76b","chaudum","2023-09-21 11:22:12","true","Log process startup and running time (#10656)

This helps to get insights about slow startup of Loki, e.g. for the index gateway, which may pre-fetch a lot of data before it becomes ready.

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>
Co-authored-by: Ashwanth <iamashwanth@gmail.com>",32,65,1,1,"2018-04-16 10:25:39","1981.29"
"grafana/loki","97d52d948d6e2332bf702cb8f2ea6e001456359a","shantanualsi","2023-09-06 10:37:34","true","Upgrade thanos objstore (#10451)",46,65,1,0,"2018-04-16 10:25:39","1966.26"
"grafana/loki","bad691b5091f1ad2f09dbfb30d5395b8f57a3bcd","MichelHollands","2023-07-12 15:01:19","true","Update go build image (#9914)

Update the go build image

---------

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",59,63,1,1,"2018-04-16 10:25:39","1912.44"
"grafana/loki","b82ad11f9228c9c95b66cef7eaf82303126401aa","DylanGuedes","2023-04-11 09:30:12","true","Loki: Fix span event logging on rate store (#9086)

**What this PR does / why we need it**:
Fix an event logging on rate store that is missing the `event` key.
`LogKV` expects a key-value pair always.",83,60,1,1,"2018-04-16 10:25:39","1815.96"
"grafana/loki","8694e7303a301a21c8e495e8c43b902dee7a3a96","sandeepsukhani","2021-03-24 10:04:41","true","split series api queries by day in query-frontend (#3530)",142,35,0,1,"2018-04-16 10:25:39","1068.49"
"grafana/loki","b7d23f41bddf715640d6b014cfa78e7244a8ddfd","owen-d","2020-01-29 16:49:13","true","Decouple logql engine/AST from execution context (#1605)

* logql engine is an interface

* [wip] begins agnostic logql evaluator work

* decouples logql AST from execution context

* healthcheck comments",105,21,0,1,"2018-04-16 10:25:39","648.52"
"grafana/loki","34311b4c4c963f50eafcb1dcd725532e205a2acb","halcyondude","2020-11-09 07:31:04","true","parameterize PVC storage class (ingester, querier, compactor) (#2718)",119,31,0,0,"2018-04-16 10:25:39","933.38"
"grafana/loki","916124b9eaf723a280cd721231f8dfd92bedd942","slim-bean","2019-04-09 02:58:17","false","Adding `make debug` support to build debug binaries and debug containers which wrap the binary with delve and allow for remote debugging",100,12,0,1,"2018-04-16 10:25:39","352.69"
"grafana/loki","f6c483e2c189c549088908025eff05e47bb7e202","tomwilkie","2018-12-18 15:34:27","true","Clarify what we mean by 'like Prometheus, but for logs'. (#149)

* Clarify what we mean by 'like Prometheus, but for logs'.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>

* Typos.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",36,8,0,0,"2018-04-16 10:25:39","242.21"
"grafana/loki","a8f7c3ba61c1fadc3c791cab34f8cb95048b84b7","MattiasSegerdahl","2023-05-01 08:27:45","true","Update _index.md (#9309)

**What this PR does / why we need it**:

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",79,60,1,0,"2018-04-16 10:25:39","1841.17"
"grafana/loki","c5bf444d7bf5cb5f2e4d3394cbeafc131c41e59b","MattiasSegerdahl","2023-05-01 08:30:42","true","Update geoip.md (#9311)

**What this PR does / why we need it**:

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",79,60,1,0,"2018-04-16 10:25:39","1841.17"
"grafana/loki","d10756220e782b864f3aa621b470675d8f24235c","rfratto","2019-09-03 18:12:50","false","docs: restore directory structure for logentry and canary",124,17,0,1,"2018-04-16 10:25:39","502.57"
"grafana/loki","54c0c5febbe3f58cd9593eb2bff75a580c2be6de","owen-d","2020-10-14 13:11:36","true","Revendor Cortex (#2755)

* replaces prometheus & revendors cortex

* compat

* compat

* sd refactor

* updates docker

* removes prom replace

* adds delimiters back to object addrs in boltdb",112,30,0,1,"2018-04-16 10:25:39","908.62"
"grafana/loki","acf1866706a65230275a50bec19a36124dce5786","julienduchesne","2021-07-06 14:04:57","true","Sign drone.yml file (#3950)

* Sign drone.yml file
This is needed to set the repository as ""Protected""

* Add shellcheck back",119,39,0,0,"2018-04-16 10:25:39","1175.9"
"grafana/loki","1794a766134f07b54386b1a431b58e1d44e6d7f7","RutgerKe","2022-06-11 09:57:22","true","Promtail: Add metrics for journal target (#6105)

* Add metrics for journal target

There are no metrics for the journal target yet, this adds two basic
ones:
- Total number of lines processed
- Total number of errors processing lines (with a reason)

Because of the way the journal works, tailing one file with many
possible process writing to it, I chose note to expose counts per unit.

* Add changelog entry

* Fix compilation of (unsupported) journalmanager target on windows

* Extract possible errors to constants & add tests",71,50,0,0,"2018-04-16 10:25:39","1515.98"
"grafana/loki","dad39f7ea67be378401ccbd846da450dca039bc7","simonswine","2023-01-03 08:42:25","true","Improve comments on sample timestamp validation errors (#8018)

This has come up time and time again, I have tried to write it up a bit
better in code first, I would also strongly suggest that we improve the
error messaging and the documentation of this.",98,56,1,0,"2018-04-16 10:25:39","1717.93"
"grafana/loki","e49c360c365fb81414587680f4e0685567a05187","afayngelerindbx","2022-03-10 17:12:46","true","canary: Adds locking to prevent multiple concurrent invocations of `confirmMissing` from clobbering each other (#5568)",308,47,0,0,"2018-04-16 10:25:39","1420.03"
"grafana/loki","3f28e6362da86587778607ccc2c355232318551b","chaudum","2023-10-23 09:40:05","true","Fix flaky bloomgateway test case (#11001)

The order of active users is non-deterministic, so we need to check for matching elements, rather than for equal slice.

Failed test run: https://drone.grafana.net/grafana/loki/29579/3/6
Passed test run: https://drone.grafana.net/grafana/loki/29577/3/6

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",25,66,1,1,"2018-04-16 10:25:39","2013.22"
"grafana/loki","a29901d33a0dd48714a1c81d54158c5eaeb5867e","cyriltovena","2021-03-04 23:06:28","true","Add limit and line_returned in the query log. (#3423)

* Add limit and line_returned in the query log.

This can be useful to investigate how many wasted queries have been made by the frontend.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* got linted.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",141,34,0,1,"2018-04-16 10:25:39","1049.03"
"grafana/loki","e8e252376813264d2ee75b3ecef022471f6d6bf4","periklis","2022-10-05 09:37:53","true","operator: Use quayio v2.7.0-pre image for openshift overlay (#7329)",94,54,1,1,"2018-04-16 10:25:39","1629.97"
"grafana/loki","3a1fdd03f466aa1d526c191a55848bef7b30eb38","dannykopping","2022-06-08 14:30:53","true","Define a reason why the fifocache has evicted an item (#6335)

* Define a reason why the fifocache has evicted an item

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Fixing tests

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Making reason more clear

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Do not increment eviction counter on Stop()

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",72,50,0,1,"2018-04-16 10:25:39","1513.17"
"grafana/loki","b5b6999a79c35b9ee17d03249aec03f7378facac","tomwilkie","2018-06-05 11:44:32","false","Add docker client to build image.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",1,2,0,0,"2018-04-16 10:25:39","49.05"
"grafana/loki","30303c6a71411b0ac7efbb13ca2a2c98ffde9daf","vishesh92","2020-03-23 20:08:07","true","Docs: Update configuration docs for redis (#1843)",120,23,0,0,"2018-04-16 10:25:39","702.65"
"grafana/loki","f918aa00ee8e6e96bae74c6dd285e3be060527b3","rfratto","2019-09-16 18:37:03","true","ksonnet: update memcached and memcached-exporter images (#1021)",70,17,0,1,"2018-04-16 10:25:39","515.59"
"grafana/loki","d5a2b0b79237434437c30756d51017d740883e48","minhdanh","2019-08-26 04:39:53","false","Add support for additional labels and scrapeTimeout for serviceMonitors",119,16,0,0,"2018-04-16 10:25:39","495.01"
"grafana/loki","fd94b8d30d72852adb1779b4dfe14e5b36e9fbd7","owen-d","2021-01-07 17:12:10","true","label_format no longer shardable and introduces the Shardable() metho… (#3137)

* label_format no longer shardable and introduces the Shardable() method to Expr ifc

* unused llint",115,33,0,1,"2018-04-16 10:25:39","991.78"
"grafana/loki","1bd5a2059529d79def0539acb7cc676b45ef7c2d","DylanGuedes","2023-04-27 16:45:20","true","Distributor: Modify `createShard` to create slice with more precise size (#9265)

**What this PR does / why we need it**:
Modify the `createShard` method to create the entries slice with the
number of entries divided by the total number of shards instead of
always creating it with len=1024.",80,60,1,1,"2018-04-16 10:25:39","1837.51"
"grafana/loki","38c9c6c460ada5c8126f7d3db8784f2aaf3b5f1c","trevorwhitney","2023-04-12 16:30:00","true","Bump go from 1.20.1 -> 1.20.3 (#9106)

**What this PR does / why we need it**:

Bumps our go dependency from 1.20.1 to 1.20.3 to address [security
fixes](https://groups.google.com/g/golang-announce/c/Xdv6JL9ENs8)

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",83,60,1,1,"2018-04-16 10:25:39","1817.25"
"grafana/loki","c3e92b876c9a2079a9989c3954f420336e3c8182","dannykopping","2022-10-05 13:21:03","true","Restoring lint checks that were previously disabled (#7340)

I removed these checks in https://github.com/grafana/loki/pull/7337 to
not make https://github.com/grafana/loki/pull/7243 overly complex to
review.

Refactored code to fix valid lint issues, ignored the
irrelevant/dangerous ones.
I also removed `unused` and `unparam` as these produce low-quality
results that are largely useless.",94,54,1,1,"2018-04-16 10:25:39","1630.12"
"grafana/loki","ed64054d0e9633d8d307a30390c567719828310b","cyriltovena","2020-07-10 19:07:55","true","Improve documentation of the metric stage. (#2335)

Specially w/r/t `max_idle_duration`",125,27,0,1,"2018-04-16 10:25:39","814.86"
"grafana/loki","53fc2d73906c563955740ad3397987b950180f1f","cstyan","2021-11-18 22:17:49","true","Minor operational dashboard improvements + fix missing log template (#4780)

selector.

Signed-off-by: Callum Styan <callumstyan@gmail.com>",203,43,0,1,"2018-04-16 10:25:39","1308.24"
"grafana/loki","03fd199cd558fef6130e9c9f0c20e9315c3a3870","blockloop","2021-03-19 15:20:57","true","move things out of the controller and into a handler",167,35,0,0,"2018-04-16 10:25:39","1063.71"
"grafana/loki","a54005f24e8d502a37244565e9fba6fc8284b23e","slim-bean","2020-12-10 20:45:47","true","update changelog

(cherry picked from commit d5141c05a7b0e2e63fd2ae679d098577f1076cc9)",122,32,0,1,"2018-04-16 10:25:39","964.93"
"grafana/loki","11ad3563964111dca171866fd851162564ef3c46","sh0rez","2019-06-07 18:42:29","false","feat(promtail): initContainers (#655)

* fix(promtail/targets): remove dependency on prometheus/relabel

`filetargetmanager.go` had a dependency on prometheus/relabel, a package that
has been removed in favor of prometheus/pkg/relabel.
This converts the code to the new package, to allow the prometheus vendor be
updated to master

* chore(vendor): update prometheus vendor

Updates prometheus vendor to current master, to add support for InitContainers
in kubernetes service discovery

* chore(vendor): do dep's homework

Gives dep hints on how to resolve the vendor so that it work

* fix(promtail/targets): non-nil check

Accidentally checked against the wrong labelSet, this one can never get nil",110,14,0,0,"2018-04-16 10:25:39","416.6"
"grafana/loki","6595d8df5795fa577fef2f9e275daf5632551ef8","sh0rez","2019-07-05 13:46:50","false","BREAKING fix(loki-mixin): rename rules key (#691)

Renames the `prometheus_rules` key to `prometheusRules` to comply to the
spec (https://github.com/monitoring-mixins/docs/blob/master/design.pdf)

BREAKING `prometheus_rules` is not available anymore",97,15,0,0,"2018-04-16 10:25:39","444.39"
"grafana/loki","049c7acc127fc65c4b8fd86b422a2e398440f2cd","cyriltovena","2020-11-13 12:44:27","true","Improve logql parser allocations. (#2927)

* Improve logql parser allocations.

Also moving labels parsing into logql package, and I'm not shy to say that promql is faster for this.
So we're using promql for parser, it's faster because their lexer is more sophisticated than ours.

Result are impressive.

```
❯ benchcmp before.txt after.txt
benchmark                    old ns/op     new ns/op     delta
Benchmark_ParseLabels-16     24394         8745          -64.15%

benchmark                    old allocs     new allocs     delta
Benchmark_ParseLabels-16     156            20             -87.18%

benchmark                    old bytes     new bytes     delta
Benchmark_ParseLabels-16     24976         2099          -91.60%
```

Combined with #2926, I think we should be able to get rid of `util.ToClientLabels`. But that's for another PR.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes a test.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",125,31,0,1,"2018-04-16 10:25:39","937.6"
"grafana/loki","c5911d5342deb262f4f125d9dd6f5974e072aeae","vmax","2022-11-07 12:02:09","true","Loki: implement decolorize filter (#7602)

Implement `decolorize` filter that get rids of ANSI color codes in the
log message.

**Which issue(s) this PR fixes**:
Fixes #7601",88,55,1,0,"2018-04-16 10:25:39","1662.07"
"grafana/loki","1a75bb8e22ae194c93e1018384484a20f2fc01c3","slim-bean","2022-07-18 18:14:24","true","Loki: Return an __error_details__ label for any line which incurs a __error__ while being processed (#6543)

* adds an __error_details__ label which includes any details available about a logql error.

Signed-off-by: Edward Welch <edward.welch@grafana.com>

* fix lint, changed a test a little

Signed-off-by: Edward Welch <edward.welch@grafana.com>

* reset error details in Reset() function

Signed-off-by: Edward Welch <edward.welch@grafana.com>",69,51,0,1,"2018-04-16 10:25:39","1553.33"
"grafana/loki","794d7da845b09c6eeacb7589e6d1d04c8ea21105","sh0rez","2019-09-20 20:15:44","true","feat: -version flag (#1036)

While we were already setting the version on the built binaries, this now also
exposes them as a user-facing flag (`-version`).

The already used Prometheus package `github.com/prometheus/common/version` is
used for generated the printed string.",69,17,0,0,"2018-04-16 10:25:39","519.66"
"grafana/loki","d83061279fc782fd147d1ac46f37421a946bc767","tourea","2020-02-05 14:52:08","true","Promtail Helm Chart: Add support for extra environment variables (#1529)

* Make Promtail's Helm chart support passing extra env variables
* bump charts versions",109,22,0,0,"2018-04-16 10:25:39","654.44"
"grafana/loki","0025248f8d66043e759ce5da31065c1484f4068d","sandeepsukhani","2022-07-19 11:25:01","true","Revert ""Set ingester PDB to have max_unavailable=0. (#6589)"" (#6714)

This reverts commit aea05f381e21b53293e05e3aed47ca5164f44905.",70,51,0,1,"2018-04-16 10:25:39","1554.04"
"grafana/loki","02d88462f39654b85b02d31c1db05e0e2d9cec46","sandeepsukhani","2021-11-12 09:37:02","true","allow applying retention at different interval than compaction with a config (#4736)

* allow applying retention at different interval than compaction with a config

* add changelog entry",194,43,0,1,"2018-04-16 10:25:39","1301.72"
"grafana/loki","46b552def21421fc847fb3f95cd909aef51b286e","bboreham","2022-04-08 16:02:27","true","Makefile: run lint and tests with default garbage-collection (#5841)

Setting GOGC=10 makes Go run garbage-collection every time the heap gets
10% bigger than it was before, which does keep the max size down but
slows down memory-intensive operations.

Since this was added for CircleCI, and we don't run those operations
on CircleCI any more, remove the setting.",319,48,0,0,"2018-04-16 10:25:39","1447.98"
"grafana/loki","5da1fdec92580490d70cff93568628559a561245","tomwilkie","2018-11-20 12:21:46","false","Docker login correctly

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",5,7,0,0,"2018-04-16 10:25:39","214.08"
"grafana/loki","8330ff2c61163b3bc7eca64a5aef9b603ab5f423","KMiller-Grafana","2022-07-28 07:42:26","true","Docs: Revise location of some LogQL examples; improve prose (#6751)

* Docs: Revise location of some LogQL examples; improve prose

* Update docs/sources/logql/query_examples.md

Co-authored-by: Michel Hollands <42814411+MichelHollands@users.noreply.github.com>

* Update docs/sources/logql/metric_queries.md

Co-authored-by: Susana Ferreira <ssncferreira@gmail.com>

* Revise per review comments.

Co-authored-by: Michel Hollands <42814411+MichelHollands@users.noreply.github.com>
Co-authored-by: Susana Ferreira <ssncferreira@gmail.com>",78,51,0,0,"2018-04-16 10:25:39","1562.89"
"grafana/loki","c7a3ec54f19cdce11fa516cc6f709ba3be551706","sandeepsukhani","2020-01-24 16:02:15","false","limit for concurrent tail requests (#1562)

* limit for concurrent tail requests

When a new request comes in, querier would ask one of the active ingesters for count of active tail requests for the user
If the count exceeds the configured limits for the user then tail request would be rejected right away.

* goimports querier_test.go

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* query all ingesters for their max tail count

Signed-off-by: Edward Welch <edward.welch@grafana.com>

* changed to check only ACTIVE ingesters and tweaked error handling some

Signed-off-by: Edward Welch <edward.welch@grafana.com>

Co-authored-by: Cyril Tovena <cyril.tovena@gmail.com>
Co-authored-by: Ed Welch <ed@oqqer.com>",100,21,0,1,"2018-04-16 10:25:39","643.48"
"grafana/loki","b489130828e39c8a7e3c94479691ecedd4d00de8","sandeepsukhani","2020-08-24 13:43:34","true","compactor for compacting boltdb files uploaded by shipper (#2526)",122,28,0,1,"2018-04-16 10:25:39","858.64"
"grafana/loki","d87f2a1c8a0c61e7e3788a87f6b3016a061906b6","sandeepsukhani","2022-01-24 11:16:03","true","per user index changes on the write path (#5193)

* per user index changes on the write path

- add a flag to enable building per user index from the ingesters
- when enabled, ingesters would build boltdb files with buckets per tenant",274,45,0,1,"2018-04-16 10:25:39","1373.79"
"grafana/loki","f66d9e93d256998f6d4d79827f633ab61cde25f7","tomwilkie","2018-12-20 11:56:06","true","Add annotation with hash of config, to trigger re-deployments when config changes. (#178)

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",47,8,0,0,"2018-04-16 10:25:39","244.06"
"grafana/loki","562ccd69327f14c7bfc825a74124a8d97ab9a1c7","liguozhong","2022-08-30 21:18:45","true","[bugfix] fix flush.go nil pointer panic (#6993)

**What this PR does / why we need it**:
Fix a panic when reporting chunk statistics. The chunk would already be garbage-collected as it is marked as flushed before reporting its statistics. This fix it by first reporting its statistics and only then marking it as flushed.
 
Panic description:
```go
panic: runtime error: invalid memory address or nil pointer dereference
[signal SIGSEGV: segmentation violation code=0x1 addr=0x18 pc=0x177d158]

goroutine 14455 [running]:
github.com/grafana/loki/pkg/chunkenc.(*MemChunk).Size(0xc00441c750?)
  /loki@v1.6.2-0.20220816085209-65ed7b60fbd4/pkg/chunkenc/memchunk.go:611 +0x18
github.com/grafana/loki/pkg/ingester.(*Ingester).reportFlushedChunkStatistics(0xc00087a000, 0xc00f8efe80, 0xc0519d0870, {0x36b7008, 0xc01a593860}, {0x36b7008, 0xc01a5938c0}, {0x307e2f9, 0x7})
  /loki@v1.6.2-0.20220816085209-65ed7b60fbd4/pkg/ingester/flush.go:395 +0x2f2
```",80,52,1,1,"2018-04-16 10:25:39","1595.45"
"grafana/loki","16862b1edcf75169e6b211a60e360ddc8b1d538e","trevorwhitney","2022-10-21 16:45:16","true","[helm] Mimic loki service account with canary account (#7236)

**What this PR does / why we need it**:

Bring the Loki Canary service account in line with the Loki service
account, removing the post install hook, and sharing the top level
properties for `automountServiceAccountToken` and `imagePullSecrets`.
I'm open to creating canary specific values for these setting if needed,
but want to start by sharing the top level values to reduce config if
possible.

Also default canary to Appversion to be in sync with default Loki
version

**Which issue(s) this PR fixes**:
Fixes two issues raised in comments from @towolf (thanks!) on this
[PR](https://github.com/grafana/loki/pull/7173#issuecomment-1256410181).

Fixes #7237",92,54,1,1,"2018-04-16 10:25:39","1646.26"
"grafana/loki","46cc256702f0323ec85161bd9b0e38bcd25c4bc0","trevorwhitney","2022-01-07 18:45:13","true","expand ruler ring section to add num_tokens property (#4899)

* expand ruler ring section to add num_tokens property

* fix num-tokens prefix

* fix wording in common ring section around heartbeat_timeout

* rebase on main",256,45,0,1,"2018-04-16 10:25:39","1357.1"
"grafana/loki","18058d2b550e4af98bf16ad48ac811161d7cace4","chaudum","2022-05-05 12:32:17","true","Serve correct status of ingester/distributor in gRPC healthcheck endpoint (#6094)

* Serve correct status of ingester in gRPC healthcheck endpoint

The gRCP healthcheck endpoint is used by clients that determin whether a
connection to the service is healthy or not.
In case the ingester is not in ""running"" state and is not ""active"" in
the ring, this healthcheck should return ""not serving"".

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>

* Serve correct status of distributor in gRPC healthcheck endpoint",75,49,0,1,"2018-04-16 10:25:39","1480.09"
"grafana/loki","6498c8cb1344c6212c2c135da090a98ba9e34775","DylanGuedes","2021-10-13 18:55:15","true","Loki: Change default limits to common values (#4415)

* Change some default limits to reasonable values.

- These new limits protect users from overwhelming their cluster with
  ingestion load
- The new limits are:
  * ingestion_rate_strategy: global <- currently defaults to local
  * max_global_streams_per_user: 5000 <- current default is no limit
  * max_query_length: 721h <- current default is no limit
  * max_query_parallelism: 32 <- current default is 14
  * max_streams_per_user: 0 <- current default is 10000
  * reject_old_samples: true <-- current default is false
  * reject_old_samples_max_age: 168h <-- current default is 336h

* Remove parameters from examples

- They are not necessary anymore because of the new default values

* Add new entries to CHANGELOG and upgrading guide

* Apply suggestions from code review

Co-authored-by: Trevor Whitney <trevorjwhitney@gmail.com>

* Change changelog mark entry from '-' to '*'

Co-authored-by: Trevor Whitney <trevorjwhitney@gmail.com>",152,42,0,1,"2018-04-16 10:25:39","1273.1"
"grafana/loki","2d781e169c154ae05e7b6c3be408bd92c1790649","woodsaj","2019-11-06 09:51:14","true","update triggers to use new deployment_tools location (#1235)

raintank/deployment_tools repo is being moved to grafana/deployment_tools",66,19,0,0,"2018-04-16 10:25:39","565.23"
"grafana/loki","24f5706a9ad14d6c08bfc820a83147c331887e7f","cyriltovena","2019-07-26 14:05:38","true","fix dependencies order and bump version (#803)",100,15,0,1,"2018-04-16 10:25:39","465.4"
"grafana/loki","55b5be3f0bea9398c8cd92da40f9f815c3f8a80c","garo","2019-04-09 06:52:24","false","Clarify that Promtail can also be used outside kubernetes",99,12,0,0,"2018-04-16 10:25:39","352.85"
"grafana/loki","2548d6986d5c9cce8ad152703616de5d39d0927f","cyriltovena","2020-07-13 15:12:52","true","Remove mount in the docker driver. (#2295)

* Remove mount in the docker driver.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* lint json

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",118,27,0,1,"2018-04-16 10:25:39","817.7"
"grafana/loki","8dcc2d6e552d7bfb26e4193b06f34f38d818cae9","DylanGuedes","2022-06-22 14:38:08","true","Use shipper as indexClient for read mode. (#6461)",70,50,0,1,"2018-04-16 10:25:39","1527.18"
"grafana/loki","6dfcd59c1bc8cbe267f31d945eaa9e30617cf96a","DylanGuedes","2023-04-04 14:24:22","true","Promtail: Add `decompression` configuration (#8994)

**What this PR does / why we need it**:
Adds a new `compression` configuration to Promtail to customize
decompression behavior.
As of now, two options are supported:
`enabled`: false by default but if truthy, Promtail will infer a
compression algorithm to use based on the file extension
`initialDelay`: 0 by default but if higher, Decompressor will sleep for
the given duration before trying to decompress. This is to avoid
scenarios where the Decompressor starts to work on a file that is still
being compressed/generated.

**Which issue(s) this PR fixes**:
Fixes https://github.com/grafana/loki/issues/8784",81,59,1,1,"2018-04-16 10:25:39","1809.17"
"grafana/loki","bcb57f100ce031ba0b91c39aa638121f566d3070","DylanGuedes","2022-06-24 07:36:13","true","During query readiness, log duration of all object-store operations (#6489)

* During query readiness, log duration of all object-store operations.

* Fix duration assignment.",69,50,0,1,"2018-04-16 10:25:39","1528.88"
"grafana/loki","62ee399e48c2686cd138a4034872305784482157","trevorwhitney","2021-11-02 23:47:41","true","default ingester final sleep to 0 unless otherwise specified (#4608)

* default ingester final sleep to 0 unless otherwise specified

* add changelog and upgrading

* update config docs",167,42,0,1,"2018-04-16 10:25:39","1292.31"
"grafana/loki","49f04ef4bc385ff67ba00dde8d181372a999d47b","sandeepsukhani","2020-04-17 12:46:34","true","update cortex to latest master (#1956)",118,24,0,1,"2018-04-16 10:25:39","731.6"
"grafana/loki","70ed5feb9d49c7bc655aa0d0ae338595c51ebe91","sandeepsukhani","2019-09-10 10:36:27","true","Change unit of duration params to hours to align it with duration config at other places in Loki (#998)

* Change unit of duration params to hours to align it with duration config at other places in Loki

other configurations like periodic table duration, retention are set in hours so this change makes
duration config for backup tool consistent and easy to manage configurations

* update parent docker image for bigtable backup tool",117,17,0,1,"2018-04-16 10:25:39","509.26"
"grafana/loki","b26ff7df457b3737e983ed842678e4a43206a291","alfredo-d","2023-04-14 20:26:50","true","Update replication factor impact to read path (#9061)

**What this PR does / why we need it**:
Update a note to callout that replication factor also impacts read path
behavior.

**Which issue(s) this PR fixes**:
Fixes #<issue number>
N/A

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)

---------

Co-authored-by: J Stickler <julie.stickler@grafana.com>",81,60,1,0,"2018-04-16 10:25:39","1819.42"
"grafana/loki","6b9bf0b5f42da7eddb854a71ffce958c7e7d68ee","jonathanmorais","2022-09-07 06:56:32","true","feat: add kms and ec2 permission (#7058)

<!--  Thanks for sending a pull request!  Before submitting:

1. Read our CONTRIBUTING.md guide
2. Name your PR as `<Feature Area>: Describe your change`.
a. Do not end the title with punctuation. It will be added in the
changelog.
b. Start with an imperative verb. Example: Fix the latency between
System A and System B.
  c. Use sentence case, not title case.
d. Use a complete phrase or sentence. The PR title will appear in a
changelog, so help other people understand what your change will be.
3. Rebase your PR if it gets out of sync with main
-->

**What this PR does / why we need it**:
This PR will help to increase a necessary policy (kms and ec2) to
resource log group and lambda.
**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

<!--
Note about CHANGELOG entries, if a change adds:
* an important feature
* fixes an issue present in a previous release, 
* causes a change in operation that would be useful for an operator of
Loki to know
then please add a CHANGELOG entry.

For documentation changes, build changes, simple fixes etc please skip
this step. We are attempting to curate a changelog of the most relevant
and important changes to be easier to ingest by end users of Loki.

Note about the upgrade guide, if this changes:
* default configuration values
* metric names or label names
* changes existing log lines such as the metrics.go query output line
* configuration parameters 
* anything to do with any API
* any other change that would require special attention or extra steps
to upgrade
Please document clearly what changed AND what needs to be done in the
upgrade guide.
-->
**Checklist**
- [ ] Documentation added
- [ ] Tests updated
- [ ] Is this an important fix or new feature? Add an entry in the
`CHANGELOG.md`.
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",85,53,1,0,"2018-04-16 10:25:39","1601.85"
"grafana/loki","7320cb27ad4d924a2ff4f42be9523d2c0af490bc","ivanahuckova","2022-02-24 09:48:07","true","Update _index.md (#5458)",299,46,0,0,"2018-04-16 10:25:39","1403.72"
"grafana/loki","09ecc843f525918d0c4baa4a240ba5159edefcd5","SadFaceSmith","2023-04-05 15:04:32","true","sbom action namechange (#9038)

**What this PR does / why we need it**:
Realized the SBOM action was not running due to the lack of a file
extenstion on the workflow file. Quick add",82,59,1,0,"2018-04-16 10:25:39","1810.19"
"grafana/loki","3b3fcf6c8704b61114b78a319bc0caa280da30d4","sandeepsukhani","2022-05-30 09:22:29","true","update drone branch match for 3 digit k release (#6263)",71,49,0,1,"2018-04-16 10:25:39","1504.96"
"grafana/loki","4c7138231f77997909564616efc5d0cdbcb1ead8","sandeepsukhani","2019-06-20 14:50:33","false","Removed test for tailer in querier due to issues with synchronization",87,14,0,1,"2018-04-16 10:25:39","429.43"
"grafana/loki","e5a3afedff93b20745490f00a8896e364fdd04d9","cyriltovena","2021-05-25 11:48:43","true","Add fromJson to the template stage. (#3736)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",203,37,0,1,"2018-04-16 10:25:39","1134.81"
"grafana/loki","76c2e910cb53eb0962402e02afdfd7369b1eadbd","darxriggs","2023-03-20 10:05:38","true","chore: Fix spelling of ""syncing"" (#8829)

This makes it consistent in the repository.",83,59,1,0,"2018-04-16 10:25:39","1794.99"
"grafana/loki","50c216a7b4f31ffe559fb2e843ada21af6866ee3","polar3130","2020-01-28 13:38:04","false","Helm/loki-stack: refresh default grafana.image.tag to 6.6.0 (#1590)

* update grafana.image.tag in loki-stack' helm chart

* bump the chart loki-stack version",101,21,0,0,"2018-04-16 10:25:39","647.38"
"grafana/loki","af93e2019cb78f555991a54068f4ba4fe2d81af7","tomwilkie","2018-04-16 10:25:39","false","Really dumb chunk implementation.",0,0,0,0,"2018-04-16 10:25:39","0"
"grafana/loki","ab4c5bebab7f3e8a371e3caa9e1b8b4e55369d21","tomwilkie","2019-01-31 10:01:59","true","Validate labels in the distributor. (#251)

Also, make ErrOutOfOrder a HTTP 4xx error and continue to append even when we encourter an out of order entry.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",71,9,0,0,"2018-04-16 10:25:39","284.98"
"grafana/loki","3b965105ec23b71733c30c35f61f284849c81f49","wardbekker","2019-09-17 18:37:48","false","Improved Ingester out-of-order error for faster troubleshooting (#1008)",68,17,0,0,"2018-04-16 10:25:39","516.59"
"grafana/loki","637315779a05ab8f370900e0b75cbd879ba2943f","trevorwhitney","2022-09-09 12:31:56","true","Fix pod affinity selector for single binary (#7109)

**What this PR does / why we need it**:

Fix incorrect selectors for anti-affinity rules for loki single binary.

**Which issue(s) this PR fixes**:
Fixes #7105",86,53,1,1,"2018-04-16 10:25:39","1604.09"
"grafana/loki","3fb65dd5de5943734ea2e94aa7c25a5734e4e1de","fredgate","2020-08-12 12:26:11","true","Add optional secret to pull Docker image in fluent-bit chart (#2489)",120,28,0,0,"2018-04-16 10:25:39","846.58"
"grafana/loki","e18810949fe85eea3d89af24a2974e97ff65aad6","slim-bean","2020-02-07 03:22:18","false","canary needs its logo

Signed-off-by: Edward Welch <edward.welch@grafana.com>",111,22,0,1,"2018-04-16 10:25:39","655.96"
"grafana/loki","e7a1b67c0a5ab407061ab662874a1eae373177c5","fanis","2022-04-18 15:28:41","true","Docs: Fix typo in 429 exceeded rate limit error message (#5944)

* Fix docs typo in word ""limit""

* Fix docs typo ""unlimited"" in limits.go",296,48,0,0,"2018-04-16 10:25:39","1463.21"
"grafana/loki","ce6ec3df2b880fbab7dd8d7aab2b7550213f6bea","sh0rez","2019-08-01 16:00:56","true","chore(packaging): fix image name (#837)

:middle_finger:",107,15,0,0,"2018-04-16 10:25:39","470.48"
"grafana/loki","37d65027fe0cd3dc3fcb57eea7ff20fcbfdb2eec","manohar-koukuntla","2023-01-30 17:04:09","true","Zone aware ingesters (#7923)",83,57,1,0,"2018-04-16 10:25:39","1745.28"
"grafana/loki","d4cfbaac4f04507cb92776d1b408d5a51f290bbe","trevorwhitney","2023-06-28 19:54:10","true","Implement series volume range queries (#9812)

This PR adds a `series_volume_range` endpoint which allows for series
volume queries over time with a specified step, returning timeseries
data in the form of a Prometheus matrix response.

The existing `series_volume` endpoint still returns Prometheus vector
responses, and hardcodes the step to 0.",60,62,1,1,"2018-04-16 10:25:39","1898.64"
"grafana/loki","616771aeff37ab24823391e30b1f73e3aa236914","flixr","2020-07-06 18:58:46","true","Promtail: support unix timestamps with fractional seconds (#2301)

* support unix timestamps with fractional seconds

see #2193

* add test for parsing unix timestamp with fractions

* mention Unix timestamp with fractions in docs

* return error if timestamp is not split into two parts

* don't capitalize error

Co-authored-by: Cyril Tovena <cyril.tovena@gmail.com>

Co-authored-by: Cyril Tovena <cyril.tovena@gmail.com>",123,27,0,0,"2018-04-16 10:25:39","810.86"
"grafana/loki","59c1abe2594faab49989c19d43db3b29112d8c24","MarNicGit","2022-11-29 08:02:43","true","Docs - Move PR's in CHANGELOG.md that weren't actually implemented in 2.7.x (#7690)

Fixes the changelog.
- PR #7462 and #7461 were **not** included in the 2.7.x release (they
were submitted right after the cutoff and did not get backported) and
accidentally ended up in the 2.7.x changelog. Moved them up to
Main/Unreleased.
- Moved #7602 to enhancements section of Promtail",98,55,1,0,"2018-04-16 10:25:39","1683.9"
"grafana/loki","e8cce09de29dc58c38b333e72dfe11613d49fbb3","cyriltovena","2021-02-01 13:59:12","true","Fix a bug with  metric queries and label_format. (#3263)

* Fix a bug whith  metric queries and label_format.

In my previous PR where I introduced hints, I forgot to implement label format label required.
This would cause label format label to be skipped during parsing.

I've also took the opportunity to improve the code.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Refactor and add more tests.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",124,33,0,1,"2018-04-16 10:25:39","1015.65"
"grafana/loki","8161b929060659069a7c860e9c5ea8708bc378f0","cyriltovena","2020-06-26 14:45:20","true","Update to latest cortex. (#2266)

* Update to latest cortex.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* update go.sum

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",134,26,0,1,"2018-04-16 10:25:39","800.68"
"grafana/loki","214c4444be0c0535c492100e40aa0d9b129e0961","salvacorts","2023-10-13 13:51:14","true","Move standalone examples to a new top-level section (#10794)

**What this PR does / why we need it**:

Moves the standalone examples inside the _Configuration_ section to a
new top-level _Examples_ section.
We can use this section to add more examples in the future.

---------

Co-authored-by: Ashwanth <iamashwanth@gmail.com>
Co-authored-by: J Stickler <julie.stickler@grafana.com>",25,66,1,1,"2018-04-16 10:25:39","2003.39"
"grafana/loki","9f5194f6042b06b5692d2e6e8225158c25779320","garo","2019-04-09 06:44:19","false","Fix underscores with Markdown rendering in Promtail examples",99,12,0,0,"2018-04-16 10:25:39","352.85"
"grafana/loki","ff2ced09ea57c29eb5776d37f01d9643e88ae221","owen-d","2021-08-19 12:41:52","true","Cleanup/unordered writes ingester config (#4192)

* handle replaying unordered WAL into ordered configs.

* ingester limiter metric, testware, correctly replayed unordered WAL into ordered config",132,40,0,1,"2018-04-16 10:25:39","1218.84"
"grafana/loki","4640ee14a26869a5fc384164b02965dfcd60f6eb","periklis","2022-07-25 08:05:52","true","operator: Update Loki operand to v2.6.1 (#6749)",72,51,0,1,"2018-04-16 10:25:39","1559.9"
"grafana/loki","e5eff962669a2379c58518e35a16f92d6fcea7ea","MichelHollands","2022-05-19 08:37:02","true","Change deletion_enabled setting to deletion_mode (#6190)

* Change deletion_enabled setting to deletion_mode

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Empty commit",72,49,0,1,"2018-04-16 10:25:39","1493.92"
"grafana/loki","b76be36e0c69c6c0a76725806986e5f73cebd350","periklis","2023-03-29 16:53:28","true","operator: Fix makefile target operatorhub (#8930)",84,59,1,1,"2018-04-16 10:25:39","1804.27"
"grafana/loki","d086c237dfd6d70d53bc16dffef6b0ab713a366b","ssncferreira","2022-12-22 09:31:00","true","Add missing period_config root block to doc generator (#7981)

**What this PR does / why we need it**:
Update doc generator tool to validate if slice element is a root block.

Add missing `period_config` root block to doc generator tool.

**Special notes for your reviewer**:

**Checklist**
- [ ] Documentation updated",97,56,1,0,"2018-04-16 10:25:39","1706.96"
"grafana/loki","6b555884ac8da8b132e4faca6cb9986740462282","davkal","2019-04-08 17:00:46","true","Merge pull request #449 from daixiang0/add-example

Add dashboard example",100,12,0,0,"2018-04-16 10:25:39","352.27"
"grafana/loki","145319e5f5528137288bb7853b6c0e2f44d59b68","shantanualsi","2023-08-29 16:00:42","true","Remove experimental enable ruler api toggle (#10380)

Remove `-experimental.ruler.enable-api` in favour of `-ruler.enable-api`. The former was already deprecated for some time.",48,64,1,0,"2018-04-16 10:25:39","1959.48"
"grafana/loki","d8a0c6f87fd2a13b84228c47058bb8d911fb4bee","JordanRushing","2023-01-17 21:39:38","true","Revert ""[loki-canary] Support passing loki address as environment variable (#8024)"" (#8183)

**What this PR does / why we need it**:
This PR reverts commit f9ed9cb7d98dcdaa6fe2f1b7e97ca86af2864121 which
introduced breaking config changes for the Loki canary. The relevant
change introduced support for configuring a new `LOKI_ADDRESS` canary
environment variable by adopting a new library for flags.

This is the easiest path forward to avoid forcing breaking config
changes on canary operators; such a change is likely better suited to
join other configuration changes in a future major Loki release.

**Which issue(s) this PR fixes**:
N/A

**Special notes for your reviewer**:
Related PR:
- https://github.com/grafana/loki/pull/8024

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",93,57,1,0,"2018-04-16 10:25:39","1732.47"
"grafana/loki","c09a01d7c3ecaafe9352d02a2a0b45cb7cf48a66","cyriltovena","2020-01-10 13:51:15","true","Bump fluentd plugin to 1.2.6. (#1500)

This was ommitted in the previous PR https://github.com/grafana/loki/pull/1475.
Unfortunatelly I need a new version to publish the new gem.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",101,21,0,1,"2018-04-16 10:25:39","629.39"
"grafana/loki","9bfe1d81d47127934e7be201b7e0a2e4fadb7a6b","DylanGuedes","2023-08-18 15:47:01","true","Add zone-aware ingesters to Index panel. (#10291)

**What this PR does / why we need it**:
Modify the Index panel on `Loki/Writes` to account for any ingesters, to
avoid ignoring zone-aware ingesters.",50,64,1,1,"2018-04-16 10:25:39","1948.47"
"grafana/loki","87ed13715a258dd633bb75f6e25d809762e5f2bb","sandeepsukhani","2022-04-12 09:27:23","true","document flag for disabling broad index queries (#5880)",319,48,0,1,"2018-04-16 10:25:39","1451.71"
"grafana/loki","c582c5a727b8744422f49597e5b44a77563c7300","chodges15","2022-07-06 07:58:51","true","loki-canary: Fix resource leak when using client-side certs (#6579)

* loki-canary: Fix resource leak when using client-side certs

* swap panic for os.Exit when failing to create httpClient",72,51,0,0,"2018-04-16 10:25:39","1540.9"
"grafana/loki","65b5df68ff630bac65ed704601b96c9a2f2f0307","oleksii-boiko-ua","2023-05-26 08:05:23","true","helm: fix breaking sts change (#9528)

**What this PR does / why we need it**:
It fixes the breaking change I introduced by changing sts
podManagementPolicy from Parallel to OrderedReady

**Which issue(s) this PR fixes**:
Fixes #9524

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [ ] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [x] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

Co-authored-by: Michel Hollands <42814411+MichelHollands@users.noreply.github.com>",68,61,1,0,"2018-04-16 10:25:39","1866.15"
"grafana/loki","7299e3bdcdae5bd7dacd08be67f706fdbaab8543","MasslessParticle","2022-04-20 18:14:33","true","Fix query filtering (#5951)

- milli -> nano conversion in the querier
- add deletes to store requests from the ingester",172,48,0,1,"2018-04-16 10:25:39","1465.33"
"grafana/loki","04685ea5123956f7b0936e88552a9947156b510a","Sheikh-Abubaker","2023-08-30 05:40:31","true","Added a line in loki.yaml file to enable ruler sharding (#10066)

**What this PR does / why we need it**:

**Which issue(s) this PR fixes**:
Fixes #8843 

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",47,64,1,0,"2018-04-16 10:25:39","1960.05"
"grafana/loki","b55f2313a07797a2f9b7b309facb0630479e19b1","periklis","2021-05-04 15:25:36","true","Provide sane defaults for limits per stack size and loki config (#43)",184,37,0,1,"2018-04-16 10:25:39","1113.96"
"grafana/loki","a454f7edb72ac23e3bdfe51ff454976279c4475b","cyriltovena","2021-05-03 07:48:19","true","Use pgzip in the compactor. (#3672)

Since index file are expected to be large, this will help to compress/decompress in parallel.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",181,37,0,1,"2018-04-16 10:25:39","1112.64"
"grafana/loki","aecf86760574f189a7af9a719124f91808b8e764","cyriltovena","2019-06-17 16:27:47","true","fix missing logger in client (#673)",85,14,0,1,"2018-04-16 10:25:39","426.5"
"grafana/loki","c9f89df930268d5017319c424602e5122a0b40ec","cyriltovena","2020-07-13 18:16:49","true","Improve object key parsing for boltdb shipper. (#2323)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",118,27,0,1,"2018-04-16 10:25:39","817.83"
"grafana/loki","d97607999205715e395bbde0735c977908df1058","cyriltovena","2021-01-26 10:01:46","true","Fixes previous commit not using the new sized body. (#3234)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",121,33,0,1,"2018-04-16 10:25:39","1010.48"
"grafana/loki","53c2b2c22a2701b5b4dcbb42d5c6f518fdbe8c9f","btaani","2023-09-07 14:00:19","true","operator: Use a condition to warn when labels for zone-awareness are empty (#10418)",44,65,1,0,"2018-04-16 10:25:39","1967.4"
"grafana/loki","acbbe4ddfd3b352b93ad56a2f24254f566f4400b","trevorwhitney","2022-01-04 15:09:35","true","temporary fix for the ruler joining the ingester ring (#4968)",253,44,0,1,"2018-04-16 10:25:39","1353.95"
"grafana/loki","b1f9be5171888629b970e94cc3d39a9aab0e78d7","trevorwhitney","2023-11-08 16:28:17","true","always align volume range timestamp to end of step (#11136)

**What this PR does / why we need it**:
We had originally assumed that it would be weird for a user to get back
a timeseries response from `volume_range` that didn't include a
datapoint with a timestamp at the start of their requested range. This
was a bad assumption. The `volume_range` endpoint is inherently doing
aggregations. For each step, a datapoint is calculated representing the
percent of chunk volumes that the selector appeared in. It therefore
stands to reason that the steps volume was not that value until the end
of the step time range, as we are to assume volume is monotonically
increasing. The fact that we were using the start of the range made it
difficult to turn this data into a per-second rate, which this PR aims
to fix.

**Which issue(s) this PR fixes**:
Fixes #11134",2,67,1,1,"2018-04-16 10:25:39","2028.5"
"grafana/loki","b8d81ababaa8fe400e16e74846d6a1a1b73ed2d3","gouthamve","2019-03-15 13:11:05","true","Add tracing to Loki (#328)

* Add tracing to loki

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>

* Use the op names from common/server

We don't need to the tracing middleware again. Further, the op names are
not sanitised here.

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>",93,11,0,0,"2018-04-16 10:25:39","329.11"
"grafana/loki","79c45880cd32b22e6b4cc66e204ae77d93fec7ed","blockloop","2021-03-24 20:55:39","true","CI: add build targets for broker and operator (#9)",144,35,0,0,"2018-04-16 10:25:39","1068.94"
"grafana/loki","e734ee7b0e8e4c12ce1c10c89e334674d7cd7776","tomwilkie","2018-12-11 14:52:04","false","Add cert files to loki image to it can table to bigtable.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",12,8,0,0,"2018-04-16 10:25:39","235.19"
"grafana/loki","fd451d97f4d6a51ea1f67c1959def077ffb78ee4","sandeepsukhani","2020-11-06 07:28:59","true","fix flaky load tables test for boltdb-shipper uploads table-manager (#2891)",127,31,0,1,"2018-04-16 10:25:39","930.38"
"grafana/loki","26fc489d411c601621c709a1964e079d61d0c588","sandeepsukhani","2022-07-21 01:39:44","true","tsdb store refactoring (#6724)

* do not make global tsdb store instance

* upload index to storage during ingester shutdown",70,51,0,1,"2018-04-16 10:25:39","1555.63"
"grafana/loki","cd723c0479fc8bbdd1a01b6cee0e129503f58d08","sandeepsukhani","2020-11-18 12:20:17","true","Boltdb shipper query readiness (#2911)

* add support for downloading index on startup in boltdb-shipper for query readiness

* tests

* pass context to load tables function to be able to cancel the operation

* add missing call to tablemanager.stop when loading of tables fail",120,31,0,1,"2018-04-16 10:25:39","942.58"
"grafana/loki","9773b117fd9a6e7e6777435bef85887107503c17","terjesannum","2020-01-15 15:51:50","false","helm: add podsecuritypolicy for fluent-bit (#1506)",102,21,0,0,"2018-04-16 10:25:39","634.48"
"grafana/loki","65d5fd80339c3b5ed63633011fd84bcfb0ce1cb5","vlad-diachenko","2023-01-24 15:16:10","true"," fixed logql-analyzer (#8258)

Signed-off-by: Vladyslav Diachenko <vlad.diachenko@grafana.com>",83,57,1,0,"2018-04-16 10:25:39","1739.2"
"grafana/loki","30fe6b9977e836085e6a349a3c76778b85bd9058","vlad-diachenko","2022-11-01 09:24:17","true","[CI] improvement of code coverage check (#7428)

**What this PR does / why we need it**:
changed the check step to compare code coverage with `target` branch,
not with `main`.

Previously, it compared code coverage with coverage in the `main`
branch. to do this, Drone checked out `main` branch and tried to run the
tests to report the coverage. Also, Drone ran the tests on the current
branch, and after that compared the results and reported them to PR as a
comment.

However, if the PR is opened against not `main` branch, for example,
against `release-2.6.x` branch, drone tried to compare coverage between
the source branch from PR and `main`. However, `main` might contain
breaking changes that prevent Drone from compiling the sources or from
running the tests successfully.

Last time, it was Go version. Loki in `main` branch was migrated to
go1.19 and `loki-build-image` was updated. however, Drone CI on release
branch ran the pipeline on old `loki-build-image` that was not able to
compile the Loki from `main` branch.",88,54,1,0,"2018-04-16 10:25:39","1655.96"
"grafana/loki","6069df8f7d17ffce07f4dc5351380ce3a6cef791","sandeepsukhani","2023-10-23 09:53:36","true","ingestion: native otlp ingestion support (#10727)

**What this PR does / why we need it**:
Add support for natively supporting logs ingestion in OTLP format.
`/otlp/v1/logs` is the new endpoint where users can push logs in OTLP
format. It accepts logs serialized in JSON or proto format. Since OTEL
format is very different than what Loki storage model, here is how data
in OTEL format will be mapped to Loki data model:

* Index labels: The Resource Attributes map quite well to Index labels
in Loki since both usually identify the source of the logs. The problem
however is that Resource attributes in OTLP can have an unbounded number
of values while Loki has a default limit of having up to 30 labels.
Since Index labels in Loki can largely drive the kind of querying
experience the users are going to have, we have chosen select attributes
which would be picked as Index Labels. The ones that are not picked up
as Index labels would be stored as Structured Metadata with each log
entry.
* Timestamp: LogRecord.TimeUnixNano
* LogLine: LogRecord.Body holds the body of the log. However, since Loki
only supports Log body in string format, we will stringify non-string
values using [AsString method from OTEL collector
lib](https://github.com/open-telemetry/opentelemetry-collector/blob/ab3d6c5b64701e690aaa340b0a63f443ff22c1f0/pdata/pcommon/value.go#L353).
* Structured Metadata: Anything which can’t be stored in Index labels
and LogLine. Here is a non-exhaustive list of what will be stored in
Structured Metadata to give a sense of what it will hold:
* Resource Attributes not stored as Index labels is replicated and
stored with each log entry.
* Everything under InstrumentationScope is replicated and stored with
each log entry.
* Everything under LogRecord except LogRecord.Body,
LogRecord.TimeUnixNano and sometimes LogRecord.ObservedTimestamp.

*NOTES*:
* Since Loki does not support `.` or any other special characters other
than `_` in label names, we replace all non-supported characters with
`_`.
* Since Loki only supports string in values of Index Labels and
Structured Metadata, all the complex types are converted as follows:
* Map would be flattened into label keys using `_` as separator, same as
how we do it in [json parser in
LogQL](https://grafana.com/docs/loki/latest/query/log_queries/#json).
* Everything else is stringified using [AsString method from OTEL
collector
lib](https://github.com/open-telemetry/opentelemetry-collector/blob/ab3d6c5b64701e690aaa340b0a63f443ff22c1f0/pdata/pcommon/value.go#L353)

**Special notes for your reviewer**:
I will open follow-up PRs for:
* Documentation
* Make blessed attributes list configurable per tenant.

**Checklist**
- [x] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label",25,66,1,1,"2018-04-16 10:25:39","2013.23"
"grafana/loki","143672e643aa2519de0de134e750bac82d7f77ad","sandeepsukhani","2020-09-10 13:22:00","true","add support for building querytee (#2602)",116,29,0,1,"2018-04-16 10:25:39","874.62"
"grafana/loki","a1d46d2bcc077e75333f2b23a0bcbe08dc8dadd6","DylanGuedes","2022-11-08 00:01:15","true","Docs: Add missing changelog entry for stream sharding (#7622)

**What this PR does / why we need it**:
Add missing changelog entry for the new stream sharding feature.
This will be better detailed under the release notes doc.",89,55,1,1,"2018-04-16 10:25:39","1662.57"
"grafana/loki","841befaf8eaa58adc953caf10b0b0c3cfb8060b3","owen-d","2020-01-24 13:09:57","false","Feature/query ingesters within (#1572)

* querier.query-ingesters-within

* avoids an unnecessary heapIter

* updates changelog/config readme

* variable reuse",99,21,0,1,"2018-04-16 10:25:39","643.36"
"grafana/loki","4032c927cbbadc08847cfcc6a721ef5b92cda032","owen-d","2020-08-31 20:31:13","true","strict rule unmarshaling (#2580)",119,28,0,1,"2018-04-16 10:25:39","865.92"
"grafana/loki","b6ff9d588964f0d25e2a8ceb95d96e140d179318","MichelHollands","2022-05-18 10:24:54","true","Add integration test for delete request (#6188)

* Add integration test for delete request

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Add line filter

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",73,49,0,1,"2018-04-16 10:25:39","1493"
"grafana/loki","125cfbfd5beea4c519aca3e3ffadc8f81f194f16","pstibrany","2019-11-26 19:46:17","false","pkg/promtail/client: Handle fingerprint hash collisions (#1254)

* Handle fingerprint hash collisions

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>

* Instead of using fingerprints, use label strings as map keys.

Label strings are properly sorted key=value pairs. This solution
produces more garbage, but doesn't reinvent its own hashing, and keeps
code simple.
This seems to be a good tradeoff for promtail.

Signed-off-by: Peter Štibraný <peter.stibrany@grafana.com>",82,19,0,0,"2018-04-16 10:25:39","585.64"
"grafana/loki","0ac1ce4e5a502245f10279e336d0db52d8590672","cnbailian","2020-09-29 08:57:45","true","Querier APIs respond JSON Content-Type (#2665)",122,29,0,0,"2018-04-16 10:25:39","893.44"
"grafana/loki","7072ed702aec87ea8179d7746d81fb0df0d4c8a1","tivvit","2019-10-23 14:50:20","false","typo fix",67,18,0,0,"2018-04-16 10:25:39","552.43"
"grafana/loki","9ab3800522a04c82e52d2e40845735eab61c2aac","sandeepsukhani","2020-06-22 08:46:22","true","boltdb shipper download failure handling and some refactorings (#2156)",143,26,0,1,"2018-04-16 10:25:39","796.43"
"grafana/loki","a9f25a35d68d55d7e14d66da43b65475d4034ba2","sh0rez","2020-03-05 18:03:16","true","fix typo: Not a binary operator: = (#1776)",116,22,0,0,"2018-04-16 10:25:39","684.57"
"grafana/loki","418b0bc1ef435cd7bb59870f76d2c1fc863bc440","tomwilkie","2018-11-20 11:14:22","false","Regij to improve type safety.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",5,7,0,0,"2018-04-16 10:25:39","214.03"
"grafana/loki","41c19ec747f9b069baa6934bc6b414c5e2a11172","rissson","2023-05-26 14:52:24","true","helm: support of annotations to deployments and statefulsets (#9509)

**What this PR does / why we need it**:

Allows annotating loki components with custom annotations. For instance:

```yaml
loki:
  annotations:
    secret.reloader.stakater.com/reload: loki-aws-credentials
```

**Which issue(s) this PR fixes**:
No issue

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
  - Helm chart section is empty.
- [x] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [x] N/A Changes that require user attention or interaction to upgrade
are documented in `docs/sources/upgrading/_index.md`

Signed-off-by: Marc 'risson' Schmitt <marc.schmitt@risson.space>",68,61,1,0,"2018-04-16 10:25:39","1866.44"
"grafana/loki","9d7691a52eb3a23bc6886b463cece82a21f57c3c","tomwilkie","2019-02-03 10:25:22","false","Move stuff from file -> targets to prevent the stutter; move tests about; update broken rebase.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",80,9,0,0,"2018-04-16 10:25:39","287"
"grafana/loki","4da0f637890455389deeb5b0fe67a103e8ab8117","MasslessParticle","2023-06-22 21:35:17","true","Remove unused Value field (#9774)

We didn't end up needing the `Value` field because we can express
everything we need to as selectors",63,62,1,1,"2018-04-16 10:25:39","1892.72"
"grafana/loki","7c4906786d1a119932068b4717270a69758f7e50","slim-bean","2020-01-09 19:13:14","false","pre-fetch the next chunk in parallel to processing the current chunk such that we aren't waiting for fetches from GCS and spend all our CPU time decompressing and processing (#1495)

Signed-off-by: Edward Welch <edward.welch@grafana.com>",103,21,0,1,"2018-04-16 10:25:39","628.62"
"grafana/loki","8e9009a7e3c245dba913b44d204d60cc9b2642da","jeschkies","2022-02-09 09:29:59","true","Speed up `EntrySortIterator` by 20%. (#5318)

**What this PR does / why we need it**:
This patch replace the underlying heap of the `EntrySortIterator`. Instead of using a min or max heap the entry iterators are sorted at the beginning. Once the iteration starts only the first entry iterator is re-positioned depending on its current value. This will yield the same runtime complexity as the current heap based solution. However, since the new algorithm accesses the first element it can be cached. Thus the number of access calls to `Entry().Timestamp` are halved.

```
› benchstat before.txt after.txt
name                        old time/op  new time/op  delta
SortIterator/merge_sort-16  4.40ms ± 4%  4.38ms ± 3%     ~     (p=0.400 n=9+10)
SortIterator/sort-16        3.65ms ± 2%  2.80ms ± 3%  -23.25%  (p=0.000 n=9+10)
```

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Documentation added
- [ ] Tests updated
- [ ] Add an entry in the `CHANGELOG.md` about the changes.",281,46,0,1,"2018-04-16 10:25:39","1388.71"
"grafana/loki","d1aff7b29f94cfb2a2ccb655ca582edaf2688aba","sandeepsukhani","2022-04-18 13:55:29","true","store: fix bug in getting chunk ids from ingesters when using boltdb-shipper (#5945)

* initialize async store in store factory function itself

* add a comment about QueryIngestersWithin",322,48,0,1,"2018-04-16 10:25:39","1463.15"
"grafana/loki","18a443f9992ee9904d7c03f29164c26fcae5638b","trevorwhitney","2022-09-09 15:44:35","true","Fix helm release name template (#7123)

**What this PR does / why we need it**:

The helm release job is failing because it's looking for the wrong
release name. This is an attempt to fix it.

**Special notes for your reviewer**:

The addition of `on: pull_request` to the github action is a temporary
hack so I can test if this fixes the issue. Please don't merge until we
have a chance to remove that.",85,53,1,1,"2018-04-16 10:25:39","1604.22"
"grafana/loki","05b41186be9ddeb32dcdb65eb43f7517ce06ea8d","periklis","2021-04-16 11:32:38","true","Use RELATED_IMAGE_LOKI for operand img pinning on production builds (#26)",161,36,0,1,"2018-04-16 10:25:39","1095.8"
"grafana/loki","96ff7f900be1a29ea2186a26cba26b10d4824236","owen-d","2022-02-01 06:30:51","true","Revert ""Adding a docs page that helps users understand memberlist a bit more (#5186)"" (#5286)

This reverts commit 7e372cbc56e1871393bde593b5f5fb2246548de5.",276,45,0,1,"2018-04-16 10:25:39","1380.59"
"grafana/loki","bd52505a7a5ffa61206cdc70ca4d99a014adec00","periklis","2023-04-28 18:43:28","true","operator: Prepare community release v0.3.0 (#9216)",79,60,1,1,"2018-04-16 10:25:39","1838.6"
"grafana/loki","0dc05857acc1bf6c4af3ddc03731995ec54e8f2d","jgehrcke","2020-04-07 15:35:39","true","fluentd loki plugin README: add note about labels (#1909)

* fluentd loki plugin README: add note about labels

* fluentd loki plugin README: PR feedback",116,24,0,0,"2018-04-16 10:25:39","716.47"
"grafana/loki","ed962f2b449d723d455f8c3c45aeb76f58d7f0df","cyriltovena","2019-04-17 12:36:36","false","Adds json log entry parser with configuration.",103,12,0,1,"2018-04-16 10:25:39","366.34"
"grafana/loki","0ffa65a307d599bee707a9784b37e33751c1b3b7","cyriltovena","2020-02-25 14:32:33","true","Fixes frontend args in libsonnet. (#1739)

I forgot to update it to use common args.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",117,22,0,1,"2018-04-16 10:25:39","674.42"
"grafana/loki","3829b707c3842c73a5a44f4d2139b5b9b6edaf6d","cyriltovena","2020-03-17 21:20:09","true","Optimize empty filter queries. (#1810)

* Optimize filter queries such as `{label=""foo""} |~ """" |~ "".*"" |= """"` doesn't contains a filter.

The query is not really rewritten and the stringer func still returns the correct original query.
However the `Filter` func of the `Expr` returns nil which what is being checked when splitting queries in the frontend and also what is being used in the memchunk.

see https://github.com/grafana/loki/blob/master/pkg/querier/queryrange/roundtrip.go#L81 and https://github.com/grafana/loki/blob/master/pkg/chunkenc/memchunk.go#L614

Fixes #1792

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add missing tests with combination of empty or regex.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Review feedback.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",114,23,0,1,"2018-04-16 10:25:39","696.7"
"grafana/loki","1dfee23b65c66acced64bba2bb8cded18b0dfe7c","cyriltovena","2019-08-01 19:16:58","true","replace gzip golang package by github.com/klauspost/compress (#831)

* replace gzip golang package by github.com/klauspost/compress

* cleanup import

* revert grafana tag image",106,15,0,1,"2018-04-16 10:25:39","470.62"
"grafana/loki","50ef4f2ebd8b0322678469b57fef9541228dbdfb","btaani","2022-05-31 12:19:40","true","Add duration filter unit test (#6271)",73,49,0,0,"2018-04-16 10:25:39","1506.08"
"grafana/loki","92a4e574483c2f629141975075c30a2a07f210a9","owen-d","2021-08-09 09:15:11","true","ingester.index-shards config (#4111)

* consistent shard mapping test & better error msg

* ingester.index-shards config

* loki fails to start if the ingester & schema factors arent compatible.

* lint

* docs

* update changelog",110,40,0,1,"2018-04-16 10:25:39","1208.7"
"grafana/loki","531905c06641ea7515faa32e00749d1a5659a1ff","kavirajk","2022-01-28 17:39:04","true","Remove `cortex` references from `go.mod` and makefile (#5269)

* Remove cortex references from `go.mod` and makefile

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Remove from `modules.txt`

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",275,45,0,1,"2018-04-16 10:25:39","1378.05"
"grafana/loki","9ed7fa9df4eab61aad85b7b34b439ffa68ec24e3","DylanGuedes","2023-07-14 10:44:43","true","WriteFailures: Add metrics to increase monitoring (#9904)

**What this PR does / why we need it**:
Add metrics for our write failures manager. This way we can easily monitor how much logging we're doing and how much we're discarding.

**Which issue(s) this PR fixes**:
N/A",57,63,1,1,"2018-04-16 10:25:39","1914.26"
"grafana/loki","2e1cd0fbac843ff1d5cff90e5db8a23250c4a843","tomwilkie","2018-05-16 12:10:16","false","ingest client should be a querier; responses are in json.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",0,1,0,0,"2018-04-16 10:25:39","30.07"
"grafana/loki","1ad75d0b63ca9cd7f0767d4fe7b30539fdb53578","sandeepsukhani","2022-06-03 12:59:39","true","do not initialize tsdb index store when using index gateway client for queries (#6305)

* do not initialize tsdb index store when using index gateway client for queries

* fix test

* lint",72,50,0,1,"2018-04-16 10:25:39","1508.11"
"grafana/loki","6b1783179744d0f8fb8292090ee73eef9b044624","owen-d","2020-10-12 13:14:37","true","better tenant logging in ruler memstore (#2741)",111,30,0,1,"2018-04-16 10:25:39","906.62"
"grafana/loki","934d56fe5e97659512c92a7998d06406abb81ac7","chaudum","2022-07-18 08:56:22","false","Add function to reset boltDBIndexClientWithShipper singleton

In a downstream project I have a test case that creates multiple stores
with different BoltDB shipper schema configurations. Since the client
for the store is a singleton and is re-used, there needs to be a
function to reset it as well.

This function must only be used in tests.

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",69,51,0,1,"2018-04-16 10:25:39","1552.94"
"grafana/loki","4d18a5b006b9fc494c559855891c6483b84ac0f4","kavirajk","2023-07-19 14:36:12","true","loki: Add `CODEOWNERS` file (#9961)

**What this PR does / why we need it**:
This is to have CODEOWNERS file consistent across all projects under
github.com/grafana

**Which issue(s) this PR fixes**:
Fixes #NA

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",58,63,1,1,"2018-04-16 10:25:39","1919.42"
"grafana/loki","4567d01ac644fb87c4f1d7c7e1d980827da657d6","DylanGuedes","2022-11-29 17:52:39","true","Loki: Add new sharding metrics (histogram based) (#7762)

**What this PR does / why we need it**:
Add histogram-version of two existing stream sharding metrics. The new
metrics are:
- `rate_store_stream_shards`: Will show us the distribution of shards
reported by ingesters. This will help us on monitoring the number of
shards we're dealing with. As of now we only have access to the max
number of shards seen, which is helpful but not enough.
- `rate_store_stream_rate_bytes`: Same as below: will help us understand
the distribution of stream sizes instead of only showing us the max
stream size seen.",94,55,1,1,"2018-04-16 10:25:39","1684.31"
"grafana/loki","4891e28bff86840722fff24768a71d011c8e34cb","chaudum","2022-04-29 13:02:36","true","Decrease log level for ""failed to put to memcached"" (#6018)

Since failing to put to memcache does not have an operational impact on
the write path, this log message should not be an error. Make it a
warning instead.

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",93,48,0,1,"2018-04-16 10:25:39","1474.11"
"grafana/loki","0e5447730941e76cec448e29a6169626e5818307","DarthBenro008","2022-10-10 09:46:53","true","area(promtail): add -check-syntax functionality (#7363)

Adds `-check-syntax` to promtail which will exit just by validating the
config file. Fixes #6862.
 
Signed-off-by: Hemanth Krishna <hkpdev008@gmail.com>",94,54,1,0,"2018-04-16 10:25:39","1634.97"
"grafana/loki","1dc130d8cc4547dd17d30056023232bb21263ac4","slim-bean","2019-06-03 14:38:45","false","PR Feedback",109,14,0,1,"2018-04-16 10:25:39","412.43"
"grafana/loki","497cff7970df86643a0df10f120694acf9848aab","cyriltovena","2019-09-05 15:01:44","false","Add stream label to docker driver",121,17,0,1,"2018-04-16 10:25:39","504.44"
"grafana/loki","6053cdb9d96466920296dce1881f1f3e73c42ece","sandeepsukhani","2020-09-25 06:15:43","true","fix store query bug when running loki in single binary mode with boltdb-shipper (#2655)",118,29,0,1,"2018-04-16 10:25:39","889.33"
"grafana/loki","a48230d34387a3707b50005ae9d20c4191429926","joe-elliott","2019-10-01 16:03:25","false","Reverted cloud.google.com/go to 0.44.1 (#1097)

Signed-off-by: Joe Elliott <number101010@gmail.com>",73,17,0,0,"2018-04-16 10:25:39","530.48"
"grafana/loki","070e78e3ebe96c3112aa1b3a0337151395dd22f1","tomwilkie","2018-05-18 19:31:32","true","Merge pull request #7 from grafana/dev

Various other improvements",0,1,0,0,"2018-04-16 10:25:39","32.38"
"grafana/loki","030d3232ff2ab8bf8a25d670a9f4566985bb35c4","DylanGuedes","2023-02-22 20:39:37","true","Loki: Fix memchunk headblock filter (#8591)

**What this PR does / why we need it**:
Fix our memchunk headblock filter to not skip entries that have
timestamp=maxT.",66,58,1,1,"2018-04-16 10:25:39","1767.43"
"grafana/loki","08e505dd50915d2bdbb678211449e56d6c84ac08","salvacorts","2023-06-27 15:09:41","true","Return all errors for a failed push request (#9807)

**What this PR does / why we need it**:
Distributors enforce limits and validate each push payload. before this
PR, if a single push request yields multiple errors, only the last error
is forwarded to the client.

This PR modifies the distributor push handler so we forward all errors
from a single push request to the client.

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

- I wonder if the use of [MultiError][1] is well-suited for this. [This
test case][2] will return 100 errors with the same content. I wonder if
we can leverage the MultiError to group errors that have the same
content. Printing for example: `1 error like: 'Error parsing labels...';
100 errors like: 'Max entry size...'`. This would require extra
processing but If we do this processing in the Error() method I think it
should be ok-ish?
- **Edit:** I ended up implementing this in
[4b0816f](https://github.com/grafana/loki/pull/9807/commits/4b0816f67f3a92dbf321d378baf938cc2e679087)

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [x] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)


[1]:
https://github.com/grafana/loki/blob/d4a472893341b576394db3e02539c82d33bbf43a/pkg/util/errors.go#L32
[2]:
https://github.com/grafana/loki/blob/f544b93c200581d5857143171d0fe793257980ec/pkg/distributor/distributor_test.go#L75",62,62,1,1,"2018-04-16 10:25:39","1897.45"
"grafana/loki","29b07d190de2edab4fc03333e3e224d824b5a677","sandeepsukhani","2021-08-19 11:14:53","true","Retention speedup (#4172)

* drop the multi table chunk entries from index when the whole table is out of retention

* speed up cleaning of deleted series from index

* mark partially deleted chunk for deletion when all its tables are processed",132,40,0,1,"2018-04-16 10:25:39","1218.78"
"grafana/loki","dbfd81b8683b56a7e2b98e367cfe837dbc217e5e","JStickler","2023-09-07 18:03:39","true","Fix broken redirect (#10510)

Fix a broken alias that is generating 404 errors",43,65,1,0,"2018-04-16 10:25:39","1967.57"
"grafana/loki","f70c7ea0bc9bb678c828b4d42c85328528c4ef43","garrettlish","2021-03-22 10:22:51","true","Implement offset modifier for range vector aggregation in LogQL (#3455)

* Implement offset modifier for range vector aggregation in LogQL

implementation for https://github.com/grafana/loki/issues/2785, the offset modifier allows changing the time offset for range vectors in a query to support e.g. selective timeshift in Grafana

Signed-off-by: garrettlish <garrett.li.sh@gmail.com>

* add docs for offset modifier

* refine offset expr

* add offset unit test in engine.go

* remove duplicated offset shift

* add offset test in range vector test

Co-authored-by: garrettlish <garrettlish@163.com>",140,35,0,0,"2018-04-16 10:25:39","1066.5"
"grafana/loki","572c248a2a1b34f0bb457df17efd9b206ab2fefa","oddlittlebird","2020-08-14 11:11:59","true","Update README.md (#2500)",117,28,0,0,"2018-04-16 10:25:39","848.53"
"grafana/loki","813373bab33e6cc948f6b28c30b6abee15cbb427","ronensc","2022-03-07 17:49:53","true","operator: Add steps to check and run the prometheus rule tests in GitHub action (#5564)",301,47,0,0,"2018-04-16 10:25:39","1417.06"
"grafana/loki","594b596d67e6ec5f3bd0cdf577bc6064794d71b3","cyriltovena","2021-03-19 13:35:43","true","Fixes broken link in the documentation. (#3516)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",167,35,0,1,"2018-04-16 10:25:39","1063.63"
"grafana/loki","5697bec427a892b9f404449363eff962d2e79aaf","salvacorts","2023-04-14 13:56:54","true","Move misplaced recent changes in changelog to Loki Enhancements (#9137)

**What this PR does / why we need it**:
Some changelog entries were misplaced into _Promtail Enhancements_
instead of _Loki Enhancements_. This PR fixes this by moving the items
to the correct section.

**Which issue(s) this PR fixes**:
Fixes https://github.com/grafana/loki/pull/9042

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",80,60,1,1,"2018-04-16 10:25:39","1819.15"
"grafana/loki","96a3e7790121ecf9e8d3b522cb82a552a50735fa","kulmannf","2022-09-07 19:49:27","true","Bump github.com/docker/docker to v20.10.17 (#6975)

<!--  Thanks for sending a pull request!  Before submitting:

1. Read our CONTRIBUTING.md guide
2. Name your PR as `<Feature Area>: Describe your change`.
a. Do not end the title with punctuation. It will be added in the
changelog.
b. Start with an imperative verb. Example: Fix the latency between
System A and System B.
  c. Use sentence case, not title case.
d. Use a complete phrase or sentence. The PR title will appear in a
changelog, so help other people understand what your change will be.
3. Rebase your PR if it gets out of sync with main
-->

**What this PR does / why we need it**:
The `v20.10.17` release of moby (`github.com/docker/docker` in go.mod)
fixed several CVEs described in their [release
notes](https://github.com/moby/moby/releases/tag/v20.10.17). This PR
upgrades the dependency to that version.

**Which issue(s) this PR fixes**:
N/A

**Special notes for your reviewer**:
N/A

<!--
Note about CHANGELOG entries, if a change adds:
* an important feature
* fixes an issue present in a previous release, 
* causes a change in operation that would be useful for an operator of
Loki to know
then please add a CHANGELOG entry.

For documentation changes, build changes, simple fixes etc please skip
this step. We are attempting to curate a changelog of the most relevant
and important changes to be easier to ingest by end users of Loki.

Note about the upgrade guide, if this changes:
* default configuration values
* metric names or label names
* changes existing log lines such as the metrics.go query output line
* configuration parameters 
* anything to do with any API
* any other change that would require special attention or extra steps
to upgrade
Please document clearly what changed AND what needs to be done in the
upgrade guide.
-->
**Checklist**
- [ ] Documentation added
- [ ] Tests updated
- [ ] Is this an important fix or new feature? Add an entry in the
`CHANGELOG.md`.
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",85,53,1,0,"2018-04-16 10:25:39","1602.39"
"grafana/loki","822d60507bffa8c6c13956e626d89a2482253293","cstyan","2021-12-01 06:44:51","true","log the user ID in the rate limit error message. (#4852)

Signed-off-by: Callum Styan <callumstyan@gmail.com>",213,43,0,1,"2018-04-16 10:25:39","1320.6"
"grafana/loki","bdee4a37417f6c3f5e1087c6353866c046b5a42c","cyriltovena","2021-06-15 10:19:08","true","Logs ingester and store queries boundaries. (#3849)

example:
```
 ts=2021-06-14T08:43:30.015895283Z caller=spanlogger.go:87 org_id=4336 traceID=0b6bb74a53efd739 level=debug msg=""querying ingester"" params=""selector={stream=\""stdout\"", pod=\""loki-canary-6  64d9d8d8f-99k22\""}, direction=BACKWARD, start=2021-06-14 08:17:03.037241855 +0000 UTC, end=2021-06-14 08:17:23.037241855 +0000 UTC, limit=1000, shards=""
 ts=2021-06-14T08:43:30.016305592Z caller=spanlogger.go:87 org_id=4336 traceID=0b6bb74a53efd739 level=debug msg=""querying store"" params=""selector={stream=\""stdout\"", pod=\""loki-canary-664d  9d8d8f-99k22\""}, direction=BACKWARD, start=2021-06-14 08:17:03.037241855 +0000 UTC, end=2021-06-14 08:17:23.037241855 +0000 UTC, limit=1000, shards=""
```

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",118,38,0,1,"2018-04-16 10:25:39","1154.75"
"grafana/loki","8d8a8bb68e32f5de785a6dc9f156039b09772bfc","cyriltovena","2019-06-17 19:47:00","false","bump chart",83,14,0,1,"2018-04-16 10:25:39","426.64"
"grafana/loki","305b41aedb86185a430ee663be865d6c24009316","cyriltovena","2022-01-05 12:03:29","true","Improve title of the chunk dashboard. (#5041)

I was looking at the dashboard and a bit confused by the title, so I made them more specifics.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",252,45,0,1,"2018-04-16 10:25:39","1354.82"
"grafana/loki","d5f27ee04dcdf6db9c6e8785d9a5a6c6d0a38244","cyriltovena","2020-03-18 17:21:43","true","Adds a counter for total flushed chunks per reason. (#1819)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",114,23,0,1,"2018-04-16 10:25:39","697.54"
"grafana/loki","a47a76cdb5b50ae440b90e4140a28dfdaa8a715c","cyriltovena","2021-12-09 14:15:26","true","Fixes 500 when query is outside of max_query_lookback (#4902)

* Fixes 500 when query is outside of max_query_lookback

We were using cortex middleware to apply this limit, but when the max_query_lookback was enforced it was generating
a reponse that is not known to Loki.

And since Loki frontend support many other type of reponses (Series,Labels,...) I had to fork the code in Loki.

I added a regression tests and also enforce the limit for labels API which was for some reason omitted.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add changelog entry

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes a tests

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",219,44,0,1,"2018-04-16 10:25:39","1328.91"
"grafana/loki","72b4c0181aee7b1e3a641838ba92002fbbbd8239","oddlittlebird","2020-12-04 15:17:10","true","Update _index.md (#3032)",128,31,0,0,"2018-04-16 10:25:39","958.7"
"grafana/loki","3c792294d2724b6870c2f682aad34a4b1dc1b90b","DylanGuedes","2022-11-07 09:38:45","true","Loki: Fix index_set log message (#7538)

As of now, this log message isn't correctly showing the list of files
(instead it logs the value as ""unsupported value type"").",89,55,1,1,"2018-04-16 10:25:39","1661.97"
"grafana/loki","b1cd5da607c5ce95745b96dc495187d36b552f93","ashwanthgoli","2023-08-23 05:18:58","true","upgrade doc: suggest disabling transfers (#8648)

**What this PR does / why we need it**:
Explicitly mention that WAL and `ingester.max-transfer-retries` are
[incompatible](https://github.com/grafana/loki/blob/ashwanth/disable-transfers-upgrade-doc/pkg/ingester/ingester.go#L146)
in 2.4.0 upgrade notes.
Given that WAL is enabled by default, suggest users to unset
`ingester.max-transfer-retries` in case they explicitly configured it.

**Which issue(s) this PR fixes**:
Fixes #8625

**Special notes for your reviewer**:

**Checklist**
- [X ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [X ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

---------

Signed-off-by: Ashwanth Goli <iamashwanth@gmail.com>",50,64,1,0,"2018-04-16 10:25:39","1953.04"
"grafana/loki","ff0a4c35f4103803682f105adb28b834f3dff88a","adityacs","2020-05-26 20:48:10","true","Set JournalTarget Priority value to keyword (#2087)",124,25,0,1,"2018-04-16 10:25:39","770.93"
"grafana/loki","863db344fbad6e43cb7c95e52a7f643472d7cb47","davkal","2019-03-29 15:55:05","true","Merge pull request #424 from marefr/docs_enhancement

docs: link to grafana documentation for loki provisioning",93,11,0,0,"2018-04-16 10:25:39","343.23"
"grafana/loki","180fb09e619467cc175d49449c0c2d8ba54f6d53","tomwilkie","2018-06-24 12:49:48","true","Merge pull request #13 from grafana/label-values

Plumb through label value queries.",1,2,0,0,"2018-04-16 10:25:39","68.1"
"grafana/loki","880de930934049926bef1b85822be0150e6a2ec2","jeschkies","2023-02-17 16:31:14","true","Document memcached configuration for caching. (#8373)

**What this PR does / why we need it**:
Memcached is our default options for caching. However, the options for Memcached are not well documented.

This change documents how Memcached should be configured and how Loki itself should be documented based on our ksonnet deployment.

**Checklist**
- [ ] Reviewed the [`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md) guide (**required**)
- [x] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are documented in `docs/sources/upgrading/_index.md`

Co-authored-by: J Stickler <julie.stickler@grafana.com>",71,58,1,1,"2018-04-16 10:25:39","1762.25"
"grafana/loki","ca1a5be97500d67caa68f9f3fdbd6f5c301c28cf","slim-bean","2019-03-20 17:56:06","false","Adding metric and alert to notify promtail falling behind (#412)

* Adding the metric promtail_file_bytes_total which will report on the total size of each file with an active tailer.
Added an alert which will fire whenever the total bytes for a file is 100kb or more ahead the read bytes for more than 15mins.
Added an additional alert to track client bytes ready to send (encoded bytes) vs actually sent so we can add an alert on promtail send failures and still track stats on encoded bytes being sent.

* Moving where we update the total file bytes outside the tailer so it shouldn't get hung up by tailer issues.

* Recording file size based on Glob matches rather than what we are tailing to give even better insight",91,11,0,1,"2018-04-16 10:25:39","334.31"
"grafana/loki","cb383d69067ab66a6b33e0e4fd8bff531122a9e7","chancez","2020-11-05 14:38:23","true","production/ksonnet: Add config_hash annotation to gateway deployment based on gateway configmap (#2852)",129,31,0,0,"2018-04-16 10:25:39","929.68"
"grafana/loki","a7976b584f54737a8ac47cb8dd6efab26a50934c","irapuan","2023-05-30 08:01:34","true","Fix link to API docs (#9517)

**What this PR does / why we need it**:

Fix the link to the API docs. 

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

Co-authored-by: Irapuan Bottosso <irapuan@Irapuans-MacBook-Pro-2.local>",70,61,1,0,"2018-04-16 10:25:39","1870.15"
"grafana/loki","8809de60877b08605111c52b556e74feefe55100","adityacs","2020-07-14 18:31:35","true","refactor promtail target manager code (#2345)",118,27,0,1,"2018-04-16 10:25:39","818.84"
"grafana/loki","248f9e25e46fb5980cb68ecf6b1be69b31730945","tomwilkie","2018-06-25 13:26:28","false","Move iterators to own package; check in protos and parser to make CLI go gettable.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",1,2,0,0,"2018-04-16 10:25:39","69.13"
"grafana/loki","ebdb64b3f50ad2ca94fcf3b004e5ea23307cc2c6","MichelHollands","2022-09-09 08:50:27","true","Small updates to the deletion documentation (#7112)

**What this PR does / why we need it**:

- Fix a typo
- Fix the links in for the deletion API 

**Checklist**
- [X] Documentation added
- [ ] Tests updated
- [ ] Is this an important fix or new feature? Add an entry in the
`CHANGELOG.md`.
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",85,53,1,1,"2018-04-16 10:25:39","1603.93"
"grafana/loki","f80e487dcf106a6c4ea0a82d8afe7b0104addbc3","MichelHollands","2022-06-22 16:16:04","true","Remove whole stream deletion mode (#6435)

* Remove whole-stream-deletion mode

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Remove whole-stream-deletion from docs

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Update the changelog

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Sort changelog entries

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Remove link to wrong configuration

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Fix integration test

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Set default deletion mode to disabled

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Remove extra white line in documentation

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Fix default value in docs

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Fix changelog

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Add DeletionEnabled method on mode

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>

* Rename test

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",69,50,0,1,"2018-04-16 10:25:39","1527.24"
"grafana/loki","26f3b52096d290d56f0791e260f00e5657c26bd8","tomwilkie","2019-02-05 17:00:08","false","Relax restriction on timestamp reuse in chunks, add test.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",80,10,0,0,"2018-04-16 10:25:39","289.27"
"grafana/loki","67a5c19b1717ba367e989d74778eedc375e60a26","jeschkies","2022-01-11 20:18:54","true","Enable merge union strategy for CHANGELOG.md. (#5102)

Summary:
This provides a reasonable automatic merge strategy for changelog
entries. No more merge conflicts on changelog changes.",258,45,0,1,"2018-04-16 10:25:39","1361.16"
"grafana/loki","8d552878cd562c9d28bfc4bdcac0ffec2de52333","trevorwhitney","2022-09-19 15:44:43","true","Bring addition of server config into existing style (#7174)

**What this PR does / why we need it**:

A recent PR (https://github.com/grafana/loki/pull/7137) was merged to
make the server settings more configurable in the helm chart. This PR
fixes a few style nits with that PR, mainly:

* Name the config block the same as the header in the actual loki config
file (in this case, `server` not `serverConfig`)
* Use `with`, and wrap around the header in the config file so the
entire section is omitted if empty, rather than setting an empty object
under the header.",87,53,1,1,"2018-04-16 10:25:39","1614.22"
"grafana/loki","a18ca92375d96ec0716736873e4323afa1689ef8","dannykopping","2023-08-17 12:38:21","true","Track effectiveness of hedged requests (#10281)

**What this PR does / why we need it**:
We currently have request hedging implemented in many object store
clients. Right now we track how many hedged requests we make, and how
many are rate-limited, but nothing actually tells us _how effective_ the
hedged requests are. In other words, we don't know how many hedged
requests were issued and _won_ (completed before the original).",52,64,1,1,"2018-04-16 10:25:39","1947.34"
"grafana/loki","551d68210f8cde327743dcb0bfefc37436b1d49d","KMiller-Grafana","2021-07-26 09:37:41","true","Fix docs typo: IP Matching section ""=f"" becomes ""="" (#4039)",103,39,0,0,"2018-04-16 10:25:39","1195.72"
"grafana/loki","d4fdccbf6fb1730d4f472edf810a0a6361b50eaf","owen-d","2021-02-11 14:56:37","true","defaults promtail to 2.1.0 in install script (#3321)",129,34,0,1,"2018-04-16 10:25:39","1025.69"
"grafana/loki","3a0b982fe2ebc47c5cf39769828e22de3521952d","gyanesh-m","2022-08-01 07:27:18","true","Run `loki -version` without needing a config defined (#6802)

* fix version.

* address pr comment.",77,51,0,0,"2018-04-16 10:25:39","1565.88"
"grafana/loki","28d88b3fb84a53dd17c0a25b090b85762a23c849","sandeepsukhani","2021-04-07 10:57:40","true","add loki resource usage dashboard for read and write path (#3584)",147,36,0,1,"2018-04-16 10:25:39","1081.52"
"grafana/loki","e1002624bdbc570dbcdc42a9339be7b008763250","sjmiller609","2023-06-23 07:48:05","true","Helm: Add priorityClassName for Grafana Agent and Loki Canary (#8506)

**What this PR does / why we need it**:

- Allow configuring PriorityClassName for the GrafanaAgent daemonset
- Allow configuring PriorityClassName for the loki canary daemonset
without also configuring for read deployment
- Helpful when an administrator wants to prioritize logging on their
nodes

**Special notes for your reviewer**:

- Used _coalese_ style like it was already in the case of loki canary
- For loki canary, specifying on the canary takes higher precedence than
on the reader, but lower than global
- For grafana agent, global takes precedence over grafana agent to match
the existing style, but maintainers might consider flipping that around
so that most-specific is also most-prioritized

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide

---------

Co-authored-by: Michel Hollands <42814411+MichelHollands@users.noreply.github.com>",62,62,1,0,"2018-04-16 10:25:39","1893.14"
"grafana/loki","9b5fa5e1001eb4dbcb45a011383c6c3a479d979b","kavirajk","2023-01-16 13:19:42","true","doc(distributor): Clarify `distributor.max-line-size` flag. (#8165)

**What this PR does / why we need it**:
Add a clarrification of two flags `distributor.max-line-size` and
`distributor.max-line-size-truncate`. And clarity on [discarding the
logs](https://github.com/grafana/loki/blob/main/pkg/distributor/validator.go#L84-L92)
if later is disabled while still former is set to non-zero values.

Whereas if `distributor.max-line-size-truncate` is set, [log line is
only
truncated.](https://github.com/grafana/loki/blob/main/pkg/distributor/distributor.go#L517-L534)

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

**Which issue(s) this PR fixes**:
Fixes #NA

**Special notes for your reviewer**:
Figured while working on PR #8153 

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",94,57,1,1,"2018-04-16 10:25:39","1731.12"
"grafana/loki","99eb606a125a73bb4344ef2dad21b2387ab4ec88","blockloop","2021-03-19 21:17:15","true","Merge pull request #2 from ViaQ/bjones/add-readme

add README",169,35,0,0,"2018-04-16 10:25:39","1063.95"
"grafana/loki","9a2df5a06e46c77446ad45645987bae42a8cc356","sandeepsukhani","2022-06-06 09:33:13","true","copy boltdb-shipper cache changes from PR #6054 to generic index shipper (#6316)",72,50,0,1,"2018-04-16 10:25:39","1510.96"
"grafana/loki","76e713f57dc4c16d444675c6e15526f968b3e51e","sandeepsukhani","2021-02-12 14:02:24","true","reduce number of list calls on shared object store when using boltdb-shipper (#3283)",128,34,0,1,"2018-04-16 10:25:39","1026.65"
"grafana/loki","c1cd313823c0c95ea1586ba189d759cbeb4440cc","ashwanthgoli","2023-10-12 11:00:37","true","update loki build image to use 1.21.3 (#10868)

**What this PR does / why we need it**:
Update loki build image to use 1.21.3
CVE-2023-39325 / CVE-2023-44487

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",26,66,1,0,"2018-04-16 10:25:39","2002.27"
"grafana/loki","79d53317dd34d32140fd7067fe68ad1c1c0ab26a","owen-d","2021-08-27 17:22:56","true","bumps per stream default rate limits (#4228)

After some testing, this seems a more reasonable balance between protecting ingesters and good defaults out of the box",128,40,0,1,"2018-04-16 10:25:39","1227.04"
"grafana/loki","46f044fdb7b9bd6209cce10189891f51186d0e83","DylanGuedes","2023-04-19 19:26:40","true","Loki: Fix wrong association of PSRL when sharding is enabled (#9176)

Obs: PSRL stands for `per-stream rate limit`
**What this PR does / why we need it**:
- Fixes the scenario where all entries errors are accounted as PSRL if
sharding is enabled
- Fixes invalid/rejected entries being accounted as candidates to be
inserted",77,60,1,1,"2018-04-16 10:25:39","1829.63"
"grafana/loki","0bc38e5775464fa2327e2b2cd548bcbe2e46b075","jdbaldry","2023-11-10 14:20:29","true","Update to latest version of doc-validator (#11200)

https://github.com/grafana/technical-documentation/releases/tag/doc-validator%2Fv4.0.0

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>",0,67,1,0,"2018-04-16 10:25:39","2030.41"
"grafana/loki","0a2f58891c98feee5ba2cb2848761a037caabc98","bboreham","2023-05-30 15:47:34","true","logql tests: use abstractions over Labels (#9533)

**What this PR does / why we need it**:

Call functions like `FromStrings`, so we don't have to know how the data
structure is laid out.

**Special notes for your reviewer**:

This PR only touches tests. 

Upstream Prometheus is using a different implementation of
`labels.Labels`, so I plan to create a series of PRs which make Loki
compatible with that. #9532 was the first.

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- NA Documentation added
- [x] Tests updated
- NA `CHANGELOG.md` updated
- NA Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- NA For Helm chart changes bump the Helm chart version.

---------

Signed-off-by: Bryan Boreham <bjboreham@gmail.com>",68,61,1,0,"2018-04-16 10:25:39","1870.47"
"grafana/loki","fefc33debc57c2db81ef9bfbddb1556c728ab6ff","sandeepsukhani","2022-06-03 07:05:16","true","make tsdb store instance a singleton (#6273)

* make tsdb store instance a singleton

* make it mandatory to have 24h index period config for tsdb
* avoid initializing head and tsdb manager when running tsdb store in read only mode",72,50,0,1,"2018-04-16 10:25:39","1507.86"
"grafana/loki","cfb4fc1f55d9184891c0198e7f5dde2dadd070ec","aknuds1","2021-08-27 16:14:06","true","Use flagext from dskit (#4225)

Signed-off-by: Arve Knudsen <arve.knudsen@gmail.com>",128,40,0,0,"2018-04-16 10:25:39","1226.99"
"grafana/loki","5ec5586e38345a202349c16e6eb5212e67fb4610","periklis","2021-05-14 14:12:41","true","Set query frontend replicas based on selected stack size (#52)",194,37,0,1,"2018-04-16 10:25:39","1123.91"
"grafana/loki","ecc4022d6c29fc73a88430c735653c547635ec8e","cyriltovena","2020-10-26 12:29:06","true","Improve pipeline stages ast errors. (#2805)

They would throw 500 instead of 4xx before.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",118,30,0,1,"2018-04-16 10:25:39","920.59"
"grafana/loki","5738611d64935d53e10ae318f9371b625ccff5f3","cyriltovena","2020-11-10 16:40:24","true","Fixes logql.QueryType. (#2913)

The bug was introduced with LogQL extensions.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",125,31,0,1,"2018-04-16 10:25:39","934.76"
"grafana/loki","07ece2bc2a0ff098dc064049751e5043dd9dfb71","cyriltovena","2021-01-21 08:37:35","true","Improve checkpoint series iterator. (#3193)

* Add basic benchmark.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Improves memory usage of checkpointer series iterator.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* make lint.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* better size computation.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes test ordering flakyness.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",114,33,0,1,"2018-04-16 10:25:39","1005.42"
"grafana/loki","ba51aad55176cd4d862217e21e3062d1b2ead83c","cyriltovena","2020-03-30 14:35:07","true","Logcli remote storage. (#1814)

* wip

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Start hooking logcli with local storage config.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes org-id and documentation.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Review feedback.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",121,23,0,1,"2018-04-16 10:25:39","709.42"
"grafana/loki","52655706b8fc9393983d8709c20aab5a851c222d","dannykopping","2023-04-19 08:34:04","true","Prevent redis client from incorrectly choosing cluster mode with local address (#9185)",78,60,1,1,"2018-04-16 10:25:39","1829.17"
"grafana/loki","e7abc1d55cbcc38f553b1712fa7c03a1678cc219","tomwilkie","2018-06-05 12:03:46","false","Remove dead code.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",1,2,0,0,"2018-04-16 10:25:39","49.07"
"grafana/loki","df0fdbcab9f1fc4ebadda02258722887e08c57fc","cyriltovena","2019-05-13 19:52:37","false","tidy up",99,13,0,1,"2018-04-16 10:25:39","392.64"
"grafana/loki","721256403c44e913897161e3989525f379f0cf4a","cyriltovena","2020-06-19 21:36:37","true","Reuse buffer for hash computation in the engine. (#2218)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",143,26,0,1,"2018-04-16 10:25:39","793.97"
"grafana/loki","0e2ae1ddab174772f7bb283791797e7f1c653f85","rfratto","2019-11-05 19:33:38","true","ci: fix drone deploy job (#1232)

The deploy job stopped working for some unknown reason. This commit
fixes it by moving the deploy script to its own file.",66,19,0,1,"2018-04-16 10:25:39","564.63"
"grafana/loki","0d99d80acdb24483910ced12e5bf4e3170950a81","kavirajk","2022-07-20 17:14:01","true","upgrade `go:1.17.9` to `go:1.18.4` (#6726)",70,51,0,1,"2018-04-16 10:25:39","1555.28"
"grafana/loki","7524c4b3dc5adbfa9bee02992d54e9c6d8b759c3","xinbinhuang","2023-01-11 12:02:52","true","[Helm] Add the ability to add extraObjects (#8004)

**What this PR does / why we need it**:

Add the ability to create extraObjects in helm chart. This'll allow
users to inject a configmap of loki rules or secrets for object
storages. Also, the `extraObjects` is also a common fields for helm
charts (i.e.
https://github.com/grafana/helm-charts/blob/main/charts/grafana/values.yaml#L1148)",101,57,1,0,"2018-04-16 10:25:39","1726.07"
"grafana/loki","a59616119a89f30eefc928074096b221de5bce19","ashwanthgoli","2023-11-02 11:29:50","true","docs: add migration guide for tsdb (#10978)

**What this PR does / why we need it**:
Adds a migration guide for moving from any of the older indexes to TSDB

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",14,66,1,0,"2018-04-16 10:25:39","2022.29"
"grafana/loki","8c1b14ad10af53bc61c750fcac4474dce662b85f","empollard","2023-07-24 14:26:54","true","Update _index.md (#10020)

Update for the Storage doc.

One typo under the Single Store section:
""Single-Store refers to the using object storage as ...""

Deleted ""the"" from that sentence.

**What this PR does / why we need it**:

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",54,63,1,0,"2018-04-16 10:25:39","1924.42"
"grafana/loki","2750985cc7b09ef7c475248b3a5ab358ceb933af","periklis","2023-09-12 06:07:16","true","operator: Update Loki operand to v2.9.0 (#10539)",43,65,1,1,"2018-04-16 10:25:39","1972.07"
"grafana/loki","1abe8841cef600678ff7e5de3f07bed91d4d6db3","cyriltovena","2019-10-17 21:08:49","true","Moves request parsing into the loghttp package (#1171)

* refactor query requests parsing

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* add tests and documentation

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",67,18,0,1,"2018-04-16 10:25:39","546.7"
"grafana/loki","bed1f684bd9a8bdc813c42005f43f63876a5fe54","sh0rez","2019-09-06 17:53:57","true","chore(packaging): loki windows/amd64 (#981)

Builds the loki server binary for windows as well",119,17,0,0,"2018-04-16 10:25:39","505.56"
"grafana/loki","f10535f7c1d7854eaaadf2feb0563a2bd851dabc","cyriltovena","2021-02-23 14:56:23","true","Fixes a panic with whitespace key. (#3372)

* Fixes a panic with whitespace key.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Removes empty key.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",131,34,0,1,"2018-04-16 10:25:39","1037.69"
"grafana/loki","33abab5e42035a155997ed1c1fd8c39c9032b177","cyriltovena","2021-01-26 10:11:27","true","Cortex update pre 1.7 (#3215)

* Starting to update cortex.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes ruler overrides.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* go.mod

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",121,33,0,1,"2018-04-16 10:25:39","1010.49"
"grafana/loki","ecca5d345c7c3c6d06572d019d8dd5d7cbefc46c","cyriltovena","2021-03-31 20:40:23","true","Properly release the ticker in Loki client. (#3566)

I think this was only impacting the docker driver who would start/stop for each new followed containers.
My assumption is that this would slowly build up and eat CPU over time.

Fixes #3319

I arrived to this conclusion since strace was showing a crazy amount of futex syscall and nothing else seems to be the cause.

:pray:

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",146,35,0,1,"2018-04-16 10:25:39","1075.93"
"grafana/loki","961dd3513f224d118892c0fbe88efb8aa40edc52","tomwilkie","2019-02-07 12:28:29","false","Typo.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",78,10,0,0,"2018-04-16 10:25:39","291.09"
"grafana/loki","638c25f0950a743a2006630547e190ac28b7a982","davkal","2019-04-11 14:38:43","true","Merge pull request #445 from sboschman/task-ring-config

include all lifecycler ring config",99,12,0,0,"2018-04-16 10:25:39","355.18"
"grafana/loki","907f9dbb4051f79061c958b8547c85bd629bd3b2","davkal","2019-04-17 13:26:01","true","Merge pull request #484 from daixiang0/update-troubleshooting

Update troubleshooting doc",103,12,0,0,"2018-04-16 10:25:39","366.38"
"grafana/loki","9d7413aa221ecbdd9265280049d348f714465cff","blockloop","2021-03-18 16:17:04","true","rename things",164,35,0,0,"2018-04-16 10:25:39","1062.74"
"grafana/loki","8627af119912bdd2ab6667f771b891a1a9629109","owen-d","2020-08-27 17:19:50","true","Error on no schema configs (#2564)

* ruler jsonnet

* jsonnet fixes

* errors instead of panics on no schema configs",123,28,0,1,"2018-04-16 10:25:39","861.79"
"grafana/loki","bde0389979b197c495f973b14391573527b6861b","owen-d","2020-01-23 13:22:16","false","adds span metadata for split queries (#1567)

* adds span metadata for split queries

* finishes interval span",98,21,0,1,"2018-04-16 10:25:39","642.37"
"grafana/loki","57ea330bc395c46afa7db7e057287dfd578b94e7","periklis","2022-11-17 13:39:40","true","operator: Fix LokiStackController watches for cluster-scoped resources (#7710)",93,55,1,1,"2018-04-16 10:25:39","1672.13"
"grafana/loki","381f9d2142677f88054e948fe5fdf1bde0109554","periklis","2022-06-22 08:31:31","true","operator: Add e2e local development with kind (#6339)",71,50,0,1,"2018-04-16 10:25:39","1526.92"
"grafana/loki","9bce5d7157b634daca23fb74072552d80ce3ed14","sh0rez","2019-09-09 21:28:38","true","chore(packaging): fix GOPATH being overwritten (#992)

Drone workspace was overwriting whole GOPATH, which made our executables go away",118,17,0,0,"2018-04-16 10:25:39","508.71"
"grafana/loki","32e55c30434c9fccdb22a577e8c88b9d3d9a8806","cyriltovena","2021-07-27 14:42:46","true","Fork cortex chunk storage into Loki. (#3842)

The chunk package has been forked from this commit for future reference and licensing. https://github.com/cortexproject/cortex/commit/09fe17c0e6c1c371aaf7e40927251a0622681b07",106,39,0,1,"2018-04-16 10:25:39","1196.93"
"grafana/loki","bcbb1f294e955917e2c65f0dda5c2e77d1b4a784","rfratto","2020-01-14 20:28:07","true","docs: Document timestamp ordering rules (#1521)

Co-authored-by: Ed Welch <ed@oqqer.com>",101,21,0,1,"2018-04-16 10:25:39","633.67"
"grafana/loki","670bf8348ff11ddd6fd091fc605febe9afa7e7c9","blockloop","2021-03-19 21:18:14","true","Create LICENSE.txt",169,35,0,0,"2018-04-16 10:25:39","1063.95"
"grafana/loki","38844cee61e2cad7c5c95922e5ce397845aa8ea6","davkal","2019-04-08 16:54:55","true","Merge pull request #447 from grafana/label-design-doc

adding labels design doc",100,12,0,0,"2018-04-16 10:25:39","352.27"
"grafana/loki","bf434a88d10129fdf38d850fc9efc591bb603e58","davkal","2019-02-15 15:58:55","false","Change image pull default policy to Always

- Loki and promtail are under heavy development, always pulling makes sure bug fixes are shipped",88,10,0,0,"2018-04-16 10:25:39","299.23"
"grafana/loki","2a933b7bc3681ac95db391b7bd5190550b18e5b9","cyriltovena","2020-03-17 19:34:01","true","Test stats memchunk (#1809)

* Add a test for ensuring stats computed from memchunk are correct.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add some comment

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",115,23,0,1,"2018-04-16 10:25:39","696.63"
"grafana/loki","52a9aa7674ce2f2ca0c187df3654e479ec83eff7","marcosnils","2019-10-03 13:57:59","false","Bump grafana image (#1110)",75,17,0,0,"2018-04-16 10:25:39","532.4"
"grafana/loki","44d32c5ad4185f0c917f195fb13e3272c0646403","cyriltovena","2021-11-15 17:02:20","true","Removes all GRPC warning. (#4757)

This works for logcli, promtail and Loki.

Cherry on top, removes a lot of dependencies.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",198,43,0,1,"2018-04-16 10:25:39","1305.03"
"grafana/loki","5eee25b560c2cbd0667a0dddb90d1e11072ac94f","cyriltovena","2021-01-20 02:05:13","true","Fixes unwrap expressions from  last optimization. (#3194)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",109,33,0,1,"2018-04-16 10:25:39","1004.15"
"grafana/loki","b5aae6985c02fe93b1d6257067ada7428ba24fd0","jdbaldry","2023-09-07 15:52:28","true","Fix alias to redirect `/docs/loki/<LOKI_VERSION>/best-practices/` to `/docs/loki/latest/get-started/labels/bp-labels/` (#10506)

Tested locally with `make docs`

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>",43,65,1,0,"2018-04-16 10:25:39","1967.48"
"grafana/loki","087b21fa5ec689c4b1323d4f3c1aecade1456ba8","dannykopping","2023-09-04 15:05:06","true","Update release notes for 2.9 (#10445)

Including my contributions to v2.9

---------

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",46,65,1,1,"2018-04-16 10:25:39","1964.44"
"grafana/loki","58e29de98878e37a073a49ca894050d8ad2e4126","chaudum","2023-01-25 16:02:55","true","Update golang to 1.19.5 (#8278)

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",84,57,1,1,"2018-04-16 10:25:39","1740.23"
"grafana/loki","a4f306399ad39aef8af321b527d90790aa02ec39","dannykopping","2022-12-21 06:47:09","true","Add store & cache download statistics (#7982)",97,56,1,1,"2018-04-16 10:25:39","1705.85"
"grafana/loki","eb39e2645f18b49026981e4ec0a3351cad77625d","trevorwhitney","2023-01-17 23:34:41","true","[helm] allow provisioned tokens to be created in different namespaces (#8081)

**What this PR does / why we need it**:

_Note_: This PR bumps the chart to 4.0, so it includes a few other
breaking changes we've been waiting to make.

The new helm chart has a few different ways to create tokens when
running in enterprise mode:

* The tokengen job creates the initial admin token
* The provisioner job creates the self-monitoring tenant if enabled
* The provisioner job can also create additional tenants if configured

The problem with these jobs is they put the generated read/write tokens
for these tenants in secrets in the same namespace as the loki
deploiyment. This is problematic if you need these tokens for a specific
application, for example a Grafana datasource, that is deployed in a
separate namespace.

This PR introduces two breaking changes, one of which is breaking as it
significantly changes how both the self monitoring and additional
tenants are configured.

First it adds the value `enterprise.adminToken.additionalNamespaces` and
moves `enterprise.adminTokenSecret` to `enterprise.adminToken.secret`.
If `additionalNamespaces` are included, additional secrets containing
the GEL admin token are created in those namespaces as well as the
release namespace.

Second, it changes the structure of defining a tenant from just a string
name, to an object containing a `name` and `secretNamespace` field. The
`secretNamespace` is the namespace the secret containing that tenants
token(s) will be placed in. In the case of the self-monitoring token, a
secret will still be created in the default namespace in addition to the
`secretNamespace` specified as that token is required by multiple
components.",94,57,1,1,"2018-04-16 10:25:39","1732.55"
"grafana/loki","8c27cca496f7e412e0a187e9968913ac082bf3f0","adamjohnson01","2019-12-02 15:56:34","false","Update loki helm chart to support service account annotations (#1341)

* update loki helm chart to support service account annotations for use with EKS IAM roles

Signed-off-by: Adam Johnson <a.johnson@winton.com>

* Bump minor versions and fix serviceAccount reference for annotations

Signed-off-by: Adam Johnson <a.johnson@winton.com>",91,19,0,0,"2018-04-16 10:25:39","591.48"
"grafana/loki","3fa46c55004cd55a130a9a7f9e0cecefb9c090e0","JoaoBraveCoding","2023-05-09 19:31:36","true","operator: Add PodAntiAffinity overwrites per component (#9408)

Signed-off-by: Joao Marcal <jmarcal@redhat.com>",82,61,1,0,"2018-04-16 10:25:39","1849.63"
"grafana/loki","aa3716e84c29a9bcbbfc5baaec8d85669927f6a2","jeschkies","2022-09-02 20:07:37","true","Helm: Publish Helm charts to grafana/helm-charts. (#6955)

**What this PR does / why we need it**:
This change pulls in the GitHub workflow for publishing Loki Helm charts to `grafana/helm-charts`.

**Which issue(s) this PR fixes**:
Fixes #6877",78,52,1,1,"2018-04-16 10:25:39","1597.4"
"grafana/loki","011692c1471984a956f86f58e446aefcfa5eee2f","quarckster","2023-05-01 08:06:10","true","/loki/api/v1/delete is routed to backend url (#9336)

**What this PR does / why we need it**:
This PR adds a routing rule for `/loki/api/v1/delete` endpoint to
`gateway` component.

**Which issue(s) this PR fixes**:
Fixes #9325

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",80,60,1,0,"2018-04-16 10:25:39","1841.15"
"grafana/loki","67ba342684294537c80b8c8853f0026e5ce26d60","sandeepsukhani","2022-04-08 10:27:02","true","improve mutex locking when writing index in boltdb-shipper (#5830)",320,48,0,1,"2018-04-16 10:25:39","1447.75"
"grafana/loki","1923668a5dfa93bcc4051baf31facfea045989c3","sandeepsukhani","2022-05-20 12:09:45","true","run store queries in ingester when using tsdb as index store (#6209)",71,49,0,1,"2018-04-16 10:25:39","1495.07"
"grafana/loki","6e3bf3f7d02f4352e12ac6418c0820ca9752e222","sandeepsukhani","2022-05-12 15:55:57","true","tsdb query fixes (#6142)

* query both downloads and uploads manager when non-nil

* fix reading of index file with nodename having a `-`

* remove __name__ matcher at a layer above to avoid passing it during tsdb head queries",76,49,0,1,"2018-04-16 10:25:39","1487.23"
"grafana/loki","19aec6e6a3f651b51a5f0e2b500a7839a8cf812e","sandeepsukhani","2021-07-28 14:27:24","true","fix broken TestCachingStorageClientStoreQueries (#4074)",110,39,0,1,"2018-04-16 10:25:39","1197.92"
"grafana/loki","8f4381a5b61e256fb9205310314de8fb6104f526","sandeepsukhani","2022-06-01 08:21:09","true","update drone signature (#6277)",72,49,0,1,"2018-04-16 10:25:39","1505.91"
"grafana/loki","90cc715c3a7577d0c582aa1a832f02275520e9b4","dannykopping","2021-11-29 13:56:54","true","Allow for setting of per-tenant runtime configs (#4840)

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",214,43,0,1,"2018-04-16 10:25:39","1318.9"
"grafana/loki","d6621f452faf85105d290fe21314f06f504ea055","kavirajk","2022-03-14 06:16:23","true","Replace `PromQL` -> `LogQL` wordings in Querier (#5602)",305,47,0,1,"2018-04-16 10:25:39","1423.58"
"grafana/loki","b8f10a3f6a8e51455a7f92866f68ea7cf63910ca","yubozhao","2019-03-02 20:26:54","false","fix type and add better description of sidecar thanks to Jonas",88,10,0,0,"2018-04-16 10:25:39","316.42"
"grafana/loki","b887602e3654d9525467ed0cde79884887d94749","sh0rez","2019-08-01 14:08:29","true","chore(packaging/docker): Support multiple architectures (#762)

This finally adds support for multiple architectures! :tada: 

Images are now built using BuildKit (actually img), Dockerfiles were parameterized to allow this.
Containers are still built on alpine, using QEMU and binfmt as a kernel compatibility layer to allow RUN steps in these.

CircleCI has been fully revamped, to speed up builds and de-duplicate the configuration.
Makefile has been extended with additional logic to shadow the multi-arch to non-CI users.

Happy hacking on Raspberry Pi and friends :)",106,15,0,0,"2018-04-16 10:25:39","470.4"
"grafana/loki","1c711951c5bf42499dca41db671761c5791e680e","slim-bean","2020-04-01 16:10:00","true","Updating some of the references to v1.3.0
Adding an entry in the changelog to reference image name changes

Signed-off-by: Edward Welch <edward.welch@grafana.com>",121,23,0,1,"2018-04-16 10:25:39","710.49"
"grafana/loki","f2bec3b0a5291a4b11b0aa0f3fd60ea60abe1e9e","rfratto","2019-07-26 17:14:29","false","promtail: restore ability to show target labels in promtail UI

PR #791 accidentally removed the ability to use the promtail UI
by removing methods from the Target interface that were only
used within the HTML templates.

Along with restoring the methods in the Target interface, this
commit also introduces details for the JournalTarget, which
currently only provides the position in the journal being
tracked.",100,15,0,1,"2018-04-16 10:25:39","465.53"
"grafana/loki","ededd06995a077ffab9c95d0de809dd1b483ebcc","davkal","2019-04-08 16:53:50","true","Merge pull request #443 from daixiang0/fix-sa

Fix serviceaccount error",101,12,0,0,"2018-04-16 10:25:39","352.27"
"grafana/loki","6c3b9ba967b5997f959a20b4b27a72bf633e8848","davkal","2019-05-14 07:37:42","true","Merge pull request #491 from daixiang0/debug-helm

Add doc about how to contribute helm",100,13,0,0,"2018-04-16 10:25:39","393.13"
"grafana/loki","8ff27e243bac7a9ac6b9b9682be353ea545c3ec7","KMiller-Grafana","2021-12-07 19:04:49","true","Docs: Reorganize architecture section (#4873)",216,44,0,0,"2018-04-16 10:25:39","1327.11"
"grafana/loki","d804e24c2653b17afc82f60e49104f7a20b3f95a","xperimental","2022-07-07 10:49:19","true","operator: Disable client certificate authentication on gateway (#6594)",71,51,0,1,"2018-04-16 10:25:39","1542.02"
"grafana/loki","986d4ca7569a8553faab183370a491692e074c71","terjesannum","2023-06-13 10:29:31","true","Helm: add support for additional labels on loki-canary pods (#9673)

Add support for setting additional labels on the loki-canary pods

---------

Signed-off-by: Terje Sannum <terje.sannum@nav.no>",66,62,1,0,"2018-04-16 10:25:39","1883.25"
"grafana/loki","b31ed050aeae0b13125e3cab9710e1c674b6147b","vlad-diachenko","2023-10-09 10:43:12","true","Bloom Client (#10697)

Implemented BloomClient that allows : 
1. fetch all meta.json files that satisfy the search criteria
2. upload meta.json
3. delete meta.json
4. fetch bloom blocks in bulk
5. upload bloom blocks in bulk 
6. delete bloom blocks in bulk

Bloom shipper was extracted to a separate PR
https://github.com/grafana/loki/pull/10806

---------

Signed-off-by: Vladyslav Diachenko <vlad.diachenko@grafana.com>",24,66,1,0,"2018-04-16 10:25:39","1999.26"
"grafana/loki","2a3874b240e5bdedf8ead09804aa220fe5459194","ssncferreira","2023-02-24 10:45:38","true","Helm: update changelog with changes from PR #8467 (#8601)

**What this PR does / why we need it**:

Update changelog with changes from PR #8467 and bump helm chart version
to 4.6.2

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",63,58,1,0,"2018-04-16 10:25:39","1769.01"
"grafana/loki","121242310d04fa8bf92249a8248bdaad363c6486","fourstepper","2022-04-11 05:46:45","true","Add Heureka Group to adopters (#5846)",320,48,0,0,"2018-04-16 10:25:39","1450.56"
"grafana/loki","79fcdb4f4cf32069a10636c0fb9c7f8f6dadbc4f","DylanGuedes","2023-09-14 18:50:38","true","Update references to 2.8.5 (#10590)

**What this PR does / why we need it**:
We're releasing a new 2.8.5 patch. This adds references to it to our docs.",42,65,1,1,"2018-04-16 10:25:39","1974.6"
"grafana/loki","018e6bcdfd36f8d93d0425211485da4524ce4316","owen-d","2020-01-30 19:30:30","true","bumps cortex to 0.6.1 master (#1612)",104,21,0,1,"2018-04-16 10:25:39","649.63"
"grafana/loki","1aa7991828ad79892778d36f1c93423b68a02a9e","trevorwhitney","2022-11-23 19:42:33","true","Update release instructions (#7663)

We usually tag releases from the HEAD of the release branch",94,55,1,1,"2018-04-16 10:25:39","1678.39"
"grafana/loki","45b127cfd62d8dedd46b189081d4259e6416ca24","trevorwhitney","2023-08-24 17:52:26","true","add `trivy` to Makefile and build image (#10231)

`trivy` is a command line utility that can scan our images for
vulnerabilities. For example, this is how I checked #10217 addressed the
CVEs we were hoping it would

```
❯ trivy i grafana/loki:release-2.8.x-d784431
2023-08-11T12:34:15.272-0600    INFO    Vulnerability scanning is enabled
2023-08-11T12:34:15.272-0600    INFO    Secret scanning is enabled
2023-08-11T12:34:15.272-0600    INFO    If your scanning is slow, please try '--scanners vuln' to disable secret scanning
2023-08-11T12:34:15.272-0600    INFO    Please see also https://aquasecurity.github.io/trivy/dev/docs/scanner/secret/#recommendation for faster secret detection
2023-08-11T12:34:15.283-0600    INFO    Detected OS: alpine
2023-08-11T12:34:15.283-0600    INFO    Detecting Alpine vulnerabilities...
2023-08-11T12:34:15.286-0600    INFO    Number of language-specific files: 1
2023-08-11T12:34:15.286-0600    INFO    Detecting gobinary vulnerabilities...

grafana/loki:release-2.8.x-d784431 (alpine 3.18.2)

Total: 6 (UNKNOWN: 0, LOW: 0, MEDIUM: 6, HIGH: 0, CRITICAL: 0)

┌────────────┬───────────────┬──────────┬───────────────────┬───────────────┬─────────────────────────────────────────────────────────────┐
│  Library   │ Vulnerability │ Severity │ Installed Version │ Fixed Version │                            Title                            │
├────────────┼───────────────┼──────────┼───────────────────┼───────────────┼─────────────────────────────────────────────────────────────┤
│ libcrypto3 │ CVE-2023-2975 │ MEDIUM   │ 3.1.1-r1          │ 3.1.1-r2      │ AES-SIV cipher implementation contains a bug that causes it │
│            │               │          │                   │               │ to ignore empty...                                          │
│            │               │          │                   │               │ https://avd.aquasec.com/nvd/cve-2023-2975                   │
│            ├───────────────┤          │                   ├───────────────┼─────────────────────────────────────────────────────────────┤
│            │ CVE-2023-3446 │          │                   │ 3.1.1-r3      │ Excessive time spent checking DH keys and parameters        │
│            │               │          │                   │               │ https://avd.aquasec.com/nvd/cve-2023-3446                   │
│            ├───────────────┤          │                   ├───────────────┼─────────────────────────────────────────────────────────────┤
│            │ CVE-2023-3817 │          │                   │ 3.1.2-r0      │ Excessive time spent checking DH q parameter value          │
│            │               │          │                   │               │ https://avd.aquasec.com/nvd/cve-2023-3817                   │
├────────────┼───────────────┤          │                   ├───────────────┼─────────────────────────────────────────────────────────────┤
│ libssl3    │ CVE-2023-2975 │          │                   │ 3.1.1-r2      │ AES-SIV cipher implementation contains a bug that causes it │
│            │               │          │                   │               │ to ignore empty...                                          │
│            │               │          │                   │               │ https://avd.aquasec.com/nvd/cve-2023-2975                   │
│            ├───────────────┤          │                   ├───────────────┼─────────────────────────────────────────────────────────────┤
│            │ CVE-2023-3446 │          │                   │ 3.1.1-r3      │ Excessive time spent checking DH keys and parameters        │
│            │               │          │                   │               │ https://avd.aquasec.com/nvd/cve-2023-3446                   │
│            ├───────────────┤          │                   ├───────────────┼─────────────────────────────────────────────────────────────┤
│            │ CVE-2023-3817 │          │                   │ 3.1.2-r0      │ Excessive time spent checking DH q parameter value          │
│            │               │          │                   │               │ https://avd.aquasec.com/nvd/cve-2023-3817                   │
└────────────┴───────────────┴──────────┴───────────────────┴───────────────┴─────────────────────────────────────────────────────────────┘
```

This PR adds that command as `Makefile` target, as well as adding the
`trivy` binary to our drone build image so we can add it to our
pipelines in the future.",50,64,1,1,"2018-04-16 10:25:39","1954.56"
"grafana/loki","ba25b0fc80e9d651bc1e2d00c9330e1a9d05a118","sandeepsukhani","2021-02-26 16:14:06","true","increase db retain period in ingesters to cover index cache validity period as well (#3300)

refactor ingester store query config to simplify the code",133,34,0,1,"2018-04-16 10:25:39","1040.74"
"grafana/loki","d4c5b095780e028e1bdc5bd7b4ab809b6648c3a5","ekarlso","2019-10-09 19:51:54","false","helm: Add support for passing arbitrary secrets (#1111)

* Add support for adding secrets and mounting

* Add possibility to pass arbitrary env

* Bump chart to 0.16.0

* bump chart

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

Co-authored-by: Cyril Tovena <cyril.tovena@gmail.com>",67,18,0,0,"2018-04-16 10:25:39","538.64"
"grafana/loki","3e385464c6944af431a4d87989a652fe12ae4a12","aknuds1","2021-07-22 13:30:53","true","Chore: Upgrade Prometheus and Cortex (#4017)

* Chore: Upgrade Prometheus

Signed-off-by: Arve Knudsen <arve.knudsen@gmail.com>

* Upgrade Cortex

Signed-off-by: Arve Knudsen <arve.knudsen@gmail.com>

* Upgrade Cortex

Signed-off-by: Arve Knudsen <arve.knudsen@gmail.com>

* Fix build errors

Signed-off-by: Arve Knudsen <arve.knudsen@gmail.com>

* Fix build errors

Signed-off-by: Arve Knudsen <arve.knudsen@gmail.com>

* Fix build errors

Signed-off-by: Arve Knudsen <arve.knudsen@gmail.com>

* Undo unnecessary changes

Signed-off-by: Arve Knudsen <arve.knudsen@gmail.com>",96,39,0,0,"2018-04-16 10:25:39","1191.88"
"grafana/loki","bfb4b00bcaa486e6538bc15fea400f9878e9aec6","aknuds1","2021-09-10 08:01:38","true","Chore: Reformat Go files (#4304)

* Chore: Reformat Go files

Signed-off-by: Arve Knudsen <arve.knudsen@gmail.com>

* Undo change

Signed-off-by: Arve Knudsen <arve.knudsen@gmail.com>",131,41,0,0,"2018-04-16 10:25:39","1239.65"
"grafana/loki","9e19ff006ccf65e3bdba30d348325c0b41825ecd","trevorwhitney","2023-07-11 17:05:58","true","Add targetLabels to SeriesVolume requests (#9878)

Adds optional `targetLabels` parameter to `series_volume` and
`series_volume_range` requests that controls how volumes are aggregated.
When provided, volumes are aggregated into the intersections of the
provided `targetLabels` only.",59,63,1,1,"2018-04-16 10:25:39","1911.53"
"grafana/loki","668622c8130256b7e8ef90ce04e243c2bafe616f","owen-d","2021-08-25 18:46:54","true","Refactor per stream rate limit (#4213)

* uses new StreamRateLimiter

* sets burst before limiter, uses requested ts

* creates new non infinite rate limiters when configs change

* time/rate testware

* less indirection & protect rate limit access from race conditions

* removes old comment

* always recreate stream limiter after config change",126,40,0,1,"2018-04-16 10:25:39","1225.1"
"grafana/loki","82f8f3c1e5dfa0d2fdf1ebaa6b69e7d6a6301c00","ssncferreira","2022-01-04 21:52:15","true","Log time in queue per request (#4949)

* Log time in queue per request

* Add querierID to log message

* Add unescape request url and tenant_ids to log message

* Add query enqueue time to metrics.go

* Remove ""querier request dequeued"" log from scheduler

* Address comments

* Rename enqueue_time to queue_time
* Store queue time in nanoseconds (int64)
* Use CanonicalMIMEHeaderKey for setting the httpgrpc header",253,44,0,0,"2018-04-16 10:25:39","1354.23"
"grafana/loki","e2a7941e326a57f2c42de1d26f4cb198e2a199cb","takanabe","2020-06-16 20:39:51","true","Add server TLS certificate verification (#2171)

* Add server TLS certificate verification

* Generalize use of server TLS certificate verification

* Fix typo

* Bump fluent-plugin-grafana-loki gem version: 1.2.12 -> 1.2.13

* Replace option: verify_tls -> insecure_tls

* Update document

* Update docs/clients/fluentd/README.md

Co-authored-by: Cyril Tovena <cyril.tovena@gmail.com>",138,26,0,0,"2018-04-16 10:25:39","790.93"
"grafana/loki","74c8cf03ba4fb2abd979a9af05bb945813a4505c","MichelHollands","2022-09-26 15:06:53","true","Update deletions dashboard (#7244)

Add a panel for the deletions in progress (which is received -
processed). This is similar to the existing 'Number of pending requests'
only panel but seems more reliable. I'll remove one later after this has
been running for a while.

Add some compactor CPU, memory and processing duration statistics so you
can see how the compactor is doing.

Signed-off-by: Michel Hollands <michel.hollands@grafana.com>",86,53,1,1,"2018-04-16 10:25:39","1621.2"
"grafana/loki","fea5db12ed8215714cd52562b1916eab009bf4be","cyriltovena","2021-01-06 13:50:00","true","Fixes LogQL documentation links. (#3128)

* Fixes LogQL documentation ref links.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fix old link.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",116,33,0,1,"2018-04-16 10:25:39","990.64"
"grafana/loki","a62f81f1cf15d49e02958ae9a6097e84986ea336","cyriltovena","2020-11-20 08:49:35","true","Improve tailer matcher function. (#2959)

Don't create a map on every new push of a stream or appearance of a new stream.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",115,31,0,1,"2018-04-16 10:25:39","944.43"
"grafana/loki","e21d6edc1018cb77d164047410d03a2d306921e8","cyriltovena","2021-02-25 14:13:17","true","Fixes 500 in the querier when returning multiple errors. (#3348)

This correctly implement the `Is` error interface and uses the `util.MultiError`
everywhere we need it.

This way we can correcltly access if this was a cancellation which should not translate into 500.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",137,34,0,1,"2018-04-16 10:25:39","1039.66"
"grafana/loki","2374d4891b0879cb77ffb5ef04c408442fcaff63","cyriltovena","2020-04-24 13:46:40","true","Log slow query from the frontend by default in ksonnet. (#1980)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",116,24,0,1,"2018-04-16 10:25:39","738.64"
"grafana/loki","d3ab48669e6ec0db14e372e9afce6507c9e22621","cyriltovena","2019-07-08 17:58:51","true","move Dockerfile multi-arch to build and ignore that folder (#723)

* move Dockerfile multi-arch to build and ignore that folder

* docker-driver fix",97,15,0,1,"2018-04-16 10:25:39","447.56"
"grafana/loki","38b1d3b914bae88f8c9145f6edf403c77fd8de6f","ssncferreira","2022-05-02 08:31:27","true","Update Loki reads/writes resources dashboards (#5765)",78,49,0,0,"2018-04-16 10:25:39","1476.92"
"grafana/loki","ebac1f1618f59445cbfe3343f73c332c5e30d65c","periklis","2022-07-07 09:04:48","true","operator: Use docker build context for root make targets (#6601)",71,51,0,1,"2018-04-16 10:25:39","1541.94"
"grafana/loki","368d18c62aa6d193b61b612c2d668b5ab9b31573","KMiller-Grafana","2021-08-19 15:41:38","true","Docs: improve LogQL section (#4145)

* Docs: improve LogQL section
- Add a subsection for examples
- Fix typos and wording

* Update docs/sources/logql/query_examples.md

Co-authored-by: Sandeep Sukhani <sandeep.d.sukhani@gmail.com>

* Update docs/sources/logql/query_examples.md

Co-authored-by: Sandeep Sukhani <sandeep.d.sukhani@gmail.com>

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>
Co-authored-by: Sandeep Sukhani <sandeep.d.sukhani@gmail.com>",131,40,0,0,"2018-04-16 10:25:39","1218.97"
"grafana/loki","54dc737583d7fd9d9aa68b37f362eaa696b2e20d","cyriltovena","2021-11-30 10:15:41","true","Reduce tracing spans (#4842)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",214,43,0,1,"2018-04-16 10:25:39","1319.74"
"grafana/loki","11071d4c3148eba40a46a591679ad09c34e6743b","cyriltovena","2021-11-12 07:50:42","true","Improves memchunk benchmark to account for block size. (#4645)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",194,43,0,1,"2018-04-16 10:25:39","1301.64"
"grafana/loki","1fc0ffde8a5f9139b2e30eeadacad89f7ef515ca","cyriltovena","2019-12-09 14:49:00","true","Logql benchmark and performance improvement. (#1371)

* Add logql benchmark test.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes store benchmark limits.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add LogQL improvements.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add back logging in the storage benchmark

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",91,20,0,1,"2018-04-16 10:25:39","598.43"
"grafana/loki","d4d290839ee88cb2f9ffe4cde4c8d61b0587d8ad","owen-d","2020-08-06 17:33:45","true","fixes lambda-promtail relative doc link (#2473)",124,28,0,1,"2018-04-16 10:25:39","840.8"
"grafana/loki","e9789f7f99ff01c352b7f0e4ff6e97946a67b561","owen-d","2020-04-15 12:11:42","true","adds config validation, similar to cortex (#1939)",123,24,0,1,"2018-04-16 10:25:39","724.32"
"grafana/loki","b85609e5ef9f287646a5c136e2205abdf1e0c678","arjenvdhave","2019-04-25 19:21:58","false","Configurable Loki scheme in helm file, with optional basic auth (#494)

* Make Loki url scheme configurable and add optional authentication in helm chart

* Added help text in README and changed propery names based on code review",96,12,0,0,"2018-04-16 10:25:39","374.62"
"grafana/loki","4f9c85df5d42cbb82336ddd12c25d9823c6a28eb","raskyld","2022-09-21 12:02:23","true","Guidelines: Update CONTRIBUTING.md (#6757)

For a new contributor (which I am :tada:), the `CONTRIBUTING.md` file
might seem a bit vague in regard to why we need to use the
`GOPATH`-scoped Loki repository to contribute. The rationale is now
given (If I've missed any other reasons, please tell me).

* Fixed wrong level title,
* Added information about local workflow when dealing with locally
modified dependencies,
* Added references to Go 1.18 workspaces.

Signed-off-by: Raskyld <enzo@nocera.eu>",86,53,1,0,"2018-04-16 10:25:39","1616.07"
"grafana/loki","05de3b7aeeaa743cb7eaf4cdc32a047e32094e8e","petuhovskiy","2020-07-28 18:25:22","true","Fix docker driver doc (#2420)

Updated docker tag for grafana/loki-docker-driver in Upgrading doc section",126,27,0,0,"2018-04-16 10:25:39","832.83"
"grafana/loki","edc6215098fced0d1528fce814f26d74161ab24f","cyriltovena","2020-10-23 05:37:44","true","Improve the way we reverse iterator for backward queries. (#2793)

Instead of reversing all blocks, we reverse one block at the time.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",115,30,0,1,"2018-04-16 10:25:39","917.3"
"grafana/loki","4d5c2787b9e80219b628c2d86f02f394a6a4c7f9","cyriltovena","2020-05-08 14:21:58","true","Update api.md (#2056)

Vector timestamp are in seconds.",115,25,0,1,"2018-04-16 10:25:39","752.66"
"grafana/loki","2464ee7777c9d5fb37aa2441f08c44b4d16a1ba2","cyriltovena","2019-08-05 17:49:49","false","Add readiness probe to distributor deployment.",99,16,0,1,"2018-04-16 10:25:39","474.56"
"grafana/loki","7f71c5f0513ca45a500c75472467142d59337e3b","cyriltovena","2021-12-03 19:14:49","true","Promtail pull cloudflare logs (#4813)",216,43,0,1,"2018-04-16 10:25:39","1323.12"
"grafana/loki","4a91fdcc7ffe8eb9ee08e13ce8909f778444a127","vlad-diachenko","2022-04-25 07:28:58","true","migrated gelfTarget to go-gelf/v2 library that contains fix for chunked messages (#5992)",169,48,0,0,"2018-04-16 10:25:39","1469.88"
"grafana/loki","a422f394bb4660c98f7d692e16c3cc28747b7abd","tomwilkie","2019-01-31 16:57:26","false","Wait for the right number of streams.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",76,9,0,0,"2018-04-16 10:25:39","285.27"
"grafana/loki","d0fcfd8e70fed70233d1caccd74f024abb519c5f","briangann","2019-03-12 13:44:03","false","fixes rspec dependencies and rubocop errors (#391)",92,11,0,0,"2018-04-16 10:25:39","326.14"
"grafana/loki","1fef92bc174b8e9c77179f0e0b58ea3459786a18","tomwilkie","2018-11-24 17:41:56","true","Lint stuff (#27)

* Check in generated files, to make getting started easier.

Add gometalinter, and a lint check for changes to the generated files.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>

* Make lint pass?

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",5,7,0,0,"2018-04-16 10:25:39","218.3"
"grafana/loki","409eb31a5cd1cf3e332b1406a3f377e6a203dabb","sandeepsukhani","2020-09-04 11:52:38","true","fix closing bracket in dashboards from loki-mixin (#2599)",118,29,0,1,"2018-04-16 10:25:39","868.56"
"grafana/loki","d362df7a98a4ba409a10a5e24b869fb8c41cdbc8","sandeepsukhani","2021-06-10 11:14:39","true","ignore download of missing boltdb files possibly removed during compaction (#3563)",165,38,0,1,"2018-04-16 10:25:39","1149.78"
"grafana/loki","f5c8b22b34c16a81417434657d2c91129e4c24a8","sandeepsukhani","2019-05-16 10:34:56","false","Change tail response for backward compatibilty with future changes (#590)

Changed it to dict with single key called ""streams"" and value set to list of logproto.Stream",101,13,0,1,"2018-04-16 10:25:39","395.26"
"grafana/loki","e5a89fa6dab1cf2bf240a50cb6f70fada296877e","kavirajk","2022-05-17 12:18:18","true","fix(querier): Record `result` length after response validation. (#6176)

Without this fix, it causes panic, if series or label endpoint returns error.

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",75,49,0,1,"2018-04-16 10:25:39","1492.08"
"grafana/loki","705baa39f4ac7cc70df9a2accfe2c48474779cc2","jeschkies","2022-03-18 13:23:31","true","Speed up re-labelling in multi-tenant queries. (#5663)",308,47,0,1,"2018-04-16 10:25:39","1427.87"
"grafana/loki","410b9d9adce7f9b9105d48a6d3354a79291b5c12","kavirajk","2020-12-01 10:18:38","true","fix(docker-driver): Propagate promtail's `client.Stop` properly (#2898)

* impr(Makefile): add support to take docker-driver image via ENV

* impr(promtail/client): Add cancelling mechanism for batchSend

stores `context` and its `cancel` in client and uses it to
make upstream calls that need `ctx`.

Also properly cancel's all the upstream calls that using `ctx` when
client's Stop is called.

* Add `StopNow()` method to stop the client without retries.

Use `StopNow()` from the docker-driver

* Add test for StopNow

* reverting back the client.Timeout",120,31,0,1,"2018-04-16 10:25:39","955.5"
"grafana/loki","a27aec37cf24f3a8311e129a53a158f6a3214149","owen-d","2021-10-26 13:48:53","true","only exports tenant limits which differ from defaults and export defa… (#4542)

* only exports tenant limits which differ from defaults and export defaults under `loki_overrides_defaults` metric.

* docs & changelog",167,42,0,1,"2018-04-16 10:25:39","1285.89"
"grafana/loki","210c937c414c3623c5770d6c3c237186db12fa75","chaudum","2023-08-25 09:50:42","true","chore(schema-v13): Fix series store schema creation for v13 (#10348)

The creation of a series store schema failed when using v13 schema version.


**Special notes for your reviewer**:

When adding the `v13` to the series store test cases
(`pkg/storage/stores/series/series_store_test.go`) they fail. Example
error:

```
=== RUN   TestSeriesStore_LabelValuesForMetricName/foo_/_toms_/_v13_/_store
    series_store_test.go:700: ========= Running labelValues with metricName foo with labelName toms with schema v13
    series_store_test.go:93: 
        	Error Trace:	/home/christian/sandbox/grafana/loki/pkg/storage/stores/series/series_store_test.go:93
        	            				/home/christian/sandbox/grafana/loki/pkg/storage/stores/series/series_store_test.go:77
        	            				/home/christian/sandbox/grafana/loki/pkg/storage/stores/series/series_store_test.go:702
        	Error:      	Received unexpected error:
        	            	invalid schema version
        	Test:       	TestSeriesStore_LabelValuesForMetricName/foo_/_toms_/_v13_/_store
=== RUN   TestSeriesStore_LabelValuesForMetricName/foo_/_toms_/_v13_/_cached_store
    series_store_test.go:700: ========= Running labelValues with metricName foo with labelName toms with schema v13
    series_store_test.go:93: 
        	Error Trace:	/home/christian/sandbox/grafana/loki/pkg/storage/stores/series/series_store_test.go:93
        	            				/home/christian/sandbox/grafana/loki/pkg/storage/stores/series/series_store_test.go:77
        	            				/home/christian/sandbox/grafana/loki/pkg/storage/stores/series/series_store_test.go:702
        	Error:      	Received unexpected error:
        	            	invalid schema version
        	Test:       	TestSeriesStore_LabelValuesForMetricName/foo_/_toms_/_v13_/_cached_store

```

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",50,64,1,1,"2018-04-16 10:25:39","1955.23"
"grafana/loki","bc3da94f1abb06ef06df3c8eadfa4285003a1ac9","rfratto","2019-12-09 16:27:48","true","v1.2.0: update helm and ksonnet (#1389)",92,20,0,1,"2018-04-16 10:25:39","598.5"
"grafana/loki","8cf921a1454b148ac501c6067b55af411e6e0877","salvacorts","2023-04-14 11:08:41","true","Pass engine opts down to middlewares (#9130)

**What this PR does / why we need it**:

The following middlewares in the query frontend uses a downstream
engine:
- `NewQuerySizeLimiterMiddleware` and `NewQuerierSizeLimiterMiddleware`
- `NewQueryShardMiddleware`
- `NewSplitByRangeMiddleware`

These were all creating the downstream engine as follows:

```go
logql.NewDownstreamEngine(logql.EngineOpts{LogExecutingQuery: false}, DownstreamHandler{next: next, limits: limits}, limits, logger),
```

As can be seen, the [engine options configured in Loki][1] were not
being used at all. In the case of `NewQuerySizeLimiterMiddleware`,
`NewQuerierSizeLimiterMiddleware` and `NewQueryShardMiddleware`, the
downstream engine was created to get the `MaxLookBackPeriod`. When
creating a new Downstream Engine as above, the `MaxLookBackPeriod`
[would always be the default][2] (30 seconds).

This PR fixes this by passing down the engine config to these
middlewares, so this config is used to create the new downstream
engines.

**Which issue(s) this PR fixes**:
Adresses some pending tasks from
https://github.com/grafana/loki/pull/8670#issuecomment-1507031976.

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [x] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

[1]:
https://github.com/grafana/loki/blob/1bcf683513b5e11fb1dcc5625761b9760cfbd958/pkg/querier/querier.go#L52
[2]:
https://github.com/grafana/loki/blob/edc6b0bff76714ff584c20d7ff0235461a4f4a88/pkg/logql/engine.go#L136-L140",80,60,1,1,"2018-04-16 10:25:39","1819.03"
"grafana/loki","399c990ae6f9c4ad050e2e36cd23375325bf95be","cyriltovena","2019-07-19 13:07:33","false","comments adjustment",103,15,0,1,"2018-04-16 10:25:39","458.36"
"grafana/loki","f1dc58c48d3f9dda76b19ef480680e1201421410","rfratto","2020-02-04 22:49:02","false","ci: make manifest publishing run serially",108,21,0,1,"2018-04-16 10:25:39","653.77"
"grafana/loki","a2e4f7c2f449386252d81f3dd6236df834098995","tomwilkie","2019-01-09 09:56:40","true","Changes from #85. (#205)

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",59,9,0,0,"2018-04-16 10:25:39","262.98"
"grafana/loki","c14172dc63d15b65947c5b4f9929fe9c314ecb84","robbymilo","2021-08-03 12:11:04","true","remove docs test (#4090)",103,40,0,0,"2018-04-16 10:25:39","1202.82"
"grafana/loki","2208ea7147d4ac99071cd9d468990d97e12bc447","rfratto","2022-10-18 13:22:22","true","Update Prometheus dependency to latest release (v2.39.1) (#7425)",89,54,1,1,"2018-04-16 10:25:39","1643.12"
"grafana/loki","15bfc8931ce9956088190aae52b4892041cd734d","eraac","2019-12-02 15:14:12","false","using parsable value in configuration example (#1349)",91,19,0,0,"2018-04-16 10:25:39","591.45"
"grafana/loki","59bd44a5dfcb094b0ee2298566b1a6560238842b","cyriltovena","2022-03-17 08:27:39","true","Remove more chunkstore and schema version below v9 (#5650)

* Remove more chunkstore and schema version below v9

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes remaining tests

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes remaining tests

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",307,47,0,1,"2018-04-16 10:25:39","1426.67"
"grafana/loki","afc8b4d998ba934d5428a67dbdef2ec787856d9f","cyriltovena","2020-07-17 15:30:21","true","Fixes helm publish that needs now to add repo. (#2371)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",119,27,0,1,"2018-04-16 10:25:39","821.71"
"grafana/loki","7d54b3aca30b99048ffb774a5ebc580874563c44","periklis","2021-09-29 05:49:53","true","Remove vendor dir (#81)",141,41,0,1,"2018-04-16 10:25:39","1258.56"
"grafana/loki","4d8009cacc28cd15567b8af481576ec2f54f1c7b","owen-d","2021-11-07 23:46:05","true","overrides checks for nil tenant limits on AllByUserID (#4687)",179,43,0,1,"2018-04-16 10:25:39","1297.31"
"grafana/loki","b6ce3826b4663098c69a4b5381cc77b9456b239c","chaudum","2022-04-22 14:12:30","true","Use new build image 0.20.3 (#5904)",168,48,0,1,"2018-04-16 10:25:39","1467.16"
"grafana/loki","c6c07a827665a735de2d78b1eb2f143f2587ca42","jeschkies","2023-03-23 11:56:50","true","Document how to install Loki and Promtail using APT/DNF. (#8841)

**What this PR does / why we need it**:
With #6456 we started providing native packages of Loki, Promtail and
logcli. They've been added to Grafana's repository in the meantime.

In order to spread the knowledge of the packages and the repo it should
be documented.

**Which issue(s) this PR fixes**:
Fixes #52


**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

---------

Co-authored-by: René Scheibe <rene.scheibe@gmail.com>
Co-authored-by: J Stickler <julie.stickler@grafana.com>",83,59,1,1,"2018-04-16 10:25:39","1798.06"
"grafana/loki","a3f2e6bcd6d91f4f8fca13180ba7160b61bfc829","salvacorts","2022-03-02 12:44:22","true","Add prefix to vault path (#5510)

* Add prefix to vault path

* make drone

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

Co-authored-by: Danny Kopping <danny.kopping@grafana.com>",298,46,0,1,"2018-04-16 10:25:39","1411.85"
"grafana/loki","b8b7caa4502b43a8a5a9025ecbe6d702e66a9509","cyriltovena","2019-05-06 13:17:39","true","Promtail targets and service discovery pages (#532)

* add a custom server for loki with assets embedded

* adds a targets page for promtail to see discovered files and labels

* lint fixes

* fix css table size

* add service discovery logic

* add service discovery template

* add promtail pages documentation

* ignored gen file in linter",98,13,0,1,"2018-04-16 10:25:39","385.37"
"grafana/loki","9e33f8f6b7fe35a395ef8fec08fc9554e3ad2346","cyriltovena","2021-02-16 14:11:17","true","Fixes races in multiline stage and promtail. (#3302)

* Fixes a race in multiline code.

Not fully sure how this was happening, but I have a test showing it's possible and a fix for it.

I think it should fix #3120.

I also remove race within some tests of promtail.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Reset config

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",131,34,0,1,"2018-04-16 10:25:39","1030.66"
"grafana/loki","2b403920843608c1b1e35b44afb73718056193d8","cyriltovena","2019-08-02 13:26:18","false","reuse overlapping array in batch iterator",106,15,0,1,"2018-04-16 10:25:39","471.38"
"grafana/loki","97912b6f4c36965a855bca4757d67b382b8d07d1","cyriltovena","2021-07-07 08:44:30","true","Shard ingester queries. (#3852)

* Shard ingester queries.

This is still experimental but already yield from 2x to 6x faster for short period queries.

I'm still playing with it but I want to share how I do it early.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add notice of the code origin.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Update pkg/ingester/index/index.go

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>

* Update pkg/ingester/index/index_test.go

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>

* Align shards from ingester and storage.

Utimately we should have a storage that relies on fingerprint, but that's harder to change.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Remove comment

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes delete index func

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Test reverting.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes a bug causing non deterministic hash.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Update pkg/ingester/index/index.go

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>

* Update pkg/ingester/index/index.go

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>

* Update pkg/ingester/index/index.go

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>

* Update pkg/ingester/index/index_test.go

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>

* Fixes build.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* got linted :(

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>",120,39,0,1,"2018-04-16 10:25:39","1176.68"
"grafana/loki","8abe080fd6d04dc5efb074ee0764a9bfd39c82d2","farodin91","2023-06-14 10:12:45","true","Promtail: improve behavior of partial lines (#9508)

**What this PR does / why we need it**:

I started to see OOM after upgrading to a promtail version with #8497.
So played around to make partial line behavior more stable. You can now
truncate partial lines and configure max partial lines buffer.

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [x] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

Signed-off-by: Jan Jansen <jan.jansen@gdata.de>
Co-authored-by: Michel Hollands <42814411+MichelHollands@users.noreply.github.com>",66,62,1,0,"2018-04-16 10:25:39","1884.24"
"grafana/loki","0a5e149ea540d9b034ff7023ca6f95ce09805080","sandeepsukhani","2023-06-06 06:36:50","true","query-scheduler: fix query distribution in SSD mode (#9471)

**What this PR does / why we need it**:
When we run the `query-scheduler` in `ring` mode, `queriers` and
`query-frontend` discover the available `query-scheduler` instances
using the ring. However, we have a problem when `query-schedulers` are
not running in the same process as queriers and query-frontend since [we
try to get the ring client interface from the scheduler
instance](https://github.com/grafana/loki/blob/abd6131bba18db7f3575241c5e6dc4eed879fbc0/pkg/loki/modules.go#L358).

This causes queries not to be spread across all the available queriers
when running in SSD mode because [we point querier workers to query
frontend when there is no ring client and scheduler address
configured](https://github.com/grafana/loki/blob/b05f4fced305800b32641ae84e3bed5f1794fa7d/pkg/querier/worker_service.go#L115).

I have fixed this issue by adding a new hidden target to initialize the
ring client in `reader`/`member` mode based on which service is
initializing it. `reader` mode will be used by `queriers` and
`query-frontend` for discovering `query-scheduler` instances from the
ring. `member` mode will be used by `query-schedulers` for registering
themselves in the ring.

I have also made a couple of changes not directly related to the issue
but it fixes some problems:
* [reset metric registry for each integration
test](https://github.com/grafana/loki/commit/18c4fe59078b649ad6a788a48765b101d0b97618)
- Previously we were reusing the same registry for all the tests and
just [ignored the attempts to register same
metrics](https://github.com/grafana/loki/blob/01f0ded7fcb57e3a7b26ffc1e8e3abf04a403825/integration/cluster/cluster.go#L113).
This causes the registry to have metrics registered only from the first
test so any updates from subsequent tests won't reflect in the metrics.
metrics was the only reliable way for me to verify that
`query-schedulers` were connected to `queriers` and `query-frontend`
when running in ring mode in the integration test that I added to test
my changes. This should also help with other tests where earlier it was
hard to reliably check the metrics.
* [load config from cli as well before applying dynamic
config](https://github.com/grafana/loki/commit/f9e2448fc7e718db107165cd908054c806b84337)
- Previously we were applying dynamic config considering just the config
from config file. This results in unexpected config changes, for
example, [this config
change](https://github.com/grafana/loki/blob/4148dd2c51cb827ec3889298508b95ec7731e7fd/integration/loki_micro_services_test.go#L66)
was getting ignored and [dynamic config tuning was unexpectedly turning
on ring
mode](https://github.com/grafana/loki/blob/52cd0a39b8266564352c61ab9b845ab597008770/pkg/loki/config_wrapper.go#L94)
in the config. It is better to do any config tuning based on both file
and cli args configs.

**Which issue(s) this PR fixes**:
Fixes #9195",70,62,1,1,"2018-04-16 10:25:39","1876.09"
"grafana/loki","73c87dd31903e2b7c3c1ea601c337b8d22af12f5","sandeepsukhani","2021-06-28 07:58:11","true","update uid of loki-deletion dashboard (#3893)",111,38,0,1,"2018-04-16 10:25:39","1167.65"
"grafana/loki","d357ad9e58a035bcdb5e0bf0a4ebebaba4de1797","sandeepsukhani","2021-01-29 09:08:17","true","fix broken json logs push path (#3261)",129,33,0,1,"2018-04-16 10:25:39","1013.45"
"grafana/loki","c6dc0d2649bb4f3717ab35478e26b9b7800a15d9","DylanGuedes","2022-08-29 14:30:38","true","Docs: Fix default max_chunk_age (#6996)

**What this PR does / why we need it**:
Fix a doc stating a wrong `max_chunk_age` value.

**Which issue(s) this PR fixes**:
Fixes #6919",81,52,1,1,"2018-04-16 10:25:39","1594.17"
"grafana/loki","4f94b89fdb8b7220a3de77965551b359263ecd36","DylanGuedes","2023-03-23 20:29:57","true","Loki: Add more spans to write path (#8888)

**What this PR does / why we need it**:
Add new spans to our write path to better determine which operations are
holding our write performance.",83,59,1,1,"2018-04-16 10:25:39","1798.42"
"grafana/loki","dbf09246d51df929599c25b3cd9d0c8d3873dec6","ashwanthgoli","2023-01-06 14:41:52","true","Avoid failing tests on gRPC server shutdown errors (#8060)",97,57,1,0,"2018-04-16 10:25:39","1721.18"
"grafana/loki","6fac9547f2498ca565933e6e081a4e5982eea711","sh0rez","2019-06-10 13:25:04","false","fix(loki): honor log level from config file (#657)

Because of the logger being initialized before the configuration file is parsed,
the log_level from the config file is ignored.
To solve this, the logger is reinitialized after the file is parsed, as it is
already being done in promtail.",109,14,0,0,"2018-04-16 10:25:39","419.37"
"grafana/loki","3151f0741c285b5ad5dabd329db49bfce6eeb5c5","davkal","2019-05-24 13:50:02","true","Update readme (loki-stack)",107,13,0,0,"2018-04-16 10:25:39","403.39"
"grafana/loki","1b2f3e0cb2ebe2f012ebaa0731a0623ad6c537e2","xperimental","2023-01-11 16:57:02","true","operator: Fix status not updating when state of pods changes (#8087)

The operator sometimes fails to update the `.status` field of the
`LokiStack` resource to reflect the current state of the associated Pods
and set conditions accordingly.

I have identified two reasons for this during testing:

- Out-of-date cached copy of the resource leading to a conflict error
- Not listening to Pod status updates and subsequently not trying to
update the status at all

For me, most of the conflicts happened in the controllers for the rules,
trying to update the annotations, so I have added retry logic to these
controllers.

Instead of adding another watcher for the Pod resource updates, I have
updated the predicate used for Deployment and StatefulSet resources to
also include updates that only affect the status field. This could be
slimmed down to only look at certain fields that we are interested in
(the replica counts) or simplified into looking at all changes, skipping
the compare operation.",101,57,1,1,"2018-04-16 10:25:39","1726.27"
"grafana/loki","d073b25e43663585cd261bd11094a91e8e18f71d","Red-GV","2023-01-25 05:05:46","true","operator: Use gRPC instead of http for compactor communications (#8265)",86,57,1,1,"2018-04-16 10:25:39","1739.78"
"grafana/loki","5e53303cb8abec0af0bc1ad1a995310d3d175acc","MasslessParticle","2023-01-13 20:31:51","true","run 'make doc' and commit the changes (#8142)",93,57,1,1,"2018-04-16 10:25:39","1728.42"
"grafana/loki","c6c301ec27784a6d3c22082d15ceb81bfb763af6","slim-bean","2022-04-12 12:05:47","true","Docs: Improve the new schema docs (#5869)

* improve the new schema docs

Signed-off-by: Edward Welch <edward.welch@grafana.com>

* fix capitalization

Signed-off-by: Edward Welch <edward.welch@grafana.com>",320,48,0,1,"2018-04-16 10:25:39","1451.82"
"grafana/loki","c0cc004333b1392ab12b41a8666c1d2fb1e2ec30","bboreham","2022-04-08 13:20:23","true","gcs client: use fake credentials in unit test (#5834)

* gcs client: use fake credentials in unit test

'insecure' mode is only used in unit tests, so I piggy-backed on that
to set a fake API key.

This avoids the GCS library looking up credentials from the user's
environment and possibly contacting Google servers, as described at
https://cloud.google.com/docs/authentication/production

* Comment

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>",321,48,0,0,"2018-04-16 10:25:39","1447.87"
"grafana/loki","0368a09d4c5e822b0eb147f10e780413855a1bb6","dannykopping","2022-01-14 13:20:51","true","Ruler: Fix remote write basic auth credentials (#5144)

* Retrieving original password to avoid marshaling issues

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Fixing test

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>

* Adding CHANGELOG entry

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",265,45,0,1,"2018-04-16 10:25:39","1363.87"
"grafana/loki","0c9f7a58a458ecf9e79a1e3f11df6a55ad1da9e6","alrs","2020-09-25 07:48:06","true","pkg/querier: fix dropped error (#2671)

Signed-off-by: Lars Lehtonen <lars.lehtonen@gmail.com>",118,29,0,0,"2018-04-16 10:25:39","889.39"
"grafana/loki","51161bbac5d710a0a9dae501e36ed55542c3093c","davkal","2019-04-17 13:49:42","false","Bumped chart versions",102,12,0,0,"2018-04-16 10:25:39","366.39"
"grafana/loki","a2c4df0416c845bb1c5eb9b7beba88af074ed301","tomwilkie","2018-05-18 19:01:38","false","Plumb start & end timestamps through the server.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",0,1,0,0,"2018-04-16 10:25:39","32.36"
"grafana/loki","69d81dfcf09982024cbb376de15bc61f2f1c8c8d","KMiller-Grafana","2021-10-06 22:10:24","true","Docs: revise wording of Grafana Cloud advertisement (#4422)",137,42,0,0,"2018-04-16 10:25:39","1266.24"
"grafana/loki","98fd01aef8c5c2892a1305ea804400d1833cd84b","trevorwhitney","2023-01-05 17:03:28","true","Add empty k3d cluster for testing helm chart (#7984)

**What this PR does / why we need it**:
Add a new k3d cluster which is a cluster that has all Loki dependencies
for purposes of testing the helm charts using `helm install`. The other
environments use the helm charts, but deploy them using `tanka` and
therefore can't catch certain race conditions or issues that occur with
helm installs.",95,57,1,1,"2018-04-16 10:25:39","1720.28"
"grafana/loki","f0c94d7db23047216f452cdf5ea4aa4ea186c319","davkal","2019-04-17 13:37:57","true","Merge pull request #477 from sleleko/master

create and update promtail-examples.md",103,12,0,0,"2018-04-16 10:25:39","366.38"
"grafana/loki","5132a97104797ee324bd144a4dd44f57aab2c7c9","davkal","2019-04-10 07:34:47","true","Merge pull request #465 from daixiang0/help

Add help info for users uses high k8s version",99,12,0,0,"2018-04-16 10:25:39","353.88"
"grafana/loki","3b9222bf8c058ada3c89b897792a518700626a61","scoof","2020-10-27 14:17:08","true","Update _index.md (#2817)",121,30,0,0,"2018-04-16 10:25:39","921.66"
"grafana/loki","012a4c8a0a68ef921e9d8c11d723447293743591","tomwilkie","2018-04-16 13:10:37","false","Don't ignore vendor .pb.go",0,0,0,0,"2018-04-16 10:25:39","0.11"
"grafana/loki","3b9ffe6df0110002584e743834080b9de08242f6","tomwilkie","2018-04-16 10:36:53","false","Don't time the build.",0,0,0,0,"2018-04-16 10:25:39","0.01"
"grafana/loki","24f8b19e9106dfa02d224570b2b744dc51bb54b8","kavirajk","2022-05-06 18:14:00","true","Remove unused grpc health check endpoints (#6113)

We have generic `grpc_healthcheck` endpoint that get registered for all the components
during initialization stage.

Looks like these health checks that are part of actual component's struct itself came from legacy.

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",74,49,0,1,"2018-04-16 10:25:39","1481.33"
"grafana/loki","0e3df1938f6ba7273b691f5395a7ccded9666bae","DylanGuedes","2022-01-12 16:17:28","true","Copy querier subpackages dependency into Loki (#5068)

* Fork cortex `querier/series`.

* Fork cortex `querier/chunkstore`.

* Fork cortex `querier/lazyquery`.

* Use Loki forked cortex code.

* Copy cortex `querier/queryrange` as `querier/queryrange/queryrangebase`.

* Fork cortex `pkg/querier/queryrange` to `pkg/querier/queryrange/queryrangebase`.

* Tell protoc to use gogo.types instead of pb.Any.

* Use `pkg/querier/queryrange/queryrangebase`.

* Remove cortex `queryrange` vendoring.

* Fix lint.

* Use `_ = ...` syntax instead of comment to fix lint.",262,45,0,1,"2018-04-16 10:25:39","1361.99"
"grafana/loki","57a1193d933e9933c9f8f4966391eb3f81ad4777","saerosV","2022-09-08 16:07:59","true","Docs: Fix Helm Chart links (#6985)

**What this PR does / why we need it**:

- Fix the link pointing to a Loki Helm chart, found in the [Contribute
to
Helm](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md#contribute-to-helm)
section of the
[CONTRIBUTING.MD](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
file.
- Fix the link pointing to a Promtail Helm chart, found in the [Using
Helm to deploy on
Kubernetes](https://github.com/grafana/loki/blob/main/production/README.md#using-helm-to-deploy-on-kubernetes)
section of the
[production/README.md](https://github.com/grafana/loki/tree/main/production)
file.

The previous links used were pointing to a [deprecated
file](https://github.com/grafana/loki/tree/main/production/helm).


**Special notes for your reviewer**:

None.
<!--
Note about CHANGELOG entries, if a change adds:
* an important feature
* fixes an issue present in a previous release, 
* causes a change in operation that would be useful for an operator of
Loki to know
then please add a CHANGELOG entry.

For documentation changes, build changes, simple fixes etc please skip
this step. We are attempting to curate a changelog of the most relevant
and important changes to be easier to ingest by end users of Loki.

Note about the upgrade guide, if this changes:
* default configuration values
* metric names or label names
* changes existing log lines such as the metrics.go query output line
* configuration parameters 
* anything to do with any API
* any other change that would require special attention or extra steps
to upgrade
Please document clearly what changed AND what needs to be done in the
upgrade guide.
-->
**Checklist**
- [X] Documentation added
- [ ] Tests updated
- [ ] Is this an important fix or new feature? Add an entry in the
`CHANGELOG.md`.
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

Co-authored-by: Trevor Whitney <trevorjwhitney@gmail.com>",86,53,1,0,"2018-04-16 10:25:39","1603.24"
"grafana/loki","67f961e4dcc66a9bd84654b701932590cc21eee2","owen-d","2022-03-09 14:57:47","true","more tsdb benchmarks + updates script to work with incompatible branches (#5590)

* more tsdb benchmarks + updates script to work with incompatible branches

* shellcheck",305,47,0,1,"2018-04-16 10:25:39","1418.94"
"grafana/loki","826fdfa3b9c35405e58e5cff3860d4d7500e77a1","KMiller-Grafana","2021-07-23 12:23:45","true","Docs: add weights to YAML metadata to order the LogQL subsections in the nav panel (#4031)",97,39,0,0,"2018-04-16 10:25:39","1192.83"
"grafana/loki","04219738851f7d2e9ac7f0a75246a0cee9ce57eb","tomwilkie","2018-11-19 20:35:04","false","update build image.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",5,7,0,0,"2018-04-16 10:25:39","213.42"
"grafana/loki","77da15c331a63f872f52ee4f3bfd7458f72ab377","dottedmag","2020-04-06 13:08:56","true","JSON encoding: avoid base64 encoding of []byte inside other slices (#1890)

Closes #1889

Signed-off-by: Mikhail Gusarov <misha@ridge.co>
(cherry picked from commit 3786d742739691bdc867f1cdb66e295c848915fa)",115,24,0,0,"2018-04-16 10:25:39","715.36"
"grafana/loki","bb2b925255ff20e6662f32491d35b09e0491c4f7","joe-elliott","2019-10-15 11:06:00","false","Update `/loki/api/v1/push` to use the v1 json format (#1145)

Signed-off-by: Joe Elliott <number101010@gmail.com>",67,18,0,0,"2018-04-16 10:25:39","544.28"
"grafana/loki","57c5f255fdec808cb98ca41d2ba2c65166f36b96","xperimental","2022-11-22 09:10:28","true","operator: Fix handling of Request requeues (#7740)",96,55,1,1,"2018-04-16 10:25:39","1676.95"
"grafana/loki","3d8688fae46efcaed3955857e05fcb3b4b010f70","cyriltovena","2020-07-23 12:11:18","true","Fluent bit docs (#2390)

* Improve documentation and fix all links for fluentbit.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Wrong file

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Reset fluentd

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add reference to ECS.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",118,27,0,1,"2018-04-16 10:25:39","827.57"
"grafana/loki","76e12529afac64920f76091f0b8eab445b479ed4","ductnn","2022-11-21 08:09:10","true","Just remove some spaces (#7681)

**What this PR does / why we need it**:

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the `CONTRIBUTING.md` guide
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",94,55,1,0,"2018-04-16 10:25:39","1675.91"
"grafana/loki","2c7309e0f78bbf8b3c08863351394d4d12035f24","NilsGriebner","2023-06-06 12:46:09","true","Fix configmap checksum in table manager deployment template (#9579)

**What this PR does / why we need it**:
This PR fixes the path to the configmap template in table-manager
deployment file

**Which issue(s) this PR fixes**:
Fixes #9578 

**Special notes for your reviewer**:

This is probably the same issue as in #9546.

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [x] Tests updated
- [x] `CHANGELOG.md` updated
- [x] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [x] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",70,62,1,0,"2018-04-16 10:25:39","1876.35"
"grafana/loki","22aae2e107c77a6e2b7d8042517d545fbaaffffa","antoonhuiskens","2023-07-13 15:16:24","true","Replacing sed with awk for determining systemd-version provides more … (#9925)

See https://github.com/grafana/loki/issues/9924

**What this PR does / why we need it**:
This PR addresses a parsing bug for package post install scripts.

**Which issue(s) this PR fixes**:
Fixes #9924

**Special notes for your reviewer**:

**Checklist**
- [X] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [X] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",58,63,1,0,"2018-04-16 10:25:39","1913.45"
"grafana/loki","10a1f28a85b5506c662688611442d31867fe2bc0","allout58","2020-05-27 17:33:20","true","Support Prometheus on a sub-path in Grafana config (#2099)

Co-authored-by: Cyril Tovena <cyril.tovena@gmail.com>",122,25,0,0,"2018-04-16 10:25:39","771.8"
"grafana/loki","293cf8d7a36d60fb606d44c47793c0c582c157f6","chaudum","2021-09-07 06:17:29","true","Export MemberlistKV field on Loki struct (#4276)

This field is used by GEL to configure the memberlist of the Admin API.

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",122,41,0,1,"2018-04-16 10:25:39","1236.58"
"grafana/loki","9cdb1295b5d13ed20a9584e10e029f7f45693c15","owen-d","2021-08-19 15:30:38","true","adds loki_ingester_wal_replay_active metric and records this more acc… (#4193)

* adds loki_ingester_wal_replay_active metric and records this more accurately

* adds WAL to msg",131,40,0,1,"2018-04-16 10:25:39","1218.96"
"grafana/loki","2c9fa05c29517d1b5b7dabd985d7dd20f0ee68fa","kavirajk","2022-09-09 08:33:58","true","feat(loki-canary): Add support to push logs directly to Loki. (#7063)


Add additional `push` mode to loki-canary, which pushes the logs
directly to given Loki URL as it generates logs.

The real function of Loki Canary is to act like a tenant and help us
know the whether Loki installation is working as perceived by a real
tenant.

Main rationale for this additional push mode is to make canary more
standalone without needing for `promtail` (or `grafana-agent`) to scrape
it's logs and send to loki, with this change, Loki canary happily tests
Loki behavior without needing any other dependencies.

**NOTES**:
1. If you run Loki behind any proxy that has different authorization
policies to READ or WRITE to Loki, then important change that canary
operator need to be aware of it, now the user credentials they pass via
`-user` and `-pass` to access loki endpoints need to have both `read'
and `write` permissions (previously canary just query the logs where as
promtail is the one pushes the logs, so just READ permissions was
sufficient).

2. There will be follow up PR(s) to cleanup, particularly `reader` and
`comparitor` component in terms of logging with proper logger. Rationale
is to keep the changes small per PR to make it easy to review.

3. This changes were tested it in one of the internal Loki dev cell.

4. **This PR is a no-op if this new `push` flag is disabled (it's disabled
by default)**

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>
Co-authored-by: Danny Kopping <danny.kopping@grafana.com>",85,53,1,1,"2018-04-16 10:25:39","1603.92"
"grafana/loki","3c52034d6392bc62eea86bf8258dbbb36b0dd6b6","vlad-diachenko","2023-06-06 19:35:48","true","[logcli] fixed query command that is run against user's bucket with TSDB index enabled (#9597)

**What this PR does / why we need it**:
set TSDB shipper mode to ReadOnly and disabled indexGatewayClient during
local query run. Also, I increase index downloading timeout to 1m
because the users run the query from local machines that not always have
more than 100Mbps

**Which issue(s) this PR fixes**:
Fixes #9555 

**Special notes for your reviewer**:
Unfortunately, we do not have similar tests and test architecture to
cover it with unit tests properly.

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [x] `CHANGELOG.md` updated
- [x] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [x] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",70,62,1,0,"2018-04-16 10:25:39","1876.63"
"grafana/loki","3808fb6ac39584b3e456710978a5e3469665adef","rfratto","2022-10-31 18:06:49","true","promtail: register reload metrics after running options (#7561)

**What this PR does / why we need it**:
This allows the reload metrics to be sent to a custom registerer, which
is required for Grafana Agent to be able to use the Promtail code.

**Which issue(s) this PR fixes**:
N/A 

**Special notes for your reviewer**:
Is it possible for us to cherry-pick this into k121? That's the version
we're trying to update Grafana Agent to.

**Checklist**
- [x] Reviewed the `CONTRIBUTING.md` guide
- [x] Documentation added
- [x] Tests updated
- [x] `CHANGELOG.md` updated
- [x] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",89,54,1,1,"2018-04-16 10:25:39","1656.32"
"grafana/loki","095f534b57a611540b24dd14593f30ee4a3e51d4","periklis","2021-06-08 05:44:10","true","Separate openshift from native k8s production overlays (#55)",201,38,0,1,"2018-04-16 10:25:39","1147.55"
"grafana/loki","604ad1632eea3a58bf7389a33d0b22bc2a2d1d35","cyriltovena","2020-07-22 16:47:18","true","Add regex function to promtail template stage. (#2386)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",117,27,0,1,"2018-04-16 10:25:39","826.77"
"grafana/loki","03be8dac1e1df72ff6e41699a8c318add5749a2a","cyriltovena","2022-01-03 19:00:36","true","Allow to disable http2 for GCS. (#4942)

* Allow to disable http2 for GCS.

This also tweaks our iddle connection pooling accross the board and reduce the insane parallelism when fetching chunks.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* update changelog

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Update pkg/storage/chunk/gcp/gcs_object_client.go

Co-authored-by: Danny Kopping <dannykopping@gmail.com>

* update comment

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Update docs/sources/configuration/_index.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* Update CHANGELOG.md

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* Reduce MaxIdleConns to a more standard value.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Allow to configure max parallelism for fetching  chunks

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes tests with no default config

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

Co-authored-by: Danny Kopping <dannykopping@gmail.com>
Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>",253,44,0,1,"2018-04-16 10:25:39","1353.11"
"grafana/loki","d24fe3e68be4be16b3654e6aedafaa71ac9d307c","salvacorts","2023-03-23 20:18:54","true","Max bytes read limit (#8670)

**What this PR does / why we need it**:

This PR implements two new per-tenant limits that are enforced on log
and metric queries (both range and instant) when TSDB is used:

- `max_query_bytes_read`: Refuse queries that would read more than the
configured bytes here. Overall limit regardless of splitting/sharding.
The goal is to refuse queries that would take too long. The default
value of 0 disables this limit.

- `max_querier_bytes_read`: Refuse queries in which any of their
subqueries after splitting and sharding would read more than the
configured bytes here. The goal is to avoid a querier from running a
query that would load too much data in memory and can potentially get
OOMed. The default value of 0 disables this limit.

These new limits can be configured per tenant and per query (see
https://github.com/grafana/loki/pull/8727).

The bytes a query would read are estimated through TSDB's index stats.
Even though they are not exact, they are good enough to have a rough
estimation of whether a query is too big to run or not. For more details
on this refer to this discussion in the PR:
https://github.com/grafana/loki/pull/8670#discussion_r1124858508.

Both limits are implemented in the frontend. Even though we considered
implementing `max_querier_bytes_read` in the querier, this way, the
limits for pre and post splitting/sharding queries are enforced close to
each other on the same component. Moreover, this way we can reduce the
number of index stats requests issued to the index gateways by reusing
the stats gathered while sharding the query.

With regard to how index stats requests are issued:
- We parallelize index stats requests by splitting them into queries
that span up to 24h since our indices are sharded by 24h periods. On top
of that, this prevents a single index gateway from processing a single
huge request like `{app=~"".+""} for 30d`.
- If sharding is enabled and the query is shardable, for
`max_querier_bytes_read`, we re-use the stats requests issued by the
sharding ware. Specifically, we look at the [bytesPerShard][1] to
enforce this limit.

Note that once we merge this PR and enable these limits, the load of
index stats requests will increase substantially and we may discover
bottlenecks in our index gateways and TSDB. After speaking with @owen-d,
we think it should be fine as, if needed, we can scale up our index
gateways and support caching index stats requests.

Here's a demo of this working:
<img width=""1647"" alt=""image""
src=""https://user-images.githubusercontent.com/8354290/226918478-d4b6c2fd-de4d-478a-9c8b-e38fe148fa95.png"">

<img width=""1647"" alt=""image""
src=""https://user-images.githubusercontent.com/8354290/226918798-a71b1db8-ea68-4d00-933b-e5eb1524d240.png"">


**Which issue(s) this PR fixes**:
This PR addresses https://github.com/grafana/loki-private/issues/674.

**Special notes for your reviewer**:

- @jeschkies has reviewed the changes related to query-time limits.
- I've done some refactoring in this PR:
- Extracted logic to get stats for a set of matches into a new function
[getStatsForMatchers][2].
- Extracted the _Handler_ interface implementation for
[queryrangebase.roundTripper][3] into a new type
[queryrangebase.roundTripperHandler][4]. This is used to create the
handler that skips the rest of configured middlewares when sending an
index stat quests ([example][5]).

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [x] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`


[1]:
https://github.com/grafana/loki/blob/ff847305afaf7de5eb56436f3683773e88701075/pkg/querier/queryrange/shard_resolver.go#L179-L186

[2]:
https://github.com/grafana/loki/blob/ff847305afaf7de5eb56436f3683773e88701075/pkg/querier/queryrange/shard_resolver.go#L72

[3]:
https://github.com/grafana/loki/blob/3d2fff3a2d416a48a73346a53ba7499b0eeb67f7/pkg/querier/queryrange/queryrangebase/roundtrip.go#L124

[4]:
https://github.com/grafana/loki/blob/3d2fff3a2d416a48a73346a53ba7499b0eeb67f7/pkg/querier/queryrange/queryrangebase/roundtrip.go#L163

[5]:
https://github.com/grafana/loki/blob/f422e0a52b743a11209b8276510feb2ab8241486/pkg/querier/queryrange/roundtrip.go#L521",83,59,1,1,"2018-04-16 10:25:39","1798.41"
"grafana/loki","0adedfa689d73289ec1c8277065253677f892bc3","chaudum","2023-03-30 07:53:00","true","Revert high cardinality metric in scheduler (#8946)

**What this PR does / why we need it**:

The metrics was useful for initial testing of the new scheduler queue implementation but yields high cardinality metrics, which is not desired. Also, the metric does not add additional value beyond the initial testing phase.

**Special notes for your reviewer**:

The metric was introduced with commit cba31024d4d0cc5c45612dd051c032f248817729

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",84,59,1,1,"2018-04-16 10:25:39","1804.89"
"grafana/loki","bba6c14459bea3e5ef6907c30e9f4341f6365d7d","DylanGuedes","2022-08-30 21:03:19","true","Loki: Modify ingesters to return rate-limited streams to distributors (#6977)

**What this PR does / why we need it**:
Modify ingesters to return a list of rate-limited streams on its reply to `(*distributor).Push`. This is done by using the gRPC details feature. I've updated the tests and apparently, the returned error message is exactly the same so this shouldn't be a breaking change.

Also modifies `(*stream).Push` to return a list of all entries with errors instead of returning the final gRPC error. This will allow us in the future to easily return to distributors the indices of all reject entries, so that distributors won't have to always retry all entries.

This work is necessary for the new stream sharding feature.",80,52,1,1,"2018-04-16 10:25:39","1595.44"
"grafana/loki","0b40cc953de7d8288b795fa5399e5229c8895886","DylanGuedes","2021-10-28 15:05:45","true","Rename hybrid mode to simple scalable mode. (#4576)",166,42,0,1,"2018-04-16 10:25:39","1287.94"
"grafana/loki","3c78579676562b06e73791d71fcf6e3abf50a014","kavirajk","2021-04-20 09:13:56","true","Add json struct tags to limits. (#3628)",161,36,0,1,"2018-04-16 10:25:39","1099.7"
"grafana/loki","cfd17090fc963438b44c17db2be4a9c3344bc1ee","trevorwhitney","2023-04-24 21:56:12","true","Finalize 2.8.1 changelog and release notes (#9272)

**What this PR does / why we need it**:

Brings over the correct 2.8.1 changelog and release notes from
`release-2.8.x`.

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",78,60,1,1,"2018-04-16 10:25:39","1834.73"
"grafana/loki","b251a1023492293cb660beabaaa27f04fd950cc9","owen-d","2023-06-29 19:04:03","true","uses lowercase standard for logging and adds total bytes to shard res… (#9828)

Minor logging cleanup + helpful to have total bytes on this log line to
correlate without needing to derive total bytes from factor *
bytes_per_shard",59,62,1,1,"2018-04-16 10:25:39","1899.61"
"grafana/loki","46956d0bf6367aa320de22eb42345b3edb0166ac","jeschkies","2022-03-30 11:06:42","true","Use dskit/tenant intead of loki/pkg/tenant. (#5724)",309,47,0,1,"2018-04-16 10:25:39","1439.78"
"grafana/loki","1e0b2707cd38f34b9dbaf6f7f3c2e83503e203d9","Alan01252","2021-12-06 07:30:29","true","Fix replace missing adjacent capture groups (#4874)",215,44,0,0,"2018-04-16 10:25:39","1325.63"
"grafana/loki","2aafb0d38a74c4eafd1e1e6650e60ae7888966cc","KMiller-Grafana","2021-07-06 23:58:28","true","Docs: revise the LogCLI subsection (#3921)

* Docs: revise the LogCLI subsection

* Update docs/sources/getting-started/logcli.md per review suggestion

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>

* Incorporate review suggestion.

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>",119,39,0,0,"2018-04-16 10:25:39","1176.31"
"grafana/loki","8e4c3fb6b9e1cfea07d88b8ac9f1a047001941c9","blockloop","2021-03-26 14:09:43","true","fix missing error return (#11)",144,35,0,0,"2018-04-16 10:25:39","1070.66"
"grafana/loki","f23aa6512ad19d75a94f63e50dca6694ac509461","blockloop","2021-03-19 20:36:30","true","add some tests",169,35,0,0,"2018-04-16 10:25:39","1063.92"
"grafana/loki","b5b3e78424e31d69ee4eee6912b57ac44fcc2117","slim-bean","2020-04-16 20:22:12","true","Loki Update the cut block size counter when creating a memchunk from byte slice (#1946)

* Update the cut block size counter when creating a memchunk from byte slice

* Refactor how we create memchunks to require specifying the block size and target size",115,24,0,1,"2018-04-16 10:25:39","730.91"
"grafana/loki","9ab14c9e0afaa54683dc917477f317898b510ecc","tomwilkie","2019-03-20 18:25:15","false","Add readLines.Inc() call back.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",91,11,0,0,"2018-04-16 10:25:39","334.33"
"grafana/loki","b11583548746da29c005ae6d640681050355d5c4","tomwilkie","2019-02-18 15:09:03","true","Test & fix queries return multiple streams. (#341)

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",78,10,0,0,"2018-04-16 10:25:39","302.2"
"grafana/loki","00245403d958fa7bd345db0e7745daf77813dc00","sh0rez","2019-09-26 14:26:27","true","feat: configuration source precedence (#980)

This implements more sophisticated handling of our configuration:

- Correct precedence: Flags set on the command line now precede values from YAML, which in turn precede the defaults from the `flag` package
- Sticks to the `flagext.Registerer` pattern, as it is partly vendored from Cortex / Weaveworks code we cannot change easily",71,17,0,0,"2018-04-16 10:25:39","525.42"
"grafana/loki","04716b5d09024a9d3bd4ae927950a9ed77920ee9","kavirajk","2023-09-22 07:21:25","true","dependabot: Fix accessing secerets via environmental variables. (#10675)

**What this PR does / why we need it**:
Noticed, the dependencies auto-merge is breaking with error.
```
gh: To use GitHub CLI in a GitHub Actions workflow, set the GH_TOKEN environment variable. Example:
  env:
    GH_TOKEN: ${{ github.token }}
```

https://github.com/grafana/loki/actions/runs/6222148810/job/16885518452?pr=10623

After some investigation. The suspect is secerets are not properly
imported into the GH actions (NOTE from above GH run, the env
`GITHUB_TOKEN` is set empty).

Also from the docs, this token can be set either by `GITHUB_TOKEN` or
`GH_TOKEN`. `GITHUB_TOKEN` will get higher priority.
https://cli.github.com/manual/gh_help_environment
**Which issue(s) this PR fixes**:

Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",33,65,1,1,"2018-04-16 10:25:39","1982.12"
"grafana/loki","1ec0a31b3309b1920b340539c320e38cd8b75b5b","owen-d","2021-08-12 19:04:01","true","updates scheduler libsonnet (#4154)

* updates scheduler libsonnet

* use `frontend_worker.match_max_concurrent` rather than calculate it",123,40,0,1,"2018-04-16 10:25:39","1212.11"
"grafana/loki","b9a9cdf2f7202871f5b58f425fb064f1acd7af60","dannykopping","2023-01-13 09:15:46","true","Fixing test regression (#8130)

Regression introduced by #7723 which was merged around the same time

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",97,57,1,1,"2018-04-16 10:25:39","1727.95"
"grafana/loki","6df6ef158586980b98299f85b9f210ffc124a648","slim-bean","2020-04-08 15:42:44","true","this Dockerfile is a remnant from a long time ago, not needed. (#1918)

Signed-off-by: Edward Welch <edward.welch@grafana.com>",115,24,0,1,"2018-04-16 10:25:39","717.47"
"grafana/loki","6ef934b24c695ed5a7872d212552265d82b303a7","cyriltovena","2022-01-10 09:41:16","true","Fix deadlock in disconnecting querier (#5063)

* Fix deadlock in disconnecting querier

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* lint

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Update pkg/querier/worker/worker_test.go

Co-authored-by: Trevor Whitney <trevorjwhitney@gmail.com>

* Update pkg/querier/worker/worker_test.go

Co-authored-by: Trevor Whitney <trevorjwhitney@gmail.com>

* Uses in-memory GRPC server for tests

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

Co-authored-by: Trevor Whitney <trevorjwhitney@gmail.com>",254,45,0,1,"2018-04-16 10:25:39","1359.72"
"grafana/loki","87c63855ddf00747adb94f9f828a28fc4f76ad65","cyriltovena","2020-04-01 18:48:16","true","Sign helm package with GPG. (#1864)

* Sign helm package with GPG.

Also add GPG to the build image and fixes dlv not pinned (this was causing issue using latest 1.4).

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Regen drone config.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Testing CI.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Test CI.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Include .prov files for charts.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Revert testing changes.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add public GPG key for verifying helm charts.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",121,23,0,1,"2018-04-16 10:25:39","710.6"
"grafana/loki","966bed72d3247a15c7f94a14ca13b536edb30f74","sandeepsukhani","2021-05-27 11:13:04","true","reduce allocs in delete requests manager by reusing slice for tracing non-deleted intervals for chunks (#3769)",204,37,0,1,"2018-04-16 10:25:39","1136.78"
"grafana/loki","589e53d844cbb7402643c22f55c8a9c537782016","cyriltovena","2020-01-08 15:31:31","true","Fixes response json encoding and add regression test. (#1488)

Also align stream labels alphabetical order with querier.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",104,21,0,1,"2018-04-16 10:25:39","627.46"
"grafana/loki","2561a7015512a8a43df95a6f7cf377d2d1dc27be","cyriltovena","2019-07-30 12:29:44","true","fix tail library logs to use our own log format (#579)

* fix tail library logs to use our own log format

* PR Feedbacks",104,15,0,1,"2018-04-16 10:25:39","469.34"
"grafana/loki","dbeb9840d148c359fc527a67ff31896f14f93b4c","cyriltovena","2021-04-30 13:41:23","true","Add a dashboard for retention to the loki-mixin. (#3658)

* Add a dashboard for retention to the loki-mixin.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Update dashboard to reflects last changes.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",179,36,0,1,"2018-04-16 10:25:39","1109.89"
"grafana/loki","681195f806172170be4300b957823240445c86f4","cyriltovena","2022-04-14 12:46:49","true","Fixes the index-gateway when using the ring (#5923)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",318,48,0,1,"2018-04-16 10:25:39","1453.85"
"grafana/loki","cdd08b041ade2c0f4fcd8785f5e4d8f07278302e","cyriltovena","2020-02-19 22:44:18","true","Expose QueryType function. (#1719)

* Expose QueryType function.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Expose query type const.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",116,22,0,1,"2018-04-16 10:25:39","668.76"
"grafana/loki","cf8be4a55e913f419eb721535db3e1a416b77183","slim-bean","2021-02-26 19:01:16","true","remove directories from object store list operation (#3394)",133,34,0,1,"2018-04-16 10:25:39","1040.86"
"grafana/loki","7deb02b53218de6afc33023370a65e6d91e6bbba","slim-bean","2019-07-23 14:40:28","false","add a Name() method to the stage interface so that debug logging can show you the name of the pipeline stage which just processed the log
remove some unnecessary logging around fsnotify events we don't care about and saving positions
Make the Processing Log Lines doc a first class citizen, I reference this a lot and currently it's hidden behind 3 clicks",103,15,0,1,"2018-04-16 10:25:39","462.43"
"grafana/loki","d3867cf2c5a1e1a91b531025f00169733f3d8169","pracucci","2019-10-05 16:19:45","false","Publish loki-canary binaries on release",74,18,0,0,"2018-04-16 10:25:39","534.5"
"grafana/loki","951dd66775275a54b4ef518797038ab1b94bd8a0","JStickler","2023-09-07 14:43:45","true","update README links (#10490)

**What this PR does / why we need it**:

Some of the docs files have moved. Updating links in the README now that
2.9 has been released.",44,65,1,0,"2018-04-16 10:25:39","1967.43"
"grafana/loki","00d5142c40ff5892e642f7759b928f9552bad1f8","ssncferreira","2023-02-10 16:56:42","true","Helm: add sleep argument to helm makefile on local development (#8502)",80,58,1,0,"2018-04-16 10:25:39","1755.27"
"grafana/loki","81f4643f8a6b7815b5e8a66c8ecd2eb09beb21d2","vlad-diachenko","2022-11-24 11:25:07","true","[CI/CD] fixed step `deploy` (#7715)",94,55,1,0,"2018-04-16 10:25:39","1679.04"
"grafana/loki","c7e18f535cc1dd849974d23f2de448e5ccf04e2e","DylanGuedes","2022-04-13 12:04:58","true","Do not use boltdb-shipper if no ring or address are given. (#5902)",319,48,0,1,"2018-04-16 10:25:39","1452.82"
"grafana/loki","9b6f17f168679ef8f5a2653d0534377e06c7d1ef","cyriltovena","2022-02-15 20:38:27","true","Add the total number of subqueries to query statistics (#5397)

* Add subqueries count

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes tests

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",289,46,0,1,"2018-04-16 10:25:39","1395.18"
"grafana/loki","5f07e95fc8609b368e4d1eaba13518c128c3d47f","jeschkies","2022-01-13 15:23:08","true","Document query limit parameter default. (#5133)",262,45,0,1,"2018-04-16 10:25:39","1362.96"
"grafana/loki","e54a1b21c3e02e4f10fda6b1023ca02e683db6c6","gouthamve","2019-04-25 15:14:07","true","vendor: update cortex (#512)

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>",96,12,0,0,"2018-04-16 10:25:39","374.45"
"grafana/loki","c52aa211a8de358498fa78d5f898bdc342615d96","daniellee","2018-12-11 09:00:30","false","readme changes

Signed-off-by: Daniel Lee <dan.limerick@gmail.com>",12,8,0,0,"2018-04-16 10:25:39","234.94"
"grafana/loki","2fc20af9a4e55483afe0f09f8a8119ab380daea9","slim-bean","2022-06-28 01:54:19","true","Promtail: disable syslog tests which have expired certs (#6520)

* disable tests which are failing from hardcoded certs which are now expired.

Signed-off-by: Edward Welch <edward.welch@grafana.com>

* lint

Signed-off-by: Edward Welch <edward.welch@grafana.com>",73,50,0,1,"2018-04-16 10:25:39","1532.64"
"grafana/loki","5a5bcb16e27845aaa0eca9aa861058a6154f4673","jeschkies","2021-08-04 07:55:17","true","Document 0 meaning for retries. (#4096)",103,40,0,1,"2018-04-16 10:25:39","1203.65"
"grafana/loki","d450451c074ca93ac210b594b6c51291a469a49d","DylanGuedes","2022-01-03 15:12:47","true","Copy `cortex/pkg/ruler/rulestorage` package dependency into Loki (#4978)

* Fork cortex `pkg/ruler/rulestore` package.

* Replace cortex `pkg/rulestore` usage.

* Apply formatting.",254,44,0,1,"2018-04-16 10:25:39","1352.95"
"grafana/loki","eff4d7ece536f6028a9704bac5b0f7dfb4cd4718","kavirajk","2023-10-16 18:43:37","true","chore(renovate): make sure to `go mod tidy` after upgrade (#10919)",23,66,1,1,"2018-04-16 10:25:39","2006.6"
"grafana/loki","cb5e4887d0da35d7e901106cf2823391e60ce988","slim-bean","2020-06-02 19:48:16","true","Fix some errors in the upgrade guide to 1.5.0 and add some missing notes discovered by users. (#2160)",124,26,0,1,"2018-04-16 10:25:39","776.89"
"grafana/loki","02aed71a28b0a0ce947a410cf5049e43e10ad252","slim-bean","2019-06-12 19:17:04","false","refactoring things so that the comparator can use the reader to make a direct query to loki to look for logs not received over the websocket  before reporting them as missing",108,14,0,1,"2018-04-16 10:25:39","421.62"
"grafana/loki","002dd8aa7862a5b8c63eeb046c02c6a81b205c19","irizzant","2022-06-28 23:01:38","true","Loki Prometheus mixin: Fix incorrect selectors and simplify mixin usage (#6189)

* fix(dashboards): fix matchers and selectors

Signed-off-by: irizzant <i.rizzante@gmail.com>

* doc: add entry in CHANGELOG

* feat(dashboards): add kube-prometheus mixin

Signed-off-by: irizzant <i.rizzante@gmail.com>

* doc: update CHANGELOG

* fix(mixins): fix wrong job selectors

Signed-off-by: irizzant <i.rizzante@gmail.com>

* Revert ""fix(mixins): fix wrong job selectors""

This reverts commit f819a0b3.

* fix(dashboards): add ServiceMonitor object

Signed-off-by: Ivan Rizzante <i.rizzante@gmail.com>

* fix(jsonnet): format jsonnet

Signed-off-by: irizzant <i.rizzante@gmail.com>

* fix(dashboards): add ServiceMonitor to Loki Simple Scalable

Signed-off-by: irizzant <i.rizzante@gmail.com>

* Revert ""fix(dashboards): add ServiceMonitor to Loki Simple Scalable""

This reverts commit ba24006281af07929a3944f5863fee369c7de8ab.

* doc: add details about create_service_monitor` parameter

Signed-off-by: irizzant <i.rizzante@gmail.com>",75,50,0,0,"2018-04-16 10:25:39","1533.52"
"grafana/loki","b13995e2017a0564a96c457e41284974b2194902","owen-d","2023-02-08 10:41:14","true","logs sharding astmapperware to spans in addition to logs (#8457)",77,58,1,1,"2018-04-16 10:25:39","1753.01"
"grafana/loki","b8f26c55a75a90764018f9bedccd887efabe0bc5","EraYaN","2023-01-10 16:19:20","true","Helm: Fix loki helm chart podLog relabelings template nindent (#8080)

**What this PR does / why we need it**:
Fix loki helm chart to properly accept podLog relabelings by changing
nindent from 8 to 4. This makes the podLog relabelings usable.

Other wise helm complains with
```
Error: UPGRADE FAILED: YAML parse error on loki/templates/monitoring/pod-logs.yaml: error converting YAML to JSON: yaml: line 32: mapping values are not allowed in this context
```

Don't think documentation is required because clearly nobody was using
this.

**Checklist**
- [x] Reviewed the `CONTRIBUTING.md` guide
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",100,57,1,0,"2018-04-16 10:25:39","1725.25"
"grafana/loki","40ed217620bc340ce521c02c99a7000458b652fa","trevorwhitney","2023-01-24 17:01:55","true","Make secret job fail when not logged in (#8215)

Co-authored-by: Susana Ferreira <ssncferreira@gmail.com>",83,57,1,1,"2018-04-16 10:25:39","1739.28"
"grafana/loki","74b16fb71d2ba12feebf9656277b9b3a8808a128","xperimental","2023-06-12 18:42:36","true","operator: Fix availability of demo LokiStack size (#9689)",67,62,1,1,"2018-04-16 10:25:39","1882.6"
"grafana/loki","55045add9373f7b566bb3ac431d0cba74360bb0b","periklis","2023-03-17 12:34:42","true","operator: Fix publishing operator bundle on quay.io (#8815)",85,59,1,1,"2018-04-16 10:25:39","1792.09"
"grafana/loki","cd1ba1911e90324f176ada2b44c1dc8a33f44fa4","Dbzman","2023-01-13 15:20:04","true","Fix labels for alerts (#7886)

This fixes wrong labels for the LokiCanaryLatency alert and introduces
""cluster"" as label for LokiTooManyCompactorsRunning to be able to have
multiple loki instances in the same namespace.

documented in `docs/sources/upgrading/_index.md`",97,57,1,0,"2018-04-16 10:25:39","1728.2"
"grafana/loki","433d883fcd7b837b927637e09893008cd2eec356","xinbinhuang","2022-12-06 05:57:06","true","Fix broken canary loki alerts (#7860)",96,56,1,0,"2018-04-16 10:25:39","1690.81"
"grafana/loki","b147e6ccba237276b7cc2d6dff8f8cda1fd09aed","Red-GV","2022-11-16 21:20:22","true","operator: Remove default value from replicationFactor field (#7711)",93,55,1,1,"2018-04-16 10:25:39","1671.45"
"grafana/loki","48def27e1e42e33ace2eb87cb72efa55d37ededf","cyriltovena","2019-05-08 13:19:59","false","fix review feedback",99,13,0,1,"2018-04-16 10:25:39","387.37"
"grafana/loki","0f0cb9fc9973e8b619a25dfbdfcb912e120f6ff8","JordanRushing","2021-08-31 18:58:11","true","Add missing `Inc()` to correctly increment the `dropStage.dropCount` metric on valid dropped log line; update related docs (#4246)",130,40,0,0,"2018-04-16 10:25:39","1231.11"
"grafana/loki","df1b34898bea812b197ca7404b29094f740df26c","jdbaldry","2023-04-14 19:13:26","true","Use centralized make-docs script from Writers' Toolkit (#9126)

- Adds ability to build multiple projects simultaneously using, for
example, `make docs PROJECTS='grafana grafana-cloud'`.
- Adds `make doc-validator` which runs
[`doc-validator`](https://github.com/grafana/technical-documentation/tree/main/tools/cmd/doc-validator)
on all documentation.

Using a centralized script will help ensure consistency in workflow
across all projects.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>",81,60,1,0,"2018-04-16 10:25:39","1819.37"
"grafana/loki","5b6d64c89ec032e1b9931640c5ffb220ac1f321e","owen-d","2021-01-15 19:55:14","true","sts rulers (#3179)",119,33,0,1,"2018-04-16 10:25:39","999.9"
"grafana/loki","db238873f9589c669202f5ae93445b72ed9175b7","chaudum","2022-04-21 07:23:47","true","Call correct method on index store (#5979)

when index gateway does not implement the new API.

This bug did not yield an error but only returned incorrect results
because both functions `c.IndexStore.LabelNamesForMetricName` and
`c.IndexStore.LabelValuesForMetricName` return `([]string, error)`.

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",171,48,0,1,"2018-04-16 10:25:39","1465.87"
"grafana/loki","d667dd20f2878c372cef87fcd61f14b0267ff3bd","kavirajk","2021-02-03 12:55:40","true","Avoid putting all the GCP labels into loki labels (#3284)",123,33,0,1,"2018-04-16 10:25:39","1017.6"
"grafana/loki","9807f7c43e4e46be367372d241a15406fdf89d19","cyriltovena","2020-11-24 13:55:58","true","Avoid parsing labels when tailer is sending from a stream. (#2973)

* Avoid parsing labels when tailer is sending from a stream.

This also include some code cleanup.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* I got linted.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",113,31,0,1,"2018-04-16 10:25:39","948.65"
"grafana/loki","88c17ed7abf4d541040183275f3661a4d153d162","salvacorts","2023-07-17 07:52:38","true","Include entry metadata bytes in metrics tracking ingestion stats (#9808)

**What this PR does / why we need it**:
In https://github.com/grafana/loki/pull/9694 we added support for adding
metadata labels to each entry in a push payload. In this PR we update
the following metrics to take into account the bytes needed to store
those labels:

-  `loki_distributor_bytes_received_total`
- `distributor_bytes_received`

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

---------

Co-authored-by: Sandeep Sukhani <sandeep.d.sukhani@gmail.com>",59,63,1,1,"2018-04-16 10:25:39","1917.14"
"grafana/loki","7e53381eee534c0db54f12605dad09cfdd4c8de8","cyriltovena","2022-06-03 10:40:15","true","Avoid line copy during LogQL line_format (#6104)",72,50,0,1,"2018-04-16 10:25:39","1508.01"
"grafana/loki","cdde6aa49dbb98d6bbfa0f29e0b3b3023211ca08","sandeepsukhani","2022-02-28 16:51:20","true","mount overrides volume to index gateways (#5493)",300,46,0,1,"2018-04-16 10:25:39","1408.02"
"grafana/loki","64589d03393713d0571138e8b3e50169543e9d9a","SasSwart","2022-02-15 13:51:13","true","Logql: Correct grouping type in pkg/logql/expr.y (#5306)

* Correct grouping type in pkg/logql/expr.y

* Use loki-build-image to build loki instead of golang image

* Include goyacc and other required tools to allow Makefile to run

* Remove dependencies not relevant to yacc in cmd/loki/Dockerfile

* Use go install instead of go get to install goyacc in cmd/loki/Dockerfile

* Add goyacc to logcli and loki-canary Dockerfiles

* Rerun CI

* Rerun CI

* Revert ""Add goyacc to logcli and loki-canary Dockerfiles""

This reverts commit 0ee887c57fb9306711d7dadc81edf84fe8fa0d55.

* Remove goyacc from cmd/loki/Dockerfile

* Formatting of cmd/loki/Dockerfile",289,46,0,0,"2018-04-16 10:25:39","1394.89"
"grafana/loki","4fdfbe8e566b68c76e35151189087a0f4e5e9a45","cyriltovena","2020-02-26 19:30:36","true","Increase discarded samples when line is too long. (#1708)

* Increase discarded samples when line is too long.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Add comment on the public props

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

Co-authored-by: Joe Elliott <joe.elliott@grafana.com>",118,22,0,1,"2018-04-16 10:25:39","675.63"
"grafana/loki","5cd384a2aff80d8952f77a3ac38eaa126a94bcfd","cyriltovena","2019-09-05 14:15:08","false","Allow to pass max-size and max-file to the docker driver",123,17,0,1,"2018-04-16 10:25:39","504.41"
"grafana/loki","a196c27354dbc43fabc10101a3edc0eb1765f23e","woodsaj","2019-01-22 08:13:29","true","Merge pull request #234 from grafana/2019-01-22-fix-ksonnet-container-label

fix container_name label",62,9,0,0,"2018-04-16 10:25:39","275.91"
"grafana/loki","a118e994d8e9110782c6a4d3817ba3e4411cc9dd","ashwanthgoli","2023-10-30 11:46:30","true","Remove shared_store and shared_store_key_prefix from shipper and compactor (#10840)

**What this PR does / why we need it**:
#### Removes `shared_store` and `shared_store_key_prefix` from index
shipper and compactor configs and their corresponding CLI flags.

- `-tsdb.shipper.shared-store`
- `-boltdb.shipper.shared-store`
- `-tsdb.shipper.shared-store.key-prefix`
- `-boltdb.shipper.shared-store.key-prefix`
- `-boltdb.shipper.compactor.shared-store`
- `-boltdb.shipper.compactor.shared-store.key-prefix`

`shared_store` has been a confusing option allowing users to easily
misconfigure Loki.
Going forward `object_store` setting in the
[period_config](https://grafana.com/docs/loki/latest/configure/#period_config)
(which already configured the store for chunks) will be used to
configure store for the index.

And the newly added `path_prefix` option under the `index` key in
`period_config` will configure the path under which index tables are
stored.

This change enforces chunks and index files for a given period reside
together in the same storage bucket. More details in the upgrade guide.

---

`-compactor.delete-request-store` has to be **explicitly configured**
going forward. Without setting this, loki wouldn't know which object
store to use for storing delete requests. Path prefix for storing
deletes is decided by `-compactor.delete-request-store.key-prefix` which
defaults to `index/`.


**Checklist**
- [X] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [X] Documentation added
- [X] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [X] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",16,66,1,0,"2018-04-16 10:25:39","2020.31"
"grafana/loki","f3993e2aa0adda37891befc4a6b4388ec085e3f6","irizzant","2023-04-28 16:58:28","true","Loki microservices Tanka: remove unintended override (#9345)

**What this PR does / why we need it**:
There is a duplicated ConfigMap volume definition in Ingester
StatefulSet when:
` multi_zone_ingester_enabled: false,`

Generated json:
```
""ingester_statefulset"": {
...
    ""terminationGracePeriodSeconds"": 4800,
          ""volumes"": [
            {
              ""configMap"": {
                ""name"": ""loki""
              },
              ""name"": ""loki""
            },
            {
              ""configMap"": {
                ""name"": ""overrides""
              },
              ""name"": ""overrides""
            },
            {
              ""configMap"": {
                ""name"": ""loki""
              },
              ""name"": ""loki""
            },
            {
              ""configMap"": {
                ""name"": ""overrides""
              },
              ""name"": ""overrides""
            }
          ]
        }
      },
```

**Which issue(s) this PR fixes**:
Fixes #9344",80,60,1,0,"2018-04-16 10:25:39","1838.52"
"grafana/loki","8c43a18f8ecdc8d44b54f9f9302307db47a2b13e","tomwilkie","2018-05-16 09:20:30","false","Add user auth http middleware.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",0,1,0,0,"2018-04-16 10:25:39","29.95"
"grafana/loki","8415b375689be66a4eee5f75b66d071aaa4d7599","Red-GV","2021-05-27 15:30:24","true","Creating telemetry metrics for loki operator based on complete build spec (#32)",200,37,0,1,"2018-04-16 10:25:39","1136.96"
"grafana/loki","041b612bdff3d4963aedcd026b6cc8a2917a966a","cyriltovena","2019-12-13 16:27:06","true","Add Joe as member of the team. (#1415)

Welcome !",93,20,0,1,"2018-04-16 10:25:39","602.5"
"grafana/loki","d3579bbeefa479b7ba5ab796ff03559382e07525","tomwilkie","2018-05-20 11:01:46","false","Add server side regex filtering.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",0,1,0,0,"2018-04-16 10:25:39","34.03"
"grafana/loki","b4bd96073cec96394cd17a9125fe6ec5dc315766","sandeepsukhani","2021-10-28 14:23:37","true","validate default limits config with other configs at startup (#4573)

* validate default limits config with other configs at startup

This should also parse and set the matchers in default stream retention config

* directly set matchers in stream retention instead of building the whole struct again",167,42,0,1,"2018-04-16 10:25:39","1287.92"
"grafana/loki","569748ff185c2485c9cb28decbaae538490e9847","sandeepsukhani","2019-10-03 13:51:07","false","logging: removed some noise in logs from live-tailing (#1100)

* Removed some noise in logs by detecting cases where connection is erroring due to stopped or closed tail request

* fixed log formats",75,17,0,1,"2018-04-16 10:25:39","532.39"
"grafana/loki","ce76ad099aff57f380851e6e9f7d47aefdacb536","cyriltovena","2020-07-13 18:23:10","true","Fixes LogQL grouping (#2346)

* Work in progress ! debugging this.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* wip
Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* It was indeed the missing sort before processing aggregation.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",118,27,0,1,"2018-04-16 10:25:39","817.83"
"grafana/loki","9fcb8b8e4a14db6e53626db503879518e78a7bbb","aminjam","2020-09-28 19:51:29","true","Add fallback_formats for timestamp stage (#2615)

Fixes grafana/loki#2590

Co-authored-by: Amin Jamali <ajamali@vmware.com>",123,29,0,0,"2018-04-16 10:25:39","892.89"
"grafana/loki","58bdd4440a70c43be5e4b68466795b70406af599","chaudum","2023-09-06 06:56:47","true","Make the Store field of the Loki struct an interface type (#10465)

**What this PR does / why we need it**:

Applications that extends the `Loki` struct must be able to also override the `Store`. In order to allow this, the field must be an interface type, so any `storage.Store` implementation can be assigned.

**Special notes for your reviewer**:

This reverts the change from interface type to struct type made in PR #10435.

Signed-off-by: Christian Haudum <christian.haudum@gmail.com>",46,65,1,1,"2018-04-16 10:25:39","1966.1"
"grafana/loki","82035397df4998170731426ce27d4457fc60a333","owen-d","2021-03-17 13:16:06","true","adds deprecation notice for chunk transfers (#3442)",160,35,0,1,"2018-04-16 10:25:39","1061.62"
"grafana/loki","633b4cab531a3b3b8afc6d86184ddc5a4eb6f63d","owen-d","2021-10-29 16:38:09","true","ignore validity window during wal replay (#4596)",168,42,0,1,"2018-04-16 10:25:39","1289.01"
"grafana/loki","f937d021b608a9468ed86d75f8cae2cb7baab836","kavirajk","2023-08-03 08:03:47","true","chore(dependabot): Remove enable auto-merge (#10158)

**What this PR does / why we need it**:
After some debugging and discussing with internal security squad, the
core problem for the this permission issue with auto-merge is
```
GraphQL: [""Pull request User is not authorized for this protected branch""] (enablePullRequestAutoMerge)
```

The settings ""Restrict who can push it to protected branch"" rule we have
`main` branch.

And currently no way to add `github-action` user to this list (there is
an open discussion https://github.com/orgs/community/discussions/25305

I proposed an idea to use some ""real"" user's (even grafana-bot) token to
do the ""auto-merge"". But that is still under review by security squad.

Meanwhile, to unblock merging any dependabot PR, I'm removing this step.

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:
Related to #10126 #10141 #10144 

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",53,64,1,1,"2018-04-16 10:25:39","1933.15"
"grafana/loki","bd4a76c23bc092e9fcf02c50254cc481c5b2d19b","sandeepsukhani","2019-08-08 06:37:49","false","update docker image for bigtable-backup tool",99,16,0,1,"2018-04-16 10:25:39","477.09"
"grafana/loki","61b60092af67dad4f7439b3b92f71fbdc6990181","sandeepsukhani","2021-05-31 05:46:41","true","initialize retention and deletion components only when they are enabled (#3772)",204,37,0,1,"2018-04-16 10:25:39","1140.56"
"grafana/loki","fa7ea9cc2d8bf5fa59c75b6a36236802c5650ac7","cyriltovena","2020-11-18 08:40:50","true","Fixes iota unexpected behaviour with bytes for chunk encoding. (#2945)

* Fixes iota unexpected behaviour with bytes for chunk encoding.

This was introducing incompatibilities since iota with bytes starts at 2.
Seems like a weird conversion between iota int and byte.

This can currenlty corrupt chunks, and previous chunks are not decodable.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* With iota correclty this time.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",122,31,0,1,"2018-04-16 10:25:39","942.43"
"grafana/loki","ce4f78515f945c665df1a9fa0b0ae9b7b18e6829","cyriltovena","2021-03-04 23:01:57","true","Improve the parser hint tests. (#3429)

I was able to find out where was the issue with that test yesterday.
Now I realized that we can mutate (re-slice) the given log line, and so other test would fail.

This also make the parallel back.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",141,34,0,1,"2018-04-16 10:25:39","1049.03"
"grafana/loki","d44b6892eb2cd6aba47c6f1ea5e19d89af0692c9","cyriltovena","2022-02-11 10:25:46","true","Fixes memberlist usage report (#5369)

* Fixes memberlist usage report

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Fixes the linter and improve comment

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",281,46,0,1,"2018-04-16 10:25:39","1390.75"
"grafana/loki","def76e0897791dbc158e9693cb8fc730f5be3727","jkroepke","2023-08-18 08:47:48","true","[helm] Use the correct name of the service inside the ingress. (#10290)

**What this PR does / why we need it**:

Use the correct name of the service inside the ingress.

The service names could be different, if release name is not loki.

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [ ] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

---------

Signed-off-by: Jan-Otto Kröpke <mail@jkroepke.de>
Co-authored-by: Michel Hollands <42814411+MichelHollands@users.noreply.github.com>",50,64,1,0,"2018-04-16 10:25:39","1948.18"
"grafana/loki","ca67292b54e9832f337bdef727f1fff17ccf7b26","JordanRushing","2021-10-22 18:02:42","true","Introduce `overrides-exporter` module to Loki (#4520)

* Introduce overrides-exporter module from cortex into loki; add some test configs for local dev

* Fix panic by adding server dependency to overrides-exporter module

* Add tests for limits exporter

* Remove dummy configs for testing

* Add more limits to export

* Add more limits; move mockTenantLimits to exporter_test.go

* Introduce overrides-exporter module from cortex into loki; add some test configs for local dev

* Fix panic by adding server dependency to overrides-exporter module

* Add tests for limits exporter

* Remove dummy configs for testing

* Add more limits to export

* Add more limits; move mockTenantLimits to exporter_test.go

* Use reflection; add more limits to export

* Fix import to satisfy linter

* refactors TenantLimits for clarity & efficiency. Also fixes tenantLimits nil check

* Fix breaking test with nil check in runtime_config

Co-authored-by: Owen Diehl <ow.diehl@gmail.com>",165,42,0,0,"2018-04-16 10:25:39","1282.07"
"grafana/loki","ea37f4595da1c9b5b0e7505034d469f0b5ef59c3","vlad-diachenko","2022-02-03 11:16:16","true","added upgrade notes (#5311)",276,45,0,0,"2018-04-16 10:25:39","1382.79"
"grafana/loki","bfb24e6a4c4a4a6968a3a0b5df2277bfcda73a9c","kavirajk","2021-07-22 09:54:22","true","Ip matcher for LogQL (#3986)

* IP matcher and filter via netaddr.IP package

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Adding IP filter into label filter gramer

1. ast tests
2. parse tests

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Label filters all test cases passes

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Rename ipFilter -> ipLabelFilter

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* More tests

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Remove testlogs.txt

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Make linter happy

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Add more cases to the benchmark

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* PR remarks

1. support NEQ
2. reduce allocation.
3. Minor tweaks

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Make IP filter work as line filter

1. Add necessary interface implementation
2. More tests for parser and ast

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Make linter happy

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Bug with filter matcher

Its wierd bug. Not handing string() method breaks the parser :(

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Split Line and Label filter to different struct.

It got out of hands to handle both in same struct.

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Add basic doc for IP matcher

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* Add docs feedback from Karen

* Label filter add patter error report

* PR remarks

1. Indendation fix
2. Remove string() interface for ip label filte

* Linter happy

* PR remaks

* Fix ip label matcher string() method if pattern is invalid

* Fix label filter tests

* Have local copy of `pattern` in label filter to use in string()

* Rebase conflicts

* ast.go fixes",97,39,0,1,"2018-04-16 10:25:39","1191.73"
"grafana/loki","cecadf2a18639ff22a305e8658bca2084d229e0b","kavirajk","2022-01-05 16:14:28","true","Chore: Remove `cortex/util/test` dependency (#5050)

* Remove `cortex/util/test` dependency

Copy `util/test.Poll` into Loki

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>

* go mod vendor

Signed-off-by: Kaviraj <kavirajkanagaraj@gmail.com>",252,45,0,1,"2018-04-16 10:25:39","1354.99"
"grafana/loki","a5790f332ef7fa0d363f9cce2cb2806ccda008ca","aknuds1","2021-08-31 14:13:42","true","Chore: Use runtimeconfig from dskit (#4227)

* Use runtimeconfig from dskit

Signed-off-by: Arve Knudsen <arve.knudsen@gmail.com>

* runtimeconfig: Use cortex_ prefix for metrics

Signed-off-by: Arve Knudsen <arve.knudsen@gmail.com>",130,40,0,0,"2018-04-16 10:25:39","1230.91"
"grafana/loki","705acd3462da42d8d57e17ae7de4c6da248eca19","danpoltawski","2022-11-11 12:30:16","true","docs/upgrading: Add a note about windows event log fix (#7668)

**What this PR does / why we need it**:
Add note to upgrade guide for a bug fix with log query impact

**Which issue(s) this PR fixes**:
Fixes #7667",85,55,1,0,"2018-04-16 10:25:39","1666.09"
"grafana/loki","ae23b7e4ed54f4e5b932f5ff814f7dab0f2d5db5","cyriltovena","2021-04-22 15:23:50","true","Rejects push requests with  streams without labels. (#3643)

* Rejects push requests with  streams without labels.

Fixes #3638

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* Missing commit

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",166,36,0,1,"2018-04-16 10:25:39","1101.96"
"grafana/loki","10bd165996bcc388a285f580656feae604e8bd8d","cyriltovena","2021-08-03 08:21:40","true","Fixes unaligned shards between ingesters and storage. (#4087)

* Fixes unaligned shards between ingesters and storage.

Currently shards computation are not correctly aligned between ingester and storage causing bad metric results.

- Fixed the hash caculation which was missing the metric name `logs`.
- Revert some changes from https://github.com/grafana/loki/pull/3852/commits/5f0e2453fe0e5c922e6e152bb0d1e7b063c92065 which was not keeping the alignement of shards.

For example if the shard is 9 of 16 total, then it should also be 9 and 25 of 32. The previous commit was trying to use 10 and 11 of 32.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* better tests.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",103,40,0,1,"2018-04-16 10:25:39","1202.66"
"grafana/loki","149227b88984c93a2fdb097eed54eaec5e725e7f","adeverteuil","2022-04-28 15:58:46","true","Minor fixes in docs/sources/api/_index.md (#5915)",119,48,0,0,"2018-04-16 10:25:39","1473.23"
"grafana/loki","4e2b37b2f8e08618da6d29ab53e71ebe5d9e012e","cyriltovena","2020-07-23 21:09:22","true","bump fluentd version to release a new gem. (#2407)

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",120,27,0,1,"2018-04-16 10:25:39","827.95"
"grafana/loki","a7b83bf9bb50d3e0ec63f900121e3ef4af6ca5e1","gonzalesraul","2023-09-14 19:41:17","true","chore(docs): Fix structured_metadata usage (#10526)

**What this PR does / why we need it**:

According to the code the pipeline name uses `_` not `-` for the name

https://github.com/grafana/loki/blob/main/clients/pkg/logentry/stages/stage.go#L46C38-L46C38

Co-authored-by: J Stickler <julie.stickler@grafana.com>",42,65,1,0,"2018-04-16 10:25:39","1974.64"
"grafana/loki","c263f3ed603027ab729c373cf82416f45821ff62","dannykopping","2021-11-16 11:05:51","true","Adding upgrade guide for recording rules (#4751)

Signed-off-by: Danny Kopping <danny.kopping@grafana.com>",198,43,0,1,"2018-04-16 10:25:39","1305.78"
"grafana/loki","45807ba19b733f5e28f3a1e2fd980b7ab8eaa598","tomwilkie","2018-04-17 15:20:58","false","Add HTTP interface to distributor and querier.",0,0,0,0,"2018-04-16 10:25:39","1.21"
"grafana/loki","d08871d4c7e3b8dbf6d55954a141f83b55e09fc4","hedss","2020-12-07 09:29:58","true","fluent-bit: Rename Fluent Bit plugin output name. (#2974)

This prevents a clash with the Loki plugin now included with
the Fluent Bit agent by default.

The output plugin is now named `grafana-loki`.

Signed-off-by: Heds Simons <heds@whaleway.net>
(cherry picked from commit b195e94f3952171f0ba082623bed0389df657524)",124,32,0,0,"2018-04-16 10:25:39","961.46"
"grafana/loki","e2952f9ce19e4f0eb6731952b3095bf27b2cb27d","ludydoo","2022-09-07 08:44:31","true","Troubleshooting: instructions for loki + istio (#6205)

<!--  Thanks for sending a pull request!  Before submitting:

1. Read our CONTRIBUTING.md guide
2. Name your PR as `<Feature Area>: Describe your change`.
a. Do not end the title with punctuation. It will be added in the
changelog.
b. Start with an imperative verb. Example: Fix the latency between
System A and System B.
  c. Use sentence case, not title case.
d. Use a complete phrase or sentence. The PR title will appear in a
changelog, so help other people understand what your change will be.
3. Rebase your PR if it gets out of sync with main
-->

**What this PR does / why we need it**:
Add troubleshooting instructions for running istio and loki. It takes a
long time
to figure out how to make it work, hope it will help others.

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

<!--
Note about CHANGELOG entries, if a change adds:
* an important feature
* fixes an issue present in a previous release, 
* causes a change in operation that would be useful for an operator of
Loki to know
then please add a CHANGELOG entry.

For documentation changes, build changes, simple fixes etc please skip
this step. We are attempting to curate a changelog of the most relevant
and important changes to be easier to ingest by end users of Loki.

Note about the upgrade guide, if this changes:
* default configuration values
* metric names or label names
* changes existing log lines such as the metrics.go query output line
* configuration parameters 
* anything to do with any API
* any other change that would require special attention or extra steps
to upgrade
Please document clearly what changed AND what needs to be done in the
upgrade guide.
-->
**Checklist**
- [x] Documentation added
- [ ] Tests updated
- [ ] Is this an important fix or new feature? Add an entry in the
`CHANGELOG.md`.
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>",84,53,1,0,"2018-04-16 10:25:39","1601.93"
"grafana/loki","f65456f2707f44e8aac4661d1899b2b47b2369a5","nate-walters-grafana","2021-12-15 10:13:19","true","Add copyright notice (#4898)",228,44,0,0,"2018-04-16 10:25:39","1334.74"
"grafana/loki","dff3622eaa79c90c57f74b25c19cf4b1a228f925","ashwanthgoli","2023-08-28 11:15:21","true","deprecate old index types and non-object stores (#10341)

**What this PR does / why we need it**:
Deprecates old index types: `aws, aws-dynamo, gcp, gcp-columnkey,
bigtable, bigtable-hashed, cassandra, grpc`. Only `tsdb` and
`boltdb-shipper` are supported.

Deprecates non-object stores. The next major release might not allow the
usage of these as `object_store` in `schema_config`: `aws-dynamo, gcp,
gcp-columnkey, bigtable, bigtable-hashed, cassandra, grpc.`

Deprecates table manager which is not needed once when using
`boltdb-shipper` or `tsdb` index type

**Which issue(s) this PR fixes**:
Fixes #<issue number>

**Special notes for your reviewer**:

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [x] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)",49,64,1,0,"2018-04-16 10:25:39","1958.28"
"grafana/loki","d42859c03a1063a22afe836cd110d6cdeadca69c","sh0rez","2020-02-27 20:26:13","false","fix(ksonnet): named parameters for containerPort

Because ksonnet-lib switched the order of the `containerPort.new()`
parameters from `ksonnet.beta.3` to `ksonnet.beta.4`, we have to use
named parameters to avoid invalid resources when using one of these versions.",119,22,0,0,"2018-04-16 10:25:39","676.67"
"grafana/loki","d61b0fe7e1a6053190ab48d8bb5e7e43a83e49e2","julienduchesne","2022-06-30 13:56:25","true","Add jsonnet to build image (#6526)

* Add jsonnet to build image
Needed for https://github.com/grafana/loki/pull/6456

* Add pipeline step to build image",73,50,0,0,"2018-04-16 10:25:39","1535.15"
"grafana/loki","17f4a73a24c8afc36bcb4e2795c6b1e06d4b95a1","jeschkies","2021-07-23 12:07:43","true","Filter instant queries and shard them. (#3984)

* Filter instan queries and shard them.

* [WIP] Test instant query sharding

* Trace casting error.

* WRap LokiInstantRequest for Params interface.

* Convert paras to request.

* Convert vector.

* Use proper query time stamp.

* Assert number of calls.

* Convert vector to multiple samples.

* Format code.

* Use type switch.

* Format code.

* Rename Matrix to proto conversion.

* Remvoe comment on caching.

* Update pkg/querier/queryrange/roundtrip_test.go

Co-authored-by: Cyril Tovena <cyril.tovena@gmail.com>

* Remove nil middlware.

* Handle LokiInstantRequest correctly.

* Assert reponse type.

* Return LokiPromResponse.

* Verify err in tests.

* Set shards.

* Correct result type.

* Use limits middleware.

* Use shars parameter in querier.

* Return vector.

* Unify params.

* Change direction to FORWARD.

Co-authored-by: Cyril Tovena <cyril.tovena@gmail.com>",97,39,0,1,"2018-04-16 10:25:39","1192.82"
"grafana/loki","c4913bfc88dd7eb2db6facd2d52fbffa56ecdfef","JensErat","2019-10-01 16:23:41","false","fluent-bit: edge case tests (#1096)",72,17,0,0,"2018-04-16 10:25:39","530.5"
"grafana/loki","e9d2a30733c66f993e34a5fd3d8a1166305471b0","kovaxur","2022-05-18 09:03:26","true","Fixed reader to support both authentication and tenant-id at the same time. (#5719)",74,49,0,0,"2018-04-16 10:25:39","1492.94"
"grafana/loki","61bbe151712cc84f59302ffb96bd5d673a55821b","liguozhong","2022-10-13 06:54:26","true","[promtail] log:   simplify log, only print hash (#7405)

Compute and print MD5 hash of config",91,54,1,1,"2018-04-16 10:25:39","1637.85"
"grafana/loki","55733561f799cf07c6d73279a399d8cfc449547a","Guidurand","2023-01-10 20:13:10","true","[helm] Add a flag to enable/disable persistentVolumeClaimRetentionPolicy feature (#7640)

**What this PR does / why we need it**:

add a flag to enable/disable persistentVolumeClaimRetentionPolicy
feature which is available since kubernetes 1.23 but in alpha
(StatefulSetAutoDeletePVC) and disabled by default on most cloud
provider

I've set the flag to true by default, to not change the actual behavior
 
**Which issue(s) this PR fixes**:
Fixes #7249",100,57,1,0,"2018-04-16 10:25:39","1725.41"
"grafana/loki","05f8e564db5539dfbb562ea8fbf4123f0fc116ef","rfratto","2019-10-02 22:58:15","false","Clarify journal warning (#1109)",76,17,0,1,"2018-04-16 10:25:39","531.77"
"grafana/loki","2af3d680cb742457d7a6f1c00e50f087e248e5dd","sandeepsukhani","2022-09-22 11:31:16","true","tsdb supports data deletion, this PR takes care of todo to enable delete request client for tsdb (#7223)

**What this PR does / why we need it**:
`tsdb` index store supports deletion of data, but we had missed enabling
the creation of delete requests client, which is required for query time
filtering of data requested for deletion. This PR takes care of it.
I have also removed some unused code and adjusted the tests accordingly.

**Checklist**
- [x] Tests updated",85,53,1,1,"2018-04-16 10:25:39","1617.05"
"grafana/loki","48660d5cd5c455b450d78f6a2e024ee69d21e1e8","salvacorts","2023-08-02 13:35:48","true","Fix bugs in non-indexed-labels (#10142)

**What this PR does / why we need it**:

This PR fixes some bugs discovered while setting the default chunk
format yo _V4_ and the default head format to _unordered with
non-indexed labels_.

Note that this PR doesn't change the defaults, but fixes some bugs that
would prevent us from changing them in the future.

The bugs it fixes are:

- Index out-of-range panic when symbols' labels are empty and we do a
Lookup. **Test added**.
- When applying retention, new chunks wouldn't contain non-indexed
labels (caused by https://github.com/grafana/loki/pull/10090). **Test
added**.
- New chunks would fail to serialize non-indexed labels when applying
retention because the head format would be the [dummy one (ordered)][1]
[(used here via `c.headFmt`)][2]. **Cannot test unless we change the
default chunk/head format** but tested manually.

**Checklist**
- [ ] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] If the change is worth mentioning in the release notes, add
`add-to-release-notes` label
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/setup/upgrade/_index.md`
- [ ] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

[1]:
https://github.com/grafana/loki/blob/457f2e6ec0f626dfec17faa8ba424a04818168b8/pkg/chunkenc/memchunk.go#L375
[2]:
https://github.com/grafana/loki/blob/24fd56683328514b58257972d6ca5baa9aeec51b/pkg/chunkenc/memchunk.go#L1088-L1095",52,63,1,1,"2018-04-16 10:25:39","1932.38"
"grafana/loki","0075085e9a7f659d44ddb99de6d1d64806ddf4b3","gabor","2022-05-20 20:10:56","true","docs: describe ordering in http query results (#6024)

* docs: describe ordering in http query results

* improved text

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* better text

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

* better text

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>

Co-authored-by: Karen Miller <84039272+KMiller-Grafana@users.noreply.github.com>",71,49,0,0,"2018-04-16 10:25:39","1495.41"
"grafana/loki","8eced44bbc9790562a53bc5ccb0ab89e5af20101","sh0rez","2019-11-26 16:11:51","true","chore(ci): drone-cli (#1274)

Drone has a CLI (https://github.com/drone/drone-cli) that handles compiling the
Jsonnet to a valid `drone.yml`.

This is more elegant than our previous `jsonnet | yq` dance.",82,19,0,0,"2018-04-16 10:25:39","585.49"
"grafana/loki","a88ee16534ebc7349a4bdf5fd12ca790b0575944","owen-d","2022-02-02 16:13:43","true","better logic for when to shard wrt disabled lookback (#5303)",277,45,0,1,"2018-04-16 10:25:39","1381.99"
"grafana/loki","fc20f8c85c122db40ff5f22e2582d1ec8783ecfb","tomwilkie","2019-04-19 07:33:37","false","Document the filter expression sytax.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",95,12,0,0,"2018-04-16 10:25:39","368.13"
"grafana/loki","631b45d86f3d8712c8f4c0dc18ac0415fec13ddd","tomwilkie","2018-11-22 15:08:26","false","Add commands for building and running tempo locally.

Signed-off-by: Tom Wilkie <tom.wilkie@gmail.com>",5,7,0,0,"2018-04-16 10:25:39","216.2"
"grafana/loki","8e9702950cbc697cab70966d98e5cdafa1cd546e","jeschkies","2022-11-23 13:11:53","true","Only check mixin on file changes. (#7755)

**What this PR does / why we need it**:
The mixin check sometimes (e.g. [this
build](https://drone.grafana.net/grafana/loki/17667/4/2)) which blocks
pull requests with unrelated changes. This is a quick fix. Ideally we
would investigate why Jsonnet Bundler is failing sometimes.

**Checklist**
- [ ] Reviewed the `CONTRIBUTING.md` guide
- [ ] Documentation added
- [ ] Tests updated
- [ ] `CHANGELOG.md` updated
- [ ] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`",93,55,1,1,"2018-04-16 10:25:39","1678.12"
"grafana/loki","11052c597e57cab47480b22f46b93d67e8121ba8","fredrikekre","2021-05-18 08:07:44","true","[docs/clients] fix header for ""Unofficial clients"" (#3720)

and add a reference to said section.",197,37,0,0,"2018-04-16 10:25:39","1127.65"
"grafana/loki","ee8c0a804eec2509b69ebf89c5766ea649ad6ef6","DanCech","2019-01-14 00:47:03","true","Add missing backslash",61,9,0,0,"2018-04-16 10:25:39","267.6"
"grafana/loki","d5e6c603496afb95397da56e3484e129373baa86","gouthamve","2018-12-07 12:37:21","false","Make images run (#49)

No clue what the flag is and what fixed it.

With `-linkmode=external`, this is printed while building the image
```
loadinternal: cannot find runtime/cgo
```

When you try to run the image there is a coredump, see
```
```➜  loki git:(master) ✗ strace ./cmd/loki/loki
execve(""./cmd/loki/loki"", [""./cmd/loki/loki""], 0x7ffe400edb30 /* 36 vars */) = 0
arch_prctl(0x3001 /* ARCH_??? */, 0x7ffef5e69200) = -1 EINVAL (Invalid argument)
brk(NULL)                               = 0x3140000
brk(0x31411c0)                          = 0x31411c0
arch_prctl(ARCH_SET_FS, 0x3140880)      = 0
uname({sysname=""Linux"", nodename=""nomad"", ...}) = 0
readlink(""/proc/self/exe"", ""/home/goutham/go/src/github.com/""..., 4096) = 58
brk(0x31621c0)                          = 0x31621c0
brk(0x3163000)                          = 0x3163000
arch_prctl(ARCH_SET_FS, 0x12012b0)      = 0
--- SIGTRAP {si_signo=SIGTRAP, si_code=SI_KERNEL} ---
+++ killed by SIGTRAP (core dumped) +++
[1]    14848 trace trap (core dumped)  strace ./cmd/loki/loki```
```

Signed-off-by: Goutham Veeramachaneni <gouthamve@gmail.com>",9,8,0,0,"2018-04-16 10:25:39","231.09"
"grafana/loki","c4cc5fb40b8b78785f07feec350266e141999c80","daixiang0","2019-04-18 01:42:48","true","Merge branch 'master' into reduce-config-option",102,12,0,0,"2018-04-16 10:25:39","366.89"
"grafana/loki","583aa2835d5462d8c00660dcad90cfbb96719899","DylanGuedes","2023-10-10 15:19:38","true","Stop using MaxTransferRetries (#10844)

**What this PR does / why we need it**:
This configuration was removed on
https://github.com/grafana/loki/pull/10709/files.

**Which issue(s) this PR fixes**:
N/A",25,66,1,1,"2018-04-16 10:25:39","2000.45"
"grafana/loki","a41926ec500416fd0d85332e4c0188c6f7dafba5","DylanGuedes","2022-04-14 08:18:45","true","Only run boltdb-shipper when appropriate. (#5917)",320,48,0,1,"2018-04-16 10:25:39","1453.66"
"grafana/loki","f6f49ec6bba518144492939c2f6c62698ea9b936","DylanGuedes","2022-08-25 10:35:52","true","Return Querier/QueryTimeout YAML configuration. (#6972)

What this PR does / why we need it:
On PR #6835 I mistakenly removed the querier:query_timeout YAML configuration. This PR returns it and uses it if it is still configured while logging a warning message to alert users of the upcoming changes.",82,52,0,1,"2018-04-16 10:25:39","1590.01"
"grafana/loki","14a5fda15b0755fe28476facd5f16a357818bb3f","cyriltovena","2020-11-17 14:04:12","true","Only append tailed entries if needed. (#2931)

* Only append tailed entries if needed.

This avoid to doing allocations on slices when there is no tailers.

We could potentially pooled the slice too but the tailing code is using the stream in an
async fashion so we can't put it back.

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>

* cleanup

Signed-off-by: Cyril Tovena <cyril.tovena@gmail.com>",121,31,0,1,"2018-04-16 10:25:39","941.65"
"grafana/loki","3e4566daf90001274ded5145866edccf6a3f9a8b","rfratto","2021-03-02 02:10:23","true","remove unneeded prune-ci-tags drone job (#3412)",139,34,0,1,"2018-04-16 10:25:39","1046.16"
"grafana/loki","2a8a03795adf28027bd705240dd29c9973840404","sandeepsukhani","2019-06-19 06:38:48","true","Improvements in live tailing of logs (#541)

* Improvements in live tailing of logs

Instead of polling for new logs, a grpc stream is opened between ingester and querier to get live logs
Querier reconnects to disconnected or newly added ingesters

* Added more comments to code for live log tailing

* Some code refactoring in live log tailing

* handling delayfor in logcli, max delayfor to be 5 seconds

* some changes in tail response in live tailing

* Fixed issue with stopping ingesters gracefully when live tailing is being used

* Added tests for tailer in querier

* Live tailing made logql compatible, some code refactoring suggested in PR",84,14,0,1,"2018-04-16 10:25:39","428.09"
"grafana/loki","3a28a17946a6ad608041e8ace77d1a90a082f269","sandeepsukhani","2020-05-13 12:27:12","true","some metrics for measuring performance and failures in boltdb shipper (#2034)

* some metrics for measuring performance and failures in boltdb shipper

* counting both failures and success in upload and download operation in boltdb shipper

* changes suggested from PR review",118,25,0,1,"2018-04-16 10:25:39","757.58"
"grafana/loki","3457f44cf506ff045dce090db7a89319eac1ce2c","sandeepsukhani","2019-08-02 12:06:42","false","Fix querying historic entries while live tailing logs

Querying logs in backward direction, then fetching all the logs upto the query limit and
then iterating over it in reverse order",106,15,0,1,"2018-04-16 10:25:39","471.32"
"grafana/loki","e1c582d57d596f03133e64b4b550d7d3709b8a75","GneyHabub","2021-09-10 08:22:08","true","Update README.md (#4309)",131,41,0,0,"2018-04-16 10:25:39","1239.66"
"grafana/loki","0ab9a6383d457f6e7f9e22798fd4bbdbe9bdfa80","wardbekker","2020-07-07 18:03:32","true","Added a link to the replace parsing stage (#2308)",121,27,0,0,"2018-04-16 10:25:39","811.82"
"grafana/loki","5ca7c29e2ca7cc4217fca65ffd5688c29b3b2237","trevorwhitney","2022-09-01 14:51:11","true","Helm: test migration from `grafana/loki-simple-scalable` (#6986)

**What this PR does / why we need it**:

Verify the upgrade path from `grafana/loki-simple-scalable` -> `grafana/loki` works.

Fixes #6874",81,52,1,1,"2018-04-16 10:25:39","1596.18"
"grafana/loki","d58125885b08ad5ae98086eb08682782e60611ad","NilsGriebner","2023-06-08 09:30:52","true","Make table manager retention options configurable in helm chart values (#9647)

**What this PR does / why we need it**:

Configuration options for table manager retention are hard-coded in the
helm chart values at the moment so that it's not possible to enable
retention deletes.

**Which issue(s) this PR fixes**:
Fixes #8676

**Special notes for your reviewer**:
-

**Checklist**
- [x] Reviewed the
[`CONTRIBUTING.md`](https://github.com/grafana/loki/blob/main/CONTRIBUTING.md)
guide (**required**)
- [x] Documentation added
- [x] Tests updated
- [x] `CHANGELOG.md` updated
- [x] Changes that require user attention or interaction to upgrade are
documented in `docs/sources/upgrading/_index.md`
- [x] For Helm chart changes bump the Helm chart version in
`production/helm/loki/Chart.yaml` and update
`production/helm/loki/CHANGELOG.md` and
`production/helm/loki/README.md`. [Example
PR](https://github.com/grafana/loki/commit/d10549e3ece02120974929894ee333d07755d213)

Co-authored-by: Michel Hollands <42814411+MichelHollands@users.noreply.github.com>",68,62,1,0,"2018-04-16 10:25:39","1878.21"
"grafana/loki","ed452becc717169f0661771cdc3c03aec85c77f2","davkal","2019-03-07 13:15:44","true","Merge pull request #374 from grafana/troubleshooting-promtail

adding some docs on how to identify and connect to promtail pod",88,11,0,0,"2018-04-16 10:25:39","321.12"
"grafana/loki","7fc8863d8839cbb805881e75887544da452af382","davkal","2019-06-20 13:58:01","true","Merge pull request #469 from daixiang0/reduce-config-option

Remove useless config option",86,14,0,0,"2018-04-16 10:25:39","429.4"
